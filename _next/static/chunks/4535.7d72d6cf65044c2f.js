(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4535],{14535:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>d});var s=i(95155),l=i(12115),a=i(36379),r=i.n(a);i(23879);var n=i(56572),c=i(33024);let o=[121.5318,25.0478];function d(){let e=(0,l.useRef)(null),t=(0,l.useRef)(null),[i,a]=(0,l.useState)(!1),d="1GYoblfxWX2uc8edFcbq",[p,u]=(0,l.useState)(d?"streets-v2":"demo"),[x,y]=(0,l.useState)({zoning:{visible:!1,opacity:.6},cadastral:{visible:!1,opacity:.6}}),h=(0,l.useRef)(x),m=(0,l.useRef)(!1),b=(0,l.useMemo)(()=>[{id:"zoning",label:"國土利用現況調查成果圖",tiles:"https://wmts.nlsc.gov.tw/wmts/LUIMAP/default/GoogleMapsCompatible/{z}/{y}/{x}"},{id:"cadastral",label:"段籍圖（地籍）",tiles:"https://wmts.nlsc.gov.tw/wmts/LANDSECT/default/GoogleMapsCompatible/{z}/{y}/{x}"}],[]),f=(0,l.useMemo)(()=>{let e=[{id:"streets-v2",label:"街景",url:`https://api.maptiler.com/maps/streets-v2/style.json?key=${d}`},{id:"basic-v2",label:"極簡",url:`https://api.maptiler.com/maps/basic-v2/style.json?key=${d}`},{id:"topo-v2",label:"地形",url:`https://api.maptiler.com/maps/topo-v2/style.json?key=${d}`},{id:"dataviz",label:"數據",url:`https://api.maptiler.com/maps/dataviz/style.json?key=${d}`}];return d?e:[{id:"demo",label:"開源預設",url:"https://demotiles.maplibre.org/style.json"}]},[d]);return(0,l.useEffect)(()=>{if(!e.current||t.current)return;let i=f.find(e=>e.id===p)?.url||"https://demotiles.maplibre.org/style.json",s=new(r()).Map({container:e.current,style:i,center:o,zoom:14,pitch:45,bearing:-15,antialias:!0});s.addControl(new(r()).NavigationControl({showCompass:!0}),"top-right"),s.on("style.load",()=>{(()=>{let e=s.getStyle();if(!e?.layers)return;let t=e.layers.find(e=>"symbol"===e.type&&e.layout?.["text-field"])?.id,i=s.getSource("openmaptiles")?"openmaptiles":s.getSource("maptiler")?"maptiler":null;!i||s.getLayer("3d-buildings")||s.addLayer({id:"3d-buildings",source:i,"source-layer":"building",type:"fill-extrusion",minzoom:15,paint:{"fill-extrusion-color":"#64748b","fill-extrusion-height":["coalesce",["get","render_height"],["get","height"],6],"fill-extrusion-base":["coalesce",["get","render_min_height"],["get","min_height"],0],"fill-extrusion-opacity":.85}},t)})(),b.forEach(e=>{if(!e.tiles)return;let t=`gov-${e.id}`,i=`gov-${e.id}-layer`;s.getSource(t)||s.addSource(t,{type:"raster",tiles:[e.tiles],tileSize:256}),s.getLayer(i)||s.addLayer({id:i,type:"raster",source:t,layout:{visibility:"none"},paint:{"raster-opacity":h.current[e.id]?.opacity??.6}})}),b.forEach(e=>{if(!e.tiles)return;let t=`gov-${e.id}-layer`;if(!s.getLayer(t))return;let i=h.current[e.id];i&&(s.setLayoutProperty(t,"visibility",i.visible?"visible":"none"),s.setPaintProperty(t,"raster-opacity",i.opacity))}),m.current||(m.current=!0,a(!0))}),t.current=s;let l=new ResizeObserver(()=>s.resize());return l.observe(e.current),()=>{l.disconnect(),s.remove(),t.current=null}},[]),(0,l.useEffect)(()=>{h.current=x;let e=t.current;e&&b.forEach(t=>{if(!t.tiles)return;let i=`gov-${t.id}-layer`;if(!e.getLayer(i))return;let s=x[t.id];s&&(e.setLayoutProperty(i,"visibility",s.visible?"visible":"none"),e.setPaintProperty(i,"raster-opacity",s.opacity))})},[x,b]),(0,l.useEffect)(()=>{let e=t.current;if(!e)return;let i=f.find(e=>e.id===p)?.url;i&&e.setStyle(i,{diff:!1})},[p,f]),(0,s.jsxs)("div",{className:"relative w-full h-full rounded-xl overflow-hidden border border-white/10 shadow-2xl",children:[(0,s.jsxs)("div",{className:"absolute top-4 left-4 z-10 rounded-full bg-zinc-900/80 px-3 py-1 text-xs text-zinc-300 border border-white/10 flex items-center gap-2",children:[(0,s.jsx)(n.A,{className:"h-3.5 w-3.5 text-cyan-400"}),"MapLibre + MapTiler"]}),(0,s.jsxs)("div",{className:"absolute top-4 right-4 z-10 rounded-2xl bg-zinc-900/85 px-4 py-3 text-[11px] text-zinc-300 border border-white/10 shadow-lg space-y-3 w-64",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-xs font-semibold text-white",children:[(0,s.jsx)(c.A,{className:"h-4 w-4 text-cyan-400"}),"圖層控制"]}),(0,s.jsx)("div",{className:"space-y-3",children:b.map(e=>{let t=x[e.id],i=!e.tiles;return(0,s.jsxs)("div",{className:i?"opacity-40":"",children:[(0,s.jsxs)("label",{className:"flex items-center justify-between gap-3 text-xs text-zinc-300",children:[(0,s.jsx)("span",{children:e.label}),(0,s.jsx)("input",{type:"checkbox",checked:t?.visible||!1,onChange:t=>y(i=>({...i,[e.id]:{...i[e.id]||{opacity:.6,visible:!1},visible:t.target.checked}})),className:"h-4 w-4 accent-cyan-500",disabled:i})]}),(0,s.jsxs)("label",{className:"space-y-1 text-[10px] text-zinc-500",children:[(0,s.jsx)("span",{children:"透明度"}),(0,s.jsx)("input",{type:"range",min:0,max:1,step:.05,value:t?.opacity??.6,onChange:t=>y(i=>({...i,[e.id]:{...i[e.id]||{visible:!1,opacity:.6},opacity:parseFloat(t.target.value)}})),className:"w-full",disabled:i})]}),i&&(0,s.jsx)("div",{className:"text-[10px] text-zinc-600",children:"未設定圖資 URL"})]},e.id)})}),(0,s.jsxs)("div",{className:"pt-2 border-t border-white/10 space-y-2",children:[(0,s.jsxs)("div",{className:"text-xs text-white font-semibold flex items-center gap-2",children:[(0,s.jsx)(n.A,{className:"h-3.5 w-3.5 text-cyan-400"}),"底圖風格"]}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2",children:f.map(e=>(0,s.jsx)("button",{onClick:()=>u(e.id),className:`rounded-lg px-2 py-1 text-[10px] border transition-colors ${p===e.id?"border-cyan-500 text-cyan-200 bg-cyan-500/10":"border-white/10 text-zinc-400 hover:border-white/30"}`,children:e.label},e.id))}),(0,s.jsx)("div",{className:"text-[10px] text-zinc-500",children:"3D 建物已啟用（縮放 15+）"})]})]}),!i&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-zinc-950/70 z-20",children:(0,s.jsx)("div",{className:"text-sm text-zinc-400",children:"正在載入地圖引擎..."})}),(0,s.jsx)("div",{ref:e,className:"w-full h-full"})]})}},23879:()=>{},33024:(e,t,i)=>{"use strict";i.d(t,{A:()=>s});let s=(0,i(78340).A)("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]])}}]);