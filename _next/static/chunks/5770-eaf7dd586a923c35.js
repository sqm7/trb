"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5770],{9505:(e,t,a)=>{a.d(t,{l:()=>o});var s=a(95155),r=a(12115),i=a(40980),n=a(68459),l=a(94514),c=a(61878);function o({projects:e,className:t,onChange:a,max:o=6,placeholder:d="搜尋並加入比較...",title:x="建案亮點標示"}){let[h,m]=(0,r.useState)(""),[p,u]=(0,r.useState)([]),[g,f]=(0,r.useState)(!1),b=(0,r.useRef)(null),j=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=e=>{b.current&&!b.current.contains(e.target)&&f(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let y=e.filter(e=>!p.includes(e.value)&&e.label.toLowerCase().includes(h.toLowerCase())).slice(0,10);return(0,s.jsxs)("div",{className:(0,i.cn)("space-y-2",t),ref:b,children:[(0,s.jsxs)("div",{className:"flex justify-between items-center bg-zinc-900/50 p-1 rounded-lg border border-white/5",children:[(0,s.jsxs)("h4",{className:"text-sm font-medium text-zinc-400 pl-2 border-l-2 border-yellow-500",children:[x," ",(0,s.jsxs)("span",{className:"text-xs font-normal text-zinc-600",children:["(最多 ",o," 個)"]})]}),p.length>0&&(0,s.jsxs)("button",{onClick:()=>{u([]),a([]),j.current?.focus()},className:"p-1.5 text-zinc-500 hover:text-rose-400 hover:bg-rose-500/10 rounded transition-colors flex items-center gap-1 text-xs",title:"清除所有選擇",children:[(0,s.jsx)(n.A,{size:14}),"清除"]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 min-h-[32px]",children:[0===p.length&&(0,s.jsx)("span",{className:"text-xs text-zinc-600 italic py-1",children:"尚未選擇建案..."}),p.map(e=>(0,s.jsxs)("div",{className:"flex items-center gap-1 bg-yellow-500/10 text-yellow-500 px-2 py-1 rounded text-xs border border-yellow-500/30",children:[(0,s.jsx)("span",{children:e}),(0,s.jsx)("button",{onClick:()=>{let t;u(t=p.filter(t=>t!==e)),a(t)},className:"hover:text-yellow-300",children:(0,s.jsx)(l.A,{size:12,className:"rotate-45"})})]},e))]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(c.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-500"}),(0,s.jsx)("input",{ref:j,type:"text",value:h,onChange:e=>{m(e.target.value),f(!0)},onFocus:()=>f(!0),placeholder:d,className:"w-full bg-zinc-900/50 border border-white/10 rounded-lg pl-9 pr-4 py-2 text-sm text-white placeholder:text-zinc-600 focus:outline-none focus:ring-1 focus:ring-cyan-500/50 transition-all",disabled:p.length>=o}),g&&(0,s.jsx)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-zinc-900 border border-white/10 rounded-lg shadow-xl z-50 max-h-60 overflow-y-auto",children:y.length>0?y.map(e=>(0,s.jsx)("button",{onClick:()=>(e=>{if(p.length>=o)return;let t=[...p,e];u(t),a(t),m(""),j.current?.focus()})(e.value),className:"w-full text-left px-3 py-2 text-sm text-zinc-300 hover:bg-white/5 hover:text-white transition-colors",children:e.label},e.value)):(0,s.jsx)("div",{className:"px-3 py-2 text-sm text-zinc-600",children:"無相關建案"})})]})]})}},27529:(e,t,a)=>{a.d(t,{FH:()=>l});var s=a(16385),r=a(55873);async function i(){let{data:{session:e}}=await s.N.auth.getSession();return{"Content-Type":"application/json",apikey:r.m5,Authorization:`Bearer ${e?.access_token||r.m5}`}}async function n(e){let t=await i(),a=await fetch(r.Sn.RANKING_ANALYSIS,{method:"POST",headers:t,body:JSON.stringify({filters:e})});if(!a.ok)throw Error((await a.json().catch(()=>({error:`Analysis request failed: ${a.status}`}))).error||"Analyze data failed");return a.json()}let l={checkAuth:async function(){let{data:{session:e}}=await s.N.auth.getSession();e||console.log("User not logged in, but allowing access.")},getUser:async function(){let{data:{user:e}}=await s.N.auth.getUser();return e},signOut:async function(){let{error:e}=await s.N.auth.signOut();if(e)throw console.error("Sign out failed:",e),e},fetchData:async function(e,t){let a=await i(),s=await fetch(r.Sn.QUERY_DATA,{method:"POST",headers:a,body:JSON.stringify({filters:e,pagination:t})});if(!s.ok)throw Error((await s.json().catch(()=>({error:"Failed to parse server response"}))).error||"Fetch data failed");return s.json()},analyzeData:n,analyzeProjectRanking:n,fetchSubData:async function(e,t,a){if(!e||!t||!a)throw Error(`Insufficient parameters: ${e}, ${t}, ${a}`);let s=await i(),n=await fetch(r.Sn.SUB_DATA,{method:"POST",headers:s,body:JSON.stringify({id:e,type:t,county:a})});if(!n.ok)throw Error((await n.json().catch(()=>({error:"Failed to fetch sub data"}))).error||"Fetch sub data failed");return n.json()},fetchProjectNameSuggestions:async function(e,t,a=[]){let s=await i(),n=t.replace(/\u3127/g,"一"),l=await fetch(r.Sn.PROJECT_NAMES,{method:"POST",headers:s,body:JSON.stringify({countyCode:e,query:n,districts:a,detailed:!0})});if(!l.ok)throw Error(`Server error: ${l.status}`);return l.json()},getAdminUsers:async function(){let e=await i(),t=await fetch(r.Sn.GET_USERS,{method:"POST",headers:e,body:JSON.stringify({})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to fetch users"}))).error||"Fetch users failed");return t.json()},getUserActivity:async function(e,t=200,a=0){let s=await i(),n=await fetch(r.Sn.GET_USER_ACTIVITY,{method:"POST",headers:s,body:JSON.stringify({userId:e,limit:t,offset:a})});if(!n.ok)throw Error((await n.json().catch(()=>({error:"Failed to fetch user activity"}))).error||"Fetch user activity failed");return n.json()},getActivityStats:async function(){let e=await i(),t=await fetch(r.Sn.GET_ACTIVITY_STATS,{method:"POST",headers:e,body:JSON.stringify({})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to fetch activity stats"}))).error||"Fetch activity stats failed");return t.json()},validateReferralCode:async function(e){let t=await i();return(await fetch(r.Sn.VALIDATE_REFERRAL_CODE,{method:"POST",headers:t,body:JSON.stringify({code:e})})).json()},activateSubscription:async function(e){let t=await i(),a=await fetch(r.Sn.ACTIVATE_SUBSCRIPTION,{method:"POST",headers:t,body:JSON.stringify(e)});if(!a.ok)throw Error((await a.json().catch(()=>({error:"Activation failed"}))).error||"Activation failed");return a.json()},bindReferralCode:async function(e){let t=await i(),a=await fetch(r.Sn.BIND_REFERRAL_CODE,{method:"POST",headers:t,body:JSON.stringify("string"==typeof e?{code:e}:e)});if(!a.ok)throw Error((await a.json().catch(()=>({error:"Failed to bind referral code"}))).error||"Failed to bind referral code");return a.json()},clearReferralCode:async function(){let e=await i(),t=await fetch(r.Sn.BIND_REFERRAL_CODE,{method:"POST",headers:e,body:JSON.stringify({action:"clear"})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to clear referral code"}))).error||"Failed to clear referral code");return t.json()},getReferralDashboard:async function(){let e=await i(),t=await fetch(r.Sn.GET_REFERRAL_DASHBOARD,{method:"POST",headers:e,body:JSON.stringify({})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to fetch referral data"}))).error||"Fetch referral dashboard failed");return t.json()},consumeReferralFeature:async function(e,t="consume"){let a=await i(),s=await fetch(r.Sn.CONSUME_REFERRAL_FEATURE,{method:"POST",headers:a,body:JSON.stringify({feature:e,mode:t})});if(!s.ok){let e=await s.json().catch(()=>({error:"Failed to consume feature"}));throw Error(e.error||e.reason||"Failed to consume feature")}return s.json()}}},30327:(e,t,a)=>{a.d(t,{A:()=>S});var s=a(95155),r=a(12115),i=a(81477),n=a(18460),l=a(40980);let c=(0,n.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o({className:e,variant:t,...a}){return(0,s.jsx)("div",{className:(0,l.cn)(c({variant:t}),e),...a})}let d=[{id:"p-2012-08-01",date:"2012-08-01",title:"實價登錄 1.0 上路",category:"policy",impact:"high",description:"交易後30日內申報，區段化揭露(30號區間)，預售屋採代銷結案後整批申報。",change_content:"交易資訊不透明 -> 區段化揭露",affected_scope:"房仲業者、買賣雙方、預售屋投機客",background:"低利環境延續：國內房貸利率處於低檔 (約1.8%-1.9%)。",impact_analysis:"[受益] 買方獲得參考依據。[適應] 房仲失去資訊壟斷優勢。[無感] 預售屋投機客因資訊未即時揭露，仍可操作紅單。",details:["申報義務人：地政士、經紀業或權利人。","申報時機：買賣案件於辦竣所有權移轉登記後30日內申報。","揭露方式：以區段化、去識別化方式提供查詢 (例如：中正路1-30號)。","預售屋規定：委託代銷者，於委託代銷契約屆滿或終止30日內「整批」申報 (資訊落後嚴重)。"]},{id:"p-2014-06-04",date:"2014-06-04",title:"囤房稅 1.0",category:"policy",impact:"medium",description:"非自住住家用稅率由1.2%-2%調高為1.5%-3.6%，授權地方政府自訂差別稅率。",change_content:"非自住稅率 1.2% -> 1.5%~3.6%",affected_scope:"多屋族、台北市置產客",background:"美國聯準會結束QE：預期升息心理浮現，全球資金派對暫歇。",impact_analysis:"[微痛] 持有成本上升，但因多數縣市未採最高稅率，且稅基(房屋評定現值)偏低，實質痛感有限。",details:["自住房屋稅率：維持 1.2% (需本人、配偶或直系親屬實際居住，且全國合計3戶以內)。","非自住房屋稅率：由 1.2%~2% 調升至 1.5%~3.6%。","地方權限：各地方政府可視地方發展需要，在範圍內自訂差別稅率。","持有認定：以個人(自然人)或法人(公司)為單位個別計算。"]},{id:"p-2016-01-01",date:"2016-01-01",title:"房地合一稅 1.0",category:"policy",impact:"high",description:"獲利課稅取代舊制。持有<1年45%，1-2年35%，自用滿6年獲利400萬免稅。奢侈稅同步停徵。",change_content:"按售價課稅(奢侈稅) -> 按獲利課稅(45%~15%)",affected_scope:"短線炒作客、自住客",background:"奢侈稅同步停徵：象徵房市進入「實價課稅」新紀元。",impact_analysis:"[毀滅] 短進短出獲利被腰斬，投資客大量退場。[受益] 房價盤整，自住客獲得較佳議價空間。",details:["課稅基礎：房地交易所得 = 交易成交價額 - 原始取得成本 - 相關費用 - 土地漲價總數額。","持有1年以內：稅率 45%。","持有1-2年：稅率 35%。","持有2-10年：稅率 20%。","持有超過10年：稅率 15%。","自用住宅優惠：獲利400萬元以下免稅，超過部分10%。(需連續設籍滿6年)","日出條款：2016年1月1日以後取得之房地適用新制。"]},{id:"f-2016-03-24",date:"2016-03-24",title:"央行大幅鬆綁信用管制",category:"finance",impact:"high",description:"刪除特定地區管制與自然人第3戶以上限制，僅保留豪宅管制(6成)。",change_content:"刪除多數管制，僅保留豪宅限貸",affected_scope:"換屋族、一般投資客",background:"經濟成長疲弱：為提振內需經濟，央行解除長達6年的房市管制。",impact_analysis:"[受益] 貸款成數恢復，換屋與置產門檻降低，市場交易量逐漸回溫。",details:["解除管制區域：台北市及新北市特定地區。","解除限制對象：自然人第3戶以上購屋貸款、公司法人購屋貸款。","保留限制：高價住宅(豪宅)貸款最高成數仍維持6成。"]},{id:"p-2018-06-27",date:"2018-06-27",title:"租賃住宅市場發展及管理條例",category:"policy",impact:"low",description:"建立包租代管機制，鼓勵房東釋出空屋，給予稅賦優惠(所得稅減免)。",change_content:"包租代管稅賦優惠",affected_scope:"房東、租屋族",background:"美中貿易戰開打：全球供應鏈重組，資金開始撤離中國。",impact_analysis:"[受益] 房東享有所得稅減免；租屋族獲得專業代管服務，租賃關係較有保障。",details:["租稅優惠：個人房東委託包租代管，月租金6000元以下免稅；6000-20000元必要費用率53%。","專業證照：建立租賃住宅管理人員證照制度。","糾紛處理：建立租賃糾紛免費調處機制。"]},{id:"f-2019-08-15",date:"2019-08-15",title:"境外資金匯回專法",category:"finance",impact:"medium",description:"鼓勵台商資金回流享優惠稅率，禁止直接投資房地產，但產生外溢效應帶動豪宅與工業地產。",change_content:"資金專法回流 (禁入房市但有外溢)",affected_scope:"工業地產主、豪宅建商",background:"台商回流潮：史上最大規模資金回台，雖禁入房市，但產生外溢效應。",impact_analysis:"[暴富] 工業用地與廠房價格飆漲。[受益] 企業主獲利與分紅轉入豪宅市場，帶動高總價產品去化。",details:["優惠稅率：第一年匯回稅率8%，第二年10%。(實質投資可退稅一半)","投資限制：禁止資金直接投資房地產(避免炒房)。","資金控管：資金需存入專戶，控管5-7年才能分批提取。","外溢效應：雖然不能直接買房，但增加市場資金總量，且企業獲利後的分紅仍可自由運用。"]},{id:"f-2020-03-19",date:"2020-03-19",title:"央行降息 1 碼",category:"finance",impact:"high",description:"重貼現率降至1.125%，房貸利率跌破1.4%歷史新低，無限QE背景下引發資產通膨。",change_content:"重貼現率 1.375% -> 1.125%",affected_scope:"全體購屋族、股市投資人",background:"COVID-19 疫情爆發：美國聯準會無限QE，全球熱錢氾濫。",impact_analysis:"[刺激] 持有成本極低，「租不如買」與「買房抗通膨」心理大爆發，股房雙漲。",details:["降息幅度：調降重貼現率 0.25個百分點。","房貸利率：五大銀行新承做房貸利率跌破 1.4%，創歷史新低。","配套補貼：針對受疫情影響產業及自用住宅貸款提供額外補貼。"]},{id:"f-2020-12-08",date:"2020-12-08",title:"央行信用管制 (第一波)",category:"finance",impact:"medium",description:"法人購屋限貸6成，自然人第3戶限貸6成，建商餘屋限貸5成。",change_content:"法人/第3戶/餘屋 限貸 5-6成",affected_scope:"公司法人、多屋族(3戶+)",background:"房市過熱跡象：紅單炒作猖獗，排隊買房現象頻傳。",impact_analysis:"[警示] 宣示政府打炒房決心，但因低利環境，實質殺傷力有限。",details:["公司法人：第一戶貸款成數最高 6成，無寬限期。","自然人第3戶(含)以上：貸款成數最高 6成，無寬限期。","購地貸款：限貸 6.5成，需保留 1成動工款。","餘屋貸款：限貸 5成。"]},{id:"f-2021-03-19",date:"2021-03-19",title:"央行信用管制 (第二波)",category:"finance",impact:"medium",description:"法人購屋成數降至4成，豪宅降至5.5成。",change_content:"法人限貸 4成；豪宅限貸 5.5成",affected_scope:"公司法人、豪宅客",background:"投機風氣未減",impact_analysis:"[打擊] 封鎖利用公司名義高槓桿炒房的途徑。",details:["公司法人：貸款成數調降至 4成。","自然人高價住宅：第1戶限貸 5.5成，第3戶以上限貸 4成。","工業區閒置土地：貸款最高 5.5成。"]},{id:"p-2021-07-01",date:"2021-07-01",title:"實價登錄 2.0 & 房地合一 2.0",category:"policy",impact:"high",description:"門牌完整揭露，預售屋即時申報(30日)，禁止紅單轉售；重稅期延長(45%改2年, 35%改5年)，預售屋納稅。",change_content:"預售屋納管、重稅閉鎖期延長、禁紅單",affected_scope:"預售屋買方/投機客、建商、換屋族",background:"房市多頭確立；疫情三級警戒(內需停滯但房市創高)",impact_analysis:"[雙面刃] 資訊全透明反成定錨工具。[閉鎖] 投機客無法短進短出，成屋惜售供給減少，價格難跌。",details:["實價登錄2.0：門牌號碼完整揭露 (不再區段化)。","預售屋納管：銷售前需備查，簽約後30日內申報實價登錄。","紅單禁止：禁止預售屋紅單轉售。","房地合一2.0：預售屋獲利納入房地合一稅課徵。","延長重稅期：持有2年內45%，2-5年35% (原為1-2年)。","法人比照：法人交易比照自然人稅率 (防堵公司名義短期炒作)。"]},{id:"f-2021-09-24",date:"2021-09-24",title:"央行信用管制 (第三波)",category:"finance",impact:"medium",description:"特定地區 (六都+新竹) 第2戶取消寬限期。",change_content:"特定地區第2戶 取消寬限期",affected_scope:"投資客、換屋族",background:"房價持續攀升",impact_analysis:"[壓力] 買第2間房必須立刻還本金，增加現金流壓力，迫使部分槓桿過大者退場。",details:["管制區域：新增特定地區 (六都 + 新竹縣市)。","自然人第2戶：取消寬限期 (需本息攤還)。","購地貸款：調降至 6成。","工業區閒置土地：調降至 5成。"]},{id:"f-2021-12-17",date:"2021-12-17",title:"央行信用管制 (第四波)",category:"finance",impact:"medium",description:"豪宅貸款降至4成，第3戶降至4成，餘屋貸款降至4成。",change_content:"豪宅/第3戶/餘屋 限貸 4成",affected_scope:"建商、豪宅客",background:"營建成本飆漲：缺工缺料議題發酵。",impact_analysis:"[緊縮] 建商資金鏈趨緊，中小型建商生存困難，市場走向大者恆大。",details:["自然人高價住宅：貸款成數一律降至 4成 (無寬限期)。","自然人第3戶(含)以上：貸款成數一律降至 4成。","購地貸款：降至 5成。","餘屋貸款：降至 4成。"]},{id:"f-2022-03-17",date:"2022-03-17",title:"央行升息循環啟動",category:"finance",impact:"medium",description:"央行跟進Fed升息(全年共2.5碼)，房貸利率重回2%以上。",change_content:"升息 2.5碼 (利率重回 2% table+)",affected_scope:"房貸族",background:"全球通膨危機：美國暴力升息，全球股市修正。",impact_analysis:"[負擔增加] 每千萬房貸每年利息支出增加約3-4萬元，稍微冷卻追價意願。",details:["2022-03：升息 1碼 (0.25%)。","2022-06：升息 半碼 (0.125%)。","2022-09：升息 半碼 (0.125%)。","2022-12：升息 半碼 (0.125%)。","存款準備率：同步調升，緊縮市場游資。"]},{id:"f-2023-06-16",date:"2023-06-16",title:"央行信用管制 (第五波)",category:"finance",impact:"medium",description:"特定地區第2戶限貸成數上限 7成。",change_content:"特定地區第2戶 限貸 7成",affected_scope:"換屋族、投資客",background:"房市量縮價穩：市場觀望平均地權條例上路。",impact_analysis:"[微痛] 需多準備1成自備款，影響尚可控。",details:["管制區域：特定地區 (六都 + 新竹縣市)。","自然人第2戶：新增貸款成數上限 7成 (此前僅無寬限期)。"]},{id:"p-2023-07-01",date:"2023-07-01",title:"平均地權條例修正",category:"policy",impact:"high",description:"預售屋禁止換約轉售，建立檢舉獎金，私法人購屋許可制。",change_content:"預售屋禁換約、私法人許可制",affected_scope:"預售屋黃牛、豪宅法人",background:"投機客的大限",impact_analysis:"[滅絕] 純粹賺價差的紅單與換約客徹底消失。豪宅市場因法人需經許可，交易量急凍。",details:["限制換約轉售：預售屋與新建成屋簽約後，除配偶、直系或二親等旁系外，不得讓與或轉售 (禁止黃牛)。","重罰炒作：嚴懲散播不實資訊影響房價，最高罰5000萬元。","檢舉獎金：建立檢舉實名制，獎金為罰鍰 30%。","私法人購屋許可制：私法人購買住宅用房屋需經內政部許可 (限制豪宅私法人節稅管道)。"]},{id:"p-2023-08-01",date:"2023-08-01",title:"新青安貸款專案",category:"policy",impact:"high",description:"額度1000萬，年限40年，寬限期5年，利率補貼(1.775%起)。",change_content:"40年期/5年寬限/降息補貼",affected_scope:"首購族、投機客(人頭)、低總價屋主",background:"總統大選前夕：政府釋出利多，試圖減輕年輕人負擔。",impact_analysis:"[狂熱] 創造「租不如買」與「5年免還本」的套利空間。低總價成屋被掃貨，房價逆勢暴漲。",details:["貸款額度：提高至 1000萬元。","利息補貼：政府補貼 1.5碼 (0.375%) + 公股銀行減半碼 = 利率 1.775% 起。","貸款年限：延長至 40年。","寬限期：延長至 5年 (只繳息不還本)。","資格：本人、配偶及未成年子女名下均無自有住宅。"]},{id:"f-2024-06-14",date:"2024-06-14",title:"央行信用管制 (第六波)",category:"finance",impact:"medium",description:"特定地區第2戶限貸成數降至 6成。",change_content:"特定地區第2戶 限貸 6成",affected_scope:"換屋族、置產客",background:"台股站上2萬點：AI熱潮帶動股市財富效應，資金外溢至房市。",impact_analysis:"[無效] 股市獲利豐厚，6成限貸無法阻擋資金湧入房市。",details:["管制區域：特定地區 (六都 + 新竹縣市)。","自然人第2戶：貸款成數上限由 7成調降為 6成。","調升存款準備率：調升 0.25個百分點 (收回市場資金)。"]},{id:"p-2024-07-01",date:"2024-07-01",title:"囤房稅 2.0 實施",category:"policy",impact:"medium",description:"全國歸戶，非自用稅率調高至 2.0%-4.8%，建商餘屋依持有年限課稅。",change_content:"全國歸戶；稅率 2.0%~4.8%",affected_scope:"多屋族、租屋族、建商",background:"租金指數創高",impact_analysis:"[轉嫁] 多屋族將稅負轉嫁至租金，導致租金上漲。建商面臨餘屋去化壓力，傾向預售完銷。",details:["全國歸戶：由縣市歸戶改為全國歸戶計算戶數。","稅率調升：非自住住家用稅率調升為 2%~4.8% (原1.5%~3.6%)。","單一自住優惠：全國單一自住(本人配偶子女僅一戶)且房屋現值在一定金額以下，稅率降至 1%。","建商餘屋：持有2年以內稅率 2%~3.6%；超過2年稅率 2%~4.8% (鼓勵釋出餘屋)。"]},{id:"f-2024-08-01",date:"2024-08-01",title:"銀行限貸令 (72-2水位)",category:"finance",impact:"high",description:"銀行法72-2條逼近30%上限，自主限貸、排隊撥款，市場流動性急凍。",change_content:"銀行自主限貸、排隊撥款",affected_scope:"即將交屋族、賣屋換屋族",background:"新青安效應發酵：過多成屋交易與新青安撥款，耗盡銀行額度。",impact_analysis:"[恐慌] 買了房卻貸不到款，面臨違約風險。市場流動性瞬間急凍。",details:["銀行法72-2條：商業銀行辦理住宅建築及企業建築放款總額，不得超過存款總餘額及金融債券發售額之 30%。","現象：多家銀行房貸水位接近滿載。","影響：銀行暫停收件、排隊撥款(需等數月)、利率大幅調升(2.6%-3%以上)。"]},{id:"f-2024-09-20",date:"2024-09-20",title:"央行信用管制 (第七波)",category:"finance",impact:"high",description:"有房者第1戶無寬限期；全國第2戶限貸5成；法人/豪宅/第3戶限貸3成。",change_content:"有房者第1戶無寬限；第2戶全國限貸5成",affected_scope:"換屋族、繼承族、交屋族",background:"金龍海嘯：央行判定房市過熱，認為新青安助長投機，決心斷絕金流。",impact_analysis:"[重傷/錯殺] 史上最嚴厲管制。1. 換屋族需5成自備。2. 繼承祖產失寬限。3. 預售交屋斷頭風險大增。",details:["自然人第1戶：名下有房屋者(含繼承、持分)，第1戶購屋貸款「無寬限期」。","自然人第2戶：貸款成數上限降至 5成，且擴及「全國」。","自然人第3戶以上：貸款成數上限降至 3成。","公司法人：購屋貸款成數降至 3成。","豪宅(高價住宅)：貸款成數降至 3成。","餘屋貸款：降至 3成。","存款準備率：再調升 0.25個百分點。"]}];var x=a(30122),h=a(85753),m=a(68822),p=a(44071),u=a(9921),g=a(66088),f=a(57420),b=a(69220),j=a(22651),y=a(64479),v=a(9505),N=a(89733),w=a(72264),z=a(60529),k=a(33807);function S({data:e}){let t=(0,r.useMemo)(()=>{if(!e)return[];let t=new Set;return e.forEach(e=>{e["建案名稱"]&&t.add(e["建案名稱"])}),Array.from(t).map(e=>({value:e,label:e}))},[e]),[a,n]=(0,r.useState)([]),[c,S]=(0,r.useState)(null),[_,P]=(0,r.useState)(null),A=[{label:"2年/行",yearsPerRow:2},{label:"1年/行",yearsPerRow:1},{label:"6月/行",yearsPerRow:.5},{label:"3月/行",yearsPerRow:.25}],[M,C]=(0,r.useState)(0),F=A[M],R=F.yearsPerRow,[T,$]=(0,r.useState)(!1),[D,E]=(0,r.useState)(null),[L,I]=(0,r.useState)({}),[O,B]=(0,r.useState)(!0),[Y,J]=(0,r.useState)(!0),[U,W]=(0,r.useState)(null),[H,Z]=(0,r.useState)(null),K=(0,r.useMemo)(()=>{if(0===a.length||!e||0===e.length)return[];let t={};return e.forEach(e=>{let s=e["建案名稱"];if(!s||!a.includes(s))return;let r=new Date(e["交易日"]).getTime();isNaN(r)||(t[s]||(t[s]=[]),t[s].push(r))}),Object.entries(t).map(([e,t])=>{let a=Math.min(...t),s=Math.max(...t);return{name:e,start:new Date(a),end:new Date(s),startStr:new Date(a).toISOString().slice(0,10),endStr:new Date(s).toISOString().slice(0,10),count:t.length}}).sort((e,t)=>e.start.getTime()-t.start.getTime()).slice(0,10)},[e,a]),q=(0,r.useMemo)(()=>{let e=U??2012,t=new Date().getFullYear();if(K.length>0&&(t=Math.max(t,Math.max(...K.map(e=>e.end.getFullYear()))+1)),null!==H)t=H;else{let e=new Date().getFullYear();t=t>e?Math.max(e,t):e}return{start:new Date(`${e}-01-01`),end:new Date(`${t}-12-31`),totalMonths:(t-e+1)*12}},[K,U,H]),G=[16,-16,32,-32],X=q.start.getFullYear(),V=Math.ceil((q.end.getFullYear()-X+1)/R),Q=(0,r.useMemo)(()=>Array.from({length:V}).map((e,t)=>{let a=t*R,s=(t+1)*R,r=new Date(X,0,1),i=new Date(X,0,1),n=Math.floor(12*a),l=Math.floor(12*s);r.setMonth(r.getMonth()+n),i.setMonth(i.getMonth()+l);let c=new Date(i);return c.setDate(c.getDate()-1),{startYear:r.getFullYear(),endYear:c.getFullYear(),startStr:r.toISOString().slice(0,7),endStr:c.toISOString().slice(0,7),start:r,end:i}}),[V,R,X]),ee=24*(K.length>0),et=(0,r.useMemo)(()=>{if(null===D||D<0||D>=Q.length)return null;let e=Q[D],t=e.start.getTime(),a=e.end.getTime(),s=a-t,r=K.filter(e=>Math.max(e.start.getTime(),t)<Math.min(e.end.getTime(),a)),i=[],n=r.map((e,r)=>{let n=Math.max(e.start.getTime(),t),l=Math.min(e.end.getTime(),a),c=i.findIndex(e=>e<n);-1===c?(c=i.length,i.push(l)):i[c]=l;let o=(l-n)/s*100;return{...e,laneIndex:c,startPct:(n-t)/s*100,widthPct:o,originalIndex:r}});return{maxLanes:i.length,items:n}},[D,Q,K]),ea=(0,r.useMemo)(()=>Array.from({length:V}).map((e,t)=>t===D&&et?Math.max(72,116+36*et.maxLanes):72),[V,D,et]),es=(0,r.useMemo)(()=>{let e=24;return ea.map(t=>{let a=e;return e+=t,a})},[ea]),er=ea.reduce((e,t)=>e+t,0),ei=Math.max(24+er+80,24+er+ee+36*K.length+60),en=(0,r.useMemo)(()=>d.filter(e=>{let t=new Date(e.date);return!!(t>=q.start&&t<=q.end)&&("finance"!==e.category||!!O)&&("policy"!==e.category||!!Y)}),[q,O,Y]),el=(0,r.useMemo)(()=>{let e=Array.from({length:V},()=>[]);en.forEach((t,a)=>{let s=new Date(t.date),r=Q.findIndex(e=>s>=e.start&&s<e.end);r<0&&(s.getTime(),Q[Q.length-1].end.getTime(),r=V-1),e[r].push({index:a,date:s})});let t=Array(en.length),a=e=>Math.min(.6,Math.max(0,e/365*.18));return e.forEach((e,s)=>{if(e.sort((e,t)=>e.date.getTime()-t.date.getTime()),0===e.length)return;let r=0;for(let t=1;t<e.length;t+=1)r+=a(Math.max(0,(e[t].date.getTime()-e[t-1].date.getTime())/864e5));let i=e.length+r,n=0,l=[-999,-999,-999,-999];e.forEach((r,c)=>{if(c>0){let t=Math.max(0,(r.date.getTime()-e[c-1].date.getTime())/864e5);n+=a(t)}n+=1;let o=i>0?(n-.5)/i:0,d=100*o,x=d-6,h=-1;for(let e=0;e<4;e++)if(l[e]+2<x){h=e;break}-1===h&&(h=l.indexOf(Math.min(...l))),l[h]=d+6,t[r.index]={rowIndex:s,posInRow:c,densityPos:o,laneIndex:h}})}),t},[en,Q,V]),ec=(0,r.useMemo)(()=>en.slice().reverse().map(e=>({日期:e.date,標題:e.title,類別:"finance"===e.category?"金融":"政策",影響:e.impact,變革內容:e.change_content,影響對象:e.affected_scope})),[en]),eo=c&&_&&_.id!==c.id?_:null,ed=!!eo,ex=e=>{if(T&&c){e.id===c.id?P(null):P(e),$(!1);return}S(e),_?.id===e.id&&P(null)},eh=()=>{c&&eo&&(S(eo),P(c))},em=(e,t)=>{let a=!!L[e.id],r="primary"===t;return(0,s.jsx)("div",{className:"border border-white/10 bg-black/45 backdrop-blur-lg p-6 rounded-xl animate-in fade-in slide-in-from-top-4 shadow-2xl shadow-black/50",children:(0,s.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between border-b border-white/5 pb-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:(0,l.cn)("text-[10px] uppercase tracking-wider px-2 py-0.5 rounded border",r?"border-cyan-500/40 text-cyan-300 bg-cyan-500/10":"border-emerald-500/40 text-emerald-300 bg-emerald-500/10"),children:r?"主事件":"對照事件"}),(0,s.jsx)("span",{className:"text-zinc-400 font-mono text-xs",children:e.date})]}),(0,s.jsx)("div",{className:"flex items-center gap-3",children:(0,s.jsx)(o,{variant:"outline",className:(0,l.cn)("text-sm px-3 py-1","finance"===e.category?"bg-emerald-500/10 text-emerald-400 border-emerald-500/30":"bg-rose-500/10 text-rose-400 border-rose-500/30"),children:"finance"===e.category?"金融事件":"房市政策"})}),(0,s.jsx)("h3",{className:"text-2xl font-bold text-white tracking-tight",children:e.title})]}),(0,s.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,s.jsxs)("div",{className:(0,l.cn)("px-3 py-1 rounded-full text-xs font-medium border","high"===e.impact?"bg-red-500/10 text-red-400 border-red-500/30":"bg-yellow-500/10 text-yellow-400 border-yellow-500/30"),children:["影響程度: ","high"===e.impact?"高":"medium"===e.impact?"中":"低"]}),r?(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[ed&&(0,s.jsx)("button",{onClick:eh,className:"text-[11px] px-2 py-1 rounded border border-white/10 text-zinc-300 hover:text-white hover:border-white/30 transition-colors",children:"對調"}),ed?(0,s.jsx)("button",{onClick:()=>P(null),className:"text-[11px] px-2 py-1 rounded border border-white/10 text-zinc-300 hover:text-white hover:border-white/30 transition-colors",children:"清除對照"}):(0,s.jsx)("button",{onClick:()=>$(!0),className:"text-[11px] px-2 py-1 rounded border border-cyan-500/30 text-cyan-300 hover:text-white hover:border-cyan-400/60 transition-colors",children:"選對照事件"})]}):(0,s.jsx)("button",{onClick:()=>P(null),className:"text-[11px] px-2 py-1 rounded border border-white/10 text-zinc-300 hover:text-white hover:border-white/30 transition-colors",children:"移除對照"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-8",children:[(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{className:"text-sm font-bold text-zinc-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[(0,s.jsx)(m.A,{className:"w-4 h-4"})," 政策/事件內容"]}),(0,s.jsx)("p",{className:"text-zinc-200 text-base leading-relaxed bg-black/40 p-4 rounded-lg border border-white/5",children:e.description})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{className:"text-sm font-bold text-zinc-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[(0,s.jsx)(h.A,{className:"w-4 h-4"})," 具體規範變革"]}),(0,s.jsx)("div",{className:"bg-black/40 p-4 rounded-lg border border-white/5 text-cyan-400 font-medium",children:e.change_content||"無具體規範變更"})]})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{className:"text-sm font-bold text-zinc-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[(0,s.jsx)(x.A,{className:"w-4 h-4"})," 時代背景與金融環境"]}),(0,s.jsx)("p",{className:"text-zinc-300 text-sm leading-relaxed bg-black/30 p-4 rounded-lg border border-white/5",children:e.background||"尚無背景資料"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{className:"text-sm font-bold text-zinc-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[(0,s.jsx)(p.A,{className:"w-4 h-4"})," 受眾影響分析"]}),(0,s.jsxs)("div",{className:"relative overflow-hidden rounded-lg border border-white/10 bg-gradient-to-br from-indigo-500/10 to-purple-500/10 p-4",children:[(0,s.jsx)("div",{className:"absolute top-0 right-0 p-2 opacity-10",children:(0,s.jsx)(p.A,{className:"w-24 h-24"})}),(0,s.jsxs)("div",{className:"relative z-10",children:[(0,s.jsxs)("p",{className:"text-indigo-300 font-medium mb-2 text-xs uppercase",children:["影響對象: ",e.affected_scope]}),(0,s.jsx)("p",{className:"text-white text-sm leading-relaxed",children:e.impact_analysis||"尚無詳細分析"})]})]})]})]})]}),e.details&&e.details.length>0&&(0,s.jsxs)("div",{className:"border-t border-white/5 pt-4",children:[(0,s.jsx)("button",{onClick:()=>{var t;return t=e.id,void I(e=>({...e,[t]:!e[t]}))},className:"flex items-center gap-2 text-sm text-zinc-400 hover:text-white transition-colors w-full justify-center py-2",children:a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.A,{className:"w-4 h-4"})," 收起完整規範細節"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.A,{className:"w-4 h-4"})," 展開完整規範細節 (",e.details.length," 項)"]})}),a&&(0,s.jsx)("div",{className:"mt-4 grid grid-cols-1 gap-4 animate-in fade-in slide-in-from-top-2",children:e.details.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-start gap-3 bg-black/40 p-3 rounded border border-zinc-800 text-sm text-zinc-300",children:[(0,s.jsx)("span",{className:"flex items-center justify-center w-5 h-5 rounded-full bg-zinc-800 text-zinc-500 text-xs shrink-0 mt-0.5",children:t+1}),(0,s.jsx)("span",{children:e})]},t))})]})]})})};return(0,s.jsxs)(i.Zp,{className:"w-full bg-black/40 border-zinc-800 backdrop-blur-xl",children:[(0,s.jsxs)(i.aR,{children:[(0,s.jsxs)(i.ZB,{className:"flex items-center gap-2 text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400",children:[(0,s.jsx)(f.A,{className:"w-6 h-6 text-cyan-500"}),"房市政策時光機"]}),(0,s.jsx)(i.BT,{className:"text-zinc-400",children:"建案銷售期間與重大政策/金融事件的交叉比對"})]}),(0,s.jsxs)(i.Wu,{children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row items-start md:items-end justify-between mb-6 px-2 gap-4",children:[(0,s.jsx)("div",{className:"w-full md:w-1/2 lg:w-1/3",children:(0,s.jsx)(v.l,{projects:t,onChange:n,title:"選擇建案 (顯示銷售區間)",placeholder:"搜尋建案以顯示在時間軸...",max:6})}),(0,s.jsxs)("div",{className:"flex items-center justify-between w-full md:w-auto gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 bg-black/20 rounded-lg p-1 border border-white/5",children:[(0,s.jsx)("button",{onClick:()=>C(e=>Math.max(0,e-1)),disabled:0===M,className:"p-1.5 hover:bg-white/10 rounded-md text-zinc-400 hover:text-white transition-colors disabled:opacity-30",children:(0,s.jsx)(b.A,{className:"w-4 h-4"})}),(0,s.jsx)("span",{className:"text-xs font-mono text-zinc-500 w-16 text-center",children:F.label}),(0,s.jsx)("button",{onClick:()=>C(e=>Math.min(A.length-1,e+1)),disabled:M===A.length-1,className:"p-1.5 hover:bg-white/10 rounded-md text-zinc-400 hover:text-white transition-colors disabled:opacity-30",children:(0,s.jsx)(j.A,{className:"w-4 h-4"})})]}),(0,s.jsxs)(w.rI,{children:[(0,s.jsx)(w.ty,{asChild:!0,children:(0,s.jsx)("button",{className:"p-2 bg-black/20 hover:bg-white/10 border border-white/5 rounded-lg text-zinc-400 hover:text-white transition-colors",children:(0,s.jsx)(y.A,{className:"w-4 h-4"})})}),(0,s.jsxs)(w.SQ,{align:"end",className:"w-64 bg-zinc-950 border-zinc-800 text-zinc-200",children:[(0,s.jsx)(w.lp,{children:"顯示設定"}),(0,s.jsx)(w.mB,{className:"bg-zinc-800"}),(0,s.jsxs)(w.hO,{checked:Y,onCheckedChange:J,className:"focus:bg-zinc-800 focus:text-white",children:[(0,s.jsx)("span",{className:"w-2 h-2 rounded-full bg-rose-500 mr-2"}),"房市政策"]}),(0,s.jsxs)(w.hO,{checked:O,onCheckedChange:B,className:"focus:bg-zinc-800 focus:text-white",children:[(0,s.jsx)("span",{className:"w-2 h-2 rounded-full bg-emerald-500 mr-2"}),"金融事件"]}),(0,s.jsx)(w.mB,{className:"bg-zinc-800"}),(0,s.jsx)(w.lp,{children:"時間範圍"}),(0,s.jsxs)("div",{className:"p-2 space-y-3",children:[(0,s.jsxs)("div",{className:"grid grid-cols-[1fr_auto] gap-2 items-center",children:[(0,s.jsx)(k.J,{htmlFor:"start-year",className:"text-xs text-zinc-500",children:"起始年"}),(0,s.jsx)(z.p,{id:"start-year",type:"number",className:"h-7 w-20 text-xs bg-zinc-900 border-zinc-700 focus-visible:ring-zinc-600",placeholder:"2012",value:U??"",onChange:e=>{W(e.target.value?parseInt(e.target.value):null)}})]}),(0,s.jsxs)("div",{className:"grid grid-cols-[1fr_auto] gap-2 items-center",children:[(0,s.jsx)(k.J,{htmlFor:"end-year",className:"text-xs text-zinc-500",children:"結束年"}),(0,s.jsx)(z.p,{id:"end-year",type:"number",className:"h-7 w-20 text-xs bg-zinc-900 border-zinc-700 focus-visible:ring-zinc-600",placeholder:"Auto",value:H??"",onChange:e=>{Z(e.target.value?parseInt(e.target.value):null)}})]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 text-xs text-zinc-500",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,s.jsx)("div",{className:"w-2 h-2 rounded-full bg-emerald-500"})," 金融事件"]}),(0,s.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,s.jsx)("div",{className:"w-2 h-2 rounded-full bg-rose-500"})," 房市政策"]})]})]})]}),T&&(0,s.jsxs)("div",{className:"mb-4 mx-2 text-xs text-amber-300 bg-amber-500/10 border border-amber-500/30 rounded-lg px-3 py-2 flex items-center justify-between",children:[(0,s.jsx)("span",{children:"對照選取中：請點選時間軸或表格的另一筆事件。"}),(0,s.jsx)("button",{onClick:()=>$(!1),className:"text-amber-200 hover:text-white transition-colors",children:"取消"})]}),(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-[1fr_450px] gap-16 items-start",children:[(0,s.jsx)("div",{className:"relative w-full",children:(0,s.jsx)("div",{className:"relative w-full overflow-x-hidden pb-12 pt-8",children:(0,s.jsxs)("div",{className:"relative ml-16 border-b border-zinc-800 transition-all duration-300 ease-out cursor-default",style:{width:"90%",minWidth:"90%",height:`${ei}px`,paddingRight:"140px"},onClick:()=>{S(null),P(null),$(!1)},children:[(0,s.jsx)("div",{className:"absolute inset-0 z-10",children:Q.map((e,t)=>{let a=es[t],r=a+36,i=t===D,n=e.start.getTime(),c=e.end.getTime(),o=c-n;return(0,s.jsxs)("div",{className:"group/row",onClick:e=>{E(e=>e===t?null:t)},children:[(0,s.jsx)("div",{className:(0,l.cn)("absolute left-0 right-0 transition-colors duration-200 pointer-events-auto cursor-pointer",i?"bg-white/5":"hover:bg-white/5"),style:{top:`${a}px`,height:`${ea[t]}px`}}),(0,s.jsx)("div",{className:"absolute left-0 right-0 h-px bg-zinc-700/60 pointer-events-none",style:{top:`${r}px`}}),i&&et&&(0,s.jsx)("div",{className:"absolute left-0 right-0 pointer-events-none",style:{top:`${r+60}px`,bottom:0},children:et.items.map(e=>{let t=["bg-cyan-600 border-cyan-400 text-white","bg-violet-600 border-violet-400 text-white","bg-amber-600 border-amber-400 text-white","bg-emerald-600 border-emerald-400 text-white","bg-pink-600 border-pink-400 text-white"],a=t[K.findIndex(t=>t.name===e.name)%t.length];return(0,s.jsxs)("div",{className:(0,l.cn)("absolute h-7 rounded-md flex items-center px-3 text-xs font-bold whitespace-nowrap overflow-hidden shadow-lg border transition-transform hover:scale-[1.02] z-30",a),style:{left:`${e.startPct}%`,width:`${Math.max(.5,e.widthPct)}%`,top:`${36*e.laneIndex}px`},children:[(0,s.jsx)("span",{className:"mr-2",children:e.name}),(0,s.jsxs)("span",{className:"opacity-80 text-[10px] font-normal",children:[e.startStr," ~ ",e.endStr]})]},`stack-${e.name}-${e.originalIndex}`)})}),R<=1&&(0,s.jsx)(s.Fragment,{children:Array.from({length:e.endYear-e.startYear+1}).flatMap((t,a)=>{let s=e.startYear+a,r=[];if(R<=1&&r.push({m:6,d:1,label:"7/1",major:!0}),R<=.5&&(r.push({m:3,d:1,label:"4/1",major:!0}),r.push({m:9,d:1,label:"10/1",major:!0})),R<=.25)for(let e=1;e<12;e++)3!==e&&6!==e&&9!==e&&r.push({m:e,d:1,label:`${e+1}/1`,major:!1});return r.map(e=>{let t=new Date(s,e.m,e.d).getTime();return{...e,dateMs:t,year:s}})}).map((e,t)=>{if(e.dateMs>=n&&e.dateMs<=c){let t=(e.dateMs-n)/o*100,a=e.major;return(0,s.jsx)("div",{className:(0,l.cn)("absolute flex flex-col items-center justify-end group",a?"h-3 w-px bg-zinc-600":"h-2 w-px bg-zinc-700/50"),style:{left:`${t}%`,top:`${r-(a?5:4)}px`},children:(0,s.jsx)("span",{className:(0,l.cn)("font-mono -mt-4 transition-opacity",a?"text-[8px] text-zinc-500 opacity-60 group-hover:opacity-100":"text-[7px] text-zinc-700 opacity-0 group-hover:opacity-100"),children:e.label})},`mk-${e.year}-${e.m}`)}return null})}),!i&&(()=>{let e=K.filter(e=>Math.max(e.start.getTime(),n)<Math.min(e.end.getTime(),c));if(0===e.length)return null;let a=e.map(e=>({start:Math.max(e.start.getTime(),n),end:Math.min(e.end.getTime(),c)})).sort((e,t)=>e.start-t.start),i=[];if(a.length>0){let e=a[0];for(let t=1;t<a.length;t++)a[t].start<e.end?e.end=Math.max(e.end,a[t].end):(i.push(e),e=a[t]);i.push(e)}return i.map((e,a)=>{let i=(e.start-n)/o*100,l=(e.end-e.start)/o*100;return(0,s.jsx)("div",{className:"absolute h-1.5 bg-cyan-400 rounded-full shadow-[0_0_8px_rgba(34,211,238,0.6)] z-20 pointer-events-none",style:{left:`${i}%`,width:`${Math.max(.5,l)}%`,top:`${r}px`,marginTop:"-3px"}},`summary-${t}-${a}`)})})(),(0,s.jsx)("div",{className:"absolute text-[10px] font-mono text-zinc-500",style:{top:`${r-22}px`,left:"16px"},children:R<=.5?e.startStr:e.start.getFullYear()}),(0,s.jsx)("div",{className:"absolute text-[10px] font-mono text-zinc-500",style:{top:`${r-22}px`,right:"16px"},children:R<=.5?e.endStr:e.end.getFullYear()})]},`row-${e.startStr}-${e.endStr}`)})}),en.map((e,t)=>{let a="high"===e.impact,{rowIndex:r,posInRow:i,densityPos:n,laneIndex:o}=el[t]||{rowIndex:0,posInRow:0,densityPos:0,laneIndex:0},d=Q[r];if(!d)return null;let p=d.start.getTime(),u=d.end.getTime(),g=new Date(e.date).getTime(),f=u>p?(g-p)/(u-p):0,b=Math.min(95,Math.max(5,100*Math.min(1,Math.max(0,(n??f)*.8+.2*f)))),j=es[r],y=G[o%G.length],v=y<0,N=Math.max(10,Math.abs(y)-6),w=!1;if(K.length>0){let t=new Date(e.date);w=K.some(e=>t>=e.start&&t<=e.end)}let z=c?.id===e.id,k=_?.id===e.id;return(0,s.jsxs)("div",{className:(0,l.cn)("absolute transform -translate-x-1/2 flex flex-col items-center group cursor-pointer transition-all duration-200 ease-out z-20",z?"scale-[2.0] opacity-100 z-40":k?"scale-[1.8] opacity-100 z-40":w?"scale-100 opacity-90 hover:scale-[2.5] hover:opacity-100 hover:z-50":"scale-75 opacity-50 hover:scale-[2.5] hover:opacity-100 hover:z-50"),style:{left:`${b}%`,top:`${j+36+y}px`},onClick:t=>{t.stopPropagation(),ex(e)},children:[(0,s.jsx)("div",{className:(0,l.cn)("w-px absolute",v?"top-full bg-gradient-to-b":"bottom-full bg-gradient-to-t","from-transparent to-zinc-700"),style:{height:`${N}px`}}),(0,s.jsx)("div",{className:(0,l.cn)("w-3 h-3 rounded-full flex items-center justify-center border shadow-[0_0_10px_rgba(0,0,0,0.5)] transition-all","finance"===e.category?"bg-emerald-950/80 border-emerald-500/50 text-emerald-400 group-hover:shadow-emerald-500/20":"bg-rose-950/80 border-rose-500/50 text-rose-400 group-hover:shadow-rose-500/20",a&&"ring-1 ring-offset-1 ring-offset-black/50 ring-opacity-50","finance"===e.category&&a?"ring-emerald-500":"ring-rose-500",z&&"ring-1 ring-white ring-offset-1 ring-offset-black",!z&&k&&"ring-1 ring-emerald-400/70 ring-offset-1 ring-offset-black/70"),children:(e=>{switch(e){case"finance":return(0,s.jsx)(x.A,{className:"w-2 h-2 text-emerald-400"});case"policy":return(0,s.jsx)(h.A,{className:"w-2 h-2 text-rose-400"});default:return(0,s.jsx)(m.A,{className:"w-2 h-2 text-blue-400"})}})(e.category)}),(0,s.jsx)("div",{className:(0,l.cn)("absolute whitespace-nowrap text-[8px] px-1.5 py-0.5 rounded bg-black/80 border border-zinc-700 backdrop-blur-md transition-all font-medium",v?"-top-7":"-bottom-7",w?"text-white border-yellow-500/50":"text-zinc-400 group-hover:text-white",z&&"text-white border-white/50 bg-zinc-800",!z&&k&&"text-emerald-200 border-emerald-400/50 bg-emerald-950/60"),children:e.title}),(0,s.jsx)("div",{className:(0,l.cn)("absolute whitespace-nowrap text-[6px] font-mono text-zinc-600",v?"top-8":"bottom-8"),children:e.date})]},e.id)})]})})}),c?(0,s.jsx)("aside",{className:"xl:sticky xl:top-24 self-start max-h-[calc(100vh-8rem)] overflow-y-auto pr-1 bg-black/35 border border-white/10 rounded-2xl backdrop-blur-xl shadow-[0_20px_60px_rgba(0,0,0,0.55)] w-full max-w-[420px] justify-self-end",children:(0,s.jsx)("div",{className:"p-4",children:(0,s.jsxs)("div",{className:(0,l.cn)("grid grid-cols-1 gap-4",ed&&"xl:grid-cols-2"),children:[em(c,"primary"),eo&&em(eo,"compare")]})})}):(0,s.jsx)("div",{className:"hidden xl:block"})]}),(0,s.jsxs)("div",{className:"border-t border-zinc-800 pt-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(p.A,{className:"w-5 h-5 text-purple-400"}),(0,s.jsx)("h3",{className:"text-lg font-bold text-zinc-200",children:"政策影響比較表"})]}),(0,s.jsx)(N.N,{data:ec,filename:"policy_comparison",label:"匯出政策表"})]}),(0,s.jsxs)("div",{className:"rounded-xl border border-white/10 overflow-hidden bg-black/20",children:[(0,s.jsxs)("div",{className:"grid grid-cols-12 gap-4 p-4 bg-zinc-900/50 border-b border-white/5 text-xs font-bold text-zinc-400 uppercase tracking-wider",children:[(0,s.jsx)("div",{className:"col-span-2",children:"實施日期"}),(0,s.jsx)("div",{className:"col-span-3",children:"政策/事件名稱"}),(0,s.jsx)("div",{className:"col-span-4",children:"變革內容 (Before vs After)"}),(0,s.jsx)("div",{className:"col-span-3",children:"影響對象與範圍"})]}),(0,s.jsx)("div",{className:"divide-y divide-white/5 max-h-[400px] overflow-y-auto custom-scrollbar",children:en.slice().reverse().map(e=>{let t=c?.id===e.id,a=_?.id===e.id&&!t;return(0,s.jsxs)("div",{className:(0,l.cn)("grid grid-cols-12 gap-4 p-4 text-sm transition-colors hover:bg-white/5 cursor-pointer",t?"bg-white/10":"",a?"bg-emerald-500/10":""),onClick:()=>ex(e),children:[(0,s.jsx)("div",{className:"col-span-2 font-mono text-zinc-500",children:e.date}),(0,s.jsxs)("div",{className:"col-span-3 flex items-start gap-2",children:[(0,s.jsx)(o,{variant:"outline",className:(0,l.cn)("shrink-0 mt-0.5","finance"===e.category?"text-emerald-400 border-emerald-500/30":"text-rose-400 border-rose-500/30"),children:"finance"===e.category?"金融":"政策"}),(0,s.jsx)("span",{className:(0,l.cn)("font-medium","high"===e.impact?"text-white":"text-zinc-400"),children:e.title})]}),(0,s.jsx)("div",{className:"col-span-4 text-zinc-300",children:e.change_content?(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-cyan-500 shrink-0"}),e.change_content]}):(0,s.jsx)("span",{className:"text-zinc-600 italic",children:"--"})}),(0,s.jsx)("div",{className:"col-span-3 text-zinc-400",children:e.affected_scope||(0,s.jsx)("span",{className:"text-zinc-600 italic",children:"--"})})]},e.id)})})]})]})]})]})]})}},31840:(e,t,a)=>{a.d(t,{p:()=>w});var s=a(95155),r=a(12115),i=a(68605),n=a(65770),l=a(9921),c=a(66088),o=a(6296),d=a(61878),x=a(33210),h=a(18837),m=a(41641),p=a(21362),u=a(40980),g=a(88743),f=a(27529),b=a(55873),j=a(98883),y=a(51806),v=a(89733),N=a(70872);function w({data:e,trigger:t,uiSize:a="dashboard"}){let{counties:w,districts:z,transactionType:k,buildingType:S,projectNames:_,dateRange:P,startDate:A,endDate:M}=(0,g.P)(),[C,F]=(0,r.useState)([]),[R,T]=(0,r.useState)(!1),[$,D]=(0,r.useState)(null),[E,L]=(0,r.useState)(1),[I,O]=(0,r.useState)(new Set),[B,Y]=(0,r.useState)({key:"",direction:null}),[J,U]=(0,r.useState)(""),[W,H]=(0,r.useState)("建案名稱"),Z=(0,u.cn)("bg-zinc-800 border border-zinc-700 rounded px-3 text-zinc-200","builder"===a?"py-2 text-xl h-12":"py-1.5 text-sm h-9"),[K,q]=(0,r.useState)(!1),[G,X]=(0,r.useState)([]),[V,Q]=(0,r.useState)(!1),[ee,et]=(0,r.useState)([]),[ea,es]=(0,r.useState)(""),er=r.useRef(null),ei=(0,r.useRef)({counties:w,districts:z,transactionType:k,buildingType:S,projectNames:_,dateRange:P,startDate:A,endDate:M});(0,r.useEffect)(()=>{ei.current={counties:w,districts:z,transactionType:k,buildingType:S,projectNames:_,dateRange:P,startDate:A,endDate:M}});let en=(0,r.useCallback)(async()=>{let{counties:e,districts:t,transactionType:a,buildingType:s,projectNames:r,dateRange:i,startDate:n,endDate:l}=ei.current;T(!0),D(null),F([]);try{if(0===e.length)return void T(!1);let c=n,o=l;if("custom"!==i){let e=(0,j.P)(i);e.startDate&&(c=e.startDate),e.endDate&&(o=e.endDate)}let d=e.map(async e=>{let i=b.WG[e],n=b.Ib[e]||[],l=t?t.filter(e=>n.includes(e)):[],d={countyCode:i,districts:l.length>0?l:void 0,type:a,dateStart:c,dateEnd:o,projectNames:r,buildingType:s};try{return await f.FH.fetchData(d,{page:1,limit:1e3})}catch(t){return console.warn(`Fetch failed for ${e}`,t),{data:[],count:0}}}),x=await Promise.all(d),h=[];x.forEach(e=>{e&&Array.isArray(e.data)&&(h=[...h,...e.data])}),h.sort((e,t)=>{let a=e["交易日"]||"";return(t["交易日"]||"").localeCompare(a)}),F(h)}catch(e){console.error("Data List fetch failed:",e),D(e.message||"讀取交易資料失敗")}finally{T(!1)}},[]),el=JSON.stringify({counties:w,districts:z,transactionType:k,buildingType:S,projectNames:_,dateRange:P,startDate:A,endDate:M});(0,r.useEffect)(()=>{en()},[el]),(0,r.useEffect)(()=>{t&&en()},[en,t]);let ec=async e=>{Q(!0),X([]),et([]);let a=e["建案名稱"]||"未命名建案";es(`車位/附表明細 - ${a}`),q(!0);let s=[],r=e=>{console.log(e),s.push(e)};try{let i=e.編號,n=ei.current?.transactionType||k;if(r(`TID: ${i}`),r(`Type: ${n}`),r(`Project: ${a}`),!i){r("Error: No Transaction ID"),et(s),Q(!1);return}let l=[],c=e.縣市代碼;if(!c){let e=ei.current?.counties||[];1===e.length&&(c=b.WG[e[0]])}if(!c&&e.地址)for(let[t,a]of Object.entries(b.WG)){if(e.地址.startsWith(t)){c=a;break}let s=t.replace("台","臺");if(e.地址.replace("台","臺").startsWith(s)){c=a;break}}if(r(`CountyCode: ${c} (Inferred: ${!e.縣市代碼})`),c){let t=e["交易類型"]||n;r(`Calling API with: ${i}, ${t}, ${c}`);try{let s=await f.FH.fetchSubData(i,t,c);s.park&&Array.isArray(s.park)&&s.park.length>0?(r(`API Success: Found ${s.park.length} park records`),l=s.park.map(t=>({車位類別:t["車位類別"]||"-","車位價格(萬)":t["車位價格(萬)"]||(t["車位價格"]?(Number(t["車位價格"])/1e4).toFixed(2):"-"),"車位面積(坪)":t["車位面積(坪)"]||(t["車位面積"]?(Number(t["車位面積"])/3.30579).toFixed(2):"-"),車位樓層:t["車位樓層"]||t["車位所在樓層"]||"-",建案名稱:t["建案名稱"]||a,交易日:t["交易日"]||e["交易日"],備註:t["備註"]||"",_category:"車位資料(來自API)"}))):r("API Result: No park data found"),s.build&&Array.isArray(s.build)&&s.build.length>0?(r(`API Success: Found ${s.build.length} build records`),l=[...l,...s.build.map(e=>({...e,_category:"建物明細"}))]):r("API Result: No build data found"),s.land&&Array.isArray(s.land)&&s.land.length>0?(r(`API Success: Found ${s.land.length} land records`),l=[...l,...s.land.map(e=>({...e,"土地移轉總面積(坪)":e["土地移轉總面積(平方公尺)"]?(.3025*Number(e["土地移轉總面積(平方公尺)"])).toFixed(2):"-",土地位置:e["土地區段位置"]||e["土地位置"]||"-",_category:"土地明細"}))]):r("API Result: No land data found")}catch(e){console.warn("API fetchSubData failed, proceeding to fallback:",e),r(`API Error: ${String(e)} - Proceeding to fallback`)}}else r("Skip API: No County Code");if(0===l.length&&t?.parkingAnalysis?.rampPlanePriceByFloor){r("Check AnalysisData RawRecords...");let s=t.parkingAnalysis.rampPlanePriceByFloor,n=[],c=e=>String(e||"").replace(/[^a-zA-Z0-9]/g,"").toUpperCase(),o=c(i);for(let e of(r(`Normalized Target ID: ${o}`),s))if(e.rawRecords&&Array.isArray(e.rawRecords)){let t=e.rawRecords.filter(e=>{let t=c(e.transactionId),a=c(e["編號"]);return t===o||a===o});t.length>0&&n.push(...t.map(t=>({...t,floorFromBucket:e.floor})))}if(n.length>0)for(let t of(r(`AnalysisData: Found ${n.length} matches`),r(`Match Data: ${JSON.stringify(n[0]).substring(0,100)}...`),n))l.push({車位類別:t["車位類別"]||"坡道平面","車位價格(萬)":t.parkingPrice||t["車位價格(萬)"]||"-","車位面積(坪)":t.parkingArea||t["車位面積(坪)"]||"-",車位樓層:t["車位所在樓層"]||t.floorFromBucket||"-",建案名稱:t["建案名稱"]||a,交易日:t["交易日"]||e["交易日"],備註:t["備註"]||"",_category:"車位資料(來自分析數據)"});else r("AnalysisData: No matches found")}if(0===l.length){r("Fallback: Using Main Record");let t=e["車位數"]&&Number(e["車位數"])>0,s=e["車位總價"]||e["車位總價(萬)"];if(t||s){let t=e["車位總價(萬)"]?Number(e["車位總價(萬)"]):e["車位總價"]?(Number(e["車位總價"])/1e4).toFixed(2):"-",s=e["車位面積(坪)"]?Number(e["車位面積(坪)"]):e["車位面積"]?(Number(e["車位面積"])/3.30579).toFixed(2):"-";l.push({車位類別:e["車位類別"]||"無資料","車位價格(萬)":t,"車位面積(坪)":s,車位樓層:"-",建案名稱:a,交易日:e["交易日"],備註:e["備註"]||"",_category:"車位資料(來自交易明細)"})}else r("Fallback: No parking info in main record")}X(l),et(s)}catch(t){if(console.error("handleFetchSubTable error:",t),s.push(`Error: ${String(t)}`),et(s),e["車位數"]&&Number(e["車位數"])>0){let t=e["車位總價(萬)"]?Number(e["車位總價(萬)"]):e["車位總價"]?(Number(e["車位總價"])/1e4).toFixed(2):0,a=e["車位面積(坪)"]?Number(e["車位面積(坪)"]):e["車位面積"]?(Number(e["車位面積"])/3.30579).toFixed(2):0;X([{車位類別:e["車位類別"]||"無資料","車位價格(萬)":t,"車位面積(坪)":a,車位樓層:"-",_category:"車位資料(來自交易明細)"}])}else X([])}finally{Q(!1)}},eo=[{key:"行政區",label:"行政區",sortable:!0},{key:"建案名稱",label:"建案名稱",sortable:!0},{key:"交易日",label:"交易日",sortable:!0},{key:"交易筆棟數",label:"交易筆棟數",sortable:!1},{key:"主要用途",label:"主要用途",sortable:!1},{key:"建物型態",label:"建物型態",sortable:!1},{key:"戶型",label:"戶型",sortable:!0},{key:"樓層",label:"樓層",sortable:!0},{key:"房屋面積(坪)",label:"坪數",sortable:!0},{key:"房屋單價(萬)",label:"單價",sortable:!0}],ed=["編號","地址","總樓層","交易總價(萬)","房屋總價(萬)","車位總價(萬)","房數","廳數","衛浴數","備註","解約情形","戶別","主要用途","建物型態","車位類別","車位價格","車位面積","主建物面積","附屬建物面積","陽台面積","土地使用分區","地號","社區戶數"],ex=e=>{O(t=>{let a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},eh=e=>null==e||""===e?"-":"number"==typeof e?Number.isInteger(e)?e.toLocaleString():e.toFixed(2):String(e),em=(0,r.useMemo)(()=>{let e=[...C];if(J.trim()){let t=J.toLowerCase();e=e.filter(e=>{let a=e[W];return null!=a&&String(a).toLowerCase().includes(t)})}return B.key&&B.direction&&e.sort((e,t)=>{let a=e[B.key],s=t[B.key];if(null==a&&null==s)return 0;if(null==a)return 1;if(null==s)return -1;if("number"==typeof a&&"number"==typeof s)return"asc"===B.direction?a-s:s-a;let r=String(a),i=String(s);return"asc"===B.direction?r.localeCompare(i,"zh-TW"):i.localeCompare(r,"zh-TW")}),e},[C,J,W,B]),ep=Math.ceil(em.length/20),eu=(E-1)*20,eg=eu+20,ef=em.slice(eu,eg);return R?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-20",children:[(0,s.jsx)(o.A,{className:"h-8 w-8 animate-spin text-violet-500 mb-2"}),(0,s.jsx)("p",{className:"text-zinc-500 text-sm",children:"正在載入交易資料相關明細..."})]}):$?(0,s.jsxs)("div",{className:"text-center p-12 text-red-400",children:[(0,s.jsxs)("p",{children:["載入失敗: ",$]}),(0,s.jsx)("button",{onClick:()=>en(),className:"mt-4 px-4 py-2 bg-zinc-800 rounded hover:bg-zinc-700",children:"重試"})]}):C&&0!==C.length?(0,s.jsxs)("div",{className:"space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,s.jsxs)("div",{className:"flex flex-wrap gap-3 items-center p-3 bg-zinc-900/50 rounded-lg border border-white/5","data-report-control":"hide",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-[200px]",children:[(0,s.jsx)(d.A,{size:16,className:"text-zinc-500"}),(0,s.jsx)("input",{type:"text",value:J,onChange:e=>{U(e.target.value),L(1)},placeholder:`搜尋 ${W}...`,className:"flex-1 bg-transparent border-none outline-none text-white placeholder-zinc-500 text-sm"}),J&&(0,s.jsx)("button",{onClick:()=>U(""),className:"text-zinc-500 hover:text-white",children:(0,s.jsx)(x.A,{size:14})})]}),(0,s.jsxs)("select",{value:W,onChange:e=>H(e.target.value),className:Z,children:[(0,s.jsx)("option",{value:"建案名稱",children:"建案名稱"}),(0,s.jsx)("option",{value:"行政區",children:"行政區"}),(0,s.jsx)("option",{value:"戶型",children:"戶型"}),(0,s.jsx)("option",{value:"主要用途",children:"主要用途"})]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center text-sm text-zinc-400",children:[(0,s.jsxs)("span",{children:["共 ",(0,s.jsx)("span",{className:"text-white font-semibold",children:em.length.toLocaleString()})," 筆資料 ",J&&(0,s.jsx)("span",{className:"text-zinc-500",children:"(已篩選)"})]}),(0,s.jsxs)("span",{children:["第 ",E," / ",ep||1," 頁"]})]}),(0,s.jsxs)(i.c,{title:"交易資料明細",description:"點擊表頭可排序，點擊「明細」可展開詳細資訊",containerRef:er,headerAction:(0,s.jsx)(v.N,{data:em,filename:"transaction_list_data",label:"匯出",chartType:"data-list",targetRef:er}),children:[(0,s.jsx)("div",{className:"hidden md:block overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,s.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold sticky top-0",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-3 py-3 w-20 text-center","data-report-control":"hide",children:"操作"}),eo.map(e=>{var t;return(0,s.jsx)("th",{className:(0,u.cn)("px-3 py-3 text-left whitespace-nowrap",e.sortable&&"cursor-pointer select-none group hover:text-white transition-colors","建案名稱"===e.key&&"min-w-[120px] max-w-[200px] whitespace-normal","行政區"===e.key&&"w-20","交易日"===e.key&&"w-24",("房屋單價(萬)"===e.key||"房屋面積(坪)"===e.key)&&"text-right"),onClick:()=>{var t;return e.sortable&&(t=e.key,void(Y(e=>{if(e.key===t){if("asc"===e.direction)return{key:t,direction:"desc"};if("desc"===e.direction)return{key:"",direction:null}}return{key:t,direction:"asc"}}),L(1)))},children:(0,s.jsxs)("div",{className:(0,u.cn)("flex items-center gap-1",("房屋單價(萬)"===e.key||"房屋面積(坪)"===e.key)&&"justify-end"),children:[e.label,e.sortable&&(t=e.key,B.key!==t?(0,s.jsx)(n.A,{size:12,className:"opacity-30 group-hover:opacity-70"}):"asc"===B.direction?(0,s.jsx)(l.A,{size:12,className:"text-violet-400"}):(0,s.jsx)(c.A,{size:12,className:"text-violet-400"}))]})},e.key)})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-white/5",children:ef.map((e,t)=>{let a=eu+t,i=I.has(a);return(0,s.jsxs)(r.Fragment,{children:[(0,s.jsxs)("tr",{className:(0,u.cn)("hover:bg-zinc-800/50 transition-colors",i&&"bg-zinc-800/30"),children:[(0,s.jsx)("td",{className:"px-3 py-2","data-report-control":"hide",children:(0,s.jsxs)("div",{className:"flex items-center gap-2 justify-center",children:[(0,s.jsxs)("button",{onClick:()=>ec(e),className:"px-2 py-1 rounded text-xs font-medium bg-cyan-900/30 text-cyan-400 hover:bg-cyan-900/50 hover:text-cyan-300 transition-colors flex items-center gap-1 border border-cyan-800/50 active:scale-95",title:"查看車位或其他附表資料",children:[(0,s.jsx)(h.A,{size:12}),"附表"]}),(0,s.jsxs)("button",{onClick:()=>ex(a),className:(0,u.cn)("flex items-center gap-1 px-2 py-1 rounded text-xs font-medium transition-colors border active:scale-95",i?"bg-violet-500/20 text-violet-300 border-violet-500/30":"bg-zinc-800 text-zinc-400 border-zinc-700 hover:bg-zinc-700 hover:text-zinc-200"),children:[i?(0,s.jsx)(l.A,{size:12}):(0,s.jsx)(c.A,{size:12}),"明細"]})]})}),eo.map(t=>(0,s.jsx)("td",{className:(0,u.cn)("px-3 py-2","建案名稱"===t.key?"whitespace-normal min-w-[120px] max-w-[200px]":"whitespace-nowrap",("房屋單價(萬)"===t.key||"房屋面積(坪)"===t.key)&&"text-right"),children:"戶型"===t.key?(0,s.jsx)(N.Bc,{delayDuration:100,children:(0,s.jsxs)(N.m_,{children:[(0,s.jsx)(N.k$,{asChild:!0,children:(0,s.jsx)("span",{className:"cursor-help border-b border-dotted border-zinc-600 block truncate max-w-[80px]",children:eh(e[t.key])})}),(0,s.jsx)(N.ZI,{side:"top",className:"max-w-[200px]",children:(0,s.jsxs)("p",{className:"text-xs",children:["原始戶別: ",(0,s.jsx)("strong",{children:e["戶別"]||"無資料"})]})})]})}):"主要用途"===t.key?(0,s.jsx)("span",{className:"text-zinc-300",children:"見其他登記事項"===e["主要用途"]?"其他":eh(e[t.key])}):(0,s.jsx)("span",{className:(0,u.cn)("房屋單價(萬)"===t.key&&"font-mono text-violet-400 font-bold","建案名稱"===t.key&&"font-medium text-white text-sm leading-tight block","建案名稱"!==t.key&&"房屋單價(萬)"!==t.key&&"text-zinc-300"),children:eh(e[t.key])})},t.key))]}),i&&(0,s.jsx)("tr",{className:"bg-zinc-900/50","data-report-control":"hide",children:(0,s.jsx)("td",{colSpan:eo.length+1,className:"px-4 py-4",children:(0,s.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3",children:ed.map(t=>t in e?(0,s.jsxs)("div",{className:"bg-zinc-800/50 rounded p-2",children:[(0,s.jsx)("div",{className:"text-xs text-zinc-500 mb-1",children:t}),(0,s.jsx)("div",{className:"text-sm text-zinc-200 font-mono",children:eh(e[t])})]},t):null)})})})]},a)})})]})}),(0,s.jsxs)("div",{className:"md:hidden space-y-4",children:[ef.map((e,t)=>{let a=eu+t,r=I.has(a);return(0,s.jsxs)("div",{className:(0,u.cn)("bg-zinc-900/40 border border-white/5 rounded-xl overflow-hidden transition-all duration-200",r?"ring-1 ring-violet-500/30 bg-zinc-900/60":"hover:bg-zinc-900/60"),children:[(0,s.jsxs)("div",{className:"p-4",onClick:()=>ex(a),children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("span",{className:"text-xs font-medium px-1.5 py-0.5 rounded bg-zinc-800 text-zinc-400",children:e["行政區"]}),(0,s.jsx)("h3",{className:"text-base font-bold text-white leading-tight",children:e["建案名稱"]})]}),(0,s.jsxs)("div",{className:"text-xs text-zinc-500 font-mono",children:[e["交易日"]," • ",e["戶型"]||"-"]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("div",{className:"text-lg font-bold text-violet-400 font-mono leading-none",children:[eh(e["房屋單價(萬)"]),(0,s.jsx)("span",{className:"text-xs text-zinc-500 font-normal ml-0.5",children:"萬/坪"})]}),(0,s.jsxs)("div",{className:"text-xs text-zinc-500 mt-1",children:[eh(e["交易總價(萬)"])," 萬"]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-2 py-3 border-t border-white/5",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-[10px] text-zinc-500 mb-0.5",children:"樓層"}),(0,s.jsxs)("div",{className:"text-sm font-medium text-zinc-300",children:[eh(e["樓層"]),"F"]})]}),(0,s.jsxs)("div",{className:"text-center border-l border-white/5",children:[(0,s.jsx)("div",{className:"text-[10px] text-zinc-500 mb-0.5",children:"坪數"}),(0,s.jsx)("div",{className:"text-sm font-medium text-zinc-300",children:eh(e["房屋面積(坪)"])})]}),(0,s.jsxs)("div",{className:"text-center border-l border-white/5",children:[(0,s.jsx)("div",{className:"text-[10px] text-zinc-500 mb-0.5",children:"車位"}),(0,s.jsx)("div",{className:"text-sm font-medium text-zinc-300",children:eh(e["車位總價(萬)"])})]})]}),(0,s.jsxs)("div",{className:"flex gap-2 mt-2","data-report-control":"hide",children:[(0,s.jsxs)("button",{onClick:t=>{t.stopPropagation(),ec(e)},className:"flex-1 py-2 rounded-lg text-xs font-medium bg-cyan-900/20 text-cyan-400 border border-cyan-800/30 flex items-center justify-center gap-1.5 active:scale-[0.98] transition-all",children:[(0,s.jsx)(h.A,{size:14}),"查看附表"]}),(0,s.jsxs)("button",{onClick:e=>{e.stopPropagation(),ex(a)},className:(0,u.cn)("flex-1 py-2 rounded-lg text-xs font-medium border flex items-center justify-center gap-1.5 active:scale-[0.98] transition-all",r?"bg-violet-500/10 text-violet-300 border-violet-500/30":"bg-zinc-800/50 text-zinc-300 border-zinc-700"),children:[r?"收合明細":"顯示明細",r?(0,s.jsx)(l.A,{size:14}):(0,s.jsx)(c.A,{size:14})]})]})]}),r&&(0,s.jsx)("div",{className:"bg-zinc-950/50 border-t border-white/5 p-4 animate-accordion-down","data-report-control":"hide",children:(0,s.jsx)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3",children:ed.map(t=>t in e?(0,s.jsxs)("div",{className:"overflow-hidden",children:[(0,s.jsx)("div",{className:"text-[10px] text-zinc-500 truncate",children:t}),(0,s.jsx)("div",{className:"text-sm text-zinc-300 font-mono truncate",children:eh(e[t])})]},t):null)})})]},a)}),0===ef.length&&(0,s.jsx)("div",{className:"text-center py-12 text-zinc-500 bg-zinc-900/20 rounded-xl border border-dashed border-zinc-800",children:"無符合條件的資料"})]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t border-white/5",children:[(0,s.jsxs)("div",{className:"text-sm text-zinc-500",children:["顯示第 ",em.length>0?eu+1:0," - ",Math.min(eg,em.length)," 筆"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:()=>L(e=>Math.max(1,e-1)),disabled:1===E,className:"p-2 rounded bg-zinc-800 text-zinc-300 hover:bg-zinc-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,s.jsx)(m.A,{size:16})}),(0,s.jsx)("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,ep||1)},(e,t)=>{let a,r=ep||1;return(a=r<=5||E<=3?t+1:E>=r-2?r-4+t:E-2+t)<1||a>r?null:(0,s.jsx)("button",{onClick:()=>L(a),className:(0,u.cn)("w-8 h-8 rounded text-sm font-medium transition-colors",E===a?"bg-violet-500 text-white":"bg-zinc-800 text-zinc-400 hover:bg-zinc-700"),children:a},a)})}),(0,s.jsx)("button",{onClick:()=>L(e=>Math.min(ep||1,e+1)),disabled:E===ep||0===ep,className:"p-2 rounded bg-zinc-800 text-zinc-300 hover:bg-zinc-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,s.jsx)(p.A,{size:16})})]})]}),(0,s.jsx)(y.a,{isOpen:K,onClose:()=>q(!1),className:"max-w-5xl",title:(0,s.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(h.A,{className:"text-cyan-400"}),(0,s.jsx)("span",{children:ea})]}),(0,s.jsx)(v.N,{data:G,filename:`sub_table_${ea}`,label:"匯出附表",className:"ml-4"})]}),children:V?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,s.jsx)(o.A,{className:"h-8 w-8 animate-spin text-cyan-400 mb-3"}),(0,s.jsx)("p",{className:"text-zinc-500 text-sm animate-pulse",children:"正在讀取附表資料..."})]}):G.length>0?(0,s.jsxs)("div",{className:"space-y-8",children:[G.some(e=>e._category.includes("車位"))&&(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("h4",{className:"text-sm font-bold text-violet-400 flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-1 h-4 bg-violet-500 rounded-full"}),"車位明細"]}),(0,s.jsx)("div",{className:"bg-zinc-800/30 rounded-lg overflow-hidden border border-white/5",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,s.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-3 whitespace-nowrap bg-zinc-900 text-cyan-400",children:"來源"}),["車位類別","車位價格(萬)","車位面積(坪)","車位樓層","建案名稱","備註"].map(e=>(0,s.jsx)("th",{className:"px-4 py-3 whitespace-nowrap bg-zinc-900",children:e},e))]})}),(0,s.jsx)("tbody",{className:"divide-y divide-white/5",children:G.filter(e=>e._category.includes("車位")).map((e,t)=>(0,s.jsxs)("tr",{className:"hover:bg-zinc-800/50 transition-colors",children:[(0,s.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-cyan-400 font-medium text-xs",children:e._category.replace("車位資料","").replace(/[()]/g,"")||"API"}),["車位類別","車位價格(萬)","車位面積(坪)","車位樓層","建案名稱","備註"].map(t=>(0,s.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-zinc-300",children:eh(e[t])},t))]},t))})]})})})]}),G.some(e=>e._category.includes("建物"))&&(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("h4",{className:"text-sm font-bold text-emerald-400 flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-1 h-4 bg-emerald-500 rounded-full"}),"建物明細"]}),(0,s.jsx)("div",{className:"bg-zinc-800/30 rounded-lg overflow-hidden border border-white/5",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,s.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold",children:(0,s.jsx)("tr",{children:Array.from(new Set(G.filter(e=>e._category.includes("建物")).flatMap(Object.keys))).filter(e=>!["id","編號","created_at","_category","rawRecords"].includes(e)).map(e=>(0,s.jsx)("th",{className:"px-4 py-3 whitespace-nowrap bg-zinc-900",children:e},e))})}),(0,s.jsx)("tbody",{className:"divide-y divide-white/5",children:G.filter(e=>e._category.includes("建物")).map((e,t)=>(0,s.jsx)("tr",{className:"hover:bg-zinc-800/50 transition-colors",children:Array.from(new Set(G.filter(e=>e._category.includes("建物")).flatMap(Object.keys))).filter(e=>!["id","編號","created_at","_category","rawRecords"].includes(e)).map(t=>(0,s.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-zinc-300",children:eh(e[t])},t))},t))})]})})})]}),G.some(e=>e._category.includes("土地"))&&(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("h4",{className:"text-sm font-bold text-amber-400 flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-1 h-4 bg-amber-500 rounded-full"}),"土地明細"]}),(0,s.jsx)("div",{className:"bg-zinc-800/30 rounded-lg overflow-hidden border border-white/5",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,s.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold",children:(0,s.jsx)("tr",{children:Array.from(new Set(G.filter(e=>e._category.includes("土地")).flatMap(Object.keys))).filter(e=>!["id","編號","created_at","_category","rawRecords"].includes(e)).map(e=>(0,s.jsx)("th",{className:"px-4 py-3 whitespace-nowrap bg-zinc-900",children:e},e))})}),(0,s.jsx)("tbody",{className:"divide-y divide-white/5",children:G.filter(e=>e._category.includes("土地")).map((e,t)=>(0,s.jsx)("tr",{className:"hover:bg-zinc-800/50 transition-colors",children:Array.from(new Set(G.filter(e=>e._category.includes("土地")).flatMap(Object.keys))).filter(e=>!["id","編號","created_at","_category","rawRecords"].includes(e)).map(t=>(0,s.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-zinc-300",children:eh(e[t])},t))},t))})]})})})]}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)("button",{onClick:()=>q(!1),className:"px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-sm text-white rounded transition-colors",children:"關閉"})})]}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-zinc-500",children:[(0,s.jsx)("div",{className:"bg-zinc-800/50 p-4 rounded-full mb-3",children:(0,s.jsx)(h.A,{size:24,className:"opacity-20"})}),(0,s.jsx)("p",{children:"此筆交易沒有相關附表資料"})]})})]}):(0,s.jsx)("div",{className:"text-center p-12 text-zinc-500",children:"無交易資料可顯示"})}},33807:(e,t,a)=>{a.d(t,{J:()=>n});var s=a(95155),r=a(12115),i=a(40980);let n=r.forwardRef(({className:e,...t},a)=>(0,s.jsx)("label",{ref:a,className:(0,i.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",e),...t}));n.displayName="Label"},37847:(e,t,a)=>{a.d(t,{v:()=>z});var s=a(95155),r=a(12115),i=a(68605),n=a(97085),l=a(37717);function c({data:e}){let t=(0,l.A)(),a=(0,r.useMemo)(()=>e?[e.withParking.count,e.withoutParking.count]:[],[e]),i=(0,r.useMemo)(()=>({chart:{type:"donut",background:"transparent",foreColor:t.text},labels:["含車位","無車位"],colors:[t.chart[0],t.chart[3]],plotOptions:{pie:{donut:{labels:{show:!0,total:{show:!0,label:"總交易",color:t.text,formatter:e=>e.globals.seriesTotals.reduce((e,t)=>e+t,0).toLocaleString()+" 筆"}}}}},dataLabels:{enabled:!0,formatter:e=>`${e.toFixed(1)}%`},legend:{show:!1},tooltip:{theme:"dark",y:{formatter:e=>`${e} 筆`}},stroke:{show:!1},responsive:[{breakpoint:480,options:{chart:{width:300},legend:{position:"bottom"}}}]}),[t]);return e&&(0!==e.withParking.count||0!==e.withoutParking.count)?(0,s.jsx)(n.A,{type:"donut",series:a,options:i,height:350,className:"w-full"}):(0,s.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無車位配比資料"})}var o=a(40980);function d({data:e,xLabel:t,yLabel:a,xUnit:i="",yUnit:n="",title:l,highlightIds:c=[]}){let[d,x]=(0,r.useState)(null),[h,m]=(0,r.useState)(null),[p,u]=(0,r.useState)({x:0,y:0}),{xMin:g,xMax:f,yMin:b,yMax:j}=(0,r.useMemo)(()=>{if(0===e.length)return{xMin:0,xMax:100,yMin:0,yMax:100};let t=e.map(e=>e.x),a=e.map(e=>e.y),s=Math.min(...t),r=Math.max(...t),i=Math.min(...a),n=Math.max(...a),l=(r-s)*.1||1,c=(n-i)*.1||1;return{xMin:Math.max(0,s-l),xMax:r+l,yMin:Math.max(0,i-c),yMax:n+c}},[e]),y=c.length>0,v=e=>{let t=e.currentTarget.closest(".relative.bg-zinc-900\\/30")?.getBoundingClientRect();t&&u({x:e.clientX-t.left,y:e.clientY-t.top})},N=h||d,w=(0,r.useMemo)(()=>c.length?[...e].sort((e,t)=>!!c.includes(e.id)-!!c.includes(t.id)):e,[e,c]);return(0,s.jsxs)("div",{className:"w-full h-[400px] relative bg-zinc-900/30 rounded-xl border border-white/5 p-4 select-none cursor-crosshair",onClick:()=>{m(null),x(null)},onMouseMove:e=>{!h&&d&&v(e)},children:[l&&(0,s.jsx)("h4",{className:"absolute top-4 left-4 text-sm font-medium text-zinc-400 pointer-events-none",children:l}),(0,s.jsxs)("div",{className:"absolute inset-x-12 inset-y-12 pointer-events-none",children:[(0,s.jsx)("div",{className:"absolute inset-0 flex flex-col justify-between opacity-20",children:[0,.25,.5,.75,1].map(e=>(0,s.jsx)("div",{className:"w-full h-px border-t border-dashed border-zinc-500"},e))}),(0,s.jsx)("div",{className:"absolute inset-0 flex justify-between opacity-20",children:[0,.25,.5,.75,1].map(e=>(0,s.jsx)("div",{className:"h-full w-px border-l border-dashed border-zinc-500"},e))})]}),(0,s.jsx)("div",{className:"absolute inset-x-12 inset-y-12",children:w.map(e=>{var t,a;let r=(t=e.x,a=e.y,{left:`${(t-g)/(f-g)*100}%`,top:`${100-(a-b)/(j-b)*100}%`}),i=d?.id===e.id,n=h?.id===e.id,l=y&&c.includes(e.id),p="bg-cyan-500/60 hover:bg-cyan-400 z-10",u="";return y&&(l?(p="bg-yellow-400 shadow-[0_0_10px_rgba(250,204,21,0.6)] z-20",u="scale-125"):p="bg-zinc-700/30 z-0"),(i||n)&&(p="bg-cyan-400 shadow-[0_0_15px_rgba(34,211,238,0.8)] ring-2 ring-white z-30",u="scale-150",y&&l&&(p="bg-yellow-400 shadow-[0_0_15px_rgba(250,204,21,0.8)] ring-2 ring-white z-30")),(0,s.jsx)("div",{className:(0,o.cn)("absolute w-3 h-3 rounded-full cursor-pointer transition-all duration-300 transform -translate-x-1/2 -translate-y-1/2",p,u),style:{left:r.left,top:r.top},onMouseEnter:t=>{h||(!y||c.includes(e.id))&&(x(e),v(t))},onMouseLeave:()=>!h&&x(null),onClick:t=>{t.stopPropagation(),(!y||c.includes(e.id))&&(h?.id===e.id?(m(null),x(e)):(m(e),x(null),v(t)))}},e.id)})}),(0,s.jsxs)("div",{className:"absolute left-0 top-12 bottom-12 w-10 flex flex-col justify-between text-[10px] text-zinc-500 text-right pr-2 pointer-events-none",children:[(0,s.jsxs)("span",{children:[Math.round(j),n]}),(0,s.jsxs)("span",{children:[Math.round(b),n]})]}),(0,s.jsxs)("div",{className:"absolute left-12 right-12 bottom-4 h-6 flex justify-between text-[10px] text-zinc-500 pt-1 pointer-events-none",children:[(0,s.jsxs)("span",{children:[Math.round(g),i]}),(0,s.jsxs)("span",{children:[Math.round(f),i]})]}),(0,s.jsx)("div",{className:"absolute bottom-1 left-1/2 -translate-x-1/2 text-xs text-zinc-400 font-bold pointer-events-none",children:t}),(0,s.jsx)("div",{className:"absolute left-1 top-1/2 -translate-y-1/2 -rotate-90 text-xs text-zinc-400 font-bold pointer-events-none",children:a}),N&&(0,s.jsx)("div",{className:"absolute z-50 pointer-events-none",style:{left:p.x,top:p.y,transform:"translate(10px, 10px)"},children:(0,s.jsxs)("div",{className:"bg-zinc-950/90 border border-cyan-500/30 rounded-lg p-3 shadow-xl backdrop-blur-md w-48 animate-in zoom-in-95 fade-in duration-200",children:[(0,s.jsx)("div",{className:"text-sm font-bold text-white mb-1",children:N.label}),(0,s.jsxs)("div",{className:"space-y-1 text-xs text-zinc-400",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("span",{children:[t,":"]}),(0,s.jsxs)("span",{className:"text-cyan-400 font-mono",children:[N.x.toLocaleString()," ",i]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsxs)("span",{children:[a,":"]}),(0,s.jsxs)("span",{className:"text-cyan-400 font-mono",children:[N.y.toLocaleString()," ",n]})]})]})]})})]})}var x=a(47650),h=a(39430),m=a(80642);function p({data:e,selectedFloors:t,hoveredFloor:a,onHover:i,onToggle:n,onDetail:l,floorColors:c}){let d=[...e].sort((e,t)=>{let a=e=>"B1"===e?1:"B2"===e?2:"B3"===e?3:"B4"===e?4:e.includes("B5")?5:99;return a(e.floor)-a(t.floor)}),p=d.length>4?Math.max(.7,4/d.length):1,g=r.useRef(null),[f,b]=r.useState(!1);r.useEffect(()=>{b(!0)},[]);let j=d.find(e=>e.floor===a);return(0,s.jsxs)("div",{className:"w-full h-[600px] flex items-start justify-start relative perspective-container overflow-visible pl-12 lg:pl-24 -mt-12",onMouseMove:e=>{if(g.current){let t=e.clientX+12,a=e.clientY+12;g.current.style.transform=`translate3d(${t}px, ${a}px, 0)`}},children:[(0,s.jsx)("div",{className:"relative flex items-center justify-center preserve-3d",style:{width:240,height:240,perspective:"3000px",transformStyle:"preserve-3d",zIndex:10,transform:`scale(${p})`},children:(0,s.jsx)(h.P.div,{className:"relative preserve-3d",initial:{rotateX:60,rotateZ:45},animate:{rotateX:60,rotateZ:45},transition:{duration:.8,ease:"easeOut"},style:{transformStyle:"preserve-3d",width:"100%",height:"100%"},children:(0,s.jsx)(m.N,{children:d.map((e,r)=>{let n=t.includes(e.floor),o=a===e.floor,x=c[e.floor]||"#71717a";return(0,s.jsx)(u,{data:e,color:x,isSelected:n,isHovered:o,active:n,onHover:()=>i(e.floor),onLeave:()=>i(null),onDetail:()=>l(e.floor),zIndex:d.length-r,baseZ:-(110*r),thickness:40},e.floor)})})})}),f&&(0,x.createPortal)((0,s.jsx)("div",{className:"fixed inset-0 pointer-events-none z-[9999]",children:(0,s.jsx)(m.N,{children:j&&(0,s.jsx)("div",{ref:g,className:"absolute top-0 left-0 will-change-transform",style:{transform:"translate3d(-500px, -500px, 0)"},children:(0,s.jsx)(h.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95,transition:{duration:.1}},transition:{type:"spring",stiffness:400,damping:25},className:"flex items-center justify-start",children:(0,s.jsxs)("div",{className:"flex items-center gap-3 whitespace-nowrap",children:[(0,s.jsx)("span",{className:(0,o.cn)("text-6xl font-black text-white drop-shadow-[0_5px_8px_rgba(0,0,0,0.8)] leading-none","font-sans italic tracking-tighter"),style:{textShadow:"0 0 30px rgba(255,255,255,0.4)"},children:j.floor}),(0,s.jsxs)("div",{className:"bg-zinc-950/95 border-l-4 border-cyan-500 backdrop-blur-xl px-4 py-2 rounded-r-lg shadow-[0_20px_50px_rgba(0,0,0,0.5)] flex items-center gap-6 border border-white/10",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-[10px] text-zinc-500 uppercase font-black leading-none mb-1 tracking-widest",children:"均價 (萬)"}),(0,s.jsx)("div",{className:"text-2xl font-mono font-bold text-cyan-400 leading-none",children:Math.round(j.avgPrice).toLocaleString()})]}),(0,s.jsx)("div",{className:"h-8 w-px bg-white/10"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-[10px] text-zinc-500 uppercase font-black leading-none mb-1 tracking-widest",children:"成交量"}),(0,s.jsx)("div",{className:"text-xl font-mono text-zinc-100 leading-none font-medium",children:j.count})]})]})]})},"tooltip")})})}),document.body)]})}function u({data:e,color:t,isSelected:a,isHovered:r,active:i,onHover:n,onLeave:l,onDetail:c,zIndex:d,baseZ:x,thickness:m}){let p=r?t:"#52525b";return(0,s.jsxs)(h.P.div,{className:(0,o.cn)("absolute top-0 left-0 w-full h-full preserve-3d pointer-events-none",!i&&"pointer-events-none"),initial:{scale:.9,opacity:0},animate:{translateZ:x+0,scale:+!!i,opacity:+!!i},transition:{type:"spring",stiffness:600,damping:15},style:{transformStyle:"preserve-3d",zIndex:d},children:[(0,s.jsx)("div",{className:"absolute inset-0 rounded-sm overflow-hidden transition-all duration-75 pointer-events-auto cursor-pointer",style:{backgroundColor:p,backgroundImage:r?"linear-gradient(135deg, rgba(255,255,255,0.6) 0%, rgba(255,255,255,0.1) 50%, rgba(0,0,0,0.2) 100%)":"linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.05) 50%, rgba(0,0,0,0.1) 100%)",filter:r?"none":"brightness(1.1)",boxShadow:r?`inset 0 0 0 1px rgba(255,255,255,0.4), 0 0 30px -5px ${t}`:"inset 0 0 0 1px rgba(255,255,255,0.1)"},onMouseEnter:n,onMouseLeave:l,onClick:e=>{e.stopPropagation(),c()},children:(0,s.jsx)(h.P.div,{initial:{x:"-100%"},animate:r?{x:"200%"}:{x:"-100%"},transition:{duration:1.5,repeat:1/0,repeatDelay:1},className:"absolute top-0 left-0 w-1/2 h-full bg-gradient-to-r from-transparent via-white/20 to-transparent skew-x-12 pointer-events-none"})}),(0,s.jsx)("div",{className:"absolute top-0 origin-top-right transition-all duration-75 pointer-events-auto cursor-pointer",style:{right:0,width:m,height:"100%",backgroundColor:p,filter:r?"brightness(0.6)":"brightness(0.5)",left:"100%",transformOrigin:"left center",transform:"rotateY(90deg)"},onMouseEnter:n,onMouseLeave:l,onClick:e=>{e.stopPropagation(),c()}}),(0,s.jsx)("div",{className:"absolute left-0 origin-bottom-left transition-all duration-75 pointer-events-auto cursor-pointer",style:{bottom:0,width:"100%",height:m,backgroundColor:p,filter:r?"brightness(0.8)":"brightness(0.3)",top:"100%",transformOrigin:"top center",transform:"rotateX(-90deg)"},onMouseEnter:n,onMouseLeave:l,onClick:e=>{e.stopPropagation(),c()}})]})}var g=a(94961),f=a(94514),b=a(57420),j=a(61878),y=a(51806),v=a(89733),N=a(9505);function w({chartData:e,hasData:t,summaryStats:a}){let[i,n]=(0,r.useState)("scale"),[l,c]=(0,r.useState)(null);r.useRef(null);let[x,h]=(0,r.useState)([]);if(!t)return(0,s.jsx)("p",{className:"text-zinc-500 text-center py-4",children:"無坡道平面車位坪數資料"});let m="scale"===i?e.map(e=>({id:e.id,label:e.id,x:e.count,y:e.avgArea})):e.map(e=>({id:e.id,label:e.id,x:e.avgPrice,y:e.avgArea}));return(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 relative","data-report-control":"allow",children:[l&&(0,s.jsxs)("div",{className:"fixed z-50 px-3 py-2 bg-zinc-900 border border-white/10 rounded-lg shadow-xl text-xs text-zinc-300 pointer-events-none transform -translate-x-1/2 -translate-y-full animate-in fade-in zoom-in-95",style:{left:l.x,top:l.y},children:[l.text,(0,s.jsx)("div",{className:"absolute left-1/2 bottom-0 w-2 h-2 bg-zinc-900 border-r border-b border-white/10 text-zinc-900 transform rotate-45 -translate-x-1/2 -mb-1"})]}),(0,s.jsxs)("div",{className:"lg:col-span-1 space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-zinc-400 pl-1 border-l-2 border-cyan-500",children:"總體統計數據"}),(0,s.jsx)("div",{className:"bg-zinc-900/30 rounded-xl border border-white/5 p-4",children:(0,s.jsx)("table",{className:"w-full text-sm",children:(0,s.jsxs)("tbody",{className:"divide-y divide-white/5",children:[(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"py-3 text-zinc-500",children:"數據範圍"}),(0,s.jsxs)("td",{className:"py-3 text-right font-mono text-white",children:[(0,s.jsx)("span",{className:"text-cyan-400",children:e.length})," 建案",(0,s.jsx)("span",{className:"mx-1 text-zinc-600",children:"/"}),(0,s.jsx)("span",{className:"text-zinc-300",children:a.count.toLocaleString()})," 車位"]})]}),(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"py-3 text-zinc-500",children:"平均坪數"}),(0,s.jsxs)("td",{className:"py-3 text-right font-mono text-cyan-400 text-lg font-bold",children:[a.avgArea.toFixed(2)," ",(0,s.jsx)("span",{className:"text-xs font-normal text-zinc-500",children:"坪"})]})]}),(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"py-3 text-zinc-500",children:"坪數中位數"}),(0,s.jsxs)("td",{className:"py-3 text-right font-mono text-zinc-300 text-lg font-bold",children:[a.medianArea.toFixed(2)," ",(0,s.jsx)("span",{className:"text-xs font-normal text-zinc-500",children:"坪"})]})]})]})})})]}),(0,s.jsx)(N.l,{projects:e.map(e=>({value:e.id,label:e.id})),className:"w-full",onChange:e=>h(e),max:6})]}),(0,s.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-zinc-400 pl-1 border-l-2 border-violet-500",children:"分佈散佈圖"}),(0,s.jsx)("div",{className:"mt-1 text-xs text-zinc-500 font-mono",children:"scale"===i?(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{className:"text-cyan-400",children:"X軸"}),": 建案車位總數 ",(0,s.jsx)("span",{className:"text-zinc-600",children:"|"})," ",(0,s.jsx)("span",{className:"text-cyan-400",children:"Y軸"}),": 平均車位坪數"]}):(0,s.jsxs)("span",{children:[(0,s.jsx)("span",{className:"text-cyan-400",children:"X軸"}),": 平均車位價格 ",(0,s.jsx)("span",{className:"text-zinc-600",children:"|"})," ",(0,s.jsx)("span",{className:"text-cyan-400",children:"Y軸"}),": 平均車位坪數"]})})]}),(0,s.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsx)("button",{className:"p-1.5 text-zinc-500 hover:text-cyan-400 transition-colors",children:(0,s.jsx)(g.A,{size:14})}),(0,s.jsx)("div",{className:"absolute right-0 top-full mt-2 w-64 p-3 bg-zinc-900 border border-white/10 rounded-lg shadow-xl z-50 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:(0,s.jsx)("div",{className:"text-xs text-zinc-300 leading-relaxed",children:"scale"===i?"分析各建案「規劃車位總數」與「平均車位坪數」的關係。可觀察大社區是否傾向規劃較大或較小的車位。":"分析各建案「平均車位價格」與「平均車位坪數」的關係。可觀察車位價格是否隨著坪數增加而顯著提升。"})})]}),(0,s.jsx)("div",{className:"w-px h-4 bg-white/10 mx-1"}),(0,s.jsx)("button",{onClick:()=>n("scale"),className:(0,o.cn)("px-3 py-1.5 text-xs font-medium rounded-md border transition-all duration-200","scale"===i?"bg-cyan-500/10 text-cyan-400 border-cyan-500/50 shadow-[0_0_10px_rgba(34,211,238,0.1)]":"bg-zinc-900/50 border-white/10 text-zinc-500 hover:text-zinc-300 hover:bg-white/5"),children:"規模分析"}),(0,s.jsx)("button",{onClick:()=>n("value"),className:(0,o.cn)("px-3 py-1.5 text-xs font-medium rounded-md border transition-all duration-200","value"===i?"bg-cyan-500/10 text-cyan-400 border-cyan-500/50 shadow-[0_0_10px_rgba(34,211,238,0.1)]":"bg-zinc-900/50 border-white/10 text-zinc-500 hover:text-zinc-300 hover:bg-white/5"),children:"價值分析"})]})]}),(0,s.jsx)(d,{data:m,xLabel:"scale"===i?"建案車位總數":"平均車位價格",yLabel:"平均車位坪數",xUnit:"scale"===i?"位":"萬",yUnit:"坪",title:"scale"===i?"建案規模 vs 車位坪數分佈":"車位價值 vs 坪數分佈",highlightIds:x})]})]})}function z({data:e,visibleSections:t=["ratio","price","scatter","floor"]}){let[a,n]=(0,r.useState)(["B1","B2","B3","B4"]),[l,d]=(0,r.useState)(null),x=r.useRef(null),h=r.useRef(null),m=r.useRef(null),u=r.useRef(null),[g,N]=(0,r.useState)(!1),[z,k]=(0,r.useState)(null),[S,_]=(0,r.useState)([]),[P,A]=(0,r.useState)(!1),[M,C]=(0,r.useState)(0),F=(t,a=!0)=>{k(t),A(!1);let s=$?.find(e=>e.floor===t),r=s?.rawRecords;if(r&&r.length>0){let e=r.map(e=>({...e,_isMatch:!0}));e.sort((e,t)=>{let a=e["交易年月日"]||0;return(t["交易年月日"]||0)-a}),_(e),C(e.length)}else{let a=e?.transactionDetails||[],s=[t];"B1"===t&&s.push("地下一層","B1","b1"),"B2"===t&&s.push("地下二層","B2","b2"),"B3"===t&&s.push("地下三層","B3","b3"),"B4"===t&&s.push("地下四層","B4","b4"),"B5_below"===t&&s.push("地下五層","B5","b5");let r=a.filter(e=>(e["車位類別"]||"").includes("坡道平面")),i=r.filter(e=>{let t=e["車位所在樓層"]||"",a=e["備註"]||"";return s.some(e=>t&&t.includes(e)||a&&a.includes(e))});C(i.length);let n=r.map(e=>{let t=e["車位所在樓層"]||"",a=e["備註"]||"",r=s.some(e=>t&&t.includes(e)||a&&a.includes(e));return{...e,_isMatch:r}});n.sort((e,t)=>{if(e._isMatch&&!t._isMatch)return -1;if(!e._isMatch&&t._isMatch)return 1;let a=e["交易年月日"]||0;return(t["交易年月日"]||0)-a}),_(n),0===i.length&&A(!0)}a&&N(!0)};if(!e?.parkingAnalysis)return null;let{parkingRatio:R,avgPriceByType:T,rampPlanePriceByFloor:$}=e.parkingAnalysis,D=["B1","B2","B3","B4","B5_below","Unknown"],E=$?.filter(e=>D.includes(e.floor)&&e.count>0)||[],L=t.includes("ratio"),I=t.includes("price"),O=t.includes("scatter"),B=t.includes("floor"),Y=t.includes("floor-detail")&&!L&&!I&&!O&&!B;r.useEffect(()=>{if(!Y||z)return;let e=E[0]?.floor||"B1";e&&F(e,!1)},[Y,z,E]);let J=(0,r.useMemo)(()=>(function(e,t){let a=[];if(e.forEach(e=>{t.includes(e.floor)&&e.rawRecords&&e.rawRecords.forEach(e=>{"number"!=typeof e.parkingPrice||isNaN(e.parkingPrice)||a.push(e.parkingPrice)})}),0===a.length)return{avgPrice:0,medianPrice:0,q3Price:0,count:0};a.sort((e,t)=>e-t);let s=a.reduce((e,t)=>e+t,0)/a.length,r=a[Math.floor(a.length/2)],i=Math.floor(.75*a.length),n=a[i]||r;return{avgPrice:s,medianPrice:r,q3Price:n,count:a.length}})(E,a),[E,a]),U=(0,r.useCallback)(e=>{n(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),W=(0,r.useCallback)(()=>{a.length===D.length?n([]):n([...D])},[a.length]),H=()=>(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 bg-zinc-800/50 p-1 rounded-lg border border-white/10",children:[(0,s.jsxs)("button",{onClick:()=>A(!1),className:(0,o.cn)("px-3 py-1.5 rounded text-xs transition-colors font-medium flex items-center gap-1.5",P?"text-zinc-500 hover:text-zinc-300 hover:bg-white/5":"bg-cyan-500/20 text-cyan-400 border border-cyan-500/30 shadow-[0_0_10px_rgba(34,211,238,0.1)]"),children:[(0,s.jsx)(f.A,{size:12}),"精確匹配 (",M,")"]}),(0,s.jsxs)("button",{onClick:()=>A(!0),className:(0,o.cn)("px-3 py-1.5 rounded text-xs transition-colors font-medium",P?"bg-rose-500/20 text-rose-400 border border-rose-500/30 shadow-[0_0_10px_rgba(244,63,94,0.1)]":"text-zinc-500 hover:text-zinc-300 hover:bg-white/5"),children:["未匹配 (",S.length-M,")"]}),(0,s.jsx)("div",{className:"ml-auto",children:(0,s.jsx)(v.N,{data:S.filter(e=>P?!e._isMatch:e._isMatch),filename:`parking_details_${z||"floor"}_${P?"all":"match"}`,label:"匯出明細"})})]}),(0,s.jsx)("div",{className:"overflow-x-auto rounded-lg border border-white/10 max-h-[60vh] custom-scrollbar",children:(0,s.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,s.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 whitespace-nowrap sticky top-0 z-10 backdrop-blur-md",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-3",children:"建案名稱"}),(0,s.jsx)("th",{className:"p-3",children:"交易日期"}),(0,s.jsx)("th",{className:"p-3 text-right",children:"車位總價"}),(0,s.jsx)("th",{className:"p-3 text-right",children:"車位面積"}),(0,s.jsx)("th",{className:"p-3",children:"車位樓層"}),(0,s.jsx)("th",{className:"p-3",children:"備註"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-white/5",children:S.length>0?S.filter(e=>P?!e._isMatch:e._isMatch).map((e,t)=>(0,s.jsxs)("tr",{className:(0,o.cn)("hover:bg-zinc-800/50 transition-colors",e._isMatch?"bg-cyan-500/5":"opacity-60"),children:[(0,s.jsxs)("td",{className:"p-3 font-medium text-white",children:[(0,s.jsx)("div",{children:e["建案名稱"]}),(0,s.jsxs)("div",{className:"text-[10px] text-zinc-600 font-mono mt-0.5",children:["#",e.transactionId||e["編號"]]})]}),(0,s.jsxs)("td",{className:"p-3 text-zinc-400 flex items-center gap-1",children:[(0,s.jsx)(b.A,{size:12,className:"text-zinc-600"}),e["交易日"]]}),(0,s.jsxs)("td",{className:"p-3 text-right font-mono text-cyan-400",children:[e["車位總價元"]?(e["車位總價元"]/1e4).toLocaleString():"-"," 萬"]}),(0,s.jsxs)("td",{className:"p-3 text-right font-mono text-zinc-300",children:[e["車位移轉總面積平方公尺"]?(.3025*e["車位移轉總面積平方公尺"]).toFixed(2):"-"," 坪"]}),(0,s.jsx)("td",{className:"p-3 text-zinc-300",children:e["車位所在樓層"]||"-"}),(0,s.jsx)("td",{className:"p-3 text-zinc-500 text-xs max-w-[200px] truncate",title:e["備註"],children:e["備註"]})]},t)):(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:6,className:"p-8 text-center text-zinc-500",children:"查無相關交易資料。"})})})]})})]}),Z={B1:"#06b6d4",B2:"#3b82f6",B3:"#6366f1",B4:"#8b5cf6",B5_below:"#a855f7",Unknown:"#71717a"},{parkingChartData:K,parkingChartStats:q,hasParkingData:G}=(0,r.useMemo)(()=>{let e=new Map,t=!1;E.forEach(a=>{a.rawRecords&&a.rawRecords.forEach(a=>{let s=a["建案名稱"],r=a.parkingArea||a["車位面積(坪)"]||.3025*(a["車位移轉總面積平方公尺"]||0),i=a.parkingPrice||a["車位價格(萬)"]||0;if(s&&r>0){e.has(s)||e.set(s,{count:0,totalArea:0,totalPrice:0});let a=e.get(s);a.count+=1,a.totalArea+=r,a.totalPrice+=i,t=!0}})});let a=Array.from(e.entries()).map(([e,t])=>({id:e,label:e,avgArea:parseFloat((t.totalArea/t.count).toFixed(2)),count:t.count,avgPrice:parseFloat((t.totalPrice/t.count).toFixed(2))})),s=0,r=[];a.forEach(e=>{s+=e.count,r.push(e.avgArea)}),r.sort((e,t)=>e-t);let i=r.length>0?r.reduce((e,t)=>e+t,0)/r.length:0,n=r.length>0?r[Math.floor(r.length/2)]:0;return{parkingChartData:a,parkingChartStats:{count:s,avgArea:i,medianArea:n},hasParkingData:t}},[E]);return Y?(0,s.jsx)("div",{className:"space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500 text-white",children:H()}):(0,s.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500 text-white",children:[L&&I?(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsx)(i.c,{title:"房車配比分析",description:"建案有購置車位的比例",containerRef:x,headerAction:(0,s.jsx)(v.N,{data:[{type:"有車位",...R?.withParking},{type:"無車位",...R?.withoutParking},{ratio:R?.avgRatio}],filename:"parking_ratio_data",label:"匯出",columns:{type:"類別",count:"數量",percentage:"百分比",ratio:"比率"},chartType:"parking-pie",targetRef:x,snapshotData:[{type:"有車位",...R?.withParking},{type:"無車位",...R?.withoutParking},{ratio:R?.avgRatio}]}),children:(0,s.jsxs)("div",{className:"flex flex-col md:flex-row items-start gap-6",children:[(0,s.jsx)("div",{className:"w-full md:w-1/2",children:(0,s.jsx)(c,{data:R})}),(0,s.jsx)("div",{className:"w-full md:w-1/2 flex flex-col gap-4",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-zinc-900/50 text-zinc-500",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-2 text-left",children:"類型"}),(0,s.jsx)("th",{className:"p-2 text-right",children:"筆數"}),(0,s.jsx)("th",{className:"p-2 text-right",children:"佔比"})]})}),(0,s.jsxs)("tbody",{className:"divide-y divide-white/5",children:[(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{className:"p-2 flex items-center gap-2",children:[(0,s.jsx)("span",{className:"w-3 h-3 rounded-full bg-indigo-300"}),"有搭車位"]}),(0,s.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:R?.withParking?.count.toLocaleString()}),(0,s.jsxs)("td",{className:"p-2 text-right font-mono text-cyan-400",children:[R?.withParking?.percentage.toFixed(2),"%"]})]}),(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{className:"p-2 flex items-center gap-2",children:[(0,s.jsx)("span",{className:"w-3 h-3 rounded-full bg-gray-600"}),"無車位"]}),(0,s.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:R?.withoutParking?.count.toLocaleString()}),(0,s.jsxs)("td",{className:"p-2 text-right font-mono text-zinc-500",children:[R?.withoutParking?.percentage.toFixed(2),"%"]})]})]})]})})]})}),(0,s.jsx)(i.c,{title:"車位類型均價",description:"各類車位成交行情",containerRef:h,headerAction:(0,s.jsx)(v.N,{data:T||[],filename:"parking_price_by_type",label:"匯出",columns:{type:"車位類型",avgPrice:"平均價格",medianPrice:"中位數",count:"數量"},chartType:"parking-price",targetRef:h,snapshotData:T||[]}),children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-zinc-900/50 text-zinc-500",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-2 text-left",children:"類型"}),(0,s.jsx)("th",{className:"p-2 text-right",children:"均價(萬)"}),(0,s.jsx)("th",{className:"p-2 text-right",children:"中位數"}),(0,s.jsx)("th",{className:"p-2 text-right",children:"總數"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-white/5",children:T?.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-zinc-800/50",children:[(0,s.jsx)("td",{className:"p-2 font-medium",children:e.type}),(0,s.jsx)("td",{className:"p-2 text-right font-mono text-cyan-400",children:Math.round(e.avgPrice).toLocaleString()}),(0,s.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:Math.round(e.medianPrice).toLocaleString()}),(0,s.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:e.count.toLocaleString()})]},e.type))})]})})]}):(0,s.jsxs)(s.Fragment,{children:[L&&(0,s.jsx)(i.c,{title:"房車配比分析",description:"建案有購置車位的比例",containerRef:x,headerAction:(0,s.jsx)(v.N,{data:[{type:"有車位",...R?.withParking},{type:"無車位",...R?.withoutParking},{ratio:R?.avgRatio}],filename:"parking_ratio_data",label:"匯出",columns:{type:"類別",count:"數量",percentage:"百分比",ratio:"比率"},chartType:"parking-pie",targetRef:x,snapshotData:[{type:"有車位",...R?.withParking},{type:"無車位",...R?.withoutParking},{ratio:R?.avgRatio}]}),children:(0,s.jsxs)("div",{className:"flex flex-col md:flex-row items-start gap-6",children:[(0,s.jsx)("div",{className:"w-full md:w-1/2",children:(0,s.jsx)(c,{data:R})}),(0,s.jsx)("div",{className:"w-full md:w-1/2 flex flex-col gap-4",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-zinc-900/50 text-zinc-500",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-2 text-left",children:"類型"}),(0,s.jsx)("th",{className:"p-2 text-right",children:"筆數"}),(0,s.jsx)("th",{className:"p-2 text-right",children:"佔比"})]})}),(0,s.jsxs)("tbody",{className:"divide-y divide-white/5",children:[(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{className:"p-2 flex items-center gap-2",children:[(0,s.jsx)("span",{className:"w-3 h-3 rounded-full bg-indigo-300"}),"有搭車位"]}),(0,s.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:R?.withParking?.count.toLocaleString()}),(0,s.jsxs)("td",{className:"p-2 text-right font-mono text-cyan-400",children:[R?.withParking?.percentage.toFixed(2),"%"]})]}),(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{className:"p-2 flex items-center gap-2",children:[(0,s.jsx)("span",{className:"w-3 h-3 rounded-full bg-gray-600"}),"無車位"]}),(0,s.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:R?.withoutParking?.count.toLocaleString()}),(0,s.jsxs)("td",{className:"p-2 text-right font-mono text-zinc-500",children:[R?.withoutParking?.percentage.toFixed(2),"%"]})]})]})]})})]})}),I&&(0,s.jsx)(i.c,{title:"車位類型均價",description:"各類車位成交行情",containerRef:h,headerAction:(0,s.jsx)(v.N,{data:T||[],filename:"parking_price_by_type",label:"匯出",columns:{type:"車位類型",avgPrice:"平均價格",medianPrice:"中位數",count:"數量"},chartType:"parking-price",targetRef:h,snapshotData:T||[]}),children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-zinc-900/50 text-zinc-500",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-2 text-left",children:"類型"}),(0,s.jsx)("th",{className:"p-2 text-right",children:"均價(萬)"}),(0,s.jsx)("th",{className:"p-2 text-right",children:"中位數"}),(0,s.jsx)("th",{className:"p-2 text-right",children:"總數"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-white/5",children:T?.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-zinc-800/50",children:[(0,s.jsx)("td",{className:"p-2 font-medium",children:e.type}),(0,s.jsx)("td",{className:"p-2 text-right font-mono text-cyan-400",children:Math.round(e.avgPrice).toLocaleString()}),(0,s.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:Math.round(e.medianPrice).toLocaleString()}),(0,s.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:e.count.toLocaleString()})]},e.type))})]})})]}),O&&(0,s.jsx)(i.c,{title:"坡道平面車位坪數散佈分析",description:"建案車位數與坪數分佈",className:"relative z-20",containerRef:m,headerAction:(0,s.jsx)(v.N,{data:K||[],filename:"parking_area_scatter_data",label:"匯出",columns:{id:"建案名稱",label:"標籤",avgArea:"平均坪數",count:"車位數",avgPrice:"平均價格"},chartType:"parking-scatter",targetRef:m,snapshotData:K||[]}),children:(0,s.jsx)(w,{chartData:K,hasData:G,summaryStats:q})}),B&&(0,s.jsx)(i.c,{title:"坡道平面車位 - 樓層價差分析",description:"勾選樓層以動態更新統計數據",containerRef:u,headerAction:(0,s.jsx)(v.N,{data:E||[],filename:"parking_floor_analysis",label:"匯出",columns:{floor:"樓層",count:"數量",avgPrice:"平均價格",medianPrice:"中位數",maxPrice:"最高價",minPrice:"最低價",q3Price:"第三四分位數"},chartType:"parking-floor",targetRef:u,snapshotData:E||[]}),children:(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 bg-zinc-900/10 rounded-xl relative overflow-visible min-h-[450px]",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-zinc-900/0 via-zinc-900/20 to-zinc-900/0 pointer-events-none"}),(0,s.jsx)(p,{data:E,selectedFloors:a,hoveredFloor:l,onHover:d,onToggle:U,onDetail:e=>F(e),floorColors:Z}),(0,s.jsx)("div",{className:"absolute bottom-4 left-0 w-full text-center text-zinc-600 text-xs pointer-events-none",children:"點擊方塊選取 • 懸停查看詳情"})]}),(0,s.jsx)(y.a,{isOpen:g,onClose:()=>N(!1),title:`${z} 車位交易明細`,maxWidth:"max-w-5xl",children:H()}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"p-4 bg-gradient-to-r from-cyan-500/10 to-violet-500/10 border border-cyan-500/30 rounded-lg",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-cyan-400 mb-3",children:"已選樓層統計"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-zinc-500",children:"車位數"}),(0,s.jsx)("div",{className:"text-lg font-bold text-white",children:J.count.toLocaleString()})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-zinc-500",children:"平均單價"}),(0,s.jsxs)("div",{className:"text-lg font-bold text-cyan-400",children:[Math.round(J.avgPrice).toLocaleString()," 萬"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-zinc-500",children:"中位數"}),(0,s.jsxs)("div",{className:"text-lg font-bold text-zinc-300",children:[Math.round(J.medianPrice).toLocaleString()," 萬"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-zinc-500",children:"3/4位數"}),(0,s.jsxs)("div",{className:"text-lg font-bold text-zinc-300",children:[Math.round(J.q3Price).toLocaleString()," 萬"]})]})]})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-zinc-900/50 text-zinc-500",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-2 text-left",children:(0,s.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:a.length===D.length,onChange:W,className:"form-checkbox rounded bg-zinc-800 border-zinc-600 text-cyan-500"}),(0,s.jsx)("span",{children:"全選"})]})}),(0,s.jsx)("th",{className:"p-2 text-left",children:"樓層"}),(0,s.jsx)("th",{className:"p-2 text-right",children:"均價(萬)"}),(0,s.jsx)("th",{className:"p-2 text-right",children:"中位數"}),(0,s.jsx)("th",{className:"p-2 text-right",children:"最高"}),(0,s.jsx)("th",{className:"p-2 text-right",children:"最低"}),(0,s.jsx)("th",{className:"p-2 text-right",children:"車位數"}),(0,s.jsx)("th",{className:"p-2 text-center",children:"操作"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-white/5",children:E.map(e=>{let t=a.includes(e.floor),r=l===e.floor;return(0,s.jsxs)("tr",{onMouseEnter:()=>d(e.floor),onMouseLeave:()=>d(null),className:(0,o.cn)("transition-colors cursor-pointer",r?"bg-zinc-800":"hover:bg-zinc-800/50",!t&&"opacity-50"),onClick:()=>U(e.floor),children:[(0,s.jsx)("td",{className:"p-2",children:(0,s.jsx)("input",{type:"checkbox",checked:t,onChange:()=>U(e.floor),className:"form-checkbox rounded bg-zinc-800 border-zinc-600 text-cyan-500",onClick:e=>e.stopPropagation()})}),(0,s.jsx)("td",{className:"p-2 font-medium",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:Z[e.floor]}}),e.floor]})}),(0,s.jsx)("td",{className:"p-2 text-right font-mono text-cyan-400",children:Math.round(e.avgPrice).toLocaleString()}),(0,s.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:Math.round(e.medianPrice).toLocaleString()}),(0,s.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:Math.round(e.maxPrice).toLocaleString()}),(0,s.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:Math.round(e.minPrice).toLocaleString()}),(0,s.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:e.count.toLocaleString()}),(0,s.jsx)("td",{className:"p-2 text-center",children:(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),F(e.floor)},className:"p-1.5 rounded-full hover:bg-cyan-500/20 text-zinc-400 hover:text-cyan-400 transition-colors",title:"查看明細",children:(0,s.jsx)(j.A,{size:14})})})]},e.floor)})})]})})]})]})})]})}},51806:(e,t,a)=>{a.d(t,{a:()=>l});var s=a(95155);a(12115);var r=a(33210),i=a(40980),n=a(81477);function l({isOpen:e,onClose:t,title:a,children:l,className:c,maxWidth:o="max-w-4xl"}){return e?(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm animate-in fade-in duration-200",children:[(0,s.jsx)("div",{className:"absolute inset-0",onClick:t}),(0,s.jsxs)(n.Zp,{className:(0,i.cn)("relative w-full max-h-[90vh] flex flex-col overflow-hidden animate-in zoom-in-95 duration-200",o,c),"data-report-control":"allow",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[a&&(0,s.jsx)("h2",{className:"text-2xl font-bold text-white",children:a}),(0,s.jsx)("button",{onClick:t,className:"p-1 rounded-full hover:bg-white/10 transition-colors text-gray-400 hover:text-white",children:(0,s.jsx)(r.A,{size:24})})]}),(0,s.jsx)("div",{className:"p-6 overflow-y-auto custom-scrollbar",children:l})]})]}):null}},68305:(e,t,a)=>{a.d(t,{p:()=>v});var s=a(95155),r=a(12115),i=a(68605),n=a(97085),l=a(37717);function c({data:e,sortKey:t,limit:a=30,chartType:i="auto",height:c,chartId:o}){let d=(0,l.A)(),x=(0,r.useMemo)(()=>i&&"auto"!==i?i:["averagePrice","minPrice","maxPrice","medianPrice","avgParkingPrice"].includes(t)?"bar":"treemap",[t,i]),h=(0,r.useMemo)(()=>({averagePrice:{title:"建案平均單價排行",unit:"萬/坪"},minPrice:{title:"建案最低單價排行",unit:"萬/坪"},maxPrice:{title:"建案最高單價排行",unit:"萬/坪"},medianPrice:{title:"建案單價中位數排行",unit:"萬/坪"},avgParkingPrice:{title:"車位平均單價排行",unit:"萬"},saleAmountSum:{title:"建案銷售總額佔比",unit:"萬",yLabel:"銷售總額"},houseAreaSum:{title:"建案房屋面積佔比",unit:"坪",yLabel:"房屋面積"},transactionCount:{title:"建案交易筆數佔比",unit:"筆",yLabel:"資料筆數"}})[t]||{title:"建案分析圖表",unit:"",yLabel:"數值"},[t]),m=(0,r.useMemo)(()=>{if(!e||0===e.length)return[];if("bar"!==x)return e.reduce((e,a)=>e+(a[t]||0),0),[{name:h.yLabel||h.unit,data:e.map(e=>({x:e.projectName,y:parseFloat((e[t]||0).toFixed(2))}))}];{let s=[...e].filter(e=>e[t]>0).sort((e,a)=>a[t]-e[t]).slice(0,a);return[{name:h.unit,data:s.map(e=>parseFloat((e[t]||0).toFixed(2)))}]}},[e,t,x,h,a]),p=(0,r.useMemo)(()=>{let s={title:{text:h.title,align:"center",style:{fontSize:"16px",fontWeight:600,color:d.text}}};if("bar"===x){let r=[...e].filter(e=>e[t]>0).sort((e,a)=>a[t]-e[t]).slice(0,a).map(e=>e.projectName);return{...s,chart:{type:"bar",toolbar:{show:!1},id:o,animations:{enabled:!1}},tooltip:{theme:"dark",y:{formatter:e=>`${e.toLocaleString()} ${h.unit}`,title:{formatter:(e,t)=>{let a=r[t?.dataPointIndex];return a?`${a}:`:`${e}:`}}},x:{show:!0,formatter:(e,t)=>r[t?.dataPointIndex]||e}},plotOptions:{bar:{horizontal:!1,columnWidth:"60%",borderRadius:4,distributed:!1}},colors:[d.chart[0]||d.primary],fill:{type:"gradient",gradient:{shade:"dark",type:"vertical",shadeIntensity:.5,gradientToColors:[d.chart[1]||d.primaryHover],inverseColors:!0,opacityFrom:1,opacityTo:1,stops:[0,100]}},dataLabels:{enabled:!1},xaxis:{categories:r,labels:{style:{colors:d.textMuted},rotate:-45,trim:!0,maxHeight:100}},yaxis:{title:{text:h.unit,style:{color:d.textMuted}},labels:{style:{colors:d.text,fontSize:"12px",fontWeight:500}}},legend:{show:!1}}}{let a=e.reduce((e,a)=>e+(a[t]||0),0);return{...s,tooltip:{theme:"dark",y:{formatter:e=>`${e.toLocaleString()} ${h.unit}`}},chart:{type:"treemap",height:450,toolbar:{show:!1},id:o},plotOptions:{treemap:{distributed:!0,enableShades:!1,colorScale:{ranges:[{from:0,to:.1*a,color:d.chart[1]||d.accent},{from:.1*a,to:.3*a,color:d.chart[2]||d.success},{from:.3*a,to:.6*a,color:d.chart[0]||d.primary},{from:.6*a,to:1/0,color:d.chart[3]||d.accentAlt}]}}},dataLabels:{enabled:!0,style:{fontSize:"11px",fontWeight:500,colors:[d.text]},formatter:e=>e,offsetY:-2}}}},[x,m,h,e,t,a,o,d]);if(!e||0===e.length)return(0,s.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無排名資料可顯示"});let u="bar"===x&&m[0]?.data?m[0].data.length:0,g="bar"===x?{width:"100%",minWidth:`${45*u}px`}:{width:"100%"};return(0,s.jsx)("div",{className:`w-full ${"bar"===x?"overflow-x-auto pb-4":""}`,children:(0,s.jsx)("div",{style:g,children:(0,s.jsx)(n.A,{type:"bar"===x?"bar":"treemap",series:m,options:p,height:c||450,className:"w-full"})})})}var o=a(88743),d=a(89239),x=a(86901),h=a(89123),m=a(37595),p=a(56842),u=a(72055),g=a(65770),f=a(41641),b=a(21362),j=a(89733),y=a(40980);function v({data:e,visibleSections:t=["metrics","chart","table"],className:a}){let{rankingCurrentPage:n,rankingPageSize:l,setRankingCurrentPage:v,setRankingPageSize:N}=(0,o.P)(),[w,z]=(0,r.useState)(1),[k,S]=(0,r.useState)(10),[_,P]=(0,r.useState)({key:"saleAmountSum",order:"desc"}),[A,M]=(0,r.useState)(30),[C,F]=(0,r.useState)("auto"),R=r.useRef(null),T=r.useRef(null),$=r.useRef(null),D=r.useRef(`ranking-chart-${Math.random().toString(36).slice(2,8)}`).current;if(!e)return null;let{coreMetrics:E,projectRanking:L}=e,I=(0,r.useMemo)(()=>{if(!L||0===L.length)return{min:0,max:0,median:0,parking:0};let e=Math.min(...L.map(e=>e.minPrice).filter(e=>e>0)),t=Math.max(...L.map(e=>e.maxPrice)),a=L.map(e=>e.medianPrice).filter(e=>e>0),s=a.length>0?a.reduce((e,t)=>e+t,0)/a.length:0,r=L.map(e=>e.avgParkingPrice).filter(e=>e>0);return{min:e,max:t,median:s,parking:r.length>0?r.reduce((e,t)=>e+t,0)/r.length:0}},[L]),O=(0,r.useMemo)(()=>L?[...L].sort((e,t)=>{let a=e[_.key]||0,s=t[_.key]||0;return"desc"===_.order?s-a:a-s}):[],[L,_]),B=Math.ceil(O.length/k),Y=O.slice((w-1)*k,w*k),J=e=>{P({key:e,order:"desc"})},U=({title:e,value:t,unit:a,sortKey:r})=>(0,s.jsxs)("div",{onClick:()=>r&&J(r),className:`bg-zinc-800/50 rounded-lg p-4 border border-white/5 flex flex-col items-center justify-center text-center transition-all duration-300 ${r?"cursor-pointer hover:bg-zinc-800 hover:border-violet-500/30 hover:shadow-[0_0_20px_rgba(139,92,246,0.1)] group":""}`,children:[(0,s.jsx)("div",{className:`text-zinc-400 text-sm mb-1 ${r?"group-hover:text-violet-300":""}`,children:e}),(0,s.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,s.jsx)("span",{className:`text-2xl font-bold text-white ${r?"group-hover:text-white":""}`,children:t}),(0,s.jsx)("span",{className:"text-xs text-zinc-500",children:a})]})]});return(0,s.jsxs)("div",{className:(0,y.cn)("space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",a),children:[t.includes("metrics")&&(0,s.jsx)(i.c,{title:"核心數據指標",containerRef:R,headerAction:(0,s.jsx)(j.N,{data:[E,I],filename:"core_metrics",label:"匯出",chartType:"ranking-metrics",targetRef:R,snapshotData:{coreMetrics:E,derivedMetrics:I}}),children:(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:[(0,s.jsx)(U,{title:"市場去化總銷售金額",value:E.totalSaleAmount.toLocaleString(),unit:"萬",sortKey:"saleAmountSum"}),(0,s.jsx)(U,{title:"總銷去化房屋坪數",value:E.totalHouseArea.toLocaleString(void 0,{maximumFractionDigits:2}),unit:"坪",sortKey:"houseAreaSum"}),(0,s.jsx)(U,{title:"總平均單價",value:E.overallAveragePrice.toLocaleString(void 0,{maximumFractionDigits:2}),unit:"萬/坪",sortKey:"averagePrice"}),(0,s.jsx)(U,{title:"總交易筆數",value:E.transactionCount.toLocaleString(),unit:"筆",sortKey:"transactionCount"}),(0,s.jsx)(U,{title:"最低成交單價 (Min)",value:I.min.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"萬/坪",sortKey:"minPrice"}),(0,s.jsx)(U,{title:"最高成交單價 (Max)",value:I.max.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"萬/坪",sortKey:"maxPrice"}),(0,s.jsx)(U,{title:"平均中位數單價",value:I.median.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"萬/坪",sortKey:"medianPrice"}),(0,s.jsx)(U,{title:"平均車位價格",value:I.parking.toLocaleString(void 0,{maximumFractionDigits:0}),unit:"萬",sortKey:"avgParkingPrice"})]})}),t.includes("chart")&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"flex flex-wrap gap-2 justify-center","data-report-control":"hide",children:[{key:"saleAmountSum",label:"交易總價(萬)"},{key:"houseAreaSum",label:"房屋面積(坪)"},{key:"transactionCount",label:"資料筆數"},{key:"marketShare",label:"市場佔比(%)"},{key:"averagePrice",label:"平均單價"},{key:"minPrice",label:"最低單價"},{key:"maxPrice",label:"最高單價"},{key:"medianPrice",label:"中位數單價"},{key:"avgParkingPrice",label:"車位均價"}].map(e=>(0,s.jsx)("button",{onClick:()=>J(e.key),className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-all duration-300 ${_.key===e.key?"bg-violet-600/20 border-violet-500/50 text-violet-300 shadow-[0_0_15px_rgba(139,92,246,0.2)]":"bg-zinc-800/50 border-white/5 text-zinc-400 hover:text-white hover:bg-zinc-800 hover:border-white/10"}`,children:e.label},e.key))}),(0,s.jsx)(i.c,{title:"建案分析圖表",description:"根據排序指標顯示建案排名",containerRef:T,headerAction:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 w-full sm:w-auto",children:[(0,s.jsxs)("div",{className:"flex bg-zinc-800 p-0.5 rounded-lg border border-white/5","data-report-control":"hide",children:[(0,s.jsx)("button",{onClick:()=>F("auto"),className:`p-1.5 rounded-md transition-all ${"auto"===C?"bg-violet-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-400 hover:text-white hover:bg-white/5"}`,title:"自動選擇 (Auto)",children:(0,s.jsx)(x.A,{size:14})}),(0,s.jsx)("button",{onClick:()=>F("bar"),className:`p-1.5 rounded-md transition-all ${"bar"===C?"bg-violet-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-400 hover:text-white hover:bg-white/5"}`,title:"長條圖 (Bar)",children:(0,s.jsx)(h.A,{size:14})}),(0,s.jsx)("button",{onClick:()=>F("treemap"),className:`p-1.5 rounded-md transition-all ${"treemap"===C?"bg-violet-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-400 hover:text-white hover:bg-white/5"}`,title:"矩形樹圖 (Treemap)",children:(0,s.jsx)(m.A,{size:14})})]}),(0,s.jsx)("div",{className:"hidden sm:block w-px h-6 bg-white/10"}),(0,s.jsxs)("div",{className:"flex items-center gap-3 w-full sm:w-auto justify-between sm:justify-start",children:[(0,s.jsx)("div",{className:"flex bg-zinc-800 p-0.5 rounded-lg border border-white/5 overflow-x-auto max-w-[200px] sm:max-w-none scrollbar-hide","data-report-control":"hide",children:[10,30,50,100].map(e=>(0,s.jsxs)("button",{onClick:()=>M(e),className:`px-3 py-1 text-xs rounded-md transition-all whitespace-nowrap ${A===e?"bg-violet-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-400 hover:text-white hover:bg-white/5"}`,children:["Top ",e]},e))}),(0,s.jsx)("div",{className:"hidden sm:block w-px h-6 bg-white/10"}),(0,s.jsx)(j.N,{data:O.slice(0,A),filename:"ranking_chart_data",label:"匯出",chartType:"ranking-chart",targetRef:T,snapshotData:O.slice(0,A),chartId:D,columns:{projectName:"建案名稱",county:"縣市",district:"行政區",saleAmountSum:"交易總價",houseAreaSum:"房屋面積",transactionCount:"資料筆數",marketShare:"市場佔比",averagePrice:"平均單價",minPrice:"最低單價",maxPrice:"最高單價",medianPrice:"中位數單價",avgParkingPrice:"車位均價"}})]})]}),children:(0,s.jsx)(c,{data:O,sortKey:_.key,limit:A,chartType:C,chartId:D})})]}),t.includes("table")&&(0,s.jsxs)(i.c,{title:"區域建案排行列表",description:"點擊表頭可進行排序",containerRef:$,headerAction:(0,s.jsx)(j.N,{data:O,filename:"ranking_table_data",label:"匯出",chartType:"ranking-table",targetRef:$,snapshotData:O,columns:{projectName:"建案名稱",county:"縣市",district:"行政區",saleAmountSum:"交易總價",houseAreaSum:"房屋面積",transactionCount:"資料筆數",marketShare:"市場佔比",averagePrice:"平均單價",minPrice:"最低單價",maxPrice:"最高單價",medianPrice:"中位數單價",avgParkingPrice:"車位均價"}}),children:[(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,s.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-3 cursor-default",children:"排名"}),(0,s.jsx)("th",{className:"px-4 py-3 cursor-default",children:"建案名稱"}),[{key:"saleAmountSum",label:(0,s.jsxs)(s.Fragment,{children:["交易",(0,s.jsx)("br",{}),"總價(萬)"]})},{key:"houseAreaSum",label:(0,s.jsxs)(s.Fragment,{children:["房屋",(0,s.jsx)("br",{}),"面積(坪)"]})},{key:"transactionCount",label:(0,s.jsxs)(s.Fragment,{children:["資料",(0,s.jsx)("br",{}),"筆數"]})},{key:"marketShare",label:(0,s.jsxs)(s.Fragment,{children:["市場",(0,s.jsx)("br",{}),"佔比(%)"]})},{key:"averagePrice",label:(0,s.jsxs)(s.Fragment,{children:["平均",(0,s.jsx)("br",{}),"單價"]})},{key:"minPrice",label:(0,s.jsxs)(s.Fragment,{children:["最低",(0,s.jsx)("br",{}),"單價"]})},{key:"maxPrice",label:(0,s.jsxs)(s.Fragment,{children:["最高",(0,s.jsx)("br",{}),"單價"]})},{key:"medianPrice",label:(0,s.jsxs)(s.Fragment,{children:["中位數",(0,s.jsx)("br",{}),"單價"]})},{key:"avgParkingPrice",label:(0,s.jsxs)(s.Fragment,{children:["車位",(0,s.jsx)("br",{}),"均價"]})}].map(e=>(0,s.jsx)("th",{className:"px-3 py-3 cursor-pointer hover:text-white transition-colors text-center whitespace-nowrap",onClick:()=>J(e.key),children:(0,s.jsxs)("div",{className:"flex items-center justify-center gap-1.5 group/header",children:[(0,s.jsx)("span",{className:"leading-tight",children:e.label}),(0,s.jsx)("div",{className:"flex flex-col opacity-50 group-hover/header:opacity-100 transition-opacity",children:_.key===e.key?"desc"===_.order?(0,s.jsx)(p.A,{size:14,className:"text-violet-500"}):(0,s.jsx)(u.A,{size:14,className:"text-violet-500"}):(0,s.jsx)(g.A,{size:14,className:"text-zinc-600 group-hover/header:text-zinc-400"})})]})},e.key))]})}),(0,s.jsx)("tbody",{className:"divide-y divide-white/5",children:Y.map((e,t)=>(0,s.jsxs)("tr",{className:"hover:bg-zinc-800/50 transition-colors",children:[(0,s.jsx)("td",{className:"px-4 py-3 text-zinc-500 font-mono",children:(w-1)*k+t+1}),(0,s.jsx)("td",{className:"px-4 py-3",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"font-medium text-white",children:e.projectName}),(0,s.jsxs)("div",{className:"flex gap-1 mt-1",children:[e.county&&(0,s.jsx)("span",{className:"text-[10px] bg-zinc-800 text-zinc-400 px-1 py-0.5 rounded",children:e.county}),e.district&&(0,s.jsx)("span",{className:"text-[10px] bg-zinc-800 text-zinc-400 px-1 py-0.5 rounded",children:e.district})]})]})}),(0,s.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.saleAmountSum.toLocaleString()}),(0,s.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.houseAreaSum.toLocaleString()}),(0,s.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.transactionCount.toLocaleString()}),(0,s.jsxs)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:[e.marketShare.toFixed(2),"%"]}),(0,s.jsx)("td",{className:"px-4 py-3 font-mono text-cyan-400",children:e.averagePrice.toFixed(1)}),(0,s.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.minPrice.toFixed(1)}),(0,s.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.maxPrice.toFixed(1)}),(0,s.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-400",children:e.medianPrice.toFixed(1)}),(0,s.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-400",children:e.avgParkingPrice>0?e.avgParkingPrice.toLocaleString():"-"})]},t))}),(0,s.jsx)("tfoot",{className:"bg-zinc-900/80 font-bold border-t-2 border-zinc-700",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{colSpan:2,className:"px-4 py-3 text-center text-zinc-300",children:"總計"}),(0,s.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:E.totalSaleAmount.toLocaleString()}),(0,s.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:E.totalHouseArea.toLocaleString()}),(0,s.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:E.transactionCount.toLocaleString()}),(0,s.jsx)("td",{colSpan:6})]})})]})}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-4 border-t border-white/5 pt-4",children:[(0,s.jsxs)("div",{className:"text-sm text-zinc-500",children:["顯示 ",(w-1)*k+1," 到 ",Math.min(w*k,O.length)," 筆，共 ",O.length," 筆"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(d.$,{variant:"outline",size:"sm",onClick:()=>z(e=>Math.max(1,e-1)),disabled:1===w,children:(0,s.jsx)(f.A,{size:16})}),(0,s.jsxs)("span",{className:"text-sm text-zinc-300",children:["Page ",w," of ",B]}),(0,s.jsx)(d.$,{variant:"outline",size:"sm",onClick:()=>z(e=>Math.min(B,e+1)),disabled:w===B,children:(0,s.jsx)(b.A,{size:16})})]})]})]})]})}},81477:(e,t,a)=>{a.d(t,{BT:()=>o,Wu:()=>d,ZB:()=>c,Zp:()=>n,aR:()=>l});var s=a(95155),r=a(12115),i=a(40980);let n=r.forwardRef(({className:e,...t},a)=>(0,s.jsx)("div",{ref:a,className:(0,i.cn)("glass-panel rounded-xl text-card-foreground",e),...t}));n.displayName="Card";let l=r.forwardRef(({className:e,...t},a)=>(0,s.jsx)("div",{ref:a,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",e),...t}));l.displayName="CardHeader";let c=r.forwardRef(({className:e,...t},a)=>(0,s.jsx)("h3",{ref:a,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight text-white",e),...t}));c.displayName="CardTitle";let o=r.forwardRef(({className:e,...t},a)=>(0,s.jsx)("p",{ref:a,className:(0,i.cn)("text-sm text-zinc-400",e),...t}));o.displayName="CardDescription";let d=r.forwardRef(({className:e,...t},a)=>(0,s.jsx)("div",{ref:a,className:(0,i.cn)("p-6 pt-0",e),...t}));d.displayName="CardContent",r.forwardRef(({className:e,...t},a)=>(0,s.jsx)("div",{ref:a,className:(0,i.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"},81789:(e,t,a)=>{a.d(t,{t:()=>n});var s=a(95155),r=a(12115),i=a(13545);class n extends r.Component{static getDerivedStateFromError(e){return{hasError:!0,error:e,errorInfo:null}}componentDidCatch(e,t){console.error("Uncaught error:",e,t),this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?(0,s.jsxs)("div",{className:"p-6 bg-red-950/20 border border-red-500/30 rounded-lg flex flex-col items-center justify-center text-center gap-4 min-h-[200px]",children:[(0,s.jsx)("div",{className:"bg-red-500/10 p-3 rounded-full",children:(0,s.jsx)(i.A,{className:"w-8 h-8 text-red-400"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg font-bold text-red-200 mb-1",children:this.props.fallbackTitle||"Something went wrong"}),this.props.componentName&&(0,s.jsxs)("p",{className:"text-xs text-red-400/80 font-mono mb-2",children:["Component: ",this.props.componentName]}),(0,s.jsx)("div",{className:"max-w-md bg-black/50 p-3 rounded text-left overflow-auto max-h-[150px] border border-red-500/20",children:(0,s.jsx)("p",{className:"text-xs font-mono text-red-300 break-all",children:this.state.error?.toString()})}),(0,s.jsx)("button",{className:"mt-4 px-4 py-2 bg-red-900/40 hover:bg-red-900/60 text-red-200 text-xs rounded transition-colors",onClick:()=>this.setState({hasError:!1,error:null,errorInfo:null}),children:"Try to Recover"})]})]}):this.props.children}constructor(...e){super(...e),this.state={hasError:!1,error:null,errorInfo:null}}}},98883:(e,t,a)=>{a.d(t,{P:()=>s});let s=e=>{let t=new Date,a=new Date,s=e.match(/^(\d+)m$/);if(s){let e=parseInt(s[1],10);if(Number.isFinite(e))return a.setMonth(t.getMonth()-e),{startDate:a.toISOString().split("T")[0],endDate:t.toISOString().split("T")[0]}}switch(e){case"1q":a.setMonth(t.getMonth()-3);break;case"2q":a.setMonth(t.getMonth()-6);break;case"3q":a.setMonth(t.getMonth()-9);break;case"1y":a.setFullYear(t.getFullYear()-1);break;case"this_year":a=new Date(t.getFullYear(),0,1);break;case"last_2_years":a=new Date(t.getFullYear()-1,0,1);break;case"last_3_years":a=new Date(t.getFullYear()-2,0,1);break;default:return{startDate:"",endDate:""}}return{startDate:a.toISOString().split("T")[0],endDate:t.toISOString().split("T")[0]}}}}]);