"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5623],{85623:(e,t,r)=>{r.r(t),r.d(t,{SalesVelocityReport:()=>j});var n=r(95155),i=r(12115),s=r(68605),a=r(97085),l=r(37717);function c({data:e,selectedRooms:t,metric:r,chartId:s}){let c=(0,l.A)(),o=(0,i.useMemo)(()=>({count:{label:"交易筆數",unit:"筆",decimals:0},priceSum:{label:"產權總價",unit:"萬",decimals:0},areaSum:{label:"房屋坪數",unit:"坪",decimals:2}})[r],[r]),d=(0,i.useMemo)(()=>{if(!e||0===t.length)return[];let n=Object.keys(e).sort();return 0===n.length?[]:t.map(t=>({name:t,data:n.map(n=>e[n]?.[t]?.[r]||0)}))},[e,t,r]),x=(0,i.useMemo)(()=>{let t=e?Object.keys(e).sort():[];return{chart:{type:"line",height:350,background:"transparent",toolbar:{show:!1},zoom:{enabled:!1},foreColor:c.text,id:s},colors:c.chartPalette,stroke:{curve:"smooth",width:2},dataLabels:{enabled:!1},xaxis:{categories:t,labels:{style:{colors:c.textMuted}}},yaxis:{title:{text:o.label,style:{color:c.textMuted}},labels:{style:{colors:c.textMuted},formatter:e=>e.toLocaleString("zh-TW",{minimumFractionDigits:0,maximumFractionDigits:0})}},legend:{position:"top",horizontalAlign:"right"},tooltip:{theme:"dark",y:{formatter:e=>`${e.toLocaleString("zh-TW",{minimumFractionDigits:o.decimals,maximumFractionDigits:o.decimals})} ${o.unit}`}},grid:{borderColor:c.grid}}},[e,o,s,c]);return e&&0!==Object.keys(e).length&&0!==t.length?(0,n.jsx)(a.A,{type:"line",series:d,options:x,height:350,className:"w-full"}):(0,n.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"請選擇房型以顯示銷售趨勢"})}function o({data:e,selectedRooms:t,minArea:r,maxArea:s,interval:c,onDataPointClick:o,height:d,chartId:x}){let m=(0,l.A)(),h=(0,i.useMemo)(()=>[{from:0,to:0,color:m.surface||"#27272a",name:"0 戶"},{from:1,to:5,color:"#facc15",name:"1-5 戶"},{from:6,to:20,color:"#fbbf24",name:"6-20 戶"},{from:21,to:50,color:"#f97316",name:"21-50 戶"},{from:51,to:1e4,color:"#dc2626",name:"> 50 戶"}],[m]),{series:p,maxValue:u}=(0,i.useMemo)(()=>{if(!e||0===t.length)return{series:[],maxValue:0};let n=[];for(let e=r;e<s;e+=c){let t=Number.isInteger(c)&&Number.isInteger(r),i=t?e.toFixed(0):e.toFixed(1),s=t?(e+c).toFixed(0):(e+c).toFixed(1);n.push(`${i}-${s}`)}let i=0;return{series:n.map(n=>{let[a,l]=n.split("-").map(parseFloat);return{name:n,data:t.map(t=>{let n=(e[t]||[]).filter(e=>e>=a&&e<l&&e>=r&&e<=s).length;return n>i&&(i=n),n})}}),maxValue:i}},[e,t,r,s,c]),b=(0,i.useMemo)(()=>({chart:{type:"heatmap",height:d||Math.max(400,22*p.length),background:"transparent",toolbar:{show:!1},foreColor:m.text,id:x,events:{dataPointSelection:(e,r,n)=>{if(o){let{seriesIndex:e,dataPointIndex:r}=n,i=n.w.globals.seriesNames[e];o(t[r],i)}}}},plotOptions:{heatmap:{radius:0,useFillColorAsStroke:!0,enableShades:!1,colorScale:{ranges:h}}},dataLabels:{enabled:!0,style:{colors:[({value:e})=>0===e?"transparent":m.text]},formatter:function(e){return 0===e?"":e}},xaxis:{type:"category",categories:t},title:{text:"房型面積分佈熱力圖",align:"center",style:{color:m.text,fontSize:"16px"}},grid:{borderColor:m.grid},tooltip:{theme:"dark",y:{formatter:e=>0===e?"無成交紀錄":`${e} 戶`}}}),[p,t,h,o,m,x,d]);return e&&0!==p.length?(0,n.jsx)(a.A,{type:"heatmap",series:p,options:b,height:b.chart?.height||400,className:"w-full h-full"}):(0,n.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無面積分佈資料"})}var d=r(40980);function x({data:e,viewType:t,selectedRooms:r}){if(!e||0===Object.keys(e).length)return(0,n.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無銷售速度資料"});let s=Object.keys(e).sort().reverse();return(0,n.jsx)("div",{className:"overflow-x-auto max-h-[600px] border border-white/5 rounded-lg",children:(0,n.jsxs)("table",{className:"w-full text-sm text-left border-collapse",children:[(0,n.jsxs)("thead",{className:"bg-zinc-900 sticky top-0 z-20 shadow-md",children:[(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{rowSpan:2,className:"px-4 py-3 sticky left-0 z-30 bg-zinc-900 border-r border-white/10 font-medium text-white min-w-[120px]",children:"時間"}),r.map(e=>(0,n.jsx)("th",{colSpan:3,className:"px-2 py-2 text-center border-l border-white/5 text-zinc-300 font-medium bg-zinc-900/90",children:e},e)),(0,n.jsx)("th",{colSpan:3,className:"px-2 py-2 text-center border-l-2 border-white/10 text-cyan-400 font-bold bg-zinc-900/90",children:"總計"})]}),(0,n.jsxs)("tr",{children:[r.map((e,t)=>(0,n.jsxs)(i.Fragment,{children:[(0,n.jsx)("th",{className:(0,d.cn)("px-2 py-2 text-center text-xs text-zinc-500 font-normal bg-zinc-900/90 border-b border-white/10",0===t&&"border-l border-white/5"),children:"筆數"}),(0,n.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-500 font-normal bg-zinc-900/90 border-b border-white/10",children:"總價(萬)"}),(0,n.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-500 font-normal bg-zinc-900/90 border-b border-white/10",children:"坪數"})]},e)),(0,n.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-400 font-medium bg-zinc-900/90 border-b border-white/10 border-l-2 border-white/10",children:"筆數"}),(0,n.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-400 font-medium bg-zinc-900/90 border-b border-white/10",children:"總價(萬)"}),(0,n.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-400 font-medium bg-zinc-900/90 border-b border-white/10",children:"坪數"})]})]}),(0,n.jsx)("tbody",{className:"divide-y divide-white/5",children:s.map(s=>{let a=e[s]||{},l={count:0,priceSum:0,areaSum:0};return(0,n.jsxs)("tr",{className:"hover:bg-zinc-800/30 transition-colors",children:[(0,n.jsx)("td",{className:"px-4 py-2 sticky left-0 z-10 bg-zinc-950/90 border-r border-white/10 font-mono text-xs text-zinc-400",children:(e=>{if("weekly"===t){let t=e.match(/^(\d{4})-W(\d{1,2})$/);if(t){let r=((e,t)=>{if(!Number.isFinite(e)||!Number.isFinite(t))return"";let r=new Date(Date.UTC(e,0,4)),n=r.getUTCDay()||7,i=new Date(r);i.setUTCDate(r.getUTCDate()-(n-1));let s=new Date(i);s.setUTCDate(i.getUTCDate()+(t-1)*7);let a=new Date(s);a.setUTCDate(s.getUTCDate()+6);let l=`${s.getUTCMonth()+1}/${s.getUTCDate()}`,c=`${a.getUTCMonth()+1}/${a.getUTCDate()}`;return`${l}-${c}`})(parseInt(t[1],10),parseInt(t[2],10));return(0,n.jsxs)("div",{className:"flex flex-col leading-tight text-xs",children:[(0,n.jsx)("span",{children:e}),r&&(0,n.jsx)("span",{className:"text-[9px] text-zinc-500 whitespace-nowrap",children:r})]})}}return e})(s)}),r.map((e,t)=>{let r=a[e];return r?(l.count+=r.count,l.priceSum+=r.priceSum,l.areaSum+=r.areaSum,(0,n.jsxs)(i.Fragment,{children:[(0,n.jsx)("td",{className:(0,d.cn)("px-2 py-2 text-center text-zinc-300",0===t&&"border-l border-white/5"),children:r.count>0?r.count.toLocaleString():"-"}),(0,n.jsx)("td",{className:"px-2 py-2 text-center text-zinc-500 font-mono text-xs",children:r.count>0?(0,d.Z)(r.priceSum,0):"-"}),(0,n.jsx)("td",{className:"px-2 py-2 text-center text-zinc-500 font-mono text-xs",children:r.count>0?(0,d.Z)(r.areaSum,1):"-"})]},e)):(0,n.jsxs)(i.Fragment,{children:[(0,n.jsx)("td",{className:(0,d.cn)("px-2 py-2 text-center text-zinc-700",0===t&&"border-l border-white/5"),children:"-"}),(0,n.jsx)("td",{className:"px-2 py-2 text-center text-zinc-700",children:"-"}),(0,n.jsx)("td",{className:"px-2 py-2 text-center text-zinc-700",children:"-"})]},e)}),(0,n.jsx)("td",{className:"px-2 py-2 text-center font-bold text-cyan-400 border-l-2 border-white/10",children:l.count.toLocaleString()}),(0,n.jsx)("td",{className:"px-2 py-2 text-center font-bold text-zinc-300 font-mono text-xs",children:(0,d.Z)(l.priceSum,0)}),(0,n.jsx)("td",{className:"px-2 py-2 text-center font-bold text-zinc-300 font-mono text-xs",children:(0,d.Z)(l.areaSum,1)})]},s)})})]})})}var m=r(29991),h=r(60529),p=r(89733),u=r(88743),b=r(48551),f=r(39430),g=r(80642);function j({data:e,visibleSections:t=["chart","table","heatmap"],uiSize:r="dashboard"}){let[a,l]=(0,i.useState)("monthly"),[j,N]=(0,i.useState)("count"),v=(0,d.cn)("bg-zinc-950/50","builder"===r?"text-xl h-12":"text-sm h-9"),[y,w]=(0,i.useState)(15),[z,S]=(0,i.useState)(65),[R,C]=(0,i.useState)(5),[F,k]=(0,i.useState)([]),[$,D]=(0,i.useState)(null),{selectedRoomTypes:T,setSelectedRoomTypes:M}=(0,u.P)();if(!e)return null;let{salesVelocityAnalysis:P,areaDistributionAnalysis:A}=e,_=e=>Math.round(e)+"萬",U=i.useRef(null),E=i.useRef(null),I=i.useRef(null),O=i.useRef(null),L=i.useRef(`sales-velocity-${Math.random().toString(36).slice(2,8)}`).current,W=i.useRef(`area-heatmap-${Math.random().toString(36).slice(2,8)}`).current,Z=(t,r)=>{U.current&&(U.current.style.width=`${U.current.offsetWidth}px`);let n=0,i=1/0;if(r.includes("<"))i=parseFloat(r.replace("<","").trim());else if(r.includes(">"))n=parseFloat(r.replace(">","").trim());else if(r.includes("-")){let e=r.split("-");n=parseFloat(e[0].trim()),i=parseFloat(e[1].trim())}let s=(e.transactionDetails||[]).filter(e=>{let r=function(e){let t=e=>e?String(e).normalize("NFKC").toUpperCase().replace(/\s+/g,""):"",r=t(e["建物型態"]||e.buildingType),n=t(e["主要用途"]||e.mainPurpose),i=t(e["戶別"]||e.unit),s=void 0!==e["房數"]?e["房數"]:e.rooms,a=void 0!==e["房屋面積(坪)"]?parseFloat(e["房屋面積(坪)"]):parseFloat(e.houseArea||0);if(r.includes("住宅大樓")&&i.includes("S")||i.includes("店舖")||i.includes("店面")||i.includes("店鋪"))return"店舖";if(i.includes("事務所")||i.includes("辦公"))return"辦公/事務所";if(r.includes("店舖")||r.includes("店面")||r.includes("店鋪"))return"店舖";if(r.includes("工廠")||r.includes("倉庫")||r.includes("廠辦"))return"廠辦/工廠";if(n.includes("商業")||r.includes("辦公")||r.includes("事務所"))return"辦公/事務所";if((r.includes("住宅大樓")||r.includes("華廈"))&&0===s){if(a>35)return"毛胚";if(a<=35)return"套房"}if("number"==typeof s&&!isNaN(s)){if(1===s)return"1房";if(2===s)return"2房";if(3===s)return"3房";if(4===s)return"4房";if(s>=5)return"5房以上"}return"其他"}(e),s=parseFloat(e["房屋面積(坪)"]||e.houseArea||(e["建物移轉平方公尺"]?.3025*e["建物移移轉平方公尺"]:0));if(!r)return!1;let a=s>=n&&s<i;return r===t&&a});console.log(`[Heatmap Click] Room: ${t}, Range: ${n}-${i}, Found: ${s.length}`);let a={};s.forEach(e=>{let t=e["建案名稱"]||e.projectName||"未知建案";a[t]||(a[t]=[]),a[t].push(e)});let l=Object.entries(a).map(([e,t])=>{let r=t.map(e=>e["產權總價"]||e["交易總價(萬)"]||e.totalPrice||0).filter(e=>e>0).sort((e,t)=>e-t),n=t.map(e=>e["房屋單價"]||e["房屋單價(萬)"]||e.unitPrice||0).filter(e=>e>0),i=0;if(r.length>0){let e=Math.floor(r.length/2);i=r.length%2!=0?r[e]:(r[e-1]+r[e])/2}return{projectName:e,count:t.length,priceRange:{min:r.length>0?r[0]:0,max:r.length>0?r[r.length-1]:0,median:i},unitPriceRange:{min:n.length>0?Math.min(...n):0,max:n.length>0?Math.max(...n):0},transactions:t.sort((e,t)=>{let r=e["房屋單價"]||e["房屋單價(萬)"]||e.unitPrice||0;return(t["房屋單價"]||t["房屋單價(萬)"]||t.unitPrice||0)-r}),isExpanded:!1}});l.sort((e,t)=>t.unitPriceRange.max-e.unitPriceRange.max),k(l),D({roomType:t,areaRange:r,totalCount:s.length})},V=()=>{U.current&&(U.current.style.width=`${U.current.offsetWidth}px`),D(null)},K=t.includes("chart"),q=t.includes("table"),B=t.includes("heatmap"),H=t.includes("heatmap-detail")&&!B&&!K&&!q;i.useEffect(()=>{let t,r,n;if(!H||$||!e?.transactionDetails?.length)return;let i=T[0]||u.M[0];i&&Z(i,(r=(t=Number.isInteger(R)&&Number.isInteger(y))?y.toFixed(0):y.toFixed(1),n=t?(y+R).toFixed(0):(y+R).toFixed(1),`${r}-${n}`))},[H,$,e?.transactionDetails,T,y,R]);let J=()=>$?(0,n.jsxs)("div",{className:"flex-1 min-w-0 bg-zinc-900/50 border border-white/10 rounded-lg h-full flex flex-col p-4 overflow-hidden",children:[(0,n.jsxs)("div",{className:"flex justify-between items-start mb-4 pb-4 border-b border-white/5",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("h4",{className:"text-white font-medium flex items-center gap-2 text-lg",children:[(0,n.jsx)("span",{className:"text-cyan-400",children:$.roomType}),(0,n.jsx)("span",{className:"text-zinc-500",children:"|"}),(0,n.jsxs)("span",{children:[$.areaRange," 坪"]})]}),(0,n.jsxs)("p",{className:"text-zinc-400 text-xs mt-1",children:["共找到 ",(0,n.jsx)("span",{className:"text-white font-mono",children:F.length})," 個建案",(0,n.jsx)("br",{}),"合計 ",(0,n.jsx)("span",{className:"text-white font-mono",children:$.totalCount})," 筆交易"]})]}),(0,n.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,n.jsxs)("div",{className:"flex gap-1 mr-2",children:[(0,n.jsx)(p.N,{data:F,filename:`heatmap_aggregated_${$.roomType}_${$.areaRange}`,label:"統計",chartType:"sales-heatmap-detail",snapshotData:F,className:"whitespace-nowrap px-3 py-1 text-xs h-7 min-w-0"}),(0,n.jsx)(p.N,{data:F.flatMap(e=>e.transactions),filename:`heatmap_details_${$.roomType}_${$.areaRange}`,label:"明細",className:"whitespace-nowrap px-3 py-1 text-xs h-7 min-w-0"})]}),!H&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"w-px h-4 bg-white/10 mx-1"}),(0,n.jsx)("button",{onClick:V,className:"text-zinc-400 hover:text-white p-1 hover:bg-zinc-800 rounded transition-colors",children:(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("path",{d:"M18 6 6 18"}),(0,n.jsx)("path",{d:"m6 6 12 12"})]})})]})]})]}),F.length>0?(0,n.jsx)("div",{className:"flex-1 overflow-y-auto custom-scrollbar pr-1 -mr-1",children:(0,n.jsx)("div",{className:"space-y-3",children:F.map((e,t)=>(0,n.jsxs)("div",{className:"bg-zinc-950/30 rounded border border-white/5 overflow-hidden",children:[(0,n.jsxs)("div",{className:(0,d.cn)("p-3 cursor-pointer transition-colors flex justify-between items-center",e.isExpanded?"bg-zinc-800/80":"hover:bg-zinc-800/40"),onClick:()=>{k(e=>e.map((e,r)=>r===t?{...e,isExpanded:!e.isExpanded}:e))},children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:(0,d.cn)("w-4 h-4 rounded-full bg-zinc-800 flex items-center justify-center text-[10px] text-zinc-400 transition-transform duration-200",e.isExpanded?"rotate-90 bg-violet-500/20 text-violet-300":""),children:"▶"}),(0,n.jsx)("span",{className:"font-medium text-sm text-zinc-200",children:e.projectName}),(0,n.jsxs)("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-zinc-800 text-zinc-400 border border-white/5",children:[e.count,"戶"]})]}),(0,n.jsx)("div",{className:"text-right",children:(0,n.jsxs)("div",{className:"text-xs font-mono text-cyan-400",children:[e.unitPriceRange.min===e.unitPriceRange.max?e.unitPriceRange.min.toFixed(1):`${e.unitPriceRange.min.toFixed(1)}~${e.unitPriceRange.max.toFixed(1)}`," ",(0,n.jsx)("span",{className:"text-zinc-500 text-[10px]",children:"萬/坪"})]})})]}),e.isExpanded&&(0,n.jsxs)("div",{className:"p-3 bg-black/20 border-t border-white/5",children:[(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-xs mb-3 text-zinc-400",children:[(0,n.jsxs)("div",{className:"flex justify-between border-b border-white/5 pb-1",children:[(0,n.jsx)("span",{children:"總價範圍"}),(0,n.jsx)("span",{className:"font-mono text-zinc-300",children:e.priceRange.min===e.priceRange.max?_(e.priceRange.min):`${_(e.priceRange.min)}~${_(e.priceRange.max)}`})]}),(0,n.jsxs)("div",{className:"flex justify-between border-b border-white/5 pb-1",children:[(0,n.jsx)("span",{children:"總價中位數"}),(0,n.jsx)("span",{className:"font-mono text-violet-300",children:_(e.priceRange.median||0)})]})]}),(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)("div",{className:"grid grid-cols-5 text-[10px] text-zinc-500 pb-1 border-b border-white/5",children:[(0,n.jsx)("div",{className:"col-span-1",children:"樓層"}),(0,n.jsx)("div",{className:"col-span-1",children:"坪數"}),(0,n.jsx)("div",{className:"col-span-1 text-right",children:"單價"}),(0,n.jsx)("div",{className:"col-span-2 text-right",children:"總價"})]}),e.transactions.slice(0,e.showAll?void 0:10).map((e,t)=>(0,n.jsxs)("div",{className:"grid grid-cols-5 text-xs py-1 hover:bg-white/5 rounded px-1 -mx-1 transition-colors",children:[(0,n.jsx)("div",{className:"col-span-1 text-zinc-300",children:e["樓層"]||e.floor||"-"}),(0,n.jsx)("div",{className:"col-span-1 text-zinc-400",children:(e["房屋面積(坪)"]||e.houseArea||0).toFixed(1)}),(0,n.jsx)("div",{className:"col-span-1 text-right text-cyan-400",children:(e["房屋單價(萬)"]||e.unitPrice||0).toFixed(0)}),(0,n.jsx)("div",{className:"col-span-2 text-right text-zinc-300 font-mono",children:_(e["交易總價(萬)"]||e.totalPrice||0)})]},t)),e.transactions.length>10&&(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),k(e=>e.map((e,r)=>r===t?{...e,showAll:!e.showAll}:e))},className:"w-full text-center text-[10px] text-zinc-500 hover:text-cyan-400 py-1.5 mt-1 border-t border-white/5 transition-colors",children:e.showAll?"收合內容":`還有 ${e.transactions.length-10} 筆交易...`})]})]})]},t))})}):(0,n.jsx)("div",{className:"flex-1 flex flex-col items-center justify-center text-zinc-500 border border-dashed border-zinc-800 rounded bg-zinc-900/30",children:(0,n.jsx)("p",{children:"無詳細資料"})})]}):(0,n.jsx)("div",{className:"flex items-center justify-center text-zinc-500 border border-dashed border-zinc-800 rounded bg-zinc-900/30 p-6",children:"無詳細資料"});return H?(0,n.jsx)("div",{className:"space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500",children:(0,n.jsx)(J,{})}):(0,n.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,n.jsxs)("div",{id:"room-type-filter-anchor","data-report-control":"hide",className:"p-4 bg-zinc-900/30 border border-white/5 rounded-lg flex flex-wrap gap-2 items-center scroll-mt-24",children:[(0,n.jsx)("span",{className:"text-zinc-400 text-sm mr-2",children:"分析房型:"}),u.M.map(e=>(0,n.jsx)("button",{onClick:()=>{M(T.includes(e)?T.filter(t=>t!==e):[...T,e])},className:(0,d.cn)("px-3 py-1 text-xs rounded-full border transition-colors",T.includes(e)?"bg-violet-500/20 border-violet-500 text-violet-200":"bg-zinc-800 border-zinc-700 text-zinc-500 hover:bg-zinc-700"),children:e},e))]}),K&&(0,n.jsx)(s.c,{title:"房型銷售速度與趨勢分析",containerRef:E,headerAction:(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("div",{"data-report-control":"hide",children:(0,n.jsxs)(m.l,{value:a,onChange:e=>l(e.target.value),className:v,children:[(0,n.jsx)("option",{value:"weekly",children:"每週"}),(0,n.jsx)("option",{value:"monthly",children:"每月"}),(0,n.jsx)("option",{value:"quarterly",children:"每季"})]})}),(0,n.jsx)("div",{"data-report-control":"hide",children:(0,n.jsxs)(m.l,{value:j,onChange:e=>N(e.target.value),className:v,children:[(0,n.jsx)("option",{value:"count",children:"交易筆數"}),(0,n.jsx)("option",{value:"priceSum",children:"總銷金額"}),(0,n.jsx)("option",{value:"areaSum",children:"總銷坪數"})]})}),(0,n.jsx)(p.N,{data:P?.[a]||[],filename:`sales_velocity_${a}`,label:"匯出",chartType:"sales-velocity-chart",targetRef:E,snapshotData:P?.[a]||[],chartId:L,columns:{period:"時間區間",count:"交易筆數",priceSum:"總銷金額",areaSum:"總銷坪數"}})]}),children:(0,n.jsx)(c,{data:P?.[a]||{},selectedRooms:T,metric:j,chartId:L})}),q&&(0,n.jsx)(s.c,{title:"銷售速度明細表",description:"各時間段詳細銷售數據統計",containerRef:I,headerAction:(0,n.jsx)(p.N,{data:P?.[a],filename:`sales_velocity_table_${a}`,label:"匯出",chartType:"sales-velocity-table",targetRef:I,snapshotData:P?.[a]||[],columns:{period:"時間區間",count:"交易筆數",priceSum:"總銷金額",areaSum:"總銷坪數"}}),children:(0,n.jsx)(x,{data:P?.[a]||[],viewType:a,selectedRooms:T})}),B&&(0,n.jsx)(s.c,{title:"房型面積分佈熱力圖",description:"分析不同坪數區間的產品供給與去化分佈",containerRef:O,headerAction:(0,n.jsxs)("div",{className:"flex gap-2 items-center text-zinc-400 text-xs",children:[(0,n.jsxs)("div",{className:"flex gap-2 items-center","data-report-control":"hide",children:[(0,n.jsx)("span",{children:"範圍:"}),(0,n.jsx)(h.p,{type:"number",value:y,onChange:e=>w(Number(e.target.value)),className:"w-16 h-8 text-xs bg-zinc-950/50"}),(0,n.jsx)("span",{children:"-"}),(0,n.jsx)(h.p,{type:"number",value:z,onChange:e=>S(Number(e.target.value)),className:"w-16 h-8 text-xs bg-zinc-950/50"}),(0,n.jsx)("span",{className:"ml-2",children:"級距:"}),(0,n.jsx)(h.p,{type:"number",value:R,onChange:e=>C(Number(e.target.value)),step:"0.5",className:"w-16 h-8 text-xs bg-zinc-950/50"}),(0,n.jsx)("div",{className:"border-l border-white/10 h-4 mx-1"})]}),(0,n.jsx)(p.N,{data:A?Object.entries(A).map(([e,t])=>({key:e,value:JSON.stringify(t)})):[],filename:"area_distribution_heatmap",label:"匯出",chartType:"sales-heatmap",targetRef:O,snapshotData:{distribution:A,selectedRooms:T,min:y,max:z,interval:R},chartId:W,columns:{key:"坪數區間",value:"分佈數據"}})]}),children:(0,n.jsxs)("div",{className:(0,d.cn)("flex flex-col lg:flex-row gap-6 relative overflow-hidden items-stretch transition-all duration-300",$?"lg:h-[600px]":"min-h-[500px]"),children:[(0,n.jsx)(f.P.div,{layout:!0,initial:!1,animate:{flex:$?"0 0 60%":"0 0 100%"},transition:{type:"spring",stiffness:300,damping:35,mass:1},onAnimationStart:()=>{},onAnimationComplete:()=>{U.current&&(U.current.style.width="100%",window.dispatchEvent(new Event("resize")))},className:"min-w-0 overflow-hidden h-full flex flex-col",children:(0,n.jsx)("div",{ref:U,className:"w-full h-full flex flex-col",children:(0,n.jsx)(o,{data:A||{},selectedRooms:T,minArea:y,maxArea:z,interval:R,onDataPointClick:Z,height:$?"100%":void 0,chartId:W})})}),(0,n.jsx)(g.N,{mode:"wait",children:$&&(0,n.jsx)(f.P.div,{initial:{opacity:0,x:50,width:0},animate:{opacity:1,x:0,width:"40%"},exit:{opacity:0,x:50,width:0},transition:{type:"spring",stiffness:300,damping:35},className:"min-w-0 h-full flex",children:(0,n.jsx)(J,{})})})]})}),(0,n.jsx)(b.K,{})]})}}}]);