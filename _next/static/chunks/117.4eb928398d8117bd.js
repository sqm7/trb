(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[117],{117:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var a=r(95155),l=r(12115),i=r(36379),s=r.n(i);r(23879);var n=r(56572),o=r(33024);let c=(0,r(78340).A)("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]);var d=r(41463);let u=[121.5318,25.0478],p="sqm_map_theme",y="sqm_map_theme_manual",m="sqm_map_follow_theme",x="sqm-map-settings",b=e=>e?"cyberpunk"===e?"cyberpunk":"neon_noir"===e?"neon":"default":"default",h=()=>{if("true"!==window.localStorage.getItem(y))return"default";let e=window.localStorage.getItem(p);return"default"===e||"dark"===e||"cyberpunk"===e||"graphite"===e||"neon"===e?e:"default"},f=()=>"true"===window.localStorage.getItem(m);function g(){let e=(0,l.useRef)(null),t=(0,l.useRef)(null),[r,i]=(0,l.useState)(!1),g="1GYoblfxWX2uc8edFcbq",[v,w]=(0,l.useState)(g?"streets-v2":"demo"),[j,k]=(0,l.useState)(!0),[N,z]=(0,l.useState)(()=>h()),[P,S]=(0,l.useState)(()=>f()),[C,L]=(0,l.useState)(!1),[M,E]=(0,l.useState)("idle"),[_,$]=(0,l.useState)({visible:!1,opacity:.6}),[T,R]=(0,l.useState)({road:{visible:!1,opacity:.65},school:{visible:!1,opacity:.65},amenity:{visible:!1,opacity:.2}}),[A,F]=(0,l.useState)(""),[O,I]=(0,l.useState)([]),[D,U]=(0,l.useState)(!1),[q,H]=(0,l.useState)(!1),[G,B]=(0,l.useState)(null),[K,W]=(0,l.useState)(null),[X,Y]=(0,l.useState)({zoning:{visible:!1,opacity:.6},cadastral:{visible:!1,opacity:.6}}),Z=(0,l.useRef)(X),J=(0,l.useRef)(j),Q=(0,l.useRef)(N),V=(0,l.useRef)(N),ee=(0,l.useRef)(!0),et=(0,l.useRef)(C),er=(0,l.useRef)(_),ea=(0,l.useRef)(T),el=(0,l.useRef)(null),ei=(0,l.useRef)(null),es=(0,l.useRef)(null),en=(0,l.useRef)(null),eo=(0,l.useRef)(null),ec=(0,l.useRef)(null),ed=(0,l.useRef)(null),eu=(0,l.useRef)(!1),ep=(0,l.useMemo)(()=>[{id:"zoning",label:"國土利用現況調查成果圖",tiles:"https://wmts.nlsc.gov.tw/wmts/LUIMAP/default/GoogleMapsCompatible/{z}/{y}/{x}"},{id:"cadastral",label:"段籍圖（地籍）",tiles:"https://wmts.nlsc.gov.tw/wmts/LANDSECT/default/GoogleMapsCompatible/{z}/{y}/{x}"}],[]),ey=(0,l.useMemo)(()=>[{id:"road",label:"交通路網",tiles:"https://wmts.nlsc.gov.tw/wmts/ROAD/default/GoogleMapsCompatible/{z}/{y}/{x}"},{id:"school",label:"學區範圍",tiles:"https://wmts.nlsc.gov.tw/wmts/SCHOOL/default/GoogleMapsCompatible/{z}/{y}/{x}"}],[]),em=(0,l.useMemo)(()=>{let e={id:"demo",label:"開源預設",url:"https://demotiles.maplibre.org/style.json"},t={id:"osm",label:"OSM 標準",supportsTheme:!1,style:{version:8,name:"OpenStreetMap Standard",sources:{"osm-tiles":{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"\xa9 OpenStreetMap contributors"}},layers:[{id:"osm-tiles",type:"raster",source:"osm-tiles",minzoom:0,maxzoom:19}]}},r=d.env.NEXT_PUBLIC_MAP_CUSTOM_STYLE_URL,a=d.env.NEXT_PUBLIC_MAP_CUSTOM_DARK_STYLE_URL,l=r?[{id:"custom",label:"商業配色",url:r,supportsTheme:!0}]:[],i=a?[{id:"custom-dark",label:"深色自訂",url:a,supportsTheme:!0}]:[],s=g?[{id:"streets-v2",label:"街景",url:`https://api.maptiler.com/maps/streets-v2/style.json?key=${g}`,supportsTheme:!0},{id:"satellite",label:"衛星",url:`https://api.maptiler.com/maps/satellite/style.json?key=${g}`,supportsTheme:!1},{id:"hybrid",label:"衛星混合",url:`https://api.maptiler.com/maps/hybrid/style.json?key=${g}`,supportsTheme:!1},{id:"basic-v2",label:"極簡",url:`https://api.maptiler.com/maps/basic-v2/style.json?key=${g}`,supportsTheme:!0},{id:"topo-v2",label:"地形",url:`https://api.maptiler.com/maps/topo-v2/style.json?key=${g}`,supportsTheme:!0},{id:"dataviz",label:"數據",url:`https://api.maptiler.com/maps/dataviz/style.json?key=${g}`,supportsTheme:!0}]:[];return g?[t,...l,...i,...s]:l.length?[t,...l,...i,e]:[t,e]},[g]),ex=(0,l.useCallback)(e=>{if(!ee.current)return;let t=Q.current;if("default"===t)return;let r="cyberpunk"===t?{background:"#05020d",land:"#0d0b1f",landSecondary:"#12162a",water:"#00d1ff",park:"#0f3b2e",road:"#3a2b5a",roadMajor:"#ff2bd6",boundary:"#2a1a52",building:"#121022",text:"#e5e7ff",textHalo:"#05020d",poi:"#7dd3fc"}:"neon"===t?{background:"#06070b",land:"#0b0f1a",landSecondary:"#0f172a",water:"#22d3ee",park:"#0b3b3b",road:"#1f2a44",roadMajor:"#22c55e",boundary:"#1f2937",building:"#0b1327",text:"#e2f2ff",textHalo:"#05070d",poi:"#f472b6"}:"graphite"===t?{background:"#0b0c10",land:"#12141b",landSecondary:"#171a22",water:"#475569",park:"#1f2937",road:"#2b313c",roadMajor:"#94a3b8",boundary:"#232833",building:"#111827",text:"#e5e7eb",textHalo:"#0b0c10",poi:"#cbd5f5"}:{background:"#0b0d13",land:"#111827",landSecondary:"#0f172a",water:"#0ea5e9",park:"#0f3d2e",road:"#334155",roadMajor:"#38bdf8",boundary:"#1f2937",building:"#0f172a",text:"#e2e8f0",textHalo:"#020617",poi:"#22d3ee"},a=e.getStyle();if(!a?.layers)return;a.layers.forEach(t=>{let a=t.id,l=t["source-layer"],i=a.toLowerCase();if("background"===t.type&&e.setPaintProperty(a,"background-color",r.background),"fill"===t.type&&("water"===l?e.setPaintProperty(a,"fill-color",r.water):"landcover"===l||"landuse"===l||i.includes("land")?e.setPaintProperty(a,"fill-color",r.land):(i.includes("park")||i.includes("garden"))&&e.setPaintProperty(a,"fill-color",r.park)),"line"===t.type){if("waterway"===l)e.setPaintProperty(a,"line-color",r.water);else if("boundary"===l)e.setPaintProperty(a,"line-color",r.boundary);else if("transportation"===l||"road"===l||i.includes("road")){let t=i.includes("motorway")||i.includes("trunk")||i.includes("primary");e.setPaintProperty(a,"line-color",t?r.roadMajor:r.road)}}"fill-extrusion"===t.type&&"3d-buildings"===a&&e.setPaintProperty(a,"fill-extrusion-color",["interpolate",["linear"],["coalesce",["get","render_height"],["get","height"],6],0,r.building,20,r.road,60,r.poi,120,r.roadMajor,200,"#ef4444"]),"symbol"===t.type&&t.layout?.["text-field"]&&(e.setPaintProperty(a,"text-color",r.text),e.setPaintProperty(a,"text-halo-color",r.textHalo),e.setPaintProperty(a,"text-halo-width",1.2),i.includes("poi")&&e.setPaintProperty(a,"text-color",r.poi))});let l="gov-cadastral-layer";if(e.getLayer(l)){let r="cyberpunk"===t||"neon"===t?{contrast:.6,min:.2,max:1.7,saturation:1.25}:"graphite"===t?{contrast:.4,min:.2,max:1.4,saturation:.9}:{contrast:.35,min:.25,max:1.35,saturation:1.05};e.setPaintProperty(l,"raster-contrast",r.contrast),e.setPaintProperty(l,"raster-brightness-min",r.min),e.setPaintProperty(l,"raster-brightness-max",r.max),e.setPaintProperty(l,"raster-saturation",r.saturation)}let i="osm-levels-points",s="osm-levels-label";e.getLayer(i)&&(e.setPaintProperty(i,"circle-color",r.roadMajor),e.setPaintProperty(i,"circle-stroke-color",r.poi)),e.getLayer(s)&&(e.setPaintProperty(s,"text-color",r.text),e.setPaintProperty(s,"text-halo-color",r.textHalo),e.setPaintProperty(s,"text-halo-width",1.1))},[]),eb=(0,l.useCallback)(e=>{let t=e.getStyle();t?.layers&&t.layers.forEach(t=>{"symbol"!==t.type||t.layout?.["text-field"]&&e.setLayoutProperty(t.id,"text-field",["coalesce",["get","name:zh-Hant"],["get","name:zh"],["get","name"],["get","name:en"]])})},[]),eh=(0,l.useCallback)(e=>{e.getSource("osm-overlay")||e.addSource("osm-overlay",{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"\xa9 OpenStreetMap contributors"}),e.getLayer("osm-overlay-layer")||e.addLayer({id:"osm-overlay-layer",type:"raster",source:"osm-overlay",layout:{visibility:"none"},paint:{"raster-opacity":er.current.opacity}})},[]),ef=(0,l.useCallback)(e=>{let t="osm-overlay-layer";e.getLayer(t)&&(e.setLayoutProperty(t,"visibility",er.current.visible?"visible":"none"),e.setPaintProperty(t,"raster-opacity",er.current.opacity))},[]),eg=(0,l.useCallback)((e,t,r=64)=>{let[a,l]=e,i=[],s=t/(111320*Math.cos(l*Math.PI/180)),n=t/110540;for(let e=0;e<=r;e++){let t=e*Math.PI*2/r,o=Math.cos(t)*s,c=Math.sin(t)*n;i.push([a+o,l+c])}return i},[]),ev=(0,l.useCallback)(e=>{e.getSource("amenity-circles")||e.addSource("amenity-circles",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),e.getLayer("amenity-circles-fill")||e.addLayer({id:"amenity-circles-fill",type:"fill",source:"amenity-circles",paint:{"fill-color":"#22d3ee","fill-opacity":ea.current.amenity.opacity}}),e.getLayer("amenity-circles-line")||e.addLayer({id:"amenity-circles-line",type:"line",source:"amenity-circles",paint:{"line-color":"#38bdf8","line-width":1.2,"line-opacity":.85}})},[]),ew=(0,l.useCallback)(e=>{let t=ei.current||el.current||[e.getCenter().lng,e.getCenter().lat],r=[300,600,1e3].map((e,r)=>({type:"Feature",properties:{radius:e,label:`${e}m`,idx:r},geometry:{type:"Polygon",coordinates:[eg(t,e)]}}));e.getSource("amenity-circles").setData({type:"FeatureCollection",features:r})},[eg]),ej=(0,l.useCallback)(e=>{ey.forEach(t=>{let r=`life-${t.id}-layer`;if(!e.getLayer(r))return;let a=ea.current[t.id];a&&(e.setLayoutProperty(r,"visibility",a.visible?"visible":"none"),e.setPaintProperty(r,"raster-opacity",a.opacity))}),e.getLayer("amenity-circles-fill")&&(e.setLayoutProperty("amenity-circles-fill","visibility",ea.current.amenity.visible?"visible":"none"),e.setLayoutProperty("amenity-circles-line","visibility",ea.current.amenity.visible?"visible":"none"),e.setPaintProperty("amenity-circles-fill","fill-opacity",ea.current.amenity.opacity))},[ey]),ek=(0,l.useCallback)(e=>{e.getSource("osm-levels")||e.addSource("osm-levels",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),e.getLayer("osm-levels-points")||e.addLayer({id:"osm-levels-points",type:"circle",source:"osm-levels",paint:{"circle-color":"#38bdf8","circle-radius":4,"circle-opacity":.7,"circle-stroke-color":"#22d3ee","circle-stroke-width":1}}),e.getLayer("osm-levels-label")||e.addLayer({id:"osm-levels-label",type:"symbol",source:"osm-levels",layout:{"text-field":["get","levelsLabel"],"text-size":11,"text-anchor":"center","text-allow-overlap":!0},paint:{"text-color":"#e2e8f0","text-halo-color":"#0b0d13","text-halo-width":1.1}})},[]),eN=(0,l.useCallback)((e,t)=>{let r=t?"visible":"none";e.getLayer("osm-levels-points")&&e.setLayoutProperty("osm-levels-points","visibility",r),e.getLayer("osm-levels-label")&&e.setLayoutProperty("osm-levels-label","visibility",r)},[]),ez=(0,l.useCallback)(e=>{e.getSource("search-point")||e.addSource("search-point",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),e.getLayer("search-point-layer")||e.addLayer({id:"search-point-layer",type:"circle",source:"search-point",paint:{"circle-color":"#22d3ee","circle-radius":6,"circle-stroke-color":"#0ea5e9","circle-stroke-width":2,"circle-opacity":.9}})},[]),eP=(0,l.useCallback)(async e=>{if(16>e.getZoom())return void E("zoom");let t=e.getBounds(),r=Math.abs(t.getNorth()-t.getSouth()),a=Math.abs(t.getEast()-t.getWest());if(r>.12||a>.12)return void E("zoom");let l=`${t.getSouth()},${t.getWest()},${t.getNorth()},${t.getEast()}`;if(l===ed.current)return;ed.current=l,eo.current&&eo.current.abort();let i=new AbortController;eo.current=i,E("loading");let s=`[out:json][timeout:25];
(
  way["building"]["building:levels"](${l});
  way["building"]["levels"](${l});
);
out center;`,n=null;for(let e of["https://overpass-api.de/api/interpreter","https://overpass.kumi.systems/api/interpreter","https://overpass.nchc.org.tw/api/interpreter"])try{let t=await fetch(e,{method:"POST",body:s,signal:i.signal,headers:{"Content-Type":"text/plain"}});if(!t.ok)throw Error(`OSM fetch failed: ${t.status}`);n=await t.json();break}catch(e){if(e?.name==="AbortError")return;n=null}if(!n)return void E("error");let o=(n?.elements||[]).filter(e=>"way"===e.type&&e.center).map(e=>{let t=e.tags||{},r=Number.parseInt(t["building:levels"]||t.levels,10);return r&&e.center?{type:"Feature",properties:{id:e.id,levels:r,levelsLabel:`${r}F`},geometry:{type:"Point",coordinates:[e.center.lon,e.center.lat]}}:null}).filter(Boolean);e.getSource("osm-levels").setData({type:"FeatureCollection",features:o}),E("ready")},[]),eS=(0,l.useCallback)(e=>{if(!J.current)return;let t=e.getStyle();if(!t?.layers)return;let r=t.layers.find(e=>"symbol"===e.type&&e.layout?.["text-field"])?.id,a=e.getSource("openmaptiles")?"openmaptiles":e.getSource("maptiler")?"maptiler":null;!a||e.getLayer("3d-buildings")||e.addLayer({id:"3d-buildings",source:a,"source-layer":"building",type:"fill-extrusion",minzoom:15,paint:{"fill-extrusion-color":["interpolate",["linear"],["coalesce",["get","render_height"],["get","height"],6],0,"#1f2937",20,"#334155",50,"#38bdf8",100,"#f97316",200,"#ef4444"],"fill-extrusion-height":["coalesce",["get","render_height"],["get","height"],6],"fill-extrusion-base":["coalesce",["get","render_min_height"],["get","min_height"],0],"fill-extrusion-opacity":.85}},r)},[]),eC=(0,l.useCallback)(e=>{ey.forEach(t=>{let r=`life-${t.id}`,a=`life-${t.id}-layer`;e.getSource(r)||e.addSource(r,{type:"raster",tiles:[t.tiles],tileSize:256}),e.getLayer(a)||e.addLayer({id:a,type:"raster",source:r,layout:{visibility:"none"},paint:{"raster-opacity":ea.current[t.id].opacity}})})},[ey]);(0,l.useEffect)(()=>{if(!e.current||t.current)return;let r=em.find(e=>e.id===v),a=r?.url??r?.style??"https://demotiles.maplibre.org/style.json";ee.current=r?.supportsTheme??!0;let l=new(s()).Map({container:e.current,style:a,center:u,zoom:14,pitch:45,bearing:-15,antialias:!0});l.addControl(new(s()).NavigationControl({showCompass:!0}),"top-right"),l.on("style.load",()=>{if(eS(l),ep.forEach(e=>{if(!e.tiles)return;let t=`gov-${e.id}`,r=`gov-${e.id}-layer`;l.getSource(t)||l.addSource(t,{type:"raster",tiles:[e.tiles],tileSize:256}),l.getLayer(r)||l.addLayer({id:r,type:"raster",source:t,layout:{visibility:"none"},paint:{"raster-opacity":Z.current[e.id]?.opacity??.6}})}),ep.forEach(e=>{if(!e.tiles)return;let t=`gov-${e.id}-layer`;if(!l.getLayer(t))return;let r=Z.current[e.id];r&&(l.setLayoutProperty(t,"visibility",r.visible?"visible":"none"),l.setPaintProperty(t,"raster-opacity",r.opacity))}),eh(l),ef(l),eC(l),ev(l),ej(l),ew(l),ez(l),ek(l),eN(l,et.current),et.current&&eP(l),el.current){let e=l.getSource("search-point");e&&e.setData({type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Point",coordinates:el.current}}]})}eb(l),ex(l),eu.current||(eu.current=!0,i(!0))}),t.current=l;let n=new ResizeObserver(()=>l.resize());return n.observe(e.current),()=>{n.disconnect(),l.remove(),t.current=null}},[]),(0,l.useEffect)(()=>{J.current=j,et.current=C,er.current=_,ea.current=T,ei.current=K,el.current=G,Z.current=X;let e=t.current;if(e&&(ep.forEach(t=>{if(!t.tiles)return;let r=`gov-${t.id}-layer`;if(!e.getLayer(r))return;let a=X[t.id];a&&(e.setLayoutProperty(r,"visibility",a.visible?"visible":"none"),e.setPaintProperty(r,"raster-opacity",a.opacity))}),ef(e),ej(e),T.amenity.visible&&ew(e),G)){let t=e.getSource("search-point");t&&t.setData({type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Point",coordinates:G}}]})}},[X,ep,_,T,K,G,ej,ew]),(0,l.useEffect)(()=>{Q.current=N},[N]),(0,l.useEffect)(()=>{let e=()=>{let e=f();(S(e),e)?z(b(document.documentElement.getAttribute("data-theme"))):z(h())},t=t=>{(t.key===p||t.key===m||t.key===y)&&e()};return window.addEventListener("storage",t),window.addEventListener(x,e),()=>{window.removeEventListener("storage",t),window.removeEventListener(x,e)}},[]),(0,l.useEffect)(()=>{if(!P)return;let e=()=>{z(b(document.documentElement.getAttribute("data-theme")))};e();let t=new MutationObserver(e);return t.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>t.disconnect()},[P]),(0,l.useEffect)(()=>{P||(window.localStorage.setItem(p,N),window.localStorage.setItem(y,"true"))},[N,P]),(0,l.useEffect)(()=>{let e=t.current;if(e){if(!j){e.getLayer("3d-buildings")&&e.removeLayer("3d-buildings"),e.easeTo({pitch:0,bearing:0,duration:450});return}eS(e),e.easeTo({pitch:45,bearing:-15,duration:450})}},[j,eS]),(0,l.useEffect)(()=>{let e=t.current;if(!e)return;let r=em.find(e=>e.id===v);if(!r)return;let a=r.url??r.style;a&&(ee.current=r.supportsTheme??!0,e.setStyle(a,{diff:!1}))},[v,em]),(0,l.useEffect)(()=>{let e=t.current;if(e&&r){if("default"===N){if("default"!==V.current){let t=em.find(e=>e.id===v),r=t?.url??t?.style;r&&e.setStyle(r,{diff:!1})}}else ex(e);V.current=N}},[N,r,ex,v,em]),(0,l.useEffect)(()=>{let e=t.current;e&&r&&eb(e)},[r,eb]),(0,l.useEffect)(()=>{if(!g)return;let e=A.trim();if(e.length<2){I([]),U(!1),H(!1);return}return en.current&&window.clearTimeout(en.current),es.current&&es.current.abort(),H(!0),en.current=window.setTimeout(async()=>{let r=new AbortController;es.current=r;try{let a=t.current,l=a?a.getCenter():{lng:u[0],lat:u[1]},i=`https://api.maptiler.com/geocoding/${encodeURIComponent(e)}.json?key=${g}&language=zh&limit=6&proximity=${l.lng},${l.lat}`,s=await fetch(i,{signal:r.signal});if(!s.ok)throw Error(`Geocoding error ${s.status}`);let n=await s.json();I(Array.isArray(n?.features)?n.features:[]),U(!0)}catch(e){if(e?.name==="AbortError")return;I([]),U(!1)}finally{H(!1)}},320),()=>{en.current&&window.clearTimeout(en.current),es.current&&es.current.abort()}},[A,g]);let eL=(0,l.useCallback)(e=>{if(!e?.center)return;let[r,a]=e.center,l=[r,a];B(l),W(l);let i=t.current;i&&i.flyTo({center:l,zoom:Math.max(i.getZoom(),16),speed:1.4}),U(!1)},[]),eM=(0,l.useCallback)(()=>{let e=t.current;if(!e)return;let r=e.getCenter();W([r.lng,r.lat]),ew(e)},[ew]);return(0,l.useEffect)(()=>{let e=t.current;if(!e||!r)return;ek(e),eN(e,C),C?eP(e):E("idle");let a=()=>{et.current&&(ec.current&&window.clearTimeout(ec.current),ec.current=window.setTimeout(()=>{eP(e)},400)),ea.current.amenity.visible&&!ei.current&&ew(e)};return e.on("moveend",a),()=>{e.off("moveend",a),ec.current&&window.clearTimeout(ec.current)}},[r,C,ek,eN,eP,ew]),(0,a.jsxs)("div",{className:"relative w-full h-full rounded-xl overflow-hidden border border-white/10 shadow-2xl",children:[(0,a.jsxs)("div",{className:"absolute top-4 left-4 z-10 rounded-full bg-zinc-900/80 px-3 py-1 text-xs text-zinc-300 border border-white/10 flex items-center gap-2",children:[(0,a.jsx)(n.A,{className:"h-3.5 w-3.5 text-cyan-400"}),"MapLibre + MapTiler"]}),(0,a.jsxs)("div",{className:"absolute top-14 left-4 z-10 w-80",children:[(0,a.jsx)("div",{className:"rounded-xl border border-white/10 bg-zinc-900/90 backdrop-blur px-3 py-2 text-xs text-zinc-200 shadow-lg",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{value:A,onChange:e=>F(e.target.value),onFocus:()=>U(!0),onKeyDown:e=>{"Enter"===e.key&&O.length>0&&eL(O[0])},placeholder:g?"搜尋地址或地標":"需要 MapTiler Key 才能搜尋",className:"flex-1 bg-transparent outline-none text-xs placeholder:text-zinc-500",disabled:!g}),q&&(0,a.jsx)("span",{className:"text-[10px] text-cyan-300",children:"搜尋中"})]})}),D&&O.length>0&&(0,a.jsx)("div",{className:"mt-2 rounded-xl border border-white/10 bg-zinc-950/95 shadow-xl overflow-hidden",children:O.map(e=>(0,a.jsxs)("button",{onMouseDown:()=>eL(e),className:"w-full text-left px-3 py-2 text-xs text-zinc-200 hover:bg-white/5 transition-colors",children:[(0,a.jsx)("div",{className:"font-medium",children:e.text||e.place_name}),e.place_name&&(0,a.jsx)("div",{className:"text-[10px] text-zinc-500",children:e.place_name})]},e.id))})]}),(0,a.jsxs)("div",{className:"absolute top-4 left-44 z-10 rounded-full bg-zinc-900/80 px-2 py-1 text-[11px] text-zinc-300 border border-white/10 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-zinc-400",children:"視角"}),(0,a.jsx)("button",{onClick:()=>k(!0),className:`rounded-full px-2 py-0.5 ${j?"bg-cyan-500/20 text-cyan-200":"text-zinc-400 hover:text-zinc-200"}`,children:"3D"}),(0,a.jsx)("button",{onClick:()=>k(!1),className:`rounded-full px-2 py-0.5 ${!j?"bg-cyan-500/20 text-cyan-200":"text-zinc-400 hover:text-zinc-200"}`,children:"平面"})]}),(0,a.jsxs)("div",{className:"absolute top-4 right-4 z-10 rounded-2xl bg-zinc-900/85 px-4 py-3 text-[11px] text-zinc-300 border border-white/10 shadow-lg space-y-3 w-64",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-xs font-semibold text-white",children:[(0,a.jsx)(o.A,{className:"h-4 w-4 text-cyan-400"}),"圖層控制"]}),(0,a.jsx)("div",{className:"space-y-3",children:ep.map(e=>{let t=X[e.id],r=!e.tiles;return(0,a.jsxs)("div",{className:r?"opacity-40":"",children:[(0,a.jsxs)("label",{className:"flex items-center justify-between gap-3 text-xs text-zinc-300",children:[(0,a.jsx)("span",{children:e.label}),(0,a.jsx)("input",{type:"checkbox",checked:t?.visible||!1,onChange:t=>Y(r=>({...r,[e.id]:{...r[e.id]||{opacity:.6,visible:!1},visible:t.target.checked}})),className:"h-4 w-4 accent-cyan-500",disabled:r})]}),(0,a.jsxs)("label",{className:"space-y-1 text-[10px] text-zinc-500",children:[(0,a.jsx)("span",{children:"透明度"}),(0,a.jsx)("input",{type:"range",min:0,max:1,step:.05,value:t?.opacity??.6,onChange:t=>Y(r=>({...r,[e.id]:{...r[e.id]||{visible:!1,opacity:.6},opacity:parseFloat(t.target.value)}})),className:"w-full",disabled:r})]}),r&&(0,a.jsx)("div",{className:"text-[10px] text-zinc-600",children:"未設定圖資 URL"})]},e.id)})}),(0,a.jsxs)("div",{className:"pt-2 border-t border-white/10 space-y-3",children:[(0,a.jsx)("div",{className:"text-xs text-white font-semibold",children:"生活機能圖層"}),ey.map(e=>{let t=T[e.id];return(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center justify-between gap-3 text-xs text-zinc-300",children:[(0,a.jsx)("span",{children:e.label}),(0,a.jsx)("input",{type:"checkbox",checked:t?.visible||!1,onChange:t=>R(r=>({...r,[e.id]:{...r[e.id],visible:t.target.checked}})),className:"h-4 w-4 accent-cyan-500"})]}),(0,a.jsxs)("label",{className:"space-y-1 text-[10px] text-zinc-500",children:[(0,a.jsx)("span",{children:"透明度"}),(0,a.jsx)("input",{type:"range",min:0,max:1,step:.05,value:t?.opacity??.6,onChange:t=>R(r=>({...r,[e.id]:{...r[e.id],opacity:parseFloat(t.target.value)}})),className:"w-full",disabled:!t?.visible})]})]},e.id)}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"flex items-center justify-between gap-3 text-xs text-zinc-300",children:[(0,a.jsx)("span",{children:"機能圈（300/600/1000m）"}),(0,a.jsx)("input",{type:"checkbox",checked:T.amenity.visible,onChange:e=>R(t=>({...t,amenity:{...t.amenity,visible:e.target.checked}})),className:"h-4 w-4 accent-cyan-500"})]}),(0,a.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:eM,className:"rounded-lg border border-white/10 px-2 py-1 text-[10px] text-zinc-300 hover:border-white/30",children:"以地圖中心"}),G&&(0,a.jsx)("span",{className:"text-[10px] text-zinc-500",children:"已套用搜尋點"})]}),(0,a.jsxs)("label",{className:"mt-2 space-y-1 text-[10px] text-zinc-500 block",children:[(0,a.jsx)("span",{children:"圈層透明度"}),(0,a.jsx)("input",{type:"range",min:0,max:1,step:.05,value:T.amenity.opacity,onChange:e=>R(t=>({...t,amenity:{...t.amenity,opacity:parseFloat(e.target.value)}})),className:"w-full",disabled:!T.amenity.visible})]})]})]}),(0,a.jsxs)("div",{className:"pt-2 border-t border-white/10 space-y-2",children:[(0,a.jsx)("div",{className:"text-xs text-white font-semibold",children:"OpenStreetMap"}),(0,a.jsxs)("label",{className:"flex items-center justify-between gap-3 text-xs text-zinc-300",children:[(0,a.jsx)("span",{children:"OSM 底圖疊加"}),(0,a.jsx)("input",{type:"checkbox",checked:_.visible,onChange:e=>$(t=>({...t,visible:e.target.checked})),className:"h-4 w-4 accent-cyan-500"})]}),(0,a.jsxs)("label",{className:"space-y-1 text-[10px] text-zinc-500",children:[(0,a.jsx)("span",{children:"疊加透明度"}),(0,a.jsx)("input",{type:"range",min:0,max:1,step:.05,value:_.opacity,onChange:e=>$(t=>({...t,opacity:parseFloat(e.target.value)})),className:"w-full",disabled:!_.visible})]}),(0,a.jsxs)("label",{className:"flex items-center justify-between gap-3 text-xs text-zinc-300",children:[(0,a.jsx)("span",{children:"建物樓層（OSM）"}),(0,a.jsx)("input",{type:"checkbox",checked:C,onChange:e=>L(e.target.checked),className:"h-4 w-4 accent-cyan-500"})]}),(0,a.jsx)("div",{className:"text-[10px] text-zinc-500",children:"放大到 16+ 才會載入"}),C&&"loading"===M&&(0,a.jsx)("div",{className:"text-[10px] text-cyan-300",children:"載入建物樓層中..."}),C&&"zoom"===M&&(0,a.jsx)("div",{className:"text-[10px] text-zinc-500",children:"請再放大一些"}),C&&"error"===M&&(0,a.jsx)("div",{className:"text-[10px] text-rose-300",children:"OSM 讀取失敗，稍後再試"})]}),(0,a.jsxs)("div",{className:"pt-2 border-t border-white/10 space-y-2",children:[(0,a.jsxs)("div",{className:"text-xs text-white font-semibold flex items-center gap-2",children:[(0,a.jsx)(n.A,{className:"h-3.5 w-3.5 text-cyan-400"}),"底圖風格（需重新載入）"]}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:em.map(e=>(0,a.jsx)("button",{onClick:()=>w(e.id),className:`rounded-lg px-2 py-1 text-[10px] border transition-colors ${v===e.id?"border-cyan-500 text-cyan-200 bg-cyan-500/10":"border-white/10 text-zinc-400 hover:border-white/30"}`,children:e.label},e.id))}),(0,a.jsx)("div",{className:"text-[10px] text-zinc-500",children:"3D 建物已啟用（縮放 15+）"})]}),(0,a.jsxs)("div",{className:"pt-2 border-t border-white/10 space-y-2",children:[(0,a.jsxs)("div",{className:"text-xs text-white font-semibold flex items-center gap-2",children:[(0,a.jsx)(c,{className:"h-3.5 w-3.5 text-cyan-400"}),"配色"]}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-2",children:["default","dark","cyberpunk","graphite","neon"].map(e=>(0,a.jsx)("button",{onClick:()=>{P||z(e)},disabled:P,className:`rounded-lg px-2 py-1 text-[10px] border transition-colors ${N===e?"border-cyan-500 text-cyan-200 bg-cyan-500/10":"border-white/10 text-zinc-400 hover:border-white/30"} ${P?"opacity-50 cursor-not-allowed":""}`,children:"default"===e?"預設":"dark"===e?"深色":"cyberpunk"===e?"賽博":"graphite"===e?"石墨":"霓虹"},e))}),(0,a.jsx)("div",{className:"text-[10px] text-zinc-500",children:P?"已跟隨網站主題（可到外觀設定關閉）":"深色系會重新套色"})]})]}),!r&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-zinc-950/70 z-20",children:(0,a.jsx)("div",{className:"text-sm text-zinc-400",children:"正在載入地圖引擎..."})}),(0,a.jsx)("div",{ref:e,className:"w-full h-full"})]})}},23879:()=>{},33024:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(78340).A)("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]])}}]);