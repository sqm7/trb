"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4488],{826:(e,t,i)=>{i.d(t,{B:()=>g});var r=i(95155),n=i(12115),a=i(47650),s=i(80642),l=i(39430),o=i(33210),c=i(44071),d=i(67514);let x="#06b6d4",h="#8b5cf6",m="#ffffff",u="#ffffff",p="#27272a",f="#9ca3af";function g({data:e}){let[t,i]=(0,n.useState)(null),[g,b]=(0,n.useState)(null),[y,v]=(0,n.useState)(null),[j,N]=(0,n.useState)(!1),w=(0,n.useRef)(null),z=(0,n.useRef)(null),S=(0,n.useRef)(null);(0,n.useEffect)(()=>{N(!0)},[]),(0,n.useEffect)(()=>{let e=e=>{let t=S.current;if(t&&!t.contains(e.target)){let t=w.current;if(t&&t.contains(e.target))return;i(null)}};if(t){let t=setTimeout(()=>{document.addEventListener("click",e)},100);return()=>{clearTimeout(t),document.removeEventListener("click",e)}}},[t]);let M=(0,n.useMemo)(()=>{if(!e||0===e.length)return null;let t=e.map(e=>[e.minPrice,e.q1Price,e.medianPrice,e.q3Price,e.maxPrice].some(e=>"number"!=typeof e||isNaN(e))?null:{category:null!==e.bathrooms?`${e.roomType}-${e.bathrooms}衛`:e.roomType,min:Math.round(e.minPrice),q1:Math.round(e.q1Price),median:Math.round(e.medianPrice),q3:Math.round(e.q3Price),max:Math.round(e.maxPrice),count:e.count}).filter(Boolean);if(0===t.length)return null;let i=t.flatMap(e=>[e.min,e.q1,e.median,e.q3,e.max]),r=Math.min(...i),n=Math.max(...i),a=n-r,s=0===a?Math.max(.1*r,100):.1*a;return{items:t,yMin:Math.max(0,r-s),yMax:n+s}},[e]),P=(0,n.useMemo)(()=>{if(!M)return null;let e=z.current?.clientWidth||800,t=e-100-40,i=t/M.items.length;return{width:e,height:450,drawWidth:t,drawHeight:330,categoryWidth:i}},[M,z.current?.clientWidth]),k=(0,n.useMemo)(()=>M&&P?e=>{let t=(e-M.yMin)/(M.yMax-M.yMin);return 40+P.drawHeight*(1-t)}:null,[M,P]),F=(0,n.useMemo)(()=>{if(!M)return[];let{yMin:e,yMax:t}=M,i=(t-e)/5;return Array.from({length:6},(t,r)=>Math.round(e+r*i))},[M]);return e&&0!==e.length&&M?(0,r.jsxs)("div",{ref:z,className:"relative w-full",children:[(0,r.jsx)("svg",{ref:w,width:"100%",height:450,className:"overflow-visible",onMouseMove:e=>{if(!w.current||!k||!M||!P)return;let t=w.current.getBoundingClientRect(),i=e.clientY-t.top;i>=40&&i<=40+P.drawHeight?v(i):v(null)},onMouseLeave:()=>{v(null)},children:P&&k&&(0,r.jsxs)(r.Fragment,{children:[F.map((e,t)=>(0,r.jsxs)("g",{children:[(0,r.jsx)("line",{x1:100,y1:k(e),x2:100+P.drawWidth,y2:k(e),stroke:p,strokeWidth:1,strokeDasharray:"4,4"}),(0,r.jsxs)("text",{x:90,y:k(e),textAnchor:"end",dominantBaseline:"middle",fill:f,fontSize:12,children:[e.toLocaleString()," 萬"]})]},`tick-${t}`)),(0,r.jsx)("text",{x:15,y:225,textAnchor:"middle",dominantBaseline:"middle",fill:f,fontSize:12,transform:`rotate(-90, 15, ${225})`,children:"房屋總價 (萬)"}),M.items.map((e,n)=>{let a=100+P.categoryWidth*(n+.5),s=30,l=15,o=k(e.max),c=k(e.q3),d=k(e.median),p=k(e.q1),y=k(e.min),v=g===n,j=t?.category===e.category;return(0,r.jsxs)("g",{className:"cursor-pointer transition-opacity",style:{opacity:null===g||v?1:.5},onMouseEnter:()=>b(n),onMouseLeave:()=>b(null),onClick:()=>i(e),children:[(0,r.jsx)("line",{x1:a,y1:c,x2:a,y2:o,stroke:m,strokeWidth:1,strokeLinecap:"round"}),(0,r.jsx)("line",{x1:a-l,y1:o,x2:a+l,y2:o,stroke:m,strokeWidth:1,strokeLinecap:"round"}),(0,r.jsx)("line",{x1:a,y1:p,x2:a,y2:y,stroke:m,strokeWidth:1,strokeLinecap:"round"}),(0,r.jsx)("line",{x1:a-l,y1:y,x2:a+l,y2:y,stroke:m,strokeWidth:1,strokeLinecap:"round"}),(0,r.jsx)("rect",{x:a-s,y:c,width:60,height:d-c,fill:x,stroke:v||j?"#ffffff":x,strokeWidth:1.5,rx:2,style:{filter:v?"brightness(1.2)":"none"}}),(0,r.jsx)("rect",{x:a-s,y:d,width:60,height:p-d,fill:h,stroke:v||j?"#ffffff":h,strokeWidth:1.5,rx:2,style:{filter:v?"brightness(1.2)":"none"}}),(0,r.jsx)("line",{x1:a-s,y1:d,x2:a+s,y2:d,stroke:u,strokeWidth:2}),(0,r.jsx)("text",{x:a,y:425,textAnchor:"middle",fill:v?"#ffffff":f,fontSize:12,fontWeight:v?"bold":"normal",children:e.category})]},e.category)}),null!==y&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("line",{x1:100,y1:y,x2:100+P.drawWidth,y2:y,stroke:"#22d3ee",strokeWidth:1,strokeDasharray:"4,4",pointerEvents:"none"}),(0,r.jsx)("rect",{x:100+P.drawWidth+5,y:y-12,width:70,height:24,rx:4,fill:"#18181b",stroke:"#22d3ee",strokeWidth:1}),(0,r.jsxs)("text",{x:100+P.drawWidth+40,y:y+4,textAnchor:"middle",fill:"#22d3ee",fontSize:11,fontWeight:"bold",children:[(e=>{if(!M||!P)return 0;let t=1-(e-40)/P.drawHeight;return Math.round(M.yMin+t*(M.yMax-M.yMin))})(y).toLocaleString()," 萬"]})]})]})}),j&&(0,a.createPortal)((0,r.jsx)(s.N,{children:t&&(0,r.jsxs)("div",{className:"fixed inset-0 z-[9998] pointer-events-none",children:[(0,r.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/50 backdrop-blur-sm pointer-events-auto",onClick:()=>i(null)}),(0,r.jsx)(l.P.div,{ref:S,initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",stiffness:400,damping:30},className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-auto w-[90vw] max-w-sm max-h-[85vh] flex flex-col",onClick:e=>e.stopPropagation(),children:(0,r.jsxs)("div",{className:"bg-zinc-900 border border-white/10 rounded-2xl shadow-2xl overflow-hidden flex flex-col",children:[(0,r.jsx)("div",{className:"bg-gradient-to-r from-cyan-500/20 to-violet-500/20 px-5 py-3 border-b border-white/10 flex-shrink-0",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-zinc-400 text-[10px] uppercase tracking-widest mb-0.5",children:"總價帶分析"}),(0,r.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,r.jsx)("div",{className:"text-white text-2xl font-black tracking-tight",children:t.category}),t.count>0&&(0,r.jsxs)("div",{className:"text-zinc-400 text-xs",children:["(",(0,r.jsx)("span",{className:"text-cyan-400 font-bold",children:t.count})," 筆)"]})]})]}),(0,r.jsx)("button",{onClick:()=>i(null),className:"p-1.5 rounded-full hover:bg-white/10 transition-colors",children:(0,r.jsx)(o.A,{className:"w-4 h-4 text-zinc-400"})})]})}),(0,r.jsxs)("div",{className:"p-4 space-y-2 overflow-y-auto flex-1 custom-scrollbar",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-lg bg-white/5 border border-white/5",children:[(0,r.jsx)(c.A,{className:"w-4 h-4 text-white/70 flex-shrink-0"}),(0,r.jsx)("div",{className:"flex-1 min-w-0",children:(0,r.jsxs)("div",{className:"flex justify-between items-baseline",children:[(0,r.jsx)("span",{className:"text-white/60 text-xs font-medium",children:"最高成交"}),(0,r.jsxs)("span",{className:"text-white text-base font-mono font-bold",children:[t.max.toLocaleString()," 萬"]})]})}),(0,r.jsx)("div",{className:"w-1 h-3 border-r border-white/50 flex-shrink-0",title:"上引線"})]}),(0,r.jsxs)("div",{className:"p-3 rounded-lg bg-cyan-500/10 border border-cyan-500/30",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1.5 mb-1",children:[(0,r.jsx)("div",{className:"w-3 h-3 rounded-[2px] bg-cyan-500"}),(0,r.jsx)("span",{className:"text-cyan-400 text-xs font-bold",children:"較高價區間 (25%)"})]}),(0,r.jsxs)("div",{className:"text-white text-lg font-mono font-bold mb-1",children:[t.median.toLocaleString()," ~ ",t.q3.toLocaleString()," 萬"]}),(0,r.jsx)("div",{className:"text-zinc-400 text-[10px] leading-tight",children:"價格偏高但屬正常範圍的交易。"})]}),(0,r.jsx)("div",{className:"flex items-center gap-3 px-3 py-2 bg-white/5 rounded-lg border border-white/5",children:(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("div",{className:"text-white text-xs font-bold",children:"中位數 (50%)"}),(0,r.jsxs)("div",{className:"text-white text-lg font-mono font-bold",children:[t.median.toLocaleString()," 萬"]})]})})}),(0,r.jsxs)("div",{className:"p-3 rounded-lg bg-violet-500/10 border border-violet-500/30",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1.5 mb-1",children:[(0,r.jsx)("div",{className:"w-3 h-3 rounded-[2px] bg-violet-500"}),(0,r.jsx)("span",{className:"text-violet-400 text-xs font-bold",children:"較低價區間 (25%)"})]}),(0,r.jsxs)("div",{className:"text-white text-lg font-mono font-bold mb-1",children:[t.q1.toLocaleString()," ~ ",t.median.toLocaleString()," 萬"]}),(0,r.jsx)("div",{className:"text-zinc-400 text-[10px] leading-tight",children:"價格偏低但屬正常範圍的交易。"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-lg bg-white/5 border border-white/5",children:[(0,r.jsx)(d.A,{className:"w-4 h-4 text-zinc-500 flex-shrink-0"}),(0,r.jsx)("div",{className:"flex-1 min-w-0",children:(0,r.jsxs)("div",{className:"flex justify-between items-baseline",children:[(0,r.jsx)("span",{className:"text-zinc-500 text-xs font-medium",children:"最低成交"}),(0,r.jsxs)("span",{className:"text-white text-base font-mono font-bold",children:[t.min.toLocaleString()," 萬"]})]})}),(0,r.jsx)("div",{className:"w-1 h-3 border-r border-zinc-600 flex-shrink-0",title:"下引線"})]})]}),(0,r.jsx)("div",{className:"px-4 py-2 bg-white/5 border-t border-white/10 flex-shrink-0",children:(0,r.jsxs)("div",{className:"text-zinc-500 text-[10px] text-center",children:["\uD83D\uDCA1 藍+紫區塊涵蓋 ",(0,r.jsx)("span",{className:"text-white font-bold",children:"50%"})," 的交易 (市場主流)"]})})]})})]})}),document.body)]}):(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無總價帶資料可顯示"})}},3083:(e,t,i)=>{i.d(t,{M:()=>s});var r=i(95155),n=i(12115),a=i(97085);function s({data:e,selectedRooms:t,metric:i}){let s=(0,n.useMemo)(()=>({count:{label:"交易筆數",unit:"筆",decimals:0},priceSum:{label:"產權總價",unit:"萬",decimals:0},areaSum:{label:"房屋坪數",unit:"坪",decimals:2}})[i],[i]),l=(0,n.useMemo)(()=>{if(!e||0===t.length)return[];let r=Object.keys(e).sort();return 0===r.length?[]:t.map(t=>({name:t,data:r.map(r=>e[r]?.[t]?.[i]||0)}))},[e,t,i]),o=(0,n.useMemo)(()=>({chart:{type:"line",height:350,background:"transparent",toolbar:{show:!0},zoom:{enabled:!1},foreColor:"#e5e7eb"},stroke:{curve:"smooth",width:2},dataLabels:{enabled:!1},xaxis:{categories:e?Object.keys(e).sort():[],labels:{style:{colors:"#9ca3af"}}},yaxis:{title:{text:s.label,style:{color:"#9ca3af"}},labels:{style:{colors:"#9ca3af"},formatter:e=>e.toLocaleString("zh-TW",{minimumFractionDigits:0,maximumFractionDigits:0})}},legend:{position:"top",horizontalAlign:"right"},tooltip:{theme:"dark",y:{formatter:e=>`${e.toLocaleString("zh-TW",{minimumFractionDigits:s.decimals,maximumFractionDigits:s.decimals})} ${s.unit}`}},grid:{borderColor:"#374151"}}),[e,s]);return e&&0!==Object.keys(e).length&&0!==t.length?(0,r.jsx)(a.A,{type:"line",series:l,options:o,height:350,className:"w-full"}):(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"請選擇房型以顯示銷售趨勢"})}},4439:(e,t,i)=>{i.d(t,{m:()=>s});var r=i(95155),n=i(12115),a=i(97085);function s({data:e,selectedRooms:t,minArea:i,maxArea:s,interval:l,onDataPointClick:o,height:c}){let d=(0,n.useMemo)(()=>[{from:0,to:0,color:"#27272a",name:"0 戶"},{from:1,to:5,color:"#facc15",name:"1-5 戶"},{from:6,to:20,color:"#fbbf24",name:"6-20 戶"},{from:21,to:50,color:"#f97316",name:"21-50 戶"},{from:51,to:1e4,color:"#dc2626",name:"> 50 戶"}],[]),{series:x,maxValue:h}=(0,n.useMemo)(()=>{if(!e||0===t.length)return{series:[],maxValue:0};let r=[];for(let e=i;e<s;e+=l){let t=Number.isInteger(l)&&Number.isInteger(i),n=t?e.toFixed(0):e.toFixed(1),a=t?(e+l).toFixed(0):(e+l).toFixed(1);r.push(`${n}-${a}`)}let n=0;return{series:r.map(r=>{let[a,l]=r.split("-").map(parseFloat);return{name:r,data:t.map(t=>{let r=(e[t]||[]).filter(e=>e>=a&&e<l&&e>=i&&e<=s).length;return r>n&&(n=r),r})}}),maxValue:n}},[e,t,i,s,l]),m=(0,n.useMemo)(()=>({chart:{type:"heatmap",height:c||Math.max(400,22*x.length),background:"transparent",toolbar:{show:!0},foreColor:"#e5e7eb",events:{dataPointSelection:(e,i,r)=>{if(o){let{seriesIndex:e,dataPointIndex:i}=r,n=r.w.globals.seriesNames[e];o(t[i],n)}}}},plotOptions:{heatmap:{radius:0,useFillColorAsStroke:!0,enableShades:!1,colorScale:{ranges:d}}},dataLabels:{enabled:!0,style:{colors:[({value:e})=>0===e?"transparent":"#e5e7eb"]},formatter:function(e){return 0===e?"":e}},xaxis:{type:"category",categories:t},title:{text:"房型面積分佈熱力圖",align:"center",style:{color:"#e5e7eb",fontSize:"16px"}},grid:{borderColor:"#374151"},tooltip:{theme:"dark",y:{formatter:e=>0===e?"無成交紀錄":`${e} 戶`}}}),[x,t,d,o]);return e&&0!==x.length?(0,r.jsx)(a.A,{type:"heatmap",series:x,options:m,height:m.chart?.height||400,className:"w-full h-full"}):(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無面積分佈資料"})}},27529:(e,t,i)=>{i.d(t,{FH:()=>l});var r=i(16385),n=i(55873);async function a(){let{data:{session:e}}=await r.N.auth.getSession();return{"Content-Type":"application/json",apikey:n.m5,Authorization:`Bearer ${e?.access_token||n.m5}`}}async function s(e){let t=await a(),i=await fetch(n.Sn.RANKING_ANALYSIS,{method:"POST",headers:t,body:JSON.stringify({filters:e})});if(!i.ok)throw Error((await i.json().catch(()=>({error:`Analysis request failed: ${i.status}`}))).error||"Analyze data failed");return i.json()}let l={checkAuth:async function(){let{data:{session:e}}=await r.N.auth.getSession();e||console.log("User not logged in, but allowing access.")},getUser:async function(){let{data:{user:e}}=await r.N.auth.getUser();return e},signOut:async function(){let{error:e}=await r.N.auth.signOut();if(e)throw console.error("Sign out failed:",e),e},fetchData:async function(e,t){let i=await a(),r=await fetch(n.Sn.QUERY_DATA,{method:"POST",headers:i,body:JSON.stringify({filters:e,pagination:t})});if(!r.ok)throw Error((await r.json().catch(()=>({error:"Failed to parse server response"}))).error||"Fetch data failed");return r.json()},analyzeData:s,analyzeProjectRanking:s,fetchSubData:async function(e,t,i){if(!e||!t||!i)throw Error(`Insufficient parameters: ${e}, ${t}, ${i}`);let r=await a(),s=await fetch(n.Sn.SUB_DATA,{method:"POST",headers:r,body:JSON.stringify({id:e,type:t,county:i})});if(!s.ok)throw Error((await s.json().catch(()=>({error:"Failed to fetch sub data"}))).error||"Fetch sub data failed");return s.json()},fetchProjectNameSuggestions:async function(e,t,i=[]){let r=await a(),s=t.replace(/\u3127/g,"一"),l=await fetch(n.Sn.PROJECT_NAMES,{method:"POST",headers:r,body:JSON.stringify({countyCode:e,query:s,districts:i,detailed:!0})});if(!l.ok)throw Error(`Server error: ${l.status}`);return l.json()},generateShareLink:async function(e){let t=await a(),i=await fetch(n.Sn.GENERATE_SHARE_LINK,{method:"POST",headers:t,body:JSON.stringify(e)});if(!i.ok)throw Error((await i.json().catch(()=>({error:"Generate share link failed"}))).error);return i.json()},getAdminUsers:async function(){let e=await a(),t=await fetch(n.Sn.GET_USERS,{method:"POST",headers:e,body:JSON.stringify({})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to fetch users"}))).error||"Fetch users failed");return t.json()}}},51806:(e,t,i)=>{i.d(t,{a:()=>l});var r=i(95155);i(12115);var n=i(33210),a=i(40980),s=i(81477);function l({isOpen:e,onClose:t,title:i,children:l,className:o,maxWidth:c="max-w-4xl"}){return e?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm animate-in fade-in duration-200",children:[(0,r.jsx)("div",{className:"absolute inset-0",onClick:t}),(0,r.jsxs)(s.Zp,{className:(0,a.cn)("relative w-full max-h-[90vh] flex flex-col overflow-hidden animate-in zoom-in-95 duration-200",c,o),onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border-default",children:[i&&(0,r.jsx)("h2",{className:"text-2xl font-bold text-white",children:i}),(0,r.jsx)("button",{onClick:t,className:"p-1 rounded-full hover:bg-white/10 transition-colors text-gray-400 hover:text-white",children:(0,r.jsx)(n.A,{size:24})})]}),(0,r.jsx)("div",{className:"p-6 overflow-y-auto custom-scrollbar",children:l})]})]}):null}},60529:(e,t,i)=>{i.d(t,{p:()=>s});var r=i(95155),n=i(12115),a=i(40980);let s=n.forwardRef(({className:e,type:t,...i},n)=>(0,r.jsx)("input",{type:t,className:(0,a.cn)("flex h-10 w-full rounded-md border border-input bg-zinc-950/50 px-3 py-2 text-sm text-zinc-100 ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:n,...i}));s.displayName="Input"},69690:(e,t,i)=>{i.d(t,{l:()=>s});var r=i(95155),n=i(12115),a=i(97085);function s({data:e,sortKey:t,limit:i=30,chartType:s="auto",height:l}){let o=(0,n.useMemo)(()=>s&&"auto"!==s?s:["averagePrice","minPrice","maxPrice","medianPrice","avgParkingPrice"].includes(t)?"bar":"treemap",[t,s]),c=(0,n.useMemo)(()=>({averagePrice:{title:"建案平均單價排行",unit:"萬/坪"},minPrice:{title:"建案最低單價排行",unit:"萬/坪"},maxPrice:{title:"建案最高單價排行",unit:"萬/坪"},medianPrice:{title:"建案單價中位數排行",unit:"萬/坪"},avgParkingPrice:{title:"車位平均單價排行",unit:"萬"},saleAmountSum:{title:"建案銷售總額佔比",unit:"萬",yLabel:"銷售總額"},houseAreaSum:{title:"建案房屋面積佔比",unit:"坪",yLabel:"房屋面積"},transactionCount:{title:"建案交易筆數佔比",unit:"筆",yLabel:"資料筆數"}})[t]||{title:"建案分析圖表",unit:"",yLabel:"數值"},[t]),d=(0,n.useMemo)(()=>{if(!e||0===e.length)return[];if("bar"!==o)return e.reduce((e,i)=>e+(i[t]||0),0),[{name:c.yLabel||c.unit,data:e.map(e=>({x:e.projectName,y:parseFloat((e[t]||0).toFixed(2))}))}];{let r=[...e].filter(e=>e[t]>0).sort((e,i)=>i[t]-e[t]).slice(0,i);return[{name:c.unit,data:r.map(e=>parseFloat((e[t]||0).toFixed(2)))}]}},[e,t,o,c,i]),x=(0,n.useMemo)(()=>{let r={title:{text:c.title,align:"center",style:{fontSize:"16px",fontWeight:600,color:"#e5e7eb"}}};if("bar"===o){let n=[...e].filter(e=>e[t]>0).sort((e,i)=>i[t]-e[t]).slice(0,i).map(e=>e.projectName);return{...r,chart:{type:"bar",toolbar:{show:!0},animations:{enabled:!1}},tooltip:{theme:"dark",y:{formatter:e=>`${e.toLocaleString()} ${c.unit}`,title:{formatter:(e,t)=>{let i=n[t?.dataPointIndex];return i?`${i}:`:`${e}:`}}},x:{show:!0,formatter:(e,t)=>n[t?.dataPointIndex]||e}},plotOptions:{bar:{horizontal:!1,columnWidth:"60%",borderRadius:4,distributed:!1}},colors:["#8b5cf6"],fill:{type:"gradient",gradient:{shade:"dark",type:"vertical",shadeIntensity:.5,gradientToColors:["#a78bfa"],inverseColors:!0,opacityFrom:1,opacityTo:1,stops:[0,100]}},dataLabels:{enabled:!1},xaxis:{categories:n,labels:{style:{colors:"#9ca3af"},rotate:-45,trim:!0,maxHeight:100}},yaxis:{title:{text:c.unit,style:{color:"#6b7280"}},labels:{style:{colors:"#e5e7eb",fontSize:"12px",fontWeight:500}}},legend:{show:!1}}}{let i=e.reduce((e,i)=>e+(i[t]||0),0);return{...r,tooltip:{theme:"dark",y:{formatter:e=>`${e.toLocaleString()} ${c.unit}`}},chart:{type:"treemap",height:450,toolbar:{show:!0}},plotOptions:{treemap:{distributed:!0,enableShades:!1,colorScale:{ranges:[{from:0,to:.1*i,color:"#06b6d4"},{from:.1*i,to:.3*i,color:"#3b82f6"},{from:.3*i,to:.6*i,color:"#8b5cf6"},{from:.6*i,to:1/0,color:"#d946ef"}]}}},dataLabels:{enabled:!0,style:{fontSize:"11px",fontWeight:500,colors:["#fff"]},formatter:e=>e,offsetY:-2}}}},[o,d,c,e,t,i]);if(!e||0===e.length)return(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無排名資料可顯示"});let h="bar"===o&&d[0]?.data?d[0].data.length:0,m="bar"===o?{width:"100%",minWidth:`${45*h}px`}:{width:"100%"};return(0,r.jsx)("div",{className:`w-full ${"bar"===o?"overflow-x-auto pb-4":""}`,children:(0,r.jsx)("div",{style:m,children:(0,r.jsx)(a.A,{type:"bar"===o?"bar":"treemap",series:d,options:x,height:l||450,className:"w-full"})})})}},70872:(e,t,i)=>{i.d(t,{Bc:()=>l,ZI:()=>d,k$:()=>c,m_:()=>o});var r=i(95155),n=i(12115),a=i(45828),s=i(40980);let l=a.Kq,o=a.bL,c=a.l9,d=n.forwardRef(({className:e,sideOffset:t=4,...i},n)=>(0,r.jsx)(a.UC,{ref:n,sideOffset:t,className:(0,s.cn)("z-50 overflow-hidden rounded-md border border-zinc-800 bg-zinc-950 px-3 py-1.5 text-sm text-zinc-100 shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...i}));d.displayName=a.UC.displayName},81477:(e,t,i)=>{i.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>o,Zp:()=>s,aR:()=>l});var r=i(95155),n=i(12115),a=i(40980);let s=n.forwardRef(({className:e,...t},i)=>(0,r.jsx)("div",{ref:i,className:(0,a.cn)("glass-panel rounded-xl text-card-foreground",e),...t}));s.displayName="Card";let l=n.forwardRef(({className:e,...t},i)=>(0,r.jsx)("div",{ref:i,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",e),...t}));l.displayName="CardHeader";let o=n.forwardRef(({className:e,...t},i)=>(0,r.jsx)("h3",{ref:i,className:(0,a.cn)("text-lg font-semibold leading-none tracking-tight text-white",e),...t}));o.displayName="CardTitle";let c=n.forwardRef(({className:e,...t},i)=>(0,r.jsx)("p",{ref:i,className:(0,a.cn)("text-sm text-zinc-400",e),...t}));c.displayName="CardDescription";let d=n.forwardRef(({className:e,...t},i)=>(0,r.jsx)("div",{ref:i,className:(0,a.cn)("p-6 pt-0",e),...t}));d.displayName="CardContent",n.forwardRef(({className:e,...t},i)=>(0,r.jsx)("div",{ref:i,className:(0,a.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"},88042:(e,t,i)=>{i.d(t,{$:()=>c});var r=i(95155),n=i(12115),a=i(47650),s=i(40980),l=i(60529);let o=({children:e,x:t,y:i,visible:s})=>{let[l,o]=(0,n.useState)(!1);return((0,n.useEffect)(()=>(o(!0),()=>o(!1)),[]),l&&s&&!("u"<typeof document))?(0,a.createPortal)((0,r.jsx)("div",{className:"fixed pointer-events-none z-[9999]",style:{left:t,top:i,transform:"translate(-50%, -100%) translateY(-12px)"},children:e}),document.body):null};function c({data:e,minPrice:t,maxPrice:i,interval:a,sizeMetric:c,onMinPriceChange:d,onMaxPriceChange:x,onIntervalChange:h,onSizeMetricChange:m}){let[u,p]=(0,n.useState)("natural"),[f,g]=(0,n.useState)(null),[b,y]=(0,n.useState)({x:0,y:0}),v=(0,n.useRef)(null),[j,N]=(0,n.useState)({width:0,height:0});(0,n.useEffect)(()=>{if(!v.current)return;let e=()=>{v.current&&N({width:v.current.clientWidth,height:v.current.clientHeight})};e(),window.addEventListener("resize",e);let t=setTimeout(e,200);return()=>{window.removeEventListener("resize",e),clearTimeout(t)}},[]);let w=(e,t)=>{let i=e.currentTarget.getBoundingClientRect();y({x:i.left+i.width/2,y:i.top}),g(t)},{buckets:z,validBuckets:S,maxValue:M}=(0,n.useMemo)(()=>{if(!e||0===e.length)return{buckets:[],validBuckets:[],maxValue:0};let r=[];for(let e=t;e<i;e+=a)r.push({min:e,max:Math.min(e+a,i),label:`${e}-${Math.min(e+a,i)}`,count:0,totalArea:0,avgPrice:0,transactions:[]});e.forEach(e=>{let n=e["房屋單價(萬)"],s=e["房屋面積(坪)"]||0;if("number"!=typeof n||n<t||n>=i)return;let l=Math.floor((n-t)/a);l>=0&&l<r.length&&(r[l].count++,r[l].totalArea+=s,r[l].transactions.push(e))});let n=r.filter(e=>e.count>0),s=Math.max(...n.map(e=>"count"===c?e.count:e.totalArea));return{buckets:r,validBuckets:n,maxValue:s}},[e,t,i,a,c]),{nodes:P,onMouseDown:k,dragId:F}=((e,t,i,r,a,s)=>{let[l,o]=(0,n.useState)([]),c=(0,n.useRef)(null),d=(0,n.useRef)(null),x=(0,n.useRef)(null);return(0,n.useEffect)(()=>{if(!e.length||!t||!i)return;let n=t/2,s=i/2,l=e.map((e,t)=>{let i="count"===r?e.count:e.totalArea,n=a>0?30+i/a*80:30;return{id:e.label,value:i,radius:n/2,x:0,y:0,vx:0,vy:0,origIndex:t}});l.sort((e,t)=>e.value-t.value),l=l.map((e,t)=>{let i=2.39996*t,r=10*Math.sqrt(t)*2.5;return{...e,x:n+Math.cos(i)*r,y:s+Math.sin(i)*r}});for(let e=0;e<120;e++)for(let e=0;e<l.length;e++)for(let t=e+1;t<l.length;t++){let i=l[e],r=l[t],n=r.x-i.x,a=r.y-i.y,s=n*n+a*a,o=i.radius+r.radius+5;if(s<o*o&&s>0){let e=Math.sqrt(s),t=o-e,l=n/e,c=a/e,d=.5*t;i.x-=l*d,i.y-=c*d,r.x+=l*d,r.y+=c*d}}o(l)},[e,t,i,r,a]),(0,n.useEffect)(()=>{if(!s)return;let e=e=>{x.current={x:e.clientX,y:e.clientY}},t=()=>{d.current=null,x.current=null};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[s]),(0,n.useEffect)(()=>{if(!s||0===l.length||!t)return;let e=t/2,r=i/2,n=()=>{o(t=>{let i=t.map(e=>({...e})),n=0,a=0,s=0,l=0;d.current&&x.current&&(n=x.current.x-d.current.startX,a=x.current.y-d.current.startY,s=d.current.nodeOrigX+n,l=d.current.nodeOrigY+a),i.forEach(t=>{if(d.current?.id===t.id)t.x=s,t.y=l,t.vx=0,t.vy=0;else{let i=e-t.x,n=r-t.y;t.vx+=.05*i*.05,t.vy+=.05*n*.05,t.vx+=(Math.random()-.5)*.003,t.vy+=(Math.random()-.5)*.003,t.x+=t.vx,t.y+=t.vy,t.vx*=.94,t.vy*=.94}});for(let e=0;e<6;e++)for(let e=0;e<i.length;e++)for(let t=e+1;t<i.length;t++){let r=i[e],n=i[t],a=d.current?.id===r.id,s=d.current?.id===n.id,l=n.x-r.x,o=n.y-r.y,c=l*l+o*o,x=r.radius+n.radius+5;if(c<x*x&&c>0){let e=Math.sqrt(c),t=x-e,i=l/e,d=o/e,h=.5*t;a?(n.x+=i*t,n.y+=d*t):s?(r.x-=i*t,r.y-=d*t):(r.x-=i*h,r.y-=d*h,n.x+=i*h,n.y+=d*h)}}return i}),c.current=requestAnimationFrame(n)};return c.current=requestAnimationFrame(n),()=>{null!==c.current&&cancelAnimationFrame(c.current)}},[s,t,i,l.length]),{nodes:l,onMouseDown:(e,t,i,r)=>{e.preventDefault(),d.current={id:t,startX:e.clientX,startY:e.clientY,nodeOrigX:i,nodeOrigY:r},x.current={x:e.clientX,y:e.clientY}},dragId:d.current?.id}})(S,j.width,j.height,c,M,"natural"===u);if(!e||0===e.length)return(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無交易資料可顯示"});let C=(e,t)=>{let i,r,n=e/(t-1||1);return n<.33?(i="radial-gradient(circle at 30% 30%, rgb(167, 139, 250), rgb(124, 58, 237))",r="rgba(124, 58, 237, 0.4)"):n<.66?(i="radial-gradient(circle at 30% 30%, rgb(34, 211, 238), rgb(8, 145, 178))",r="rgba(8, 145, 178, 0.4)"):(i="radial-gradient(circle at 30% 30%, rgb(52, 211, 153), rgb(5, 150, 105))",r="rgba(5, 150, 105, 0.4)"),{background:i,shadowColor:r}},$=null!==f?S[f]:null;return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(o,{x:b.x,y:b.y,visible:null!==f&&!!$&&!F,children:$&&(0,r.jsxs)("div",{className:"px-4 py-3 bg-zinc-900/90 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl min-w-[160px] animate-in fade-in zoom-in-95 duration-200",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-xs font-medium text-zinc-400",children:"成交單價"}),(0,r.jsx)("span",{className:"text-sm font-bold text-white",children:$.label})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center text-xs",children:[(0,r.jsx)("span",{className:"text-zinc-500",children:"成交筆數"}),(0,r.jsxs)("span",{className:"font-medium text-violet-300",children:[$.count," 筆"]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center text-xs",children:[(0,r.jsx)("span",{className:"text-zinc-500",children:"總銷坪數"}),(0,r.jsxs)("span",{className:"font-medium text-cyan-300",children:[Math.round($.totalArea)," 坪"]})]})]}),(0,r.jsx)("div",{className:"absolute left-1/2 bottom-0 -mb-1 w-2 h-2 bg-zinc-900/90 border-r border-b border-white/10 rotate-45 -translate-x-1/2"})]})}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4 p-4 bg-zinc-900/30 border border-white/5 rounded-xl",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-zinc-400 text-xs",children:"單價範圍"}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(l.p,{type:"number",value:t,onChange:e=>d(Number(e.target.value)),className:"w-16 h-7 text-xs bg-zinc-950/50 border-white/10 px-2"}),(0,r.jsx)("span",{className:"text-zinc-600",children:"-"}),(0,r.jsx)(l.p,{type:"number",value:i,onChange:e=>x(Number(e.target.value)),className:"w-16 h-7 text-xs bg-zinc-950/50 border-white/10 px-2"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-zinc-400 text-xs",children:"級距"}),(0,r.jsx)(l.p,{type:"number",value:a,onChange:e=>h(Number(e.target.value)),className:"w-14 h-7 text-xs bg-zinc-950/50 border-white/10 px-2"})]}),(0,r.jsxs)("div",{className:"flex bg-zinc-950/50 rounded-md p-0.5 border border-white/10",children:[(0,r.jsx)("button",{onClick:()=>m("count"),className:(0,s.cn)("px-2.5 py-1 text-[10px] rounded transition-colors","count"===c?"bg-violet-500 text-white shadow-sm":"text-zinc-400 hover:text-white"),children:"成交筆數"}),(0,r.jsx)("button",{onClick:()=>m("area"),className:(0,s.cn)("px-2.5 py-1 text-[10px] rounded transition-colors","area"===c?"bg-violet-500 text-white shadow-sm":"text-zinc-400 hover:text-white"),children:"總銷坪數"})]})]}),(0,r.jsxs)("div",{className:"bg-zinc-950/50 p-1 rounded-lg border border-white/5 flex gap-1",children:[(0,r.jsx)("button",{onClick:()=>p("natural"),className:(0,s.cn)("px-3 py-1.5 text-xs font-medium rounded-md transition-all duration-300","natural"===u?"bg-gradient-to-r from-violet-600 to-indigo-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-500 hover:text-zinc-300"),children:(0,r.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,r.jsxs)("span",{className:"relative flex h-2 w-2",children:[(0,r.jsx)("span",{className:(0,s.cn)("absolute inline-flex h-full w-full rounded-full bg-violet-400 opacity-75","natural"===u&&"animate-ping")}),(0,r.jsx)("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-violet-500"})]}),"無重力模式"]})}),(0,r.jsx)("button",{onClick:()=>p("coordinate"),className:(0,s.cn)("px-3 py-1.5 text-xs font-medium rounded-md transition-all duration-300","coordinate"===u?"bg-gradient-to-r from-violet-600 to-indigo-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-500 hover:text-zinc-300"),children:(0,r.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,r.jsxs)("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,r.jsx)("path",{d:"M3 3v18h18"}),(0,r.jsx)("path",{d:"M18 17V9"}),(0,r.jsx)("path",{d:"M13 17V5"}),(0,r.jsx)("path",{d:"M8 17v-3"})]}),"座標模式"]})})]})]}),(0,r.jsxs)("div",{ref:v,className:(0,s.cn)("relative rounded-3xl overflow-hidden border border-white/5 transition-all duration-500","bg-gradient-to-b from-zinc-900 via-zinc-900 to-zinc-950","h-full min-h-[500px]"),children:[(0,r.jsxs)("div",{className:"absolute inset-0 pointer-events-none",children:[(0,r.jsx)("div",{className:"absolute top-0 inset-x-0 h-px bg-gradient-to-r from-transparent via-white/10 to-transparent"}),(0,r.jsx)("div",{className:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-violet-500/10 rounded-full blur-[100px]"}),(0,r.jsx)("div",{className:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-cyan-500/10 rounded-full blur-[100px]"})]}),(0,r.jsxs)("div",{className:"absolute inset-0",children:["natural"===u&&(0,r.jsxs)("div",{className:"absolute inset-0",children:[P.map((e,t)=>{let i=f===e.origIndex,n=F===e.id,a=C(e.origIndex,S.length),l=2*e.radius;return(0,r.jsxs)("div",{className:(0,s.cn)("absolute block rounded-full select-none cursor-grab active:cursor-grabbing will-change-transform",n?"z-[100] scale-110 shadow-2xl":"transition-[transform,box-shadow] duration-75 ease-linear"),style:{width:l,height:l,left:0,top:0,transform:`translate(${e.x-e.radius}px, ${e.y-e.radius}px) scale(${i||n?1.1:1})`,background:a.background,boxShadow:n?`0 25px 50px -12px ${a.shadowColor}, inset 0 2px 20px rgba(255,255,255,0.6)`:i?`0 20px 40px -10px ${a.shadowColor}, inset 0 2px 20px rgba(255,255,255,0.4)`:`0 10px 30px -10px ${a.shadowColor}, inset 0 2px 10px rgba(255,255,255,0.2)`,zIndex:n?100:i?50:10},onMouseEnter:t=>w(t,e.origIndex),onMouseLeave:()=>g(null),onMouseDown:t=>k(t,e.id,e.x,e.y),children:[(0,r.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-white/0 via-white/0 to-white/30 opacity-50 pointer-events-none"}),(0,r.jsx)("div",{className:"absolute top-[15%] left-[15%] w-[25%] h-[15%] rounded-[100%] bg-white blur-[2px] opacity-40 transform -rotate-45 pointer-events-none"}),(0,r.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-center z-20 pointer-events-none",children:[(0,r.jsx)("div",{className:(0,s.cn)("font-bold text-white drop-shadow-md leading-none",l>80?"text-2xl":l>60?"text-lg":"text-sm","mix-blend-overlay opacity-90"),children:e.value>=1?Math.round(e.value):e.value.toFixed(1)}),l>80&&(0,r.jsx)("div",{className:"text-[10px] text-white/70 mt-1 font-medium tracking-wide",children:"count"===c?"筆":"坪"})]})]},e.id)}),(0,r.jsx)("div",{className:"absolute bottom-4 left-0 right-0 text-center text-xs text-zinc-500 font-medium tracking-widest uppercase opacity-50 pointer-events-none",children:"Zero Gravity • Force Layout • Draggable"})]}),"coordinate"===u&&(0,r.jsxs)("div",{className:"absolute inset-0 pt-6 pb-8 px-0",children:[(0,r.jsx)("div",{className:"flex flex-col justify-between h-full py-0 pr-1 text-right w-[46px] border-r border-white/5 relative z-10 float-left",children:[...Array(6)].map((e,n)=>(0,r.jsx)("span",{className:"text-xs font-mono text-zinc-600 block leading-none transform -translate-y-1/2 first:translate-y-0 last:-translate-y-full",children:Math.round(i-(i-t)/5*n)},n))}),(0,r.jsxs)("div",{className:"relative ml-[46px] h-full",children:[(0,r.jsx)("div",{className:"absolute inset-0 flex flex-col justify-between pointer-events-none",children:[...Array(6)].map((e,t)=>(0,r.jsx)("div",{className:"w-full h-px border-t border-dashed border-zinc-800"},t))}),(0,r.jsx)("div",{className:"absolute inset-0",children:S.map((e,n)=>{var a;let l=(a="count"===c?e.count:e.totalArea,0===M?40:40+a/M*100),o=(e.min+e.max)/2,d=n/(S.length-1||1)*90+5,x=100-(o-t)/(i-t)*100,h=f===n,m=C(n,S.length);return(0,r.jsx)("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 transition-all duration-500",style:{left:`${d}%`,top:`${x}%`,zIndex:h?50:20},onMouseEnter:e=>w(e,n),onMouseLeave:()=>g(null),children:(0,r.jsx)("div",{className:(0,s.cn)("relative rounded-full flex items-center justify-center cursor-pointer shadow-lg transition-transform duration-300",h?"scale-110":"scale-100"),style:{width:l,height:l,background:m.background,boxShadow:h?`0 10px 20px -5px ${m.shadowColor}, inset 0 2px 10px rgba(255,255,255,0.3)`:`0 5px 15px -5px ${m.shadowColor}, inset 0 2px 5px rgba(255,255,255,0.2)`},children:(0,r.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-transparent to-white/30 opacity-60"})})},e.label)})}),(0,r.jsxs)("div",{className:"absolute bottom-0 inset-x-0 flex justify-between text-xs text-zinc-600 font-mono translate-y-full pt-1 px-2",children:[(0,r.jsx)("span",{children:"Low Price"}),(0,r.jsx)("span",{children:"High Price"})]})]})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between px-2 text-xs text-zinc-500",children:[(0,r.jsxs)("div",{children:["* Bubble size represents ","count"===c?"Transaction Count":"Total Area"]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-violet-500"}),(0,r.jsx)("span",{children:"Low"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-cyan-500"}),(0,r.jsx)("span",{children:"Mid"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),(0,r.jsx)("span",{children:"High"})]})]})]})]})}},88743:(e,t,i)=>{i.d(t,{M:()=>a,P:()=>s});var r=i(1934);let n={counties:[],districts:[],transactionType:"預售交易",buildingType:"",projectNames:[],dateRange:"1y",startDate:"",endDate:"",excludeCommercial:!1,floorPremium:.3,rankingCurrentPage:1,rankingPageSize:10,currentSort:{key:"saleAmountSum",order:"desc"},currentAverageType:"arithmetic",velocityView:"monthly",velocityMetric:"count",activeTab:"ranking",isFilterBarCompact:!1,analysisData:null,selectedRoomTypes:["套房","1房","2房","3房","4房","毛胚"]},a=["套房","1房","2房","3房","4房","毛胚","店舖","辦公/事務所","廠辦/工廠","其他"],s=(0,r.v)(e=>({...n,setCounties:t=>e({counties:t,districts:[]}),setDistricts:t=>e({districts:t}),setTransactionType:t=>e({transactionType:t}),setBuildingType:t=>e({buildingType:t}),setProjectNames:t=>e({projectNames:t}),setDateRange:(t,i,r)=>e(e=>({dateRange:t,startDate:i||e.startDate,endDate:r||e.endDate})),setCustomDate:(t,i)=>e({startDate:t,endDate:i,dateRange:"custom"}),setExcludeCommercial:t=>e({excludeCommercial:t}),setFloorPremium:t=>e({floorPremium:t}),setRankingCurrentPage:t=>e({rankingCurrentPage:t}),setRankingPageSize:t=>e({rankingPageSize:t}),setCurrentSort:t=>e({currentSort:t}),setCurrentAverageType:t=>e({currentAverageType:t}),setVelocityView:t=>e({velocityView:t}),setVelocityMetric:t=>e({velocityMetric:t}),setActiveTab:t=>e({activeTab:t}),setIsFilterBarCompact:t=>e({isFilterBarCompact:t}),setAnalysisData:t=>e({analysisData:t}),setSelectedRoomTypes:t=>e({selectedRoomTypes:t}),resetFilters:()=>e(n),hydrateFilters:t=>e(e=>({...e,...t}))}))},89579:(e,t,i)=>{i.d(t,{B$:()=>s});class r{constructor(){this.knownPatterns=new Map,this.patternFrequency=new Map,this.initializeBasePatterns()}initializeBasePatterns(){[{id:"unit_slash_floorF_format",name:"戶號斜線樓層F格式",regex:/^([A-Z]\d+)\/(\d+)F[號号]?$/i,extract:(e,t)=>{let i=e[1],r=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?i:i+r},confidence:100,priority:.01},{id:"building_unit_floor_combined",name:"棟別戶號樓層合併格式",regex:/^([A-Z])棟(\d+)-(\d+)[號号]?$/i,extract:(e,t)=>{let i=e[1],r=e[2],n=e[3];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?i+r:i+r+n},confidence:100,priority:.02},{id:"building_unit_floorF_format_v2",name:"棟別戶號樓層F格式v2",regex:/^([A-Z])棟(\d+)-(\d+)F[號号]?$/i,extract:(e,t)=>{let i=e[1],r=e[2],n=e[3];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?i+r:i+r+n},confidence:100,priority:.03},{id:"unit_building_zero_format",name:"戶號棟別0號格式",regex:/^([A-Z]\d+)棟0[號号]?$/i,extract:e=>e[1],confidence:100,priority:.04},{id:"single_letter_unit",name:"單字母戶號格式",regex:/^([A-Z])[號号]$/i,extract:e=>e[1],confidence:95,priority:.045},{id:"building_floor_unit_letter_format",name:"棟別樓層數字戶型字母格式",regex:/^([A-Z])棟(\d+)([A-Z])[號号]?$/i,extract:(e,t)=>{let i=e[1],r=parseInt(e[2],10),n=e[3];return t?.floor&&r===parseInt(t.floor,10)?n:`${i}${r}${n}`},confidence:99,priority:.05},{id:"building_floor_unit_format",name:"棟別樓層戶號格式",regex:/^([A-Z])棟(\d{1,2})F-(\d+)[號号]?$/,extract:(e,t)=>{let i=e[1],r=e[2],n=e[3];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?i+n:i+r+n},confidence:99,priority:.1},{id:"letter_number_floor_format",name:"字母數字-樓層F格式",regex:/^([A-Z])0*(\d+)-(\d{1,2})F[號号]?$/,extract:(e,t)=>{let i=e[1],r=e[2],n=e[3];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?i+r:i+r+n},confidence:99,priority:.15},{id:"identifier_building_floor_redundant",name:"識別碼棟與F樓層格式(贅余樓層)",regex:/^([A-Z]\d+)棟F(\d+)[號号]?$/i,extract:(e,t)=>{let i=e[1],r=e[2],n=i.match(/^[A-Z]+/)?.[0]||"",a=parseInt(i.match(/\d+/)?.[0]||"0",10),s=`${n}${a}`;return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?s:s+"F"+r},confidence:98,priority:.18},{id:"identifier_building_floorF_format",name:"識別碼棟與樓層F格式(贅余樓層)",regex:/^([A-Z]\d+)棟(\d{1,2})F[號号]?$/i,extract:(e,t)=>{let i=e[1],r=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?i:i+r},confidence:98,priority:.19},{id:"unit_building_floor_format",name:"戶棟樓層格式",regex:/^([A-Z]\d+)戶棟(\d+)F[號号]?$/,extract:(e,t)=>{let i=e[1],r=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?i:i+r},confidence:99,priority:.2},{id:"building_sub_unit_floor_format",name:"棟別子戶號樓層格式",regex:/^([A-Z])棟(\d+)-(\d+)F[號号]?$/,extract:(e,t)=>{let i=e[1],r=e[2],n=e[3];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?i+r:i+r+n},confidence:99,priority:.3},{id:"building_unit_floor_format",name:"棟別戶別樓層格式",regex:/^([A-Z])棟([A-Z])-(\d{1,2})F[號号]?$/,extract:(e,t)=>{let i=e[2],r=e[3];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?i:i+r},confidence:99,priority:.4},{id:"building_self_unit_floor_format",name:"棟別自身戶號樓層格式",regex:/^([A-Z])棟\1-(\d+)[號号]?$/,extract:(e,t)=>{let i=e[1],r=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?i:i+r},confidence:98,priority:.45},{id:"building_unit_letter_floor_number",name:"棟別戶號字母樓層數字格式",regex:/^([A-Z])棟([A-Z])(\d{1,2})[號号]?$/,extract:(e,t)=>{let i=e[2],r=e[3];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?i:i+r},confidence:98,priority:.46},{id:"redundant_building_format",name:"重複棟別格式",regex:/^([A-Z])棟\1-(\d{1,2})F[號号]?$/,extract:(e,t)=>{let i=e[1],r=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?i:i+r},confidence:98,priority:.5},{id:"building_floor_letter_unit",name:"棟別樓層字母戶號格式",regex:/^[A-Z]棟(\d{1,2})F-([A-Z])[號号]?$/,extract:(e,t)=>{let i=e[1],r=e[2];return t?.floor&&parseInt(i,10)===parseInt(t.floor,10)?r:r+i},confidence:98,priority:.6},{id:"letter_leading_zero_unit",name:"字母與0開頭數字戶號",regex:/^([A-Z])0+(\d+)[號号]?$/,extract:e=>e[1]+e[2],confidence:97,priority:.7},{id:"floor_prefix_format",name:"樓層前綴格式",regex:/^(\d{1,2})([A-Z])[號号]?$/,extract:(e,t)=>{let i=e[1],r=e[2];return t?.floor&&parseInt(i,10)===parseInt(t.floor,10)?r:i+r},confidence:96,priority:.8},{id:"floorF_building_unit_format",name:"樓層F棟戶號格式",regex:/^(\d{1,2})F棟([A-Z])[號号]?$/,extract:(e,t)=>{let i=e[1],r=e[2];return t?.floor&&parseInt(i,10)===parseInt(t.floor,10)?r:i+r},confidence:98,priority:.85},{id:"numericBuilding_floor_unit_format",name:"數字棟別樓層戶號格式",regex:/^(\d+)棟(\d{1,2})([A-Z])[號号]?$/,extract:(e,t)=>{let i=e[2],r=e[3];return t?.floor&&parseInt(i,10)===parseInt(t.floor,10)?r:i+r},confidence:98,priority:.86},{id:"floor_first_detailed",name:"樓層優先詳細格式",regex:/(\d{1,2})F-([A-Z])(\d{2})/,extract:e=>e[2]+e[3],confidence:95,priority:1},{id:"floor_prefix_complex_unit",name:"樓層前綴複合戶號",regex:/^(\d{1,2})F-([A-Z]\d+)[號号]?$/,extract:(e,t)=>{let i=e[1],r=e[2];return t?.floor&&parseInt(i,10)===parseInt(t.floor,10)?r:i+r},confidence:94,priority:1.2},{id:"floor_first_simple_letter",name:"樓層優先簡單字母格式",regex:/^(\d{1,2})F-([A-Z])[號号]?$/,extract:(e,t)=>{let i=e[1],r=e[2];return t?.floor&&parseInt(i,10)===parseInt(t.floor,10)?r:i+r},confidence:90,priority:1.5},{id:"building_with_unit",name:"棟別完整戶號",regex:/([A-Z])棟([A-Z])(\d{1,2})(?:-(\d{1,2})F?[號号])?/,extract:e=>e[2]+e[3],confidence:90,priority:2,conditions:[{type:"building_match",validator:e=>{let t=e.rawUnit.match(/([A-Z])棟([A-Z])/);return!!t&&t[1]===t[2]}}]},{id:"building_simple_letter_unit",name:"棟別字母戶號格式",regex:/^[A-Z]棟([A-Z])[號号]?$/,extract:e=>e[1],confidence:92,priority:2.5},{id:"unit_floor_suffix",name:"戶號樓層後綴",regex:/([A-Z]\d{1,2})-(\d{1,2})F?[號号]?/,extract:e=>e[1],confidence:85,priority:3},{id:"building_floor_format",name:"棟別樓層格式",regex:/^([A-Z]\d{1,2})棟(\d{1,2})(?:F|樓)[號号]?$/,extract:(e,t)=>{let i=e[1],r=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?i:i+r},confidence:88,priority:3.5},{id:"building_complex_number",name:"複合棟別編號",regex:/^([A-Z]\d+)棟(\d+)[號号]$/,extract:(e,t)=>{let i=e[1],r=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?i:i+r},confidence:86,priority:3.8},{id:"building_floor_F_format",name:"棟別樓層F格式",regex:/^([A-Z])棟(\d{1,2})F[號号]?$/,extract:(e,t)=>{let i=e[1],r=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?i:i+r},confidence:87,priority:3.9},{id:"building_zero_placeholder_unit",name:"棟別0號佔位符格式",regex:/^([A-Z])棟0[號号]?$/,extract:e=>e[1],confidence:95,priority:3.95},{id:"building_simple_number",name:"棟別簡單編號",regex:/([A-Z])棟(\d{1,2})[號号]/,extract:(e,t)=>{let i=e[1],r=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?i:i+r},confidence:85,priority:4},{id:"unit_floor_concatenated",name:"複合戶號樓層格式",regex:/^([A-Z])(\d+)F[號号]?$/,extract:(e,t)=>{let i=e[1],r=e[2],n=t?.floor;if(n){let e=parseInt(n,10);if(!isNaN(e)){if(e<10){let e="0"+n;if(r.endsWith(e))return i+r.substring(0,r.length-2)}if(r.endsWith(n))return i+r.substring(0,r.length-n.length)}}return i+r},confidence:80,priority:4.5},{id:"letter_floor",name:"字母樓層格式",regex:/^([A-Z])-(\d{1,2})F?[號号]?$/,extract:(e,t)=>{let i=e[2];return t?.floor&&parseInt(i,10)===parseInt(t.floor,10)?e[1]:e[1]+i},confidence:70,priority:5}].forEach(e=>{this.knownPatterns.set(e.id,e)})}detectPattern(e,t){let i=this.normalizeText(e),r=null;for(let e of Array.from(this.knownPatterns.values()).sort((e,t)=>e.priority-t.priority)){let n=i.match(e.regex);if(n){if(e.conditions&&t&&!e.conditions.every(e=>e.validator(t)))continue;r={rule:e,match:n};break}}return r&&this.patternFrequency.set(r.rule.id,(this.patternFrequency.get(r.rule.id)||0)+1),r}normalizeText(e){return e?e.toUpperCase().replace(/[\uff01-\uff5e]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248)).replace(/\s+/g,""):""}}class n{analyzeProject(e,t){let i={projectName:e,patterns:new Map,unitMappings:new Map,namingStyle:"unknown"},n=new r;for(let r of t){let t=r["戶別"],a=r["樓層"];if(!t)continue;let s={rawUnit:t,floor:a?String(a):void 0,projectName:e},l=n.detectPattern(t,s);if(l){let e=l.rule;i.patterns.has(e.id)||i.patterns.set(e.id,{patternId:e.id,count:0,examples:[],confidence:e.confidence});let r=i.patterns.get(e.id);r.count++,r.examples.length<10&&r.examples.push(t)}i.unitMappings.has(t)||i.unitMappings.set(t,{floors:new Set,rawVariations:new Set([t])});let o=i.unitMappings.get(t);a&&o.floors.add(String(a))}return this.determineNamingStyle(i),this.projectProfiles.set(e,i),i}determineNamingStyle(e){let t=e.patterns.size,i=Array.from(e.patterns.values()).reduce((e,t)=>e+t.count,0);if(0===t){e.namingStyle="unknown";return}let r=null,n=0;for(let t of e.patterns.values())t.count>n&&(n=t.count,r=t);r&&(e.dominantPattern=r.patternId,r.count/i>.8?e.namingStyle="consistent":e.namingStyle="mixed")}getProjectProfile(e){return this.projectProfiles.get(e)}isAmbiguousUnit(e,t){let i=this.projectProfiles.get(e);if(!i)return!1;let r=i.unitMappings.get(t);return!!r&&r.floors.size>1}constructor(){this.projectProfiles=new Map}}class a{constructor(e){this.customRules=new Map,this.detector=e,this.initializeCustomRules()}initializeCustomRules(){}applyRules(e){for(let[t,i]of this.customRules){let t=i(e);if(t)return t}let t=this.detector.detectPattern(e.rawUnit,e);if(t){let{rule:i,match:r}=t;return{identifier:i.extract(r,e),confidence:i.confidence,method:`pattern:${i.id}`}}return{identifier:this.simpleFallback(e.rawUnit),confidence:50,method:"fallback"}}simpleFallback(e){return e?e.toUpperCase().replace(/[\uff01-\uff5e]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248)).replace(/\s+/g,"").replace(/[棟樓F室號\-]/g,""):""}}class s{constructor(e){this.resolveCache=new Map,console.log("[AdaptiveUnitResolver] 初始化，處理",e.length,"筆資料"),this.detector=new r,this.analyzer=new n,this.ruleEngine=new a(this.detector),this.buildKnowledgeBase(e)}buildKnowledgeBase(e){let t=new Map;for(let i of e){let e=i["建案名稱"];e&&(t.has(e)||t.set(e,[]),t.get(e).push(i))}for(let[e,i]of(console.log("[AdaptiveUnitResolver] 分析",t.size,"個建案"),t))this.analyzer.analyzeProject(e,i)}resolve(e){return this.resolveWithContext(e).identifier}resolveWithContext(e){let t=e["戶別"];t&&"string"==typeof t&&(t=t.trim());let i=e["樓層"],r=e["建案名稱"];if(!t)return{identifier:"",confidence:0,method:"no_input"};let n=`${r}|${t}|${i||""}`;if(this.resolveCache.has(n))return this.resolveCache.get(n);let a={rawUnit:t,floor:i?String(i):void 0,projectName:r},s=this.ruleEngine.applyRules(a);if(s)return this.resolveCache.set(n,s),s;let l={identifier:t,confidence:0,method:"fallback_null"};return this.resolveCache.set(n,l),l}}},91682:(e,t,i)=>{i.d(t,{t:()=>J});var r=i(95155),n=i(12115),a=i(47650),s=i(40980),l=i(43987),o=i(89579);function c(e){let t=(e["移轉層次"]||"").match(/^([+-]?\d+)/);return t?parseInt(t[1],10):0}function d(e){let t=new Set;return e.forEach(e=>{let i=c(e);0!==i&&t.add(i)}),Array.from(t).sort((e,t)=>e-t)}function x(e,t){let i=e.reduce((e,t)=>e+(t["單價元平方公尺"]||0),0)/e.length,r=e.map(e=>e["單價元平方公尺"]||0).sort((e,t)=>e-t),n=r.length%2==0?(r[r.length/2-1]+r[r.length/2])/2:r[Math.floor(r.length/2)];return{unitType:t,avgPrice:i,minPrice:Math.min(...r),maxPrice:Math.max(...r),medianPrice:n,count:e.length,transactions:e}}function h(e){let t=new o.B$(e),i=new Map;return e.forEach(e=>{if(!e)return;let r=t.resolve(e);r&&(i.has(r)||i.set(r,[]),i.get(r).push(e))}),i}function m(e,t,i){return e.filter(e=>{let r=c(e);return r>=t&&r<=i})}function u(){return Math.random().toString(36).substring(2,9)}function p(e,t="預設配置",i){let r=d(e),n=i||{start:Math.min(...r),end:Math.max(...r)},a=function(e){if(0===e.length)return[];let t=new o.B$(e),i=new Set;e.forEach(e=>{let r=t.resolve(e);r&&i.add(r)});let r=Array.from(i),n=Math.ceil(Math.sqrt(r.length)),a=Math.ceil(r.length/n),s=Math.floor((30-(4*n-1))/2),l=Math.floor((30-(4*a-1))/2);return r.map((e,t)=>{let i=Math.floor(t/n);return{unitType:e,x:s+t%n*4,y:l+4*i,facing:"",roadFacing:!1,roadFacingDirection:"",adjacentToUnits:!1,facingOpenSpace:!1,openSpaceType:"",openSpaceFacingDirection:""}})}(e);return{id:u(),name:t,floorRange:n,positions:a,envTiles:[],zoom:1,compassDirection:0,gridSize:30}}function f(e,t,i=0,r=1){if(!t||0===t.length)return e;let n=[];e.forEach(e=>{n.push({type:"unit",id:e.unitType,rect:{left:e.x,right:e.x+3,top:e.y,bottom:e.y+3},data:e})}),t.forEach(e=>{n.push({type:"env",id:e.id,rect:{left:e.x,right:e.x+e.width,top:e.y,bottom:e.y+e.height},data:e})});let a={0:{up:"N",down:"S",left:"W",right:"E"},90:{up:"E",down:"W",left:"N",right:"S"},180:{up:"S",down:"N",left:"E",right:"W"},270:{up:"W",down:"E",left:"S",right:"N"}}[i];return e.map(e=>{let t={left:e.x,right:e.x+3,top:e.y,bottom:e.y+3},i=new Set,r=[],s=!1,l=!1;return["up","down","left","right"].forEach(o=>{let c=a[o],d=n.filter(i=>{if("unit"===i.type&&i.id===e.unitType)return!1;let r=!1,n=!1,a=1/0;return"up"===o?(r=Math.max(0,Math.min(t.right,i.rect.right)-Math.max(t.left,i.rect.left))>0,(n=i.rect.bottom<=t.top)&&(a=t.top-i.rect.bottom)):"down"===o?(r=Math.max(0,Math.min(t.right,i.rect.right)-Math.max(t.left,i.rect.left))>0,(n=i.rect.top>=t.bottom)&&(a=i.rect.top-t.bottom)):"left"===o?(r=Math.max(0,Math.min(t.bottom,i.rect.bottom)-Math.max(t.top,i.rect.top))>0,(n=i.rect.right<=t.left)&&(a=t.left-i.rect.right)):"right"===o&&(r=Math.max(0,Math.min(t.bottom,i.rect.bottom)-Math.max(t.top,i.rect.top))>0,(n=i.rect.left>=t.right)&&(a=i.rect.left-t.right)),!!r&&!!n&&a<=15&&(i._dist=a,!0)});for(let e of(d.sort((e,t)=>e._dist-t._dist),d)){if("unit"===e.type)break;if("env"===e.type){let t=e.data;if("road"===t.type)l=!0,i.add(c);else if(["park","school","plaza","river","tower","grave","bridge","mountain","adjacent"].includes(t.type)){s=!0,r.some(e=>e.type===t.type&&e.direction===c)||r.push({type:t.type,direction:c});continue}}}}),{...e,roadFacing:l,roadFacingDirection:Array.from(i)[0]||"",roadFacingDirections:Array.from(i),facingOpenSpace:s,openSpaceType:r[0]?.type||"",openSpaceFacingDirection:r[0]?.direction||"",openSpaceFacingDirections:r}})}let g="horizontal-diff",b="floor-config-update",y=(e,t=g)=>{let i=String(e||"default").trim()||"default",r=String(t||g).trim()||g;return`floor-configs:${r}:${i}`},v=(e,t=g)=>{try{let i=window.localStorage.getItem(y(e,t));if(!i)return null;let r=JSON.parse(i);if(!r||!Array.isArray(r.configurations))return null;return r}catch{return null}};var j=i(39430),N=i(80642),w=i(33210),z=i(33024),S=i(63888),M=i(44071),P=i(67514),k=i(82482),F=i(86901),C=i(51914),$=i(89823),I=i(67635),A=i(68459),T=i(14403),D=i(9199),E=i(89123),_=i(24538);let R=3;function L(e,t){return{unitType:e.unitType,col:e.x,row:e.y,facing:e.facing,roadFacing:e.roadFacing,roadFacingDirection:e.roadFacingDirection,roadFacingDirections:e.roadFacingDirections,adjacentToUnits:e.adjacentToUnits,facingOpenSpace:e.facingOpenSpace,openSpaceType:e.openSpaceType,openSpaceFacingDirection:e.openSpaceFacingDirection,openSpaceFacingDirections:e.openSpaceFacingDirections}}function W({position:e,result:t,isSelected:i,isDragging:n,cellSize:a,compassDirection:s=0,onClick:l,onDragStart:o}){let c={left:e.col*a,top:e.row*a,width:R*a,height:R*a},d={top:[],right:[],bottom:[],left:[]},x=["N","E","S","W"],h=(s||0)/90%4,m={N:"top",E:"right",S:"bottom",W:"left"};["top","right","bottom","left"].forEach((e,t)=>{m[x[(h+t)%4]]=e});let u=(e,t,i)=>{e&&["N","S","E","W"].includes(e)&&d[m[e]].push({text:t,color:i})};if(e.facing&&u(e.facing[0],"朝","violet"),e.roadFacing&&(e.roadFacingDirections&&e.roadFacingDirections.length>0?e.roadFacingDirections.forEach(e=>u(e,"路","orange")):u(e.roadFacingDirection,"路","orange")),e.facingOpenSpace){let t={school:"校",plaza:"廣",park:"園",river:"河",tower:"塔",grave:"墓",bridge:"橋",mountain:"山",adjacent:"房"},i={school:"green",plaza:"green",park:"green",river:"cyan",tower:"red",grave:"zinc",bridge:"orange",mountain:"green",adjacent:"zinc"};if(e.openSpaceFacingDirections&&e.openSpaceFacingDirections.length>0)e.openSpaceFacingDirections.forEach(e=>{let r=e.type;u(e.direction,t[r]||"空",i[r]||"green")});else{let r=e.openSpaceType||"park";u(e.openSpaceFacingDirection,t[r]||"空",i[r]||"green")}}let p=(e,t)=>0===e.length?null:(0,r.jsx)("div",{className:`absolute flex gap-0.5 ${t}`,children:e.map((e,t)=>(0,r.jsx)("div",{className:`
                            text-white text-[9px] px-1 py-0.5 rounded shadow-sm font-bold min-w-[20px] text-center
                            ${"violet"===e.color?"bg-violet-500":""}
                            ${"orange"===e.color?"bg-orange-500":""}
                            ${"blue"===e.color?"bg-blue-500":""}
                            ${"blue"===e.color?"bg-blue-500":""}
                            ${"cyan"===e.color?"bg-cyan-600":""}
                            ${"red"===e.color?"bg-red-600":""}
                            ${"zinc"===e.color?"bg-zinc-600":""}
                            ${"green"===e.color?"bg-emerald-600":""}
                        `,children:e.text},t))});return(0,r.jsx)("div",{className:`
                absolute cursor-grab active:cursor-grabbing select-none transition-all duration-100 group
                ${n?"z-50 opacity-70 scale-105":"z-10"}
            `,style:c,onMouseDown:t=>o(e.unitType,t),onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},children:(0,r.jsxs)("div",{className:`
                    relative w-full h-full rounded-lg border-2 transition-all flex flex-col items-center justify-center bg-zinc-900/90
                    ${i?"bg-cyan-900/30 border-cyan-400 shadow-[0_0_15px_rgba(34,211,238,0.3)]":t?"border-white/20 hover:border-cyan-400/50":"border-white/10 hover:border-white/30"}
                `,onClick:l,children:[p(d.top,"-top-2 left-1/2 -translate-x-1/2 -translate-y-full flex-row"),p(d.bottom,"-bottom-2 left-1/2 -translate-x-1/2 translate-y-full flex-row"),p(d.right,"-right-2 top-1/2 -translate-y-1/2 translate-x-full flex-col"),p(d.left,"-left-2 top-1/2 -translate-y-1/2 -translate-x-full flex-col"),(0,r.jsx)("div",{className:"text-sm font-bold text-zinc-100 z-10",children:e.unitType}),t&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"text-xs font-mono text-cyan-400 mt-0.5",children:t.avgPrice.toFixed(1)}),(0,r.jsxs)("div",{className:"text-[10px] text-zinc-500",children:[t.count," 筆"]})]})]})})}function O({tile:e,cellSize:t,isSelected:i,onMouseDown:n,onResizeStart:a,onRemove:s}){let l={left:e.x*t,top:e.y*t,width:e.width*t,height:e.height*t},o={road:"bg-zinc-600/50 border-zinc-500",park:"bg-emerald-600/30 border-emerald-500",school:"bg-indigo-600/30 border-indigo-500",plaza:"bg-amber-600/30 border-amber-500",river:"bg-cyan-600/30 border-cyan-500",tower:"bg-red-600/30 border-red-500",grave:"bg-zinc-600/30 border-zinc-500",custom:"bg-zinc-700/50 border-zinc-600",bridge:"bg-orange-600/30 border-orange-500",mountain:"bg-emerald-600/30 border-emerald-500",adjacent:"bg-zinc-600/30 border-zinc-500"};return(0,r.jsxs)("div",{className:`
                absolute transition-all duration-75 group select-none
                ${o[e.type]||o.custom}
                ${i?"border-2 border-white z-20":"border border-dashed z-0 opacity-80 hover:opacity-100"}
            `,style:l,onMouseDown:n,children:[s&&(0,r.jsx)("button",{onMouseDown:e=>e.stopPropagation(),onClick:e=>{e.stopPropagation(),s()},className:"absolute -top-2 -right-2 w-4 h-4 rounded-full bg-black/70 border border-white/20 text-white/80 hover:text-white hover:border-white/60 flex items-center justify-center text-[10px]","aria-label":"移除元件",children:(0,r.jsx)(w.A,{className:"w-3 h-3"})}),(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center text-xs text-white/80 font-medium overflow-hidden",children:e.label||e.type}),(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-white/50 cursor-se-resize hover:bg-white",onMouseDown:e=>{e.stopPropagation(),a(e,"se")}})})]})}function Z({selectedUnits:e,positions:t,compassDirection:i=0,onBatchUpdate:a,onClear:s}){let l=0===e.length?"empty":1===e.length?"inspector":"batch",o="inspector"===l?t.find(t=>t.unitType===e[0]):null,c=(0,n.useMemo)(()=>{if(0===t.length)return null;let e=Math.min(...t.map(e=>e.col)),i=Math.max(...t.map(e=>e.col+R)),r=Math.min(...t.map(e=>e.row)),n=Math.max(...t.map(e=>e.row+R));return{minCol:e,maxCol:i,minRow:r,maxRow:n,centerX:(e+i)/2,centerY:(r+n)/2}},[t]),d=(0,n.useMemo)(()=>{if(!o||!c)return"";let e=o.col+R/2,t=o.row+R/2,r=e-c.centerX,n=t-c.centerY,a=.25>=Math.abs(r)?"":r>0?"E":"W",s=.25>=Math.abs(n)?"":n>0?"S":"N";if(!a&&!s)return"C";let l=`${s}${a}`,d={N:0,NE:45,E:90,SE:135,S:180,SW:225,W:270,NW:315},x=d[l];if(void 0===x)return l;let h=(x+i)%360;return Object.keys(d).find(e=>d[e]===h)||l},[o,c,i]),x=(0,n.useMemo)(()=>d?({N:"北",S:"南",E:"東",W:"西",NE:"東北",NW:"西北",SE:"東南",SW:"西南",C:"中央"})[d]||d:"—",[d]);return(0,r.jsxs)("div",{className:"bg-zinc-900/50 rounded-lg border border-white/10 p-4 h-full flex flex-col gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between border-b border-white/5 pb-2",children:[(0,r.jsxs)("div",{className:"text-sm font-bold text-zinc-100",children:["empty"===l&&"環境標籤與設定","inspector"===l&&(0,r.jsxs)("span",{className:"text-cyan-400",children:["檢視戶型: ",o?.unitType]}),"batch"===l&&(0,r.jsxs)("span",{className:"text-violet-400",children:["批量設定 (",e.length,")"]})]}),"empty"!==l&&(0,r.jsx)("button",{onClick:s,className:"text-zinc-500 hover:text-zinc-300",children:(0,r.jsx)(w.A,{className:"w-4 h-4"})})]}),"inspector"===l&&o&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"text-xs text-zinc-400 space-y-1",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"座標:"}),(0,r.jsxs)("span",{className:"font-mono text-zinc-200",children:["(",o.col,", ",o.row,")"]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"相對朝向:"}),(0,r.jsx)("span",{className:"font-medium text-zinc-200",children:x})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"text-xs font-medium text-zinc-300 mb-2 flex justify-between",children:[(0,r.jsx)("span",{children:"臨路偵測 (Roads)"}),(0,r.jsx)("span",{className:"text-[10px] text-zinc-500",children:o.roadFacing?"Yes":"No"})]}),(0,r.jsx)("div",{className:"flex gap-2 flex-wrap",children:o.roadFacingDirections&&o.roadFacingDirections.length>0?o.roadFacingDirections.map(e=>(0,r.jsxs)("span",{className:"px-2 py-0.5 rounded bg-orange-500/20 text-orange-300 text-xs border border-orange-500/30",children:["N"===e?"北":"S"===e?"南":"E"===e?"東":"W"===e?"西":e,"側臨路"]},e)):(0,r.jsx)("span",{className:"text-xs text-zinc-600 px-2",children:"無臨路"})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs font-medium text-zinc-300 mb-2",children:"周邊設施 (Amenities)"}),(0,r.jsx)("div",{className:"flex gap-2 flex-wrap",children:o.openSpaceFacingDirections&&o.openSpaceFacingDirections.length>0?o.openSpaceFacingDirections.map((e,t)=>(0,r.jsxs)("span",{className:"px-2 py-0.5 rounded bg-emerald-500/20 text-emerald-300 text-xs border border-emerald-500/30 flex items-center gap-1",children:[(0,r.jsx)("span",{children:"N"===e.direction?"北":"S"===e.direction?"南":"E"===e.direction?"東":"W"===e.direction?"西":e.direction}),(0,r.jsx)("span",{className:"opacity-50",children:"|"}),(0,r.jsx)("span",{className:"tower"===e.type?"text-red-400":"grave"===e.type?"text-zinc-400":"bridge"===e.type?"text-orange-400":"river"===e.type?"text-cyan-400":"mountain"===e.type||"park"===e.type?"text-emerald-400":"school"===e.type?"text-indigo-400":"plaza"===e.type?"text-amber-400":"adjacent"===e.type?"text-zinc-300":"",children:"park"===e.type?"公園":"school"===e.type?"學校":"plaza"===e.type?"廣場":"river"===e.type?"河景":"tower"===e.type?"電塔":"grave"===e.type?"墳墓":"bridge"===e.type?"高架橋":"mountain"===e.type?"山景":"adjacent"===e.type?"臨房":e.type})]},`${e.type}-${e.direction}-${t}`)):(0,r.jsx)("span",{className:"text-xs text-zinc-600 px-2",children:"無偵測到設施"})})]})]}),"batch"===l&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"p-2 bg-violet-900/20 border border-violet-500/30 rounded text-xs text-violet-200",children:["正在批量修改 ",e.length," 個單位"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs font-medium text-zinc-300 mb-2",children:"統一朝向"}),(0,r.jsx)("div",{className:"grid grid-cols-3 gap-1",children:[{value:"",label:"清除"},{value:"N",label:"北"},{value:"S",label:"南"},{value:"E",label:"東"},{value:"W",label:"西"},{value:"NE",label:"東北"},{value:"NW",label:"西北"},{value:"SE",label:"東南"},{value:"SW",label:"西南"}].map(e=>(0,r.jsx)("button",{onClick:()=>a({facing:e.value}),className:"text-xs py-1 rounded bg-zinc-800 text-zinc-400 hover:bg-violet-600 hover:text-white transition",children:e.label},e.value))})]})]}),(0,r.jsx)("div",{className:"h-px bg-white/10 my-2"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"text-xs font-bold text-zinc-400 mb-3 uppercase tracking-wider flex items-center gap-2",children:[(0,r.jsx)(z.A,{className:"w-3 h-3"}),"環境標籤 (拖曳使用)"]}),(0,r.jsx)("div",{className:"grid grid-cols-2 gap-2",children:[{id:"road",label:"臨路",color:"bg-zinc-700",border:"border-zinc-500"},{id:"park",label:"公園",color:"bg-green-800",border:"border-green-600"},{id:"school",label:"學校",color:"bg-blue-900",border:"border-blue-700"},{id:"plaza",label:"廣場",color:"bg-violet-900",border:"border-violet-700"},{id:"river",label:"河景",color:"bg-cyan-800",border:"border-cyan-600"},{id:"mountain",label:"山景",color:"bg-emerald-900",border:"border-emerald-700"},{id:"bridge",label:"高架橋",color:"bg-orange-900",border:"border-orange-700"},{id:"tower",label:"電塔",color:"bg-red-900",border:"border-red-700"},{id:"grave",label:"墳墓",color:"bg-zinc-800",border:"border-zinc-600"},{id:"adjacent",label:"臨房",color:"bg-zinc-900",border:"border-zinc-700"}].map(e=>(0,r.jsx)("div",{draggable:!0,onDragStart:t=>{var i;return i=e.id,void(t.dataTransfer.setData("env-type",i),t.dataTransfer.setData("application/json",JSON.stringify({type:"env",envType:i})),t.dataTransfer.effectAllowed="copy")},className:`
                                ${e.color} ${e.border}
                                text-white text-xs font-bold py-2 px-3 rounded cursor-grab active:cursor-grabbing
                                border shadow-sm hover:brightness-110 flex items-center justify-center
                            `,children:e.label},e.id))})]})]})}function q({direction:e,onChange:t}){return(0,r.jsxs)("div",{className:"absolute top-8 right-8 z-50 flex flex-col items-center",children:[(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)("div",{className:"w-16 h-16 bg-zinc-900/90 rounded-full border-2 border-zinc-700 shadow-xl flex items-center justify-center cursor-pointer hover:border-zinc-500 transition-colors z-10 relative",onClick:()=>t((e+90)%360),children:(0,r.jsxs)(j.P.div,{animate:{rotate:-e},transition:{type:"spring",stiffness:150,damping:15},className:"w-full h-full flex items-center justify-center relative",children:[(0,r.jsx)("div",{className:"absolute -top-1 left-1/2 -translate-x-1/2 w-0 h-0 border-l-[5px] border-r-[5px] border-b-[7px] border-transparent border-b-red-500"}),(0,r.jsx)("div",{className:"absolute w-1 h-3/5 bg-gradient-to-b from-red-500 to-zinc-600 rounded-full"}),(0,r.jsx)("div",{className:"absolute w-3 h-3 bg-white rounded-full border-2 border-zinc-900 z-20"})]})})}),(0,r.jsx)("div",{className:"mt-2 flex gap-1 bg-black/50 p-1 rounded-full border border-white/10",children:[{label:"北",abbr:"N",value:0},{label:"東",abbr:"E",value:90},{label:"南",abbr:"S",value:180},{label:"西",abbr:"W",value:270}].map(i=>(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),t(i.value)},className:`
                            text-[10px] px-2.5 py-1 rounded-full font-bold transition-all min-w-[40px]
                            ${e===i.value?"bg-cyan-500 text-white":"bg-zinc-800 text-zinc-400 hover:bg-zinc-700 hover:text-white"}
                        `,children:(0,r.jsxs)("span",{className:"flex flex-col leading-none",children:[(0,r.jsx)("span",{children:i.label}),(0,r.jsx)("span",{className:"text-[9px] opacity-70",children:i.abbr})]})},i.value))}),(0,r.jsxs)("div",{className:"mt-6 text-[10px] text-zinc-500 font-mono bg-black/50 px-2 py-1 rounded",children:["上方為 ",0===e?"北":90===e?"東":180===e?"南":"西"]})]})}function B({positions:e,envTiles:t=[],results:i,selectedUnits:a,zoom:s,compassDirection:l=0,gridSize:o=30,onPositionsChange:c,onEnvTilesChange:d,onUnitClick:x,onZoomChange:h,onCompassChange:m,onGridSizeChange:u,isAnalyzeMode:p=!1}){let[f,g]=(0,n.useState)(null),[b,y]=(0,n.useState)(null),[v,j]=(0,n.useState)({x:0,y:0}),[w,z]=(0,n.useState)(null),[S,M]=(0,n.useState)(null),[P,k]=(0,n.useState)(null),[F,C]=(0,n.useState)(null),$=n.useRef(null),I=n.useRef(null),[A,T]=(0,n.useState)({width:0,height:0}),D=Math.min(Math.max(0,(A.width||1e3)-80),Math.max(0,(A.height||1e3)-80))/o,E=D>0?D:1e3/o,_=o*E,L=o*E;n.useLayoutEffect(()=>{if(!I.current)return;let e=I.current,t=()=>{let t=e.getBoundingClientRect();T({width:t.width,height:t.height})};t();let i=new ResizeObserver(t);return i.observe(e),()=>i.disconnect()},[]);let Z=(0,n.useCallback)((t,i,r)=>e.find(e=>e.unitType!==r&&t>=e.col&&t<e.col+R&&i>=e.row&&i<e.row+R),[e]),B=(0,n.useCallback)((e,t,i=R,r=R)=>e>=0&&t>=0&&e+i<=o&&t+r<=o,[o,o]),U=(0,n.useCallback)((i,r,n)=>{if(p)return;n.preventDefault(),n.stopPropagation();let a="unit"===r?e.find(e=>e.unitType===i):t.find(e=>e.id===i);if(!a||!$.current)return;let s=$.current.getBoundingClientRect(),l="unit"===r?a.col:a.x,o="unit"===r?a.row:a.y,c=l*E,d=o*E;g(i),y(r),j({x:n.clientX-s.left-c,y:n.clientY-s.top-d}),z({col:l,row:o})},[e,t,p,E]),Y=(0,n.useCallback)((e,i)=>{if(p)return;i.preventDefault(),i.stopPropagation();let r=t.find(t=>t.id===e);r&&(k(e),C({x:i.clientX,y:i.clientY,w:r.width,h:r.height}))},[t,p]),V=(0,n.useCallback)(i=>{if($.current){if(P&&F&&d){let e=i.clientX-F.x,r=i.clientY-F.y,n=Math.round(e/E),a=Math.round(r/E),s=Math.max(1,F.w+n),l=Math.max(1,F.h+a),o=t?.find(e=>e.id===P);o&&(o.width!==s||o.height!==l)&&d(t.map(e=>e.id===P?{...e,width:s,height:l}:e));return}if(f&&v){let r=$.current.getBoundingClientRect(),n=i.clientX-r.left-v.x,a=i.clientY-r.top-v.y,s=Math.round(n/E),c=Math.round(a/E),d="unit"===b?R:t?.find(e=>e.id===f)?.width||1,x="unit"===b?R:t?.find(e=>e.id===f)?.height||1;if(z({col:s=Math.max(0,Math.min(s,o-d)),row:c=Math.max(0,Math.min(c,o-x))}),"env"===b&&void 0!==l){let i=t?.find(e=>e.id===f);if(i){let t=s,r=s+i.width,n=c,a=c+i.height,o=t+i.width/2,d=n+i.height/2,x=null;for(let s of e){let e=s.col,c=s.col+R,h=s.row,m=s.row+R,u=e+R/2,p=h+R/2,g=Math.max(0,h-a,n-m);if(1>=Math.max(0,e-r,t-c)&&g<=1){let r=function(e,t,i){let r,n=e.x,a=e.x+e.width,s=e.y,l=e.y+e.height,o=t.x,c=t.x+t.width,d=t.y,x=t.y+t.height,h=Math.max(0,Math.min(a,c)-Math.max(n,o)),m=Math.max(0,Math.min(l,x)-Math.max(s,d));if(h>m){let i=s+e.height/2;r=d+t.height/2<i?"up":"down"}else if(m>h){let i=n+e.width/2;r=o+t.width/2<i?"left":"right"}else{let i=n+e.width/2,a=s+e.height/2,l=o+t.width/2,c=d+t.height/2,x=l-i,h=c-a;r=Math.abs(x)>=Math.abs(h)?x>0?"right":"left":h>0?"down":"up"}return({0:{up:"N",down:"S",left:"W",right:"E"},90:{up:"E",down:"W",left:"N",right:"S"},180:{up:"S",down:"N",left:"E",right:"W"},270:{up:"W",down:"E",left:"S",right:"N"}})[i][r]}({x:e,y:h,width:R,height:R},{x:t,y:n,width:i.width,height:i.height},l);x={targetUnit:s.unitType,direction:r,sourceTileId:f,lineStart:{x:u*E,y:p*E},lineEnd:{x:o*E,y:d*E}};break}}M(x)}}else M(null)}else M(null)}},[f,b,v,E,P,F,d,c,t,o,o,l,e]),H=(0,n.useCallback)(()=>{if(P){k(null),C(null),M(null);return}if(f&&w&&b){if("unit"===b){let t=Z(w.col,w.row,f);if(t){let i=e.find(e=>e.unitType===f);c(e.map(e=>e.unitType===f?{...e,col:t.col,row:t.row}:e.unitType===t.unitType?{...e,col:i.col,row:i.row}:e))}else B(w.col,w.row)&&c(e.map(e=>e.unitType===f?{...e,col:w.col,row:w.row}:e))}else if("env"===b&&d&&t){let e=t.find(e=>e.id===f);e&&B(w.col,w.row,e.width,e.height)&&d(t.map(e=>e.id===f?{...e,x:w.col,y:w.row}:e))}}g(null),y(null),z(null),M(null)},[f,w,b,Z,B,c,e,d,t,P]),X=(0,n.useCallback)(()=>{f&&(g(null),y(null),z(null),M(null))},[f]);w&&f&&"unit"===b&&Z(w.col,w.row,f);let J=(0,n.useCallback)(e=>{e.preventDefault();let i=e.dataTransfer.getData("env-type");if(!i)try{let t=e.dataTransfer.getData("application/json");if(t){let e=JSON.parse(t);"env"===e.type&&(i=e.envType)}}catch(e){}if(i&&d&&$.current){let r=$.current.getBoundingClientRect(),n=e.clientX-r.left,a=e.clientY-r.top,s=Math.min(o-2,Math.max(0,Math.floor(n/E))),l=Math.min(o-2,Math.max(0,Math.floor(a/E)));d([...t,{id:`env-${Date.now()}`,type:i,x:s,y:l,width:"road"===i?4:3,height:2,label:{road:"臨路",park:"公園",school:"學校",plaza:"廣場",river:"河景",tower:"電塔",grave:"墳墓",bridge:"高架",mountain:"山景",adjacent:"臨房",custom:"自訂"}[i]||"設施"}])}},[d,E,t,o,o]),[K,G]=(0,n.useState)(null),Q=(0,n.useCallback)(e=>{if(!$.current||p||e.target.closest(".grid-unit"))return;let t=$.current.getBoundingClientRect(),i=e.clientX-t.left,r=e.clientY-t.top;G({start:{x:i,y:r},end:{x:i,y:r}})},[p]),ee=(0,n.useCallback)(e=>{if((f||P)&&$.current)return void V(e);if(K&&$.current){let t=$.current.getBoundingClientRect(),i=e.clientX-t.left,r=e.clientY-t.top;G(e=>e?{...e,end:{x:i,y:r}}:null)}},[f,P,V,K]),et=(0,n.useCallback)(t=>{if(f||P)return void H();if(K){let i=Math.min(K.start.x,K.end.x),r=Math.max(K.start.x,K.end.x),n=Math.min(K.start.y,K.end.y),s=Math.max(K.start.y,K.end.y);if(Math.abs(r-i)>5||Math.abs(s-n)>5){let l=e.filter(e=>{let t=e.col*E,a=e.row*E,l=t+R*E,o=a+R*E;return i<l&&r>t&&n<o&&s>a}).map(e=>e.unitType);t.shiftKey||t.ctrlKey||t.metaKey?x(null,{...t,type:"box-select",units:Array.from(new Set([...a,...l]))}):x(null,{...t,type:"box-select",units:l})}G(null)}},[f,P,H,K,e,E,a,x]),ei=(0,n.useCallback)(()=>{X(),G(null)},[X]);return(0,r.jsxs)("div",{className:"space-y-2 h-full flex flex-col",children:[(0,r.jsx)("div",{className:"flex items-center gap-2 justify-end px-2 pb-2 border-b border-white/5 bg-zinc-900/50 pt-2",children:u&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("span",{className:"text-xs text-zinc-500",children:["網格數: ",o]}),(0,r.jsx)("input",{type:"range",min:"20",max:"80",step:"5",value:o,onChange:e=>u(Number(e.target.value)),className:"w-24 accent-violet-500 cursor-pointer",title:"調整網格數量 (同時調整元件顯示大小)"})]})}),(0,r.jsxs)("div",{ref:I,className:"flex-1 overflow-hidden bg-zinc-950/80 rounded-lg border border-white/10 relative max-h-[600px]",children:[m&&(0,r.jsx)(q,{direction:l||0,onChange:m}),(0,r.jsx)("div",{className:"flex justify-center items-center min-w-full min-h-full p-10",onMouseDown:Q,onMouseMove:ee,onMouseUp:et,onMouseLeave:ei,children:(0,r.jsxs)("div",{ref:$,className:"relative bg-zinc-900 border border-zinc-700 shadow-2xl transition-all duration-300",style:{width:_,height:L,backgroundSize:`${E}px ${E}px`,backgroundImage:`
                                linear-gradient(to right, rgba(255, 255, 255, 0.05) 1px, transparent 1px),
                                linear-gradient(to bottom, rgba(255, 255, 255, 0.05) 1px, transparent 1px)
                            `},onDragOver:e=>e.preventDefault(),onDrop:J,children:[S&&(0,r.jsxs)("svg",{className:"absolute inset-0 pointer-events-none z-50 overflow-visible",children:[(0,r.jsx)("line",{x1:S.lineStart.x,y1:S.lineStart.y,x2:S.lineEnd.x,y2:S.lineEnd.y,stroke:"#ec4899",strokeWidth:"2",strokeDasharray:"4",className:"animate-pulse"}),(0,r.jsx)("circle",{cx:S.lineStart.x,cy:S.lineStart.y,r:"4",fill:"#ec4899"}),(0,r.jsx)("text",{x:(S.lineStart.x+S.lineEnd.x)/2,y:(S.lineStart.y+S.lineEnd.y)/2-10,fill:"#ec4899",fontSize:"12",fontWeight:"bold",textAnchor:"middle",className:"drop-shadow-md",style:{textShadow:"0 1px 2px rgba(0,0,0,0.8)"},children:S.direction})]}),(0,r.jsxs)("div",{className:"absolute inset-0 pointer-events-none opacity-20",children:[Array.from({length:o+1}).map((e,t)=>(0,r.jsx)("div",{className:"absolute top-0 bottom-0 border-l border-white/10",style:{left:t*E}},`v-${t}`)),Array.from({length:o+1}).map((e,t)=>(0,r.jsx)("div",{className:"absolute left-0 right-0 border-t border-white/10",style:{top:t*E}},`h-${t}`))]}),K&&(0,r.jsx)("div",{className:"absolute bg-cyan-500/10 border border-cyan-400/50 pointer-events-none z-50",style:{left:Math.min(K.start.x,K.end.x),top:Math.min(K.start.y,K.end.y),width:Math.abs(K.end.x-K.start.x),height:Math.abs(K.end.y-K.start.y)}}),w&&f&&(0,r.jsx)("div",{className:"absolute bg-white/10 border border-white/30 z-40 transition-all duration-75",style:{left:w.col*E,top:w.row*E,width:("unit"===b?R:t?.find(e=>e.id===f)?.width||1)*E,height:("unit"===b?R:t?.find(e=>e.id===f)?.height||1)*E}}),(0,r.jsx)(N.N,{children:t?.map(e=>(0,r.jsx)(O,{tile:e,cellSize:E,isSelected:!1,onMouseDown:t=>U(e.id,"env",t),onResizeStart:(t,i)=>Y(e.id,t),onRemove:()=>{d&&t&&d(t.filter(t=>t.id!==e.id))}},e.id))}),(0,r.jsx)(N.N,{children:e.map(e=>{let t=i?.find(t=>t.unitType===e.unitType);return(0,r.jsx)(W,{position:e,result:t,isSelected:a.includes(e.unitType),isDragging:f===e.unitType,cellSize:E,compassDirection:l,onClick:t=>x(e.unitType,t),onDragStart:(e,t)=>U(e,"unit",t)},e.unitType)})})]})})]})]})}function U({comparison:e,onClose:t}){return(0,r.jsxs)(j.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"bg-zinc-900/70 border border-cyan-500/30 rounded-xl p-4 mb-4 backdrop-blur-sm",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(S.A,{className:"w-4 h-4 text-cyan-400"}),(0,r.jsx)("h4",{className:"text-sm font-bold text-zinc-100",children:"戶型比對"})]}),(0,r.jsx)("button",{onClick:t,className:"w-6 h-6 rounded hover:bg-white/10 flex items-center justify-center transition",children:(0,r.jsx)(w.A,{className:"w-4 h-4 text-zinc-400"})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"bg-black/30 rounded-lg p-3 border border-white/5",children:[(0,r.jsx)("div",{className:"text-lg font-bold text-cyan-400 mb-2",children:e.unitType1}),(0,r.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-zinc-500",children:"平均單價"}),(0,r.jsx)("span",{className:"text-zinc-200 font-mono",children:e.stats1.avgPrice.toFixed(2)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-zinc-500",children:"最低價"}),(0,r.jsx)("span",{className:"text-zinc-200 font-mono",children:e.stats1.minPrice.toFixed(2)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-zinc-500",children:"最高價"}),(0,r.jsx)("span",{className:"text-zinc-200 font-mono",children:e.stats1.maxPrice.toFixed(2)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-zinc-500",children:"中位數"}),(0,r.jsx)("span",{className:"text-zinc-200 font-mono",children:e.stats1.medianPrice.toFixed(2)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-zinc-500",children:"樣本數"}),(0,r.jsxs)("span",{className:"text-zinc-200",children:[e.stats1.count," 筆"]})]})]})]}),(0,r.jsxs)("div",{className:"bg-black/30 rounded-lg p-3 border border-white/5",children:[(0,r.jsx)("div",{className:"text-lg font-bold text-violet-400 mb-2",children:e.unitType2}),(0,r.jsxs)("div",{className:"space-y-1 text-xs",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-zinc-500",children:"平均單價"}),(0,r.jsx)("span",{className:"text-zinc-200 font-mono",children:e.stats2.avgPrice.toFixed(2)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-zinc-500",children:"最低價"}),(0,r.jsx)("span",{className:"text-zinc-200 font-mono",children:e.stats2.minPrice.toFixed(2)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-zinc-500",children:"最高價"}),(0,r.jsx)("span",{className:"text-zinc-200 font-mono",children:e.stats2.maxPrice.toFixed(2)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-zinc-500",children:"中位數"}),(0,r.jsx)("span",{className:"text-zinc-200 font-mono",children:e.stats2.medianPrice.toFixed(2)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-zinc-500",children:"樣本數"}),(0,r.jsxs)("span",{className:"text-zinc-200",children:[e.stats2.count," 筆"]})]})]})]})]}),(0,r.jsx)("div",{className:"mt-3 bg-gradient-to-r from-cyan-500/10 to-violet-500/10 rounded-lg p-3 border border-white/10",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"text-sm text-zinc-400",children:"價差"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[e.priceDiff>0?(0,r.jsx)(M.A,{className:"w-4 h-4 text-green-400"}):e.priceDiff<0?(0,r.jsx)(P.A,{className:"w-4 h-4 text-red-400"}):(0,r.jsx)(k.A,{className:"w-4 h-4 text-zinc-400"}),(0,r.jsxs)("span",{className:`text-lg font-bold font-mono ${e.priceDiff>0?"text-green-400":e.priceDiff<0?"text-red-400":"text-zinc-400"}`,children:[e.priceDiff>0?"+":"",e.priceDiff.toFixed(2)," 萬/坪"]}),(0,r.jsxs)("span",{className:"text-sm text-zinc-500",children:["(",e.diffPercent>0?"+":"",e.diffPercent.toFixed(1),"%)"]})]})]})})]})}function Y({transactions:e,project:t,configOnly:i=!1,title:a,storageScope:s,initialStep:l,onConfigChange:w}){let[z,S]=(0,n.useState)(i?"config":l||"config"),[M,P]=(0,n.useState)([]),[k,W]=(0,n.useState)(null),[O,q]=(0,n.useState)([]),[Y,V]=(0,n.useState)("per-floor"),[H,X]=(0,n.useState)(null),[J,K]=(0,n.useState)(null),[G,Q]=(0,n.useState)(null),ee=n.useRef(null),et=n.useRef(!1),ei=s||g,er=(0,n.useMemo)(()=>d(e),[e]);(0,n.useEffect)(()=>{et.current=!1},[t]),(0,n.useEffect)(()=>{if(et.current||!t)return;let i=v(t,ei);if(i?.configurations?.length){P(i.configurations),W(i.activeConfigId||i.configurations[0]?.id||null),et.current=!0,w&&w({configurations:i.configurations,activeConfigId:i.activeConfigId||i.configurations[0]?.id||null});return}if(e.length>0&&er.length>0){let t=p(e,"預設配置（全部樓層）");P([t]),W(t.id),et.current=!0,w&&w({configurations:[t],activeConfigId:t.id})}},[t,e,er,ei]),(0,n.useEffect)(()=>{!t||M.length&&(((e,t,i=g)=>{try{window.localStorage.setItem(y(e,i),JSON.stringify(t)),window.dispatchEvent(new CustomEvent(b,{detail:{project:e,scope:i}}))}catch{}})(t,{configurations:M,activeConfigId:k},ei),w&&w({configurations:M,activeConfigId:k}))},[t,M,k,ei]),(0,n.useEffect)(()=>{i&&"config"!==z&&S("config")},[i,z]),(0,n.useEffect)(()=>{er.length>0&&null===H&&X(er[0])},[er,H]);let en=M.find(e=>e.id===k),ea=(0,n.useMemo)(()=>en?en.positions.map(e=>L(e,36)):[],[en]),es=(0,n.useMemo)(()=>{if(!en||"analyze"!==z)return[];let t=en.positions;if("vertical-avg"===Y)return function(e,t,i,r){let n=m(e,t,i);if(0===n.length)return[];let a=h(n),s=new o.B$(n),l=new Map;n.forEach(e=>{let t=s.resolve(e);t&&(l.has(t)||l.set(t,new Set),l.get(t).add(c(e)))});let d=[];return r.forEach(e=>{let n=a.get(e.unitType)||[];if(0===n.length)return;let s=x(n,e.unitType),o=l.get(e.unitType)||new Set,c=[];r.forEach(t=>{if(t.unitType===e.unitType)return;let i=a.get(t.unitType)||[];if(0===i.length)return;let r=x(i,t.unitType),n=s.avgPrice-r.avgPrice,l=r.avgPrice>0?n/r.avgPrice*100:0;c.push({compareWith:t.unitType,diff:n,diffPercent:l})}),d.push({...s,floorRange:{start:t,end:i},floorCount:o.size,priceDiffs:c,position:e})}),d}(e,en.floorRange.start,en.floorRange.end,t);if(null!==H){let i=e.filter(e=>c(e)===H);if(0===i.length)return[];let r=h(i),n=[];return t.forEach(e=>{let i=r.get(e.unitType)||[];if(0===i.length)return;let a=x(i,e.unitType),s=[];t.forEach(t=>{if(t.unitType===e.unitType)return;let i=r.get(t.unitType)||[];if(0===i.length)return;let n=x(i,t.unitType),l=a.avgPrice-n.avgPrice,o=n.avgPrice>0?l/n.avgPrice*100:0;s.push({compareWith:t.unitType,diff:l,diffPercent:o})}),n.push({...a,floor:H,priceDiffs:s,position:e})}),n}return[]},[e,en,z,Y,H]),el=e=>{if(!en)return;let t=f(e.map(e=>({unitType:e.unitType,x:e.col,y:e.row,facing:e.facing,roadFacing:e.roadFacing,roadFacingDirection:e.roadFacingDirection,adjacentToUnits:e.adjacentToUnits,facingOpenSpace:e.facingOpenSpace,openSpaceType:e.openSpaceType,openSpaceFacingDirection:e.openSpaceFacingDirection,openSpaceFacingDirections:e.openSpaceFacingDirections,roadFacingDirections:e.roadFacingDirections})),en.envTiles||[],en.compassDirection||0,1);P(M.map(e=>e.id===k?{...e,positions:t}:e))},eo=e=>{},ec=e=>{if(!en)return;let t=function(e,t,i){if(0===e.length)return{positions:e,envTiles:t||[]};let r=Math.min(...e.map(e=>e.x)),n=Math.max(...e.map(e=>e.x+R)),a=Math.min(...e.map(e=>e.y)),s=Math.max(...e.map(e=>e.y+R)),l=Math.round(i/2-(r+n)/2),o=Math.round(i/2-(a+s)/2),c=e.map(e=>({...e,x:e.x+l,y:e.y+o})),d=(t||[]).map(e=>({...e,x:e.x+l,y:e.y+o})),x=[...c.map(e=>({start:e.x,end:e.x+R})),...d.map(e=>({start:e.x,end:e.x+e.width}))],h=[...c.map(e=>({start:e.y,end:e.y+R})),...d.map(e=>({start:e.y,end:e.y+e.height}))],m=Math.min(...x.map(e=>e.start)),u=Math.max(...x.map(e=>e.end)),p=Math.min(...h.map(e=>e.start)),f=Math.max(...h.map(e=>e.end)),g=0,b=0;return m<0?g=-m:u>i&&(g=i-u),p<0?b=-p:f>i&&(b=i-f),(0!==g||0!==b)&&(c=c.map(e=>({...e,x:e.x+g,y:e.y+b})),d=d.map(e=>({...e,x:e.x+g,y:e.y+b}))),{positions:c,envTiles:d}}(en.positions,en.envTiles,e);P(M.map(i=>i.id===k?{...i,gridSize:e,positions:t.positions,envTiles:t.envTiles}:i))},ed=(t,i)=>{if("config"===z){if("box-select"===i.type&&i.units)return void q(i.units);i.shiftKey||i.ctrlKey||i.metaKey?q(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]):q([t])}else"analyze"===z&&q(i=>{let r=i.includes(t)?i.filter(e=>e!==t):i.length<2?[...i,t]:[i[1],t];if(2===r.length)K("vertical-avg"===Y&&en?function(e,t,i,r,n){let a=h(m(e,t,i)),s=a.get(r)||[],l=a.get(n)||[];if(0===s.length||0===l.length)return null;let o=x(s,r),c=x(l,n),d=o.avgPrice-c.avgPrice,u=c.avgPrice>0?d/c.avgPrice*100:0;return{unitType1:r,unitType2:n,stats1:o,stats2:c,priceDiff:d,diffPercent:u,transactions1:s,transactions2:l}}(e,en.floorRange.start,en.floorRange.end,r[0],r[1]):null!==H?function(e,t,i,r){let n=h(e.filter(e=>c(e)===t)),a=n.get(i)||[],s=n.get(r)||[];if(0===a.length||0===s.length)return null;let l=x(a,i),o=x(s,r),d=l.avgPrice-o.avgPrice,m=o.avgPrice>0?d/o.avgPrice*100:0;return{unitType1:i,unitType2:r,stats1:l,stats2:o,priceDiff:d,diffPercent:m,transactions1:a,transactions2:s}}(e,H,r[0],r[1]):null);else K(null);return r})};return 0===e.length?null:(0,r.jsxs)("div",{ref:ee,className:"bg-zinc-900/50 border border-white/10 rounded-xl p-4 mb-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,r.jsx)(F.A,{className:"w-4 h-4 text-violet-400"}),(0,r.jsx)("h3",{className:"text-sm font-bold text-zinc-100",children:a||"水平價差分析"}),!i&&(0,r.jsxs)("div",{className:"ml-auto flex items-center gap-1 text-xs",children:[(0,r.jsx)("button",{onClick:()=>S("config"),className:`px-3 py-1.5 rounded transition-all ${"config"===z?"bg-violet-500 text-white":"text-zinc-400 hover:text-zinc-200"}`,children:"樓層配置"}),(0,r.jsx)("button",{onClick:()=>M.length>0&&S("analyze"),disabled:0===M.length,className:`px-3 py-1.5 rounded transition-all ${"analyze"===z?"bg-violet-500 text-white":"text-zinc-400 hover:text-zinc-200 disabled:opacity-30"}`,children:"分析"})]})]}),"config"===z&&(0,r.jsxs)(j.P.div,{initial:{opacity:0},animate:{opacity:1},children:[(0,r.jsxs)("div",{className:"bg-black/40 rounded-lg border border-white/5 p-3 mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("div",{className:"text-xs font-medium text-zinc-300",children:"樓層配置列表"}),(0,r.jsxs)("button",{onClick:()=>{let t=p(e,`配置 ${M.length+1}`);P([...M,t]),W(t.id)},className:"text-xs px-2 py-1 bg-violet-500 hover:bg-violet-400 text-white rounded flex items-center gap-1 transition",children:[(0,r.jsx)(C.A,{className:"w-3 h-3"}),"新增配置"]})]}),(0,r.jsx)("div",{className:"space-y-2",children:M.map(e=>(0,r.jsx)("div",{className:`
                                        p-2 rounded-lg border-2 transition-all cursor-pointer
                                        ${k===e.id?"bg-violet-500/20 border-violet-400":"bg-zinc-800/50 border-white/10 hover:border-white/20"}
                                    `,onClick:()=>W(e.id),children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"flex-1",children:G?.id===e.id?(0,r.jsxs)("div",{className:"space-y-2",onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("input",{type:"text",value:G.name,onChange:e=>Q({...G,name:e.target.value}),className:"w-full bg-zinc-700 border border-white/10 text-zinc-200 text-xs rounded px-2 py-1",placeholder:"配置名稱"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("input",{type:"number",value:G.range.start,onChange:e=>Q({...G,range:{...G.range,start:e.target.value}}),onClick:e=>e.stopPropagation(),className:"flex-1 bg-zinc-700 border border-white/10 text-zinc-200 text-xs rounded px-2 py-1 w-16",placeholder:"起始"}),(0,r.jsx)("span",{className:"text-zinc-500",children:"~"}),(0,r.jsx)("input",{type:"number",value:G.range.end,onChange:e=>Q({...G,range:{...G.range,end:e.target.value}}),onClick:e=>e.stopPropagation(),className:"flex-1 bg-zinc-700 border border-white/10 text-zinc-200 text-xs rounded px-2 py-1 w-16",placeholder:"結束"}),(0,r.jsx)("span",{className:"text-xs text-zinc-500",children:"F"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>{var t,i,r;let n=Number(G.range.start),a=Number(G.range.end);Number.isNaN(n)||Number.isNaN(a)?alert("請輸入有效的樓層數字"):(t=e.id,(r=i={start:n,end:a},M.some(e=>(!t||e.id!==t)&&!(r.end<e.floorRange.start||r.start>e.floorRange.end)))?alert("樓層範圍與其他配置重疊！"):(P(M.map(e=>e.id===t?{...e,floorRange:i}:e)),Q(null)))},className:"flex-1 text-xs px-2 py-1 bg-green-500 hover:bg-green-400 text-white rounded",children:"儲存"}),(0,r.jsx)("button",{onClick:()=>Q(null),className:"flex-1 text-xs px-2 py-1 bg-zinc-700 hover:bg-zinc-600 text-white rounded",children:"取消"})]})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"text-sm font-medium text-zinc-200",children:e.name}),(0,r.jsxs)("div",{className:"text-xs text-zinc-500",children:[e.floorRange.start,"F ~ ",e.floorRange.end,"F",(0,r.jsx)("span",{className:"mx-1",children:"•"}),e.positions.length," 個戶型"]})]})}),G?.id!==e.id&&(0,r.jsxs)("div",{className:"flex items-center gap-1",onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("button",{onClick:()=>Q({id:e.id,name:e.name,range:{start:String(e.floorRange.start),end:String(e.floorRange.end)}}),className:"p-1 rounded hover:bg-white/10 transition",children:(0,r.jsx)($.A,{className:"w-3 h-3 text-zinc-400"})}),(0,r.jsx)("button",{onClick:()=>{var t;let i;return t=e.id,void(!(i=M.find(e=>e.id===t))||P([...M,{...i,id:u(),name:`${i.name} (複製)`,positions:i.positions.map(e=>({...e}))}]))},className:"p-1 rounded hover:bg-white/10 transition",children:(0,r.jsx)(I.A,{className:"w-3 h-3 text-zinc-400"})}),M.length>1&&(0,r.jsx)("button",{onClick:()=>(e=>{if(M.length<=1)return;let t=M.filter(t=>t.id!==e);P(t),k===e&&W(t[0]?.id||null)})(e.id),className:"p-1 rounded hover:bg-red-500/20 transition",children:(0,r.jsx)(A.A,{className:"w-3 h-3 text-red-400"})})]})]})},e.id))})]}),en&&(0,r.jsxs)("div",{className:"grid grid-cols-[1fr_280px] gap-4 mb-3",children:[(0,r.jsxs)("div",{className:"bg-black/40 rounded-lg border border-white/5 p-4 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsxs)("div",{className:"text-xs text-zinc-400 flex items-center gap-2",children:[(0,r.jsx)(T.A,{className:"w-3 h-3"}),en.name]}),(0,r.jsxs)("button",{onClick:()=>{el(p(e).positions.map(e=>L(e,36))),q([])},className:"text-xs text-zinc-500 hover:text-zinc-300 flex items-center gap-1 transition",children:[(0,r.jsx)(D.A,{className:"w-3 h-3"}),"重置"]})]}),(0,r.jsx)(B,{positions:ea,envTiles:en.envTiles,selectedUnits:O,zoom:en.zoom,compassDirection:en.compassDirection,gridSize:en.gridSize||30,onPositionsChange:el,onEnvTilesChange:e=>{if(!en)return;let t=f(en.positions,e,en.compassDirection||0,1);P(M.map(i=>i.id===k?{...i,envTiles:e,positions:t}:i))},onUnitClick:ed,onZoomChange:eo,onCompassChange:e=>{if(!en)return;let t=f(en.positions,en.envTiles||[],e,1);P(M.map(i=>i.id===k?{...i,compassDirection:e,positions:t}:i))},onGridSizeChange:ec})]}),(0,r.jsx)(Z,{selectedUnits:O,positions:ea,compassDirection:en.compassDirection,onBatchUpdate:e=>{en&&el(ea.map(t=>O.includes(t.unitType)?{...t,...e}:t))},onClear:()=>q([])})]}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsxs)("button",{onClick:()=>S("analyze"),disabled:0===M.length,className:"px-4 py-2 bg-violet-500 hover:bg-violet-400 disabled:opacity-30 text-white text-sm font-medium rounded-lg transition flex items-center gap-2",children:[(0,r.jsx)(E.A,{className:"w-4 h-4"}),"開始分析"]})})]}),"analyze"===z&&en&&(0,r.jsxs)(j.P.div,{initial:{opacity:0},animate:{opacity:1},children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 mb-4 p-3 bg-zinc-800/50 rounded-lg",children:[(0,r.jsx)("span",{className:"text-sm text-zinc-400",children:"分析模式："}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:()=>{V("per-floor"),q([]),K(null)},className:`px-3 py-1.5 text-xs rounded-lg transition-all ${"per-floor"===Y?"bg-cyan-500 text-white":"bg-zinc-700 text-zinc-400 hover:bg-zinc-600"}`,children:"當層比較"}),(0,r.jsx)("button",{onClick:()=>{V("vertical-avg"),q([]),K(null)},className:`px-3 py-1.5 text-xs rounded-lg transition-all ${"vertical-avg"===Y?"bg-violet-500 text-white":"bg-zinc-700 text-zinc-400 hover:bg-zinc-600"}`,children:"垂直平均比較"})]}),"per-floor"===Y&&(0,r.jsxs)("div",{className:"ml-4 flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-sm text-zinc-400",children:"樓層："}),(0,r.jsx)("select",{value:H||"",onChange:e=>{X(Number(e.target.value)),q([]),K(null)},className:"bg-zinc-700 border border-white/10 text-zinc-200 text-sm rounded px-2 py-1",children:er.filter(e=>e>=en.floorRange.start&&e<=en.floorRange.end).map(e=>(0,r.jsx)("option",{value:e,children:e>0?`${e}F`:`B${Math.abs(e)}F`},e))})]}),"vertical-avg"===Y&&(0,r.jsxs)("div",{className:"ml-4 text-xs text-zinc-500",children:["分析範圍：",en.floorRange.start,"F ~ ",en.floorRange.end,"F"]}),(0,r.jsx)("button",{onClick:()=>{S("config"),q([]),K(null)},className:"ml-auto text-xs text-zinc-500 hover:text-zinc-300 transition",children:"← 返回配置"})]}),(0,r.jsx)(N.N,{children:J&&(0,r.jsx)(U,{comparison:J,onClose:()=>{K(null),q([])}})}),(0,r.jsxs)("div",{className:"bg-black/40 rounded-lg border border-white/5 p-4 mb-3 min-w-0",children:[(0,r.jsx)(B,{positions:ea,results:es,selectedUnits:O,zoom:en.zoom,gridSize:en.gridSize||30,onPositionsChange:el,onUnitClick:ed,onZoomChange:eo,onGridSizeChange:ec,isAnalyzeMode:!0}),(0,r.jsx)("div",{className:"mt-2 text-[10px] text-zinc-500 flex items-center gap-3",children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(_.A,{className:"w-3 h-3"}),(0,r.jsx)("span",{children:"點擊兩個戶型進行比對"})]})})]}),es.length>0&&(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-2",children:es.map(e=>(0,r.jsxs)("div",{className:`
                                        bg-zinc-800/50 border rounded-lg p-2 transition-all cursor-pointer
                                        ${O.includes(e.unitType)?"border-cyan-400 bg-cyan-500/10":"border-white/10 hover:border-white/20"}
                                    `,onClick:t=>ed(e.unitType,t),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,r.jsx)("div",{className:"text-sm font-bold text-zinc-100",children:e.unitType}),"floorCount"in e&&(0,r.jsxs)("div",{className:"text-[10px] text-zinc-500",children:[e.floorCount," 層"]})]}),(0,r.jsxs)("div",{className:"text-xs space-y-0.5",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-zinc-500",children:"均價"}),(0,r.jsx)("span",{className:"text-cyan-400 font-mono",children:e.avgPrice.toFixed(1)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-zinc-500",children:"最低"}),(0,r.jsx)("span",{className:"text-zinc-300 font-mono",children:e.minPrice.toFixed(1)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-zinc-500",children:"最高"}),(0,r.jsx)("span",{className:"text-zinc-300 font-mono",children:e.maxPrice.toFixed(1)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-zinc-500",children:"中位"}),(0,r.jsx)("span",{className:"text-violet-400 font-mono",children:e.medianPrice.toFixed(1)})]}),(0,r.jsxs)("div",{className:"text-[10px] text-zinc-600 mt-1",children:[e.count," 筆交易"]})]})]},e.unitType))})]})]})}let V=(e,t=0)=>e?.toLocaleString(void 0,{maximumFractionDigits:t}),H=[{key:"employee",label:"員工關係戶",shortLabel:"員",badgeClass:"border-purple-500/70 text-purple-300",predicate:e=>!!e.isEmployeeRelated},{key:"office",label:"事務所/商辦",shortLabel:"辦",badgeClass:"border-blue-500/70 text-blue-300",predicate:e=>!!e.isOffice},{key:"storefront",label:"店鋪",shortLabel:"店",badgeClass:"border-amber-500/70 text-amber-300",predicate:e=>!!e.isStorefront}],X=({children:e,triggerRect:t,isTopRow:i})=>{if(!t)return null;let n={position:"fixed",left:t.left+t.width/2,transform:"translateX(-50%)",zIndex:9999};return i?n.top=t.bottom+8:n.bottom=window.innerHeight-t.top+8,(0,a.createPortal)((0,r.jsx)("div",{style:n,className:"pointer-events-none",children:e}),document.body)};function J({data:e,floorPremium:t=.3,showGrid:i=!0,showSummary:a=!0,showComparison:o=!0,configProject:c,configScope:d,rawTransactions:x}){let h,m,{horizontalGrid:u,sortedFloors:p,sortedUnits:y,unitColorMap:j,summary:N,horizontalComparison:w}=e,[z,S]=(0,n.useState)(null),[M,P]=(0,n.useState)(null),[k,F]=(0,n.useState)(null),[C,$]=(0,n.useState)(!1),I=d||g;(0,n.useEffect)(()=>{if(!c)return;F(v(c,I));let e=e=>{!e.detail?.project||e.detail.project!==c||e.detail?.scope&&e.detail.scope!==I||F(v(c,I))};return window.addEventListener(b,e),()=>window.removeEventListener(b,e)},[c,I]);let A=(0,n.useMemo)(()=>{if(!o||!u||!y||0===y.length)return{topPair:null,maxPairOverall:null,unitOverallStats:new Map,unitFloorStats:new Map,unitsInMaxPair:new Set};let e=new Map(y.map((e,t)=>[e,t])),t=new Map;Object.keys(u).forEach(e=>{let i=new Map;Object.keys(u[e]).forEach(t=>{u[e][t].forEach(e=>{if(null===e.premium)return;let r=parseFloat(e["房屋單價(萬)"]||e.unitPrice||0);Number.isFinite(r)&&!(r<=0)&&(i.has(t)||i.set(t,[]),i.get(t).push(r))})}),i.size>0&&t.set(e,i)});let i=new Map,r=new Set,n=null,a=(e,t)=>{let i=e=>e?e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e)||0:0;return i(t)-i(e)},s=(e,t)=>{if(!e.length)return 0;let i=[...e].sort((e,t)=>e-t),r=(i.length-1)*t,n=Math.floor(r);return void 0!==i[n+1]?i[n]+(r-n)*(i[n+1]-i[n]):i[n]},l=(e,t)=>e.reduce((e,i)=>e?Math.abs(i.diff-t)<Math.abs(e.diff-t)?i:e:i,e[0]),c=e=>{if(!e.length)return null;let t=e.map(e=>e.diff),i=s(t,.25),r=s(t,.5),n=s(t,.75),a=r>=0?e.reduce((e,t)=>t.diff>e.diff?t:e,e[0]):e.reduce((e,t)=>t.diff<e.diff?t:e,e[0]);return{q1:i,median:r,q3:n,max:a.diff,samples:{q1:l(e,i),median:l(e,r),q3:l(e,n),max:a}}},d=new Map,x=new Map,h=new Map;Array.from(t.keys()).sort(a).forEach(a=>{let s=t.get(a);if(!s)return;let l=Array.from(s.keys()).sort((t,i)=>(e.get(t)??0)-(e.get(i)??0)),o=null;for(let e=0;e<l.length;e++)for(let t=e+1;t<l.length;t++){let r=l[e],n=l[t],a=s.get(r)||[],c=s.get(n)||[];if(!a.length||!c.length)continue;let d=[],x=a.slice(0,20),h=c.slice(0,20);x.forEach(e=>{h.forEach(t=>{d.push(e-t)})});let m=`${r}__${n}`;i.has(m)||i.set(m,{unitA:r,unitB:n,diffs:[],count:0});let u=i.get(m);u.diffs.push(...d),u.count+=1;let p=d.reduce((e,t)=>Math.abs(t)>Math.abs(e)?t:e,d[0]);(!o||Math.abs(p)>Math.abs(o.diff))&&(o={unitHigh:p>=0?r:n,unitLow:p>=0?n:r,diff:p})}o&&(r.add(o.unitHigh),r.add(o.unitLow),(!n||Math.abs(o.diff)>Math.abs(n.diff))&&(n={floor:a,unitHigh:o.unitHigh,unitLow:o.unitLow,diff:o.diff})),l.forEach(e=>{let t=s.get(e)||[];if(!t.length)return;let i=[],r=t.slice(0,10);if(l.forEach(t=>{if(t===e)return;let n=s.get(t)||[];if(!n.length)return;let l=n.slice(0,10);r.forEach(e=>{l.forEach(r=>{i.push({diff:e-r,otherUnit:t,floor:a})})})}),!i.length)return;let n=c(i);n&&(x.has(e)||x.set(e,[]),x.get(e).push({floor:a,...n}),h.has(e)||h.set(e,[]),h.get(e).push(...i))})}),x.forEach(e=>e.sort((e,t)=>a(e.floor,t.floor))),h.forEach((e,t)=>{let i=c(e);i&&d.set(t,i)});let m=null;return i.forEach(e=>{let t=e.diffs.reduce((e,t)=>e+t,0)/e.diffs.length;if(!m||e.count>m.count){m={unitA:e.unitA,unitB:e.unitB,count:e.count,avgDiff:t};return}e.count===m.count&&Math.abs(t)>Math.abs(m.avgDiff)&&(m={unitA:e.unitA,unitB:e.unitB,count:e.count,avgDiff:t})}),{topPair:m,maxPairOverall:n,unitOverallStats:d,unitFloorStats:x,unitsInMaxPair:r}},[u,y,o]),T=(0,n.useMemo)(()=>{if(!k?.configurations?.length)return null;let e=new Map;return k.configurations.forEach(t=>{let i=new Map(f(t.positions,t.envTiles||[],t.compassDirection||0,1).map(e=>[e.unitType,e])),r=Math.min(t.floorRange.start,t.floorRange.end),n=Math.max(t.floorRange.start,t.floorRange.end);for(let t=r;t<=n;t++)e.set(t,i)}),e},[k]),D={school:"學校",plaza:"廣場",park:"公園",river:"河景",tower:"高壓塔",grave:"墓地",bridge:"高架橋",mountain:"山景",adjacent:"臨房"},E={N:"北",S:"南",E:"東",W:"西",NE:"東北",NW:"西北",SE:"東南",SW:"西南"},_=(0,n.useMemo)(()=>{if(!k?.configurations?.length)return null;let e=new Map;return k.configurations.forEach(t=>{let i=f(t.positions,t.envTiles||[],t.compassDirection||0,1),r=`${Math.min(t.floorRange.start,t.floorRange.end)}F~${Math.max(t.floorRange.start,t.floorRange.end)}F`;i.forEach(t=>{let i=(e=>{let t=[];if(e.roadFacing){let i=e.roadFacingDirections&&e.roadFacingDirections.length>0?e.roadFacingDirections:e.roadFacingDirection?[e.roadFacingDirection]:[];i.length?i.forEach(e=>{let i=E[e]||e;t.push({text:`${i}臨路`,tone:"road"})}):t.push({text:"臨路",tone:"road"})}if(e.facingOpenSpace&&e.openSpaceType){let i=new Set(["tower","grave","bridge"]);(e.openSpaceFacingDirections&&e.openSpaceFacingDirections.length>0?e.openSpaceFacingDirections.map(e=>({dir:e.direction,type:e.type})):[{dir:e.openSpaceFacingDirection||"",type:e.openSpaceType}]).forEach(e=>{if(!e.type)return;let r=D[e.type]||e.type,n=e.dir?E[e.dir]||e.dir:"",a=n?`${n}`:"";if("adjacent"===e.type)return void t.push({text:`${a}${r}`,tone:"adjacent"});let s=i.has(e.type);t.push({text:`${a}面${r}`,tone:s?"bad":"good"})})}return e.adjacentToUnits&&!t.some(e=>e.text.includes("臨房"))&&t.push({text:"臨房",tone:"adjacent"}),t})(t);if(!i.length)return;e.has(t.unitType)||e.set(t.unitType,{labelMap:new Map,details:[]});let n=e.get(t.unitType);i.forEach(e=>n.labelMap.set(e.text,e.tone)),n.details.push(`${r}: ${i.map(e=>e.text).join("/")}`)})}),e},[k]),[R,L]=(0,n.useState)(null),[W,O]=(0,n.useState)(null),Z=(()=>{let e=N?.calculationFlags;if(!e)return"排除店舖/辦公室";let t=[];return e.includesStorefrontPremium||t.push("店舖"),e.includesOfficePremium||t.push("辦公室"),e.includesEmployeePremium||t.push("員工關係戶"),t.length?`排除${t.join("/")}`:"全部納入"})(),q=(0,n.useMemo)(()=>{let e={};return u&&y&&y.forEach(t=>{let i=1/0,r=0;if(p?.forEach(e=>{(u[e]?.[t]||[]).forEach(e=>{if(e?.isStorefront||e?.isOffice)return;let t=Number(e?.tooltipInfo?.houseArea||0);Number.isFinite(t)&&!(t<=0)&&(t<i&&(i=t),t>r&&(r=t))})}),!Number.isFinite(i)||r<=0){e[t]={hasVariance:!1,label:""};return}let n=r-i>3,a=`${i.toFixed(2).replace(/\.00$/,"")}–${r.toFixed(2).replace(/\.00$/,"")} 坪`;e[t]={hasVariance:n,label:n?a:""}}),e},[u,p,y]),B=()=>{S(null)};return u&&p&&y?(0,r.jsxs)("div",{className:"space-y-8 overflow-x-auto relative",children:[z&&(0,r.jsx)(X,{triggerRect:z.rect,isTopRow:z.isTopRow,children:(h=z.data,m=H.filter(e=>e.predicate(h)).map(e=>e.label),(0,r.jsx)("div",{className:"w-48 bg-zinc-900 border border-zinc-700 rounded-lg p-3 shadow-xl animate-in fade-in zoom-in-95 duration-200",children:(0,r.jsxs)("div",{className:"space-y-1",children:[m.length>0&&(0,r.jsxs)("div",{className:"text-amber-300 text-xs",children:["特殊交易: ",m.join("、")]}),z.data.hasParking&&(0,r.jsxs)("div",{className:"flex items-center gap-1 text-xs text-blue-300",children:[(0,r.jsx)("span",{className:"flex items-center justify-center w-3 h-3 bg-blue-500 text-white text-[8px] font-bold rounded-sm",children:"P"}),(0,r.jsx)("span",{children:"含車位"})]}),0===z.data.premium&&(0,r.jsx)("div",{className:"text-cyan-400 font-bold mb-1",children:"★ 基準戶"}),null!==z.data.premium&&(0,r.jsxs)("div",{className:"text-zinc-300",children:["調價: ",(0,r.jsxs)("span",{className:(0,s.cn)(z.data.premium>0?"text-red-400":z.data.premium<0?"text-violet-400":"text-zinc-400"),children:[z.data.premium>0?"+":"",z.data.premium.toFixed(2),"%"]})]}),(0,r.jsx)("div",{className:"h-px bg-zinc-700 my-2"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-x-2 gap-y-1 text-xs text-zinc-400",children:[(0,r.jsx)("span",{children:"成交總價:"})," ",(0,r.jsxs)("span",{className:"text-white text-right",children:[V(z.data.tooltipInfo.totalPrice),"萬"]}),(0,r.jsx)("span",{children:"房屋總價:"})," ",(0,r.jsxs)("span",{className:"text-white text-right",children:[V(z.data.tooltipInfo.housePrice),"萬"]}),(0,r.jsx)("span",{children:"車位總價:"})," ",(0,r.jsxs)("span",{className:"text-white text-right",children:[V(z.data.tooltipInfo.parkingPrice),"萬"]}),(0,r.jsx)("span",{children:"房屋面積:"})," ",(0,r.jsxs)("span",{className:"text-white text-right",children:[V(z.data.tooltipInfo.houseArea,2),"坪"]})]})]})}))}),R&&(0,r.jsx)(X,{triggerRect:R.rect,isTopRow:!0,children:(0,r.jsxs)("div",{className:"w-56 bg-zinc-900 border border-zinc-700 rounded-lg p-2 shadow-xl text-xs text-zinc-300",children:["住宅面積變化: ",(0,r.jsx)("span",{className:"text-amber-300",children:R.label}),(0,r.jsx)("div",{className:"text-[10px] text-zinc-500 mt-1",children:"已排除店舖/商辦"})]})}),i&&(0,r.jsxs)("div",{className:"min-w-max pb-32",children:[(0,r.jsxs)("div",{className:"flex items-center justify-end gap-2 mb-2",children:[(0,r.jsx)("span",{className:"text-xs text-zinc-500",children:"特殊交易"}),H.map(e=>{let t=W===e.key;return(0,r.jsxs)("button",{onClick:()=>O(t=>t===e.key?null:e.key),className:(0,s.cn)("flex items-center gap-1 px-2 py-1 rounded border text-[10px] transition",t?"border-cyan-400 text-cyan-300 bg-cyan-500/10":"border-white/10 text-zinc-400 hover:text-zinc-200 hover:border-white/30"),children:[(0,r.jsx)("span",{className:(0,s.cn)("w-4 h-4 rounded border flex items-center justify-center text-[9px] font-bold bg-transparent",e.badgeClass),title:e.label,children:e.shortLabel}),e.label]},e.key)})]}),(0,r.jsxs)("table",{className:"divide-y divide-zinc-800 border-collapse w-full text-sm",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"sticky left-0 bg-dark-card z-20 p-2 text-zinc-400 border-r border-zinc-800",children:"樓層 \\ 戶別"}),y.map(e=>(0,r.jsx)("th",{className:(0,s.cn)("p-2 text-zinc-300 font-medium border-l border-zinc-800/50 bg-zinc-900/50 relative",q[e]?.hasVariance&&"bg-amber-500/10"),onMouseEnter:t=>{let i=q[e];i?.hasVariance&&L({rect:t.currentTarget.getBoundingClientRect(),label:i.label})},onMouseLeave:()=>L(null),children:(0,r.jsxs)("span",{className:"inline-flex items-center justify-center gap-1",children:[e,q[e]?.hasVariance&&(0,r.jsx)("span",{className:"px-1 py-0.5 text-[9px] rounded border border-amber-400/70 text-amber-300 bg-amber-500/10",children:"Δ坪"})]})},e))]})}),(0,r.jsx)("tbody",{className:"divide-y divide-zinc-800/50",children:p.map((e,t)=>(0,r.jsxs)("tr",{className:"hover:bg-zinc-800/30 transition-colors",children:[(0,r.jsx)("td",{className:"sticky left-0 bg-dark-card z-10 p-2 font-bold text-zinc-300 border-r border-zinc-800 text-center",children:e}),y.map(i=>{let n=u[e]?.[i];return n&&0!==n.length?(0,r.jsx)("td",{className:"p-1 border-l border-zinc-800/50 align-top",children:(0,r.jsx)("div",{className:"flex flex-col gap-1",children:n.map((e,i)=>{var n;let a=H.filter(t=>t.predicate(e)),o=a.length>0,c=o?"transparent":null===(n=e.premium)?"#1f2937":n<0?"rgba(139, 92, 246, 0.4)":0===n?"#06b6d4":n>5?"rgba(244, 63, 94, 0.5)":n>2?"rgba(234, 179, 8, 0.4)":"rgba(34, 197, 94, 0.3)",d=e.remark?.includes("露台")?{icon:(0,r.jsx)(l.A,{className:"w-3 h-3"}),label:"露台"}:null,x=0===e.premium,h=t<3,m=W?H.find(e=>e.key===W)?.predicate:null,u=!m||m(e);return(0,r.jsxs)("div",{className:(0,s.cn)("p-1.5 rounded text-xs transition-transform hover:scale-105 cursor-default relative group",x&&"ring-1 ring-cyan-500",o&&"bg-transparent border border-zinc-700/60",W&&!u&&"opacity-20",W&&u&&"ring-2 ring-cyan-400"),style:{backgroundColor:c},onMouseEnter:t=>{S({rect:t.currentTarget.getBoundingClientRect(),data:e,isTopRow:h})},onMouseLeave:B,children:[(0,r.jsxs)("div",{className:"flex flex-col gap-0.5 pr-4",children:[(0,r.jsxs)("span",{className:"font-semibold text-white flex items-center gap-1 leading-tight",children:[d&&(0,r.jsx)("span",{className:"text-zinc-200",title:d.label,children:d.icon}),e.unitPrice.toFixed(1),"萬"]}),(0,r.jsx)("div",{className:"text-[10px] text-zinc-300 font-mono tracking-tight opacity-90",children:e.transactionDate||"-"})]}),(0,r.jsxs)("div",{className:"absolute top-0.5 right-0.5 flex flex-col items-end gap-0.5",children:[a.map(e=>(0,r.jsx)("span",{className:(0,s.cn)("flex items-center justify-center w-3 h-3 text-[8px] font-bold rounded border bg-transparent",e.badgeClass),title:e.label,children:e.shortLabel},e.key)),e.hasParking&&(0,r.jsx)("span",{className:"flex items-center justify-center w-3 h-3 bg-blue-500 text-white text-[8px] font-bold rounded-sm",title:"含車位",children:"P"})]})]},i)})})},`${e}-${i}`):(0,r.jsx)("td",{className:"p-2 border-l border-zinc-800/50 bg-zinc-900/20 text-center text-zinc-600",children:"-"},`${e}-${i}`)})]},e))})]})]}),a&&N&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-zinc-200",children:["調價幅度統計摘要 (",Z,")"]}),(0,r.jsx)("div",{className:"overflow-x-auto rounded-lg border border-zinc-800",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left text-zinc-300",children:[(0,r.jsx)("thead",{className:"text-xs text-zinc-400 uppercase bg-zinc-900/50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3",children:"基準房屋總價"}),(0,r.jsx)("th",{className:"px-6 py-3",children:"調價幅度總額"}),(0,r.jsx)("th",{className:"px-6 py-3",children:"總溢價率"}),(0,r.jsx)("th",{className:"px-6 py-3",children:"已售房屋坪數"}),(0,r.jsx)("th",{className:"px-6 py-3",children:"平均單價調價"})]})}),(0,r.jsx)("tbody",{children:(0,r.jsxs)("tr",{className:"bg-zinc-900/20 border-b border-zinc-800",children:[(0,r.jsxs)("td",{className:"px-6 py-4",children:[V(N.totalBaselineHousePrice)," 萬"]}),(0,r.jsxs)("td",{className:(0,s.cn)("px-6 py-4 font-bold",N.totalPricePremiumValue>0?"text-red-400":"text-violet-400"),children:[N.totalPricePremiumValue>0?"+":"",V(N.totalPricePremiumValue)," 萬"]}),(0,r.jsxs)("td",{className:"px-6 py-4",children:[(N.totalPricePremiumValue/N.totalBaselineHousePrice*100).toFixed(2)," %"]}),(0,r.jsxs)("td",{className:"px-6 py-4",children:[V(N.totalSoldArea)," 坪"]}),(0,r.jsxs)("td",{className:(0,s.cn)("px-6 py-4",N.totalPricePremiumValue>0?"text-red-400":"text-violet-400"),children:[(N.totalPricePremiumValue/N.totalSoldArea).toFixed(2)," 萬/坪"]})]})})]})})]}),o&&w&&w.length>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-zinc-200",children:"戶型水平價差與溢價貢獻"}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs text-zinc-400",children:[e.comparisonMeta&&(0,r.jsxs)("span",{children:["原始最低戶型：",e.comparisonMeta.originalMinUnit||"-"," ","number"==typeof e.comparisonMeta.originalMinAvg?`(${e.comparisonMeta.originalMinAvg.toFixed(2)} 萬/坪)`:""," ｜ ","實際最低戶型：",e.comparisonMeta.actualMinUnit||"-"," ","number"==typeof e.comparisonMeta.actualMinAvg?`(${e.comparisonMeta.actualMinAvg.toFixed(2)} 萬/坪)`:""]}),A.topPair&&(0,r.jsxs)("span",{children:["AI 摘要：常見價差組合 ",A.topPair.unitA," ↔ ",A.topPair.unitB,"（",A.topPair.count," 層，平均差 ",A.topPair.avgDiff>0?"+":"",A.topPair.avgDiff.toFixed(2),"）"]}),A.maxPairOverall&&(0,r.jsxs)("span",{children:["最大價差：",A.maxPairOverall.floor,"F ",A.maxPairOverall.unitHigh," ↔ ",A.maxPairOverall.unitLow,"（",A.maxPairOverall.diff>0?"+":"",A.maxPairOverall.diff.toFixed(2),"）"]}),c&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-zinc-500",children:[(0,r.jsxs)("span",{children:["樓層配置：",k?.configurations?.length?`已同步 ${k.configurations.length} 組`:"未設定"]}),x&&x.length>0&&(0,r.jsx)("button",{onClick:()=>$(e=>!e),className:"px-2 py-1 rounded border border-white/10 text-[11px] text-zinc-400 hover:text-zinc-200 hover:border-white/30 transition",children:C?"收合配置":"設定配置"})]})]}),C&&x&&x.length>0&&c&&(0,r.jsx)("div",{className:"mt-3",children:(0,r.jsx)(Y,{transactions:x,project:c,configOnly:!0,title:"樓層配置（戶型水平價差）",storageScope:I,initialStep:"config",onConfigChange:e=>F(e)})}),(0,r.jsx)("div",{className:"overflow-x-auto rounded-lg border border-zinc-800",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left text-zinc-300",children:[(0,r.jsx)("thead",{className:"text-xs text-zinc-400 uppercase bg-zinc-900/50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3",children:"戶型"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"環境標籤"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"基準戶 (樓/價)"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"原始平均單價"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"實際平均單價"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"去化戶數"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"去化坪數"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"溢價(萬/坪)"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"溢價貢獻"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"貢獻佔比"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"細節"})]})}),(0,r.jsx)("tbody",{children:w.map((e,t)=>{let i,a,l,o;return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsxs)("tr",{className:"bg-zinc-900/20 border-b border-zinc-800 hover:bg-zinc-800/20",children:[(0,r.jsx)("td",{className:"px-4 py-3 font-medium text-white",children:e.unitType}),(0,r.jsx)("td",{className:"px-4 py-3",children:(a=(i=_?.get(e.unitType))?Array.from(i.labelMap.entries()):[]).length?(0,r.jsx)("div",{className:"flex flex-wrap gap-1",title:i?.details.join(" | "),children:a.map(([t,i])=>(0,r.jsx)("span",{className:`px-2 py-0.5 rounded text-[10px] border ${(e=>{switch(e){case"road":return"border-amber-400/40 text-amber-300 bg-amber-500/10";case"good":return"border-emerald-400/40 text-emerald-300 bg-emerald-500/10";case"bad":return"border-rose-400/40 text-rose-300 bg-rose-500/10";case"adjacent":return"border-zinc-500/40 text-zinc-300 bg-zinc-500/10";default:return"border-white/10 text-zinc-300 bg-white/5"}})(i)}`,children:t},`${e.unitType}-${t}`))}):(0,r.jsx)("span",{className:"text-zinc-500",children:"-"})}),(0,r.jsx)("td",{className:"px-4 py-3",children:e.anchorInfo}),(0,r.jsx)("td",{className:"px-4 py-3",children:"number"==typeof e.originalAvgPrice?`${e.originalAvgPrice.toFixed(2)} 萬/坪`:"-"}),(0,r.jsx)("td",{className:"px-4 py-3",children:"number"==typeof e.actualAvgPrice?`${e.actualAvgPrice.toFixed(2)} 萬/坪`:"-"}),(0,r.jsxs)("td",{className:"px-4 py-3",children:[e.unitsSold," 戶"]}),(0,r.jsx)("td",{className:"px-4 py-3",children:"number"==typeof e.totalSoldArea?`${e.totalSoldArea.toFixed(2)} 坪`:"-"}),(0,r.jsx)("td",{className:(0,s.cn)("px-4 py-3",e.avgPremiumPerPing>0?"text-red-400":"text-violet-400"),children:"number"==typeof e.avgPremiumPerPing?`${e.avgPremiumPerPing>0?"+":""}${e.avgPremiumPerPing.toFixed(2)} 萬/坪`:"-"}),(0,r.jsxs)("td",{className:(0,s.cn)("px-4 py-3 font-bold",e.timePremiumContribution>0?"text-red-400":"text-violet-400"),children:[e.timePremiumContribution>0?"+":"",V(e.timePremiumContribution)," 萬"]}),(0,r.jsxs)("td",{className:"px-4 py-3",children:["number"==typeof e.contributionPercentage?e.contributionPercentage.toFixed(2):"0.00","%"]}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsx)("button",{onClick:()=>P(t=>t===e.unitType?null:e.unitType),className:"text-[11px] text-cyan-300 border border-cyan-400/30 rounded px-2 py-1 hover:bg-cyan-500/10 transition",children:M===e.unitType?"收合":"展開"})})]}),M===e.unitType&&(0,r.jsx)("tr",{className:"bg-zinc-950/40 border-b border-zinc-800",children:(0,r.jsx)("td",{colSpan:11,className:"px-4 py-3",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{className:"rounded border border-white/10 bg-zinc-900/40 p-3",children:[(0,r.jsx)("div",{className:"text-xs text-zinc-400 mb-2",children:"戶型視角（跨樓層分位數）"}),A.unitOverallStats.get(e.unitType)?(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:(l=A.unitOverallStats.get(e.unitType),o=e=>`例: ${e.floor}F ↔ ${e.otherUnit} ${e.diff>0?"+":""}${e.diff.toFixed(2)}`,(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"rounded border border-white/10 bg-zinc-950/40 p-2",children:[(0,r.jsx)("div",{className:"text-[10px] text-zinc-500",children:"Q1"}),(0,r.jsxs)("div",{className:"text-[12px] text-zinc-200 font-mono",children:[l.q1>0?"+":"",l.q1.toFixed(2)]}),(0,r.jsx)("div",{className:"text-[10px] text-zinc-500 mt-1",children:o(l.samples.q1)})]}),(0,r.jsxs)("div",{className:"rounded border border-white/10 bg-zinc-950/40 p-2",children:[(0,r.jsx)("div",{className:"text-[10px] text-zinc-500",children:"Median"}),(0,r.jsxs)("div",{className:"text-[12px] text-zinc-200 font-mono",children:[l.median>0?"+":"",l.median.toFixed(2)]}),(0,r.jsx)("div",{className:"text-[10px] text-zinc-500 mt-1",children:o(l.samples.median)})]}),(0,r.jsxs)("div",{className:"rounded border border-white/10 bg-zinc-950/40 p-2",children:[(0,r.jsx)("div",{className:"text-[10px] text-zinc-500",children:"Q3"}),(0,r.jsxs)("div",{className:"text-[12px] text-zinc-200 font-mono",children:[l.q3>0?"+":"",l.q3.toFixed(2)]}),(0,r.jsx)("div",{className:"text-[10px] text-zinc-500 mt-1",children:o(l.samples.q3)})]}),(0,r.jsxs)("div",{className:"rounded border border-amber-400/30 bg-amber-500/10 p-2",children:[(0,r.jsx)("div",{className:"text-[10px] text-amber-300",children:"Max"}),(0,r.jsxs)("div",{className:"text-[12px] text-amber-200 font-mono",children:[l.max>0?"+":"",l.max.toFixed(2)]}),(0,r.jsx)("div",{className:"text-[10px] text-amber-200/80 mt-1",children:o(l.samples.max)})]})]}))}):(0,r.jsx)("span",{className:"text-[11px] text-zinc-500",children:"此戶型無跨樓層分布可計算"})]}),(0,r.jsxs)("div",{className:"rounded border border-white/10 bg-zinc-900/40 p-3",children:[(0,r.jsx)("div",{className:"text-xs text-zinc-400 mb-2",children:"樓層視角（同層戶型價差分位數）"}),(()=>{let t=A.unitFloorStats.get(e.unitType)||[];if(!t.length)return(0,r.jsx)("span",{className:"text-[11px] text-zinc-500",children:"此戶型無同層價差分布"});let i=t.filter(e=>e.median>=0).sort((e,t)=>t.median-e.median),n=t.filter(e=>e.median<0).sort((e,t)=>e.median-t.median),a=(t,i)=>{let n;return(0,r.jsxs)("div",{className:"rounded border border-white/10 bg-zinc-950/30 p-2",children:[(0,r.jsxs)("div",{className:"text-[11px] text-zinc-400 mb-1",children:[t.floor,"F"]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[(0,r.jsxs)("div",{className:"rounded border border-white/10 bg-zinc-950/40 p-2",children:[(0,r.jsx)("div",{className:"text-[10px] text-zinc-500",children:"Q1"}),(0,r.jsxs)("div",{className:"text-[12px] text-zinc-200 font-mono",children:[t.q1>0?"+":"",t.q1.toFixed(2)]}),(0,r.jsxs)("div",{className:"text-[10px] text-zinc-500 mt-1",children:["例: ↔ ",t.samples.q1.otherUnit," ",t.samples.q1.diff>0?"+":"",t.samples.q1.diff.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"rounded border border-white/10 bg-zinc-950/40 p-2",children:[(0,r.jsx)("div",{className:"text-[10px] text-zinc-500",children:"Median"}),(0,r.jsxs)("div",{className:"text-[12px] text-zinc-200 font-mono",children:[t.median>0?"+":"",t.median.toFixed(2)]}),(0,r.jsxs)("div",{className:"text-[10px] text-zinc-500 mt-1",children:["例: ↔ ",t.samples.median.otherUnit," ",t.samples.median.diff>0?"+":"",t.samples.median.diff.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"rounded border border-white/10 bg-zinc-950/40 p-2",children:[(0,r.jsx)("div",{className:"text-[10px] text-zinc-500",children:"Q3"}),(0,r.jsxs)("div",{className:"text-[12px] text-zinc-200 font-mono",children:[t.q3>0?"+":"",t.q3.toFixed(2)]}),(0,r.jsxs)("div",{className:"text-[10px] text-zinc-500 mt-1",children:["例: ↔ ",t.samples.q3.otherUnit," ",t.samples.q3.diff>0?"+":"",t.samples.q3.diff.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"rounded border border-amber-400/30 bg-amber-500/10 p-2",children:[(0,r.jsx)("div",{className:"text-[10px] text-amber-300",children:"Max"}),(0,r.jsxs)("div",{className:"text-[12px] text-amber-200 font-mono",children:[t.max>0?"+":"",t.max.toFixed(2)]}),(0,r.jsxs)("div",{className:"text-[10px] text-amber-200/80 mt-1",children:["例: ↔ ",t.samples.max.otherUnit," ",t.samples.max.diff>0?"+":"",t.samples.max.diff.toFixed(2)]})]})]}),c&&((n=((e,t,i)=>{if(!T)return null;let r=(e=>{if(!e)return 0;let t=String(e);if(t.startsWith("B")){let e=parseInt(t.substring(1),10);return Number.isFinite(e)?-e:0}let i=parseInt(t,10);return Number.isFinite(i)?i:0})(t),n=T.get(r);if(!n)return null;let a=n.get(e);if(!a)return null;let s=[],l=0;a.roadFacing&&(l+=1,s.push("臨路")),a.facingOpenSpace&&a.openSpaceType&&new Set((a.openSpaceFacingDirections&&a.openSpaceFacingDirections.length>0?a.openSpaceFacingDirections:[{type:a.openSpaceType,direction:a.openSpaceFacingDirection||""}]).map(e=>e.type).filter(Boolean)).forEach(e=>{let t=D[e]||e;if("adjacent"===e){l-=.5,s.push("臨房");return}if(["park","river","school","plaza","mountain"].includes(e)){l+=1,s.push(`面${t}`);return}if(["grave","tower","bridge"].includes(e)){l-=1,s.push(`面${t}`);return}s.push(`面${t}`)}),a.adjacentToUnits&&!s.includes("臨房")&&(l-=.5,s.push("臨房"));let o=l>.3?"positive":l<-.3?"negative":"neutral";return{status:"neutral"===o?"待觀察":o===(i>0?"positive":i<0?"negative":"neutral")?"合理":"需留意",reasons:s}})(e.unitType,t.floor,t.median))?(0,r.jsxs)("div",{className:`text-[10px] mt-2 ${"合理"===n.status?"text-green-300":"需留意"===n.status?"text-amber-300":"text-zinc-400"}`,children:["合理性：",n.status,n.reasons.length>0&&(0,r.jsxs)("span",{className:"text-zinc-500",children:[" \xb7 ",n.reasons.join("/")]})]}):(0,r.jsx)("div",{className:"text-[10px] text-zinc-500 mt-2",children:"合理性：未同步樓層配置"}))]},`${e.unitType}-floor-${t.floor}-${i}`)};return(0,r.jsxs)("div",{className:"space-y-3",children:[i.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-[11px] text-red-300 mb-1",children:"強勢樓層（Median ≥ 0）"}),(0,r.jsx)("div",{className:"space-y-2",children:i.map(a)})]}),n.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-[11px] text-cyan-300 mb-1",children:"弱勢樓層（Median < 0）"}),(0,r.jsx)("div",{className:"space-y-2",children:n.map(a)})]})]})})()]})]})})})]},t)})})]})})]})]}):(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無有效熱力圖資料"})}},96066:(e,t,i)=>{i.d(t,{Q:()=>l});var r=i(1934),n=i(31692);let a={"ranking-chart":{width:400,height:300},"ranking-table":{width:600,height:400},"ranking-metrics":{width:600,height:200},"price-band-chart":{width:450,height:280},"price-band-table":{width:600,height:400},"price-band-location-table":{width:600,height:400},"price-band-location-chart":{width:600,height:400},"unit-price-bubble":{width:380,height:320},"unit-price-stats":{width:1e3,height:400},"type-comparison-table":{width:600,height:350},"sales-velocity-chart":{width:420,height:260},"sales-velocity-table":{width:600,height:400},"sales-heatmap":{width:450,height:350},"sales-heatmap-detail":{width:800,height:400},"parking-pie":{width:300,height:300},"parking-price":{width:400,height:300},"parking-scatter":{width:450,height:350},"parking-floor":{width:400,height:400},heatmap:{width:500,height:350},"heatmap-grid":{width:800,height:500},"heatmap-stats":{width:800,height:120},"heatmap-comparison":{width:800,height:300},"data-list":{width:600,height:400}},s=e=>({id:`page-${Date.now()}`,name:`第 ${e+1} 頁`,items:[]}),l=(0,r.v)()((0,n.Zr)((e,t)=>({pages:[s(0)],currentPageIndex:0,canvasRatio:"16:9",zoomLevel:100,viewMode:"continuous",selectedIds:[],isDragging:!1,draggedItemCount:0,hoveredPageIndex:null,setViewMode:t=>e({viewMode:t}),setDragging:(t,i=0)=>e({isDragging:t,draggedItemCount:i}),setHoveredPageIndex:t=>e({hoveredPageIndex:t}),get items(){let e=t();return e.pages[e.currentPageIndex]?.items||[]},addPage:()=>{e(e=>{let t=s(e.pages.length);return{pages:[...e.pages,t],currentPageIndex:e.pages.length,selectedIds:[]}})},deletePage:t=>{e(e=>{if(e.pages.length<=1||-1===e.pages.findIndex(e=>e.id===t))return e;let i=e.pages.filter(e=>e.id!==t).map((e,t)=>({...e,name:`第 ${t+1} 頁`})),r=Math.min(e.currentPageIndex,i.length-1);return{pages:i,currentPageIndex:r,selectedIds:[]}})},setCurrentPage:t=>{e(e=>({currentPageIndex:Math.max(0,Math.min(t,e.pages.length-1)),selectedIds:[]}))},renamePage:(t,i)=>{e(e=>({pages:e.pages.map(e=>e.id===t?{...e,name:i}:e)}))},reorderPages:(t,i)=>{e(e=>{if(t===i)return e;let r=[...e.pages],[n]=r.splice(t,1);r.splice(i,0,n);let a=r.map((e,t)=>({...e,name:`第 ${t+1} 頁`})),s=e.currentPageIndex;return e.currentPageIndex===t?s=i:t<e.currentPageIndex&&i>=e.currentPageIndex?s=e.currentPageIndex-1:t>e.currentPageIndex&&i<=e.currentPageIndex&&(s=e.currentPageIndex+1),{pages:a,currentPageIndex:s}})},addItem:(t,i)=>{let r=a[t]||{width:400,height:300};e(e=>{let n=e.pages[e.currentPageIndex];if(!n)return e;let a=20*n.items.length,s={id:`item-${Date.now()}`,type:t,x:50+a,y:50+a,width:r.width,height:r.height,scaleMode:"select",panOffset:{x:0,y:0},contentScale:1,data:i};return{pages:e.pages.map((t,i)=>i===e.currentPageIndex?{...t,items:[...t.items,s]}:t),selectedIds:[s.id]}})},updateItem:(t,i)=>{e(e=>({pages:e.pages.map((r,n)=>n===e.currentPageIndex?{...r,items:r.items.map(e=>e.id===t?{...e,...i}:e)}:r)}))},removeItem:t=>{e(e=>({pages:e.pages.map((i,r)=>r===e.currentPageIndex?{...i,items:i.items.filter(e=>e.id!==t)}:i),selectedIds:e.selectedIds.filter(e=>e!==t)}))},moveItemToPage:(t,i)=>{e(e=>{let r=e.pages[e.currentPageIndex],n=r?.items.find(e=>e.id===t);return!n||i===e.currentPageIndex||i<0||i>=e.pages.length?e:{pages:e.pages.map((r,a)=>a===e.currentPageIndex?{...r,items:r.items.filter(e=>e.id!==t)}:a===i?{...r,items:[...r.items,{...n,x:50,y:50}]}:r),selectedIds:[]}})},clearCanvas:()=>{e(e=>({pages:e.pages.map((t,i)=>i===e.currentPageIndex?{...t,items:[]}:t),selectedIds:[]}))},batchUpdateItems:t=>{e(e=>({pages:e.pages.map((i,r)=>r===e.currentPageIndex?{...i,items:i.items.map(e=>t[e.id]?{...e,...t[e.id]}:e)}:i)}))},setCanvasRatio:t=>e({canvasRatio:t}),setZoomLevel:t=>e({zoomLevel:Math.max(25,Math.min(400,t))}),resetZoom:()=>e({zoomLevel:100}),setSelectedIds:t=>e({selectedIds:t}),toggleSelection:t=>{e(e=>({selectedIds:e.selectedIds.includes(t)?e.selectedIds.filter(e=>e!==t):[...e.selectedIds,t]}))},addToSelection:t=>{e(e=>({selectedIds:e.selectedIds.includes(t)?e.selectedIds:[...e.selectedIds,t]}))},clearSelection:()=>e({selectedIds:[]}),removeSelectedItems:()=>{e(e=>e.pages[e.currentPageIndex]?{pages:e.pages.map((t,i)=>i===e.currentPageIndex?{...t,items:t.items.filter(t=>!e.selectedIds.includes(t.id))}:t),selectedIds:[]}:e)},moveSelectedItemsToPage:t=>{e(e=>{if(t===e.currentPageIndex||t<0||t>=e.pages.length)return e;let i=e.pages[e.currentPageIndex].items.filter(t=>e.selectedIds.includes(t.id));return 0===i.length?e:{pages:e.pages.map((r,n)=>n===e.currentPageIndex?{...r,items:r.items.filter(t=>!e.selectedIds.includes(t.id))}:n===t?{...r,items:[...r.items,...i.map((e,t)=>({...e,x:50+20*t,y:50+20*t}))]}:r),selectedIds:[]}})}}),{name:"report-builder-storage"}))},97085:(e,t,i)=>{i.d(t,{A:()=>l});var r=i(95155);i(12115);var n=i(37206),a=i(81477);let s=(0,n.default)(()=>Promise.all([i.e(7776),i.e(4822)]).then(i.bind(i,44822)),{loadableGenerated:{webpack:()=>[null]},ssr:!1});function l({type:e,series:t,options:i,height:n=350,title:l,description:o,className:c,loading:d}){let x={chart:{background:"transparent",toolbar:{show:!1}},theme:{mode:"dark",palette:"palette1"},dataLabels:{enabled:!1},grid:{borderColor:"#374151",strokeDashArray:4},xaxis:{labels:{style:{colors:"#9ca3af"}},axisBorder:{color:"#4b5563"},axisTicks:{color:"#4b5563"}},yaxis:{labels:{style:{colors:"#9ca3af"}}},tooltip:{theme:"dark",style:{fontSize:"12px"},x:{show:!0}}},h={...x,...i,chart:{...x.chart,...i.chart}};return(0,r.jsxs)(a.Zp,{className:`p-4 ${c}`,children:[(l||o)&&(0,r.jsxs)("div",{className:"mb-4",children:[l&&(0,r.jsx)("h3",{className:"text-lg font-bold text-white mb-1",children:l}),o&&(0,r.jsx)("p",{className:"text-sm text-gray-400",children:o})]}),d?(0,r.jsx)("div",{className:"flex items-center justify-center",style:{height:n},children:(0,r.jsx)("div",{className:"loader"})}):(0,r.jsx)(s,{options:h,series:t,type:e,height:n,width:"100%"})]})}},98563:(e,t,i)=>{i.d(t,{E:()=>a});var r=i(95155);i(12115);var n=i(40980);function a({title:e,stats:t,noDataMessage:i="無資料",className:a,averageType:s="weighted"}){if(!t||0===t.count)return(0,r.jsxs)("div",{className:(0,n.cn)("p-6 border border-white/5 rounded-lg bg-zinc-900/30",a),children:[(0,r.jsx)("h3",{className:"text-zinc-400 font-medium mb-4",children:e}),(0,r.jsx)("p",{className:"text-zinc-500 text-center py-4",children:i})]});let l="weighted"===s&&t.weightedAvgPrice?t.weightedAvgPrice:t.avgPrice;return(0,r.jsxs)("div",{className:(0,n.cn)("p-6 border border-white/5 rounded-lg bg-zinc-900/30",a),children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-white",children:e}),(0,r.jsxs)("span",{className:"text-xs text-zinc-500 bg-zinc-800 px-2 py-1 rounded",children:["樣本數: ",t.count]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,r.jsx)("div",{className:"space-y-1",children:(0,r.jsx)("table",{className:"w-full text-sm",children:(0,r.jsxs)("tbody",{className:"divide-y divide-white/5",children:[(0,r.jsxs)("tr",{className:"group",children:[(0,r.jsx)("td",{className:"py-2 text-zinc-400",children:"weighted"===s?"加權平均單價":"算術平均單價"}),(0,r.jsxs)("td",{className:"py-2 text-right font-mono text-white group-hover:text-cyan-400 transition-colors",children:[(0,n.Z)(l)," 萬/坪"]})]}),(0,r.jsxs)("tr",{className:"group",children:[(0,r.jsx)("td",{className:"py-2 text-zinc-400",children:"最低單價"}),(0,r.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors",children:(0,n.Z)(t.minPrice)})]}),(0,r.jsxs)("tr",{className:"group",children:[(0,r.jsx)("td",{className:"py-2 text-zinc-400",children:"1/4分位數"}),(0,r.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors",children:(0,n.Z)(t.q1Price)})]}),(0,r.jsxs)("tr",{className:"group",children:[(0,r.jsx)("td",{className:"py-2 text-violet-400 font-medium",children:"中位數單價"}),(0,r.jsx)("td",{className:"py-2 text-right font-mono text-violet-400 font-bold",children:(0,n.Z)(t.medianPrice)})]}),(0,r.jsxs)("tr",{className:"group",children:[(0,r.jsx)("td",{className:"py-2 text-zinc-400",children:"3/4分位數"}),(0,r.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors",children:(0,n.Z)(t.q3Price)})]}),(0,r.jsxs)("tr",{className:"group",children:[(0,r.jsx)("td",{className:"py-2 text-zinc-400",children:"最高單價"}),(0,r.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors",children:(0,n.Z)(t.maxPrice)})]})]})})}),(0,r.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,r.jsxs)("div",{className:"p-3 bg-zinc-950/50 rounded border border-white/5",children:[(0,r.jsx)("div",{className:"text-cyan-500 font-medium mb-1 text-xs uppercase tracking-wider",children:"最高價建案"}),(0,r.jsx)("div",{className:"text-white font-bold text-lg mb-1",children:t.maxPriceProject||"N/A"}),(0,r.jsxs)("div",{className:"flex gap-4 text-zinc-400 text-xs",children:[(0,r.jsxs)("span",{children:["戶型: ",t.maxPriceUnit||"-"]}),(0,r.jsxs)("span",{children:["樓層: ",t.maxPriceFloor||"-"]})]})]}),(0,r.jsxs)("div",{className:"p-3 bg-zinc-950/50 rounded border border-white/5",children:[(0,r.jsx)("div",{className:"text-green-500 font-medium mb-1 text-xs uppercase tracking-wider",children:"最低價建案"}),(0,r.jsx)("div",{className:"text-white font-bold text-lg mb-1",children:t.minPriceProject||"N/A"}),(0,r.jsxs)("div",{className:"flex gap-4 text-zinc-400 text-xs",children:[(0,r.jsxs)("span",{children:["戶型: ",t.minPriceUnit||"-"]}),(0,r.jsxs)("span",{children:["樓層: ",t.minPriceFloor||"-"]})]})]})]})]})]})}},98883:(e,t,i)=>{i.d(t,{P:()=>r});let r=e=>{let t=new Date,i=new Date;switch(e){case"1q":i.setMonth(t.getMonth()-3);break;case"2q":i.setMonth(t.getMonth()-6);break;case"3q":i.setMonth(t.getMonth()-9);break;case"1y":i.setFullYear(t.getFullYear()-1);break;case"this_year":i=new Date(t.getFullYear(),0,1);break;case"last_2_years":i=new Date(t.getFullYear()-1,0,1);break;case"last_3_years":i=new Date(t.getFullYear()-2,0,1);break;default:return{startDate:"",endDate:""}}return{startDate:i.toISOString().split("T")[0],endDate:t.toISOString().split("T")[0]}}}}]);