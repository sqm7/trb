"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8831],{826:(e,t,a)=>{a.d(t,{B:()=>f});var i=a(95155),r=a(12115),s=a(47650),n=a(80642),l=a(39430),c=a(33210),o=a(44071),d=a(67514);let x="#06b6d4",h="#8b5cf6",m="#ffffff",u="#ffffff",p="#27272a",g="#9ca3af";function f({data:e}){let[t,a]=(0,r.useState)(null),[f,b]=(0,r.useState)(null),[y,j]=(0,r.useState)(null),[v,w]=(0,r.useState)(!1),N=(0,r.useRef)(null),z=(0,r.useRef)(null),k=(0,r.useRef)(null);(0,r.useEffect)(()=>{w(!0)},[]),(0,r.useEffect)(()=>{let e=e=>{let t=k.current;if(t&&!t.contains(e.target)){let t=N.current;if(t&&t.contains(e.target))return;a(null)}};if(t){let t=setTimeout(()=>{document.addEventListener("click",e)},100);return()=>{clearTimeout(t),document.removeEventListener("click",e)}}},[t]);let P=(0,r.useMemo)(()=>{if(!e||0===e.length)return null;let t=e.map(e=>[e.minPrice,e.q1Price,e.medianPrice,e.q3Price,e.maxPrice].some(e=>"number"!=typeof e||isNaN(e))?null:{category:null!==e.bathrooms?`${e.roomType}-${e.bathrooms}衛`:e.roomType,min:Math.round(e.minPrice),q1:Math.round(e.q1Price),median:Math.round(e.medianPrice),q3:Math.round(e.q3Price),max:Math.round(e.maxPrice),count:e.count}).filter(Boolean);if(0===t.length)return null;let a=t.flatMap(e=>[e.min,e.q1,e.median,e.q3,e.max]),i=Math.min(...a),r=Math.max(...a),s=r-i,n=0===s?Math.max(.1*i,100):.1*s;return{items:t,yMin:Math.max(0,i-n),yMax:r+n}},[e]),M=(0,r.useMemo)(()=>{if(!P)return null;let e=z.current?.clientWidth||800,t=e-100-40,a=t/P.items.length;return{width:e,height:450,drawWidth:t,drawHeight:330,categoryWidth:a}},[P,z.current?.clientWidth]),S=(0,r.useMemo)(()=>P&&M?e=>{let t=(e-P.yMin)/(P.yMax-P.yMin);return 40+M.drawHeight*(1-t)}:null,[P,M]),I=(0,r.useMemo)(()=>{if(!P)return[];let{yMin:e,yMax:t}=P,a=(t-e)/5;return Array.from({length:6},(t,i)=>Math.round(e+i*a))},[P]);return e&&0!==e.length&&P?(0,i.jsxs)("div",{ref:z,className:"relative w-full",children:[(0,i.jsx)("svg",{ref:N,width:"100%",height:450,className:"overflow-visible",onMouseMove:e=>{if(!N.current||!S||!P||!M)return;let t=N.current.getBoundingClientRect(),a=e.clientY-t.top;a>=40&&a<=40+M.drawHeight?j(a):j(null)},onMouseLeave:()=>{j(null)},children:M&&S&&(0,i.jsxs)(i.Fragment,{children:[I.map((e,t)=>(0,i.jsxs)("g",{children:[(0,i.jsx)("line",{x1:100,y1:S(e),x2:100+M.drawWidth,y2:S(e),stroke:p,strokeWidth:1,strokeDasharray:"4,4"}),(0,i.jsxs)("text",{x:90,y:S(e),textAnchor:"end",dominantBaseline:"middle",fill:g,fontSize:12,children:[e.toLocaleString()," 萬"]})]},`tick-${t}`)),(0,i.jsx)("text",{x:15,y:225,textAnchor:"middle",dominantBaseline:"middle",fill:g,fontSize:12,transform:`rotate(-90, 15, ${225})`,children:"房屋總價 (萬)"}),P.items.map((e,r)=>{let s=100+M.categoryWidth*(r+.5),n=30,l=15,c=S(e.max),o=S(e.q3),d=S(e.median),p=S(e.q1),y=S(e.min),j=f===r,v=t?.category===e.category;return(0,i.jsxs)("g",{className:"cursor-pointer transition-opacity",style:{opacity:null===f||j?1:.5},onMouseEnter:()=>b(r),onMouseLeave:()=>b(null),onClick:()=>a(e),children:[(0,i.jsx)("line",{x1:s,y1:o,x2:s,y2:c,stroke:m,strokeWidth:1,strokeLinecap:"round"}),(0,i.jsx)("line",{x1:s-l,y1:c,x2:s+l,y2:c,stroke:m,strokeWidth:1,strokeLinecap:"round"}),(0,i.jsx)("line",{x1:s,y1:p,x2:s,y2:y,stroke:m,strokeWidth:1,strokeLinecap:"round"}),(0,i.jsx)("line",{x1:s-l,y1:y,x2:s+l,y2:y,stroke:m,strokeWidth:1,strokeLinecap:"round"}),(0,i.jsx)("rect",{x:s-n,y:o,width:60,height:d-o,fill:x,stroke:j||v?"#ffffff":x,strokeWidth:1.5,rx:2,style:{filter:j?"brightness(1.2)":"none"}}),(0,i.jsx)("rect",{x:s-n,y:d,width:60,height:p-d,fill:h,stroke:j||v?"#ffffff":h,strokeWidth:1.5,rx:2,style:{filter:j?"brightness(1.2)":"none"}}),(0,i.jsx)("line",{x1:s-n,y1:d,x2:s+n,y2:d,stroke:u,strokeWidth:2}),(0,i.jsx)("text",{x:s,y:425,textAnchor:"middle",fill:j?"#ffffff":g,fontSize:12,fontWeight:j?"bold":"normal",children:e.category})]},e.category)}),null!==y&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("line",{x1:100,y1:y,x2:100+M.drawWidth,y2:y,stroke:"#22d3ee",strokeWidth:1,strokeDasharray:"4,4",pointerEvents:"none"}),(0,i.jsx)("rect",{x:100+M.drawWidth+5,y:y-12,width:70,height:24,rx:4,fill:"#18181b",stroke:"#22d3ee",strokeWidth:1}),(0,i.jsxs)("text",{x:100+M.drawWidth+40,y:y+4,textAnchor:"middle",fill:"#22d3ee",fontSize:11,fontWeight:"bold",children:[(e=>{if(!P||!M)return 0;let t=1-(e-40)/M.drawHeight;return Math.round(P.yMin+t*(P.yMax-P.yMin))})(y).toLocaleString()," 萬"]})]})]})}),v&&(0,s.createPortal)((0,i.jsx)(n.N,{children:t&&(0,i.jsxs)("div",{className:"fixed inset-0 z-[9998] pointer-events-none",children:[(0,i.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/50 backdrop-blur-sm pointer-events-auto",onClick:()=>a(null)}),(0,i.jsx)(l.P.div,{ref:k,initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",stiffness:400,damping:30},className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-auto w-[90vw] max-w-sm max-h-[85vh] flex flex-col",onClick:e=>e.stopPropagation(),children:(0,i.jsxs)("div",{className:"bg-zinc-900 border border-white/10 rounded-2xl shadow-2xl overflow-hidden flex flex-col",children:[(0,i.jsx)("div",{className:"bg-gradient-to-r from-cyan-500/20 to-violet-500/20 px-5 py-3 border-b border-white/10 flex-shrink-0",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-zinc-400 text-[10px] uppercase tracking-widest mb-0.5",children:"總價帶分析"}),(0,i.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,i.jsx)("div",{className:"text-white text-2xl font-black tracking-tight",children:t.category}),t.count>0&&(0,i.jsxs)("div",{className:"text-zinc-400 text-xs",children:["(",(0,i.jsx)("span",{className:"text-cyan-400 font-bold",children:t.count})," 筆)"]})]})]}),(0,i.jsx)("button",{onClick:()=>a(null),className:"p-1.5 rounded-full hover:bg-white/10 transition-colors",children:(0,i.jsx)(c.A,{className:"w-4 h-4 text-zinc-400"})})]})}),(0,i.jsxs)("div",{className:"p-4 space-y-2 overflow-y-auto flex-1 custom-scrollbar",children:[(0,i.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-lg bg-white/5 border border-white/5",children:[(0,i.jsx)(o.A,{className:"w-4 h-4 text-white/70 flex-shrink-0"}),(0,i.jsx)("div",{className:"flex-1 min-w-0",children:(0,i.jsxs)("div",{className:"flex justify-between items-baseline",children:[(0,i.jsx)("span",{className:"text-white/60 text-xs font-medium",children:"最高成交"}),(0,i.jsxs)("span",{className:"text-white text-base font-mono font-bold",children:[t.max.toLocaleString()," 萬"]})]})}),(0,i.jsx)("div",{className:"w-1 h-3 border-r border-white/50 flex-shrink-0",title:"上引線"})]}),(0,i.jsxs)("div",{className:"p-3 rounded-lg bg-cyan-500/10 border border-cyan-500/30",children:[(0,i.jsxs)("div",{className:"flex items-center gap-1.5 mb-1",children:[(0,i.jsx)("div",{className:"w-3 h-3 rounded-[2px] bg-cyan-500"}),(0,i.jsx)("span",{className:"text-cyan-400 text-xs font-bold",children:"較高價區間 (25%)"})]}),(0,i.jsxs)("div",{className:"text-white text-lg font-mono font-bold mb-1",children:[t.median.toLocaleString()," ~ ",t.q3.toLocaleString()," 萬"]}),(0,i.jsx)("div",{className:"text-zinc-400 text-[10px] leading-tight",children:"價格偏高但屬正常範圍的交易。"})]}),(0,i.jsx)("div",{className:"flex items-center gap-3 px-3 py-2 bg-white/5 rounded-lg border border-white/5",children:(0,i.jsx)("div",{className:"flex-1",children:(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsx)("div",{className:"text-white text-xs font-bold",children:"中位數 (50%)"}),(0,i.jsxs)("div",{className:"text-white text-lg font-mono font-bold",children:[t.median.toLocaleString()," 萬"]})]})})}),(0,i.jsxs)("div",{className:"p-3 rounded-lg bg-violet-500/10 border border-violet-500/30",children:[(0,i.jsxs)("div",{className:"flex items-center gap-1.5 mb-1",children:[(0,i.jsx)("div",{className:"w-3 h-3 rounded-[2px] bg-violet-500"}),(0,i.jsx)("span",{className:"text-violet-400 text-xs font-bold",children:"較低價區間 (25%)"})]}),(0,i.jsxs)("div",{className:"text-white text-lg font-mono font-bold mb-1",children:[t.q1.toLocaleString()," ~ ",t.median.toLocaleString()," 萬"]}),(0,i.jsx)("div",{className:"text-zinc-400 text-[10px] leading-tight",children:"價格偏低但屬正常範圍的交易。"})]}),(0,i.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-lg bg-white/5 border border-white/5",children:[(0,i.jsx)(d.A,{className:"w-4 h-4 text-zinc-500 flex-shrink-0"}),(0,i.jsx)("div",{className:"flex-1 min-w-0",children:(0,i.jsxs)("div",{className:"flex justify-between items-baseline",children:[(0,i.jsx)("span",{className:"text-zinc-500 text-xs font-medium",children:"最低成交"}),(0,i.jsxs)("span",{className:"text-white text-base font-mono font-bold",children:[t.min.toLocaleString()," 萬"]})]})}),(0,i.jsx)("div",{className:"w-1 h-3 border-r border-zinc-600 flex-shrink-0",title:"下引線"})]})]}),(0,i.jsx)("div",{className:"px-4 py-2 bg-white/5 border-t border-white/10 flex-shrink-0",children:(0,i.jsxs)("div",{className:"text-zinc-500 text-[10px] text-center",children:["\uD83D\uDCA1 藍+紫區塊涵蓋 ",(0,i.jsx)("span",{className:"text-white font-bold",children:"50%"})," 的交易 (市場主流)"]})})]})})]})}),document.body)]}):(0,i.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無總價帶資料可顯示"})}},3083:(e,t,a)=>{a.d(t,{M:()=>n});var i=a(95155),r=a(12115),s=a(97085);function n({data:e,selectedRooms:t,metric:a}){let n=(0,r.useMemo)(()=>({count:{label:"交易筆數",unit:"筆",decimals:0},priceSum:{label:"產權總價",unit:"萬",decimals:0},areaSum:{label:"房屋坪數",unit:"坪",decimals:2}})[a],[a]),l=(0,r.useMemo)(()=>{if(!e||0===t.length)return[];let i=Object.keys(e).sort();return 0===i.length?[]:t.map(t=>({name:t,data:i.map(i=>e[i]?.[t]?.[a]||0)}))},[e,t,a]),c=(0,r.useMemo)(()=>({chart:{type:"line",height:350,background:"transparent",toolbar:{show:!0},zoom:{enabled:!1},foreColor:"#e5e7eb"},stroke:{curve:"smooth",width:2},dataLabels:{enabled:!1},xaxis:{categories:e?Object.keys(e).sort():[],labels:{style:{colors:"#9ca3af"}}},yaxis:{title:{text:n.label,style:{color:"#9ca3af"}},labels:{style:{colors:"#9ca3af"},formatter:e=>e.toLocaleString("zh-TW",{minimumFractionDigits:0,maximumFractionDigits:0})}},legend:{position:"top",horizontalAlign:"right"},tooltip:{theme:"dark",y:{formatter:e=>`${e.toLocaleString("zh-TW",{minimumFractionDigits:n.decimals,maximumFractionDigits:n.decimals})} ${n.unit}`}},grid:{borderColor:"#374151"}}),[e,n]);return e&&0!==Object.keys(e).length&&0!==t.length?(0,i.jsx)(s.A,{type:"line",series:l,options:c,height:350,className:"w-full"}):(0,i.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"請選擇房型以顯示銷售趨勢"})}},4439:(e,t,a)=>{a.d(t,{m:()=>n});var i=a(95155),r=a(12115),s=a(97085);function n({data:e,selectedRooms:t,minArea:a,maxArea:n,interval:l,onDataPointClick:c,height:o}){let d=(0,r.useMemo)(()=>[{from:0,to:0,color:"#27272a",name:"0 戶"},{from:1,to:5,color:"#facc15",name:"1-5 戶"},{from:6,to:20,color:"#fbbf24",name:"6-20 戶"},{from:21,to:50,color:"#f97316",name:"21-50 戶"},{from:51,to:1e4,color:"#dc2626",name:"> 50 戶"}],[]),{series:x,maxValue:h}=(0,r.useMemo)(()=>{if(!e||0===t.length)return{series:[],maxValue:0};let i=[];for(let e=a;e<n;e+=l){let t=Number.isInteger(l)&&Number.isInteger(a),r=t?e.toFixed(0):e.toFixed(1),s=t?(e+l).toFixed(0):(e+l).toFixed(1);i.push(`${r}-${s}`)}let r=0;return{series:i.map(i=>{let[s,l]=i.split("-").map(parseFloat);return{name:i,data:t.map(t=>{let i=(e[t]||[]).filter(e=>e>=s&&e<l&&e>=a&&e<=n).length;return i>r&&(r=i),i})}}),maxValue:r}},[e,t,a,n,l]),m=(0,r.useMemo)(()=>({chart:{type:"heatmap",height:o||Math.max(400,22*x.length),background:"transparent",toolbar:{show:!0},foreColor:"#e5e7eb",events:{dataPointSelection:(e,a,i)=>{if(c){let{seriesIndex:e,dataPointIndex:a}=i,r=i.w.globals.seriesNames[e];c(t[a],r)}}}},plotOptions:{heatmap:{radius:0,useFillColorAsStroke:!0,enableShades:!1,colorScale:{ranges:d}}},dataLabels:{enabled:!0,style:{colors:[({value:e})=>0===e?"transparent":"#e5e7eb"]},formatter:function(e){return 0===e?"":e}},xaxis:{type:"category",categories:t},title:{text:"房型面積分佈熱力圖",align:"center",style:{color:"#e5e7eb",fontSize:"16px"}},grid:{borderColor:"#374151"},tooltip:{theme:"dark",y:{formatter:e=>0===e?"無成交紀錄":`${e} 戶`}}}),[x,t,d,c]);return e&&0!==x.length?(0,i.jsx)(s.A,{type:"heatmap",series:x,options:m,height:m.chart?.height||400,className:"w-full h-full"}):(0,i.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無面積分佈資料"})}},27529:(e,t,a)=>{a.d(t,{FH:()=>l});var i=a(16385),r=a(55873);async function s(){let{data:{session:e}}=await i.N.auth.getSession();return{"Content-Type":"application/json",apikey:r.m5,Authorization:`Bearer ${e?.access_token||r.m5}`}}async function n(e){let t=await s(),a=await fetch(r.Sn.RANKING_ANALYSIS,{method:"POST",headers:t,body:JSON.stringify({filters:e})});if(!a.ok)throw Error((await a.json().catch(()=>({error:`Analysis request failed: ${a.status}`}))).error||"Analyze data failed");return a.json()}let l={checkAuth:async function(){let{data:{session:e}}=await i.N.auth.getSession();e||console.log("User not logged in, but allowing access.")},getUser:async function(){let{data:{user:e}}=await i.N.auth.getUser();return e},signOut:async function(){let{error:e}=await i.N.auth.signOut();if(e)throw console.error("Sign out failed:",e),e},fetchData:async function(e,t){let a=await s(),i=await fetch(r.Sn.QUERY_DATA,{method:"POST",headers:a,body:JSON.stringify({filters:e,pagination:t})});if(!i.ok)throw Error((await i.json().catch(()=>({error:"Failed to parse server response"}))).error||"Fetch data failed");return i.json()},analyzeData:n,analyzeProjectRanking:n,fetchSubData:async function(e,t,a){if(!e||!t||!a)throw Error(`Insufficient parameters: ${e}, ${t}, ${a}`);let i=await s(),n=await fetch(r.Sn.SUB_DATA,{method:"POST",headers:i,body:JSON.stringify({id:e,type:t,county:a})});if(!n.ok)throw Error((await n.json().catch(()=>({error:"Failed to fetch sub data"}))).error||"Fetch sub data failed");return n.json()},fetchProjectNameSuggestions:async function(e,t,a=[]){let i=await s(),n=t.replace(/\u3127/g,"一"),l=await fetch(r.Sn.PROJECT_NAMES,{method:"POST",headers:i,body:JSON.stringify({countyCode:e,query:n,districts:a,detailed:!0})});if(!l.ok)throw Error(`Server error: ${l.status}`);return l.json()},generateShareLink:async function(e){let t=await s(),a=await fetch(r.Sn.GENERATE_SHARE_LINK,{method:"POST",headers:t,body:JSON.stringify(e)});if(!a.ok)throw Error((await a.json().catch(()=>({error:"Generate share link failed"}))).error);return a.json()},getAdminUsers:async function(){let e=await s(),t=await fetch(r.Sn.GET_USERS,{method:"POST",headers:e,body:JSON.stringify({})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to fetch users"}))).error||"Fetch users failed");return t.json()}}},51806:(e,t,a)=>{a.d(t,{a:()=>l});var i=a(95155);a(12115);var r=a(33210),s=a(40980),n=a(81477);function l({isOpen:e,onClose:t,title:a,children:l,className:c,maxWidth:o="max-w-4xl"}){return e?(0,i.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm animate-in fade-in duration-200",children:[(0,i.jsx)("div",{className:"absolute inset-0",onClick:t}),(0,i.jsxs)(n.Zp,{className:(0,s.cn)("relative w-full max-h-[90vh] flex flex-col overflow-hidden animate-in zoom-in-95 duration-200",o,c),onClick:e=>e.stopPropagation(),children:[(0,i.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border-default",children:[a&&(0,i.jsx)("h2",{className:"text-2xl font-bold text-white",children:a}),(0,i.jsx)("button",{onClick:t,className:"p-1 rounded-full hover:bg-white/10 transition-colors text-gray-400 hover:text-white",children:(0,i.jsx)(r.A,{size:24})})]}),(0,i.jsx)("div",{className:"p-6 overflow-y-auto custom-scrollbar",children:l})]})]}):null}},58742:(e,t,a)=>{a.d(t,{z:()=>i});let i=[{id:"p-2012-08-01",date:"2012-08-01",title:"實價登錄 1.0 上路",category:"policy",impact:"high",description:"交易後30日內申報，區段化揭露(30號區間)，預售屋採代銷結案後整批申報。",change_content:"交易資訊不透明 -> 區段化揭露",affected_scope:"房仲業者、買賣雙方、預售屋投機客",background:"低利環境延續：國內房貸利率處於低檔 (約1.8%-1.9%)。",impact_analysis:"[受益] 買方獲得參考依據。[適應] 房仲失去資訊壟斷優勢。[無感] 預售屋投機客因資訊未即時揭露，仍可操作紅單。",details:["申報義務人：地政士、經紀業或權利人。","申報時機：買賣案件於辦竣所有權移轉登記後30日內申報。","揭露方式：以區段化、去識別化方式提供查詢 (例如：中正路1-30號)。","預售屋規定：委託代銷者，於委託代銷契約屆滿或終止30日內「整批」申報 (資訊落後嚴重)。"]},{id:"p-2014-06-04",date:"2014-06-04",title:"囤房稅 1.0",category:"policy",impact:"medium",description:"非自住住家用稅率由1.2%-2%調高為1.5%-3.6%，授權地方政府自訂差別稅率。",change_content:"非自住稅率 1.2% -> 1.5%~3.6%",affected_scope:"多屋族、台北市置產客",background:"美國聯準會結束QE：預期升息心理浮現，全球資金派對暫歇。",impact_analysis:"[微痛] 持有成本上升，但因多數縣市未採最高稅率，且稅基(房屋評定現值)偏低，實質痛感有限。",details:["自住房屋稅率：維持 1.2% (需本人、配偶或直系親屬實際居住，且全國合計3戶以內)。","非自住房屋稅率：由 1.2%~2% 調升至 1.5%~3.6%。","地方權限：各地方政府可視地方發展需要，在範圍內自訂差別稅率。","持有認定：以個人(自然人)或法人(公司)為單位個別計算。"]},{id:"p-2016-01-01",date:"2016-01-01",title:"房地合一稅 1.0",category:"policy",impact:"high",description:"獲利課稅取代舊制。持有<1年45%，1-2年35%，自用滿6年獲利400萬免稅。奢侈稅同步停徵。",change_content:"按售價課稅(奢侈稅) -> 按獲利課稅(45%~15%)",affected_scope:"短線炒作客、自住客",background:"奢侈稅同步停徵：象徵房市進入「實價課稅」新紀元。",impact_analysis:"[毀滅] 短進短出獲利被腰斬，投資客大量退場。[受益] 房價盤整，自住客獲得較佳議價空間。",details:["課稅基礎：房地交易所得 = 交易成交價額 - 原始取得成本 - 相關費用 - 土地漲價總數額。","持有1年以內：稅率 45%。","持有1-2年：稅率 35%。","持有2-10年：稅率 20%。","持有超過10年：稅率 15%。","自用住宅優惠：獲利400萬元以下免稅，超過部分10%。(需連續設籍滿6年)","日出條款：2016年1月1日以後取得之房地適用新制。"]},{id:"f-2016-03-24",date:"2016-03-24",title:"央行大幅鬆綁信用管制",category:"finance",impact:"high",description:"刪除特定地區管制與自然人第3戶以上限制，僅保留豪宅管制(6成)。",change_content:"刪除多數管制，僅保留豪宅限貸",affected_scope:"換屋族、一般投資客",background:"經濟成長疲弱：為提振內需經濟，央行解除長達6年的房市管制。",impact_analysis:"[受益] 貸款成數恢復，換屋與置產門檻降低，市場交易量逐漸回溫。",details:["解除管制區域：台北市及新北市特定地區。","解除限制對象：自然人第3戶以上購屋貸款、公司法人購屋貸款。","保留限制：高價住宅(豪宅)貸款最高成數仍維持6成。"]},{id:"p-2018-06-27",date:"2018-06-27",title:"租賃住宅市場發展及管理條例",category:"policy",impact:"low",description:"建立包租代管機制，鼓勵房東釋出空屋，給予稅賦優惠(所得稅減免)。",change_content:"包租代管稅賦優惠",affected_scope:"房東、租屋族",background:"美中貿易戰開打：全球供應鏈重組，資金開始撤離中國。",impact_analysis:"[受益] 房東享有所得稅減免；租屋族獲得專業代管服務，租賃關係較有保障。",details:["租稅優惠：個人房東委託包租代管，月租金6000元以下免稅；6000-20000元必要費用率53%。","專業證照：建立租賃住宅管理人員證照制度。","糾紛處理：建立租賃糾紛免費調處機制。"]},{id:"f-2019-08-15",date:"2019-08-15",title:"境外資金匯回專法",category:"finance",impact:"medium",description:"鼓勵台商資金回流享優惠稅率，禁止直接投資房地產，但產生外溢效應帶動豪宅與工業地產。",change_content:"資金專法回流 (禁入房市但有外溢)",affected_scope:"工業地產主、豪宅建商",background:"台商回流潮：史上最大規模資金回台，雖禁入房市，但產生外溢效應。",impact_analysis:"[暴富] 工業用地與廠房價格飆漲。[受益] 企業主獲利與分紅轉入豪宅市場，帶動高總價產品去化。",details:["優惠稅率：第一年匯回稅率8%，第二年10%。(實質投資可退稅一半)","投資限制：禁止資金直接投資房地產(避免炒房)。","資金控管：資金需存入專戶，控管5-7年才能分批提取。","外溢效應：雖然不能直接買房，但增加市場資金總量，且企業獲利後的分紅仍可自由運用。"]},{id:"f-2020-03-19",date:"2020-03-19",title:"央行降息 1 碼",category:"finance",impact:"high",description:"重貼現率降至1.125%，房貸利率跌破1.4%歷史新低，無限QE背景下引發資產通膨。",change_content:"重貼現率 1.375% -> 1.125%",affected_scope:"全體購屋族、股市投資人",background:"COVID-19 疫情爆發：美國聯準會無限QE，全球熱錢氾濫。",impact_analysis:"[刺激] 持有成本極低，「租不如買」與「買房抗通膨」心理大爆發，股房雙漲。",details:["降息幅度：調降重貼現率 0.25個百分點。","房貸利率：五大銀行新承做房貸利率跌破 1.4%，創歷史新低。","配套補貼：針對受疫情影響產業及自用住宅貸款提供額外補貼。"]},{id:"f-2020-12-08",date:"2020-12-08",title:"央行信用管制 (第一波)",category:"finance",impact:"medium",description:"法人購屋限貸6成，自然人第3戶限貸6成，建商餘屋限貸5成。",change_content:"法人/第3戶/餘屋 限貸 5-6成",affected_scope:"公司法人、多屋族(3戶+)",background:"房市過熱跡象：紅單炒作猖獗，排隊買房現象頻傳。",impact_analysis:"[警示] 宣示政府打炒房決心，但因低利環境，實質殺傷力有限。",details:["公司法人：第一戶貸款成數最高 6成，無寬限期。","自然人第3戶(含)以上：貸款成數最高 6成，無寬限期。","購地貸款：限貸 6.5成，需保留 1成動工款。","餘屋貸款：限貸 5成。"]},{id:"f-2021-03-19",date:"2021-03-19",title:"央行信用管制 (第二波)",category:"finance",impact:"medium",description:"法人購屋成數降至4成，豪宅降至5.5成。",change_content:"法人限貸 4成；豪宅限貸 5.5成",affected_scope:"公司法人、豪宅客",background:"投機風氣未減",impact_analysis:"[打擊] 封鎖利用公司名義高槓桿炒房的途徑。",details:["公司法人：貸款成數調降至 4成。","自然人高價住宅：第1戶限貸 5.5成，第3戶以上限貸 4成。","工業區閒置土地：貸款最高 5.5成。"]},{id:"p-2021-07-01",date:"2021-07-01",title:"實價登錄 2.0 & 房地合一 2.0",category:"policy",impact:"high",description:"門牌完整揭露，預售屋即時申報(30日)，禁止紅單轉售；重稅期延長(45%改2年, 35%改5年)，預售屋納稅。",change_content:"預售屋納管、重稅閉鎖期延長、禁紅單",affected_scope:"預售屋買方/投機客、建商、換屋族",background:"房市多頭確立；疫情三級警戒(內需停滯但房市創高)",impact_analysis:"[雙面刃] 資訊全透明反成定錨工具。[閉鎖] 投機客無法短進短出，成屋惜售供給減少，價格難跌。",details:["實價登錄2.0：門牌號碼完整揭露 (不再區段化)。","預售屋納管：銷售前需備查，簽約後30日內申報實價登錄。","紅單禁止：禁止預售屋紅單轉售。","房地合一2.0：預售屋獲利納入房地合一稅課徵。","延長重稅期：持有2年內45%，2-5年35% (原為1-2年)。","法人比照：法人交易比照自然人稅率 (防堵公司名義短期炒作)。"]},{id:"f-2021-09-24",date:"2021-09-24",title:"央行信用管制 (第三波)",category:"finance",impact:"medium",description:"特定地區 (六都+新竹) 第2戶取消寬限期。",change_content:"特定地區第2戶 取消寬限期",affected_scope:"投資客、換屋族",background:"房價持續攀升",impact_analysis:"[壓力] 買第2間房必須立刻還本金，增加現金流壓力，迫使部分槓桿過大者退場。",details:["管制區域：新增特定地區 (六都 + 新竹縣市)。","自然人第2戶：取消寬限期 (需本息攤還)。","購地貸款：調降至 6成。","工業區閒置土地：調降至 5成。"]},{id:"f-2021-12-17",date:"2021-12-17",title:"央行信用管制 (第四波)",category:"finance",impact:"medium",description:"豪宅貸款降至4成，第3戶降至4成，餘屋貸款降至4成。",change_content:"豪宅/第3戶/餘屋 限貸 4成",affected_scope:"建商、豪宅客",background:"營建成本飆漲：缺工缺料議題發酵。",impact_analysis:"[緊縮] 建商資金鏈趨緊，中小型建商生存困難，市場走向大者恆大。",details:["自然人高價住宅：貸款成數一律降至 4成 (無寬限期)。","自然人第3戶(含)以上：貸款成數一律降至 4成。","購地貸款：降至 5成。","餘屋貸款：降至 4成。"]},{id:"f-2022-03-17",date:"2022-03-17",title:"央行升息循環啟動",category:"finance",impact:"medium",description:"央行跟進Fed升息(全年共2.5碼)，房貸利率重回2%以上。",change_content:"升息 2.5碼 (利率重回 2% table+)",affected_scope:"房貸族",background:"全球通膨危機：美國暴力升息，全球股市修正。",impact_analysis:"[負擔增加] 每千萬房貸每年利息支出增加約3-4萬元，稍微冷卻追價意願。",details:["2022-03：升息 1碼 (0.25%)。","2022-06：升息 半碼 (0.125%)。","2022-09：升息 半碼 (0.125%)。","2022-12：升息 半碼 (0.125%)。","存款準備率：同步調升，緊縮市場游資。"]},{id:"f-2023-06-16",date:"2023-06-16",title:"央行信用管制 (第五波)",category:"finance",impact:"medium",description:"特定地區第2戶限貸成數上限 7成。",change_content:"特定地區第2戶 限貸 7成",affected_scope:"換屋族、投資客",background:"房市量縮價穩：市場觀望平均地權條例上路。",impact_analysis:"[微痛] 需多準備1成自備款，影響尚可控。",details:["管制區域：特定地區 (六都 + 新竹縣市)。","自然人第2戶：新增貸款成數上限 7成 (此前僅無寬限期)。"]},{id:"p-2023-07-01",date:"2023-07-01",title:"平均地權條例修正",category:"policy",impact:"high",description:"預售屋禁止換約轉售，建立檢舉獎金，私法人購屋許可制。",change_content:"預售屋禁換約、私法人許可制",affected_scope:"預售屋黃牛、豪宅法人",background:"投機客的大限",impact_analysis:"[滅絕] 純粹賺價差的紅單與換約客徹底消失。豪宅市場因法人需經許可，交易量急凍。",details:["限制換約轉售：預售屋與新建成屋簽約後，除配偶、直系或二親等旁系外，不得讓與或轉售 (禁止黃牛)。","重罰炒作：嚴懲散播不實資訊影響房價，最高罰5000萬元。","檢舉獎金：建立檢舉實名制，獎金為罰鍰 30%。","私法人購屋許可制：私法人購買住宅用房屋需經內政部許可 (限制豪宅私法人節稅管道)。"]},{id:"p-2023-08-01",date:"2023-08-01",title:"新青安貸款專案",category:"policy",impact:"high",description:"額度1000萬，年限40年，寬限期5年，利率補貼(1.775%起)。",change_content:"40年期/5年寬限/降息補貼",affected_scope:"首購族、投機客(人頭)、低總價屋主",background:"總統大選前夕：政府釋出利多，試圖減輕年輕人負擔。",impact_analysis:"[狂熱] 創造「租不如買」與「5年免還本」的套利空間。低總價成屋被掃貨，房價逆勢暴漲。",details:["貸款額度：提高至 1000萬元。","利息補貼：政府補貼 1.5碼 (0.375%) + 公股銀行減半碼 = 利率 1.775% 起。","貸款年限：延長至 40年。","寬限期：延長至 5年 (只繳息不還本)。","資格：本人、配偶及未成年子女名下均無自有住宅。"]},{id:"f-2024-06-14",date:"2024-06-14",title:"央行信用管制 (第六波)",category:"finance",impact:"medium",description:"特定地區第2戶限貸成數降至 6成。",change_content:"特定地區第2戶 限貸 6成",affected_scope:"換屋族、置產客",background:"台股站上2萬點：AI熱潮帶動股市財富效應，資金外溢至房市。",impact_analysis:"[無效] 股市獲利豐厚，6成限貸無法阻擋資金湧入房市。",details:["管制區域：特定地區 (六都 + 新竹縣市)。","自然人第2戶：貸款成數上限由 7成調降為 6成。","調升存款準備率：調升 0.25個百分點 (收回市場資金)。"]},{id:"p-2024-07-01",date:"2024-07-01",title:"囤房稅 2.0 實施",category:"policy",impact:"medium",description:"全國歸戶，非自用稅率調高至 2.0%-4.8%，建商餘屋依持有年限課稅。",change_content:"全國歸戶；稅率 2.0%~4.8%",affected_scope:"多屋族、租屋族、建商",background:"租金指數創高",impact_analysis:"[轉嫁] 多屋族將稅負轉嫁至租金，導致租金上漲。建商面臨餘屋去化壓力，傾向預售完銷。",details:["全國歸戶：由縣市歸戶改為全國歸戶計算戶數。","稅率調升：非自住住家用稅率調升為 2%~4.8% (原1.5%~3.6%)。","單一自住優惠：全國單一自住(本人配偶子女僅一戶)且房屋現值在一定金額以下，稅率降至 1%。","建商餘屋：持有2年以內稅率 2%~3.6%；超過2年稅率 2%~4.8% (鼓勵釋出餘屋)。"]},{id:"f-2024-08-01",date:"2024-08-01",title:"銀行限貸令 (72-2水位)",category:"finance",impact:"high",description:"銀行法72-2條逼近30%上限，自主限貸、排隊撥款，市場流動性急凍。",change_content:"銀行自主限貸、排隊撥款",affected_scope:"即將交屋族、賣屋換屋族",background:"新青安效應發酵：過多成屋交易與新青安撥款，耗盡銀行額度。",impact_analysis:"[恐慌] 買了房卻貸不到款，面臨違約風險。市場流動性瞬間急凍。",details:["銀行法72-2條：商業銀行辦理住宅建築及企業建築放款總額，不得超過存款總餘額及金融債券發售額之 30%。","現象：多家銀行房貸水位接近滿載。","影響：銀行暫停收件、排隊撥款(需等數月)、利率大幅調升(2.6%-3%以上)。"]},{id:"f-2024-09-20",date:"2024-09-20",title:"央行信用管制 (第七波)",category:"finance",impact:"high",description:"有房者第1戶無寬限期；全國第2戶限貸5成；法人/豪宅/第3戶限貸3成。",change_content:"有房者第1戶無寬限；第2戶全國限貸5成",affected_scope:"換屋族、繼承族、交屋族",background:"金龍海嘯：央行判定房市過熱，認為新青安助長投機，決心斷絕金流。",impact_analysis:"[重傷/錯殺] 史上最嚴厲管制。1. 換屋族需5成自備。2. 繼承祖產失寬限。3. 預售交屋斷頭風險大增。",details:["自然人第1戶：名下有房屋者(含繼承、持分)，第1戶購屋貸款「無寬限期」。","自然人第2戶：貸款成數上限降至 5成，且擴及「全國」。","自然人第3戶以上：貸款成數上限降至 3成。","公司法人：購屋貸款成數降至 3成。","豪宅(高價住宅)：貸款成數降至 3成。","餘屋貸款：降至 3成。","存款準備率：再調升 0.25個百分點。"]}]},60529:(e,t,a)=>{a.d(t,{p:()=>n});var i=a(95155),r=a(12115),s=a(40980);let n=r.forwardRef(({className:e,type:t,...a},r)=>(0,i.jsx)("input",{type:t,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-zinc-950/50 px-3 py-2 text-sm text-zinc-100 ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...a}));n.displayName="Input"},69690:(e,t,a)=>{a.d(t,{l:()=>n});var i=a(95155),r=a(12115),s=a(97085);function n({data:e,sortKey:t,limit:a=30,chartType:n="auto",height:l}){let c=(0,r.useMemo)(()=>n&&"auto"!==n?n:["averagePrice","minPrice","maxPrice","medianPrice","avgParkingPrice"].includes(t)?"bar":"treemap",[t,n]),o=(0,r.useMemo)(()=>({averagePrice:{title:"建案平均單價排行",unit:"萬/坪"},minPrice:{title:"建案最低單價排行",unit:"萬/坪"},maxPrice:{title:"建案最高單價排行",unit:"萬/坪"},medianPrice:{title:"建案單價中位數排行",unit:"萬/坪"},avgParkingPrice:{title:"車位平均單價排行",unit:"萬"},saleAmountSum:{title:"建案銷售總額佔比",unit:"萬",yLabel:"銷售總額"},houseAreaSum:{title:"建案房屋面積佔比",unit:"坪",yLabel:"房屋面積"},transactionCount:{title:"建案交易筆數佔比",unit:"筆",yLabel:"資料筆數"}})[t]||{title:"建案分析圖表",unit:"",yLabel:"數值"},[t]),d=(0,r.useMemo)(()=>{if(!e||0===e.length)return[];if("bar"!==c)return e.reduce((e,a)=>e+(a[t]||0),0),[{name:o.yLabel||o.unit,data:e.map(e=>({x:e.projectName,y:parseFloat((e[t]||0).toFixed(2))}))}];{let i=[...e].filter(e=>e[t]>0).sort((e,a)=>a[t]-e[t]).slice(0,a);return[{name:o.unit,data:i.map(e=>parseFloat((e[t]||0).toFixed(2)))}]}},[e,t,c,o,a]),x=(0,r.useMemo)(()=>{let i={title:{text:o.title,align:"center",style:{fontSize:"16px",fontWeight:600,color:"#e5e7eb"}}};if("bar"===c){let r=[...e].filter(e=>e[t]>0).sort((e,a)=>a[t]-e[t]).slice(0,a).map(e=>e.projectName);return{...i,chart:{type:"bar",toolbar:{show:!0},animations:{enabled:!1}},tooltip:{theme:"dark",y:{formatter:e=>`${e.toLocaleString()} ${o.unit}`,title:{formatter:(e,t)=>{let a=r[t?.dataPointIndex];return a?`${a}:`:`${e}:`}}},x:{show:!0,formatter:(e,t)=>r[t?.dataPointIndex]||e}},plotOptions:{bar:{horizontal:!1,columnWidth:"60%",borderRadius:4,distributed:!1}},colors:["#8b5cf6"],fill:{type:"gradient",gradient:{shade:"dark",type:"vertical",shadeIntensity:.5,gradientToColors:["#a78bfa"],inverseColors:!0,opacityFrom:1,opacityTo:1,stops:[0,100]}},dataLabels:{enabled:!1},xaxis:{categories:r,labels:{style:{colors:"#9ca3af"},rotate:-45,trim:!0,maxHeight:100}},yaxis:{title:{text:o.unit,style:{color:"#6b7280"}},labels:{style:{colors:"#e5e7eb",fontSize:"12px",fontWeight:500}}},legend:{show:!1}}}{let a=e.reduce((e,a)=>e+(a[t]||0),0);return{...i,tooltip:{theme:"dark",y:{formatter:e=>`${e.toLocaleString()} ${o.unit}`}},chart:{type:"treemap",height:450,toolbar:{show:!0}},plotOptions:{treemap:{distributed:!0,enableShades:!1,colorScale:{ranges:[{from:0,to:.1*a,color:"#06b6d4"},{from:.1*a,to:.3*a,color:"#3b82f6"},{from:.3*a,to:.6*a,color:"#8b5cf6"},{from:.6*a,to:1/0,color:"#d946ef"}]}}},dataLabels:{enabled:!0,style:{fontSize:"11px",fontWeight:500,colors:["#fff"]},formatter:e=>e,offsetY:-2}}}},[c,d,o,e,t,a]);if(!e||0===e.length)return(0,i.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無排名資料可顯示"});let h="bar"===c&&d[0]?.data?d[0].data.length:0,m="bar"===c?{width:"100%",minWidth:`${45*h}px`}:{width:"100%"};return(0,i.jsx)("div",{className:`w-full ${"bar"===c?"overflow-x-auto pb-4":""}`,children:(0,i.jsx)("div",{style:m,children:(0,i.jsx)(s.A,{type:"bar"===c?"bar":"treemap",series:d,options:x,height:l||450,className:"w-full"})})})}},70872:(e,t,a)=>{a.d(t,{Bc:()=>l,ZI:()=>d,k$:()=>o,m_:()=>c});var i=a(95155),r=a(12115),s=a(45828),n=a(40980);let l=s.Kq,c=s.bL,o=s.l9,d=r.forwardRef(({className:e,sideOffset:t=4,...a},r)=>(0,i.jsx)(s.UC,{ref:r,sideOffset:t,className:(0,n.cn)("z-50 overflow-hidden rounded-md border border-zinc-800 bg-zinc-950 px-3 py-1.5 text-sm text-zinc-100 shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a}));d.displayName=s.UC.displayName},81477:(e,t,a)=>{a.d(t,{BT:()=>o,Wu:()=>d,ZB:()=>c,Zp:()=>n,aR:()=>l});var i=a(95155),r=a(12115),s=a(40980);let n=r.forwardRef(({className:e,...t},a)=>(0,i.jsx)("div",{ref:a,className:(0,s.cn)("glass-panel rounded-xl text-card-foreground",e),...t}));n.displayName="Card";let l=r.forwardRef(({className:e,...t},a)=>(0,i.jsx)("div",{ref:a,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",e),...t}));l.displayName="CardHeader";let c=r.forwardRef(({className:e,...t},a)=>(0,i.jsx)("h3",{ref:a,className:(0,s.cn)("text-lg font-semibold leading-none tracking-tight text-white",e),...t}));c.displayName="CardTitle";let o=r.forwardRef(({className:e,...t},a)=>(0,i.jsx)("p",{ref:a,className:(0,s.cn)("text-sm text-zinc-400",e),...t}));o.displayName="CardDescription";let d=r.forwardRef(({className:e,...t},a)=>(0,i.jsx)("div",{ref:a,className:(0,s.cn)("p-6 pt-0",e),...t}));d.displayName="CardContent",r.forwardRef(({className:e,...t},a)=>(0,i.jsx)("div",{ref:a,className:(0,s.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"},88042:(e,t,a)=>{a.d(t,{$:()=>o});var i=a(95155),r=a(12115),s=a(47650),n=a(40980),l=a(60529);let c=({children:e,x:t,y:a,visible:n})=>{let[l,c]=(0,r.useState)(!1);return((0,r.useEffect)(()=>(c(!0),()=>c(!1)),[]),l&&n&&!("u"<typeof document))?(0,s.createPortal)((0,i.jsx)("div",{className:"fixed pointer-events-none z-[9999]",style:{left:t,top:a,transform:"translate(-50%, -100%) translateY(-12px)"},children:e}),document.body):null};function o({data:e,minPrice:t,maxPrice:a,interval:s,sizeMetric:o,onMinPriceChange:d,onMaxPriceChange:x,onIntervalChange:h,onSizeMetricChange:m}){let[u,p]=(0,r.useState)("natural"),[g,f]=(0,r.useState)(null),[b,y]=(0,r.useState)({x:0,y:0}),j=(0,r.useRef)(null),[v,w]=(0,r.useState)({width:0,height:0});(0,r.useEffect)(()=>{if(!j.current)return;let e=()=>{j.current&&w({width:j.current.clientWidth,height:j.current.clientHeight})};e(),window.addEventListener("resize",e);let t=setTimeout(e,200);return()=>{window.removeEventListener("resize",e),clearTimeout(t)}},[]);let N=(e,t)=>{let a=e.currentTarget.getBoundingClientRect();y({x:a.left+a.width/2,y:a.top}),f(t)},{buckets:z,validBuckets:k,maxValue:P}=(0,r.useMemo)(()=>{if(!e||0===e.length)return{buckets:[],validBuckets:[],maxValue:0};let i=[];for(let e=t;e<a;e+=s)i.push({min:e,max:Math.min(e+s,a),label:`${e}-${Math.min(e+s,a)}`,count:0,totalArea:0,avgPrice:0,transactions:[]});e.forEach(e=>{let r=e["房屋單價(萬)"],n=e["房屋面積(坪)"]||0;if("number"!=typeof r||r<t||r>=a)return;let l=Math.floor((r-t)/s);l>=0&&l<i.length&&(i[l].count++,i[l].totalArea+=n,i[l].transactions.push(e))});let r=i.filter(e=>e.count>0),n=Math.max(...r.map(e=>"count"===o?e.count:e.totalArea));return{buckets:i,validBuckets:r,maxValue:n}},[e,t,a,s,o]),{nodes:M,onMouseDown:S,dragId:I}=((e,t,a,i,s,n)=>{let[l,c]=(0,r.useState)([]),o=(0,r.useRef)(null),d=(0,r.useRef)(null),x=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(!e.length||!t||!a)return;let r=t/2,n=a/2,l=e.map((e,t)=>{let a="count"===i?e.count:e.totalArea,r=s>0?30+a/s*80:30;return{id:e.label,value:a,radius:r/2,x:0,y:0,vx:0,vy:0,origIndex:t}});l.sort((e,t)=>e.value-t.value),l=l.map((e,t)=>{let a=2.39996*t,i=10*Math.sqrt(t)*2.5;return{...e,x:r+Math.cos(a)*i,y:n+Math.sin(a)*i}});for(let e=0;e<120;e++)for(let e=0;e<l.length;e++)for(let t=e+1;t<l.length;t++){let a=l[e],i=l[t],r=i.x-a.x,s=i.y-a.y,n=r*r+s*s,c=a.radius+i.radius+5;if(n<c*c&&n>0){let e=Math.sqrt(n),t=c-e,l=r/e,o=s/e,d=.5*t;a.x-=l*d,a.y-=o*d,i.x+=l*d,i.y+=o*d}}c(l)},[e,t,a,i,s]),(0,r.useEffect)(()=>{if(!n)return;let e=e=>{x.current={x:e.clientX,y:e.clientY}},t=()=>{d.current=null,x.current=null};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[n]),(0,r.useEffect)(()=>{if(!n||0===l.length||!t)return;let e=t/2,i=a/2,r=()=>{c(t=>{let a=t.map(e=>({...e})),r=0,s=0,n=0,l=0;d.current&&x.current&&(r=x.current.x-d.current.startX,s=x.current.y-d.current.startY,n=d.current.nodeOrigX+r,l=d.current.nodeOrigY+s),a.forEach(t=>{if(d.current?.id===t.id)t.x=n,t.y=l,t.vx=0,t.vy=0;else{let a=e-t.x,r=i-t.y;t.vx+=.05*a*.05,t.vy+=.05*r*.05,t.vx+=(Math.random()-.5)*.003,t.vy+=(Math.random()-.5)*.003,t.x+=t.vx,t.y+=t.vy,t.vx*=.94,t.vy*=.94}});for(let e=0;e<6;e++)for(let e=0;e<a.length;e++)for(let t=e+1;t<a.length;t++){let i=a[e],r=a[t],s=d.current?.id===i.id,n=d.current?.id===r.id,l=r.x-i.x,c=r.y-i.y,o=l*l+c*c,x=i.radius+r.radius+5;if(o<x*x&&o>0){let e=Math.sqrt(o),t=x-e,a=l/e,d=c/e,h=.5*t;s?(r.x+=a*t,r.y+=d*t):n?(i.x-=a*t,i.y-=d*t):(i.x-=a*h,i.y-=d*h,r.x+=a*h,r.y+=d*h)}}return a}),o.current=requestAnimationFrame(r)};return o.current=requestAnimationFrame(r),()=>{null!==o.current&&cancelAnimationFrame(o.current)}},[n,t,a,l.length]),{nodes:l,onMouseDown:(e,t,a,i)=>{e.preventDefault(),d.current={id:t,startX:e.clientX,startY:e.clientY,nodeOrigX:a,nodeOrigY:i},x.current={x:e.clientX,y:e.clientY}},dragId:d.current?.id}})(k,v.width,v.height,o,P,"natural"===u);if(!e||0===e.length)return(0,i.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無交易資料可顯示"});let A=(e,t)=>{let a,i,r=e/(t-1||1);return r<.33?(a="radial-gradient(circle at 30% 30%, rgb(167, 139, 250), rgb(124, 58, 237))",i="rgba(124, 58, 237, 0.4)"):r<.66?(a="radial-gradient(circle at 30% 30%, rgb(34, 211, 238), rgb(8, 145, 178))",i="rgba(8, 145, 178, 0.4)"):(a="radial-gradient(circle at 30% 30%, rgb(52, 211, 153), rgb(5, 150, 105))",i="rgba(5, 150, 105, 0.4)"),{background:a,shadowColor:i}},C=null!==g?k[g]:null;return(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsx)(c,{x:b.x,y:b.y,visible:null!==g&&!!C&&!I,children:C&&(0,i.jsxs)("div",{className:"px-4 py-3 bg-zinc-900/90 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl min-w-[160px] animate-in fade-in zoom-in-95 duration-200",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,i.jsx)("span",{className:"text-xs font-medium text-zinc-400",children:"成交單價"}),(0,i.jsx)("span",{className:"text-sm font-bold text-white",children:C.label})]}),(0,i.jsxs)("div",{className:"space-y-1.5",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center text-xs",children:[(0,i.jsx)("span",{className:"text-zinc-500",children:"成交筆數"}),(0,i.jsxs)("span",{className:"font-medium text-violet-300",children:[C.count," 筆"]})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center text-xs",children:[(0,i.jsx)("span",{className:"text-zinc-500",children:"總銷坪數"}),(0,i.jsxs)("span",{className:"font-medium text-cyan-300",children:[Math.round(C.totalArea)," 坪"]})]})]}),(0,i.jsx)("div",{className:"absolute left-1/2 bottom-0 -mb-1 w-2 h-2 bg-zinc-900/90 border-r border-b border-white/10 rotate-45 -translate-x-1/2"})]})}),(0,i.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4 p-4 bg-zinc-900/30 border border-white/5 rounded-xl",children:[(0,i.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-zinc-400 text-xs",children:"單價範圍"}),(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)(l.p,{type:"number",value:t,onChange:e=>d(Number(e.target.value)),className:"w-16 h-7 text-xs bg-zinc-950/50 border-white/10 px-2"}),(0,i.jsx)("span",{className:"text-zinc-600",children:"-"}),(0,i.jsx)(l.p,{type:"number",value:a,onChange:e=>x(Number(e.target.value)),className:"w-16 h-7 text-xs bg-zinc-950/50 border-white/10 px-2"})]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-zinc-400 text-xs",children:"級距"}),(0,i.jsx)(l.p,{type:"number",value:s,onChange:e=>h(Number(e.target.value)),className:"w-14 h-7 text-xs bg-zinc-950/50 border-white/10 px-2"})]}),(0,i.jsxs)("div",{className:"flex bg-zinc-950/50 rounded-md p-0.5 border border-white/10",children:[(0,i.jsx)("button",{onClick:()=>m("count"),className:(0,n.cn)("px-2.5 py-1 text-[10px] rounded transition-colors","count"===o?"bg-violet-500 text-white shadow-sm":"text-zinc-400 hover:text-white"),children:"成交筆數"}),(0,i.jsx)("button",{onClick:()=>m("area"),className:(0,n.cn)("px-2.5 py-1 text-[10px] rounded transition-colors","area"===o?"bg-violet-500 text-white shadow-sm":"text-zinc-400 hover:text-white"),children:"總銷坪數"})]})]}),(0,i.jsxs)("div",{className:"bg-zinc-950/50 p-1 rounded-lg border border-white/5 flex gap-1",children:[(0,i.jsx)("button",{onClick:()=>p("natural"),className:(0,n.cn)("px-3 py-1.5 text-xs font-medium rounded-md transition-all duration-300","natural"===u?"bg-gradient-to-r from-violet-600 to-indigo-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-500 hover:text-zinc-300"),children:(0,i.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,i.jsxs)("span",{className:"relative flex h-2 w-2",children:[(0,i.jsx)("span",{className:(0,n.cn)("absolute inline-flex h-full w-full rounded-full bg-violet-400 opacity-75","natural"===u&&"animate-ping")}),(0,i.jsx)("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-violet-500"})]}),"無重力模式"]})}),(0,i.jsx)("button",{onClick:()=>p("coordinate"),className:(0,n.cn)("px-3 py-1.5 text-xs font-medium rounded-md transition-all duration-300","coordinate"===u?"bg-gradient-to-r from-violet-600 to-indigo-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-500 hover:text-zinc-300"),children:(0,i.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,i.jsxs)("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,i.jsx)("path",{d:"M3 3v18h18"}),(0,i.jsx)("path",{d:"M18 17V9"}),(0,i.jsx)("path",{d:"M13 17V5"}),(0,i.jsx)("path",{d:"M8 17v-3"})]}),"座標模式"]})})]})]}),(0,i.jsxs)("div",{ref:j,className:(0,n.cn)("relative rounded-3xl overflow-hidden border border-white/5 transition-all duration-500","bg-gradient-to-b from-zinc-900 via-zinc-900 to-zinc-950","h-full min-h-[500px]"),children:[(0,i.jsxs)("div",{className:"absolute inset-0 pointer-events-none",children:[(0,i.jsx)("div",{className:"absolute top-0 inset-x-0 h-px bg-gradient-to-r from-transparent via-white/10 to-transparent"}),(0,i.jsx)("div",{className:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-violet-500/10 rounded-full blur-[100px]"}),(0,i.jsx)("div",{className:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-cyan-500/10 rounded-full blur-[100px]"})]}),(0,i.jsxs)("div",{className:"absolute inset-0",children:["natural"===u&&(0,i.jsxs)("div",{className:"absolute inset-0",children:[M.map((e,t)=>{let a=g===e.origIndex,r=I===e.id,s=A(e.origIndex,k.length),l=2*e.radius;return(0,i.jsxs)("div",{className:(0,n.cn)("absolute block rounded-full select-none cursor-grab active:cursor-grabbing will-change-transform",r?"z-[100] scale-110 shadow-2xl":"transition-[transform,box-shadow] duration-75 ease-linear"),style:{width:l,height:l,left:0,top:0,transform:`translate(${e.x-e.radius}px, ${e.y-e.radius}px) scale(${a||r?1.1:1})`,background:s.background,boxShadow:r?`0 25px 50px -12px ${s.shadowColor}, inset 0 2px 20px rgba(255,255,255,0.6)`:a?`0 20px 40px -10px ${s.shadowColor}, inset 0 2px 20px rgba(255,255,255,0.4)`:`0 10px 30px -10px ${s.shadowColor}, inset 0 2px 10px rgba(255,255,255,0.2)`,zIndex:r?100:a?50:10},onMouseEnter:t=>N(t,e.origIndex),onMouseLeave:()=>f(null),onMouseDown:t=>S(t,e.id,e.x,e.y),children:[(0,i.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-white/0 via-white/0 to-white/30 opacity-50 pointer-events-none"}),(0,i.jsx)("div",{className:"absolute top-[15%] left-[15%] w-[25%] h-[15%] rounded-[100%] bg-white blur-[2px] opacity-40 transform -rotate-45 pointer-events-none"}),(0,i.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-center z-20 pointer-events-none",children:[(0,i.jsx)("div",{className:(0,n.cn)("font-bold text-white drop-shadow-md leading-none",l>80?"text-2xl":l>60?"text-lg":"text-sm","mix-blend-overlay opacity-90"),children:e.value>=1?Math.round(e.value):e.value.toFixed(1)}),l>80&&(0,i.jsx)("div",{className:"text-[10px] text-white/70 mt-1 font-medium tracking-wide",children:"count"===o?"筆":"坪"})]})]},e.id)}),(0,i.jsx)("div",{className:"absolute bottom-4 left-0 right-0 text-center text-xs text-zinc-500 font-medium tracking-widest uppercase opacity-50 pointer-events-none",children:"Zero Gravity • Force Layout • Draggable"})]}),"coordinate"===u&&(0,i.jsxs)("div",{className:"absolute inset-0 pt-6 pb-8 px-0",children:[(0,i.jsx)("div",{className:"flex flex-col justify-between h-full py-0 pr-1 text-right w-[46px] border-r border-white/5 relative z-10 float-left",children:[...Array(6)].map((e,r)=>(0,i.jsx)("span",{className:"text-xs font-mono text-zinc-600 block leading-none transform -translate-y-1/2 first:translate-y-0 last:-translate-y-full",children:Math.round(a-(a-t)/5*r)},r))}),(0,i.jsxs)("div",{className:"relative ml-[46px] h-full",children:[(0,i.jsx)("div",{className:"absolute inset-0 flex flex-col justify-between pointer-events-none",children:[...Array(6)].map((e,t)=>(0,i.jsx)("div",{className:"w-full h-px border-t border-dashed border-zinc-800"},t))}),(0,i.jsx)("div",{className:"absolute inset-0",children:k.map((e,r)=>{var s;let l=(s="count"===o?e.count:e.totalArea,0===P?40:40+s/P*100),c=(e.min+e.max)/2,d=r/(k.length-1||1)*90+5,x=100-(c-t)/(a-t)*100,h=g===r,m=A(r,k.length);return(0,i.jsx)("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 transition-all duration-500",style:{left:`${d}%`,top:`${x}%`,zIndex:h?50:20},onMouseEnter:e=>N(e,r),onMouseLeave:()=>f(null),children:(0,i.jsx)("div",{className:(0,n.cn)("relative rounded-full flex items-center justify-center cursor-pointer shadow-lg transition-transform duration-300",h?"scale-110":"scale-100"),style:{width:l,height:l,background:m.background,boxShadow:h?`0 10px 20px -5px ${m.shadowColor}, inset 0 2px 10px rgba(255,255,255,0.3)`:`0 5px 15px -5px ${m.shadowColor}, inset 0 2px 5px rgba(255,255,255,0.2)`},children:(0,i.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-transparent to-white/30 opacity-60"})})},e.label)})}),(0,i.jsxs)("div",{className:"absolute bottom-0 inset-x-0 flex justify-between text-xs text-zinc-600 font-mono translate-y-full pt-1 px-2",children:[(0,i.jsx)("span",{children:"Low Price"}),(0,i.jsx)("span",{children:"High Price"})]})]})]})]})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between px-2 text-xs text-zinc-500",children:[(0,i.jsxs)("div",{children:["* Bubble size represents ","count"===o?"Transaction Count":"Total Area"]}),(0,i.jsxs)("div",{className:"flex items-center gap-4",children:[(0,i.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,i.jsx)("div",{className:"w-2 h-2 rounded-full bg-violet-500"}),(0,i.jsx)("span",{children:"Low"})]}),(0,i.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,i.jsx)("div",{className:"w-2 h-2 rounded-full bg-cyan-500"}),(0,i.jsx)("span",{children:"Mid"})]}),(0,i.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,i.jsx)("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),(0,i.jsx)("span",{children:"High"})]})]})]})]})}},88743:(e,t,a)=>{a.d(t,{M:()=>s,P:()=>n});var i=a(1934);let r={counties:[],districts:[],transactionType:"預售交易",buildingType:"",projectNames:[],dateRange:"1y",startDate:"",endDate:"",excludeCommercial:!1,floorPremium:.3,rankingCurrentPage:1,rankingPageSize:10,currentSort:{key:"saleAmountSum",order:"desc"},currentAverageType:"arithmetic",velocityView:"monthly",velocityMetric:"count",activeTab:"ranking",isFilterBarCompact:!1,analysisData:null,selectedRoomTypes:["套房","1房","2房","3房","4房","毛胚"]},s=["套房","1房","2房","3房","4房","毛胚","店舖","辦公/事務所","廠辦/工廠","其他"],n=(0,i.v)(e=>({...r,setCounties:t=>e({counties:t,districts:[]}),setDistricts:t=>e({districts:t}),setTransactionType:t=>e({transactionType:t}),setBuildingType:t=>e({buildingType:t}),setProjectNames:t=>e({projectNames:t}),setDateRange:(t,a,i)=>e(e=>({dateRange:t,startDate:a||e.startDate,endDate:i||e.endDate})),setCustomDate:(t,a)=>e({startDate:t,endDate:a,dateRange:"custom"}),setExcludeCommercial:t=>e({excludeCommercial:t}),setFloorPremium:t=>e({floorPremium:t}),setRankingCurrentPage:t=>e({rankingCurrentPage:t}),setRankingPageSize:t=>e({rankingPageSize:t}),setCurrentSort:t=>e({currentSort:t}),setCurrentAverageType:t=>e({currentAverageType:t}),setVelocityView:t=>e({velocityView:t}),setVelocityMetric:t=>e({velocityMetric:t}),setActiveTab:t=>e({activeTab:t}),setIsFilterBarCompact:t=>e({isFilterBarCompact:t}),setAnalysisData:t=>e({analysisData:t}),setSelectedRoomTypes:t=>e({selectedRoomTypes:t}),resetFilters:()=>e(r),hydrateFilters:t=>e(e=>({...e,...t}))}))},93398:(e,t,a)=>{a.d(t,{t:()=>p});var i=a(95155),r=a(12115),s=a(47650),n=a(40980),l=a(43987),c=a(32745),o=a(75364),d=a(8875);let x=(e,t=0)=>e?.toLocaleString(void 0,{maximumFractionDigits:t}),h=[{key:"employee",label:"員工關係戶",shortLabel:"員",badgeClass:"border-purple-500/70 text-purple-300",predicate:e=>!!e.isEmployeeRelated},{key:"office",label:"事務所/商辦",shortLabel:"辦",badgeClass:"border-blue-500/70 text-blue-300",predicate:e=>!!e.isOffice},{key:"storefront",label:"店鋪",shortLabel:"店",badgeClass:"border-amber-500/70 text-amber-300",predicate:e=>!!e.isStorefront}],m=e=>null===e?"#1f2937":e<0?"rgba(16, 185, 129, 0.4)":0===e?"#06b6d4":e>5?"rgba(244, 63, 94, 0.5)":e>2?"rgba(249, 115, 22, 0.5)":"rgba(234, 179, 8, 0.4)",u=({children:e,triggerRect:t,isTopRow:a})=>{if(!t)return null;let r={position:"fixed",left:t.left+t.width/2,transform:"translateX(-50%)",zIndex:9999};return a?r.top=t.bottom+8:r.bottom=window.innerHeight-t.top+8,(0,s.createPortal)((0,i.jsx)("div",{style:r,className:"pointer-events-none",children:e}),document.body)};function p({data:e,floorPremium:t=.3,showGrid:a=!0,showSummary:s=!0,showComparison:p=!0,configProject:g,configScope:f,rawTransactions:b}){let y,j,{horizontalGrid:v,sortedFloors:w,sortedUnits:N,unitColorMap:z,summary:k,horizontalComparison:P}=e,[M,S]=(0,r.useState)(null),[I,A]=(0,r.useState)(null),[C,F]=(0,r.useState)(null),[_,$]=(0,r.useState)(!1),[E,T]=(0,r.useState)("premium"),[L,D]=(0,r.useState)("percent"),[R,O]=(0,r.useState)(null),W=f||o.Ze;(0,r.useEffect)(()=>{if(!g)return;let e=async()=>{let e=(0,o.oP)(g,W);e&&F(e);try{let e=await (0,o.ew)(g);e&&F(e)}catch(e){console.warn("Failed to fetch official config:",e)}};e();let t=t=>{!t.detail?.project||t.detail.project!==g||t.detail?.scope&&t.detail.scope!==W||e()};return window.addEventListener(o.Vz,t),()=>window.removeEventListener(o.Vz,t)},[g,W]),(0,r.useEffect)(()=>{O(null)},[I]);let B=(0,r.useCallback)(e=>{F(e)},[]),q=(0,r.useMemo)(()=>{if(!p||!v||!N||0===N.length)return{topPair:null,maxPairOverall:null,unitOverallStats:new Map,unitFloorStats:new Map,unitsInMaxPair:new Set};let e=new Map(N.map((e,t)=>[e,t])),t=new Map;Object.keys(v||{}).forEach(e=>{let a=new Map,i=v?.[e]||{};Object.keys(i).forEach(e=>{(i[e]||[]).forEach(t=>{if(!t||null===t.premium)return;let i=parseFloat(t["房屋單價(萬)"]||t.unitPrice||0);Number.isFinite(i)&&!(i<=0)&&(a.has(e)||a.set(e,[]),a.get(e).push(i))})}),a.size>0&&t.set(e,a)});let a=new Map,i=new Set,r=null,s=(e,t)=>{let a=e=>e?e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e)||0:0;return a(t)-a(e)},n=(e,t)=>{if(!e.length)return 0;let a=[...e].sort((e,t)=>e-t),i=(a.length-1)*t,r=Math.floor(i);return void 0!==a[r+1]?a[r]+(i-r)*(a[r+1]-a[r]):a[r]},l=(e,t)=>e.reduce((e,a)=>e?Math.abs(a.diff-t)<Math.abs(e.diff-t)?a:e:a,e[0]),c=e=>{if(!e.length)return null;let t=e.map(e=>e.diff),a=n(t,.25),i=n(t,.5),r=n(t,.75),s=i>=0?e.reduce((e,t)=>t.diff>e.diff?t:e,e[0]):e.reduce((e,t)=>t.diff<e.diff?t:e,e[0]);return{q1:a,median:i,q3:r,max:s.diff,samples:{q1:l(e,a),median:l(e,i),q3:l(e,r),max:s}}},o=new Map,d=new Map,x=new Map;Array.from(t.keys()).sort(s).forEach(s=>{let n=t.get(s);if(!n)return;let l=Array.from(n.keys()).sort((t,a)=>(e.get(t)??0)-(e.get(a)??0)),o=null;for(let e=0;e<l.length;e++)for(let t=e+1;t<l.length;t++){let i=l[e],r=l[t],s=n.get(i)||[],c=n.get(r)||[];if(!s.length||!c.length)continue;let d=[],x=s.slice(0,20),h=c.slice(0,20);x.forEach(e=>{h.forEach(t=>{d.push(e-t)})});let m=`${i}__${r}`;a.has(m)||a.set(m,{unitA:i,unitB:r,diffs:[],count:0});let u=a.get(m);u.diffs.push(...d),u.count+=1;let p=d.reduce((e,t)=>Math.abs(t)>Math.abs(e)?t:e,d[0]);(!o||Math.abs(p)>Math.abs(o.diff))&&(o={unitHigh:p>=0?i:r,unitLow:p>=0?r:i,diff:p})}o&&(i.add(o.unitHigh),i.add(o.unitLow),(!r||Math.abs(o.diff)>Math.abs(r.diff))&&(r={floor:s,unitHigh:o.unitHigh,unitLow:o.unitLow,diff:o.diff})),l.forEach(e=>{let t=n.get(e)||[];if(!t.length)return;let a=[],i=t.slice(0,10);if(l.forEach(t=>{if(t===e)return;let r=n.get(t)||[];if(!r.length)return;let l=r.slice(0,10);i.forEach(e=>{l.forEach(i=>{a.push({diff:e-i,otherUnit:t,floor:s})})})}),!a.length)return;let r=c(a);r&&(d.has(e)||d.set(e,[]),d.get(e).push({floor:s,...r}),x.has(e)||x.set(e,[]),x.get(e).push(...a))})}),d.forEach(e=>e.sort((e,t)=>s(e.floor,t.floor))),x.forEach((e,t)=>{let a=c(e);a&&o.set(t,a)});let h=null;return a.forEach(e=>{let t=e.diffs.reduce((e,t)=>e+t,0)/e.diffs.length;if(!h||e.count>h.count){h={unitA:e.unitA,unitB:e.unitB,count:e.count,avgDiff:t};return}e.count===h.count&&Math.abs(t)>Math.abs(h.avgDiff)&&(h={unitA:e.unitA,unitB:e.unitB,count:e.count,avgDiff:t})}),{topPair:h,maxPairOverall:r,unitOverallStats:o,unitFloorStats:d,unitsInMaxPair:i}},[v,N,p]);(0,r.useMemo)(()=>{if(!C?.configurations||!Array.isArray(C.configurations))return null;let e=new Map;return C.configurations.forEach(t=>{if(!t||!Array.isArray(t.positions)||!t.floorRange)return;let a=(0,c.Qy)(t.positions,t.envTiles||[],t.compassDirection||0,1);if(!a||!Array.isArray(a))return;let i=new Map(a.filter(e=>!!e).map(e=>[e.unitType,e])),r=Math.min(Number(t.floorRange.start)||0,Number(t.floorRange.end)||0),s=Math.max(Number(t.floorRange.start)||0,Number(t.floorRange.end)||0);for(let t=r;t<=s;t++)e.set(t,i)}),e},[C]);let V={school:"學校",plaza:"廣場",park:"公園",river:"河景",tower:"高壓塔",grave:"墓地",bridge:"高架橋",mountain:"山景",adjacent:"臨房"},H={N:"北",S:"南",E:"東",W:"西",NE:"東北",NW:"西北",SE:"東南",SW:"西南"},U=e=>{let t=[];if(e.roadFacing){let a=e.roadFacingDirections&&e.roadFacingDirections.length>0?e.roadFacingDirections:e.roadFacingDirection?[e.roadFacingDirection]:[];a.length?a.forEach(e=>{let a=H[e]||e;t.push({text:`${a}臨路`,tone:"road"})}):t.push({text:"臨路",tone:"road"})}if(e.facingOpenSpace&&e.openSpaceType){let a=new Set(["tower","grave","bridge"]);(e.openSpaceFacingDirections&&e.openSpaceFacingDirections.length>0?e.openSpaceFacingDirections.map(e=>({dir:e.direction,type:e.type})):[{dir:e.openSpaceFacingDirection||"",type:e.openSpaceType}]).forEach(e=>{if(!e.type)return;let i=V[e.type]||e.type,r=e.dir?H[e.dir]||e.dir:"",s=r?`${r}`:"";if("adjacent"===e.type)return void t.push({text:`${s}${i}`,tone:"adjacent"});let n=a.has(e.type);t.push({text:`${s}面${i}`,tone:n?"bad":"good"})})}return e.adjacentToUnits&&!t.some(e=>e.text.includes("臨房"))&&t.push({text:"臨房",tone:"adjacent"}),t},Y=(0,r.useMemo)(()=>{if(!C?.configurations||!Array.isArray(C.configurations))return null;let e=new Map;return C.configurations.forEach(t=>{if(!t||!Array.isArray(t.positions))return;let a=(0,c.Qy)(t.positions,t.envTiles||[],t.compassDirection||0,1);a?.forEach(t=>{if(!t)return;let a=U(t);e.has(t.unitType)||e.set(t.unitType,{labelMap:new Map,details:[]});let i=e.get(t.unitType);a.forEach(e=>{i.labelMap.set(e.text,e.tone)})})}),e},[C,U]),[Z,Q]=(0,r.useState)(null),[X,J]=(0,r.useState)(null),G=(()=>{let e=k?.calculationFlags;if(!e)return"排除店舖/辦公室";let t=[];return e.includesStorefrontPremium||t.push("店舖"),e.includesOfficePremium||t.push("辦公室"),e.includesEmployeePremium||t.push("員工關係戶"),t.length?`排除${t.join("/")}`:"全部納入"})(),K=(0,r.useMemo)(()=>{let e={};return v&&N&&N.forEach(t=>{let a=1/0,i=0;if(w?.forEach(e=>{(v?.[e]?.[t]||[]).forEach(e=>{if(!e||e?.isStorefront||e?.isOffice)return;let t=Number(e?.tooltipInfo?.houseArea||e?.houseArea||0);Number.isFinite(t)&&!(t<=0)&&(t<a&&(a=t),t>i&&(i=t))})}),!Number.isFinite(a)||i<=0){e[t]={hasVariance:!1,label:""};return}let r=i-a>3,s=`${a.toFixed(2).replace(/\.00$/,"")}–${i.toFixed(2).replace(/\.00$/,"")} 坪`;e[t]={hasVariance:r,label:r?s:""}}),e},[v,w,N]),ee=()=>{S(null)};return v&&w&&N?(0,i.jsxs)("div",{className:"space-y-8 overflow-x-auto relative",children:[M&&(0,i.jsx)(u,{triggerRect:M.rect,isTopRow:M.isTopRow,children:(y=M.data,j=h.filter(e=>e.predicate(y)).map(e=>e.label),(0,i.jsx)("div",{className:"w-48 bg-zinc-900 border border-zinc-700 rounded-lg p-3 shadow-xl animate-in fade-in zoom-in-95 duration-200",children:(0,i.jsxs)("div",{className:"space-y-1",children:[j.length>0&&(0,i.jsxs)("div",{className:"text-amber-300 text-xs",children:["特殊交易: ",j.join("、")]}),M.data?.hasParking&&(0,i.jsxs)("div",{className:"flex items-center gap-1 text-xs text-blue-300",children:[(0,i.jsx)("span",{className:"flex items-center justify-center w-3 h-3 bg-blue-500 text-white text-[8px] font-bold rounded-sm",children:"P"}),(0,i.jsx)("span",{children:"含車位"})]}),M.data?.premium===0&&(0,i.jsx)("div",{className:"text-cyan-400 font-bold mb-1",children:"★ 基準戶"}),M.data?.premium!==void 0&&M.data?.premium!==null&&(0,i.jsxs)("div",{className:"text-zinc-300",children:["調價: ",(0,i.jsxs)("span",{className:(0,n.cn)(M.data.premium>0?"text-red-400":M.data.premium<0?"text-violet-400":"text-zinc-400"),children:[M.data.premium>0?"+":"",M.data.premium.toFixed(2),"%"]})]}),(0,i.jsx)("div",{className:"h-px bg-zinc-700 my-2"}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-x-2 gap-y-1 text-xs text-zinc-400",children:[(0,i.jsx)("span",{children:"成交總價:"})," ",(0,i.jsxs)("span",{className:"text-white text-right",children:[x(M.data?.tooltipInfo?.totalPrice??M.data?.totalPrice),"萬"]}),(0,i.jsx)("span",{children:"房屋總價:"})," ",(0,i.jsxs)("span",{className:"text-white text-right",children:[x(M.data?.tooltipInfo?.housePrice??M.data?.housePrice),"萬"]}),(0,i.jsx)("span",{children:"車位總價:"})," ",(0,i.jsxs)("span",{className:"text-white text-right",children:[x(M.data?.tooltipInfo?.parkingPrice??M.data?.parkingPrice),"萬"]}),(0,i.jsx)("span",{children:"房屋面積:"})," ",(0,i.jsxs)("span",{className:"text-white text-right",children:[x(M.data?.tooltipInfo?.houseArea??M.data?.houseArea,2),"坪"]})]})]})}))}),Z&&(0,i.jsx)(u,{triggerRect:Z.rect,isTopRow:!0,children:(0,i.jsxs)("div",{className:"w-56 bg-zinc-900 border border-zinc-700 rounded-lg p-2 shadow-xl text-xs text-zinc-300",children:["住宅面積變化: ",(0,i.jsx)("span",{className:"text-amber-300",children:Z.label}),(0,i.jsx)("div",{className:"text-[10px] text-zinc-500 mt-1",children:"已排除店舖/商辦"})]})}),a&&(0,i.jsxs)("div",{className:"min-w-max pb-32",children:[(0,i.jsxs)("div",{className:"flex items-center justify-end gap-2 mb-2",children:[(0,i.jsx)("span",{className:"text-xs text-zinc-500",children:"特殊交易"}),h.map(e=>{let t=X===e.key;return(0,i.jsxs)("button",{onClick:()=>J(t=>t===e.key?null:e.key),className:(0,n.cn)("flex items-center gap-1 px-2 py-1 rounded border text-[10px] transition",t?"border-cyan-400 text-cyan-300 bg-cyan-500/10":"border-white/10 text-zinc-400 hover:text-zinc-200 hover:border-white/30"),children:[(0,i.jsx)("span",{className:(0,n.cn)("w-4 h-4 rounded border flex items-center justify-center text-[9px] font-bold bg-transparent",e.badgeClass),title:e.label,children:e.shortLabel}),e.label]},e.key)})]}),(0,i.jsxs)("table",{className:"divide-y divide-zinc-800 border-collapse w-full text-sm",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"sticky left-0 bg-dark-card z-20 p-2 text-zinc-400 border-r border-zinc-800",children:"樓層 \\ 戶別"}),N.map(e=>(0,i.jsx)("th",{className:(0,n.cn)("p-2 text-zinc-300 font-medium border-l border-zinc-800/50 bg-zinc-900/50 relative",K[e]?.hasVariance&&"bg-amber-500/10"),onMouseEnter:t=>{let a=K[e];a?.hasVariance&&Q({rect:t.currentTarget.getBoundingClientRect(),label:a.label})},onMouseLeave:()=>Q(null),children:(0,i.jsxs)("span",{className:"inline-flex items-center justify-center gap-1",children:[e,K[e]?.hasVariance&&(0,i.jsx)("span",{className:"px-1 py-0.5 text-[9px] rounded border border-amber-400/70 text-amber-300 bg-amber-500/10",children:"Δ坪"})]})},e))]})}),(0,i.jsx)("tbody",{className:"divide-y divide-zinc-800/50",children:w.map((e,t)=>(0,i.jsxs)("tr",{className:"hover:bg-zinc-800/30 transition-colors",children:[(0,i.jsx)("td",{className:"sticky left-0 bg-dark-card z-10 p-2 font-bold text-zinc-300 border-r border-zinc-800 text-center",children:e}),N.map(a=>{let r=v[e]?.[a];return r&&0!==r.length?(0,i.jsx)("td",{className:"p-1 border-l border-zinc-800/50 align-top",children:(0,i.jsx)("div",{className:"flex flex-col gap-1",children:r.map((e,a)=>{let r=h.filter(t=>t.predicate(e)),s=r.length>0,c=s?"transparent":m(e.premium),o=e.remark?.includes("露台")?{icon:(0,i.jsx)(l.A,{className:"w-3 h-3"}),label:"露台"}:null,d=0===e.premium,x=t<3,u=X?h.find(e=>e.key===X)?.predicate:null,p=!u||u(e);return(0,i.jsxs)("div",{className:(0,n.cn)("p-1.5 rounded text-xs transition-transform hover:scale-105 cursor-default relative group",d&&"ring-1 ring-cyan-500",s&&"bg-transparent border border-zinc-700/60",X&&!p&&"opacity-20",X&&p&&"ring-2 ring-cyan-400"),style:{backgroundColor:c},onMouseEnter:t=>{S({rect:t.currentTarget.getBoundingClientRect(),data:e,isTopRow:x})},onMouseLeave:ee,children:[(0,i.jsxs)("div",{className:"flex flex-col gap-0.5 pr-4",children:[(0,i.jsxs)("span",{className:"font-semibold text-white flex items-center gap-1 leading-tight",children:[o&&(0,i.jsx)("span",{className:"text-zinc-200",title:o.label,children:o.icon}),e.unitPrice.toFixed(1),"萬"]}),(0,i.jsx)("div",{className:"text-[10px] text-zinc-300 font-mono tracking-tight opacity-90",children:e.transactionDate||"-"})]}),(0,i.jsxs)("div",{className:"absolute top-0.5 right-0.5 flex flex-col items-end gap-0.5",children:[r.map(e=>(0,i.jsx)("span",{className:(0,n.cn)("flex items-center justify-center w-3 h-3 text-[8px] font-bold rounded border bg-transparent",e.badgeClass),title:e.label,children:e.shortLabel},e.key)),e.hasParking&&(0,i.jsx)("span",{className:"flex items-center justify-center w-3 h-3 bg-blue-500 text-white text-[8px] font-bold rounded-sm",title:"含車位",children:"P"})]})]},a)})})},`${e}-${a}`):(0,i.jsx)("td",{className:"p-2 border-l border-zinc-800/50 bg-zinc-900/20 text-center text-zinc-600",children:"-"},`${e}-${a}`)})]},e))})]})]}),s&&k&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("h3",{className:"text-lg font-semibold text-zinc-200",children:["調價幅度統計摘要 (",G,")"]}),(0,i.jsx)("div",{className:"overflow-x-auto rounded-lg border border-zinc-800",children:(0,i.jsxs)("table",{className:"w-full text-sm text-left text-zinc-300",children:[(0,i.jsx)("thead",{className:"text-xs text-zinc-400 uppercase bg-zinc-900/50",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"px-6 py-3",children:"基準房屋總價"}),(0,i.jsx)("th",{className:"px-6 py-3",children:"調價幅度總額"}),(0,i.jsx)("th",{className:"px-6 py-3",children:"總溢價率"}),(0,i.jsx)("th",{className:"px-6 py-3",children:"已售房屋坪數"}),(0,i.jsx)("th",{className:"px-6 py-3",children:"平均單價調價"})]})}),(0,i.jsx)("tbody",{children:(0,i.jsxs)("tr",{className:"bg-zinc-900/20 border-b border-zinc-800",children:[(0,i.jsxs)("td",{className:"px-6 py-4",children:[x(k.totalBaselineHousePrice)," 萬"]}),(0,i.jsxs)("td",{className:(0,n.cn)("px-6 py-4 font-bold",k.totalPricePremiumValue>0?"text-red-400":"text-violet-400"),children:[k.totalPricePremiumValue>0?"+":"",x(k.totalPricePremiumValue)," 萬"]}),(0,i.jsxs)("td",{className:"px-6 py-4",children:[(k.totalPricePremiumValue/k.totalBaselineHousePrice*100).toFixed(2)," %"]}),(0,i.jsxs)("td",{className:"px-6 py-4",children:[x(k.totalSoldArea)," 坪"]}),(0,i.jsxs)("td",{className:(0,n.cn)("px-6 py-4",k.totalPricePremiumValue>0?"text-red-400":"text-violet-400"),children:[(k.totalPricePremiumValue/k.totalSoldArea).toFixed(2)," 萬/坪"]})]})})]})})]}),p&&P&&P.length>0&&(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-zinc-200",children:"戶型水平價差與溢價貢獻"}),(0,i.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs text-zinc-400",children:[e.comparisonMeta&&(0,i.jsxs)("span",{children:["原始最低戶型：",e.comparisonMeta.originalMinUnit||"-"," ","number"==typeof e.comparisonMeta.originalMinAvg?`(${e.comparisonMeta.originalMinAvg.toFixed(2)} 萬/坪)`:""," ｜ ","實際最低戶型：",e.comparisonMeta.actualMinUnit||"-"," ","number"==typeof e.comparisonMeta.actualMinAvg?`(${e.comparisonMeta.actualMinAvg.toFixed(2)} 萬/坪)`:""]}),q.topPair&&(0,i.jsxs)("span",{children:["AI 摘要：常見價差組合 ",q.topPair.unitA," ↔ ",q.topPair.unitB,"（",q.topPair.count," 層，平均差 ",q.topPair.avgDiff>0?"+":"",q.topPair.avgDiff.toFixed(2),"）"]}),q.maxPairOverall&&(0,i.jsxs)("span",{children:["最大價差：",q.maxPairOverall.floor,"F ",q.maxPairOverall.unitHigh," ↔ ",q.maxPairOverall.unitLow,"（",q.maxPairOverall.diff>0?"+":"",q.maxPairOverall.diff.toFixed(2),"）"]}),g&&(0,i.jsxs)("div",{className:"flex items-center gap-2 text-zinc-500",children:[(0,i.jsxs)("span",{children:["樓層配置：",C?.configurations?.length?`已同步 ${C.configurations.length} 組`:"未設定"]}),b&&b.length>0&&(0,i.jsx)("button",{onClick:()=>$(e=>!e),className:"px-2 py-1 rounded border border-white/10 text-[11px] text-zinc-400 hover:text-zinc-200 hover:border-white/30 transition",children:_?"收合配置":"設定配置"})]})]}),_&&b&&b.length>0&&g&&(0,i.jsx)("div",{className:"mt-3",children:(0,i.jsx)(d.sB,{transactions:b,project:g,configOnly:!0,title:"樓層配置（戶型水平價差）",storageScope:W,initialStep:"config",onConfigChange:B,mode:"report"})}),(0,i.jsx)("div",{className:"overflow-x-auto rounded-lg border border-zinc-800",children:(0,i.jsxs)("table",{className:"w-full text-sm text-left text-zinc-300",children:[(0,i.jsx)("thead",{className:"text-xs text-zinc-400 uppercase bg-zinc-900/50",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"px-4 py-3",children:"戶型"}),(0,i.jsx)("th",{className:"px-4 py-3",children:"環境標籤"}),(0,i.jsx)("th",{className:"px-4 py-3",children:"基準戶 (樓/價)"}),(0,i.jsx)("th",{className:"px-4 py-3",children:"原始平均單價"}),(0,i.jsx)("th",{className:"px-4 py-3",children:"實際平均單價"}),(0,i.jsx)("th",{className:"px-4 py-3",children:"去化戶數"}),(0,i.jsx)("th",{className:"px-4 py-3",children:"去化坪數"}),(0,i.jsx)("th",{className:"px-4 py-3",children:"溢價(萬/坪)"}),(0,i.jsx)("th",{className:"px-4 py-3",children:"溢價貢獻"}),(0,i.jsx)("th",{className:"px-4 py-3",children:"貢獻佔比"}),(0,i.jsx)("th",{className:"px-4 py-3",children:"細節"})]})}),(0,i.jsx)("tbody",{children:P.map((e,t)=>{let a,s,l,c=t=>{t&&t!==e.unitType?O(e=>e===t?null:t):O(null)},o=R&&R!==e.unitType?[e.unitType,R]:[e.unitType];return(0,i.jsxs)(r.Fragment,{children:[(0,i.jsxs)("tr",{className:"bg-zinc-900/20 border-b border-zinc-800 hover:bg-zinc-800/20",children:[(0,i.jsx)("td",{className:"px-4 py-3 font-medium text-white",children:e.unitType}),(0,i.jsx)("td",{className:"px-4 py-3",children:(s=(a=Y?.get(e.unitType))?Array.from(a.labelMap.entries()):[]).length?(0,i.jsx)("div",{className:"flex flex-wrap gap-1",title:a?.details.join(" | "),children:s.map(([t,a])=>(0,i.jsx)("span",{className:`px-2 py-0.5 rounded text-[10px] border ${(e=>{switch(e){case"road":return"border-amber-400/40 text-amber-300 bg-amber-500/10";case"good":return"border-emerald-400/40 text-emerald-300 bg-emerald-500/10";case"bad":return"border-rose-400/40 text-rose-300 bg-rose-500/10";case"adjacent":return"border-zinc-500/40 text-zinc-300 bg-zinc-500/10";default:return"border-white/10 text-zinc-300 bg-white/5"}})(a)}`,children:t},`${e.unitType}-${t}`))}):(0,i.jsx)("span",{className:"text-zinc-500",children:"-"})}),(0,i.jsx)("td",{className:"px-4 py-3",children:e.anchorInfo}),(0,i.jsx)("td",{className:"px-4 py-3",children:"number"==typeof e.originalAvgPrice?`${e.originalAvgPrice.toFixed(2)} 萬/坪`:"-"}),(0,i.jsx)("td",{className:"px-4 py-3",children:"number"==typeof e.actualAvgPrice?`${e.actualAvgPrice.toFixed(2)} 萬/坪`:"-"}),(0,i.jsxs)("td",{className:"px-4 py-3",children:[e.unitsSold," 戶"]}),(0,i.jsx)("td",{className:"px-4 py-3",children:"number"==typeof e.totalSoldArea?`${e.totalSoldArea.toFixed(2)} 坪`:"-"}),(0,i.jsx)("td",{className:(0,n.cn)("px-4 py-3",e.avgPremiumPerPing>0?"text-red-400":"text-violet-400"),children:"number"==typeof e.avgPremiumPerPing?`${e.avgPremiumPerPing>0?"+":""}${e.avgPremiumPerPing.toFixed(2)} 萬/坪`:"-"}),(0,i.jsxs)("td",{className:(0,n.cn)("px-4 py-3 font-bold",e.timePremiumContribution>0?"text-red-400":"text-violet-400"),children:[e.timePremiumContribution>0?"+":"",x(e.timePremiumContribution)," 萬"]}),(0,i.jsxs)("td",{className:"px-4 py-3",children:["number"==typeof e.contributionPercentage?e.contributionPercentage.toFixed(2):"0.00","%"]}),(0,i.jsx)("td",{className:"px-4 py-3",children:(0,i.jsx)("button",{onClick:()=>A(t=>t===e.unitType?null:e.unitType),className:"text-[11px] text-cyan-300 border border-cyan-400/30 rounded px-2 py-1 hover:bg-cyan-500/10 transition",children:I===e.unitType?"收合":"展開"})})]}),I===e.unitType&&(0,i.jsx)("tr",{className:"bg-zinc-950/40 border-b border-zinc-800",children:(0,i.jsx)("td",{colSpan:11,className:"px-4 py-3",children:(0,i.jsxs)("div",{className:"flex flex-col xl:flex-row gap-6",children:[(0,i.jsx)("div",{className:"xl:w-[400px] shrink-0",children:(0,i.jsxs)("div",{className:"bg-zinc-900/40 rounded border border-white/10 p-2 h-full flex flex-col",children:[(0,i.jsxs)("h4",{className:"text-xs font-bold text-zinc-400 mb-2 flex items-center gap-2",children:[(0,i.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-cyan-400"}),"樓層配置視圖"]}),(0,i.jsx)("div",{className:"flex-1 min-h-[300px] relative rounded overflow-hidden bg-zinc-950/50 border border-white/5",children:(()=>{let e=C?.configurations?.[0];if(!e)return(0,i.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-zinc-500 text-xs",children:"無配置資料"});let t=(e.positions||[]).map(e=>(0,d.jk)(e,1)),a=e.envTiles||[];return(0,i.jsx)(d.Cn,{positions:t,envTiles:a,selectedUnits:o,zoom:.6,gridSize:e.gridSize||30,compassDirection:e.compassDirection||0,onPositionsChange:()=>{},onUnitClick:e=>c(e),onZoomChange:()=>{},isAnalyzeMode:!0,showBadges:!1,unitShape:"square"})})()}),(0,i.jsx)("div",{className:"mt-2 text-[10px] text-zinc-500 text-center",children:"* 此為唯讀視圖，顯示目前選擇戶型位置"})]})}),(0,i.jsxs)("div",{className:"flex-1 rounded border border-white/10 bg-zinc-900/40 p-3 overflow-hidden",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,i.jsxs)("div",{className:"text-xs text-zinc-400",children:["戶型比價矩陣（單位：","percent"===L?"%":"萬/坪","，",(0,i.jsx)("span",{className:"text-red-400",children:"紅>5%"}),"，",(0,i.jsx)("span",{className:"text-orange-400",children:"橘2~5%"}),"，",(0,i.jsx)("span",{className:"text-yellow-400",children:"黃0~2%"}),"，",(0,i.jsx)("span",{className:"text-emerald-400",children:"綠<0%"}),"）"]}),(0,i.jsxs)("div",{className:"flex bg-zinc-950 p-0.5 rounded-md border border-zinc-800",children:[(0,i.jsx)("button",{onClick:e=>{e.stopPropagation(),D("value")},className:(0,n.cn)("px-2 py-1 text-[10px] rounded transition-all","value"===L?"bg-zinc-800 text-white shadow-sm":"text-zinc-500 hover:text-zinc-300"),children:"價差數值 $"}),(0,i.jsx)("button",{onClick:e=>{e.stopPropagation(),D("percent")},className:(0,n.cn)("px-2 py-1 text-[10px] rounded transition-all","percent"===L?"bg-zinc-800 text-white shadow-sm":"text-zinc-500 hover:text-zinc-300"),children:"價差比例 %"})]})]}),(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full text-xs border-collapse",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"p-2 text-zinc-500 font-normal text-left whitespace-nowrap sticky left-0 bg-zinc-900/90 z-10 border-b border-zinc-800",children:"樓層"}),N.filter(t=>t!==e.unitType).map(e=>{let t=Y?.get(e),a=t?Array.from(t.labelMap.keys()):[],r=R===e;return(0,i.jsx)("th",{onClick:()=>c(e),className:(0,n.cn)("p-2 text-zinc-400 font-medium text-center whitespace-nowrap min-w-[60px] border-b border-zinc-800 align-top cursor-pointer transition-colors",r&&"bg-cyan-500/10 text-cyan-200 ring-1 ring-cyan-400/40"),title:"點擊高亮此戶型欄位",children:(0,i.jsxs)("div",{className:"flex flex-col gap-0.5 items-center",children:[(0,i.jsxs)("span",{children:["vs ",e]}),a.map((e,t)=>(0,i.jsx)("span",{className:"text-[10px] bg-zinc-800 text-zinc-400 px-1 rounded transform scale-90 origin-top",children:e},t))]})},e)})]})}),(0,i.jsx)("tbody",{className:"divide-y divide-zinc-800/30",children:(l=N.filter(t=>t!==e.unitType),w.map(t=>{let a=v?.[t]?.[e.unitType],r=a?.[0];if(!r||!r.unitPrice)return null;let s=r.unitPrice;return(0,i.jsxs)("tr",{className:"hover:bg-zinc-800/20",children:[(0,i.jsxs)("td",{className:"p-2 text-zinc-500 font-mono sticky left-0 bg-zinc-900/90 border-r border-zinc-800/50",children:[t,"F"]}),l.map(e=>{let a=v?.[t]?.[e],r=a?.[0],l=r?.unitPrice,c=R===e;if(!l)return(0,i.jsx)("td",{className:(0,n.cn)("p-2 text-center text-zinc-700 transition-colors",c&&"bg-cyan-500/10 ring-1 ring-cyan-400/30"),children:"-"},e);let o=s-l,d=o/l*100,x=m(d),h="text-zinc-200";h=d>5?"text-white font-bold shadow-sm":d<0?"text-emerald-100":d>2?"text-orange-100":"text-yellow-100",.1>Math.abs(d)&&(h="text-zinc-400");let u="percent"===L?`${d.toFixed(1)}%`:o.toFixed(1),p=o>0?"+":"";return(0,i.jsx)("td",{className:(0,n.cn)("p-1 text-center transition-colors",c&&"bg-cyan-500/10"),children:(0,i.jsxs)("div",{className:(0,n.cn)("py-1 px-1.5 rounded text-[11px] font-mono transition-colors",h,c&&"ring-2 ring-cyan-400/70 ring-offset-1 ring-offset-zinc-900/40"),style:{backgroundColor:x},title:`${e}: ${l}萬/坪`,children:[p,u]})},e)})]},t)}))})]})})]})]})})})]},t)})})]})})]})]}):(0,i.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無有效熱力圖資料"})}},96066:(e,t,a)=>{a.d(t,{Q:()=>l});var i=a(1934),r=a(31692);let s={"cover-template":{width:900,height:500},"ranking-chart":{width:400,height:300},"ranking-table":{width:600,height:400},"ranking-metrics":{width:600,height:200},"price-band-chart":{width:450,height:280},"price-band-table":{width:600,height:400},"price-band-location-table":{width:600,height:400},"price-band-location-chart":{width:600,height:400},"unit-price-bubble":{width:380,height:320},"unit-price-stats":{width:1e3,height:400},"type-comparison-table":{width:600,height:350},"sales-velocity-chart":{width:420,height:260},"sales-velocity-table":{width:600,height:400},"sales-heatmap":{width:450,height:350},"sales-heatmap-detail":{width:800,height:400},"parking-pie":{width:300,height:300},"parking-price":{width:400,height:300},"parking-scatter":{width:450,height:350},"parking-floor":{width:400,height:400},"parking-floor-detail":{width:900,height:420},"policy-timeline":{width:900,height:500},heatmap:{width:500,height:350},"heatmap-grid":{width:800,height:500},"heatmap-stats":{width:800,height:120},"heatmap-comparison":{width:800,height:300},"data-list":{width:600,height:400},"text-box":{width:360,height:120}},n=e=>({id:`page-${Date.now()}`,name:`第 ${e+1} 頁`,items:[]}),l=(0,i.v)()((0,r.Zr)((e,t)=>({pages:[n(0)],currentPageIndex:0,canvasRatio:"16:9",zoomLevel:100,viewMode:"continuous",selectedIds:[],isDragging:!1,draggedItemCount:0,hoveredPageIndex:null,setViewMode:t=>e({viewMode:t}),setDragging:(t,a=0)=>e({isDragging:t,draggedItemCount:a}),setHoveredPageIndex:t=>e({hoveredPageIndex:t}),get items(){let e=t();return e.pages[e.currentPageIndex]?.items||[]},addPage:()=>{e(e=>{let t=n(e.pages.length);return{pages:[...e.pages,t],currentPageIndex:e.pages.length,selectedIds:[]}})},deletePage:t=>{e(e=>{if(e.pages.length<=1||-1===e.pages.findIndex(e=>e.id===t))return e;let a=e.pages.filter(e=>e.id!==t).map((e,t)=>({...e,name:`第 ${t+1} 頁`})),i=Math.min(e.currentPageIndex,a.length-1);return{pages:a,currentPageIndex:i,selectedIds:[]}})},setCurrentPage:t=>{e(e=>({currentPageIndex:Math.max(0,Math.min(t,e.pages.length-1)),selectedIds:[]}))},renamePage:(t,a)=>{e(e=>({pages:e.pages.map(e=>e.id===t?{...e,name:a}:e)}))},reorderPages:(t,a)=>{e(e=>{if(t===a)return e;let i=[...e.pages],[r]=i.splice(t,1);i.splice(a,0,r);let s=i.map((e,t)=>({...e,name:`第 ${t+1} 頁`})),n=e.currentPageIndex;return e.currentPageIndex===t?n=a:t<e.currentPageIndex&&a>=e.currentPageIndex?n=e.currentPageIndex-1:t>e.currentPageIndex&&a<=e.currentPageIndex&&(n=e.currentPageIndex+1),{pages:s,currentPageIndex:n}})},addItem:(t,a)=>{let i=s[t]||{width:400,height:300};e(e=>{let r=e.pages[e.currentPageIndex];if(!r)return e;let s=20*r.items.length,n="cover-template"===t,l={id:`item-${Date.now()}`,type:t,x:n?0:50+s,y:n?0:50+s,width:i.width,height:i.height,scaleMode:"select",panOffset:{x:0,y:0},contentScale:1,data:a??(e=>{if("cover-template"===e){let e=new Date,t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return{logoText:"平米內參",title:"市場分析報告",subtitle:"價格帶與銷售動能評估",projectName:"請填寫建案名稱",period:"2026 Q1",preparedBy:"平米內參",reportDate:`${t}-${a}-${i}`,searchConditions:[]}}if("text-box"===e)return{text:"請輸入文字或數字",align:"left",size:16,weight:500,color:"#e4e4e7"}})(t)};return{pages:e.pages.map((t,a)=>a===e.currentPageIndex?{...t,items:[...t.items,l]}:t),selectedIds:[l.id]}})},updateItem:(t,a)=>{e(e=>({pages:e.pages.map((i,r)=>r===e.currentPageIndex?{...i,items:i.items.map(e=>e.id===t?{...e,...a}:e)}:i)}))},removeItem:t=>{e(e=>({pages:e.pages.map((a,i)=>i===e.currentPageIndex?{...a,items:a.items.filter(e=>e.id!==t)}:a),selectedIds:e.selectedIds.filter(e=>e!==t)}))},moveItemToPage:(t,a)=>{e(e=>{let i=e.pages[e.currentPageIndex],r=i?.items.find(e=>e.id===t);return!r||a===e.currentPageIndex||a<0||a>=e.pages.length?e:{pages:e.pages.map((i,s)=>s===e.currentPageIndex?{...i,items:i.items.filter(e=>e.id!==t)}:s===a?{...i,items:[...i.items,{...r,x:50,y:50}]}:i),selectedIds:[]}})},clearCanvas:()=>{e(e=>({pages:e.pages.map((t,a)=>a===e.currentPageIndex?{...t,items:[]}:t),selectedIds:[]}))},batchUpdateItems:t=>{e(e=>({pages:e.pages.map((a,i)=>i===e.currentPageIndex?{...a,items:a.items.map(e=>t[e.id]?{...e,...t[e.id]}:e)}:a)}))},setCanvasRatio:t=>e({canvasRatio:t}),setZoomLevel:t=>e({zoomLevel:Math.max(25,Math.min(400,t))}),resetZoom:()=>e({zoomLevel:100}),setSelectedIds:t=>e({selectedIds:t}),toggleSelection:t=>{e(e=>({selectedIds:e.selectedIds.includes(t)?e.selectedIds.filter(e=>e!==t):[...e.selectedIds,t]}))},addToSelection:t=>{e(e=>({selectedIds:e.selectedIds.includes(t)?e.selectedIds:[...e.selectedIds,t]}))},clearSelection:()=>e({selectedIds:[]}),removeSelectedItems:()=>{e(e=>e.pages[e.currentPageIndex]?{pages:e.pages.map((t,a)=>a===e.currentPageIndex?{...t,items:t.items.filter(t=>!e.selectedIds.includes(t.id))}:t),selectedIds:[]}:e)},moveSelectedItemsToPage:t=>{e(e=>{if(t===e.currentPageIndex||t<0||t>=e.pages.length)return e;let a=e.pages[e.currentPageIndex].items.filter(t=>e.selectedIds.includes(t.id));return 0===a.length?e:{pages:e.pages.map((i,r)=>r===e.currentPageIndex?{...i,items:i.items.filter(t=>!e.selectedIds.includes(t.id))}:r===t?{...i,items:[...i.items,...a.map((e,t)=>({...e,x:50+20*t,y:50+20*t}))]}:i),selectedIds:[]}})}}),{name:"report-builder-storage"}))},97085:(e,t,a)=>{a.d(t,{A:()=>l});var i=a(95155);a(12115);var r=a(37206),s=a(81477);let n=(0,r.default)(()=>Promise.all([a.e(7776),a.e(4822)]).then(a.bind(a,44822)),{loadableGenerated:{webpack:()=>[null]},ssr:!1});function l({type:e,series:t,options:a,height:r=350,title:l,description:c,className:o,loading:d}){let x={chart:{background:"transparent",toolbar:{show:!1}},theme:{mode:"dark",palette:"palette1"},dataLabels:{enabled:!1},grid:{borderColor:"#374151",strokeDashArray:4},xaxis:{labels:{style:{colors:"#9ca3af"}},axisBorder:{color:"#4b5563"},axisTicks:{color:"#4b5563"}},yaxis:{labels:{style:{colors:"#9ca3af"}}},tooltip:{theme:"dark",style:{fontSize:"12px"},x:{show:!0}}},h={...x,...a,chart:{...x.chart,...a.chart}};return(0,i.jsxs)(s.Zp,{className:`p-4 ${o}`,children:[(l||c)&&(0,i.jsxs)("div",{className:"mb-4",children:[l&&(0,i.jsx)("h3",{className:"text-lg font-bold text-white mb-1",children:l}),c&&(0,i.jsx)("p",{className:"text-sm text-gray-400",children:c})]}),d?(0,i.jsx)("div",{className:"flex items-center justify-center",style:{height:r},children:(0,i.jsx)("div",{className:"loader"})}):(0,i.jsx)(n,{options:h,series:t,type:e,height:r,width:"100%"})]})}},98563:(e,t,a)=>{a.d(t,{E:()=>s});var i=a(95155);a(12115);var r=a(40980);function s({title:e,stats:t,noDataMessage:a="無資料",className:s,averageType:n="weighted"}){if(!t||0===t.count)return(0,i.jsxs)("div",{className:(0,r.cn)("p-6 border border-white/5 rounded-lg bg-zinc-900/30",s),children:[(0,i.jsx)("h3",{className:"text-zinc-400 font-medium mb-4",children:e}),(0,i.jsx)("p",{className:"text-zinc-500 text-center py-4",children:a})]});let l="weighted"===n&&t.weightedAvgPrice?t.weightedAvgPrice:t.avgPrice;return(0,i.jsxs)("div",{className:(0,r.cn)("p-6 border border-white/5 rounded-lg bg-zinc-900/30",s),children:[(0,i.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-white",children:e}),(0,i.jsxs)("span",{className:"text-xs text-zinc-500 bg-zinc-800 px-2 py-1 rounded",children:["樣本數: ",t.count]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,i.jsx)("div",{className:"space-y-1",children:(0,i.jsx)("table",{className:"w-full text-sm",children:(0,i.jsxs)("tbody",{className:"divide-y divide-white/5",children:[(0,i.jsxs)("tr",{className:"group",children:[(0,i.jsx)("td",{className:"py-2 text-zinc-400",children:"weighted"===n?"加權平均單價":"算術平均單價"}),(0,i.jsxs)("td",{className:"py-2 text-right font-mono text-white group-hover:text-cyan-400 transition-colors",children:[(0,r.Z)(l)," 萬/坪"]})]}),(0,i.jsxs)("tr",{className:"group",children:[(0,i.jsx)("td",{className:"py-2 text-zinc-400",children:"最低單價"}),(0,i.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors",children:(0,r.Z)(t.minPrice)})]}),(0,i.jsxs)("tr",{className:"group",children:[(0,i.jsx)("td",{className:"py-2 text-zinc-400",children:"1/4分位數"}),(0,i.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors",children:(0,r.Z)(t.q1Price)})]}),(0,i.jsxs)("tr",{className:"group",children:[(0,i.jsx)("td",{className:"py-2 text-violet-400 font-medium",children:"中位數單價"}),(0,i.jsx)("td",{className:"py-2 text-right font-mono text-violet-400 font-bold",children:(0,r.Z)(t.medianPrice)})]}),(0,i.jsxs)("tr",{className:"group",children:[(0,i.jsx)("td",{className:"py-2 text-zinc-400",children:"3/4分位數"}),(0,i.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors",children:(0,r.Z)(t.q3Price)})]}),(0,i.jsxs)("tr",{className:"group",children:[(0,i.jsx)("td",{className:"py-2 text-zinc-400",children:"最高單價"}),(0,i.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors",children:(0,r.Z)(t.maxPrice)})]})]})})}),(0,i.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,i.jsxs)("div",{className:"p-3 bg-zinc-950/50 rounded border border-white/5",children:[(0,i.jsx)("div",{className:"text-cyan-500 font-medium mb-1 text-xs uppercase tracking-wider",children:"最高價建案"}),(0,i.jsx)("div",{className:"text-white font-bold text-lg mb-1",children:t.maxPriceProject||"N/A"}),(0,i.jsxs)("div",{className:"flex gap-4 text-zinc-400 text-xs",children:[(0,i.jsxs)("span",{children:["戶型: ",t.maxPriceUnit||"-"]}),(0,i.jsxs)("span",{children:["樓層: ",t.maxPriceFloor||"-"]})]})]}),(0,i.jsxs)("div",{className:"p-3 bg-zinc-950/50 rounded border border-white/5",children:[(0,i.jsx)("div",{className:"text-green-500 font-medium mb-1 text-xs uppercase tracking-wider",children:"最低價建案"}),(0,i.jsx)("div",{className:"text-white font-bold text-lg mb-1",children:t.minPriceProject||"N/A"}),(0,i.jsxs)("div",{className:"flex gap-4 text-zinc-400 text-xs",children:[(0,i.jsxs)("span",{children:["戶型: ",t.minPriceUnit||"-"]}),(0,i.jsxs)("span",{children:["樓層: ",t.minPriceFloor||"-"]})]})]})]})]})]})}},98883:(e,t,a)=>{a.d(t,{P:()=>i});let i=e=>{let t=new Date,a=new Date;switch(e){case"1q":a.setMonth(t.getMonth()-3);break;case"2q":a.setMonth(t.getMonth()-6);break;case"3q":a.setMonth(t.getMonth()-9);break;case"1y":a.setFullYear(t.getFullYear()-1);break;case"this_year":a=new Date(t.getFullYear(),0,1);break;case"last_2_years":a=new Date(t.getFullYear()-1,0,1);break;case"last_3_years":a=new Date(t.getFullYear()-2,0,1);break;default:return{startDate:"",endDate:""}}return{startDate:a.toISOString().split("T")[0],endDate:t.toISOString().split("T")[0]}}}}]);