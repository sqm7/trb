"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7714],{29991:(e,t,s)=>{s.d(t,{l:()=>l});var i=s(95155),a=s(12115),n=s(40980),r=s(66088);let l=a.forwardRef(({className:e,children:t,...s},a)=>(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)("select",{className:(0,n.cn)("flex h-10 w-full appearance-none rounded-md border border-input bg-zinc-950/50 px-3 py-2 text-sm text-zinc-100 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 pr-8",e),ref:a,...s,children:t}),(0,i.jsx)(r.A,{className:"absolute right-3 top-2.5 h-4 w-4 opacity-50 pointer-events-none"})]}));l.displayName="Select"},31840:(e,t,s)=>{s.d(t,{p:()=>y});var i=s(95155),a=s(12115),n=s(68605),r=s(65770),l=s(9921),c=s(66088),o=s(6296),d=s(61878),x=s(33210),m=s(18837),h=s(41641),p=s(21362),u=s(40980),b=s(88743),f=s(27529),j=s(55873),g=s(98883),v=s(51806),N=s(78795);function y({data:e,trigger:t}){let{counties:s,districts:y,transactionType:w,buildingType:z,projectNames:k,dateRange:S,startDate:P,endDate:A}=(0,b.P)(),[C,_]=(0,a.useState)([]),[M,$]=(0,a.useState)(!1),[T,F]=(0,a.useState)(null),[L,E]=(0,a.useState)(1),[D,R]=(0,a.useState)(new Set),[O,q]=(0,a.useState)({key:"",direction:null}),[K,I]=(0,a.useState)(""),[Z,W]=(0,a.useState)("建案名稱"),[B,U]=(0,a.useState)(!1),[H,Q]=(0,a.useState)([]),[J,G]=(0,a.useState)(!1),[V,X]=(0,a.useState)(""),Y=(0,a.useRef)({counties:s,districts:y,transactionType:w,buildingType:z,projectNames:k,dateRange:S,startDate:P,endDate:A});(0,a.useEffect)(()=>{Y.current={counties:s,districts:y,transactionType:w,buildingType:z,projectNames:k,dateRange:S,startDate:P,endDate:A}});let ee=(0,a.useCallback)(async()=>{let{counties:e,districts:t,transactionType:s,buildingType:i,projectNames:a,dateRange:n,startDate:r,endDate:l}=Y.current;$(!0),F(null),_([]);try{if(0===e.length)return void $(!1);let c=r,o=l;if("custom"!==n){let e=(0,g.P)(n);e.startDate&&(c=e.startDate),e.endDate&&(o=e.endDate)}let d=e.map(async e=>{let n=j.WG[e],r=j.Ib[e]||[],l=t?t.filter(e=>r.includes(e)):[],d={countyCode:n,districts:l.length>0?l:void 0,type:s,dateStart:c,dateEnd:o,projectNames:a,buildingType:i};try{return await f.FH.fetchData(d,{page:1,limit:1e3})}catch(t){return console.warn(`Fetch failed for ${e}`,t),{data:[],count:0}}}),x=await Promise.all(d),m=[];x.forEach(e=>{e&&Array.isArray(e.data)&&(m=[...m,...e.data])}),m.sort((e,t)=>{let s=e["交易日"]||"";return(t["交易日"]||"").localeCompare(s)}),_(m)}catch(e){console.error("Data List fetch failed:",e),F(e.message||"讀取交易資料失敗")}finally{$(!1)}},[]),et=JSON.stringify({counties:s,districts:y,transactionType:w,buildingType:z,projectNames:k,dateRange:S,startDate:P,endDate:A});(0,a.useEffect)(()=>{ee()},[et]),(0,a.useEffect)(()=>{t&&ee()},[ee,t]);let es=async e=>{if(!e.編號||!e.縣市代碼)return;let t=e["交易類型"]||w;X(`車位/附表明細 - ${e["建案名稱"]||e["編號"]}`),G(!0),U(!0),Q([]);try{let s=await f.FH.fetchSubData(e.編號,t,e.縣市代碼),i=[];if(s.park&&Array.isArray(s.park)&&s.park.length>0&&(i=[...i,...s.park.map(e=>({...e,_category:"車位資料"}))]),s.build&&Array.isArray(s.build)&&s.build.length>0&&(i=[...i,...s.build.map(e=>({...e,_category:"建物明細"}))]),Array.isArray(s)&&0===i.length?i=[...i,...s]:s.data&&Array.isArray(s.data)&&0===i.length&&(i=[...i,...s.data]),0===i.length){let t=e["車位數"]&&Number(e["車位數"])>0,s=e["車位總價"]||e["車位總價(萬)"];if(t||s){let t=e["車位總價"]?Number(e["車位總價"]):e["車位總價(萬)"]?1e4*Number(e["車位總價(萬)"]):0,s=e["車位總面積"]?Number(e["車位總面積"]):e["車位面積"]?Number(e["車位面積"]):0;i.push({車位類別:e["車位類別"]||"無資料",車位價格:t,車位面積:s,車位樓層:"-","車位價格(萬)":e["車位總價(萬)"]||t/1e4,"車位面積(坪)":e["車位面積(坪)"]||(s/3.30579).toFixed(2),編號:e["編號"],_category:"車位資料(來自交易明細)"})}}Q(i)}catch(t){if(console.error(t),e["車位數"]&&Number(e["車位數"])>0){let t=e["車位總價"]?Number(e["車位總價"]):e["車位總價(萬)"]?1e4*Number(e["車位總價(萬)"]):0;Q([{車位類別:e["車位類別"]||"無資料",車位價格:t,車位面積:e["車位總面積"]||0,編號:e["編號"],_category:"車位資料(來自交易明細)"}])}else Q([])}finally{G(!1)}},ei=[{key:"行政區",label:"行政區",sortable:!0},{key:"建案名稱",label:"建案名稱",sortable:!0},{key:"交易日",label:"交易日",sortable:!0},{key:"交易筆棟數",label:"交易筆棟數",sortable:!1},{key:"主要用途",label:"主要用途",sortable:!1},{key:"建物型態",label:"建物型態",sortable:!1},{key:"戶型",label:"戶型",sortable:!0},{key:"樓層",label:"樓層",sortable:!0},{key:"房屋面積(坪)",label:"坪數",sortable:!0},{key:"房屋單價(萬)",label:"單價",sortable:!0}],ea=["編號","地址","總樓層","交易總價(萬)","房屋總價(萬)","車位總價(萬)","房數","廳數","衛浴數","備註","解約情形","戶別","主要用途","建物型態","車位類別","車位價格","車位面積","主建物面積","附屬建物面積","陽台面積"],en=e=>{R(t=>{let s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},er=e=>null==e||""===e?"-":"number"==typeof e?Number.isInteger(e)?e.toLocaleString():e.toFixed(2):String(e),el=(0,a.useMemo)(()=>{let e=[...C];if(K.trim()){let t=K.toLowerCase();e=e.filter(e=>{let s=e[Z];return null!=s&&String(s).toLowerCase().includes(t)})}return O.key&&O.direction&&e.sort((e,t)=>{let s=e[O.key],i=t[O.key];if(null==s&&null==i)return 0;if(null==s)return 1;if(null==i)return -1;if("number"==typeof s&&"number"==typeof i)return"asc"===O.direction?s-i:i-s;let a=String(s),n=String(i);return"asc"===O.direction?a.localeCompare(n,"zh-TW"):n.localeCompare(a,"zh-TW")}),e},[C,K,Z,O]),ec=Math.ceil(el.length/20),eo=(L-1)*20,ed=eo+20,ex=el.slice(eo,ed);return M?(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center py-20",children:[(0,i.jsx)(o.A,{className:"h-8 w-8 animate-spin text-violet-500 mb-2"}),(0,i.jsx)("p",{className:"text-zinc-500 text-sm",children:"正在載入交易資料相關明細..."})]}):T?(0,i.jsxs)("div",{className:"text-center p-12 text-red-400",children:[(0,i.jsxs)("p",{children:["載入失敗: ",T]}),(0,i.jsx)("button",{onClick:()=>ee(),className:"mt-4 px-4 py-2 bg-zinc-800 rounded hover:bg-zinc-700",children:"重試"})]}):C&&0!==C.length?(0,i.jsxs)("div",{className:"space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,i.jsxs)("div",{className:"flex flex-wrap gap-3 items-center p-3 bg-zinc-900/50 rounded-lg border border-white/5",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-[200px]",children:[(0,i.jsx)(d.A,{size:16,className:"text-zinc-500"}),(0,i.jsx)("input",{type:"text",value:K,onChange:e=>{I(e.target.value),E(1)},placeholder:`搜尋 ${Z}...`,className:"flex-1 bg-transparent border-none outline-none text-white placeholder-zinc-500 text-sm"}),K&&(0,i.jsx)("button",{onClick:()=>I(""),className:"text-zinc-500 hover:text-white",children:(0,i.jsx)(x.A,{size:14})})]}),(0,i.jsxs)("select",{value:Z,onChange:e=>W(e.target.value),className:"bg-zinc-800 border border-zinc-700 rounded px-2 py-1 text-sm text-zinc-300",children:[(0,i.jsx)("option",{value:"建案名稱",children:"建案名稱"}),(0,i.jsx)("option",{value:"行政區",children:"行政區"}),(0,i.jsx)("option",{value:"戶型",children:"戶型"}),(0,i.jsx)("option",{value:"主要用途",children:"主要用途"})]})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center text-sm text-zinc-400",children:[(0,i.jsxs)("span",{children:["共 ",(0,i.jsx)("span",{className:"text-white font-semibold",children:el.length.toLocaleString()})," 筆資料 ",K&&(0,i.jsx)("span",{className:"text-zinc-500",children:"(已篩選)"})]}),(0,i.jsxs)("span",{children:["第 ",L," / ",ec||1," 頁"]})]}),(0,i.jsxs)(n.c,{title:"交易資料明細",description:"點擊表頭可排序，點擊「明細」可展開詳細資訊",headerAction:(0,i.jsx)(N.N,{data:el,filename:"transaction_list_data",label:"匯出",chartType:"data-list"}),children:[(0,i.jsx)("div",{className:"hidden md:block overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,i.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold sticky top-0",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"px-3 py-3 w-20 text-center",children:"操作"}),ei.map(e=>{var t;return(0,i.jsx)("th",{className:(0,u.cn)("px-3 py-3 text-left whitespace-nowrap",e.sortable&&"cursor-pointer select-none group hover:text-white transition-colors","建案名稱"===e.key&&"min-w-[120px] max-w-[200px] whitespace-normal","行政區"===e.key&&"w-20","交易日"===e.key&&"w-24",("房屋單價(萬)"===e.key||"房屋面積(坪)"===e.key)&&"text-right"),onClick:()=>{var t;return e.sortable&&(t=e.key,void(q(e=>{if(e.key===t){if("asc"===e.direction)return{key:t,direction:"desc"};if("desc"===e.direction)return{key:"",direction:null}}return{key:t,direction:"asc"}}),E(1)))},children:(0,i.jsxs)("div",{className:(0,u.cn)("flex items-center gap-1",("房屋單價(萬)"===e.key||"房屋面積(坪)"===e.key)&&"justify-end"),children:[e.label,e.sortable&&(t=e.key,O.key!==t?(0,i.jsx)(r.A,{size:12,className:"opacity-30 group-hover:opacity-70"}):"asc"===O.direction?(0,i.jsx)(l.A,{size:12,className:"text-violet-400"}):(0,i.jsx)(c.A,{size:12,className:"text-violet-400"}))]})},e.key)})]})}),(0,i.jsx)("tbody",{className:"divide-y divide-white/5",children:ex.map((e,t)=>{let s=eo+t,n=D.has(s);return(0,i.jsxs)(a.Fragment,{children:[(0,i.jsxs)("tr",{className:(0,u.cn)("hover:bg-zinc-800/50 transition-colors",n&&"bg-zinc-800/30"),children:[(0,i.jsx)("td",{className:"px-3 py-2",children:(0,i.jsxs)("div",{className:"flex items-center gap-2 justify-center",children:[(0,i.jsxs)("button",{onClick:()=>es(e),className:"px-2 py-1 rounded text-xs font-medium bg-cyan-900/30 text-cyan-400 hover:bg-cyan-900/50 hover:text-cyan-300 transition-colors flex items-center gap-1 border border-cyan-800/50 active:scale-95",title:"查看車位或其他附表資料",children:[(0,i.jsx)(m.A,{size:12}),"附表"]}),(0,i.jsxs)("button",{onClick:()=>en(s),className:(0,u.cn)("flex items-center gap-1 px-2 py-1 rounded text-xs font-medium transition-colors border active:scale-95",n?"bg-violet-500/20 text-violet-300 border-violet-500/30":"bg-zinc-800 text-zinc-400 border-zinc-700 hover:bg-zinc-700 hover:text-zinc-200"),children:[n?(0,i.jsx)(l.A,{size:12}):(0,i.jsx)(c.A,{size:12}),"明細"]})]})}),ei.map(t=>(0,i.jsx)("td",{className:(0,u.cn)("px-3 py-2","建案名稱"===t.key?"whitespace-normal min-w-[120px] max-w-[200px]":"whitespace-nowrap",("房屋單價(萬)"===t.key||"房屋面積(坪)"===t.key)&&"text-right"),children:"戶型"===t.key?(0,i.jsx)("span",{className:"cursor-help border-b border-dotted border-zinc-600 block truncate max-w-[80px]",title:`原始戶別: ${e["戶別"]||"無資料"}`,children:er(e[t.key])}):(0,i.jsx)("span",{className:(0,u.cn)("房屋單價(萬)"===t.key&&"font-mono text-violet-400 font-bold","建案名稱"===t.key&&"font-medium text-white text-sm leading-tight block","建案名稱"!==t.key&&"房屋單價(萬)"!==t.key&&"text-zinc-300"),children:er(e[t.key])})},t.key))]}),n&&(0,i.jsx)("tr",{className:"bg-zinc-900/50",children:(0,i.jsx)("td",{colSpan:ei.length+1,className:"px-4 py-4",children:(0,i.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3",children:ea.map(t=>t in e?(0,i.jsxs)("div",{className:"bg-zinc-800/50 rounded p-2",children:[(0,i.jsx)("div",{className:"text-xs text-zinc-500 mb-1",children:t}),(0,i.jsx)("div",{className:"text-sm text-zinc-200 font-mono",children:er(e[t])})]},t):null)})})})]},s)})})]})}),(0,i.jsxs)("div",{className:"md:hidden space-y-4",children:[ex.map((e,t)=>{let s=eo+t,a=D.has(s);return(0,i.jsxs)("div",{className:(0,u.cn)("bg-zinc-900/40 border border-white/5 rounded-xl overflow-hidden transition-all duration-200",a?"ring-1 ring-violet-500/30 bg-zinc-900/60":"hover:bg-zinc-900/60"),children:[(0,i.jsxs)("div",{className:"p-4",onClick:()=>en(s),children:[(0,i.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,i.jsx)("span",{className:"text-xs font-medium px-1.5 py-0.5 rounded bg-zinc-800 text-zinc-400",children:e["行政區"]}),(0,i.jsx)("h3",{className:"text-base font-bold text-white leading-tight",children:e["建案名稱"]})]}),(0,i.jsxs)("div",{className:"text-xs text-zinc-500 font-mono",children:[e["交易日"]," • ",e["戶型"]||"-"]})]}),(0,i.jsxs)("div",{className:"text-right",children:[(0,i.jsxs)("div",{className:"text-lg font-bold text-violet-400 font-mono leading-none",children:[er(e["房屋單價(萬)"]),(0,i.jsx)("span",{className:"text-xs text-zinc-500 font-normal ml-0.5",children:"萬/坪"})]}),(0,i.jsxs)("div",{className:"text-xs text-zinc-500 mt-1",children:[er(e["交易總價(萬)"])," 萬"]})]})]}),(0,i.jsxs)("div",{className:"grid grid-cols-3 gap-2 py-3 border-t border-white/5",children:[(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("div",{className:"text-[10px] text-zinc-500 mb-0.5",children:"樓層"}),(0,i.jsxs)("div",{className:"text-sm font-medium text-zinc-300",children:[er(e["樓層"]),"F"]})]}),(0,i.jsxs)("div",{className:"text-center border-l border-white/5",children:[(0,i.jsx)("div",{className:"text-[10px] text-zinc-500 mb-0.5",children:"坪數"}),(0,i.jsx)("div",{className:"text-sm font-medium text-zinc-300",children:er(e["房屋面積(坪)"])})]}),(0,i.jsxs)("div",{className:"text-center border-l border-white/5",children:[(0,i.jsx)("div",{className:"text-[10px] text-zinc-500 mb-0.5",children:"車位"}),(0,i.jsx)("div",{className:"text-sm font-medium text-zinc-300",children:er(e["車位總價(萬)"])})]})]}),(0,i.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,i.jsxs)("button",{onClick:t=>{t.stopPropagation(),es(e)},className:"flex-1 py-2 rounded-lg text-xs font-medium bg-cyan-900/20 text-cyan-400 border border-cyan-800/30 flex items-center justify-center gap-1.5 active:scale-[0.98] transition-all",children:[(0,i.jsx)(m.A,{size:14}),"查看附表"]}),(0,i.jsxs)("button",{onClick:e=>{e.stopPropagation(),en(s)},className:(0,u.cn)("flex-1 py-2 rounded-lg text-xs font-medium border flex items-center justify-center gap-1.5 active:scale-[0.98] transition-all",a?"bg-violet-500/10 text-violet-300 border-violet-500/30":"bg-zinc-800/50 text-zinc-300 border-zinc-700"),children:[a?"收合明細":"顯示明細",a?(0,i.jsx)(l.A,{size:14}):(0,i.jsx)(c.A,{size:14})]})]})]}),a&&(0,i.jsx)("div",{className:"bg-zinc-950/50 border-t border-white/5 p-4 animate-accordion-down",children:(0,i.jsx)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-3",children:ea.map(t=>t in e?(0,i.jsxs)("div",{className:"overflow-hidden",children:[(0,i.jsx)("div",{className:"text-[10px] text-zinc-500 truncate",children:t}),(0,i.jsx)("div",{className:"text-sm text-zinc-300 font-mono truncate",children:er(e[t])})]},t):null)})})]},s)}),0===ex.length&&(0,i.jsx)("div",{className:"text-center py-12 text-zinc-500 bg-zinc-900/20 rounded-xl border border-dashed border-zinc-800",children:"無符合條件的資料"})]})]}),(0,i.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t border-white/5",children:[(0,i.jsxs)("div",{className:"text-sm text-zinc-500",children:["顯示第 ",el.length>0?eo+1:0," - ",Math.min(ed,el.length)," 筆"]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("button",{onClick:()=>E(e=>Math.max(1,e-1)),disabled:1===L,className:"p-2 rounded bg-zinc-800 text-zinc-300 hover:bg-zinc-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,i.jsx)(h.A,{size:16})}),(0,i.jsx)("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,ec||1)},(e,t)=>{let s,a=ec||1;return(s=a<=5||L<=3?t+1:L>=a-2?a-4+t:L-2+t)<1||s>a?null:(0,i.jsx)("button",{onClick:()=>E(s),className:(0,u.cn)("w-8 h-8 rounded text-sm font-medium transition-colors",L===s?"bg-violet-500 text-white":"bg-zinc-800 text-zinc-400 hover:bg-zinc-700"),children:s},s)})}),(0,i.jsx)("button",{onClick:()=>E(e=>Math.min(ec||1,e+1)),disabled:L===ec||0===ec,className:"p-2 rounded bg-zinc-800 text-zinc-300 hover:bg-zinc-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,i.jsx)(p.A,{size:16})})]})]}),(0,i.jsx)(v.a,{isOpen:B,onClose:()=>U(!1),className:"max-w-5xl",title:(0,i.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(m.A,{className:"text-cyan-400"}),(0,i.jsx)("span",{children:V})]}),(0,i.jsx)(N.N,{data:H,filename:`sub_table_${V}`,label:"匯出附表",className:"ml-4"})]}),children:J?(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,i.jsx)(o.A,{className:"h-8 w-8 animate-spin text-cyan-400 mb-3"}),(0,i.jsx)("p",{className:"text-zinc-500 text-sm animate-pulse",children:"正在讀取附表資料..."})]}):H.length>0?(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("div",{className:"bg-zinc-800/30 rounded-lg overflow-hidden border border-white/5",children:(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,i.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"px-4 py-3 whitespace-nowrap bg-zinc-900 text-cyan-400",children:"類別"}),Object.keys(H[0]).filter(e=>"id"!==e&&"編號"!==e&&"created_at"!==e&&"_category"!==e&&"車位價格"!==e&&"車位面積"!==e).map(e=>(0,i.jsx)("th",{className:"px-4 py-3 whitespace-nowrap bg-zinc-900",children:e},e))]})}),(0,i.jsx)("tbody",{className:"divide-y divide-white/5",children:H.map((e,t)=>(0,i.jsxs)("tr",{className:"hover:bg-zinc-800/50 transition-colors",children:[(0,i.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-cyan-400 font-medium",children:e._category||"附表"}),Object.keys(e).filter(e=>"id"!==e&&"編號"!==e&&"created_at"!==e&&"_category"!==e&&"車位價格"!==e&&"車位面積"!==e).map(t=>(0,i.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-zinc-300",children:er(e[t])},t))]},t))})]})})}),(0,i.jsx)("div",{className:"flex justify-end",children:(0,i.jsx)("button",{onClick:()=>U(!1),className:"px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-sm text-white rounded transition-colors",children:"關閉"})})]}):(0,i.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-zinc-500",children:[(0,i.jsx)("div",{className:"bg-zinc-800/50 p-4 rounded-full mb-3",children:(0,i.jsx)(m.A,{size:24,className:"opacity-20"})}),(0,i.jsx)("p",{children:"此筆交易沒有相關附表資料"})]})})]}):(0,i.jsx)("div",{className:"text-center p-12 text-zinc-500",children:"無交易資料可顯示"})}},48551:(e,t,s)=>{s.d(t,{K:()=>o});var i=s(95155),a=s(12115),n=s(88743),r=s(80642),l=s(39430),c=s(40980);function o(){let{selectedRoomTypes:e,setSelectedRoomTypes:t}=(0,n.P)(),[s,o]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{let e=()=>{let e=document.getElementById("room-type-filter-anchor");e&&o(e.getBoundingClientRect().bottom<80)};return window.addEventListener("scroll",e),e(),()=>window.removeEventListener("scroll",e)},[]),(0,i.jsx)(r.N,{children:s&&(0,i.jsxs)(l.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.3},className:(0,c.cn)("fixed z-[90] flex gap-1.5 p-1.5 bg-zinc-900/95 backdrop-blur-md border border-white/10 rounded-xl shadow-xl","flex-row bottom-8 left-1/2 -translate-x-1/2 items-center max-w-[90vw]","md:flex-col md:left-20 md:top-1/2 md:-translate-y-1/2 md:bottom-auto md:translate-x-0 md:items-stretch md:max-w-none"),children:[(0,i.jsx)("div",{className:(0,c.cn)("text-[9px] text-zinc-500 font-medium overflow-hidden","md:writing-mode-vertical md:text-center md:mb-0.5","whitespace-nowrap px-1"),children:"房型"}),(0,i.jsx)("div",{className:"flex md:flex-col gap-1.5 overflow-x-auto md:overflow-visible max-w-full md:max-w-none pb-2 md:pb-0 scrollbar-thumb-zinc-600 pr-8 md:pr-0",children:n.M.map(s=>(0,i.jsx)("button",{onClick:()=>{t(e.includes(s)?e.filter(e=>e!==s):[...e,s])},className:(0,c.cn)("px-2 py-1 text-[10px] font-medium rounded-lg transition-all hover:scale-105 active:scale-95 whitespace-nowrap",e.includes(s)?"bg-violet-500 text-white shadow-lg shadow-violet-500/20":"bg-zinc-800/50 text-zinc-400 hover:bg-zinc-700 hover:text-white"),children:s},s))}),e.length>0&&e.length<n.M.length&&(0,i.jsx)("button",{onClick:()=>t([]),className:(0,c.cn)("text-[9px] text-cyan-400 hover:text-cyan-300 transition-colors whitespace-nowrap px-1","md:mt-1 md:border-t md:border-white/5 md:pt-1 md:text-center md:px-0","border-l border-white/5 pl-1 md:border-l-0 md:pl-0"),children:"清除"})]})})}},53812:(e,t,s)=>{s.d(t,{Q:()=>f});var i=s(95155),a=s(12115),n=s(68605),r=s(3083),l=s(4439),c=s(40980);function o({data:e,viewType:t,selectedRooms:s}){if(!e||0===Object.keys(e).length)return(0,i.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無銷售速度資料"});let n=Object.keys(e).sort().reverse();return(0,i.jsx)("div",{className:"overflow-x-auto max-h-[600px] border border-white/5 rounded-lg",children:(0,i.jsxs)("table",{className:"w-full text-sm text-left border-collapse",children:[(0,i.jsxs)("thead",{className:"bg-zinc-900 sticky top-0 z-20 shadow-md",children:[(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{rowSpan:2,className:"px-4 py-3 sticky left-0 z-30 bg-zinc-900 border-r border-white/10 font-medium text-white min-w-[120px]",children:"時間"}),s.map(e=>(0,i.jsx)("th",{colSpan:3,className:"px-2 py-2 text-center border-l border-white/5 text-zinc-300 font-medium bg-zinc-900/90",children:e},e)),(0,i.jsx)("th",{colSpan:3,className:"px-2 py-2 text-center border-l-2 border-white/10 text-cyan-400 font-bold bg-zinc-900/90",children:"總計"})]}),(0,i.jsxs)("tr",{children:[s.map((e,t)=>(0,i.jsxs)(a.Fragment,{children:[(0,i.jsx)("th",{className:(0,c.cn)("px-2 py-2 text-center text-xs text-zinc-500 font-normal bg-zinc-900/90 border-b border-white/10",0===t&&"border-l border-white/5"),children:"筆數"}),(0,i.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-500 font-normal bg-zinc-900/90 border-b border-white/10",children:"總價(萬)"}),(0,i.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-500 font-normal bg-zinc-900/90 border-b border-white/10",children:"坪數"})]},e)),(0,i.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-400 font-medium bg-zinc-900/90 border-b border-white/10 border-l-2 border-white/10",children:"筆數"}),(0,i.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-400 font-medium bg-zinc-900/90 border-b border-white/10",children:"總價(萬)"}),(0,i.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-400 font-medium bg-zinc-900/90 border-b border-white/10",children:"坪數"})]})]}),(0,i.jsx)("tbody",{className:"divide-y divide-white/5",children:n.map(n=>{let r=e[n]||{},l={count:0,priceSum:0,areaSum:0};return(0,i.jsxs)("tr",{className:"hover:bg-zinc-800/30 transition-colors",children:[(0,i.jsx)("td",{className:"px-4 py-2 sticky left-0 z-10 bg-zinc-950/90 border-r border-white/10 font-mono text-zinc-400",children:("weekly"===t&&n.includes("-W"),n)}),s.map((e,t)=>{let s=r[e];return s?(l.count+=s.count,l.priceSum+=s.priceSum,l.areaSum+=s.areaSum,(0,i.jsxs)(a.Fragment,{children:[(0,i.jsx)("td",{className:(0,c.cn)("px-2 py-2 text-center text-zinc-300",0===t&&"border-l border-white/5"),children:s.count>0?s.count.toLocaleString():"-"}),(0,i.jsx)("td",{className:"px-2 py-2 text-center text-zinc-500 font-mono text-xs",children:s.count>0?(0,c.Z)(s.priceSum,0):"-"}),(0,i.jsx)("td",{className:"px-2 py-2 text-center text-zinc-500 font-mono text-xs",children:s.count>0?(0,c.Z)(s.areaSum,1):"-"})]},e)):(0,i.jsxs)(a.Fragment,{children:[(0,i.jsx)("td",{className:(0,c.cn)("px-2 py-2 text-center text-zinc-700",0===t&&"border-l border-white/5"),children:"-"}),(0,i.jsx)("td",{className:"px-2 py-2 text-center text-zinc-700",children:"-"}),(0,i.jsx)("td",{className:"px-2 py-2 text-center text-zinc-700",children:"-"})]},e)}),(0,i.jsx)("td",{className:"px-2 py-2 text-center font-bold text-cyan-400 border-l-2 border-white/10",children:l.count.toLocaleString()}),(0,i.jsx)("td",{className:"px-2 py-2 text-center font-bold text-zinc-300 font-mono text-xs",children:(0,c.Z)(l.priceSum,0)}),(0,i.jsx)("td",{className:"px-2 py-2 text-center font-bold text-zinc-300 font-mono text-xs",children:(0,c.Z)(l.areaSum,1)})]},n)})})]})})}var d=s(29991),x=s(60529),m=s(78795),h=s(88743),p=s(48551),u=s(39430),b=s(80642);function f({data:e}){let[t,s]=(0,a.useState)("monthly"),[f,j]=(0,a.useState)("count"),[g,v]=(0,a.useState)(15),[N,y]=(0,a.useState)(65),[w,z]=(0,a.useState)(5),[k,S]=(0,a.useState)([]),[P,A]=(0,a.useState)(null),{selectedRoomTypes:C,setSelectedRoomTypes:_}=(0,h.P)();if(!e)return null;let{salesVelocityAnalysis:M,areaDistributionAnalysis:$}=e,T=e=>Math.round(e)+"萬",F=a.useRef(null);return(0,i.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,i.jsxs)("div",{id:"room-type-filter-anchor",className:"p-4 bg-zinc-900/30 border border-white/5 rounded-lg flex flex-wrap gap-2 items-center scroll-mt-24",children:[(0,i.jsx)("span",{className:"text-zinc-400 text-sm mr-2",children:"分析房型:"}),h.M.map(e=>(0,i.jsx)("button",{onClick:()=>{_(C.includes(e)?C.filter(t=>t!==e):[...C,e])},className:(0,c.cn)("px-3 py-1 text-xs rounded-full border transition-colors",C.includes(e)?"bg-violet-500/20 border-violet-500 text-violet-200":"bg-zinc-800 border-zinc-700 text-zinc-500 hover:bg-zinc-700"),children:e},e))]}),(0,i.jsx)(n.c,{title:"房型銷售速度與趨勢分析",headerAction:(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsxs)(d.l,{value:t,onChange:e=>s(e.target.value),className:"w-[100px] h-8 text-xs bg-zinc-950/50",children:[(0,i.jsx)("option",{value:"weekly",children:"每週"}),(0,i.jsx)("option",{value:"monthly",children:"每月"}),(0,i.jsx)("option",{value:"quarterly",children:"每季"})]}),(0,i.jsxs)(d.l,{value:f,onChange:e=>j(e.target.value),className:"w-[100px] h-8 text-xs bg-zinc-950/50",children:[(0,i.jsx)("option",{value:"count",children:"交易筆數"}),(0,i.jsx)("option",{value:"priceSum",children:"總銷金額"}),(0,i.jsx)("option",{value:"areaSum",children:"總銷坪數"})]}),(0,i.jsx)(m.N,{data:M?.[t]||[],filename:`sales_velocity_${t}`,label:"匯出",chartType:"sales-velocity-chart",snapshotData:M?.[t]||[],columns:{period:"時間區間",count:"交易筆數",priceSum:"總銷金額",areaSum:"總銷坪數"}})]}),children:(0,i.jsx)(r.M,{data:M?.[t]||{},selectedRooms:C,metric:f})}),(0,i.jsx)(n.c,{title:"銷售速度明細表",description:"各時間段詳細銷售數據統計",headerAction:(0,i.jsx)(m.N,{data:M?.[t],filename:`sales_velocity_table_${t}`,label:"匯出",chartType:"sales-velocity-table",snapshotData:M?.[t]||[],columns:{period:"時間區間",count:"交易筆數",priceSum:"總銷金額",areaSum:"總銷坪數"}}),children:(0,i.jsx)(o,{data:M?.[t]||[],viewType:t,selectedRooms:C})}),(0,i.jsx)(n.c,{title:"房型面積分佈熱力圖",description:"分析不同坪數區間的產品供給與去化分佈",headerAction:(0,i.jsxs)("div",{className:"flex gap-2 items-center text-zinc-400 text-xs",children:[(0,i.jsx)("span",{children:"範圍:"}),(0,i.jsx)(x.p,{type:"number",value:g,onChange:e=>v(Number(e.target.value)),className:"w-16 h-8 text-xs bg-zinc-950/50"}),(0,i.jsx)("span",{children:"-"}),(0,i.jsx)(x.p,{type:"number",value:N,onChange:e=>y(Number(e.target.value)),className:"w-16 h-8 text-xs bg-zinc-950/50"}),(0,i.jsx)("span",{className:"ml-2",children:"級距:"}),(0,i.jsx)(x.p,{type:"number",value:w,onChange:e=>z(Number(e.target.value)),step:"0.5",className:"w-16 h-8 text-xs bg-zinc-950/50"}),(0,i.jsx)("div",{className:"border-l border-white/10 h-4 mx-1"}),(0,i.jsx)(m.N,{data:$?Object.entries($).map(([e,t])=>({key:e,value:JSON.stringify(t)})):[],filename:"area_distribution_heatmap",label:"匯出",chartType:"sales-heatmap",snapshotData:{distribution:$,selectedRooms:C,min:g,max:N,interval:w},columns:{key:"坪數區間",value:"分佈數據"}})]}),children:(0,i.jsxs)("div",{className:(0,c.cn)("flex flex-col lg:flex-row gap-6 relative overflow-hidden items-stretch transition-all duration-300",P?"lg:h-[600px]":"min-h-[500px]"),children:[(0,i.jsx)(u.P.div,{layout:!0,initial:!1,animate:{flex:P?"0 0 60%":"0 0 100%"},transition:{type:"spring",stiffness:300,damping:35,mass:1},onAnimationStart:()=>{},onAnimationComplete:()=>{F.current&&(F.current.style.width="100%",window.dispatchEvent(new Event("resize")))},className:"min-w-0 overflow-hidden h-full flex flex-col",children:(0,i.jsx)("div",{ref:F,className:"w-full h-full flex flex-col",children:(0,i.jsx)(l.m,{data:$||{},selectedRooms:C,minArea:g,maxArea:N,interval:w,onDataPointClick:(t,s)=>{F.current&&(F.current.style.width=`${F.current.offsetWidth}px`);let i=0,a=1/0;if(s.includes("<"))a=parseFloat(s.replace("<","").trim());else if(s.includes(">"))i=parseFloat(s.replace(">","").trim());else if(s.includes("-")){let e=s.split("-");i=parseFloat(e[0].trim()),a=parseFloat(e[1].trim())}let n=(e.transactionDetails||[]).filter(e=>{let s=function(e){let t=e=>e?String(e).normalize("NFKC").toUpperCase().replace(/\s+/g,""):"",s=t(e["建物型態"]||e.buildingType),i=t(e["主要用途"]||e.mainPurpose),a=t(e["戶別"]||e.unit),n=void 0!==e["房數"]?e["房數"]:e.rooms,r=void 0!==e["房屋面積(坪)"]?parseFloat(e["房屋面積(坪)"]):parseFloat(e.houseArea||0);if(s.includes("住宅大樓")&&a.includes("S")||a.includes("店舖")||a.includes("店面")||a.includes("店鋪"))return"店舖";if(a.includes("事務所")||a.includes("辦公"))return"辦公/事務所";if(s.includes("店舖")||s.includes("店面")||s.includes("店鋪"))return"店舖";if(s.includes("工廠")||s.includes("倉庫")||s.includes("廠辦"))return"廠辦/工廠";if(i.includes("商業")||s.includes("辦公")||s.includes("事務所"))return"辦公/事務所";if((s.includes("住宅大樓")||s.includes("華廈"))&&0===n){if(r>35)return"毛胚";if(r<=35)return"套房"}if("number"==typeof n&&!isNaN(n)){if(1===n)return"1房";if(2===n)return"2房";if(3===n)return"3房";if(4===n)return"4房";if(n>=5)return"5房以上"}return"其他"}(e),n=parseFloat(e["房屋面積(坪)"]||e.houseArea||(e["建物移轉平方公尺"]?.3025*e["建物移移轉平方公尺"]:0));if(!s)return!1;let r=n>=i&&n<a;return s===t&&r});console.log(`[Heatmap Click] Room: ${t}, Range: ${i}-${a}, Found: ${n.length}`);let r={};n.forEach(e=>{let t=e["建案名稱"]||e.projectName||"未知建案";r[t]||(r[t]=[]),r[t].push(e)});let l=Object.entries(r).map(([e,t])=>{let s=t.map(e=>e["產權總價"]||e["交易總價(萬)"]||e.totalPrice||0).filter(e=>e>0).sort((e,t)=>e-t),i=t.map(e=>e["房屋單價"]||e["房屋單價(萬)"]||e.unitPrice||0).filter(e=>e>0),a=0;if(s.length>0){let e=Math.floor(s.length/2);a=s.length%2!=0?s[e]:(s[e-1]+s[e])/2}return{projectName:e,count:t.length,priceRange:{min:s.length>0?s[0]:0,max:s.length>0?s[s.length-1]:0,median:a},unitPriceRange:{min:i.length>0?Math.min(...i):0,max:i.length>0?Math.max(...i):0},transactions:t.sort((e,t)=>{let s=e["房屋單價"]||e["房屋單價(萬)"]||e.unitPrice||0;return(t["房屋單價"]||t["房屋單價(萬)"]||t.unitPrice||0)-s}),isExpanded:!1}});l.sort((e,t)=>t.unitPriceRange.max-e.unitPriceRange.max),S(l),A({roomType:t,areaRange:s,totalCount:n.length})},height:P?"100%":void 0})})}),(0,i.jsx)(b.N,{mode:"wait",children:P&&(0,i.jsxs)(u.P.div,{initial:{opacity:0,x:50,width:0},animate:{opacity:1,x:0,width:"40%"},exit:{opacity:0,x:50,width:0},transition:{type:"spring",stiffness:300,damping:35},className:"flex-1 min-w-0 bg-zinc-900/50 border border-white/10 rounded-lg h-full flex flex-col p-4 overflow-hidden",children:[(0,i.jsxs)("div",{className:"flex justify-between items-start mb-4 pb-4 border-b border-white/5",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("h4",{className:"text-white font-medium flex items-center gap-2 text-lg",children:[(0,i.jsx)("span",{className:"text-cyan-400",children:P.roomType}),(0,i.jsx)("span",{className:"text-zinc-500",children:"|"}),(0,i.jsxs)("span",{children:[P.areaRange," 坪"]})]}),(0,i.jsxs)("p",{className:"text-zinc-400 text-xs mt-1",children:["共找到 ",(0,i.jsx)("span",{className:"text-white font-mono",children:k.length})," 個建案",(0,i.jsx)("br",{}),"合計 ",(0,i.jsx)("span",{className:"text-white font-mono",children:P.totalCount})," 筆交易"]})]}),(0,i.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,i.jsxs)("div",{className:"flex gap-1 mr-2",children:[(0,i.jsx)(m.N,{data:k,filename:`heatmap_aggregated_${P.roomType}_${P.areaRange}`,label:"統計",chartType:"sales-heatmap-detail",snapshotData:k,className:"whitespace-nowrap px-3 py-1 text-xs h-7 min-w-0"}),(0,i.jsx)(m.N,{data:k.flatMap(e=>e.transactions),filename:`heatmap_details_${P.roomType}_${P.areaRange}`,label:"明細",className:"whitespace-nowrap px-3 py-1 text-xs h-7 min-w-0"})]}),(0,i.jsx)("div",{className:"w-px h-4 bg-white/10 mx-1"}),(0,i.jsx)("button",{onClick:()=>{F.current&&(F.current.style.width=`${F.current.offsetWidth}px`),A(null)},className:"text-zinc-400 hover:text-white p-1 hover:bg-zinc-800 rounded transition-colors",children:(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,i.jsx)("path",{d:"M18 6 6 18"}),(0,i.jsx)("path",{d:"m6 6 12 12"})]})})]})]}),k.length>0?(0,i.jsx)("div",{className:"flex-1 overflow-y-auto custom-scrollbar pr-1 -mr-1",children:(0,i.jsx)("div",{className:"space-y-3",children:k.map((e,t)=>(0,i.jsxs)("div",{className:"bg-zinc-950/30 rounded border border-white/5 overflow-hidden",children:[(0,i.jsxs)("div",{className:(0,c.cn)("p-3 cursor-pointer transition-colors flex justify-between items-center",e.isExpanded?"bg-zinc-800/80":"hover:bg-zinc-800/40"),onClick:()=>{S(e=>e.map((e,s)=>s===t?{...e,isExpanded:!e.isExpanded}:e))},children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("div",{className:(0,c.cn)("w-4 h-4 rounded-full bg-zinc-800 flex items-center justify-center text-[10px] text-zinc-400 transition-transform duration-200",e.isExpanded?"rotate-90 bg-violet-500/20 text-violet-300":""),children:"▶"}),(0,i.jsx)("span",{className:"font-medium text-sm text-zinc-200",children:e.projectName}),(0,i.jsxs)("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-zinc-800 text-zinc-400 border border-white/5",children:[e.count,"戶"]})]}),(0,i.jsx)("div",{className:"text-right",children:(0,i.jsxs)("div",{className:"text-xs font-mono text-cyan-400",children:[e.unitPriceRange.min===e.unitPriceRange.max?e.unitPriceRange.min.toFixed(1):`${e.unitPriceRange.min.toFixed(1)}~${e.unitPriceRange.max.toFixed(1)}`," ",(0,i.jsx)("span",{className:"text-zinc-500 text-[10px]",children:"萬/坪"})]})})]}),e.isExpanded&&(0,i.jsxs)("div",{className:"p-3 bg-black/20 border-t border-white/5",children:[(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-xs mb-3 text-zinc-400",children:[(0,i.jsxs)("div",{className:"flex justify-between border-b border-white/5 pb-1",children:[(0,i.jsx)("span",{children:"總價範圍"}),(0,i.jsx)("span",{className:"font-mono text-zinc-300",children:e.priceRange.min===e.priceRange.max?T(e.priceRange.min):`${T(e.priceRange.min)}~${T(e.priceRange.max)}`})]}),(0,i.jsxs)("div",{className:"flex justify-between border-b border-white/5 pb-1",children:[(0,i.jsx)("span",{children:"總價中位數"}),(0,i.jsx)("span",{className:"font-mono text-violet-300",children:T(e.priceRange.median||0)})]})]}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("div",{className:"grid grid-cols-5 text-[10px] text-zinc-500 pb-1 border-b border-white/5",children:[(0,i.jsx)("div",{className:"col-span-1",children:"樓層"}),(0,i.jsx)("div",{className:"col-span-1",children:"坪數"}),(0,i.jsx)("div",{className:"col-span-1 text-right",children:"單價"}),(0,i.jsx)("div",{className:"col-span-2 text-right",children:"總價"})]}),e.transactions.slice(0,e.showAll?void 0:10).map((e,t)=>(0,i.jsxs)("div",{className:"grid grid-cols-5 text-xs py-1 hover:bg-white/5 rounded px-1 -mx-1 transition-colors",children:[(0,i.jsx)("div",{className:"col-span-1 text-zinc-300",children:e["樓層"]||e.floor||"-"}),(0,i.jsx)("div",{className:"col-span-1 text-zinc-400",children:(e["房屋面積(坪)"]||e.houseArea||0).toFixed(1)}),(0,i.jsx)("div",{className:"col-span-1 text-right text-cyan-400",children:(e["房屋單價(萬)"]||e.unitPrice||0).toFixed(0)}),(0,i.jsx)("div",{className:"col-span-2 text-right text-zinc-300 font-mono",children:T(e["交易總價(萬)"]||e.totalPrice||0)})]},t)),e.transactions.length>10&&(0,i.jsx)("button",{onClick:e=>{e.stopPropagation(),S(e=>e.map((e,s)=>s===t?{...e,showAll:!e.showAll}:e))},className:"w-full text-center text-[10px] text-zinc-500 hover:text-cyan-400 py-1.5 mt-1 border-t border-white/5 transition-colors",children:e.showAll?"收合內容":`還有 ${e.transactions.length-10} 筆交易...`})]})]})]},t))})}):(0,i.jsx)("div",{className:"flex-1 flex flex-col items-center justify-center text-zinc-500 border border-dashed border-zinc-800 rounded bg-zinc-900/30",children:(0,i.jsx)("p",{children:"無詳細資料"})})]})})]})}),(0,i.jsx)(p.K,{})]})}},55810:(e,t,s)=>{s.d(t,{p:()=>j});var i=s(95155),a=s(12115),n=s(68605),r=s(69690),l=s(88743),c=s(89239),o=s(86901),d=s(89123),x=s(37595),m=s(56842),h=s(72055),p=s(65770),u=s(41641),b=s(21362),f=s(78795);function j({data:e,visibleSections:t=["metrics","chart","table"]}){let{rankingCurrentPage:s,rankingPageSize:j,setRankingCurrentPage:g,setRankingPageSize:v}=(0,l.P)(),[N,y]=(0,a.useState)(1),[w,z]=(0,a.useState)(10),[k,S]=(0,a.useState)({key:"saleAmountSum",order:"desc"}),[P,A]=(0,a.useState)(30),[C,_]=(0,a.useState)("auto");if(!e)return null;let{coreMetrics:M,projectRanking:$}=e,T=(0,a.useMemo)(()=>{if(!$||0===$.length)return{min:0,max:0,median:0,parking:0};let e=Math.min(...$.map(e=>e.minPrice).filter(e=>e>0)),t=Math.max(...$.map(e=>e.maxPrice)),s=$.map(e=>e.medianPrice).filter(e=>e>0),i=s.length>0?s.reduce((e,t)=>e+t,0)/s.length:0,a=$.map(e=>e.avgParkingPrice).filter(e=>e>0);return{min:e,max:t,median:i,parking:a.length>0?a.reduce((e,t)=>e+t,0)/a.length:0}},[$]),F=(0,a.useMemo)(()=>$?[...$].sort((e,t)=>{let s=e[k.key]||0,i=t[k.key]||0;return"desc"===k.order?i-s:s-i}):[],[$,k]),L=Math.ceil(F.length/w),E=F.slice((N-1)*w,N*w),D=e=>{S({key:e,order:"desc"})},R=({title:e,value:t,unit:s,sortKey:a})=>(0,i.jsxs)("div",{onClick:()=>a&&D(a),className:`bg-zinc-800/50 rounded-lg p-4 border border-white/5 flex flex-col items-center justify-center text-center transition-all duration-300 ${a?"cursor-pointer hover:bg-zinc-800 hover:border-violet-500/30 hover:shadow-[0_0_20px_rgba(139,92,246,0.1)] group":""}`,children:[(0,i.jsx)("div",{className:`text-zinc-400 text-sm mb-1 ${a?"group-hover:text-violet-300":""}`,children:e}),(0,i.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,i.jsx)("span",{className:`text-2xl font-bold text-white ${a?"group-hover:text-white":""}`,children:t}),(0,i.jsx)("span",{className:"text-xs text-zinc-500",children:s})]})]});return(0,i.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[t.includes("metrics")&&(0,i.jsx)(n.c,{title:"核心數據指標",headerAction:(0,i.jsx)(f.N,{data:[M,T],filename:"core_metrics",label:"匯出",chartType:"ranking-metrics",snapshotData:{coreMetrics:M,derivedMetrics:T}}),children:(0,i.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:[(0,i.jsx)(R,{title:"市場去化總銷售金額",value:M.totalSaleAmount.toLocaleString(),unit:"萬",sortKey:"saleAmountSum"}),(0,i.jsx)(R,{title:"總銷去化房屋坪數",value:M.totalHouseArea.toLocaleString(void 0,{maximumFractionDigits:2}),unit:"坪",sortKey:"houseAreaSum"}),(0,i.jsx)(R,{title:"總平均單價",value:M.overallAveragePrice.toLocaleString(void 0,{maximumFractionDigits:2}),unit:"萬/坪",sortKey:"averagePrice"}),(0,i.jsx)(R,{title:"總交易筆數",value:M.transactionCount.toLocaleString(),unit:"筆",sortKey:"transactionCount"}),(0,i.jsx)(R,{title:"最低成交單價 (Min)",value:T.min.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"萬/坪",sortKey:"minPrice"}),(0,i.jsx)(R,{title:"最高成交單價 (Max)",value:T.max.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"萬/坪",sortKey:"maxPrice"}),(0,i.jsx)(R,{title:"平均中位數單價",value:T.median.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"萬/坪",sortKey:"medianPrice"}),(0,i.jsx)(R,{title:"平均車位價格",value:T.parking.toLocaleString(void 0,{maximumFractionDigits:0}),unit:"萬",sortKey:"avgParkingPrice"})]})}),t.includes("chart")&&(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("div",{className:"flex flex-wrap gap-2 justify-center",children:[{key:"saleAmountSum",label:"交易總價(萬)"},{key:"houseAreaSum",label:"房屋面積(坪)"},{key:"transactionCount",label:"資料筆數"},{key:"marketShare",label:"市場佔比(%)"},{key:"averagePrice",label:"平均單價"},{key:"minPrice",label:"最低單價"},{key:"maxPrice",label:"最高單價"},{key:"medianPrice",label:"中位數單價"},{key:"avgParkingPrice",label:"車位均價"}].map(e=>(0,i.jsx)("button",{onClick:()=>D(e.key),className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-all duration-300 ${k.key===e.key?"bg-violet-600/20 border-violet-500/50 text-violet-300 shadow-[0_0_15px_rgba(139,92,246,0.2)]":"bg-zinc-800/50 border-white/5 text-zinc-400 hover:text-white hover:bg-zinc-800 hover:border-white/10"}`,children:e.label},e.key))}),(0,i.jsx)(n.c,{title:"建案分析圖表",description:"根據排序指標顯示建案排名",headerAction:(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 w-full sm:w-auto",children:[(0,i.jsxs)("div",{className:"flex bg-zinc-800 p-0.5 rounded-lg border border-white/5",children:[(0,i.jsx)("button",{onClick:()=>_("auto"),className:`p-1.5 rounded-md transition-all ${"auto"===C?"bg-violet-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-400 hover:text-white hover:bg-white/5"}`,title:"自動選擇 (Auto)",children:(0,i.jsx)(o.A,{size:14})}),(0,i.jsx)("button",{onClick:()=>_("bar"),className:`p-1.5 rounded-md transition-all ${"bar"===C?"bg-violet-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-400 hover:text-white hover:bg-white/5"}`,title:"長條圖 (Bar)",children:(0,i.jsx)(d.A,{size:14})}),(0,i.jsx)("button",{onClick:()=>_("treemap"),className:`p-1.5 rounded-md transition-all ${"treemap"===C?"bg-violet-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-400 hover:text-white hover:bg-white/5"}`,title:"矩形樹圖 (Treemap)",children:(0,i.jsx)(x.A,{size:14})})]}),(0,i.jsx)("div",{className:"hidden sm:block w-px h-6 bg-white/10"}),(0,i.jsxs)("div",{className:"flex items-center gap-3 w-full sm:w-auto justify-between sm:justify-start",children:[(0,i.jsx)("div",{className:"flex bg-zinc-800 p-0.5 rounded-lg border border-white/5 overflow-x-auto max-w-[200px] sm:max-w-none scrollbar-hide",children:[10,30,50,100].map(e=>(0,i.jsxs)("button",{onClick:()=>A(e),className:`px-3 py-1 text-xs rounded-md transition-all whitespace-nowrap ${P===e?"bg-violet-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-400 hover:text-white hover:bg-white/5"}`,children:["Top ",e]},e))}),(0,i.jsx)("div",{className:"hidden sm:block w-px h-6 bg-white/10"}),(0,i.jsx)(f.N,{data:F.slice(0,P),filename:"ranking_chart_data",label:"匯出",chartType:"ranking-chart",snapshotData:F.slice(0,P),columns:{projectName:"建案名稱",county:"縣市",district:"行政區",saleAmountSum:"交易總價",houseAreaSum:"房屋面積",transactionCount:"資料筆數",marketShare:"市場佔比",averagePrice:"平均單價",minPrice:"最低單價",maxPrice:"最高單價",medianPrice:"中位數單價",avgParkingPrice:"車位均價"}})]})]}),children:(0,i.jsx)(r.l,{data:F,sortKey:k.key,limit:P,chartType:C})})]}),t.includes("table")&&(0,i.jsxs)(n.c,{title:"區域建案排行列表",description:"點擊表頭可進行排序",headerAction:(0,i.jsx)(f.N,{data:F,filename:"ranking_table_data",label:"匯出",chartType:"ranking-table",snapshotData:F,columns:{projectName:"建案名稱",county:"縣市",district:"行政區",saleAmountSum:"交易總價",houseAreaSum:"房屋面積",transactionCount:"資料筆數",marketShare:"市場佔比",averagePrice:"平均單價",minPrice:"最低單價",maxPrice:"最高單價",medianPrice:"中位數單價",avgParkingPrice:"車位均價"}}),children:[(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,i.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"px-4 py-3 cursor-default",children:"排名"}),(0,i.jsx)("th",{className:"px-4 py-3 cursor-default",children:"建案名稱"}),[{key:"saleAmountSum",label:(0,i.jsxs)(i.Fragment,{children:["交易",(0,i.jsx)("br",{}),"總價(萬)"]})},{key:"houseAreaSum",label:(0,i.jsxs)(i.Fragment,{children:["房屋",(0,i.jsx)("br",{}),"面積(坪)"]})},{key:"transactionCount",label:(0,i.jsxs)(i.Fragment,{children:["資料",(0,i.jsx)("br",{}),"筆數"]})},{key:"marketShare",label:(0,i.jsxs)(i.Fragment,{children:["市場",(0,i.jsx)("br",{}),"佔比(%)"]})},{key:"averagePrice",label:(0,i.jsxs)(i.Fragment,{children:["平均",(0,i.jsx)("br",{}),"單價"]})},{key:"minPrice",label:(0,i.jsxs)(i.Fragment,{children:["最低",(0,i.jsx)("br",{}),"單價"]})},{key:"maxPrice",label:(0,i.jsxs)(i.Fragment,{children:["最高",(0,i.jsx)("br",{}),"單價"]})},{key:"medianPrice",label:(0,i.jsxs)(i.Fragment,{children:["中位數",(0,i.jsx)("br",{}),"單價"]})},{key:"avgParkingPrice",label:(0,i.jsxs)(i.Fragment,{children:["車位",(0,i.jsx)("br",{}),"均價"]})}].map(e=>(0,i.jsx)("th",{className:"px-3 py-3 cursor-pointer hover:text-white transition-colors text-center whitespace-nowrap",onClick:()=>D(e.key),children:(0,i.jsxs)("div",{className:"flex items-center justify-center gap-1.5 group/header",children:[(0,i.jsx)("span",{className:"leading-tight",children:e.label}),(0,i.jsx)("div",{className:"flex flex-col opacity-50 group-hover/header:opacity-100 transition-opacity",children:k.key===e.key?"desc"===k.order?(0,i.jsx)(m.A,{size:14,className:"text-violet-500"}):(0,i.jsx)(h.A,{size:14,className:"text-violet-500"}):(0,i.jsx)(p.A,{size:14,className:"text-zinc-600 group-hover/header:text-zinc-400"})})]})},e.key))]})}),(0,i.jsx)("tbody",{className:"divide-y divide-white/5",children:E.map((e,t)=>(0,i.jsxs)("tr",{className:"hover:bg-zinc-800/50 transition-colors",children:[(0,i.jsx)("td",{className:"px-4 py-3 text-zinc-500 font-mono",children:(N-1)*w+t+1}),(0,i.jsx)("td",{className:"px-4 py-3",children:(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsx)("span",{className:"font-medium text-white",children:e.projectName}),(0,i.jsxs)("div",{className:"flex gap-1 mt-1",children:[e.county&&(0,i.jsx)("span",{className:"text-[10px] bg-zinc-800 text-zinc-400 px-1 py-0.5 rounded",children:e.county}),e.district&&(0,i.jsx)("span",{className:"text-[10px] bg-zinc-800 text-zinc-400 px-1 py-0.5 rounded",children:e.district})]})]})}),(0,i.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.saleAmountSum.toLocaleString()}),(0,i.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.houseAreaSum.toLocaleString()}),(0,i.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.transactionCount.toLocaleString()}),(0,i.jsxs)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:[e.marketShare.toFixed(2),"%"]}),(0,i.jsx)("td",{className:"px-4 py-3 font-mono text-cyan-400",children:e.averagePrice.toFixed(1)}),(0,i.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.minPrice.toFixed(1)}),(0,i.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.maxPrice.toFixed(1)}),(0,i.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-400",children:e.medianPrice.toFixed(1)}),(0,i.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-400",children:e.avgParkingPrice>0?e.avgParkingPrice.toLocaleString():"-"})]},t))}),(0,i.jsx)("tfoot",{className:"bg-zinc-900/80 font-bold border-t-2 border-zinc-700",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{colSpan:2,className:"px-4 py-3 text-center text-zinc-300",children:"總計"}),(0,i.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:M.totalSaleAmount.toLocaleString()}),(0,i.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:M.totalHouseArea.toLocaleString()}),(0,i.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:M.transactionCount.toLocaleString()}),(0,i.jsx)("td",{colSpan:6})]})})]})}),(0,i.jsxs)("div",{className:"flex items-center justify-between mt-4 border-t border-white/5 pt-4",children:[(0,i.jsxs)("div",{className:"text-sm text-zinc-500",children:["顯示 ",(N-1)*w+1," 到 ",Math.min(N*w,F.length)," 筆，共 ",F.length," 筆"]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(c.$,{variant:"outline",size:"sm",onClick:()=>y(e=>Math.max(1,e-1)),disabled:1===N,children:(0,i.jsx)(u.A,{size:16})}),(0,i.jsxs)("span",{className:"text-sm text-zinc-300",children:["Page ",N," of ",L]}),(0,i.jsx)(c.$,{variant:"outline",size:"sm",onClick:()=>y(e=>Math.min(L,e+1)),disabled:N===L,children:(0,i.jsx)(b.A,{size:16})})]})]})]})]})}},68605:(e,t,s)=>{s.d(t,{c:()=>n});var i=s(95155);s(12115);var a=s(40980);function n({title:e,description:t,children:s,headerAction:n,className:r}){return(0,i.jsxs)("div",{className:(0,a.cn)("bg-zinc-900/50 border border-white/5 rounded-2xl p-4 md:p-6 backdrop-blur-sm",r),children:[(0,i.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:e}),t&&(0,i.jsx)("p",{className:"text-zinc-400 text-sm mt-1",children:t})]}),n&&(0,i.jsx)("div",{className:"flex-shrink-0 w-full md:w-auto overflow-x-auto",children:n})]}),s]})}},75444:(e,t,s)=>{s.d(t,{P:()=>u});var i=s(95155),a=s(12115),n=s(68605),r=s(826),l=s(97085);function c({roomTypes:e,locations:t,crossTable:s,dimension:n}){let r=(0,a.useMemo)(()=>e&&t&&s?e.map(e=>{let i=t.map(t=>s[e]&&s[e][t]||0);return{name:e,data:i}}):[],[e,t,s]),c=(0,a.useMemo)(()=>{let e="county"===n?"縣市":"行政區";return{chart:{type:"bar",height:Math.max(350,35*t.length),stacked:!0,background:"transparent",toolbar:{show:!0},foreColor:"#e5e7eb"},plotOptions:{bar:{horizontal:!0,barHeight:"70%",borderRadius:4,dataLabels:{total:{enabled:!0,offsetX:5,style:{fontSize:"11px",fontWeight:600,color:"#e5e7eb"},formatter:function(e,t){let s=t.w.config.series,i=t.dataPointIndex,a=0;return s.forEach(e=>{a+=e.data[i]||0}),a>0?a.toString():""}}}}},colors:["#06b6d4","#8b5cf6","#10b981","#f59e0b","#ef4444","#3b82f6","#ec4899","#84cc16","#6366f1","#14b8a6"],dataLabels:{enabled:!1},xaxis:{categories:t,title:{text:"成交筆數",style:{color:"#9ca3af"}},labels:{style:{colors:"#9ca3af"}}},yaxis:{title:{text:e,style:{color:"#9ca3af"}},labels:{style:{colors:"#e5e7eb"},maxWidth:150}},legend:{position:"top",horizontalAlign:"center",labels:{colors:"#e5e7eb"}},tooltip:{theme:"dark",y:{formatter:function(e){return e+" 筆"}}},grid:{borderColor:"#374151"},title:{text:`各${e}房型成交筆數分佈`,align:"center",style:{fontSize:"16px",color:"#e5e7eb"}}}},[t,n]);return r&&0!==r.length?(0,i.jsx)(l.A,{type:"bar",series:r,options:c,height:c.chart?.height||350,className:"w-full"}):(0,i.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無區域分佈資料"})}var o=s(33210),d=s(40980);function x({isOpen:e,onClose:t,title:s,projects:n}){let r=(0,a.useRef)(null);return((0,a.useEffect)(()=>{let s=e=>{"Escape"===e.key&&t()};return e&&(document.addEventListener("keydown",s),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",s),document.body.style.overflow=""}},[e,t]),e)?(0,i.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",onClick:e=>{r.current&&!r.current.contains(e.target)&&t()},children:(0,i.jsxs)("div",{ref:r,className:"bg-zinc-900 border border-white/10 rounded-xl shadow-2xl max-w-md w-full mx-4 animate-in zoom-in-95 duration-200",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between px-5 py-4 border-b border-white/5",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-white",children:s}),(0,i.jsx)("button",{onClick:t,className:"p-1 rounded hover:bg-white/10 text-zinc-400 hover:text-white transition-colors",children:(0,i.jsx)(o.A,{size:20})})]}),(0,i.jsx)("div",{className:"px-5 py-4 max-h-[50vh] overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-700",children:0===n.length?(0,i.jsx)("p",{className:"text-zinc-500 text-center py-4",children:"無建案資料"}):(0,i.jsx)("ul",{className:"space-y-2",children:n.map((e,t)=>(0,i.jsx)("li",{className:(0,d.cn)("px-3 py-2 rounded-lg text-zinc-200 text-sm","bg-zinc-800/50 hover:bg-zinc-800 transition-colors","border border-white/5"),children:e},t))})}),(0,i.jsxs)("div",{className:"px-5 py-3 border-t border-white/5 flex justify-between items-center",children:[(0,i.jsxs)("span",{className:"text-xs text-zinc-500",children:["共 ",n.length," 個建案"]}),(0,i.jsx)("button",{onClick:t,className:"px-4 py-1.5 text-sm rounded-lg bg-zinc-800 text-zinc-300 hover:bg-zinc-700 transition-colors",children:"關閉"})]})]})}):null}var m=s(78795),h=s(88743),p=s(48551);function u({data:e,visibleSections:t=["chart","table","location-table","location-chart"]}){let{selectedRoomTypes:s,setSelectedRoomTypes:l}=(0,h.P)(),o=["套房","1房","2房","3房","4房","毛胚"],[u,b]=(0,a.useState)("district"),[f,j]=(0,a.useState)(!1),[g,v]=(0,a.useState)(""),[N,y]=(0,a.useState)([]),[w,z]=(0,a.useState)(null),k=(0,a.useMemo)(()=>{if(!e?.transactionDetails)return[];let t=new Set;return e.transactionDetails.forEach(e=>{e["縣市"]&&t.add(e["縣市"])}),Array.from(t).sort()},[e?.transactionDetails]);a.useEffect(()=>{!w&&k.length>0&&z(k[0])},[k,w]);let S=(e,t,s)=>{v(`${e}${null!==t?` / ${t}衛`:""} 建案組成`),y(s),j(!0)};if(!e||!e.details||0===e.details.length)return null;let{details:P,locationCrossTable:A,allDistricts:C,transactionDetails:_}=e,M=(0,a.useMemo)(()=>P.filter(e=>s.includes(e.roomType)),[P,s]),[$,T]=(0,a.useState)(!0),F=(0,a.useMemo)(()=>{let e=P.filter(e=>s.includes(e.roomType));if(!$)return e;let t=new Map;return e.forEach(e=>{let s=e.roomType;t.has(s)||t.set(s,{...e,bathrooms:null,projectNames:e.projectNames?[...e.projectNames]:[],count:0,avgPrice:0});let i=t.get(s),a=i.avgPrice*i.count,n=e.avgPrice*e.count,r=i.count+e.count;i.count=r,i.avgPrice=r>0?(a+n)/r:0,i.minPrice=Math.min(i.minPrice,e.minPrice),i.maxPrice=Math.max(i.maxPrice,e.maxPrice);let l=i.count-e.count,c=e.count;if(i.medianPrice=(i.medianPrice*l+e.medianPrice*c)/r,i.q1Price=(i.q1Price*l+e.q1Price*c)/r,i.q3Price=(i.q3Price*l+e.q3Price*c)/r,e.projectNames){let t=new Set([...i.projectNames||[],...e.projectNames]);i.projectNames=Array.from(t)}}),Array.from(t.values()).sort((e,t)=>o.indexOf(e.roomType)-o.indexOf(t.roomType))},[P,s,$,o]),L=(0,a.useMemo)(()=>{if("county"===u&&_){let e={},t=new Set;_.forEach(s=>{let i=s["房型"]||s.roomType||s["戶型"];if(!i||"其他"===i){let e=Number(s["房數"]);i=!isNaN(e)&&e>0?`${e}房`:"其他"}let a="string"==typeof i?i.replace(/\s+/g,""):i;("number"==typeof a||"string"==typeof a&&/^\d+$/.test(a))&&(a=`${a}房`);let n=s["縣市"]||"未知";e[a]||(e[a]={}),e[a][n]=(e[a][n]||0)+1,t.add(n)});let i=Array.from(t).sort(),a={},n=0;i.forEach(e=>a[e]=0);let r=s.map(t=>{let s=e[t]||{},r=0,l=i.map(e=>{let t=s[e]||0;return r+=t,a[e]+=t,t});return n+=r,{roomType:t,cells:l,rowTotal:r}});return{locations:i,rows:r,locationTotals:a,grandTotal:n}}if("district"===u){let e={},t=new Set;if(_)_.forEach(s=>{let i=s["房型"]||s.roomType||s["戶型"];if(!i||"其他"===i){let e=Number(s["房數"]);i=!isNaN(e)&&e>0?`${e}房`:"其他"}let a="string"==typeof i?i.replace(/\s+/g,""):i;("number"==typeof a||"string"==typeof a&&/^\d+$/.test(a))&&(a=`${a}房`);let n=s["行政區"]||"未知",r=s["縣市"]||"未知";w&&r!==w||(e[a]||(e[a]={}),e[a][n]=(e[a][n]||0)+1,t.add(n))});else if(A){let i=new Set;s.forEach(e=>{let t=A[e];t&&Object.keys(t).forEach(e=>i.add(e))}),i.forEach(e=>t.add(e)),s.forEach(t=>{let s=A[t];s&&(e[t]=s)})}let i=Array.from(t).sort(),a={},n=0;i.forEach(e=>a[e]=0);let r=s.map(t=>{let s=e[t]||{},r=0,l=i.map(e=>{let t=s[e]||0;return r+=t,a[e]+=t,t});return n+=r,{roomType:t,cells:l,rowTotal:r}});return{locations:i,rows:r,locationTotals:a,grandTotal:n}}return null},[A,_,s,u,w]),[E,D]=(0,a.useState)(new Set),R=(0,a.useMemo)(()=>L?L.rows.map(e=>{let t={房型:e.roomType};return L.locations.forEach((s,i)=>{t[s]=e.cells[i]}),t["總計"]=e.rowTotal,t}):[],[L]),O=e=>P.filter(t=>t.roomType===e).sort((e,t)=>(Number(e.bathrooms)||0)-(Number(t.bathrooms)||0)),q=(0,a.useMemo)(()=>{if(!$)return F;let e=[];return F.forEach(t=>{if(e.push(t),E.has(t.roomType)){let s=O(t.roomType);e.push(...s)}}),e},[F,$,E,P]);return(0,i.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,i.jsxs)("div",{id:"room-type-filter-anchor",className:"p-4 bg-zinc-900/30 border border-white/5 rounded-lg flex flex-col sm:flex-row sm:flex-wrap items-start sm:items-center justify-between gap-3 sm:gap-4 scroll-mt-24",children:[(0,i.jsxs)("div",{className:"w-full sm:w-auto flex flex-wrap items-center gap-2",children:[(0,i.jsx)("span",{className:"text-zinc-400 text-sm whitespace-nowrap shrink-0 mr-1",children:"分析房型:"}),(0,i.jsx)("div",{className:"flex flex-wrap gap-1.5 sm:gap-2",children:h.M.map(e=>(0,i.jsx)("button",{onClick:()=>{l(s.includes(e)?s.filter(t=>t!==e):[...s,e])},className:(0,d.cn)("px-3 py-1 rounded-full text-xs font-medium transition-colors border",s.includes(e)?"bg-violet-500/20 border-violet-500 text-violet-200":"bg-zinc-800 border-zinc-700 text-zinc-500 hover:bg-zinc-700"),children:e},e))})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2 bg-zinc-800/50 p-1 rounded-lg border border-white/5 ml-auto sm:ml-0",children:[(0,i.jsx)("span",{className:"text-xs text-zinc-400 pl-2",children:"表格顯示:"}),(0,i.jsx)("button",{onClick:()=>T(!$),className:(0,d.cn)("px-3 py-1 text-xs font-medium rounded-md transition-all whitespace-nowrap",$?"bg-violet-500 text-white shadow-sm":"text-zinc-400 hover:text-white hover:bg-zinc-700"),children:$?"依房型合併":"顯示衛浴細節"})]})]}),t.includes("chart")&&(0,i.jsx)(n.c,{title:"各房型總價帶分佈箱型圖",description:"顯示各房型總價的中位數與四分位距",headerAction:(0,i.jsx)(m.N,{data:F,filename:"price_band_chart_data",label:"匯出",chartType:"price-band-chart",snapshotData:F,columns:{roomType:"房型",bathrooms:"衛浴",minPrice:"最低價",q1Price:"Q1",medianPrice:"中位數",q3Price:"Q3",maxPrice:"最高價",avgPrice:"平均價",count:"筆數"}}),children:(0,i.jsx)(r.B,{data:F})}),t.includes("table")&&(0,i.jsx)(n.c,{title:"總價帶詳細數據",description:$?"各房型合併統計 (點擊「全部」可展開細節)":"各房型詳細價格統計",headerAction:(0,i.jsx)(m.N,{data:q,filename:"price_band_detail_data",label:"匯出",chartType:"price-band-table",snapshotData:q,columns:{roomType:"房型",bathrooms:"衛浴",minPrice:"最低價",q1Price:"Q1",medianPrice:"中位數",q3Price:"Q3",maxPrice:"最高價",avgPrice:"平均價",count:"筆數"}}),children:(0,i.jsx)("div",{className:"overflow-x-auto",children:(0,i.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,i.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"px-4 py-3",children:"房型"}),(0,i.jsx)("th",{className:"px-4 py-3",children:"衛浴"}),(0,i.jsx)("th",{className:"px-4 py-3 whitespace-nowrap min-w-[100px]",children:"建案數"}),(0,i.jsx)("th",{className:"px-4 py-3 whitespace-nowrap",children:"筆數"}),(0,i.jsx)("th",{className:"px-4 py-3 whitespace-nowrap",children:"平均總價"}),(0,i.jsx)("th",{className:"px-4 py-3",children:"最低總價"}),(0,i.jsx)("th",{className:"px-4 py-3",children:"1/4位總價"}),(0,i.jsx)("th",{className:"px-4 py-3 text-violet-400",children:"中位數總價"}),(0,i.jsx)("th",{className:"px-4 py-3",children:"3/4位總價"}),(0,i.jsx)("th",{className:"px-4 py-3",children:"最高總價"})]})}),(0,i.jsxs)("tbody",{className:"divide-y divide-white/5",children:[F.map((e,t)=>{let s=$&&null===e.bathrooms,n=E.has(e.roomType),r=s&&n?O(e.roomType):[];return(0,i.jsxs)(a.Fragment,{children:[(0,i.jsxs)("tr",{className:(0,d.cn)("hover:bg-zinc-800/50 transition-colors",n&&"bg-zinc-800/30"),children:[(0,i.jsx)("td",{className:"px-4 py-3 font-medium text-white",children:e.roomType}),(0,i.jsx)("td",{className:"px-4 py-3 text-zinc-400",children:s?(0,i.jsxs)("button",{onClick:()=>{var t;return t=e.roomType,void D(e=>{let s=new Set(e);return s.has(t)?s.delete(t):s.add(t),s})},className:"flex items-center gap-1 text-xs px-2 py-0.5 rounded bg-zinc-700/50 hover:bg-zinc-600 hover:text-white transition-colors cursor-pointer",children:[(0,i.jsx)("span",{children:"全部"}),(0,i.jsx)("span",{className:(0,d.cn)("transform transition-transform text-[10px]",n?"rotate-180":""),children:"▼"})]}):e.bathrooms??"-"}),(0,i.jsx)("td",{className:"px-4 py-3",children:e.projectNames&&e.projectNames.length>0?(0,i.jsxs)("button",{onClick:()=>S(e.roomType,e.bathrooms,e.projectNames||[]),className:"px-2 py-1 text-xs font-medium rounded-full bg-violet-500/20 border border-violet-500/50 text-violet-300 hover:bg-violet-500/30 transition-colors cursor-pointer whitespace-nowrap",children:[e.projectNames.length," 建案"]}):(0,i.jsx)("span",{className:"text-zinc-500",children:"-"})}),(0,i.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:e.count.toLocaleString()}),(0,i.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.avgPrice.toLocaleString(void 0,{maximumFractionDigits:0})}),(0,i.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.minPrice.toLocaleString()}),(0,i.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.q1Price.toLocaleString()}),(0,i.jsx)("td",{className:"px-4 py-3 font-mono text-violet-400 font-bold",children:e.medianPrice.toLocaleString()}),(0,i.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.q3Price.toLocaleString()}),(0,i.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.maxPrice.toLocaleString()})]}),r.map((e,s)=>(0,i.jsxs)("tr",{className:"bg-zinc-900/50 hover:bg-zinc-900 border-l-2 border-l-violet-500/30",children:[(0,i.jsxs)("td",{className:"px-4 py-2 font-medium text-zinc-500 text-xs pl-8",children:["↳ ",e.roomType]}),(0,i.jsxs)("td",{className:"px-4 py-2 text-zinc-400 text-xs",children:[e.bathrooms," 衛"]}),(0,i.jsx)("td",{className:"px-4 py-2",children:e.projectNames&&e.projectNames.length>0?(0,i.jsxs)("button",{onClick:()=>S(e.roomType,e.bathrooms,e.projectNames||[]),className:"text-xs text-zinc-500 hover:text-zinc-300 underline decoration-zinc-700",children:[e.projectNames.length," 建案"]}):"-"}),(0,i.jsx)("td",{className:"px-4 py-2 text-zinc-500 text-xs",children:e.count.toLocaleString()}),(0,i.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-500 text-xs",children:e.avgPrice.toLocaleString(void 0,{maximumFractionDigits:0})}),(0,i.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.minPrice.toLocaleString()}),(0,i.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.q1Price.toLocaleString()}),(0,i.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-500 text-xs font-medium",children:e.medianPrice.toLocaleString()}),(0,i.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.q3Price.toLocaleString()}),(0,i.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.maxPrice.toLocaleString()})]},`${t}-sub-${s}`))]},t)}),0===M.length&&(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:10,className:"p-8 text-center text-zinc-500",children:"請選擇房型顯示數據"})})]})]})})}),(L||_)&&(0,i.jsxs)("div",{className:"space-y-6 pt-4 border-t border-white/5",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-white",children:"區域分組交叉分析"}),(0,i.jsxs)("div",{className:"flex bg-zinc-800 rounded-md p-0.5",children:[(0,i.jsx)("button",{onClick:()=>b("district"),className:(0,d.cn)("px-2 py-1 text-xs rounded transition-colors","district"===u?"bg-zinc-700 text-white":"text-zinc-400 hover:text-white"),children:"行政區"}),(0,i.jsx)("button",{onClick:()=>b("county"),className:(0,d.cn)("px-2 py-1 text-xs rounded transition-colors","county"===u?"bg-zinc-700 text-white":"text-zinc-400 hover:text-white"),children:"縣市"})]})]}),"district"===u&&k.length>1&&(0,i.jsxs)("div",{className:"flex items-center gap-2 pb-2",children:[(0,i.jsx)("span",{className:"text-sm text-zinc-500",children:"顯示縣市:"}),(0,i.jsx)("div",{className:"flex gap-1 bg-zinc-900 p-1 rounded-lg",children:k.map(e=>(0,i.jsx)("button",{onClick:()=>z(e),className:(0,d.cn)("px-3 py-1 text-xs font-medium rounded-md transition-all",w===e?"bg-violet-500/20 text-violet-300 shadow-sm border border-violet-500/50":"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800"),children:e},e))})]}),t.includes("location-table")&&(0,i.jsx)(n.c,{title:"區域房型成交分佈",description:"各區域不同房型的成交數量熱力分佈",headerAction:(0,i.jsx)(m.N,{data:R,filename:"price_band_location_cross_table",label:"匯出",chartType:"price-band-location-table",snapshotData:L}),children:(0,i.jsx)("div",{className:"overflow-x-auto",children:L?(0,i.jsxs)("table",{className:"w-full text-sm text-left border-collapse",children:[(0,i.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 font-semibold",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"px-3 py-2 sticky left-0 bg-zinc-900 z-10 border-r border-white/5",children:"房型"}),L.locations.map(e=>(0,i.jsx)("th",{className:"px-3 py-2 text-center min-w-[80px]",children:e},e)),(0,i.jsx)("th",{className:"px-3 py-2 text-center border-l border-white/5 bg-zinc-900 font-bold text-white",children:"總計"})]})}),(0,i.jsx)("tbody",{className:"divide-y divide-white/5",children:L.rows.map((e,t)=>(0,i.jsxs)("tr",{className:"hover:bg-zinc-800/30",children:[(0,i.jsx)("td",{className:"px-3 py-2 font-medium text-zinc-300 sticky left-0 bg-zinc-950/90 border-r border-white/5",children:e.roomType}),e.cells.map((e,t)=>{let s=e>0?Math.min(e/20,1):0,a=e>0?{backgroundColor:`rgba(6, 182, 212, ${.3*s})`}:{};return(0,i.jsx)("td",{className:"px-3 py-2 text-center text-zinc-400",style:a,children:e>0?e:"-"},t)}),(0,i.jsx)("td",{className:"px-3 py-2 text-center font-bold text-white border-l border-white/5 bg-zinc-900/50",children:e.rowTotal})]},t))}),(0,i.jsx)("tfoot",{className:"bg-zinc-900 font-bold border-t-2 border-zinc-700",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{className:"px-3 py-2 sticky left-0 bg-zinc-900 border-r border-white/5 text-white",children:"總計"}),L.locations.map(e=>(0,i.jsx)("td",{className:"px-3 py-2 text-center text-white",children:L.locationTotals[e]},e)),(0,i.jsx)("td",{className:"px-3 py-2 text-center text-cyan-400 border-l border-white/5 bg-zinc-900",children:L.grandTotal})]})})]}):(0,i.jsx)("div",{className:"p-8 text-center text-zinc-500",children:"無區域分佈數據"})})}),t.includes("location-chart")&&(0,i.jsx)(n.c,{title:"區域成交佔比圖表",headerAction:(0,i.jsx)(m.N,{data:R,filename:"price_band_location_chart_data",label:"匯出",chartType:"price-band-location-chart",snapshotData:L}),children:L&&(0,i.jsx)(c,{roomTypes:s,locations:L.locations,crossTable:L.rows.reduce((e,t)=>{let s={};return L.locations.forEach((e,i)=>{s[e]=t.cells[i]}),e[t.roomType]=s,e},{}),dimension:u})})]}),(0,i.jsx)(x,{isOpen:f,onClose:()=>j(!1),title:g,projects:N}),(0,i.jsx)(x,{isOpen:f,onClose:()=>j(!1),title:g,projects:N}),(0,i.jsx)(p.K,{})]})}},78795:(e,t,s)=>{s.d(t,{N:()=>z});var i=s(95155),a=s(98500),n=s.n(a),r=s(12115),l=s(73321),c=s(6296),o=s(25777),d=s(6962),x=s(66088),m=s(95057),h=s(89239),p=s(16385),u=s(96066),b=s(70872),f=s(57223),j=s(40980);function g({...e}){return(0,i.jsx)(f.bL,{"data-slot":"dropdown-menu",...e})}function v({...e}){return(0,i.jsx)(f.l9,{"data-slot":"dropdown-menu-trigger",...e})}function N({className:e,sideOffset:t=4,...s}){return(0,i.jsx)(f.ZL,{children:(0,i.jsx)(f.UC,{"data-slot":"dropdown-menu-content",sideOffset:t,className:(0,j.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",e),...s})})}function y({className:e,inset:t,variant:s="default",...a}){return(0,i.jsx)(f.q7,{"data-slot":"dropdown-menu-item","data-inset":t,"data-variant":s,className:(0,j.cn)("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...a})}var w=s(66609);function z({data:e,filename:t="export",label:s="匯出",className:a,disabled:f=!1,columns:z,chartType:k,snapshotData:S}){let{role:P,isLoading:A}=function(){let[e,t]=(0,r.useState)(null),[s,i]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let e=!0,s=async()=>{try{let{data:{session:s}}=await p.N.auth.getSession();if(!s?.user){e&&(t(null),i(!1));return}let{data:a,error:n}=await p.N.from("profiles").select("role").eq("id",s.user.id).single();e&&(a?t(a.role):t("user"),i(!1))}catch(s){console.error("Error fetching user role:",s),e&&(t("user"),i(!1))}};s();let{data:{subscription:a}}=p.N.auth.onAuthStateChange((e,i)=>{i?s():t(null)});return()=>{e=!1,a.unsubscribe()}},[]),{role:e,isLoading:s}}(),C=(0,l.useRouter)(),_=(0,u.Q)(e=>e.addItem),M=["pro","pro_max","admin","super_admin"].includes(P||""),$=!A,T=()=>{if($&&M){if(!e||0===e.length)return void alert("無數據可導出");try{let s=Object.keys(e[0]),i=[s.map(e=>z&&z[e]||e).join(","),...e.map(e=>s.map(t=>{let s=e[t];if(null==s)return"";if("number"==typeof s){let e=z&&z[t]||t;return/Area|坪|Rate|Ratio|Share|Percent|比|率/.test(t)||/Area|坪|Rate|Ratio|Share|Percent|比|率/.test(e)?s.toFixed(2):Math.round(s).toFixed(0)}if("object"==typeof s)try{return`"${JSON.stringify(s).replace(/"/g,'""')}"`}catch(e){return""}return"string"==typeof s?`"${s.replace(/"/g,'""').replace(/\n/g," ")}"`:s}).join(","))].join("\n"),a=new Blob(["\uFEFF"+i],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(a),r=document.createElement("a"),l=new Date().toISOString().split("T")[0],c=`${t}_${l}.csv`;r.href=n,r.setAttribute("download",c),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}catch(e){console.error("Export failed:",e),alert("匯出失敗，請查看控制台日誌")}}};return A?(0,i.jsxs)(h.$,{variant:"outline",size:"sm",disabled:!0,className:`gap-2 border-dashed border-zinc-700 bg-zinc-900/50 text-zinc-600 ${a}`,children:[(0,i.jsx)(c.A,{className:"h-4 w-4 animate-spin"}),(0,i.jsx)("span",{className:"hidden sm:inline",children:"載入中..."})]}):k?(0,i.jsx)(b.Bc,{children:(0,i.jsxs)(b.m_,{delayDuration:0,children:[(0,i.jsx)(b.k$,{asChild:!0,children:(0,i.jsx)("span",{className:"inline-flex",tabIndex:M?-1:0,children:M?(0,i.jsxs)(g,{children:[(0,i.jsx)(v,{asChild:!0,children:(0,i.jsxs)(h.$,{variant:"outline",size:"sm",disabled:f||!e||0===e.length,className:(0,j.cn)("gap-1.5 border-dashed transition-all border-zinc-700 bg-zinc-900/50 hover:bg-zinc-800 text-zinc-400 hover:text-white",a),children:[(0,i.jsx)(d.A,{className:"h-4 w-4"}),(0,i.jsx)("span",{className:"hidden sm:inline",children:s}),(0,i.jsx)(x.A,{className:"h-3 w-3"})]})}),(0,i.jsxs)(N,{align:"start",className:"min-w-[180px] bg-zinc-900 border-zinc-700",children:[(0,i.jsxs)(y,{onClick:T,className:"flex items-center gap-2 text-zinc-300 hover:text-white focus:text-white cursor-pointer",children:[(0,i.jsx)(d.A,{className:"h-4 w-4 text-zinc-500"}),"匯出 CSV"]}),(0,i.jsxs)(y,{onClick:()=>{M&&k&&(_(k,void 0!==S?S:e),w.o.success("已新增至報表編輯器",{description:"請點選左側「生成報告」繼續編輯",action:{label:"前往編輯",onClick:()=>C.push("/reports/builder")}}))},className:"flex items-center gap-2 text-zinc-300 hover:text-violet-300 focus:text-violet-300 hover:bg-violet-600/20 focus:bg-violet-600/20 cursor-pointer",children:[(0,i.jsx)(m.A,{className:"h-4 w-4 text-violet-500"}),"新增到報表編輯器"]})]})]}):(0,i.jsxs)(h.$,{variant:"outline",size:"sm",disabled:!0,className:(0,j.cn)("gap-1.5 border-dashed transition-all border-zinc-800 bg-zinc-900/30 text-zinc-600 cursor-not-allowed hover:bg-zinc-900/30",a),children:[(0,i.jsx)(o.A,{className:"h-3 w-3"}),(0,i.jsx)("span",{className:"hidden sm:inline",children:s})]})})}),!M&&(0,i.jsx)(b.ZI,{className:"bg-zinc-950 border border-zinc-800 p-0 overflow-hidden",children:(0,i.jsxs)("div",{className:"flex flex-col gap-1 items-center p-3",children:[(0,i.jsx)("p",{className:"font-medium text-zinc-200",children:"Pro 會員限定功能"}),(0,i.jsx)(n(),{href:"/pricing",className:"text-xs text-violet-400 hover:text-violet-300 underline underline-offset-2 transition-colors flex items-center gap-1",children:"查看升級方案 →"})]})})]})}):(0,i.jsx)(b.Bc,{children:(0,i.jsxs)(b.m_,{delayDuration:0,children:[(0,i.jsx)(b.k$,{asChild:!0,children:(0,i.jsx)("span",{className:"inline-flex",tabIndex:M?-1:0,children:(0,i.jsxs)(h.$,{variant:"outline",size:"sm",onClick:T,disabled:f||M&&(!e||0===e.length),className:(0,j.cn)("gap-1.5 border-dashed transition-all",M?"border-zinc-700 bg-zinc-900/50 hover:bg-zinc-800 text-zinc-400 hover:text-white":"border-zinc-800 bg-zinc-900/30 text-zinc-600 cursor-not-allowed hover:bg-zinc-900/30",a),children:[M?(0,i.jsx)(d.A,{className:"h-4 w-4"}):(0,i.jsx)(o.A,{className:"h-3 w-3"}),(0,i.jsx)("span",{className:"hidden sm:inline",children:s})]})})}),!M&&(0,i.jsx)(b.ZI,{className:"bg-zinc-950 border border-zinc-800 p-0 overflow-hidden",children:(0,i.jsxs)("div",{className:"flex flex-col gap-1 items-center p-3",children:[(0,i.jsx)("p",{className:"font-medium text-zinc-200",children:"Pro 會員限定功能"}),(0,i.jsx)(n(),{href:"/pricing",className:"text-xs text-violet-400 hover:text-violet-300 underline underline-offset-2 transition-colors flex items-center gap-1",children:"查看升級方案 →"})]})})]})})}},83632:(e,t,s)=>{s.d(t,{U:()=>x});var i=s(95155),a=s(12115),n=s(68605),r=s(88042),l=s(98563),c=s(40980);function o({data:e}){if(!e||0===e.length)return(0,i.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無符合條件的建案可進行類型比較"});let t=Math.max(...e.map(e=>e.shopMultiple),1),s=Math.max(...e.map(e=>e.officeMultiple),1);return(0,i.jsx)("div",{className:"overflow-x-auto max-h-[600px] overflow-y-auto relative scrollbar-thin scrollbar-thumb-zinc-700 scrollbar-track-transparent",children:(0,i.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,i.jsx)("thead",{className:"sticky top-0 z-10 bg-zinc-900 text-zinc-400 font-semibold uppercase text-xs shadow-md",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"px-4 py-3 whitespace-nowrap",children:"建案名稱"}),(0,i.jsx)("th",{className:"px-4 py-3 text-right",children:"住宅均價"}),(0,i.jsxs)("th",{className:"px-4 py-3 text-right",children:["店舖均價 ",(0,i.jsx)("span",{className:"text-[10px] text-zinc-500 font-normal ml-1",children:"/ 倍數"})]}),(0,i.jsxs)("th",{className:"px-4 py-3 text-right",children:["事務所均價 ",(0,i.jsx)("span",{className:"text-[10px] text-zinc-500 font-normal ml-1",children:"/ 倍數"})]})]})}),(0,i.jsx)("tbody",{className:"divide-y divide-white/5",children:e.map((e,a)=>(0,i.jsxs)("tr",{className:"hover:bg-zinc-800/30 transition-colors",children:[(0,i.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap",children:[(0,i.jsx)("div",{className:"font-medium text-white",children:e.projectName}),(0,i.jsxs)("div",{className:"text-xs text-zinc-500 flex gap-1 mt-0.5",children:[e.county&&(0,i.jsx)("span",{className:"bg-zinc-800 px-1 rounded",children:e.county}),e.district&&(0,i.jsx)("span",{className:"bg-zinc-800 px-1 rounded",children:e.district})]})]}),(0,i.jsx)("td",{className:"px-4 py-3 text-right font-mono text-zinc-300",children:e.residentialAvg>0?(0,c.Z)(e.residentialAvg):"-"}),(0,i.jsxs)("td",{className:"px-4 py-3 text-right",children:[(0,i.jsx)("div",{className:"font-mono text-zinc-300",children:e.shopAvg>0?(0,c.Z)(e.shopAvg):"-"}),e.shopMultiple>0&&(0,i.jsxs)("div",{className:"flex flex-col gap-1 mt-1.5 w-[80px] ml-auto",children:[(0,i.jsx)("div",{className:"h-1 bg-zinc-800 rounded-full overflow-hidden w-full",children:(0,i.jsx)("div",{className:"h-full bg-violet-600 rounded-full",style:{width:`${Math.min(e.shopMultiple/t*100,100)}%`}})}),(0,i.jsxs)("div",{className:"text-[10px] text-right text-violet-400 font-medium",children:[e.shopMultiple.toFixed(2),"x"]})]})]}),(0,i.jsxs)("td",{className:"px-4 py-3 text-right",children:[(0,i.jsx)("div",{className:"font-mono text-zinc-300",children:e.officeAvg>0?(0,c.Z)(e.officeAvg):"-"}),e.officeMultiple>0&&(0,i.jsxs)("div",{className:"flex flex-col gap-1 mt-1.5 w-[80px] ml-auto",children:[(0,i.jsx)("div",{className:"h-1 bg-zinc-800 rounded-full overflow-hidden w-full",children:(0,i.jsx)("div",{className:"h-full bg-cyan-600 rounded-full",style:{width:`${Math.min(e.officeMultiple/s*100,100)}%`}})}),(0,i.jsxs)("div",{className:"text-[10px] text-right text-cyan-400 font-medium",children:[e.officeMultiple.toFixed(2),"x"]})]})]})]},a))})]})})}var d=s(78795);function x({data:e,visibleSections:t=["stats","comparison","chart"]}){let[s,x]=(0,a.useState)("weighted"),[m,h]=(0,a.useState)(30),[p,u]=(0,a.useState)(150),[b,f]=(0,a.useState)(5),[j,g]=(0,a.useState)("count"),v=e?.transactionDetails||[],N=e?.unitPriceAnalysis,y=N?.residentialStats,w=N?.officeStats,z=N?.storeStats,k=N?.typeComparison;return e&&(v.length||N)?(0,i.jsxs)("div",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[t.includes("stats")&&(0,i.jsx)(n.c,{title:"各用途單價統計",headerAction:(0,i.jsxs)("div",{className:"flex items-center gap-4",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("span",{className:"text-zinc-400 text-xs",children:"平均類型:"}),(0,i.jsxs)("div",{className:"flex bg-zinc-950/50 rounded-md p-1 border border-white/5",children:[(0,i.jsx)("button",{onClick:()=>x("arithmetic"),className:(0,c.cn)("px-2 py-0.5 text-[10px] rounded transition-colors","arithmetic"===s?"bg-violet-500 text-white":"text-zinc-500 hover:text-white"),children:"算術"}),(0,i.jsx)("button",{onClick:()=>x("weighted"),className:(0,c.cn)("px-2 py-0.5 text-[10px] rounded transition-colors","weighted"===s?"bg-violet-500 text-white":"text-zinc-500 hover:text-white"),children:"加權"})]})]}),(0,i.jsx)(d.N,{data:[y,w,z],filename:"unit_price_stats",label:"匯出",chartType:"unit-price-stats",snapshotData:{residentialStats:y,officeStats:w,storeStats:z,averageType:s}})]}),children:(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,i.jsx)(l.E,{title:"住宅建案統計",stats:y,noDataMessage:"無住宅交易數據",className:"border-violet-500/20",averageType:s}),(0,i.jsx)(l.E,{title:"一般事務所/辦公室統計",stats:w,noDataMessage:"無事務所/辦公室交易數據",className:"border-cyan-500/20",averageType:s}),(0,i.jsx)(l.E,{title:"店舖統計",stats:z,noDataMessage:"無店舖交易數據",className:"border-amber-500/20",averageType:s})]})}),(0,i.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6 items-stretch",children:[t.includes("comparison")&&k&&k.length>0&&(0,i.jsx)("div",{className:"flex-1 min-w-0 flex flex-col",children:(0,i.jsx)(n.c,{title:"建案產品類型單價比較",description:"同一建案內不同用途（住宅/店面/事務所）的單價與倍數比較",headerAction:(0,i.jsx)(d.N,{data:k,filename:"type_comparison_data",label:"匯出",chartType:"type-comparison-table",snapshotData:k,columns:{projectName:"建案",residentialAvg:"住宅均價",officeAvg:"辦公均價",storeAvg:"店舖均價",officeRatio:"辦公倍數",storeRatio:"店舖倍數"}}),className:"h-full",children:(0,i.jsx)(o,{data:k})})}),t.includes("chart")&&(0,i.jsx)("div",{className:"flex-1 min-w-0 flex flex-col",children:(0,i.jsx)(n.c,{title:"單價分佈泡泡圖",description:"分析各單價區間的成交熱度與分佈密集區",headerAction:(0,i.jsx)(d.N,{data:v,filename:"bubble_chart_source_data",label:"匯出",chartType:"unit-price-bubble",snapshotData:v}),className:"h-full",children:(0,i.jsx)(r.$,{data:v,minPrice:m,maxPrice:p,interval:b,sizeMetric:j,onMinPriceChange:h,onMaxPriceChange:u,onIntervalChange:f,onSizeMetricChange:g})})})]})]}):null}}}]);