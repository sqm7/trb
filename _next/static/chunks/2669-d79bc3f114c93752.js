"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2669],{29991:(e,t,r)=>{r.d(t,{l:()=>l});var n=r(95155),a=r(12115),i=r(40980),s=r(66088);let l=a.forwardRef(({className:e,children:t,...r},a)=>(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("select",{className:(0,i.cn)("flex h-10 w-full appearance-none rounded-md border border-input bg-zinc-950/50 px-3 py-2 text-sm text-zinc-100 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 pr-8",e),ref:a,...r,children:t}),(0,n.jsx)(s.A,{className:"absolute right-3 top-2.5 h-4 w-4 opacity-50 pointer-events-none"})]}));l.displayName="Select"},35050:(e,t,r)=>{r.r(t),r.d(t,{HeatmapReport:()=>L});var n=r(95155),a=r(12115),i=r(68605),s=r(47650),l=r(40980),o=r(43987),c=r(32745),d=r(75364),u=r(8875);let x=(e,t=0)=>e?.toLocaleString(void 0,{maximumFractionDigits:t}),m=[{key:"employee",label:"員工關係戶",shortLabel:"員",badgeClass:"border-purple-500/70 text-purple-300",predicate:e=>!!e.isEmployeeRelated},{key:"office",label:"事務所/商辦",shortLabel:"辦",badgeClass:"border-blue-500/70 text-blue-300",predicate:e=>!!e.isOffice},{key:"storefront",label:"店鋪",shortLabel:"店",badgeClass:"border-amber-500/70 text-amber-300",predicate:e=>!!e.isStorefront}],p=e=>null===e?"#1f2937":e<0?"rgba(16, 185, 129, 0.4)":0===e?"#06b6d4":e>5?"rgba(244, 63, 94, 0.5)":e>2?"rgba(249, 115, 22, 0.5)":"rgba(234, 179, 8, 0.4)",h=({children:e,triggerRect:t,isTopRow:r})=>{if(!t)return null;let a={position:"fixed",left:t.left+t.width/2,transform:"translateX(-50%)",zIndex:9999};return r?a.top=t.bottom+8:a.bottom=window.innerHeight-t.top+8,(0,s.createPortal)((0,n.jsx)("div",{style:a,className:"pointer-events-none",children:e}),document.body)};function f({data:e,floorPremium:t=.3,showGrid:r=!0,showSummary:i=!0,showComparison:s=!0,configProject:f,configScope:g,rawTransactions:b}){let j,N,{horizontalGrid:y,sortedFloors:v,sortedUnits:w,unitColorMap:z,summary:P,horizontalComparison:S}=e,[M,A]=(0,a.useState)(null),[E,F]=(0,a.useState)(null),[k,$]=(0,a.useState)(null),[C,T]=(0,a.useState)(!1),[O,D]=(0,a.useState)("premium"),[I,R]=(0,a.useState)("percent"),[L,H]=(0,a.useState)(null),_=g||d.Ze;(0,a.useEffect)(()=>{if(!f)return;let e=async()=>{let e=(0,d.oP)(f,_);e&&$(e);try{let e=await (0,d.ew)(f);e&&$(e)}catch(e){console.warn("Failed to fetch official config:",e)}};e();let t=t=>{!t.detail?.project||t.detail.project!==f||t.detail?.scope&&t.detail.scope!==_||e()};return window.addEventListener(d.Vz,t),()=>window.removeEventListener(d.Vz,t)},[f,_]),(0,a.useEffect)(()=>{H(null)},[E]);let B=(0,a.useCallback)(e=>{$(e)},[]),V=(0,a.useMemo)(()=>{if(!s||!y||!w||0===w.length)return{topPair:null,maxPairOverall:null,unitOverallStats:new Map,unitFloorStats:new Map,unitsInMaxPair:new Set};let e=new Map(w.map((e,t)=>[e,t])),t=new Map;Object.keys(y||{}).forEach(e=>{let r=new Map,n=y?.[e]||{};Object.keys(n).forEach(e=>{(n[e]||[]).forEach(t=>{if(!t||null===t.premium)return;let n=parseFloat(t["房屋單價(萬)"]||t.unitPrice||0);Number.isFinite(n)&&!(n<=0)&&(r.has(e)||r.set(e,[]),r.get(e).push(n))})}),r.size>0&&t.set(e,r)});let r=new Map,n=new Set,a=null,i=(e,t)=>{let r=e=>e?e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e)||0:0;return r(t)-r(e)},l=(e,t)=>{if(!e.length)return 0;let r=[...e].sort((e,t)=>e-t),n=(r.length-1)*t,a=Math.floor(n);return void 0!==r[a+1]?r[a]+(n-a)*(r[a+1]-r[a]):r[a]},o=(e,t)=>e.reduce((e,r)=>e?Math.abs(r.diff-t)<Math.abs(e.diff-t)?r:e:r,e[0]),c=e=>{if(!e.length)return null;let t=e.map(e=>e.diff),r=l(t,.25),n=l(t,.5),a=l(t,.75),i=n>=0?e.reduce((e,t)=>t.diff>e.diff?t:e,e[0]):e.reduce((e,t)=>t.diff<e.diff?t:e,e[0]);return{q1:r,median:n,q3:a,max:i.diff,samples:{q1:o(e,r),median:o(e,n),q3:o(e,a),max:i}}},d=new Map,u=new Map,x=new Map;Array.from(t.keys()).sort(i).forEach(i=>{let s=t.get(i);if(!s)return;let l=Array.from(s.keys()).sort((t,r)=>(e.get(t)??0)-(e.get(r)??0)),o=null;for(let e=0;e<l.length;e++)for(let t=e+1;t<l.length;t++){let n=l[e],a=l[t],i=s.get(n)||[],c=s.get(a)||[];if(!i.length||!c.length)continue;let d=[],u=i.slice(0,20),x=c.slice(0,20);u.forEach(e=>{x.forEach(t=>{d.push(e-t)})});let m=`${n}__${a}`;r.has(m)||r.set(m,{unitA:n,unitB:a,diffs:[],count:0});let p=r.get(m);p.diffs.push(...d),p.count+=1;let h=d.reduce((e,t)=>Math.abs(t)>Math.abs(e)?t:e,d[0]);(!o||Math.abs(h)>Math.abs(o.diff))&&(o={unitHigh:h>=0?n:a,unitLow:h>=0?a:n,diff:h})}o&&(n.add(o.unitHigh),n.add(o.unitLow),(!a||Math.abs(o.diff)>Math.abs(a.diff))&&(a={floor:i,unitHigh:o.unitHigh,unitLow:o.unitLow,diff:o.diff})),l.forEach(e=>{let t=s.get(e)||[];if(!t.length)return;let r=[],n=t.slice(0,10);if(l.forEach(t=>{if(t===e)return;let a=s.get(t)||[];if(!a.length)return;let l=a.slice(0,10);n.forEach(e=>{l.forEach(n=>{r.push({diff:e-n,otherUnit:t,floor:i})})})}),!r.length)return;let a=c(r);a&&(u.has(e)||u.set(e,[]),u.get(e).push({floor:i,...a}),x.has(e)||x.set(e,[]),x.get(e).push(...r))})}),u.forEach(e=>e.sort((e,t)=>i(e.floor,t.floor))),x.forEach((e,t)=>{let r=c(e);r&&d.set(t,r)});let m=null;return r.forEach(e=>{let t=e.diffs.reduce((e,t)=>e+t,0)/e.diffs.length;if(!m||e.count>m.count){m={unitA:e.unitA,unitB:e.unitB,count:e.count,avgDiff:t};return}e.count===m.count&&Math.abs(t)>Math.abs(m.avgDiff)&&(m={unitA:e.unitA,unitB:e.unitB,count:e.count,avgDiff:t})}),{topPair:m,maxPairOverall:a,unitOverallStats:d,unitFloorStats:u,unitsInMaxPair:n}},[y,w,s]);(0,a.useMemo)(()=>{if(!k?.configurations||!Array.isArray(k.configurations))return null;let e=new Map;return k.configurations.forEach(t=>{if(!t||!Array.isArray(t.positions)||!t.floorRange)return;let r=(0,c.Qy)(t.positions,t.envTiles||[],t.compassDirection||0,1);if(!r||!Array.isArray(r))return;let n=new Map(r.filter(e=>!!e).map(e=>[e.unitType,e])),a=Math.min(Number(t.floorRange.start)||0,Number(t.floorRange.end)||0),i=Math.max(Number(t.floorRange.start)||0,Number(t.floorRange.end)||0);for(let t=a;t<=i;t++)e.set(t,n)}),e},[k]);let G={school:"學校",plaza:"廣場",park:"公園",river:"河景",tower:"高壓塔",grave:"墓地",bridge:"高架橋",mountain:"山景",adjacent:"臨房"},W={N:"北",S:"南",E:"東",W:"西",NE:"東北",NW:"西北",SE:"東南",SW:"西南"},U=e=>{let t=[];if(e.roadFacing){let r=e.roadFacingDirections&&e.roadFacingDirections.length>0?e.roadFacingDirections:e.roadFacingDirection?[e.roadFacingDirection]:[];r.length?r.forEach(e=>{let r=W[e]||e;t.push({text:`${r}臨路`,tone:"road"})}):t.push({text:"臨路",tone:"road"})}if(e.facingOpenSpace&&e.openSpaceType){let r=new Set(["tower","grave","bridge"]);(e.openSpaceFacingDirections&&e.openSpaceFacingDirections.length>0?e.openSpaceFacingDirections.map(e=>({dir:e.direction,type:e.type})):[{dir:e.openSpaceFacingDirection||"",type:e.openSpaceType}]).forEach(e=>{if(!e.type)return;let n=G[e.type]||e.type,a=e.dir?W[e.dir]||e.dir:"",i=a?`${a}`:"";if("adjacent"===e.type)return void t.push({text:`${i}${n}`,tone:"adjacent"});let s=r.has(e.type);t.push({text:`${i}面${n}`,tone:s?"bad":"good"})})}return e.adjacentToUnits&&!t.some(e=>e.text.includes("臨房"))&&t.push({text:"臨房",tone:"adjacent"}),t},X=(0,a.useMemo)(()=>{if(!k?.configurations||!Array.isArray(k.configurations))return null;let e=new Map;return k.configurations.forEach(t=>{if(!t||!Array.isArray(t.positions))return;let r=(0,c.Qy)(t.positions,t.envTiles||[],t.compassDirection||0,1);r?.forEach(t=>{if(!t)return;let r=U(t);e.has(t.unitType)||e.set(t.unitType,{labelMap:new Map,details:[]});let n=e.get(t.unitType);r.forEach(e=>{n.labelMap.set(e.text,e.tone)})})}),e},[k,U]),[Z,q]=(0,a.useState)(null),[K,Q]=(0,a.useState)(null),J=(()=>{let e=P?.calculationFlags;if(!e)return"排除店舖/辦公室";let t=[];return e.includesStorefrontPremium||t.push("店舖"),e.includesOfficePremium||t.push("辦公室"),e.includesEmployeePremium||t.push("員工關係戶"),t.length?`排除${t.join("/")}`:"全部納入"})(),Y=(0,a.useMemo)(()=>{let e={};return y&&w&&w.forEach(t=>{let r=1/0,n=0;if(v?.forEach(e=>{(y?.[e]?.[t]||[]).forEach(e=>{if(!e||e?.isStorefront||e?.isOffice)return;let t=Number(e?.tooltipInfo?.houseArea||e?.houseArea||0);Number.isFinite(t)&&!(t<=0)&&(t<r&&(r=t),t>n&&(n=t))})}),!Number.isFinite(r)||n<=0){e[t]={hasVariance:!1,label:""};return}let a=n-r>3,i=`${r.toFixed(2).replace(/\.00$/,"")}–${n.toFixed(2).replace(/\.00$/,"")} 坪`;e[t]={hasVariance:a,label:a?i:""}}),e},[y,v,w]),ee=()=>{A(null)};return y&&v&&w?(0,n.jsxs)("div",{className:"space-y-8 overflow-x-auto relative",children:[M&&(0,n.jsx)(h,{triggerRect:M.rect,isTopRow:M.isTopRow,children:(j=M.data,N=m.filter(e=>e.predicate(j)).map(e=>e.label),(0,n.jsx)("div",{className:"w-48 bg-zinc-900 border border-zinc-700 rounded-lg p-3 shadow-xl animate-in fade-in zoom-in-95 duration-200",children:(0,n.jsxs)("div",{className:"space-y-1",children:[N.length>0&&(0,n.jsxs)("div",{className:"text-amber-300 text-xs",children:["特殊交易: ",N.join("、")]}),M.data?.hasParking&&(0,n.jsxs)("div",{className:"flex items-center gap-1 text-xs text-blue-300",children:[(0,n.jsx)("span",{className:"flex items-center justify-center w-3 h-3 bg-blue-500 text-white text-[8px] font-bold rounded-sm",children:"P"}),(0,n.jsx)("span",{children:"含車位"})]}),M.data?.premium===0&&(0,n.jsx)("div",{className:"text-cyan-400 font-bold mb-1",children:"★ 基準戶"}),M.data?.premium!==void 0&&M.data?.premium!==null&&(0,n.jsxs)("div",{className:"text-zinc-300",children:["調價: ",(0,n.jsxs)("span",{className:(0,l.cn)(M.data.premium>0?"text-red-400":M.data.premium<0?"text-violet-400":"text-zinc-400"),children:[M.data.premium>0?"+":"",M.data.premium.toFixed(2),"%"]})]}),(0,n.jsx)("div",{className:"h-px bg-zinc-700 my-2"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-x-2 gap-y-1 text-xs text-zinc-400",children:[(0,n.jsx)("span",{children:"成交總價:"})," ",(0,n.jsxs)("span",{className:"text-white text-right",children:[x(M.data?.tooltipInfo?.totalPrice??M.data?.totalPrice),"萬"]}),(0,n.jsx)("span",{children:"房屋總價:"})," ",(0,n.jsxs)("span",{className:"text-white text-right",children:[x(M.data?.tooltipInfo?.housePrice??M.data?.housePrice),"萬"]}),(0,n.jsx)("span",{children:"車位總價:"})," ",(0,n.jsxs)("span",{className:"text-white text-right",children:[x(M.data?.tooltipInfo?.parkingPrice??M.data?.parkingPrice),"萬"]}),(0,n.jsx)("span",{children:"房屋面積:"})," ",(0,n.jsxs)("span",{className:"text-white text-right",children:[x(M.data?.tooltipInfo?.houseArea??M.data?.houseArea,2),"坪"]})]})]})}))}),Z&&(0,n.jsx)(h,{triggerRect:Z.rect,isTopRow:!0,children:(0,n.jsxs)("div",{className:"w-56 bg-zinc-900 border border-zinc-700 rounded-lg p-2 shadow-xl text-xs text-zinc-300",children:["住宅面積變化: ",(0,n.jsx)("span",{className:"text-amber-300",children:Z.label}),(0,n.jsx)("div",{className:"text-[10px] text-zinc-500 mt-1",children:"已排除店舖/商辦"})]})}),r&&(0,n.jsxs)("div",{className:"min-w-max pb-32",children:[(0,n.jsxs)("div",{className:"flex items-center justify-end gap-2 mb-2",children:[(0,n.jsx)("span",{className:"text-xs text-zinc-500",children:"特殊交易"}),m.map(e=>{let t=K===e.key;return(0,n.jsxs)("button",{onClick:()=>Q(t=>t===e.key?null:e.key),className:(0,l.cn)("flex items-center gap-1 px-2 py-1 rounded border text-[10px] transition",t?"border-cyan-400 text-cyan-300 bg-cyan-500/10":"border-white/10 text-zinc-400 hover:text-zinc-200 hover:border-white/30"),children:[(0,n.jsx)("span",{className:(0,l.cn)("w-4 h-4 rounded border flex items-center justify-center text-[9px] font-bold bg-transparent",e.badgeClass),title:e.label,children:e.shortLabel}),e.label]},e.key)})]}),(0,n.jsxs)("table",{className:"divide-y divide-zinc-800 border-collapse w-full text-sm",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"sticky left-0 bg-dark-card z-20 p-2 text-zinc-400 border-r border-zinc-800",children:"樓層 \\ 戶別"}),w.map(e=>(0,n.jsx)("th",{className:(0,l.cn)("p-2 text-zinc-300 font-medium border-l border-zinc-800/50 bg-zinc-900/50 relative",Y[e]?.hasVariance&&"bg-amber-500/10"),onMouseEnter:t=>{let r=Y[e];r?.hasVariance&&q({rect:t.currentTarget.getBoundingClientRect(),label:r.label})},onMouseLeave:()=>q(null),children:(0,n.jsxs)("span",{className:"inline-flex items-center justify-center gap-1",children:[e,Y[e]?.hasVariance&&(0,n.jsx)("span",{className:"px-1 py-0.5 text-[9px] rounded border border-amber-400/70 text-amber-300 bg-amber-500/10",children:"Δ坪"})]})},e))]})}),(0,n.jsx)("tbody",{className:"divide-y divide-zinc-800/50",children:v.map((e,t)=>(0,n.jsxs)("tr",{className:"hover:bg-zinc-800/30 transition-colors",children:[(0,n.jsx)("td",{className:"sticky left-0 bg-dark-card z-10 p-2 font-bold text-zinc-300 border-r border-zinc-800 text-center",children:e}),w.map(r=>{let a=y[e]?.[r];return a&&0!==a.length?(0,n.jsx)("td",{className:"p-1 border-l border-zinc-800/50 align-top",children:(0,n.jsx)("div",{className:"flex flex-col gap-1",children:a.map((e,r)=>{let a=m.filter(t=>t.predicate(e)),i=a.length>0,s=i?"transparent":p(e.premium),c=e.remark?.includes("露台")?{icon:(0,n.jsx)(o.A,{className:"w-3 h-3"}),label:"露台"}:null,d=0===e.premium,u=t<3,x=K?m.find(e=>e.key===K)?.predicate:null,h=!x||x(e);return(0,n.jsxs)("div",{className:(0,l.cn)("p-1.5 rounded text-xs transition-transform hover:scale-105 cursor-default relative group",d&&"ring-1 ring-cyan-500",i&&"bg-transparent border border-zinc-700/60",K&&!h&&"opacity-20",K&&h&&"ring-2 ring-cyan-400"),style:{backgroundColor:s},onMouseEnter:t=>{A({rect:t.currentTarget.getBoundingClientRect(),data:e,isTopRow:u})},onMouseLeave:ee,children:[(0,n.jsxs)("div",{className:"flex flex-col gap-0.5 pr-4",children:[(0,n.jsxs)("span",{className:"font-semibold text-white flex items-center gap-1 leading-tight",children:[c&&(0,n.jsx)("span",{className:"text-zinc-200",title:c.label,children:c.icon}),e.unitPrice.toFixed(1),"萬"]}),(0,n.jsx)("div",{className:"text-[10px] text-zinc-300 font-mono tracking-tight opacity-90",children:e.transactionDate||"-"})]}),(0,n.jsxs)("div",{className:"absolute top-0.5 right-0.5 flex flex-col items-end gap-0.5",children:[a.map(e=>(0,n.jsx)("span",{className:(0,l.cn)("flex items-center justify-center w-3 h-3 text-[8px] font-bold rounded border bg-transparent",e.badgeClass),title:e.label,children:e.shortLabel},e.key)),e.hasParking&&(0,n.jsx)("span",{className:"flex items-center justify-center w-3 h-3 bg-blue-500 text-white text-[8px] font-bold rounded-sm",title:"含車位",children:"P"})]})]},r)})})},`${e}-${r}`):(0,n.jsx)("td",{className:"p-2 border-l border-zinc-800/50 bg-zinc-900/20 text-center text-zinc-600",children:"-"},`${e}-${r}`)})]},e))})]})]}),i&&P&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("h3",{className:"text-lg font-semibold text-zinc-200",children:["調價幅度統計摘要 (",J,")"]}),(0,n.jsx)("div",{className:"overflow-x-auto rounded-lg border border-zinc-800",children:(0,n.jsxs)("table",{className:"w-full text-sm text-left text-zinc-300",children:[(0,n.jsx)("thead",{className:"text-xs text-zinc-400 uppercase bg-zinc-900/50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-6 py-3",children:"基準房屋總價"}),(0,n.jsx)("th",{className:"px-6 py-3",children:"調價幅度總額"}),(0,n.jsx)("th",{className:"px-6 py-3",children:"總溢價率"}),(0,n.jsx)("th",{className:"px-6 py-3",children:"已售房屋坪數"}),(0,n.jsx)("th",{className:"px-6 py-3",children:"平均單價調價"})]})}),(0,n.jsx)("tbody",{children:(0,n.jsxs)("tr",{className:"bg-zinc-900/20 border-b border-zinc-800",children:[(0,n.jsxs)("td",{className:"px-6 py-4",children:[x(P.totalBaselineHousePrice)," 萬"]}),(0,n.jsxs)("td",{className:(0,l.cn)("px-6 py-4 font-bold",P.totalPricePremiumValue>0?"text-red-400":"text-violet-400"),children:[P.totalPricePremiumValue>0?"+":"",x(P.totalPricePremiumValue)," 萬"]}),(0,n.jsxs)("td",{className:"px-6 py-4",children:[(P.totalPricePremiumValue/P.totalBaselineHousePrice*100).toFixed(2)," %"]}),(0,n.jsxs)("td",{className:"px-6 py-4",children:[x(P.totalSoldArea)," 坪"]}),(0,n.jsxs)("td",{className:(0,l.cn)("px-6 py-4",P.totalPricePremiumValue>0?"text-red-400":"text-violet-400"),children:[(P.totalPricePremiumValue/P.totalSoldArea).toFixed(2)," 萬/坪"]})]})})]})})]}),s&&S&&S.length>0&&(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-zinc-200",children:"戶型水平價差與溢價貢獻"}),(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs text-zinc-400",children:[e.comparisonMeta&&(0,n.jsxs)("span",{children:["原始最低戶型：",e.comparisonMeta.originalMinUnit||"-"," ","number"==typeof e.comparisonMeta.originalMinAvg?`(${e.comparisonMeta.originalMinAvg.toFixed(2)} 萬/坪)`:""," ｜ ","實際最低戶型：",e.comparisonMeta.actualMinUnit||"-"," ","number"==typeof e.comparisonMeta.actualMinAvg?`(${e.comparisonMeta.actualMinAvg.toFixed(2)} 萬/坪)`:""]}),V.topPair&&(0,n.jsxs)("span",{children:["AI 摘要：常見價差組合 ",V.topPair.unitA," ↔ ",V.topPair.unitB,"（",V.topPair.count," 層，平均差 ",V.topPair.avgDiff>0?"+":"",V.topPair.avgDiff.toFixed(2),"）"]}),V.maxPairOverall&&(0,n.jsxs)("span",{children:["最大價差：",V.maxPairOverall.floor,"F ",V.maxPairOverall.unitHigh," ↔ ",V.maxPairOverall.unitLow,"（",V.maxPairOverall.diff>0?"+":"",V.maxPairOverall.diff.toFixed(2),"）"]}),f&&(0,n.jsxs)("div",{className:"flex items-center gap-2 text-zinc-500",children:[(0,n.jsxs)("span",{children:["樓層配置：",k?.configurations?.length?`已同步 ${k.configurations.length} 組`:"未設定"]}),b&&b.length>0&&(0,n.jsx)("button",{onClick:()=>T(e=>!e),className:"px-2 py-1 rounded border border-white/10 text-[11px] text-zinc-400 hover:text-zinc-200 hover:border-white/30 transition",children:C?"收合配置":"設定配置"})]})]}),C&&b&&b.length>0&&f&&(0,n.jsx)("div",{className:"mt-3",children:(0,n.jsx)(u.sB,{transactions:b,project:f,configOnly:!0,title:"樓層配置（戶型水平價差）",storageScope:_,initialStep:"config",onConfigChange:B,mode:"report"})}),(0,n.jsx)("div",{className:"overflow-x-auto rounded-lg border border-zinc-800",children:(0,n.jsxs)("table",{className:"w-full text-sm text-left text-zinc-300",children:[(0,n.jsx)("thead",{className:"text-xs text-zinc-400 uppercase bg-zinc-900/50",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-4 py-3",children:"戶型"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"環境標籤"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"基準戶 (樓/價)"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"原始平均單價"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"實際平均單價"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"去化戶數"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"去化坪數"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"溢價(萬/坪)"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"溢價貢獻"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"貢獻佔比"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"細節"})]})}),(0,n.jsx)("tbody",{children:S.map((e,t)=>{let r,i,s,o=t=>{t&&t!==e.unitType?H(e=>e===t?null:t):H(null)},c=L&&L!==e.unitType?[e.unitType,L]:[e.unitType];return(0,n.jsxs)(a.Fragment,{children:[(0,n.jsxs)("tr",{className:"bg-zinc-900/20 border-b border-zinc-800 hover:bg-zinc-800/20",children:[(0,n.jsx)("td",{className:"px-4 py-3 font-medium text-white",children:e.unitType}),(0,n.jsx)("td",{className:"px-4 py-3",children:(i=(r=X?.get(e.unitType))?Array.from(r.labelMap.entries()):[]).length?(0,n.jsx)("div",{className:"flex flex-wrap gap-1",title:r?.details.join(" | "),children:i.map(([t,r])=>(0,n.jsx)("span",{className:`px-2 py-0.5 rounded text-[10px] border ${(e=>{switch(e){case"road":return"border-amber-400/40 text-amber-300 bg-amber-500/10";case"good":return"border-emerald-400/40 text-emerald-300 bg-emerald-500/10";case"bad":return"border-rose-400/40 text-rose-300 bg-rose-500/10";case"adjacent":return"border-zinc-500/40 text-zinc-300 bg-zinc-500/10";default:return"border-white/10 text-zinc-300 bg-white/5"}})(r)}`,children:t},`${e.unitType}-${t}`))}):(0,n.jsx)("span",{className:"text-zinc-500",children:"-"})}),(0,n.jsx)("td",{className:"px-4 py-3",children:e.anchorInfo}),(0,n.jsx)("td",{className:"px-4 py-3",children:"number"==typeof e.originalAvgPrice?`${e.originalAvgPrice.toFixed(2)} 萬/坪`:"-"}),(0,n.jsx)("td",{className:"px-4 py-3",children:"number"==typeof e.actualAvgPrice?`${e.actualAvgPrice.toFixed(2)} 萬/坪`:"-"}),(0,n.jsxs)("td",{className:"px-4 py-3",children:[e.unitsSold," 戶"]}),(0,n.jsx)("td",{className:"px-4 py-3",children:"number"==typeof e.totalSoldArea?`${e.totalSoldArea.toFixed(2)} 坪`:"-"}),(0,n.jsx)("td",{className:(0,l.cn)("px-4 py-3",e.avgPremiumPerPing>0?"text-red-400":"text-violet-400"),children:"number"==typeof e.avgPremiumPerPing?`${e.avgPremiumPerPing>0?"+":""}${e.avgPremiumPerPing.toFixed(2)} 萬/坪`:"-"}),(0,n.jsxs)("td",{className:(0,l.cn)("px-4 py-3 font-bold",e.timePremiumContribution>0?"text-red-400":"text-violet-400"),children:[e.timePremiumContribution>0?"+":"",x(e.timePremiumContribution)," 萬"]}),(0,n.jsxs)("td",{className:"px-4 py-3",children:["number"==typeof e.contributionPercentage?e.contributionPercentage.toFixed(2):"0.00","%"]}),(0,n.jsx)("td",{className:"px-4 py-3",children:(0,n.jsx)("button",{onClick:()=>F(t=>t===e.unitType?null:e.unitType),className:"text-[11px] text-cyan-300 border border-cyan-400/30 rounded px-2 py-1 hover:bg-cyan-500/10 transition",children:E===e.unitType?"收合":"展開"})})]}),E===e.unitType&&(0,n.jsx)("tr",{className:"bg-zinc-950/40 border-b border-zinc-800",children:(0,n.jsx)("td",{colSpan:11,className:"px-4 py-3",children:(0,n.jsxs)("div",{className:"flex flex-col xl:flex-row gap-6",children:[(0,n.jsx)("div",{className:"xl:w-[400px] shrink-0",children:(0,n.jsxs)("div",{className:"bg-zinc-900/40 rounded border border-white/10 p-2 h-full flex flex-col",children:[(0,n.jsxs)("h4",{className:"text-xs font-bold text-zinc-400 mb-2 flex items-center gap-2",children:[(0,n.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-cyan-400"}),"樓層配置視圖"]}),(0,n.jsx)("div",{className:"flex-1 min-h-[300px] relative rounded overflow-hidden bg-zinc-950/50 border border-white/5",children:(()=>{let e=k?.configurations?.[0];if(!e)return(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center text-zinc-500 text-xs",children:"無配置資料"});let t=(e.positions||[]).map(e=>(0,u.jk)(e,1)),r=e.envTiles||[];return(0,n.jsx)(u.Cn,{positions:t,envTiles:r,selectedUnits:c,zoom:.6,gridSize:e.gridSize||30,compassDirection:e.compassDirection||0,onPositionsChange:()=>{},onUnitClick:e=>o(e),onZoomChange:()=>{},isAnalyzeMode:!0,showBadges:!1,unitShape:"square"})})()}),(0,n.jsx)("div",{className:"mt-2 text-[10px] text-zinc-500 text-center",children:"* 此為唯讀視圖，顯示目前選擇戶型位置"})]})}),(0,n.jsxs)("div",{className:"flex-1 rounded border border-white/10 bg-zinc-900/40 p-3 overflow-hidden",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsxs)("div",{className:"text-xs text-zinc-400",children:["戶型比價矩陣（單位：","percent"===I?"%":"萬/坪","，",(0,n.jsx)("span",{className:"text-red-400",children:"紅>5%"}),"，",(0,n.jsx)("span",{className:"text-orange-400",children:"橘2~5%"}),"，",(0,n.jsx)("span",{className:"text-yellow-400",children:"黃0~2%"}),"，",(0,n.jsx)("span",{className:"text-emerald-400",children:"綠<0%"}),"）"]}),(0,n.jsxs)("div",{className:"flex bg-zinc-950 p-0.5 rounded-md border border-zinc-800",children:[(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),R("value")},className:(0,l.cn)("px-2 py-1 text-[10px] rounded transition-all","value"===I?"bg-zinc-800 text-white shadow-sm":"text-zinc-500 hover:text-zinc-300"),children:"價差數值 $"}),(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),R("percent")},className:(0,l.cn)("px-2 py-1 text-[10px] rounded transition-all","percent"===I?"bg-zinc-800 text-white shadow-sm":"text-zinc-500 hover:text-zinc-300"),children:"價差比例 %"})]})]}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full text-xs border-collapse",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"p-2 text-zinc-500 font-normal text-left whitespace-nowrap sticky left-0 bg-zinc-900/90 z-10 border-b border-zinc-800",children:"樓層"}),w.filter(t=>t!==e.unitType).map(e=>{let t=X?.get(e),r=t?Array.from(t.labelMap.keys()):[],a=L===e;return(0,n.jsx)("th",{onClick:()=>o(e),className:(0,l.cn)("p-2 text-zinc-400 font-medium text-center whitespace-nowrap min-w-[60px] border-b border-zinc-800 align-top cursor-pointer transition-colors",a&&"bg-cyan-500/10 text-cyan-200 ring-1 ring-cyan-400/40"),title:"點擊高亮此戶型欄位",children:(0,n.jsxs)("div",{className:"flex flex-col gap-0.5 items-center",children:[(0,n.jsxs)("span",{children:["vs ",e]}),r.map((e,t)=>(0,n.jsx)("span",{className:"text-[10px] bg-zinc-800 text-zinc-400 px-1 rounded transform scale-90 origin-top",children:e},t))]})},e)})]})}),(0,n.jsx)("tbody",{className:"divide-y divide-zinc-800/30",children:(s=w.filter(t=>t!==e.unitType),v.map(t=>{let r=y?.[t]?.[e.unitType],a=r?.[0];if(!a||!a.unitPrice)return null;let i=a.unitPrice;return(0,n.jsxs)("tr",{className:"hover:bg-zinc-800/20",children:[(0,n.jsxs)("td",{className:"p-2 text-zinc-500 font-mono sticky left-0 bg-zinc-900/90 border-r border-zinc-800/50",children:[t,"F"]}),s.map(e=>{let r=y?.[t]?.[e],a=r?.[0],s=a?.unitPrice,o=L===e;if(!s)return(0,n.jsx)("td",{className:(0,l.cn)("p-2 text-center text-zinc-700 transition-colors",o&&"bg-cyan-500/10 ring-1 ring-cyan-400/30"),children:"-"},e);let c=i-s,d=c/s*100,u=p(d),x="text-zinc-200";x=d>5?"text-white font-bold shadow-sm":d<0?"text-emerald-100":d>2?"text-orange-100":"text-yellow-100",.1>Math.abs(d)&&(x="text-zinc-400");let m="percent"===I?`${d.toFixed(1)}%`:c.toFixed(1),h=c>0?"+":"";return(0,n.jsx)("td",{className:(0,l.cn)("p-1 text-center transition-colors",o&&"bg-cyan-500/10"),children:(0,n.jsxs)("div",{className:(0,l.cn)("py-1 px-1.5 rounded text-[11px] font-mono transition-colors",x,o&&"ring-2 ring-cyan-400/70 ring-offset-1 ring-offset-zinc-900/40"),style:{backgroundColor:u},title:`${e}: ${s}萬/坪`,children:[h,m]})},e)})]},t)}))})]})})]})]})})})]},t)})})]})})]})]}):(0,n.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無有效熱力圖資料"})}var g=r(89579),b=r(80642),j=r(39430),N=r(86901),y=r(94514),v=r(21628);function w({transactions:e,currentPremium:t,onApply:r,onManualChange:i}){let[s,l]=(0,a.useState)(null),[o,c]=(0,a.useState)(!1),[d,u]=(0,a.useState)(String(t)),x=(0,a.useRef)(null),[m,p]=(0,a.useState)(null),[h,f]=(0,a.useState)(360),w=Math.max(160,h-28),z=(0,a.useMemo)(()=>(function(e){if(!e||0===e.length)return[];let t=[],r={},n=new g.B$(e);e.forEach(e=>{let t=((e,t)=>{let r=e?.["戶型"];if("string"==typeof r&&r)return r;let n=t.resolve(e);if(n)return n;let a=e?.["戶別"]||e?.unit||e?.unitName;return"string"==typeof a&&a?a:""})(e,n),a=(e=>{if(!e)return 0;let t=String(e).match(/\d+/);return t?parseInt(t[0],10):0})(e["樓層"]||e.floor||""),i=parseFloat(e["房屋單價(萬)"]||e.unitPrice||0);t&&0!==a&&i>0&&(r[t]||(r[t]=[]),r[t].push({floor:a,price:i,original:e}))}),Object.entries(r).forEach(([e,r])=>{r.sort((e,t)=>e.floor-t.floor);for(let n=0;n<r.length;n++)for(let a=n+1;a<r.length;a++){let i=r[n],s=r[a],l=s.floor-i.floor;if(l>0&&l<=10){let r=Math.round(10*((s.price-i.price)/l))/10;r>=-2&&r<=2&&t.push({stack:e,floorLow:i.floor,floorHigh:s.floor,priceLow:i.price,priceHigh:s.price,diff:r,dateLow:i.original["交易年月日"]||i.original["交易日"]||i.original.transactionDate,dateHigh:s.original["交易年月日"]||s.original["交易日"]||s.original.transactionDate})}}});let a=new Map;t.forEach(e=>{let t=`${e.stack}-${e.floorLow}-${e.floorHigh}-${e.priceLow}-${e.priceHigh}`;a.has(t)||a.set(t,e)});let i=Array.from(a.values()),s={};i.forEach(e=>{s[e.diff]||(s[e.diff]={premium:e.diff,count:0,pairs:[]}),s[e.diff].count+=1,s[e.diff].pairs.push(e)});let l=Object.values(s);return l.sort((e,t)=>t.count!==e.count?t.count-e.count:e.premium-t.premium),l})(e),[e]),P=(0,a.useMemo)(()=>[...z.slice(0,5)].sort((e,t)=>e.premium-t.premium),[z]),S=(0,a.useMemo)(()=>[...z].sort((e,t)=>e.premium-t.premium),[z]),M=(0,a.useMemo)(()=>o?S:P,[o,S,P]),A=(0,a.useMemo)(()=>z.find(e=>1e-6>Math.abs(e.premium-t))||null,[z,t]),E=z.length>P.length;(0,a.useEffect)(()=>{l(null)},[A?.premium]),(0,a.useEffect)(()=>{u(String(t))},[t]),(0,a.useEffect)(()=>{if(!x.current)return;let e=()=>{if(!x.current)return;let e=Math.round(x.current.getBoundingClientRect().width);e>0&&p(e)};e();let t=new ResizeObserver(()=>e());return t.observe(x.current),window.addEventListener("resize",e),()=>{t.disconnect(),window.removeEventListener("resize",e)}},[]),(0,a.useEffect)(()=>{let e=()=>{f(Math.max(260,Math.min(520,Math.round(.55*window.innerHeight))))};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let F=(0,a.useMemo)(()=>{let t=new Set,r=new Set,n=new g.B$(e);e.forEach(e=>{if(!e)return;let a=(e=>{let t=e?.["戶型"];if("string"==typeof t&&t)return t;let r=n.resolve(e);if(r)return r;let a=e?.["戶別"]||e?.unit||e?.unitName;return"string"==typeof a&&a?a:""})(e),i=(e=>{if(!e)return 0;let t=String(e).match(/\d+/);return t?parseInt(t[0],10):0})(e["樓層"]||e.floor);a&&t.add(a),0!==i&&r.add(i)});let a=Array.from(r).sort((e,t)=>t-e),i=e=>{let t=String(e||"").trim().toUpperCase(),r=t.match(/^([A-Z]+)(\d+)?$/);return r?{alpha:r[1]||"",num:r[2]?parseInt(r[2],10):Number.MAX_SAFE_INTEGER,raw:t}:{alpha:t,num:Number.MAX_SAFE_INTEGER,raw:t}},s=Array.from(t).sort((e,t)=>{let r=i(e),n=i(t),a=r.alpha.localeCompare(n.alpha,"en");return 0!==a?a:r.num!==n.num?r.num-n.num:r.raw.localeCompare(n.raw,"en")}),l=new Set;A&&A.pairs.forEach(e=>{l.add(`${e.stack}-${e.floorLow}`),l.add(`${e.stack}-${e.floorHigh}`)});let o=a.length||1,c=s.length||1,d=(m||0)-32-16,u=h-24-4,x=Math.min(40,Math.max(8,Math.min(d>0?Math.floor(d/c):24,u>0?Math.floor(u/o):24)));return{sortedFloors:a,sortedStacks:s,highlightedCells:l,cellSize:x,gridHeight:o*x+24}},[e,A,m,h]);if(0===z.length)return null;let k=null!==s&&A?A.pairs[s]:null;return(0,n.jsxs)("div",{className:"bg-zinc-900/50 border border-white/10 rounded-xl p-4 mb-6",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,n.jsx)(N.A,{className:"w-4 h-4 text-yellow-400"}),(0,n.jsx)("h3",{className:"text-sm font-bold text-zinc-100",children:"AI 樓層價差分析建議"})]}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4 items-center",children:[M.map(e=>{let a=1e-6>Math.abs(t-e.premium);return(0,n.jsxs)("button",{onClick:()=>{r(e.premium)},className:`
                                relative px-3 py-1.5 rounded-lg border text-xs font-mono transition-all
                                flex items-center gap-2
                                ${a?"bg-cyan-500/20 border-cyan-500 text-cyan-300":"bg-zinc-800 border-white/5 text-zinc-400 hover:border-white/20 hover:text-zinc-200"}
                            `,children:[(0,n.jsxs)("span",{className:"text-base font-bold",children:[e.premium>0?"+":"",e.premium]}),(0,n.jsx)("span",{className:"opacity-50",children:"萬/坪"}),(0,n.jsxs)("span",{className:"ml-1 bg-black/20 px-1.5 rounded text-[10px]",children:[e.count," 組"]}),a&&(0,n.jsx)(y.A,{className:"w-3 h-3 text-green-400"})]},e.premium)}),i&&(0,n.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-lg border border-white/10 bg-zinc-900/60 text-xs text-zinc-300",children:[(0,n.jsx)("span",{className:"text-[10px] text-zinc-500",children:"手動"}),(0,n.jsx)("input",{type:"text",inputMode:"decimal",value:d,onChange:e=>u(e.target.value),onBlur:()=>{let e=Number(d);Number.isNaN(e)||i(Math.max(0,e))},onKeyDown:e=>{if("Enter"===e.key){let t=Number(d);Number.isNaN(t)||(i(Math.max(0,t)),e.target.blur())}},className:"w-16 bg-transparent text-right pr-1 outline-none text-zinc-200"}),(0,n.jsx)("span",{className:"text-[10px] text-violet-300",children:"萬/坪"})]}),E&&(0,n.jsx)("button",{onClick:()=>c(e=>!e),className:"px-3 py-1.5 rounded-lg border border-white/10 bg-zinc-800 text-[10px] text-zinc-400 hover:text-zinc-200 hover:border-white/30 transition",children:o?"收合標籤":"顯示全部"})]}),(0,n.jsx)(b.N,{children:A&&(0,n.jsx)(j.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"overflow-hidden",children:(0,n.jsxs)("div",{className:"border-t border-white/10 pt-4 mt-2",children:[(0,n.jsxs)("div",{className:"flex justify-between items-end mb-3",children:[(0,n.jsxs)("div",{className:"text-xs text-zinc-400",children:[(0,n.jsx)("span",{className:"text-cyan-400 font-bold",children:A.count})," 組對比符合此規律。 點擊右側明細可連動網格顯示。"]}),(0,n.jsx)("div",{className:"text-[10px] text-zinc-500",children:"點擊上方標籤即可套用"})]}),(0,n.jsxs)("div",{className:"flex flex-col xl:flex-row gap-4 items-stretch",children:[(0,n.jsx)("div",{ref:x,className:"flex-1 bg-black/40 rounded border border-white/5 p-2 overflow-hidden relative",style:{height:h},children:(0,n.jsxs)("div",{className:"w-full",children:[(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"shrink-0",style:{width:32}}),F.sortedStacks.map(e=>(0,n.jsx)("div",{className:"text-center text-[10px] text-zinc-500 pb-1",style:{width:F.cellSize},children:e},e))]}),F.sortedFloors.map(e=>(0,n.jsxs)("div",{className:"flex items-center relative z-10",style:{height:F.cellSize},children:[(0,n.jsxs)("div",{className:"shrink-0 text-right text-[10px] text-zinc-600 pr-2",style:{width:32},children:[e,"F"]}),F.sortedStacks.map(t=>{let r=`${t}-${e}`,a=F.highlightedCells.has(r),i=k&&k.stack===t&&(e===k.floorLow||e===k.floorHigh),s=A.pairs.some(r=>r.stack===t&&e>r.floorLow&&e<r.floorHigh),l=k&&k.stack===t&&e>k.floorLow&&e<k.floorHigh;return(0,n.jsxs)("div",{className:"h-full flex items-center justify-center p-0.5 relative",style:{width:F.cellSize},children:[s&&(0,n.jsx)("div",{className:`
                                                                    absolute w-0.5 h-[140%] top-[-20%] transition-colors duration-200
                                                                    ${l?"bg-yellow-400 z-20":"bg-cyan-500/20"}
                                                                `}),(0,n.jsx)("div",{className:`
                                                                    w-full h-full rounded-sm transition-all duration-200 relative z-10
                                                                    ${i?"bg-yellow-400 shadow-[0_0_12px_rgba(250,204,21,0.8)] scale-100 ring-2 ring-white/50 z-30":a?"bg-cyan-500 shadow-[0_0_8px_rgba(6,182,212,0.6)] scale-90":"bg-zinc-800/30"}
                                                                `})]},r)})]},e))]})}),(0,n.jsxs)("div",{className:"w-full xl:w-[380px] flex flex-col gap-2",style:{height:h},children:[(0,n.jsxs)("div",{className:"text-[10px] uppercase tracking-wider text-zinc-500 font-bold mb-1",children:["對比明細 (共 ",A.pairs.length," 組)"]}),(0,n.jsx)("div",{className:"flex flex-col gap-2 overflow-y-auto pr-2 custom-scrollbar",style:{maxHeight:w},children:A.pairs.map((e,t)=>(0,n.jsxs)("div",{onMouseEnter:()=>l(t),onMouseLeave:()=>l(null),className:`
                                                    border rounded-lg p-2 flex items-center justify-between group transition-all cursor-crosshair
                                                    ${s===t?"bg-yellow-400/10 border-yellow-400/50 translate-x-1":"bg-white/5 border-white/5 hover:border-white/20"}
                                                `,children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:`
                                                        w-8 h-8 rounded flex items-center justify-center font-bold text-xs border transition-colors
                                                        ${s===t?"bg-yellow-400/20 text-yellow-400 border-yellow-400/30":"bg-cyan-500/10 text-cyan-400 border-cyan-500/20"}
                                                    `,children:e.stack}),(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1.5 leading-none",children:[(0,n.jsxs)("span",{className:"text-xs text-zinc-300",children:[e.floorLow,"F"]}),(0,n.jsx)(v.A,{className:`w-3 h-3 ${s===t?"text-yellow-400":"text-zinc-600"}`}),(0,n.jsxs)("span",{className:"text-xs text-zinc-100 font-bold",children:[e.floorHigh,"F"]})]}),(0,n.jsxs)("div",{className:"text-[10px] text-zinc-500 mt-1 flex gap-1 items-center",children:[(0,n.jsx)("span",{className:"opacity-70",children:e.dateLow||"N/A"}),(0,n.jsx)("span",{className:"opacity-30",children:"|"}),(0,n.jsx)("span",{className:"opacity-70",children:e.dateHigh||"N/A"})]})]})]}),(0,n.jsxs)("div",{className:"text-right",children:[(0,n.jsxs)("div",{className:"text-xs font-mono text-zinc-200",children:[e.priceLow,(0,n.jsx)("span",{className:"text-[10px] opacity-40 mx-1",children:"→"}),e.priceHigh]}),(0,n.jsxs)("div",{className:`text-[10px] font-bold ${s===t?"text-yellow-400":"text-cyan-400/80"}`,children:["+",e.diff," 萬/層"]})]})]},t))})]})]})]})})})]})}var z=r(81789),P=r(29991),S=r(60529),M=r(89239),A=r(37618),E=r(61878),F=r(56722);let k=e=>{let t=String(e?.["樓層"]||e?.floor||e?.layer||""),r="1"===t||"001"===t||t.includes("一樓"),n=e?.["建物型態"]||e?.buildingType||"",a=e?.["主要用途"]||e?.mainPurpose||"",i=e?.["備註"]||e?.note||"",s=n.includes("店")||e.buildingType?.includes("店")||"商業用"===a||"商業用"===e.mainPurpose||i.includes("店")||e.note?.includes("店"),l=n.includes("辦公")||e.buildingType?.includes("辦公")||n.includes("廠辦")||e.buildingType?.includes("廠辦")||n.includes("事務所")||e.buildingType?.includes("事務所")||a.includes("辦公")||e.mainPurpose?.includes("辦公")||a.includes("事務所")||e.mainPurpose?.includes("事務所")||i.includes("辦公")||i.includes("事務所")||e.note?.includes("辦公")||e.note?.includes("事務所");return{buildingType:n,mainPurpose:a,note:i,isStorefront:s&&r,isOffice:l||s&&!r}},$=e=>{let{note:t,isStorefront:r,isOffice:n}=k(e),a=t.includes("親友")||t.includes("員工")||t.includes("關係人")||t.includes("關係戶")||t.includes("員工關係");return{note:t,isStorefront:r,isOffice:n,isEmployeeRelated:a}};var C=r(88743),T=r(27529),O=r(55873),D=r(98883),I=r(89733);function R({transactions:e,project:t}){let[r,i]=(0,a.useState)(""),[s,l]=(0,a.useState)(""),[o,c]=(0,a.useState)(null),[d,u]=(0,a.useState)(!1),[x,m]=(0,a.useState)(null),p=e=>{if(null==e)return null;if("number"==typeof e&&Number.isFinite(e))return e;let t=String(e).trim();if(!t||t.startsWith("B")||t.includes("地下")||t.includes("負"))return null;let r=t.match(/-?\d+/);if(!r)return null;let n=parseInt(r[0],10);return!Number.isFinite(n)||n<=0?null:n};(0,a.useEffect)(()=>{i(""),l(""),c(null)},[t]),(0,a.useEffect)(()=>{let e=()=>{u(!1),m(null)};return window.addEventListener("pointerup",e),()=>window.removeEventListener("pointerup",e)},[]);let h=a.useMemo(()=>{if(!e||0===e.length)return[];let t=0;return(e.forEach(e=>{let r=p(e["樓層"]);r&&r>t&&(t=r)}),t)?Array.from({length:t},(e,t)=>t+1):[]},[e]),f=a.useMemo(()=>{let e=parseInt(r,10),t=parseInt(s,10);return Number.isFinite(e)&&Number.isFinite(t)?{start:Math.min(e,t),end:Math.max(e,t)}:null},[r,s]),g=a.useCallback(r=>{if(!t||!e||!r)return void c(null);let n=e.filter(e=>{let t=p(e["樓層"]);return!!t&&t>=r.start&&t<=r.end});if(0===n.length)return void c({avg:0,count:0});let a=n.reduce((e,t)=>e+(t["房屋總價(萬)"]||0),0),i=n.reduce((e,t)=>e+(t["房屋面積(坪)"]||0),0);c({avg:i>0?a/i:0,count:n.length})},[t,e]);(0,a.useEffect)(()=>{g(f)},[f,g]);let b=(e,t)=>{let r=Math.min(e,t),n=Math.max(e,t);i(String(r)),l(String(n))};return(0,n.jsxs)("div",{className:"flex flex-col gap-3 bg-zinc-900/30 p-4 rounded-lg border border-white/5",children:[(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 w-full sm:w-auto",children:[(0,n.jsx)("span",{className:"text-sm text-zinc-400 font-semibold whitespace-nowrap",children:"區間均價試算:"}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(S.p,{type:"number",placeholder:"起樓",className:"w-20 h-8 bg-zinc-950/50",value:r,onChange:e=>i(e.target.value)}),(0,n.jsx)("span",{className:"text-zinc-500",children:"~"}),(0,n.jsx)(S.p,{type:"number",placeholder:"迄樓",className:"w-20 h-8 bg-zinc-950/50",value:s,onChange:e=>l(e.target.value)})]}),(0,n.jsx)(M.$,{size:"sm",variant:"secondary",onClick:()=>g(f),className:"h-8 ml-2",children:"計算"})]}),h.length>0&&(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:h.map(e=>{let t=!!f&&e>=f.start&&e<=f.end,r=!!f&&(e===f.start||e===f.end);return(0,n.jsx)("button",{type:"button",onPointerDown:()=>{u(!0),m(e),b(e,e)},onPointerEnter:()=>{d&&null!==x&&b(x,e)},className:`h-9 w-9 rounded-md border text-xs font-semibold transition ${t?r?"border-violet-400 bg-violet-500/25 text-violet-200 shadow-[0_0_12px_rgba(139,92,246,0.35)]":"border-violet-500/40 bg-violet-500/15 text-violet-300":"border-white/10 bg-zinc-950/50 text-zinc-400 hover:border-white/30 hover:text-zinc-200"}`,children:e},`floor-${e}`)})}),(0,n.jsx)("span",{className:"text-[11px] text-zinc-500",children:"可點選或拖曳選取樓層範圍"})]}),o&&(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-4 animate-in fade-in",children:[(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("span",{className:"text-xs text-zinc-500",children:"平均單價 (加權)"}),(0,n.jsxs)("span",{className:"text-lg font-bold text-violet-400",children:[o.avg.toFixed(2)," 萬/坪"]})]}),(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("span",{className:"text-xs text-zinc-500",children:"參考筆數"}),(0,n.jsxs)("span",{className:"text-sm text-zinc-300",children:[o.count," 筆"]})]})]})]})}function L({data:e,visibleSections:t=["grid","stats","comparison"]}){let[r,s]=(0,a.useState)(""),[l,o]=(0,a.useState)(!1),[c,d]=(0,a.useState)(.3),[u,x]=(0,a.useState)(14),[m,p]=(0,a.useState)(!1),[h,b]=(0,a.useState)(!1),j=(0,C.P)(e=>e.excludeCommercial),{counties:N,districts:y,transactionType:v,buildingType:M,dateRange:L,startDate:H,endDate:_}=(0,C.P)(),[B,V]=(0,a.useState)(null),[G,W]=(0,a.useState)(!1),U=a.useRef(null),X=a.useRef(null),Z=a.useRef(null);if((0,a.useEffect)(()=>{!l&&e?.priceGridAnalysis?.projectNames?.length&&!r&&s(e.priceGridAnalysis.projectNames[0])},[e,r,l]),!e?.priceGridAnalysis)return null;let{projectNames:q,byProject:K}=e.priceGridAnalysis,Q=t.includes("grid"),J=t.includes("stats"),Y=t.includes("comparison"),ee=e=>String(e??"").normalize("NFKC").replace(/\s+/g,"").trim().toLowerCase(),et=a.useMemo(()=>{if(!r||!e.transactionDetails)return null;let t=ee(r);return t?e.transactionDetails.filter(e=>ee(e["建案名稱"])===t):null},[r,e.transactionDetails]);(0,a.useEffect)(()=>{let e=!0;return(async()=>{if(!r||et&&et.length>0)return V(null);let t=N.map(e=>O.WG[e]||e).filter(Boolean);if(0===t.length)return;let n=H,a=_;if("custom"!==L&&(!n||!a)){let e=(0,D.P)(L);n=e.startDate||n,a=e.endDate||a}W(!0);try{let i=[];for(let s of t){let t=1,l=1/0;for(;i.length<l;){let o=await T.FH.fetchData({countyCode:s,districts:y,type:v,transactionType:v,projectNames:[r],buildingType:M,dateStart:n,dateEnd:a},{page:t,pageSize:1e3,totalRecords:0});if(!e)return;let c=o?.data||[],d="number"==typeof o?.count?o.count:null;if(i.push(...c),null!==d&&(l=d),c.length<1e3||null!==d&&i.length>=d||(t+=1)>20)break}}e&&V(i)}catch(t){console.warn("Fetch project transactions failed:",t),e&&V([])}finally{e&&W(!1)}})(),()=>{e=!1}},[r,et,N,y,v,M,L,H,_]);let er=et&&et.length>0?et:B,en=a.useMemo(()=>{if(!er||0===er.length)return{hasOffice:!1,hasResidential:!1,isMixed:!1};let e=er.reduce((e,t)=>{let{isStorefront:r,isOffice:n}=k(t);return n&&(e.hasOffice=!0),n||r||(e.hasResidential=!0),e},{hasOffice:!1,hasResidential:!1});return{...e,isMixed:e.hasOffice&&e.hasResidential}},[er]),ea=a.useMemo(()=>!!er&&0!==er.length&&er.some(e=>{let t=e["備註"]||e.note||"";return t.includes("親友")||t.includes("員工")||t.includes("關係人")||t.includes("關係戶")||t.includes("員工關係")}),[er]);(0,a.useEffect)(()=>{r&&p(!en.isMixed&&en.hasOffice)},[r,en.isMixed,en.hasOffice]),(0,a.useEffect)(()=>{r&&b(!1)},[r]);let ei=a.useMemo(()=>{if(!er)return null;let e=er;return j&&(e=e.filter(e=>{let{isStorefront:t,isOffice:r}=k(e);return!t&&!r})),e},[er,j]),es=!j&&m,el=a.useMemo(()=>{if(!r)return null;if(ei&&ei.length>0)try{return function(e,t=.3,r=14,n={}){let a=e.reduce((e,t)=>{let{isStorefront:r,isOffice:n}=k(t);return n&&(e.hasOffice=!0),n||r||(e.hasResidential=!0),e},{hasOffice:!1,hasResidential:!1}),i=!(a.hasOffice&&a.hasResidential)&&a.hasOffice,s="boolean"==typeof n.includeOfficePremium?n.includeOfficePremium:i,l="boolean"==typeof n.includeStorefrontPremium&&n.includeStorefrontPremium,o="boolean"==typeof n.includeEmployeePremium&&n.includeEmployeePremium,c=e=>{let{isStorefront:t,isOffice:r,isEmployeeRelated:n}=$(e);return(!!l||!t)&&(!!s||!r)&&(!!o||!n)},d={},u=new Set,x=new Set,m=new g.B$(e);if(e.forEach(e=>{let t=e["樓層"]||e.floor||e.layer;if(null==t)return;"number"==typeof t&&(t=String(t)),"number"==typeof t&&(t=String(t));let r=(0,F.n)(e,m);u.add(t),x.add(r),d[t]||(d[t]={}),d[t][r]||(d[t][r]=[]);let n=parseFloat(e["房屋單價(萬)"]||e.unitPrice||0),a=parseFloat(e["交易總價(萬)"]||e.totalPrice||0),i=parseFloat(e["房屋總價(萬)"]||e.housePrice||0),s=parseFloat(e["車位總價(萬)"]||e.parkingPrice||0),l=parseFloat(e["房屋面積(坪)"]||e.houseArea||0),o=e["房數"]||e.rooms,c=e["車位類別"]||e.parkingType||"";"string"==typeof c&&c.includes("車位");let{note:p,isStorefront:h,isOffice:f,isEmployeeRelated:g}=$(e),b=e["交易日"]||e["交易年月日"]||e.transactionDate||"",j=b;if(b&&/^\d{6,7}$/.test(String(b))){let e=String(b),t=6===e.length?2:3;j=`${e.substring(0,t)}/${e.substring(t,t+2)}/${e.substring(t+2)}`}d[t][r].push({...e,unitPrice:n,floor:t,unit:r,transactionDate:j,remark:p,isStorefront:h,isOffice:f,isEmployeeRelated:g,hasParking:s>0,tooltipInfo:{totalPrice:a,housePrice:i,parkingPrice:s,houseArea:l,rooms:o}})}),0===u.size)return{horizontalGrid:{},sortedFloors:[],sortedUnits:[],unitColorMap:{},summary:{totalBaselineHousePrice:0,totalPricePremiumValue:0,totalSoldArea:0,transactionCount:0,calculationFlags:{includesOfficePremium:s,includesStorefrontPremium:l,includesEmployeePremium:o}},horizontalComparison:[]};let p=Array.from(u).sort((e,t)=>{let r=e=>e?e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e)||0:0;return r(t)-r(e)}),h=e=>{let t=String(e||"").trim().toUpperCase(),r=t.match(/^([A-Z]+)(\d+)?$/);return r?{alpha:r[1]||"",num:r[2]?parseInt(r[2],10):Number.MAX_SAFE_INTEGER,raw:t}:{alpha:t,num:Number.MAX_SAFE_INTEGER,raw:t}},f=Array.from(x).sort((e,t)=>{let r=h(e),n=h(t),a=r.alpha.localeCompare(n.alpha,"en");return 0!==a?a:r.num!==n.num?r.num-n.num:r.raw.localeCompare(n.raw,"en")}),b={},j=e=>{if(!e)return null;let t=e.replace(/\//g,"");if(t.length<6)return null;let r=6===t.length?2:3,n=parseInt(t.substring(0,r)),a=parseInt(t.substring(r,r+2));return new Date(1911+n,a-1,parseInt(t.substring(r+2)))},N={};e.forEach(e=>{let t=(0,F.n)(e,m),{note:r}=$(e),n=parseFloat(e["房屋單價(萬)"]||e.unitPrice||0);!(!c(e)||r.includes("特殊")||r.includes("毛胚"))&&n>0&&(N[t]||(N[t]=[]),N[t].push(e))}),Object.keys(N).forEach(e=>{let n=N[e];if(n.sort((e,t)=>(j(e["交易年月日"]||e.transactionDate)?.getTime()||0x9184e729fff)-(j(t["交易年月日"]||t.transactionDate)?.getTime()||0x9184e729fff)),0===n.length)return;let a=j(n[0]["交易年月日"]||n[0].transactionDate);if(!a){b[e]=n.reduce((e,t)=>parseFloat(t["房屋單價(萬)"])<parseFloat(e["房屋單價(萬)"])?t:e,n[0]);return}let i=new Date(a);i.setDate(i.getDate()+r);let s=n.filter(e=>{let t=j(e["交易年月日"]||e.transactionDate);return t&&t<=i}),l=s[0]||n[0],o=1/0;s.forEach(e=>{let r,n=parseFloat(e["房屋單價(萬)"]||0)-((r=String(e["樓層"]))?r.startsWith("B")?-parseInt(r.substring(1)):parseInt(r):0)*t;n<o&&(o=n,l=e)}),b[e]=l});let y=0,v=0,w=0,z=0;Object.keys(d).forEach(e=>{Object.keys(d[e]).forEach(r=>{d[e][r].forEach((n,a)=>{let i=null,s=b[r];if(s&&c(n)){let l=e=>e?e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e):0,o=String(s["樓層"]),c=String(n.floor),u=l(o),x=l(c),m=parseFloat(s["房屋單價(萬)"]||s.unitPrice||0)+(x-u)*t;if(m>0&&(i=(n["房屋單價(萬)"]-m)/m*100,(n===s||.1>Math.abs(n["房屋單價(萬)"]-m))&&(i=0)),n.tooltipInfo.housePrice&&n.tooltipInfo.houseArea){let e=m*n.tooltipInfo.houseArea;y+=e,v+=n.tooltipInfo.housePrice-e,w+=n.tooltipInfo.houseArea,z++}d[e][r][a].theoreticalPrice=m}else i=null,d[e][r][a].theoreticalPrice=null;d[e][r][a].premium=i})})});let P={},S=["#f87171","#fb923c","#fbbf24","#a3e635","#34d399","#22d3ee","#818cf8","#c084fc","#f472b6"];f.forEach((e,t)=>{P[e]=S[t%S.length]});let M={};f.forEach(e=>{M[e]={totalOriginalPriceValue:0,totalActualPriceValue:0,totalSoldArea:0,count:0,anchorPrice:null,anchorFloor:null};let t=b[e];t&&(M[e].anchorPrice=parseFloat(t["房屋單價(萬)"]||0),M[e].anchorFloor=String(t["樓層"]))}),Object.keys(d).forEach(e=>{Object.keys(d[e]).forEach(r=>{d[e][r].forEach(e=>{let n=b[r];if(c(e)&&e.tooltipInfo.houseArea&&n){let a=e=>e?e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e):0,i=a(String(n["樓層"])),s=a(e.floor),l=parseFloat(e["房屋單價(萬)"]||e.unitPrice||0),o=l-(s-i)*t,c=e.tooltipInfo.houseArea;Number.isFinite(o)&&Number.isFinite(l)&&c>0&&M[r]&&(M[r].totalOriginalPriceValue+=o*c,M[r].totalActualPriceValue+=l*c,M[r].totalSoldArea+=c,M[r].count++)}})})});let A=[],E=[],C=null,T=null,O=1/0,D=1/0;Object.keys(M).forEach(e=>{let t=M[e];if(t.totalSoldArea>0){let r=t.totalOriginalPriceValue/t.totalSoldArea,n=t.totalActualPriceValue/t.totalSoldArea;A.push(r),E.push(n),r<O&&(O=r,C=e),n<D&&(D=n,T=e)}});let I=A.length?Math.min(...A):0,R=E.length?Math.min(...E):0,L=Object.keys(M).map(e=>{let t=M[e];if(0===t.count||0===t.totalSoldArea)return null;let r=t.totalOriginalPriceValue/t.totalSoldArea,n=t.totalActualPriceValue/t.totalSoldArea,a=n-r,i=a*t.totalSoldArea;return{unitType:e,anchorInfo:t.anchorPrice?`${t.anchorFloor}F / ${t.anchorPrice}萬`:"N/A",originalHorizontalDiff:r-I,actualHorizontalDiff:n-R,unitsSold:t.count,totalSoldArea:t.totalSoldArea,originalAvgPrice:r,actualAvgPrice:n,avgPremiumPerPing:a,timePremiumContribution:i}}).filter(Boolean),H=L.reduce((e,t)=>e+(t.timePremiumContribution||0),0);return L.forEach(e=>{e.contributionPercentage=H>0?e.timePremiumContribution/H*100:0}),{horizontalGrid:d,sortedFloors:p,sortedUnits:f,unitColorMap:P,summary:{totalBaselineHousePrice:y,totalPricePremiumValue:v,totalSoldArea:w,transactionCount:z,calculationFlags:{includesOfficePremium:s,includesStorefrontPremium:l,includesEmployeePremium:o}},horizontalComparison:L,comparisonMeta:{originalMinUnit:C,originalMinAvg:Number.isFinite(O)?O:null,actualMinUnit:T,actualMinAvg:Number.isFinite(D)?D:null}}}(ei,c,u,{includeOfficePremium:es,includeEmployeePremium:h})}catch(e){console.error("Heatmap generation error:",e)}return K[r]&&K[r].horizontalGrid?K[r]:null},[r,ei,K,c,u,es,h]),eo=a.useMemo(()=>{let e=el?.summary?.calculationFlags;if(!e)return"排除店舖/辦公室";let t=[];return e.includesStorefrontPremium||t.push("店舖"),e.includesOfficePremium||t.push("辦公室"),e.includesEmployeePremium||t.push("員工關係戶"),t.length?`排除${t.join("/")}`:"全部納入"},[el?.summary?.calculationFlags]);return(0,n.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,n.jsx)("div",{className:"flex flex-col gap-4 bg-zinc-900/30 p-4 rounded-lg border border-white/5","data-report-control":"hide",children:(0,n.jsx)("div",{className:"flex flex-col lg:flex-row flex-wrap items-start lg:items-center gap-4",children:(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 w-full lg:w-auto",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-sm text-zinc-400 whitespace-nowrap",children:"選擇建案:"}),(0,n.jsx)("button",{onClick:()=>o(!l),className:`p-1 rounded transition-colors ${l?"text-violet-400 bg-violet-400/10":"text-zinc-500 hover:text-zinc-300"}`,title:l?"切換回下拉選單":"切換手動輸入",children:(0,n.jsx)(A.A,{className:"w-3.5 h-3.5"})})]}),l?(0,n.jsxs)("div",{className:"relative w-full sm:w-[280px]",children:[(0,n.jsx)(S.p,{value:r,onChange:e=>s(e.target.value),placeholder:"輸入建案名稱...",className:"w-full h-9 bg-zinc-950/50 pl-8 pr-4",list:"project-list",autoComplete:"off"}),(0,n.jsx)(E.A,{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-500"}),(0,n.jsx)("datalist",{id:"project-list",children:q.map(e=>(0,n.jsx)("option",{value:e},e))})]}):(0,n.jsxs)(P.l,{value:r,onChange:e=>s(e.target.value),className:"w-full sm:w-[280px] bg-zinc-950/50",children:[(0,n.jsx)("option",{value:"",disabled:!0,children:"請選擇建案..."}),q.map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})]})})}),r&&ei&&ei.length>0&&(0,n.jsx)("div",{"data-report-control":"hide",children:(0,n.jsx)(z.t,{componentName:"FloorDiffAnalyzer",children:(0,n.jsx)(w,{transactions:ei,currentPremium:c,onApply:e=>d(e),onManualChange:e=>d(e)})})}),r&&ei&&ei.length>0&&(0,n.jsx)("div",{"data-report-control":"hide",children:(0,n.jsx)(R,{transactions:ei,project:r})}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-4 p-4 bg-zinc-900/20 rounded-lg border border-white/5",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-xs text-zinc-500",children:"溢價圖例:"}),(0,n.jsxs)("span",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{className:"w-4 h-4 rounded bg-red-500/80"}),(0,n.jsx)("span",{className:"text-xs text-zinc-400",children:"> 5%"})]}),(0,n.jsxs)("span",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{className:"w-4 h-4 rounded bg-orange-500/80"}),(0,n.jsx)("span",{className:"text-xs text-zinc-400",children:"2-5%"})]}),(0,n.jsxs)("span",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{className:"w-4 h-4 rounded bg-yellow-500/80"}),(0,n.jsx)("span",{className:"text-xs text-zinc-400",children:"0-2%"})]}),(0,n.jsxs)("span",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{className:"w-4 h-4 rounded bg-green-500/80"}),(0,n.jsx)("span",{className:"text-xs text-zinc-400",children:"< 0%"})]})]}),(0,n.jsx)("div",{className:"ml-auto"})]}),Q&&(0,n.jsx)(i.c,{title:"建案銷控表與調價熱力圖",description:"可視化建案各戶別的銷售狀況與價格調整幅度",containerRef:U,headerAction:(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[!j&&en.hasOffice&&(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-xs text-zinc-400 whitespace-nowrap",children:"事務所/商辦調價"}),(0,n.jsx)("button",{onClick:()=>p(e=>!e),className:`px-2 h-8 rounded border text-[11px] transition ${m?"border-cyan-400 text-cyan-300 bg-cyan-500/10":"border-white/10 text-zinc-400 hover:text-zinc-200 hover:border-white/30"}`,title:m?"已納入事務所/商辦調價":"排除事務所/商辦調價",children:m?"納入":"排除"}),en.isMixed&&(0,n.jsx)("span",{className:"text-[11px] text-zinc-500 whitespace-nowrap",children:"混合用途預設排除"})]}),ea&&(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-xs text-zinc-400 whitespace-nowrap",children:"員工關係戶調價"}),(0,n.jsx)("button",{onClick:()=>b(e=>!e),className:`px-2 h-8 rounded border text-[11px] transition ${h?"border-cyan-400 text-cyan-300 bg-cyan-500/10":"border-white/10 text-zinc-400 hover:text-zinc-200 hover:border-white/30"}`,title:h?"已納入員工關係戶調價":"排除員工關係戶調價",children:h?"納入":"排除"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 bg-zinc-950/40 border border-white/10 rounded-lg px-2 py-1","data-report-control":"hide",children:[(0,n.jsx)("span",{className:"text-xs text-zinc-400",children:"基準天數"}),(0,n.jsx)(S.p,{type:"number",min:"1",max:"365",value:u,onChange:e=>x(Number(e.target.value)||14),className:"w-16 h-8 bg-zinc-950/50 text-right pr-2"}),(0,n.jsx)("span",{className:"text-xs font-mono text-violet-400 whitespace-nowrap",children:"天"})]}),(0,n.jsx)(I.N,{data:ei||[],filename:`heatmap_grid_${r}`,label:"匯出",chartType:"heatmap-grid",targetRef:U,snapshotData:{projectData:el,floorPremium:c,selectedProject:r}})]}),children:el?(0,n.jsx)(z.t,{componentName:"PricingHeatmap (Grid)",children:(0,n.jsx)(f,{data:el,floorPremium:c,showGrid:!0,showSummary:!1,showComparison:!1})}):(0,n.jsx)("div",{className:"text-zinc-500 text-center p-12",children:"請選擇建案以查看銷控表"})}),J&&el?.summary&&(0,n.jsx)(i.c,{title:`調價幅度統計摘要 (${eo})`,containerRef:X,headerAction:(0,n.jsx)(I.N,{data:[el.summary],filename:`heatmap_stats_${r}`,label:"匯出",chartType:"heatmap-stats",targetRef:X,snapshotData:{summary:el.summary,selectedProject:r}}),children:(0,n.jsx)(z.t,{componentName:"PricingHeatmap (Summary)",children:(0,n.jsx)(f,{data:el,showGrid:!1,showSummary:!0,showComparison:!1})})}),Y&&el?.horizontalComparison&&el.horizontalComparison.length>0&&(0,n.jsx)(i.c,{title:"戶型水平價差與溢價貢獻",containerRef:Z,headerAction:(0,n.jsx)(I.N,{data:el.horizontalComparison,filename:`heatmap_comparison_${r}`,label:"匯出",chartType:"heatmap-comparison",targetRef:Z,snapshotData:{horizontalComparison:el.horizontalComparison,selectedProject:r}}),children:(0,n.jsx)(z.t,{componentName:"PricingHeatmap (Comparison)",children:(0,n.jsx)(f,{data:el,showGrid:!1,showSummary:!1,showComparison:!0,configProject:r,rawTransactions:ei||void 0})})})]})}},56722:(e,t,r)=>{r.d(t,{n:()=>n});let n=(e,t)=>{let r=e?.["戶型"];if("string"==typeof r&&r)return r;let n=t.resolve(e);if(n)return n;let a=e?.["戶別"]||e?.unit||e?.unitName;return"string"==typeof a&&a?a:"?"}},60529:(e,t,r)=>{r.d(t,{p:()=>s});var n=r(95155),a=r(12115),i=r(40980);let s=a.forwardRef(({className:e,type:t,...r},a)=>(0,n.jsx)("input",{type:t,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-zinc-950/50 px-3 py-2 text-sm text-zinc-100 ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...r}));s.displayName="Input"}}]);