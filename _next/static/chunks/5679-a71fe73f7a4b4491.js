"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5679],{39734:(e,r,t)=>{t.d(r,{g:()=>l});var a=t(12115),i=t(27529),c=t(88743),n=t(55873),s=t(98883);function o(e,r){let t=(e.length-1)*r,a=Math.floor(t);return void 0!==e[a+1]?parseFloat((e[a]+(t-a)*(e[a+1]-e[a])).toFixed(2)):parseFloat(e[a].toFixed(2))}function l(){let e=(0,c.P)(),[r,t]=(0,a.useState)(!1),[l,m]=(0,a.useState)(null),u=(0,a.useCallback)(async()=>{t(!0),m(null),e.setAnalysisData(null);try{let l=e.counties.map(e=>n.WG[e]||e);if(0===l.length){m("請至少選擇一個縣市"),t(!1);return}let{dateRange:u,startDate:p,endDate:f}=e;if("custom"!==u&&(!p||!f)){let e=(0,s.P)(u);e.startDate&&e.endDate&&(p=e.startDate,f=e.endDate)}let d={districts:e.districts,transactionType:e.transactionType,type:e.transactionType,projectNames:e.projectNames,buildingType:e.buildingType,excludeCommercial:e.excludeCommercial,floorPremium:e.floorPremium,dateRange:u,dateStart:p,dateEnd:f};console.log("[useAnalysisData] Analyzing with counties:",l);let P=l.map(e=>{let r={...d,countyCode:e,counties:[e]};return i.FH.analyzeProjectRanking(r).catch(r=>(console.error(`Failed to fetch data for ${e}:`,r),null))}),h=await Promise.all(P),y=null,g=0;for(let e of h)if(e&&e.projectRanking&&e.coreMetrics){var r,a,c;console.log("Merging result for county:",e.projectRanking?.[0]?.county),r=y,y=e?r?(e.transactionDetails&&Array.isArray(e.transactionDetails)&&(r.transactionDetails||(r.transactionDetails=[]),r.transactionDetails=[...r.transactionDetails,...e.transactionDetails]),r.coreMetrics=function(e,r){if(!r)return e;if(!e)return r;let t=(e.totalSaleAmount||0)+(r.totalSaleAmount||0),a=(e.totalHouseArea||0)+(r.totalHouseArea||0),i=(e.transactionCount||0)+(r.transactionCount||0);return{totalSaleAmount:t,totalHouseArea:a,overallAveragePrice:a>0?t/a:0,transactionCount:i,medianPrice:0,q1Price:0,q3Price:0,minPrice:Math.min(e.minPrice||1/0,r.minPrice||1/0),maxPrice:Math.max(e.maxPrice||0,r.maxPrice||0)}}(r.coreMetrics,e.coreMetrics),e.projectRanking&&Array.isArray(e.projectRanking)&&(r.projectRanking=[...r.projectRanking,...e.projectRanking]),r.priceBandAnalysis=function(e,r){if(!r)return e;let t=Array.isArray(e)?e:e?.details||[],a=Array.isArray(r)?r:r?.details||[],i=e?.locationCrossTable||{},c=r?.locationCrossTable||{},n=e?.allDistricts||[],s=r?.allDistricts||[],o=e?.allRoomTypes||[],l=r?.allRoomTypes||[],m=new Map,u=e=>{let r=null!==e.bathrooms&&void 0!==e.bathrooms?String(e.bathrooms):"null",t=(e.roomType||"").replace(/\s+/g,""),a=`${t}-${r}`,i=Number(e.count)||0,c=Number(e.avgPrice)||0,n=Number(e.minPrice)||0,s=Number(e.maxPrice)||0;if(m.has(a)){let r=m.get(a),t=Number(r.count)||0,o=Number(r.avgPrice)||0,l=c*i,u=t+i,p=u>0?(o*t+l)/u:0;if(r.count=u,r.avgPrice=parseFloat(p.toFixed(2)),r.minPrice=Math.min(r.minPrice,n),r.maxPrice=Math.max(r.maxPrice,s),e.projectNames){let t=new Set([...r.projectNames,...e.projectNames]);r.projectNames=Array.from(t)}e.byDistrict&&Object.entries(e.byDistrict).forEach(([e,t])=>{r.byDistrict[e]=(r.byDistrict[e]||0)+t})}else m.set(a,{...e,roomType:t,count:i,avgPrice:c,minPrice:n,maxPrice:s,projectNames:e.projectNames?[...e.projectNames]:[],byDistrict:e.byDistrict?{...e.byDistrict}:{}})};t.forEach(u),a.forEach(u);let p={...i};Object.entries(c).forEach(([e,r])=>{p[e]?Object.entries(r).forEach(([r,t])=>{p[e][r]=(p[e][r]||0)+t}):p[e]={...r}});let f=Array.from(new Set([...n,...s])).sort(),d=Array.from(new Set([...o,...l])).sort();return{details:Array.from(m.values()),locationCrossTable:p,allDistricts:f,allRoomTypes:d}}(r.priceBandAnalysis,e.priceBandAnalysis),r.unitPriceAnalysis=function(e,r){if(!r)return e;let t=(e,r)=>{if(!r)return e;if(!e)return r;let t=(e.count||0)+(r.count||0);if(0===t)return e;let a={arithmetic:0,weighted:0},i=(e,r)=>"number"==typeof e.avgPrice?e.weightedAvgPrice||e.avgPrice:e.avgPrice?.[r]||0;["arithmetic","weighted"].forEach(c=>{let n=i(e,c),s=i(r,c);a[c]=(n*(e.count||0)+s*(r.count||0))/t});let c=Math.min(e.minPrice,r.minPrice),n=Math.max(e.maxPrice,r.maxPrice),s=e.minPrice<r.minPrice?e.minPriceProject:r.minPriceProject;return{count:t,avgPrice:a,minPrice:c,maxPrice:n,minPriceProject:s,maxPriceProject:e.maxPrice>r.maxPrice?e.maxPriceProject:r.maxPriceProject,medianPrice:0,q1Price:0,q3Price:0}},a=t(e.residentialStats,r.residentialStats),i=t(e.officeStats,r.officeStats),c=t(e.storeStats,r.storeStats),n=[...e.typeComparison||[]];return r.typeComparison&&(n=[...n,...r.typeComparison]),{residentialStats:a,officeStats:i,storeStats:c,typeComparison:n}}(r.unitPriceAnalysis,e.unitPriceAnalysis),r.transactionDetails&&r.transactionDetails.length>0&&function(e,r){if(!e||!r||0===r.length)return;let t=[],a={price:0,area:0,count:0},i=[],c={price:0,area:0,count:0},n=[],s={price:0,area:0,count:0},l=()=>({minPrice:1/0,maxPrice:-1/0,minRecord:null,maxRecord:null}),m=l(),u=l(),p=l();r.forEach(e=>{let r=e["建物型態"],o=e["主要用途"],l=e["房屋單價(萬)"],f=e["房屋總價(萬)"]||0,d=e["建物移轉總面積"]||0;if("number"!=typeof l||l<=0)return;let P=t,h=a,y=m;r?.includes("店")||"商業用"===o||e["備註"]?.includes("店")?(P=n,h=s,y=p):(r?.includes("辦公")||r?.includes("廠辦")||r?.includes("事務所")||o?.includes("辦公"))&&(P=i,h=c,y=u),P.push(l),h.price+=f,h.area+=d,h.count+=1,l>y.maxPrice&&(y.maxPrice=l,y.maxRecord=e),l<y.minPrice&&(y.minPrice=l,y.minRecord=e)});let f=(e,r,t,a)=>{e&&(function(e,r){if(!r||0===r.length){e.medianPrice=0,e.q1Price=0,e.q3Price=0;return}r.sort((e,r)=>e-r),e.medianPrice=o(r,.5),e.q1Price=o(r,.25),e.q3Price=o(r,.75)}(e,r),e.count=t.count,e.avgPrice=t.count>0?r.reduce((e,r)=>e+r,0)/t.count:0,e.weightedAvgPrice=t.area>0?t.price/t.area:0,a.maxRecord&&(e.maxPrice=a.maxPrice,e.maxPriceProject=a.maxRecord["建案名稱"],e.maxPriceUnit=a.maxRecord["戶型"]||a.maxRecord["戶別"],e.maxPriceFloor=a.maxRecord["樓層"]),a.minRecord&&(e.minPrice=a.minPrice,e.minPriceProject=a.minRecord["建案名稱"],e.minPriceUnit=a.minRecord["戶型"]||a.minRecord["戶別"],e.minPriceFloor=a.minRecord["樓層"]))};e.residentialStats&&f(e.residentialStats,t,a,m),e.officeStats&&f(e.officeStats,i,c,u),e.storeStats&&f(e.storeStats,n,s,p);let d=new Map;r.forEach(e=>{let r=e["建案名稱"];if(!r)return;d.has(r)||d.set(r,{resSum:{price:0,area:0,count:0},shopSum:{price:0,area:0,count:0},officeSum:{price:0,area:0,count:0},county:e["縣市"],district:e["行政區"]});let t=d.get(r),a=e["建物型態"],i=e["主要用途"],c=e["房屋單價(萬)"],n=e["房屋總價(萬)"]||0,s=e["建物移轉總面積"]||0;"number"!=typeof c||c<=0||(a?.includes("店")||"商業用"===i||e["備註"]?.includes("店")?(t.shopSum.price+=n,t.shopSum.area+=s,t.shopSum.count+=1):a?.includes("辦公")||a?.includes("廠辦")||a?.includes("事務所")||i?.includes("辦公")?(t.officeSum.price+=n,t.officeSum.area+=s,t.officeSum.count+=1):(t.resSum.price+=n,t.resSum.area+=s,t.resSum.count+=1))});let P=[];d.forEach((e,r)=>{let t=e.resSum.area>0?e.resSum.price/e.resSum.area:0,a=e.shopSum.area>0?e.shopSum.price/e.shopSum.area:0,i=e.officeSum.area>0?e.officeSum.price/e.officeSum.area:0;t>0&&(a>0||i>0)&&P.push({projectName:r,county:e.county,district:e.district,residentialAvg:t,shopAvg:a,officeAvg:i,shopMultiple:t>0?a/t:0,officeMultiple:t>0?i/t:0})}),P.sort((e,r)=>e.projectName.localeCompare(r.projectName))}(r.unitPriceAnalysis,r.transactionDetails),r.parkingAnalysis=function(e,r){if(!r)return e;let t=e.parkingRatio,a=r.parkingRatio,i=null;if(t&&a){let e=t.withParking.count,r=t.withoutParking.count,c=a.withParking.count,n=a.withoutParking.count,s=e+c,o=r+n,l=s+o;i={withParking:{count:s,percentage:l>0?s/l*100:0},withoutParking:{count:o,percentage:l>0?o/l*100:0}}}else i=t||a;let c=new Map,n=e=>{if(c.has(e.type)){let r=c.get(e.type),t=r.count+e.count,a=r.transactionCount+e.transactionCount,i=r.avgPrice,n=e.avgPrice,s=a>0?(i*r.transactionCount+n*e.transactionCount)/a:0;r.count=t,r.transactionCount=a,r.avgPrice=s}else c.set(e.type,{...e})};(e.avgPriceByType||[]).forEach(n),(r.avgPriceByType||[]).forEach(n);let s=Array.from(c.values()),o=new Map,l=e=>{if(o.has(e.floor)){let r=o.get(e.floor),t=r.count+e.count;e.rawRecords&&(r.rawRecords=[...r.rawRecords||[],...e.rawRecords]);let a=t>0?(r.avgPrice*r.count+e.avgPrice*e.count)/t:0;r.count=t,r.avgPrice=a,r.minPrice=Math.min(r.minPrice,e.minPrice),r.maxPrice=Math.max(r.maxPrice,e.maxPrice),e.maxPrice>r.maxPrice&&(r.maxPriceProject=e.maxPriceProject,r.maxPriceUnit=e.maxPriceUnit,r.maxPriceFloor=e.maxPriceFloor),e.minPrice<r.minPrice&&(r.minPriceProject=e.minPriceProject,r.minPriceUnit=e.minPriceUnit,r.minPriceFloor=e.minPriceFloor)}else o.set(e.floor,{...e,rawRecords:e.rawRecords?[...e.rawRecords]:[]})};return(e.rampPlanePriceByFloor||[]).forEach(l),(r.rampPlanePriceByFloor||[]).forEach(l),{parkingRatio:i,avgPriceByType:s,rampPlanePriceByFloor:Array.from(o.values())}}(r.parkingAnalysis,e.parkingAnalysis),r.salesVelocityAnalysis=function(e,r){if(!r)return e;let t=e.overall||{},a=r.overall||{},i=t.transactionCount||0,c=a.transactionCount||0,n=i+c,s={avgDaysToSell:0,medianDaysToSell:0,fastestSale:0,transactionCount:n};if(n>0){s.avgDaysToSell=((t.avgDaysToSell||0)*i+(a.avgDaysToSell||0)*c)/n;let e=void 0!==t.fastestSale?t.fastestSale:1/0;s.fastestSale=Math.min(e,void 0!==a.fastestSale?a.fastestSale:1/0),s.fastestSale===1/0&&(s.fastestSale=0),s.medianDaysToSell=((t.medianDaysToSell||0)*i+(a.medianDaysToSell||0)*c)/n}let o=new Map,l=e=>{if(!e)return;let r=e.roomType;if(o.has(r)){let t=o.get(r),a=t.count+e.count,i=t.avgDays||0,c=e.avgDays||0;t.avgDays=a>0?(i*t.count+c*e.count)/a:0,t.count=a}else o.set(r,{...e})};(e.byRoomType||[]).forEach(l),(r.byRoomType||[]).forEach(l);let m=Array.from(o.values()),u=Array.from(new Set([...e.allRoomTypes||[],...r.allRoomTypes||[]])),p={};return["monthly","quarterly","yearly","weekly"].forEach(t=>{let a=e[t]||{},i=r[t]||{},c={};new Set([...Object.keys(a),...Object.keys(i)]).forEach(e=>{let r=a[e]||{},t=i[e]||{},n=new Set([...Object.keys(r),...Object.keys(t)]),s={};n.forEach(e=>{let a=r[e],i=t[e];if(a&&i){let r=a.count+i.count,t=a.priceSum+i.priceSum,c=a.areaSum+i.areaSum;s[e]={count:r,priceSum:t,areaSum:c,avgPrice:c>0?t/c:0}}else a?s[e]={...a}:i&&(s[e]={...i})}),c[e]=s}),p[t]=c}),{overall:s,byRoomType:m,allRoomTypes:u,...p}}(r.salesVelocityAnalysis,e.salesVelocityAnalysis),a=r.priceGridAnalysis,r.priceGridAnalysis=(c=e.priceGridAnalysis)?{projectNames:[...a.projectNames||[],...c.projectNames||[]],byProject:{...a.byProject||{},...c.byProject||{}}}:a,r.areaDistributionAnalysis=function(e,r){if(!r)return e;if(!e)return r;let t={...e};return Object.keys(r).forEach(e=>{t[e]?t[e]=[...t[e],...r[e]]:t[e]=[...r[e]]}),t}(r.areaDistributionAnalysis,e.areaDistributionAnalysis),r):JSON.parse(JSON.stringify(e)):r,g++}if(console.log("Aggregation complete. Total Transaction Details:",y?.transactionDetails?.length),0===g){if(e.projectNames.length>0)throw Error("這段時間 這個建案查詢不到資料");throw Error("無法取得任何縣市的分析數據")}if(g<l.length){let e=l.length-g;m(`注意：有 ${e} 個縣市的資料載入失敗，分析結果可能不完整。`)}e.setAnalysisData(y)}catch(e){console.error("Analysis failed:",e),m(e.message||"無法取得分析數據，請稍後再試。")}finally{t(!1)}},[e]);return{loading:r,error:l,analysisData:e.analysisData,handleAnalyze:u,setError:m,setLoading:t,setAnalysisData:e.setAnalysisData}}},95542:(e,r,t)=>{t.d(r,{e:()=>u});var a=t(95155);t(12115);var i=t(9425),c=t(68500),n=t(92289);let s=({className:e})=>(0,a.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:e,children:(0,a.jsx)("path",{d:"M20.26 7.15c0-3.32-3.33-6.14-8.23-6.14S3.8 3.83 3.8 7.15c0 3 2.65 5.56 6.94 6.06l-.26 1.63c-.06.4-.3.94-.8 1.15-.17.07-1.1.26-1.37.3 1.12 3.1 4.54 2.89 5.86 2.3A12.56 12.56 0 0020.26 7.15z"})}),o=({className:e})=>(0,a.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",className:e,children:(0,a.jsx)("path",{d:"M13.54 12a6.8 6.8 0 01-6.77 6.82A6.8 6.8 0 010 12a6.8 6.8 0 016.77-6.82A6.8 6.8 0 0113.54 12zM20.96 12c0 3.54-1.51 6.42-3.38 6.42-1.87 0-3.39-2.88-3.39-6.42s1.52-6.42 3.39-6.42 3.38 2.88 3.38 6.42M24 12c0 3.17-.53 5.75-1.19 5.75-.66 0-1.19-2.58-1.19-5.75s.53-5.75 1.19-5.75C23.47 6.25 24 8.83 24 12z"})}),l=({className:e})=>(0,a.jsx)("svg",{viewBox:"0 0 192 192",fill:"currentColor",className:e,children:(0,a.jsx)("path",{d:"M141.537 88.9883C140.71 88.5919 139.87 88.2104 139.019 87.8451C137.537 60.5382 122.616 44.905 97.5619 44.745C97.4484 44.7443 97.3355 44.7443 97.222 44.7443C82.3586 44.7443 69.0914 53.7377 62.3225 67.7447C55.6389 81.571 56.6666 97.7499 65.0718 111.025C73.477 124.299 87.7554 132.329 103.226 132.329C115.119 132.329 125.759 127.846 131.258 119.539L143.253 126.398C135.201 138.563 118.995 146.16 103.226 146.16C82.7224 146.16 63.8569 135.539 52.7481 117.999C41.6393 100.458 40.2785 79.1176 49.103 60.8576C57.9274 42.5977 75.4057 30.9157 95.0048 30.9157C95.1481 30.9157 95.2917 30.9157 95.4357 30.9168C128.528 31.1278 148.271 51.6833 150.233 87.756C151.096 88.1271 151.947 88.5146 152.786 88.9184C165.734 95.1489 171.185 106.662 168.033 118.273C165.65 127.058 158.463 131.789 148.917 131.789C139.734 131.789 133.097 126.852 129.544 117.399C125.132 125.352 116.828 129.975 107.525 129.975C95.3429 129.975 86.8291 120.706 86.8291 106.918C86.8291 93.3857 95.5332 84.0326 108.01 84.0326C117.069 84.0326 124.908 88.4287 129.289 95.5142C129.356 93.3283 129.421 91.1396 129.502 88.9535C130.334 89.2842 131.18 89.6026 132.037 89.9089C132.096 87.6917 132.164 85.5031 132.227 83.3444C131.171 82.8986 130.089 82.4705 128.981 81.9367C129.141 77.2949 129.324 73.1843 129.52 69.8351C130.297 70.1557 131.066 70.4891 131.826 70.8344C132.203 62.4042 132.247 54.9546 131.776 49.3733C124.162 47.9357 115.424 47.4624 105.77 48.6672C106.262 50.1408 106.772 51.5855 107.301 53.0016C118.067 51.6575 125.594 54.4939 127.886 58.7483C122.99 63.858 115.659 67.2458 107.525 67.2458C95.3856 67.2458 85.508 77.1234 85.508 89.2628C85.508 101.402 95.3856 111.28 107.525 111.28C119.664 111.28 129.542 101.402 129.542 89.2628V89.2612C129.542 89.2612 129.542 89.2612 129.542 89.2604Z"})});function m(){return(0,a.jsxs)("footer",{className:"text-center py-10 mt-12 border-t border-white/5 bg-black/20 text-zinc-500 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center gap-6 flex-wrap px-4",children:[(0,a.jsxs)("a",{href:"https://line.me/R/ti/p/@425ohbmf",target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-2 hover:text-[#06C755] transition-colors",title:"加入 LINE 官方帳號",children:[(0,a.jsx)("div",{className:"p-2 rounded-full bg-zinc-900 group-hover:bg-[#06C755]/10 transition-colors",children:(0,a.jsx)(s,{className:"w-4 h-4"})}),(0,a.jsx)("span",{children:"官方帳號"})]}),(0,a.jsxs)("a",{href:"https://medium.com/@sqmtalk7",target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-2 hover:text-white transition-colors",title:"閱讀開發者日誌",children:[(0,a.jsx)("div",{className:"p-2 rounded-full bg-zinc-900 group-hover:bg-white/10 transition-colors",children:(0,a.jsx)(o,{className:"w-4 h-4"})}),(0,a.jsx)("span",{children:"開發者日誌"})]}),(0,a.jsxs)("a",{href:"https://www.threads.net/@sqm.talk",target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-2 hover:text-white transition-colors",title:"追蹤 Threads",children:[(0,a.jsx)("div",{className:"p-2 rounded-full bg-zinc-900 group-hover:bg-white/10 transition-colors",children:(0,a.jsx)(l,{className:"w-4 h-4"})}),(0,a.jsx)("span",{children:"Threads"})]}),(0,a.jsxs)("a",{href:"mailto:sqmtalk7@gmail.com",className:"group flex items-center gap-2 hover:text-cyan-400 transition-colors",title:"聯絡我們",children:[(0,a.jsx)("div",{className:"p-2 rounded-full bg-zinc-900 group-hover:bg-cyan-500/10 transition-colors",children:(0,a.jsx)(n.A,{className:"w-4 h-4"})}),(0,a.jsx)("span",{children:"Email"})]})]}),(0,a.jsxs)("div",{className:"mt-8 space-y-2 text-xs text-zinc-600",children:[(0,a.jsx)("p",{children:"資料來源：內政部實價登錄"}),(0,a.jsx)("p",{children:"版權所有 \xa9 2025 平米內參. 保留一切權利."})]})]})}function u({children:e}){return(0,a.jsxs)("div",{className:"min-h-screen bg-zinc-950 text-zinc-100 flex",children:[(0,a.jsx)(i.Sidebar,{}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col lg:pl-20 min-w-0 transition-all duration-300",children:[(0,a.jsx)(c.Header,{}),(0,a.jsxs)("main",{className:"flex-1 p-4 md:p-6 lg:p-8",children:[(0,a.jsx)("div",{className:"container-custom py-6 space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500 min-h-[calc(100vh-12rem)]",children:e}),(0,a.jsx)(m,{})]})]})]})}}}]);