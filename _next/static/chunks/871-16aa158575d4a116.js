"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[871],{20871:(e,t,s)=>{s.r(t),s.d(t,{UnitPriceAnalysisReport:()=>u});var a=s(95155),n=s(12115),i=s(68605),r=s(47650),l=s(40980),c=s(60529);let o=({children:e,x:t,y:s,visible:i})=>{let[l,c]=(0,n.useState)(!1);return((0,n.useEffect)(()=>(c(!0),()=>c(!1)),[]),l&&i&&!("u"<typeof document))?(0,r.createPortal)((0,a.jsx)("div",{className:"fixed pointer-events-none z-[9999]",style:{left:t,top:s,transform:"translate(-50%, -100%) translateY(-12px)"},children:e}),document.body):null};function d({data:e,minPrice:t,maxPrice:s,interval:i,sizeMetric:r,onMinPriceChange:d,onMaxPriceChange:x,onIntervalChange:h,onSizeMetricChange:m}){let[u,p]=(0,n.useState)("natural"),[f,g]=(0,n.useState)(null),[b,v]=(0,n.useState)({x:0,y:0}),[j,N]=(0,n.useState)([]),w=(0,n.useRef)(null),[y,z]=(0,n.useState)({width:0,height:0});(0,n.useEffect)(()=>{if(!w.current)return;let e=()=>{w.current&&z({width:w.current.clientWidth,height:w.current.clientHeight})};e(),window.addEventListener("resize",e);let t=setTimeout(e,200);return()=>{window.removeEventListener("resize",e),clearTimeout(t)}},[]),(0,n.useEffect)(()=>{let e=e=>{"Escape"===e.key&&N([])};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]);let M=(e,t)=>{let s=e.currentTarget.getBoundingClientRect();v({x:s.left+s.width/2,y:s.top}),g(t)},{buckets:k,validBuckets:P,maxValue:A}=(0,n.useMemo)(()=>{if(!e||0===e.length)return{buckets:[],validBuckets:[],maxValue:0};let a=[];for(let e=t;e<s;e+=i)a.push({min:e,max:Math.min(e+i,s),label:`${e}-${Math.min(e+i,s)}`,count:0,totalArea:0,avgPrice:0,transactions:[]});e.forEach(e=>{let n=e["房屋單價(萬)"],r=e["房屋面積(坪)"]||0;if("number"!=typeof n||n<t||n>=s)return;let l=Math.floor((n-t)/i);l>=0&&l<a.length&&(a[l].count++,a[l].totalArea+=r,a[l].transactions.push(e))});let n=a.filter(e=>e.count>0),l=Math.max(...n.map(e=>"count"===r?e.count:e.totalArea));return{buckets:a,validBuckets:n,maxValue:l}},[e,t,s,i,r]);(0,n.useEffect)(()=>{let e=new Set(P.map(e=>e.label));N(t=>t.filter(t=>e.has(t)))},[P]);let{nodes:C,onMouseDown:E,dragId:R,consumeWasDragged:S}=((e,t,s,a,i,r)=>{let[l,c]=(0,n.useState)([]),o=(0,n.useRef)(null),d=(0,n.useRef)(null),x=(0,n.useRef)(null),h=(0,n.useRef)(!1),m=(0,n.useRef)(!1);return(0,n.useEffect)(()=>{if(!e.length||!t||!s)return;let n=t/2,r=s/2,l=e.map((e,t)=>{let s="count"===a?e.count:e.totalArea,n=i>0?30+s/i*80:30;return{id:e.label,value:s,radius:n/2,x:0,y:0,vx:0,vy:0,origIndex:t}});l.sort((e,t)=>e.value-t.value),l=l.map((e,t)=>{let s=2.39996*t,a=10*Math.sqrt(t)*2.5;return{...e,x:n+Math.cos(s)*a,y:r+Math.sin(s)*a}});for(let e=0;e<120;e++)for(let e=0;e<l.length;e++)for(let t=e+1;t<l.length;t++){let s=l[e],a=l[t],n=a.x-s.x,i=a.y-s.y,r=n*n+i*i,c=s.radius+a.radius+5;if(r<c*c&&r>0){let e=Math.sqrt(r),t=c-e,l=n/e,o=i/e,d=.5*t;s.x-=l*d,s.y-=o*d,a.x+=l*d,a.y+=o*d}}c(l)},[e,t,s,a,i]),(0,n.useEffect)(()=>{if(!r)return;let e=e=>{x.current={x:e.clientX,y:e.clientY},d.current&&Math.hypot(e.clientX-d.current.startX,e.clientY-d.current.startY)>4&&(h.current=!0)},t=()=>{m.current=h.current,h.current=!1,d.current=null,x.current=null};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[r]),(0,n.useEffect)(()=>{if(!r||0===l.length||!t)return;let e=t/2,a=s/2,n=()=>{c(t=>{let s=t.map(e=>({...e})),n=0,i=0,r=0,l=0;d.current&&x.current&&(n=x.current.x-d.current.startX,i=x.current.y-d.current.startY,r=d.current.nodeOrigX+n,l=d.current.nodeOrigY+i),s.forEach(t=>{if(d.current?.id===t.id)t.x=r,t.y=l,t.vx=0,t.vy=0;else{let s=e-t.x,n=a-t.y;t.vx+=.05*s*.05,t.vy+=.05*n*.05,t.vx+=(Math.random()-.5)*.003,t.vy+=(Math.random()-.5)*.003,t.x+=t.vx,t.y+=t.vy,t.vx*=.94,t.vy*=.94}});for(let e=0;e<6;e++)for(let e=0;e<s.length;e++)for(let t=e+1;t<s.length;t++){let a=s[e],n=s[t],i=d.current?.id===a.id,r=d.current?.id===n.id,l=n.x-a.x,c=n.y-a.y,o=l*l+c*c,x=a.radius+n.radius+5;if(o<x*x&&o>0){let e=Math.sqrt(o),t=x-e,s=l/e,d=c/e,h=.5*t;i?(n.x+=s*t,n.y+=d*t):r?(a.x-=s*t,a.y-=d*t):(a.x-=s*h,a.y-=d*h,n.x+=s*h,n.y+=d*h)}}return s}),o.current=requestAnimationFrame(n)};return o.current=requestAnimationFrame(n),()=>{null!==o.current&&cancelAnimationFrame(o.current)}},[r,t,s,l.length]),{nodes:l,onMouseDown:(e,t,s,a)=>{e.preventDefault(),h.current=!1,d.current={id:t,startX:e.clientX,startY:e.clientY,nodeOrigX:s,nodeOrigY:a},x.current={x:e.clientX,y:e.clientY}},dragId:d.current?.id,consumeWasDragged:()=>{let e=m.current;return m.current=!1,e}}})(P,y.width,y.height,r,A,"natural"===u);if(!e||0===e.length)return(0,a.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無交易資料可顯示"});let $=(e,t)=>{let s,a,n=e/(t-1||1);return n<.33?(s="radial-gradient(circle at 30% 30%, rgb(167, 139, 250), rgb(124, 58, 237))",a="rgba(124, 58, 237, 0.4)"):n<.66?(s="radial-gradient(circle at 30% 30%, rgb(34, 211, 238), rgb(8, 145, 178))",a="rgba(8, 145, 178, 0.4)"):(s="radial-gradient(circle at 30% 30%, rgb(52, 211, 153), rgb(5, 150, 105))",a="rgba(5, 150, 105, 0.4)"),{background:s,shadowColor:a}},L=null!==f?P[f]:null,D=(e,t)=>{t||N(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},T=(e,t="bottom")=>(0,a.jsxs)("div",{className:"pointer-events-none px-4 py-3 bg-zinc-900/90 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl min-w-[160px]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-xs font-medium text-zinc-400",children:"成交單價"}),(0,a.jsx)("span",{className:"text-sm font-bold text-white",children:e.label})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center text-xs",children:[(0,a.jsx)("span",{className:"text-zinc-500",children:"成交筆數"}),(0,a.jsxs)("span",{className:"font-medium text-violet-300",children:[e.count," 筆"]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center text-xs",children:[(0,a.jsx)("span",{className:"text-zinc-500",children:"總銷坪數"}),(0,a.jsxs)("span",{className:"font-medium text-cyan-300",children:[Math.round(e.totalArea)," 坪"]})]})]}),(0,a.jsx)("div",{className:(0,l.cn)("absolute left-1/2 w-2 h-2 bg-zinc-900/90 rotate-45 -translate-x-1/2","bottom"===t?"bottom-0 -mb-1 border-r border-b border-white/10":"top-0 -mt-1 border-l border-t border-white/10")})]});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(o,{x:b.x,y:b.y,visible:null!==f&&!!L&&!R,children:L&&(0,a.jsx)("div",{className:"animate-in fade-in zoom-in-95 duration-200",children:T(L)})}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4 p-4 bg-zinc-900/30 border border-white/5 rounded-xl","data-report-control":"hide",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-zinc-400 text-xs",children:"單價範圍"}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(c.p,{type:"number",value:t,onChange:e=>d(Number(e.target.value)),className:"w-16 h-7 text-xs bg-zinc-950/50 border-white/10 px-2"}),(0,a.jsx)("span",{className:"text-zinc-600",children:"-"}),(0,a.jsx)(c.p,{type:"number",value:s,onChange:e=>x(Number(e.target.value)),className:"w-16 h-7 text-xs bg-zinc-950/50 border-white/10 px-2"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-zinc-400 text-xs",children:"級距"}),(0,a.jsx)(c.p,{type:"number",value:i,onChange:e=>h(Number(e.target.value)),className:"w-14 h-7 text-xs bg-zinc-950/50 border-white/10 px-2"})]}),(0,a.jsxs)("div",{className:"flex bg-zinc-950/50 rounded-md p-0.5 border border-white/10",children:[(0,a.jsx)("button",{onClick:()=>m("count"),className:(0,l.cn)("px-2.5 py-1 text-[10px] rounded transition-colors","count"===r?"bg-violet-500 text-white shadow-sm":"text-zinc-400 hover:text-white"),children:"成交筆數"}),(0,a.jsx)("button",{onClick:()=>m("area"),className:(0,l.cn)("px-2.5 py-1 text-[10px] rounded transition-colors","area"===r?"bg-violet-500 text-white shadow-sm":"text-zinc-400 hover:text-white"),children:"總銷坪數"})]})]}),(0,a.jsxs)("div",{className:"bg-zinc-950/50 p-1 rounded-lg border border-white/5 flex gap-1",children:[(0,a.jsx)("button",{onClick:()=>p("natural"),className:(0,l.cn)("px-3 py-1.5 text-xs font-medium rounded-md transition-all duration-300","natural"===u?"bg-gradient-to-r from-violet-600 to-indigo-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-500 hover:text-zinc-300"),children:(0,a.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,a.jsxs)("span",{className:"relative flex h-2 w-2",children:[(0,a.jsx)("span",{className:(0,l.cn)("absolute inline-flex h-full w-full rounded-full bg-violet-400 opacity-75","natural"===u&&"animate-ping")}),(0,a.jsx)("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-violet-500"})]}),"無重力模式"]})}),(0,a.jsx)("button",{onClick:()=>p("coordinate"),className:(0,l.cn)("px-3 py-1.5 text-xs font-medium rounded-md transition-all duration-300","coordinate"===u?"bg-gradient-to-r from-violet-600 to-indigo-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-500 hover:text-zinc-300"),children:(0,a.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,a.jsxs)("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,a.jsx)("path",{d:"M3 3v18h18"}),(0,a.jsx)("path",{d:"M18 17V9"}),(0,a.jsx)("path",{d:"M13 17V5"}),(0,a.jsx)("path",{d:"M8 17v-3"})]}),"座標模式"]})})]})]}),(0,a.jsxs)("div",{ref:w,className:(0,l.cn)("relative rounded-3xl overflow-hidden border border-white/5 transition-all duration-500","bg-gradient-to-b from-zinc-900 via-zinc-900 to-zinc-950","h-full min-h-[500px]"),onClick:()=>N([]),children:[(0,a.jsxs)("div",{className:"absolute inset-0 pointer-events-none",children:[(0,a.jsx)("div",{className:"absolute top-0 inset-x-0 h-px bg-gradient-to-r from-transparent via-white/10 to-transparent"}),(0,a.jsx)("div",{className:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-violet-500/10 rounded-full blur-[100px]"}),(0,a.jsx)("div",{className:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-cyan-500/10 rounded-full blur-[100px]"})]}),(0,a.jsxs)("div",{className:"absolute inset-0",children:["natural"===u&&(0,a.jsxs)("div",{className:"absolute inset-0",children:[C.map((e,t)=>{var s,n;let i=f===e.origIndex,c=R===e.id,o=P[e.origIndex],d=o?.label,x=!!d&&j.includes(d),h=$(e.origIndex,P.length),m=2*e.radius,u=(s=e.y)-(n=e.radius)-90<0&&s+n+90<y.height?"bottom":s+n+90>y.height&&s-n-90>0?"top":s<y.height/2?"bottom":"top";return(0,a.jsxs)("div",{className:(0,l.cn)("absolute block rounded-full select-none cursor-grab active:cursor-grabbing will-change-transform",c?"z-[100] scale-110 shadow-2xl":"transition-[transform,box-shadow] duration-75 ease-linear"),style:{width:m,height:m,left:0,top:0,transform:`translate(${e.x-e.radius}px, ${e.y-e.radius}px) scale(${i||c?1.1:1})`,background:h.background,boxShadow:c?`0 25px 50px -12px ${h.shadowColor}, inset 0 2px 20px rgba(255,255,255,0.6)`:i?`0 20px 40px -10px ${h.shadowColor}, inset 0 2px 20px rgba(255,255,255,0.4)`:`0 10px 30px -10px ${h.shadowColor}, inset 0 2px 10px rgba(255,255,255,0.2)`,zIndex:c?100:i?50:10},onMouseEnter:t=>M(t,e.origIndex),onMouseLeave:()=>g(null),onMouseDown:t=>E(t,e.id,e.x,e.y),onClick:e=>{e.stopPropagation(),d&&D(d,S())},children:[(0,a.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-white/0 via-white/0 to-white/30 opacity-50 pointer-events-none"}),(0,a.jsx)("div",{className:"absolute top-[15%] left-[15%] w-[25%] h-[15%] rounded-[100%] bg-white blur-[2px] opacity-40 transform -rotate-45 pointer-events-none"}),(0,a.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-center z-20 pointer-events-none",children:[(0,a.jsx)("div",{className:(0,l.cn)("font-bold text-white drop-shadow-md leading-none",m>80?"text-2xl":m>60?"text-lg":"text-sm","mix-blend-overlay opacity-90"),children:e.value>=1?Math.round(e.value):e.value.toFixed(1)}),m>80&&(0,a.jsx)("div",{className:"text-[10px] text-white/70 mt-1 font-medium tracking-wide",children:"count"===r?"筆":"坪"})]}),o&&x&&(0,a.jsx)("div",{className:(0,l.cn)("absolute left-1/2 z-[110]","top"===u?"-top-3 -translate-x-1/2 -translate-y-full":"top-full mt-3 -translate-x-1/2"),children:T(o,"top"===u?"bottom":"top")})]},e.id)}),(0,a.jsx)("div",{className:"absolute bottom-4 left-0 right-0 text-center text-xs text-zinc-500 font-medium tracking-widest uppercase opacity-50 pointer-events-none",children:"Zero Gravity • Force Layout • Draggable"})]}),"coordinate"===u&&(0,a.jsxs)("div",{className:"absolute inset-0 pt-6 pb-8 px-0",children:[(0,a.jsx)("div",{className:"flex flex-col justify-between h-full py-0 pr-1 text-right w-[46px] border-r border-white/5 relative z-10 float-left",children:[...Array(6)].map((e,n)=>(0,a.jsx)("span",{className:"text-xs font-mono text-zinc-600 block leading-none transform -translate-y-1/2 first:translate-y-0 last:-translate-y-full",children:Math.round(s-(s-t)/5*n)},n))}),(0,a.jsxs)("div",{className:"relative ml-[46px] h-full",children:[(0,a.jsx)("div",{className:"absolute inset-0 flex flex-col justify-between pointer-events-none",children:[...Array(6)].map((e,t)=>(0,a.jsx)("div",{className:"w-full h-px border-t border-dashed border-zinc-800"},t))}),(0,a.jsx)("div",{className:"absolute inset-0",children:P.map((e,n)=>{var i;let c,o=(i="count"===r?e.count:e.totalArea,0===A?40:40+i/A*100),d=(e.min+e.max)/2,x=(c=e.label,j.includes(c)),h=n/(P.length-1||1)*90+5,m=100-(d-t)/(s-t)*100,u=f===n,p=$(n,P.length);return(0,a.jsxs)("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 transition-all duration-500",style:{left:`${h}%`,top:`${m}%`,zIndex:u?50:20},onMouseEnter:e=>M(e,n),onMouseLeave:()=>g(null),children:[(0,a.jsx)("div",{className:(0,l.cn)("relative rounded-full flex items-center justify-center cursor-pointer shadow-lg transition-transform duration-300",u?"scale-110":"scale-100"),style:{width:o,height:o,background:p.background,boxShadow:u?`0 10px 20px -5px ${p.shadowColor}, inset 0 2px 10px rgba(255,255,255,0.3)`:`0 5px 15px -5px ${p.shadowColor}, inset 0 2px 5px rgba(255,255,255,0.2)`},onClick:t=>{t.stopPropagation(),D(e.label)},children:(0,a.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-transparent to-white/30 opacity-60"})}),x&&(0,a.jsx)("div",{className:"absolute left-1/2 -top-3 -translate-x-1/2 -translate-y-full z-[60]",children:T(e)})]},e.label)})}),(0,a.jsxs)("div",{className:"absolute bottom-0 inset-x-0 flex justify-between text-xs text-zinc-600 font-mono translate-y-full pt-1 px-2",children:[(0,a.jsx)("span",{children:"Low Price"}),(0,a.jsx)("span",{children:"High Price"})]})]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between px-2 text-xs text-zinc-500",children:[(0,a.jsxs)("div",{children:["* Bubble size represents ","count"===r?"Transaction Count":"Total Area"]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-violet-500"}),(0,a.jsx)("span",{children:"Low"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-cyan-500"}),(0,a.jsx)("span",{children:"Mid"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),(0,a.jsx)("span",{children:"High"})]})]})]})]})}function x({title:e,stats:t,noDataMessage:s="無資料",className:n,averageType:i="weighted"}){if(!t||0===t.count)return(0,a.jsxs)("div",{className:(0,l.cn)("p-6 border border-white/5 rounded-lg bg-zinc-900/30",n),children:[(0,a.jsx)("h3",{className:"text-zinc-400 font-medium mb-4",children:e}),(0,a.jsx)("p",{className:"text-zinc-500 text-center py-4",children:s})]});let r="weighted"===i&&t.weightedAvgPrice?t.weightedAvgPrice:t.avgPrice;return(0,a.jsxs)("div",{className:(0,l.cn)("p-6 border border-white/5 rounded-lg bg-zinc-900/30",n),children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:e}),(0,a.jsxs)("span",{className:"text-xs text-zinc-500 bg-zinc-800 px-2 py-1 rounded",children:["樣本數: ",t.count]})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,a.jsx)("div",{className:"space-y-1",children:(0,a.jsx)("table",{className:"w-full text-sm",children:(0,a.jsxs)("tbody",{className:"divide-y divide-white/5",children:[(0,a.jsxs)("tr",{className:"group",children:[(0,a.jsx)("td",{className:"py-2 text-zinc-400 whitespace-nowrap pr-4",children:"weighted"===i?"加權平均單價":"算術平均單價"}),(0,a.jsx)("td",{className:"py-2 text-right font-mono text-white group-hover:text-cyan-400 transition-colors pl-4 whitespace-nowrap",children:(0,a.jsxs)("span",{className:"inline-flex items-baseline gap-1",children:[(0,l.Z)(r),(0,a.jsx)("span",{className:"text-[10px] text-zinc-500",children:"萬/坪"})]})})]}),(0,a.jsxs)("tr",{className:"group",children:[(0,a.jsx)("td",{className:"py-2 text-zinc-400",children:"最低單價"}),(0,a.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors whitespace-nowrap",children:(0,a.jsxs)("span",{className:"inline-flex items-baseline gap-1",children:[(0,l.Z)(t.minPrice),(0,a.jsx)("span",{className:"text-[10px] text-zinc-500",children:"萬/坪"})]})})]}),(0,a.jsxs)("tr",{className:"group",children:[(0,a.jsx)("td",{className:"py-2 text-zinc-400",children:"1/4分位數"}),(0,a.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors whitespace-nowrap",children:(0,a.jsxs)("span",{className:"inline-flex items-baseline gap-1",children:[(0,l.Z)(t.q1Price),(0,a.jsx)("span",{className:"text-[10px] text-zinc-500",children:"萬/坪"})]})})]}),(0,a.jsxs)("tr",{className:"group",children:[(0,a.jsx)("td",{className:"py-2 text-violet-400 font-medium",children:"中位數單價"}),(0,a.jsx)("td",{className:"py-2 text-right font-mono text-violet-400 font-bold whitespace-nowrap",children:(0,a.jsxs)("span",{className:"inline-flex items-baseline gap-1",children:[(0,l.Z)(t.medianPrice),(0,a.jsx)("span",{className:"text-[10px] text-violet-300",children:"萬/坪"})]})})]}),(0,a.jsxs)("tr",{className:"group",children:[(0,a.jsx)("td",{className:"py-2 text-zinc-400",children:"3/4分位數"}),(0,a.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors whitespace-nowrap",children:(0,a.jsxs)("span",{className:"inline-flex items-baseline gap-1",children:[(0,l.Z)(t.q3Price),(0,a.jsx)("span",{className:"text-[10px] text-zinc-500",children:"萬/坪"})]})})]}),(0,a.jsxs)("tr",{className:"group",children:[(0,a.jsx)("td",{className:"py-2 text-zinc-400",children:"最高單價"}),(0,a.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors whitespace-nowrap",children:(0,a.jsxs)("span",{className:"inline-flex items-baseline gap-1",children:[(0,l.Z)(t.maxPrice),(0,a.jsx)("span",{className:"text-[10px] text-zinc-500",children:"萬/坪"})]})})]})]})})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,a.jsxs)("div",{className:"p-3 bg-zinc-950/50 rounded border border-white/5",children:[(0,a.jsx)("div",{className:"text-cyan-500 font-medium mb-1 text-[10px] uppercase tracking-wider",children:"最高價建案"}),(0,a.jsx)("div",{className:"text-white font-bold text-base mb-1 truncate",title:t.maxPriceProject||"",children:t.maxPriceProject||"N/A"}),(0,a.jsxs)("div",{className:"flex gap-3 text-zinc-400 text-[10px]",children:[(0,a.jsxs)("span",{children:["戶別: ",t.maxPriceUnit||"-"]}),(0,a.jsxs)("span",{children:["樓層: ",t.maxPriceFloor||"-"]})]})]}),(0,a.jsxs)("div",{className:"p-3 bg-zinc-950/50 rounded border border-white/5",children:[(0,a.jsx)("div",{className:"text-green-500 font-medium mb-1 text-[10px] uppercase tracking-wider",children:"最低價建案"}),(0,a.jsx)("div",{className:"text-white font-bold text-base mb-1 truncate",title:t.minPriceProject||"",children:t.minPriceProject||"N/A"}),(0,a.jsxs)("div",{className:"flex gap-3 text-zinc-400 text-[10px]",children:[(0,a.jsxs)("span",{children:["戶別: ",t.minPriceUnit||"-"]}),(0,a.jsxs)("span",{children:["樓層: ",t.minPriceFloor||"-"]})]})]})]})]})]})}function h({data:e,expandAll:t=!1}){if(!e||0===e.length)return(0,a.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無符合條件的建案可進行類型比較"});let s=Math.max(...e.map(e=>e.shopMultiple),1),n=Math.max(...e.map(e=>e.officeMultiple),1);return(0,a.jsx)("div",{className:(0,l.cn)("overflow-x-auto relative scrollbar-thin scrollbar-thumb-zinc-700 scrollbar-track-transparent",t?"overflow-y-visible":"max-h-[600px] overflow-y-auto"),children:(0,a.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,a.jsx)("thead",{className:"sticky top-0 z-10 bg-zinc-900 text-zinc-400 font-semibold uppercase text-xs shadow-md",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-3 whitespace-nowrap",children:"建案名稱"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right",children:"住宅均價"}),(0,a.jsxs)("th",{className:"px-4 py-3 text-right",children:["店舖均價 ",(0,a.jsx)("span",{className:"text-[10px] text-zinc-500 font-normal ml-1",children:"/ 倍數"})]}),(0,a.jsxs)("th",{className:"px-4 py-3 text-right",children:["事務所均價 ",(0,a.jsx)("span",{className:"text-[10px] text-zinc-500 font-normal ml-1",children:"/ 倍數"})]})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-white/5",children:e.map((e,t)=>(0,a.jsxs)("tr",{className:"hover:bg-zinc-800/30 transition-colors",children:[(0,a.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap",children:[(0,a.jsx)("div",{className:"font-medium text-white",children:e.projectName}),(0,a.jsxs)("div",{className:"text-xs text-zinc-500 flex gap-1 mt-0.5",children:[e.county&&(0,a.jsx)("span",{className:"bg-zinc-800 px-1 rounded",children:e.county}),e.district&&(0,a.jsx)("span",{className:"bg-zinc-800 px-1 rounded",children:e.district})]})]}),(0,a.jsx)("td",{className:"px-4 py-3 text-right font-mono text-zinc-300",children:e.residentialAvg>0?(0,l.Z)(e.residentialAvg):"-"}),(0,a.jsxs)("td",{className:"px-4 py-3 text-right",children:[(0,a.jsx)("div",{className:"font-mono text-zinc-300",children:e.shopAvg>0?(0,l.Z)(e.shopAvg):"-"}),e.shopMultiple>0&&(0,a.jsxs)("div",{className:"flex flex-col gap-1 mt-1.5 w-[80px] ml-auto",children:[(0,a.jsx)("div",{className:"h-1 bg-zinc-800 rounded-full overflow-hidden w-full",children:(0,a.jsx)("div",{className:"h-full bg-violet-600 rounded-full",style:{width:`${Math.min(e.shopMultiple/s*100,100)}%`}})}),(0,a.jsxs)("div",{className:"text-[10px] text-right text-violet-400 font-medium",children:[e.shopMultiple.toFixed(2),"x"]})]})]}),(0,a.jsxs)("td",{className:"px-4 py-3 text-right",children:[(0,a.jsx)("div",{className:"font-mono text-zinc-300",children:e.officeAvg>0?(0,l.Z)(e.officeAvg):"-"}),e.officeMultiple>0&&(0,a.jsxs)("div",{className:"flex flex-col gap-1 mt-1.5 w-[80px] ml-auto",children:[(0,a.jsx)("div",{className:"h-1 bg-zinc-800 rounded-full overflow-hidden w-full",children:(0,a.jsx)("div",{className:"h-full bg-cyan-600 rounded-full",style:{width:`${Math.min(e.officeMultiple/n*100,100)}%`}})}),(0,a.jsxs)("div",{className:"text-[10px] text-right text-cyan-400 font-medium",children:[e.officeMultiple.toFixed(2),"x"]})]})]})]},t))})]})})}var m=s(89733);function u({data:e,visibleSections:t=["stats","comparison","chart"],comparisonExpandAll:s=!1}){let[r,c]=(0,n.useState)("weighted"),[o,u]=(0,n.useState)(30),[p,f]=(0,n.useState)(150),[g,b]=(0,n.useState)(5),[v,j]=(0,n.useState)("count"),N=n.useRef(null),w=n.useRef(null),y=n.useRef(null),z=e?.transactionDetails||[],M=e?.unitPriceAnalysis,k=M?.residentialStats,P=M?.officeStats,A=M?.storeStats,C=M?.typeComparison;return e&&(z.length||M)?(0,a.jsxs)("div",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[t.includes("stats")&&(0,a.jsx)(i.c,{title:"各用途單價統計",containerRef:N,headerAction:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-zinc-400 text-xs",children:"平均類型:"}),(0,a.jsxs)("div",{className:"flex bg-zinc-950/50 rounded-md p-1 border border-white/5",children:[(0,a.jsx)("button",{onClick:()=>c("arithmetic"),className:(0,l.cn)("px-2 py-0.5 text-[10px] rounded transition-colors","arithmetic"===r?"bg-violet-500 text-white":"text-zinc-500 hover:text-white"),children:"算術"}),(0,a.jsx)("button",{onClick:()=>c("weighted"),className:(0,l.cn)("px-2 py-0.5 text-[10px] rounded transition-colors","weighted"===r?"bg-violet-500 text-white":"text-zinc-500 hover:text-white"),children:"加權"})]})]}),(0,a.jsx)(m.N,{data:[k,P,A],filename:"unit_price_stats",label:"匯出",chartType:"unit-price-stats",targetRef:N,snapshotData:{residentialStats:k,officeStats:P,storeStats:A,averageType:r}})]}),children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsx)(x,{title:"住宅建案統計",stats:k,noDataMessage:"無住宅交易數據",className:"border-violet-500/20",averageType:r}),(0,a.jsx)(x,{title:"一般事務所/辦公室統計",stats:P,noDataMessage:"無事務所/辦公室交易數據",className:"border-cyan-500/20",averageType:r}),(0,a.jsx)(x,{title:"店舖統計",stats:A,noDataMessage:"無店舖交易數據",className:"border-amber-500/20",averageType:r})]})}),(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6 items-stretch",children:[t.includes("comparison")&&C&&C.length>0&&(0,a.jsx)("div",{className:"flex-1 min-w-0 flex flex-col",children:(0,a.jsx)(i.c,{title:"建案產品類型單價比較",description:"同一建案內不同用途（住宅/店面/事務所）的單價與倍數比較",containerRef:w,headerAction:(0,a.jsx)(m.N,{data:C,filename:"type_comparison_data",label:"匯出",chartType:"type-comparison-table",targetRef:w,snapshotData:C,columns:{projectName:"建案",residentialAvg:"住宅均價",officeAvg:"辦公均價",storeAvg:"店舖均價",officeRatio:"辦公倍數",storeRatio:"店舖倍數"}}),className:"h-full",children:(0,a.jsx)(h,{data:C,expandAll:s})})}),t.includes("chart")&&(0,a.jsx)("div",{className:"flex-1 min-w-0 flex flex-col",children:(0,a.jsx)(i.c,{title:"單價分佈泡泡圖",description:"分析各單價區間的成交熱度與分佈密集區",containerRef:y,headerAction:(0,a.jsx)(m.N,{data:z,filename:"bubble_chart_source_data",label:"匯出",chartType:"unit-price-bubble",targetRef:y,snapshotData:z}),className:"h-full",children:(0,a.jsx)(d,{data:z,minPrice:o,maxPrice:p,interval:g,sizeMetric:v,onMinPriceChange:u,onMaxPriceChange:f,onIntervalChange:b,onSizeMetricChange:j})})})]})]}):null}}}]);