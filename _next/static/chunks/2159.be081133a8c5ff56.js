"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2159],{17709:(e,t,r)=>{r.r(t),r.d(t,{MapPriceBandReport:()=>x});var n=r(95155),s=r(12115),o=r(72566),l=r(826),i=r(70241),c=r(64873),a=r(40980),d=r(88743);function x({data:e,visibleSections:t=["chart","table","location-table","location-chart"]}){let{selectedRoomTypes:r,setSelectedRoomTypes:x,districts:m}=(0,d.P)(),p=["套房","1房","2房","3房","4房","毛胚"],h=s.useRef(null),u=s.useRef(null),f=s.useRef(null),b=s.useRef(null),g=s.useRef(`price-band-location-${Math.random().toString(36).slice(2,8)}`).current,[j,y]=(0,s.useState)("district"),[N,w]=(0,s.useState)(!1),[v,z]=(0,s.useState)(""),[P,S]=(0,s.useState)([]),[E,T]=(0,s.useState)(null),k=e=>{if(!e)return"";let t=String(e).replace(/\s+/g,"");return/^\d+$/.test(t)?`${t}房`:t},M=(0,s.useMemo)(()=>{if(!e?.transactionDetails)return[];let t=new Set;return e.transactionDetails.forEach(e=>{e["縣市"]&&t.add(e["縣市"])}),Array.from(t).sort()},[e?.transactionDetails]);s.useEffect(()=>{0===M.length?T(null):1===M.length?T(M[0]):E&&!M.includes(E)&&T(null)},[M,E]);let $=(e,t,r)=>{z(`${e}${null!==t?` / ${t}衛`:""} 建案組成`),S(r),w(!0)};if(!e||!e.details||0===e.details.length)return null;let{details:C,locationCrossTable:L,allDistricts:R,transactionDetails:q}=e,A=(0,s.useMemo)(()=>C.filter(e=>r.includes(e.roomType)),[C,r]),[D,I]=(0,s.useState)(!0),O=t.includes("table")||t.includes("chart"),F=(0,s.useMemo)(()=>{let t=new Set;return e?.details&&e.details.length>0?e.details.forEach(e=>{let r=k(e.roomType);r&&t.add(r)}):e?.transactionDetails&&e.transactionDetails.length>0&&e.transactionDetails.forEach(e=>{let r=k(e["房型"]||e.roomType||e["戶型"]||e["房數"]);r&&t.add(r)}),Array.from(t).sort()},[e?.details,e?.transactionDetails]),_=(0,s.useMemo)(()=>{let e=F.filter(e=>!d.M.includes(e));return[...d.M,...e]},[F]);s.useEffect(()=>{if(0===F.length)return;let e=r.filter(e=>F.includes(e)),t=e.length>0?e:[...F];t.length===r.length&&t.every((e,t)=>e===r[t])||x(t)},[F.join("|"),r,x]);let B=(0,s.useMemo)(()=>{let e=C.filter(e=>r.includes(e.roomType));if(!D)return e;let t=new Map;return e.forEach(e=>{let r=e.roomType;t.has(r)||t.set(r,{...e,bathrooms:null,projectNames:e.projectNames?[...e.projectNames]:[],count:0,avgPrice:0});let n=t.get(r),s=n.avgPrice*n.count,o=e.avgPrice*e.count,l=n.count+e.count;n.count=l,n.avgPrice=l>0?(s+o)/l:0,n.minPrice=Math.min(n.minPrice,e.minPrice),n.maxPrice=Math.max(n.maxPrice,e.maxPrice);let i=n.count-e.count,c=e.count;if(n.medianPrice=(n.medianPrice*i+e.medianPrice*c)/l,n.q1Price=(n.q1Price*i+e.q1Price*c)/l,n.q3Price=(n.q3Price*i+e.q3Price*c)/l,e.projectNames){let t=new Set([...n.projectNames||[],...e.projectNames]);n.projectNames=Array.from(t)}}),Array.from(t.values()).sort((e,t)=>p.indexOf(e.roomType)-p.indexOf(t.roomType))},[C,r,D,p]),H=(0,s.useMemo)(()=>{if("county"===j&&q){let e={},t=new Set;q.forEach(r=>{let n=r["房型"]||r.roomType||r["戶型"];if(!n||"其他"===n){let e=Number(r["房數"]);n=!isNaN(e)&&e>0?`${e}房`:"其他"}let s="string"==typeof n?n.replace(/\s+/g,""):n;("number"==typeof s||"string"==typeof s&&/^\d+$/.test(s))&&(s=`${s}房`);let o=r["縣市"]||"未知";e[s]||(e[s]={}),e[s][o]=(e[s][o]||0)+1,t.add(o)});let n=Array.from(t).sort(),s={},o=0;n.forEach(e=>s[e]=0);let l=r.map(t=>{let r=e[t]||{},l=0,i=n.map(e=>{let t=r[e]||0;return l+=t,s[e]+=t,t});return o+=l,{roomType:t,cells:i,rowTotal:l}});return{locations:n,rows:l,locationTotals:s,grandTotal:o}}if("district"===j){let e={},t=new Set;if(q)q.forEach(r=>{let n=r["房型"]||r.roomType||r["戶型"];if(!n||"其他"===n){let e=Number(r["房數"]);n=!isNaN(e)&&e>0?`${e}房`:"其他"}let s="string"==typeof n?n.replace(/\s+/g,""):n;("number"==typeof s||"string"==typeof s&&/^\d+$/.test(s))&&(s=`${s}房`);let o=r["行政區"]||"未知",l=r["縣市"]||"未知";E&&l!==E||(e[s]||(e[s]={}),e[s][o]=(e[s][o]||0)+1,t.add(o))}),E||(R&&R.length>0?R:m).forEach(e=>t.add(e));else if(L){let n=new Set;r.forEach(e=>{let t=L[e];t&&Object.keys(t).forEach(e=>n.add(e))}),n.forEach(e=>t.add(e)),E||(R&&R.length>0?R:m).forEach(e=>t.add(e)),r.forEach(t=>{let r=L[t];r&&(e[t]=r)})}let n=Array.from(t).sort(),s={},o=0;n.forEach(e=>s[e]=0);let l=r.map(t=>{let r=e[t]||{},l=0,i=n.map(e=>{let t=r[e]||0;return l+=t,s[e]+=t,t});return o+=l,{roomType:t,cells:i,rowTotal:l}});return{locations:n,rows:l,locationTotals:s,grandTotal:o}}return null},[L,q,r,j,E]),[Q,U]=(0,s.useState)(new Set);(0,s.useMemo)(()=>H?H.rows.map(e=>{let t={房型:e.roomType};return H.locations.forEach((r,n)=>{t[r]=e.cells[n]}),t["總計"]=e.rowTotal,t}):[],[H]);let W=e=>(0,n.jsxs)("div",{className:(0,a.cn)("flex bg-zinc-800 rounded-md p-0.5 border border-white/5",e),children:[(0,n.jsx)("button",{onClick:()=>y("district"),"data-report-control":"allow",className:(0,a.cn)("px-2 py-1 text-xs rounded transition-colors","district"===j?"bg-zinc-700 text-white":"text-zinc-400 hover:text-white"),children:"行政區"}),(0,n.jsx)("button",{onClick:()=>y("county"),"data-report-control":"allow",className:(0,a.cn)("px-2 py-1 text-xs rounded transition-colors","county"===j?"bg-zinc-700 text-white":"text-zinc-400 hover:text-white"),children:"縣市"})]}),X=()=>"district"!==j||M.length<=1?null:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"text-sm text-zinc-500",children:"顯示縣市:"}),(0,n.jsxs)("div",{className:"flex gap-1 bg-zinc-900 p-1 rounded-lg",children:[(0,n.jsx)("button",{onClick:()=>T(null),"data-report-control":"allow",className:(0,a.cn)("px-3 py-1 text-xs font-medium rounded-md transition-all",E?"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800":"bg-violet-500/20 text-violet-300 shadow-sm border border-violet-500/50"),children:"全部"}),M.map(e=>(0,n.jsx)("button",{onClick:()=>T(e),"data-report-control":"allow",className:(0,a.cn)("px-3 py-1 text-xs font-medium rounded-md transition-all",E===e?"bg-violet-500/20 text-violet-300 shadow-sm border border-violet-500/50":"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800"),children:e},e))]})]}),Y=e=>C.filter(t=>t.roomType===e).sort((e,t)=>(Number(e.bathrooms)||0)-(Number(t.bathrooms)||0));return(0,s.useMemo)(()=>{if(!D)return B;let e=[];return B.forEach(t=>{if(e.push(t),Q.has(t.roomType)){let r=Y(t.roomType);e.push(...r)}}),e},[B,D,Q,C]),(0,n.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,n.jsxs)("div",{id:"room-type-filter-anchor","data-report-control":"hide",className:"p-4 bg-zinc-900/30 border border-white/5 rounded-lg flex flex-col sm:flex-row sm:flex-wrap items-start sm:items-center justify-between gap-3 sm:gap-4 scroll-mt-24",children:[(0,n.jsxs)("div",{className:"w-full sm:w-auto flex flex-wrap items-center gap-2",children:[(0,n.jsx)("span",{className:"text-zinc-400 text-sm whitespace-nowrap shrink-0 mr-1",children:"分析房型:"}),(0,n.jsx)("div",{className:"flex flex-wrap gap-1.5 sm:gap-2",children:_.map(e=>{let t=0===F.length||F.includes(e);return(0,n.jsx)("button",{onClick:()=>{t&&x(r.includes(e)?r.filter(t=>t!==e):[...r,e])},disabled:!t,className:(0,a.cn)("px-3 py-1 rounded-full text-xs font-medium transition-colors border",r.includes(e)?"bg-violet-500/20 border-violet-500 text-violet-200":"bg-zinc-800 border-zinc-700 text-zinc-500 hover:bg-zinc-700",!t&&"opacity-40 cursor-not-allowed hover:bg-zinc-800 hover:text-zinc-500"),title:t?void 0:"該建案無此房型",children:e},e)})})]}),O&&(0,n.jsxs)("div",{"data-report-control":"hide",className:"flex items-center gap-2 bg-zinc-800/50 p-1 rounded-lg border border-white/5 ml-auto sm:ml-0",children:[(0,n.jsx)("span",{className:"text-xs text-zinc-400 pl-2",children:"表格顯示:"}),(0,n.jsx)("button",{onClick:()=>I(!D),className:(0,a.cn)("px-3 py-1 text-xs font-medium rounded-md transition-all whitespace-nowrap",D?"bg-violet-500 text-white shadow-sm":"text-zinc-400 hover:text-white hover:bg-zinc-700"),children:D?"依房型合併":"顯示衛浴細節"})]})]}),t.includes("chart")&&(0,n.jsx)(o.q,{title:"各房型總價帶分佈箱型圖",description:"顯示各房型總價的中位數與四分位距",containerRef:h,children:(0,n.jsx)(l.B,{data:B})}),t.includes("table")&&(0,n.jsx)(o.q,{title:"總價帶詳細數據",description:D?"各房型合併統計 (點擊「全部」可展開細節)":"各房型詳細價格統計",containerRef:u,children:(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,n.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-4 py-3",children:"房型"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"衛浴"}),(0,n.jsx)("th",{className:"px-4 py-3 whitespace-nowrap min-w-[100px]",children:"建案數"}),(0,n.jsx)("th",{className:"px-4 py-3 whitespace-nowrap",children:"筆數"}),(0,n.jsx)("th",{className:"px-4 py-3 whitespace-nowrap",children:"平均總價"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"最低總價"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"1/4位總價"}),(0,n.jsx)("th",{className:"px-4 py-3 text-violet-400",children:"中位數總價"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"3/4位總價"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"最高總價"})]})}),(0,n.jsxs)("tbody",{className:"divide-y divide-white/5",children:[B.map((e,t)=>{let r=D&&null===e.bathrooms,o=Q.has(e.roomType),l=r&&o?Y(e.roomType):[];return(0,n.jsxs)(s.Fragment,{children:[(0,n.jsxs)("tr",{className:(0,a.cn)("hover:bg-zinc-800/50 transition-colors",o&&"bg-zinc-800/30"),children:[(0,n.jsx)("td",{className:"px-4 py-3 font-medium text-white",children:e.roomType}),(0,n.jsx)("td",{className:"px-4 py-3 text-zinc-400",children:r?(0,n.jsxs)("button",{onClick:()=>{var t;return t=e.roomType,void U(e=>{let r=new Set(e);return r.has(t)?r.delete(t):r.add(t),r})},"data-report-control":"allow",className:"flex items-center gap-1 text-xs px-2 py-0.5 rounded bg-zinc-700/50 hover:bg-zinc-600 hover:text-white transition-colors cursor-pointer",children:[(0,n.jsx)("span",{children:"全部"}),(0,n.jsx)("span",{className:(0,a.cn)("transform transition-transform text-[10px]",o?"rotate-180":""),children:"▼"})]}):e.bathrooms??"-"}),(0,n.jsx)("td",{className:"px-4 py-3",children:e.projectNames&&e.projectNames.length>0?(0,n.jsxs)("button",{onClick:()=>$(e.roomType,e.bathrooms,e.projectNames||[]),className:"px-2 py-1 text-xs font-medium rounded-full bg-violet-500/20 border border-violet-500/50 text-violet-300 hover:bg-violet-500/30 transition-colors cursor-pointer whitespace-nowrap",children:[e.projectNames.length," 建案"]}):(0,n.jsx)("span",{className:"text-zinc-500",children:"-"})}),(0,n.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:e.count.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.avgPrice.toLocaleString(void 0,{maximumFractionDigits:0})}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.minPrice.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.q1Price.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-violet-400 font-bold",children:e.medianPrice.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.q3Price.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.maxPrice.toLocaleString()})]}),l.map((e,r)=>(0,n.jsxs)("tr",{className:"bg-zinc-900/50 hover:bg-zinc-900 border-l-2 border-l-violet-500/30",children:[(0,n.jsxs)("td",{className:"px-4 py-2 font-medium text-zinc-500 text-xs pl-8",children:["↳ ",e.roomType]}),(0,n.jsxs)("td",{className:"px-4 py-2 text-zinc-400 text-xs",children:[e.bathrooms," 衛"]}),(0,n.jsx)("td",{className:"px-4 py-2",children:e.projectNames&&e.projectNames.length>0?(0,n.jsxs)("button",{onClick:()=>$(e.roomType,e.bathrooms,e.projectNames||[]),className:"text-xs text-zinc-500 hover:text-zinc-300 underline decoration-zinc-700",children:[e.projectNames.length," 建案"]}):"-"}),(0,n.jsx)("td",{className:"px-4 py-2 text-zinc-500 text-xs",children:e.count.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-500 text-xs",children:e.avgPrice.toLocaleString(void 0,{maximumFractionDigits:0})}),(0,n.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.minPrice.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.q1Price.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-500 text-xs font-medium",children:e.medianPrice.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.q3Price.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.maxPrice.toLocaleString()})]},`${t}-sub-${r}`))]},t)}),0===A.length&&(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:10,className:"p-8 text-center text-zinc-500",children:"請選擇房型顯示數據"})})]})]})})}),(H||q)&&(0,n.jsxs)("div",{className:"space-y-6 pt-4 border-t border-white/5",children:[t.includes("location-table")&&(0,n.jsxs)(o.q,{title:"區域房型成交分佈",containerRef:f,children:[(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mb-2","data-html2canvas-ignore":"true",children:[X(),(0,n.jsx)("div",{className:"ml-auto",children:W()})]}),(0,n.jsx)("div",{className:"overflow-x-auto",children:H?(0,n.jsxs)("table",{className:"w-full text-sm text-left border-collapse",children:[(0,n.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 font-semibold",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-3 py-2 sticky left-0 bg-zinc-900 z-10 border-r border-white/5",children:"房型"}),H.locations.map(e=>(0,n.jsx)("th",{className:"px-3 py-2 text-center min-w-[80px]",children:e},e)),(0,n.jsx)("th",{className:"px-3 py-2 text-center border-l border-white/5 bg-zinc-900 font-bold text-white",children:"總計"})]})}),(0,n.jsx)("tbody",{className:"divide-y divide-white/5",children:H.rows.map((e,t)=>(0,n.jsxs)("tr",{className:"hover:bg-zinc-800/30",children:[(0,n.jsx)("td",{className:"px-3 py-2 font-medium text-zinc-300 sticky left-0 bg-zinc-950/90 border-r border-white/5",children:e.roomType}),e.cells.map((e,t)=>{let r=e>0?Math.min(e/20,1):0,s=e>0?{backgroundColor:`rgba(6, 182, 212, ${.3*r})`}:{};return(0,n.jsx)("td",{className:"px-3 py-2 text-center text-zinc-400",style:s,children:e>0?e:"-"},t)}),(0,n.jsx)("td",{className:"px-3 py-2 text-center font-bold text-white border-l border-white/5 bg-zinc-900/50",children:e.rowTotal})]},t))}),(0,n.jsx)("tfoot",{className:"bg-zinc-900 font-bold border-t-2 border-zinc-700",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"px-3 py-2 sticky left-0 bg-zinc-900 border-r border-white/5 text-white",children:"總計"}),H.locations.map(e=>(0,n.jsx)("td",{className:"px-3 py-2 text-center text-white",children:H.locationTotals[e]},e)),(0,n.jsx)("td",{className:"px-3 py-2 text-center text-cyan-400 border-l border-white/5 bg-zinc-900",children:H.grandTotal})]})})]}):(0,n.jsx)("div",{className:"p-8 text-center text-zinc-500",children:"無區域分佈數據"})})]}),t.includes("location-chart")&&(0,n.jsxs)(o.q,{title:"區域成交佔比圖表",containerRef:b,children:[(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mb-2","data-html2canvas-ignore":"true",children:[X(),(0,n.jsx)("div",{className:"ml-auto",children:W()})]}),H&&(0,n.jsx)(i.s,{roomTypes:r,locations:H.locations,crossTable:H.rows.reduce((e,t)=>{let r={};return H.locations.forEach((e,n)=>{r[e]=t.cells[n]}),e[t.roomType]=r,e},{}),dimension:j,chartId:g})]})]}),(0,n.jsx)(c.d,{isOpen:N,onClose:()=>w(!1),title:v,projects:P}),(0,n.jsx)(c.d,{isOpen:N,onClose:()=>w(!1),title:v,projects:P})]})}},44071:(e,t,r)=>{r.d(t,{A:()=>n});let n=(0,r(78340).A)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]])},67514:(e,t,r)=>{r.d(t,{A:()=>n});let n=(0,r(78340).A)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]])},72566:(e,t,r)=>{r.d(t,{q:()=>o});var n=r(95155);r(12115);var s=r(40980);function o({title:e,description:t,children:r,headerAction:o,className:l,containerRef:i}){return(0,n.jsxs)("div",{ref:i,className:(0,s.cn)("bg-zinc-900/50 border border-white/5 rounded-2xl p-4 md:p-6 backdrop-blur-sm",l),children:[(0,n.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:e}),t&&(0,n.jsx)("p",{className:"text-zinc-400 text-sm mt-1",children:t})]}),o&&(0,n.jsx)("div",{className:"flex-shrink-0 w-full md:w-auto overflow-x-auto","data-html2canvas-ignore":"true",children:o})]}),r]})}},80642:(e,t,r)=>{r.d(t,{N:()=>j});var n=r(95155),s=r(12115),o=r(39551),l=r(28819),i=r(4524),c=r(15131),a=r(78757),d=r(24866);function x(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}class m extends s.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=t.offsetParent,r=(0,a.s)(e)&&e.offsetWidth||0,n=(0,a.s)(e)&&e.offsetHeight||0,s=this.props.sizeRef.current;s.height=t.offsetHeight||0,s.width=t.offsetWidth||0,s.top=t.offsetTop,s.left=t.offsetLeft,s.right=r-s.width-s.left,s.bottom=n-s.height-s.top}return null}componentDidUpdate(){}render(){return this.props.children}}function p({children:e,isPresent:t,anchorX:r,anchorY:o,root:l}){let i=(0,s.useId)(),c=(0,s.useRef)(null),a=(0,s.useRef)({width:0,height:0,top:0,left:0,right:0,bottom:0}),{nonce:p}=(0,s.useContext)(d.Q),h=function(...e){return s.useCallback(function(...e){return t=>{let r=!1,n=e.map(e=>{let n=x(e,t);return r||"function"!=typeof n||(r=!0),n});if(r)return()=>{for(let t=0;t<n.length;t++){let r=n[t];"function"==typeof r?r():x(e[t],null)}}}}(...e),e)}(c,e.props?.ref??e?.ref);return(0,s.useInsertionEffect)(()=>{let{width:e,height:n,top:s,left:d,right:x,bottom:m}=a.current;if(t||!c.current||!e||!n)return;let h="left"===r?`left: ${d}`:`right: ${x}`,u="bottom"===o?`bottom: ${m}`:`top: ${s}`;c.current.dataset.motionPopId=i;let f=document.createElement("style");p&&(f.nonce=p);let b=l??document.head;return b.appendChild(f),f.sheet&&f.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${n}px !important;
            ${h}px !important;
            ${u}px !important;
          }
        `),()=>{b.contains(f)&&b.removeChild(f)}},[t]),(0,n.jsx)(m,{isPresent:t,childRef:c,sizeRef:a,children:s.cloneElement(e,{ref:h})})}let h=({children:e,initial:t,isPresent:r,onExitComplete:o,custom:i,presenceAffectsLayout:a,mode:d,anchorX:x,anchorY:m,root:h})=>{let f=(0,l.M)(u),b=(0,s.useId)(),g=!0,j=(0,s.useMemo)(()=>(g=!1,{id:b,initial:t,isPresent:r,custom:i,onExitComplete:e=>{for(let t of(f.set(e,!0),f.values()))if(!t)return;o&&o()},register:e=>(f.set(e,!1),()=>f.delete(e))}),[r,f,o]);return a&&g&&(j={...j}),(0,s.useMemo)(()=>{f.forEach((e,t)=>f.set(t,!1))},[r]),s.useEffect(()=>{r||f.size||!o||o()},[r]),"popLayout"===d&&(e=(0,n.jsx)(p,{isPresent:r,anchorX:x,anchorY:m,root:h,children:e})),(0,n.jsx)(c.t.Provider,{value:j,children:e})};function u(){return new Map}var f=r(79196);let b=e=>e.key||"";function g(e){let t=[];return s.Children.forEach(e,e=>{(0,s.isValidElement)(e)&&t.push(e)}),t}let j=({children:e,custom:t,initial:r=!0,onExitComplete:c,presenceAffectsLayout:a=!0,mode:d="sync",propagate:x=!1,anchorX:m="left",anchorY:p="top",root:u})=>{let[j,y]=(0,f.xQ)(x),N=(0,s.useMemo)(()=>g(e),[e]),w=x&&!j?[]:N.map(b),v=(0,s.useRef)(!0),z=(0,s.useRef)(N),P=(0,l.M)(()=>new Map),S=(0,s.useRef)(new Set),[E,T]=(0,s.useState)(N),[k,M]=(0,s.useState)(N);(0,i.E)(()=>{v.current=!1,z.current=N;for(let e=0;e<k.length;e++){let t=b(k[e]);w.includes(t)?(P.delete(t),S.current.delete(t)):!0!==P.get(t)&&P.set(t,!1)}},[k,w.length,w.join("-")]);let $=[];if(N!==E){let e=[...N];for(let t=0;t<k.length;t++){let r=k[t],n=b(r);w.includes(n)||(e.splice(t,0,r),$.push(r))}return"wait"===d&&$.length&&(e=$),M(g(e)),T(N),null}let{forceRender:C}=(0,s.useContext)(o.L);return(0,n.jsx)(n.Fragment,{children:k.map(e=>{let s=b(e),o=(!x||!!j)&&(N===k||w.includes(s));return(0,n.jsx)(h,{isPresent:o,initial:(!v.current||!!r)&&void 0,custom:t,presenceAffectsLayout:a,mode:d,root:u,onExitComplete:o?void 0:()=>{if(S.current.has(s)||(S.current.add(s),!P.has(s)))return;P.set(s,!0);let e=!0;P.forEach(t=>{t||(e=!1)}),e&&(C?.(),M(z.current),x&&y?.(),c&&c())},anchorX:m,anchorY:p,children:e},s)})})}}}]);