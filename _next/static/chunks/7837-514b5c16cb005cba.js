"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7837],{48551:(e,t,r)=>{r.d(t,{K:()=>c});var s=r(95155),i=r(12115),n=r(88743),a=r(80642),o=r(39430),l=r(40980);function c(){let{selectedRoomTypes:e,setSelectedRoomTypes:t}=(0,n.P)(),[r,c]=(0,i.useState)(!1),[d,x]=(0,i.useState)(!1);return(0,i.useEffect)(()=>{let e=()=>{let e=document.getElementById("room-type-filter-anchor");e&&c(e.getBoundingClientRect().bottom<80)};return window.addEventListener("scroll",e),e(),()=>window.removeEventListener("scroll",e)},[]),(0,i.useEffect)(()=>{let e=document.querySelector("aside");if(!e)return;let t=()=>x(!0),r=()=>x(!1);return e.addEventListener("mouseenter",t),e.addEventListener("mouseleave",r),()=>{e.removeEventListener("mouseenter",t),e.removeEventListener("mouseleave",r)}},[]),(0,s.jsx)(a.N,{children:r&&!d&&(0,s.jsxs)(o.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.3},"data-report-control":"always-hide",className:(0,l.cn)("fixed z-[90] flex gap-1.5 p-1.5 bg-zinc-900/95 backdrop-blur-md border border-white/10 rounded-xl shadow-xl","flex-row bottom-8 left-1/2 -translate-x-1/2 items-center max-w-[90vw]","md:flex-col md:left-20 md:top-1/2 md:-translate-y-1/2 md:bottom-auto md:translate-x-0 md:items-stretch md:max-w-none"),children:[(0,s.jsx)("div",{className:(0,l.cn)("text-[9px] text-zinc-500 font-medium overflow-hidden","md:writing-mode-vertical md:text-center md:mb-0.5","whitespace-nowrap px-1"),children:"房型"}),(0,s.jsx)("div",{className:"flex md:flex-col gap-1.5 overflow-x-auto md:overflow-visible max-w-full md:max-w-none pb-2 md:pb-0 scrollbar-thumb-zinc-600 pr-8 md:pr-0",children:n.M.map(r=>(0,s.jsx)("button",{onClick:()=>{t(e.includes(r)?e.filter(e=>e!==r):[...e,r])},className:(0,l.cn)("px-2 py-1 text-[10px] font-medium rounded-lg transition-all hover:scale-105 active:scale-95 whitespace-nowrap",e.includes(r)?"bg-violet-500 text-white shadow-lg shadow-violet-500/20":"bg-zinc-800/50 text-zinc-400 hover:bg-zinc-700 hover:text-white"),children:r},r))}),e.length>0&&e.length<n.M.length&&(0,s.jsx)("button",{onClick:()=>t([]),className:(0,l.cn)("text-[9px] text-cyan-400 hover:text-cyan-300 transition-colors whitespace-nowrap px-1","md:mt-1 md:border-t md:border-white/5 md:pt-1 md:text-center md:px-0","border-l border-white/5 pl-1 md:border-l-0 md:pl-0"),children:"清除"})]})})}},77837:(e,t,r)=>{r.r(t),r.d(t,{PriceBandReport:()=>N});var s=r(95155),i=r(12115),n=r(68605),a=r(47650),o=r(80642),l=r(39430),c=r(33210),d=r(44071),x=r(67514),m=r(37717);let h={height:450,paddingTop:40,paddingBottom:80,paddingLeft:100,paddingRight:40,boxWidth:60,whiskerWidth:30,whiskerStrokeWidth:1,boxStrokeWidth:1.5,medianStrokeWidth:2};function p({data:e}){let t=(0,m.A)(),[r,n]=(0,i.useState)(null),[p,u]=(0,i.useState)(null),[b,f]=(0,i.useState)(null),[g,y]=(0,i.useState)(!1),j=(0,i.useRef)(null),w=(0,i.useRef)(null),N=(0,i.useRef)(null),v=(0,i.useMemo)(()=>({...h,colors:{upper:t.chart[1]||t.primary,lower:t.chart[0]||t.accent,whisker:t.text,median:t.text,grid:t.grid,text:t.textMuted,background:"transparent"}}),[t]);(0,i.useEffect)(()=>{y(!0)},[]),(0,i.useEffect)(()=>{let e=e=>{let t=N.current;if(t&&!t.contains(e.target)){let t=j.current;if(t&&t.contains(e.target))return;n(null)}};if(r){let t=setTimeout(()=>{document.addEventListener("click",e)},100);return()=>{clearTimeout(t),document.removeEventListener("click",e)}}},[r]);let z=(0,i.useMemo)(()=>{if(!e||0===e.length)return null;let t=e.map(e=>[e.minPrice,e.q1Price,e.medianPrice,e.q3Price,e.maxPrice].some(e=>"number"!=typeof e||isNaN(e))?null:{category:null!==e.bathrooms?`${e.roomType}-${e.bathrooms}衛`:e.roomType,min:Math.round(e.minPrice),q1:Math.round(e.q1Price),median:Math.round(e.medianPrice),q3:Math.round(e.q3Price),max:Math.round(e.maxPrice),count:e.count}).filter(Boolean);if(0===t.length)return null;let r=t.flatMap(e=>[e.min,e.q1,e.median,e.q3,e.max]),s=Math.min(...r),i=Math.max(...r),n=i-s,a=0===n?Math.max(.1*s,100):.1*n;return{items:t,yMin:Math.max(0,s-a),yMax:i+a}},[e]),k=(0,i.useMemo)(()=>{if(!z)return null;let e=w.current?.clientWidth||800,t=e-v.paddingLeft-v.paddingRight,r=v.height-v.paddingTop-v.paddingBottom,s=t/z.items.length;return{width:e,height:v.height,drawWidth:t,drawHeight:r,categoryWidth:s}},[z,v,w.current?.clientWidth]),P=(0,i.useMemo)(()=>z&&k?e=>{let t=(e-z.yMin)/(z.yMax-z.yMin);return v.paddingTop+k.drawHeight*(1-t)}:null,[z,k,v]),S=(0,i.useMemo)(()=>{if(!z)return[];let{yMin:e,yMax:t}=z,r=(t-e)/5;return Array.from({length:6},(t,s)=>Math.round(e+s*r))},[z]);return e&&0!==e.length&&z?(0,s.jsxs)("div",{ref:w,className:"relative w-full",children:[(0,s.jsx)("svg",{ref:j,width:"100%",height:v.height,className:"overflow-visible",onMouseMove:e=>{if(!j.current||!P||!z||!k)return;let t=j.current.getBoundingClientRect(),r=t.height/v.height||1,s=(e.clientY-t.top)/r;s>=v.paddingTop&&s<=v.paddingTop+k.drawHeight?f(s):f(null)},onMouseLeave:()=>{f(null)},children:k&&P&&(0,s.jsxs)(s.Fragment,{children:[S.map((e,t)=>(0,s.jsxs)("g",{children:[(0,s.jsx)("line",{x1:v.paddingLeft,y1:P(e),x2:v.paddingLeft+k.drawWidth,y2:P(e),stroke:v.colors.grid,strokeWidth:1,strokeDasharray:"4,4"}),(0,s.jsxs)("text",{x:v.paddingLeft-10,y:P(e),textAnchor:"end",dominantBaseline:"middle",fill:v.colors.text,fontSize:12,children:[e.toLocaleString()," 萬"]})]},`tick-${t}`)),(0,s.jsx)("text",{x:15,y:v.height/2,textAnchor:"middle",dominantBaseline:"middle",fill:v.colors.text,fontSize:12,transform:`rotate(-90, 15, ${v.height/2})`,children:"房屋總價 (萬)"}),z.items.map((e,i)=>{let a=v.paddingLeft+k.categoryWidth*(i+.5),o=v.boxWidth/2,l=v.whiskerWidth/2,c=P(e.max),d=P(e.q3),x=P(e.median),m=P(e.q1),h=P(e.min),b=p===i,f=r?.category===e.category;return(0,s.jsxs)("g",{className:"cursor-pointer transition-opacity",style:{opacity:null===p||b?1:.5},onMouseEnter:()=>u(i),onMouseLeave:()=>u(null),onClick:()=>n(e),children:[(0,s.jsx)("line",{x1:a,y1:d,x2:a,y2:c,stroke:v.colors.whisker,strokeWidth:v.whiskerStrokeWidth,strokeLinecap:"round"}),(0,s.jsx)("line",{x1:a-l,y1:c,x2:a+l,y2:c,stroke:v.colors.whisker,strokeWidth:v.whiskerStrokeWidth,strokeLinecap:"round"}),(0,s.jsx)("line",{x1:a,y1:m,x2:a,y2:h,stroke:v.colors.whisker,strokeWidth:v.whiskerStrokeWidth,strokeLinecap:"round"}),(0,s.jsx)("line",{x1:a-l,y1:h,x2:a+l,y2:h,stroke:v.colors.whisker,strokeWidth:v.whiskerStrokeWidth,strokeLinecap:"round"}),(0,s.jsx)("rect",{x:a-o,y:d,width:v.boxWidth,height:x-d,fill:v.colors.upper,stroke:b||f?t.text:v.colors.upper,strokeWidth:v.boxStrokeWidth,rx:2,style:{filter:b?"brightness(1.2)":"none"}}),(0,s.jsx)("rect",{x:a-o,y:x,width:v.boxWidth,height:m-x,fill:v.colors.lower,stroke:b||f?t.text:v.colors.lower,strokeWidth:v.boxStrokeWidth,rx:2,style:{filter:b?"brightness(1.2)":"none"}}),(0,s.jsx)("line",{x1:a-o,y1:x,x2:a+o,y2:x,stroke:v.colors.median,strokeWidth:v.medianStrokeWidth}),(0,s.jsx)("text",{x:a,y:v.height-25,textAnchor:"middle",fill:b?t.text:v.colors.text,fontSize:12,fontWeight:b?"bold":"normal",children:e.category})]},e.category)}),null!==b&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("line",{x1:v.paddingLeft,y1:b,x2:v.paddingLeft+k.drawWidth,y2:b,stroke:t.accent,strokeWidth:1,strokeDasharray:"4,4",pointerEvents:"none"}),(0,s.jsx)("rect",{x:v.paddingLeft+k.drawWidth+5,y:b-12,width:70,height:24,rx:4,fill:t.card,stroke:t.accent,strokeWidth:1}),(0,s.jsxs)("text",{x:v.paddingLeft+k.drawWidth+40,y:b+4,textAnchor:"middle",fill:t.accent,fontSize:11,fontWeight:"bold",children:[(e=>{if(!z||!k)return 0;let t=1-(e-v.paddingTop)/k.drawHeight;return Math.round(z.yMin+t*(z.yMax-z.yMin))})(b).toLocaleString()," 萬"]})]})]})}),g&&(0,a.createPortal)((0,s.jsx)(o.N,{children:r&&(0,s.jsxs)("div",{className:"fixed inset-0 z-[9998] pointer-events-none",children:[(0,s.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/50 backdrop-blur-sm pointer-events-auto",onClick:()=>n(null)}),(0,s.jsx)(l.P.div,{ref:N,initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",stiffness:400,damping:30},className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-auto w-[90vw] max-w-sm max-h-[85vh] flex flex-col",onClick:e=>e.stopPropagation(),children:(0,s.jsxs)("div",{className:"bg-zinc-900 border border-white/10 rounded-2xl shadow-2xl overflow-hidden flex flex-col",children:[(0,s.jsx)("div",{className:"bg-gradient-to-r from-cyan-500/20 to-violet-500/20 px-5 py-3 border-b border-white/10 flex-shrink-0",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-zinc-400 text-[10px] uppercase tracking-widest mb-0.5",children:"總價帶分析"}),(0,s.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,s.jsx)("div",{className:"text-white text-2xl font-black tracking-tight",children:r.category}),r.count>0&&(0,s.jsxs)("div",{className:"text-zinc-400 text-xs",children:["(",(0,s.jsx)("span",{className:"text-cyan-400 font-bold",children:r.count})," 筆)"]})]})]}),(0,s.jsx)("button",{onClick:()=>n(null),className:"p-1.5 rounded-full hover:bg-white/10 transition-colors",children:(0,s.jsx)(c.A,{className:"w-4 h-4 text-zinc-400"})})]})}),(0,s.jsxs)("div",{className:"p-4 space-y-2 overflow-y-auto flex-1 custom-scrollbar",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-lg bg-white/5 border border-white/5",children:[(0,s.jsx)(d.A,{className:"w-4 h-4 text-white/70 flex-shrink-0"}),(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsxs)("div",{className:"flex justify-between items-baseline",children:[(0,s.jsx)("span",{className:"text-white/60 text-xs font-medium",children:"最高成交"}),(0,s.jsxs)("span",{className:"text-white text-base font-mono font-bold",children:[r.max.toLocaleString()," 萬"]})]})}),(0,s.jsx)("div",{className:"w-1 h-3 border-r border-white/50 flex-shrink-0",title:"上引線"})]}),(0,s.jsxs)("div",{className:"p-3 rounded-lg bg-cyan-500/10 border border-cyan-500/30",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1.5 mb-1",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-[2px] bg-cyan-500"}),(0,s.jsx)("span",{className:"text-cyan-400 text-xs font-bold",children:"較高價區間 (25%)"})]}),(0,s.jsxs)("div",{className:"text-white text-lg font-mono font-bold mb-1",children:[r.median.toLocaleString()," ~ ",r.q3.toLocaleString()," 萬"]}),(0,s.jsx)("div",{className:"text-zinc-400 text-[10px] leading-tight",children:"價格偏高但屬正常範圍的交易。"})]}),(0,s.jsx)("div",{className:"flex items-center gap-3 px-3 py-2 bg-white/5 rounded-lg border border-white/5",children:(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("div",{className:"text-white text-xs font-bold",children:"中位數 (50%)"}),(0,s.jsxs)("div",{className:"text-white text-lg font-mono font-bold",children:[r.median.toLocaleString()," 萬"]})]})})}),(0,s.jsxs)("div",{className:"p-3 rounded-lg bg-violet-500/10 border border-violet-500/30",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1.5 mb-1",children:[(0,s.jsx)("div",{className:"w-3 h-3 rounded-[2px] bg-violet-500"}),(0,s.jsx)("span",{className:"text-violet-400 text-xs font-bold",children:"較低價區間 (25%)"})]}),(0,s.jsxs)("div",{className:"text-white text-lg font-mono font-bold mb-1",children:[r.q1.toLocaleString()," ~ ",r.median.toLocaleString()," 萬"]}),(0,s.jsx)("div",{className:"text-zinc-400 text-[10px] leading-tight",children:"價格偏低但屬正常範圍的交易。"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded-lg bg-white/5 border border-white/5",children:[(0,s.jsx)(x.A,{className:"w-4 h-4 text-zinc-500 flex-shrink-0"}),(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsxs)("div",{className:"flex justify-between items-baseline",children:[(0,s.jsx)("span",{className:"text-zinc-500 text-xs font-medium",children:"最低成交"}),(0,s.jsxs)("span",{className:"text-white text-base font-mono font-bold",children:[r.min.toLocaleString()," 萬"]})]})}),(0,s.jsx)("div",{className:"w-1 h-3 border-r border-zinc-600 flex-shrink-0",title:"下引線"})]})]}),(0,s.jsx)("div",{className:"px-4 py-2 bg-white/5 border-t border-white/10 flex-shrink-0",children:(0,s.jsxs)("div",{className:"text-zinc-500 text-[10px] text-center",children:["\uD83D\uDCA1 藍+紫區塊涵蓋 ",(0,s.jsx)("span",{className:"text-white font-bold",children:"50%"})," 的交易 (市場主流)"]})})]})})]})}),document.body)]}):(0,s.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無總價帶資料可顯示"})}var u=r(97085);function b({roomTypes:e,locations:t,crossTable:r,dimension:n,chartId:a}){let o=(0,m.A)(),l=(0,i.useMemo)(()=>e&&t&&r?e.map(e=>{let s=t.map(t=>r[e]&&r[e][t]||0);return{name:e,data:s}}):[],[e,t,r]),c=(0,i.useMemo)(()=>{let e="county"===n?"縣市":"行政區";return{chart:{type:"bar",height:Math.max(350,35*t.length),stacked:!0,background:"transparent",toolbar:{show:!1},foreColor:o.text,id:a},plotOptions:{bar:{horizontal:!0,barHeight:"70%",borderRadius:4,dataLabels:{total:{enabled:!0,offsetX:5,style:{fontSize:"11px",fontWeight:600,color:o.text},formatter:function(e,t){let r=t.w.config.series,s=t.dataPointIndex,i=0;return r.forEach(e=>{i+=e.data[s]||0}),i>0?i.toString():""}}}}},colors:o.chartPalette,dataLabels:{enabled:!1},xaxis:{categories:t,title:{text:"成交筆數",style:{color:o.textMuted}},labels:{style:{colors:o.textMuted}}},yaxis:{title:{text:e,style:{color:o.textMuted}},labels:{style:{colors:o.text},maxWidth:150}},legend:{position:"top",horizontalAlign:"center",labels:{colors:o.text}},tooltip:{theme:"dark",y:{formatter:function(e){return e+" 筆"}}},grid:{borderColor:o.grid},title:{text:`各${e}房型成交筆數分佈`,align:"center",style:{fontSize:"16px",color:o.text}}}},[t,n,a,o]);return l&&0!==l.length?(0,s.jsx)(u.A,{type:"bar",series:l,options:c,height:c.chart?.height||350,className:"w-full"}):(0,s.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無區域分佈資料"})}var f=r(40980);function g({isOpen:e,onClose:t,title:r,projects:n}){let a=(0,i.useRef)(null);return((0,i.useEffect)(()=>{let r=e=>{"Escape"===e.key&&t()};return e&&(document.addEventListener("keydown",r),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",r),document.body.style.overflow=""}},[e,t]),e)?(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",onClick:e=>{a.current&&!a.current.contains(e.target)&&t()},children:(0,s.jsxs)("div",{ref:a,className:"bg-zinc-900 border border-white/10 rounded-xl shadow-2xl max-w-md w-full mx-4 animate-in zoom-in-95 duration-200",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-5 py-4 border-b border-white/5",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-white",children:r}),(0,s.jsx)("button",{onClick:t,className:"p-1 rounded hover:bg-white/10 text-zinc-400 hover:text-white transition-colors",children:(0,s.jsx)(c.A,{size:20})})]}),(0,s.jsx)("div",{className:"px-5 py-4 max-h-[50vh] overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-700",children:0===n.length?(0,s.jsx)("p",{className:"text-zinc-500 text-center py-4",children:"無建案資料"}):(0,s.jsx)("ul",{className:"space-y-2",children:n.map((e,t)=>(0,s.jsx)("li",{className:(0,f.cn)("px-3 py-2 rounded-lg text-zinc-200 text-sm","bg-zinc-800/50 hover:bg-zinc-800 transition-colors","border border-white/5"),children:e},t))})}),(0,s.jsxs)("div",{className:"px-5 py-3 border-t border-white/5 flex justify-between items-center",children:[(0,s.jsxs)("span",{className:"text-xs text-zinc-500",children:["共 ",n.length," 個建案"]}),(0,s.jsx)("button",{onClick:t,className:"px-4 py-1.5 text-sm rounded-lg bg-zinc-800 text-zinc-300 hover:bg-zinc-700 transition-colors",children:"關閉"})]})]})}):null}var y=r(89733),j=r(88743),w=r(48551);function N({data:e,visibleSections:t=["chart","table","location-table","location-chart"]}){let{selectedRoomTypes:r,setSelectedRoomTypes:a,districts:o}=(0,j.P)(),l=["套房","1房","2房","3房","4房","毛胚"],c=i.useRef(null),d=i.useRef(null),x=i.useRef(null),m=i.useRef(null),h=i.useRef(`price-band-location-${Math.random().toString(36).slice(2,8)}`).current,[u,N]=(0,i.useState)("district"),[v,z]=(0,i.useState)(!1),[k,P]=(0,i.useState)(""),[S,M]=(0,i.useState)([]),[L,T]=(0,i.useState)(null),E=(0,i.useMemo)(()=>{if(!e?.transactionDetails)return[];let t=new Set;return e.transactionDetails.forEach(e=>{e["縣市"]&&t.add(e["縣市"])}),Array.from(t).sort()},[e?.transactionDetails]);i.useEffect(()=>{0===E.length?T(null):1===E.length?T(E[0]):L&&!E.includes(L)&&T(null)},[E,L]);let W=(e,t,r)=>{P(`${e}${null!==t?` / ${t}衛`:""} 建案組成`),M(r),z(!0)};if(!e||!e.details||0===e.details.length)return null;let{details:C,locationCrossTable:q,allDistricts:A,transactionDetails:R}=e,$=(0,i.useMemo)(()=>C.filter(e=>r.includes(e.roomType)),[C,r]),[_,D]=(0,i.useState)(!0),B=t.includes("table")||t.includes("chart"),O=(0,i.useMemo)(()=>{let e=C.filter(e=>r.includes(e.roomType));if(!_)return e;let t=new Map;return e.forEach(e=>{let r=e.roomType;t.has(r)||t.set(r,{...e,bathrooms:null,projectNames:e.projectNames?[...e.projectNames]:[],count:0,avgPrice:0});let s=t.get(r),i=s.avgPrice*s.count,n=e.avgPrice*e.count,a=s.count+e.count;s.count=a,s.avgPrice=a>0?(i+n)/a:0,s.minPrice=Math.min(s.minPrice,e.minPrice),s.maxPrice=Math.max(s.maxPrice,e.maxPrice);let o=s.count-e.count,l=e.count;if(s.medianPrice=(s.medianPrice*o+e.medianPrice*l)/a,s.q1Price=(s.q1Price*o+e.q1Price*l)/a,s.q3Price=(s.q3Price*o+e.q3Price*l)/a,e.projectNames){let t=new Set([...s.projectNames||[],...e.projectNames]);s.projectNames=Array.from(t)}}),Array.from(t.values()).sort((e,t)=>l.indexOf(e.roomType)-l.indexOf(t.roomType))},[C,r,_,l]),F=(0,i.useMemo)(()=>{if("county"===u&&R){let e={},t=new Set;R.forEach(r=>{let s=r["房型"]||r.roomType||r["戶型"];if(!s||"其他"===s){let e=Number(r["房數"]);s=!isNaN(e)&&e>0?`${e}房`:"其他"}let i="string"==typeof s?s.replace(/\s+/g,""):s;("number"==typeof i||"string"==typeof i&&/^\d+$/.test(i))&&(i=`${i}房`);let n=r["縣市"]||"未知";e[i]||(e[i]={}),e[i][n]=(e[i][n]||0)+1,t.add(n)});let s=Array.from(t).sort(),i={},n=0;s.forEach(e=>i[e]=0);let a=r.map(t=>{let r=e[t]||{},a=0,o=s.map(e=>{let t=r[e]||0;return a+=t,i[e]+=t,t});return n+=a,{roomType:t,cells:o,rowTotal:a}});return{locations:s,rows:a,locationTotals:i,grandTotal:n}}if("district"===u){let e={},t=new Set;if(R)R.forEach(r=>{let s=r["房型"]||r.roomType||r["戶型"];if(!s||"其他"===s){let e=Number(r["房數"]);s=!isNaN(e)&&e>0?`${e}房`:"其他"}let i="string"==typeof s?s.replace(/\s+/g,""):s;("number"==typeof i||"string"==typeof i&&/^\d+$/.test(i))&&(i=`${i}房`);let n=r["行政區"]||"未知",a=r["縣市"]||"未知";L&&a!==L||(e[i]||(e[i]={}),e[i][n]=(e[i][n]||0)+1,t.add(n))}),L||(A&&A.length>0?A:o).forEach(e=>t.add(e));else if(q){let s=new Set;r.forEach(e=>{let t=q[e];t&&Object.keys(t).forEach(e=>s.add(e))}),s.forEach(e=>t.add(e)),L||(A&&A.length>0?A:o).forEach(e=>t.add(e)),r.forEach(t=>{let r=q[t];r&&(e[t]=r)})}let s=Array.from(t).sort(),i={},n=0;s.forEach(e=>i[e]=0);let a=r.map(t=>{let r=e[t]||{},a=0,o=s.map(e=>{let t=r[e]||0;return a+=t,i[e]+=t,t});return n+=a,{roomType:t,cells:o,rowTotal:a}});return{locations:s,rows:a,locationTotals:i,grandTotal:n}}return null},[q,R,r,u,L]),[H,I]=(0,i.useState)(new Set),Q=(0,i.useMemo)(()=>F?F.rows.map(e=>{let t={房型:e.roomType};return F.locations.forEach((r,s)=>{t[r]=e.cells[s]}),t["總計"]=e.rowTotal,t}):[],[F]),K=e=>(0,s.jsxs)("div",{className:(0,f.cn)("flex bg-zinc-800 rounded-md p-0.5 border border-white/5",e),children:[(0,s.jsx)("button",{onClick:()=>N("district"),"data-report-control":"allow",className:(0,f.cn)("px-2 py-1 text-xs rounded transition-colors","district"===u?"bg-zinc-700 text-white":"text-zinc-400 hover:text-white"),children:"行政區"}),(0,s.jsx)("button",{onClick:()=>N("county"),"data-report-control":"allow",className:(0,f.cn)("px-2 py-1 text-xs rounded transition-colors","county"===u?"bg-zinc-700 text-white":"text-zinc-400 hover:text-white"),children:"縣市"})]}),G=()=>"district"!==u||E.length<=1?null:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-sm text-zinc-500",children:"顯示縣市:"}),(0,s.jsxs)("div",{className:"flex gap-1 bg-zinc-900 p-1 rounded-lg",children:[(0,s.jsx)("button",{onClick:()=>T(null),"data-report-control":"allow",className:(0,f.cn)("px-3 py-1 text-xs font-medium rounded-md transition-all",L?"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800":"bg-violet-500/20 text-violet-300 shadow-sm border border-violet-500/50"),children:"全部"}),E.map(e=>(0,s.jsx)("button",{onClick:()=>T(e),"data-report-control":"allow",className:(0,f.cn)("px-3 py-1 text-xs font-medium rounded-md transition-all",L===e?"bg-violet-500/20 text-violet-300 shadow-sm border border-violet-500/50":"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800"),children:e},e))]})]}),X=e=>C.filter(t=>t.roomType===e).sort((e,t)=>(Number(e.bathrooms)||0)-(Number(t.bathrooms)||0)),Y=(0,i.useMemo)(()=>{if(!_)return O;let e=[];return O.forEach(t=>{if(e.push(t),H.has(t.roomType)){let r=X(t.roomType);e.push(...r)}}),e},[O,_,H,C]);return(0,s.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,s.jsxs)("div",{id:"room-type-filter-anchor","data-report-control":"hide",className:"p-4 bg-zinc-900/30 border border-white/5 rounded-lg flex flex-col sm:flex-row sm:flex-wrap items-start sm:items-center justify-between gap-3 sm:gap-4 scroll-mt-24",children:[(0,s.jsxs)("div",{className:"w-full sm:w-auto flex flex-wrap items-center gap-2",children:[(0,s.jsx)("span",{className:"text-zinc-400 text-sm whitespace-nowrap shrink-0 mr-1",children:"分析房型:"}),(0,s.jsx)("div",{className:"flex flex-wrap gap-1.5 sm:gap-2",children:j.M.map(e=>(0,s.jsx)("button",{onClick:()=>{a(r.includes(e)?r.filter(t=>t!==e):[...r,e])},className:(0,f.cn)("px-3 py-1 rounded-full text-xs font-medium transition-colors border",r.includes(e)?"bg-violet-500/20 border-violet-500 text-violet-200":"bg-zinc-800 border-zinc-700 text-zinc-500 hover:bg-zinc-700"),children:e},e))})]}),B&&(0,s.jsxs)("div",{"data-report-control":"hide",className:"flex items-center gap-2 bg-zinc-800/50 p-1 rounded-lg border border-white/5 ml-auto sm:ml-0",children:[(0,s.jsx)("span",{className:"text-xs text-zinc-400 pl-2",children:"表格顯示:"}),(0,s.jsx)("button",{onClick:()=>D(!_),className:(0,f.cn)("px-3 py-1 text-xs font-medium rounded-md transition-all whitespace-nowrap",_?"bg-violet-500 text-white shadow-sm":"text-zinc-400 hover:text-white hover:bg-zinc-700"),children:_?"依房型合併":"顯示衛浴細節"})]})]}),t.includes("chart")&&(0,s.jsx)(n.c,{title:"各房型總價帶分佈箱型圖",description:"顯示各房型總價的中位數與四分位距",containerRef:c,headerAction:(0,s.jsx)(y.N,{data:O,filename:"price_band_chart_data",label:"匯出",chartType:"price-band-chart",targetRef:c,snapshotData:O,columns:{roomType:"房型",bathrooms:"衛浴",minPrice:"最低價",q1Price:"Q1",medianPrice:"中位數",q3Price:"Q3",maxPrice:"最高價",avgPrice:"平均價",count:"筆數"}}),children:(0,s.jsx)(p,{data:O})}),t.includes("table")&&(0,s.jsx)(n.c,{title:"總價帶詳細數據",description:_?"各房型合併統計 (點擊「全部」可展開細節)":"各房型詳細價格統計",containerRef:d,headerAction:(0,s.jsx)(y.N,{data:Y,filename:"price_band_detail_data",label:"匯出",chartType:"price-band-table",targetRef:d,snapshotData:Y,columns:{roomType:"房型",bathrooms:"衛浴",minPrice:"最低價",q1Price:"Q1",medianPrice:"中位數",q3Price:"Q3",maxPrice:"最高價",avgPrice:"平均價",count:"筆數"}}),children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,s.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-3",children:"房型"}),(0,s.jsx)("th",{className:"px-4 py-3",children:"衛浴"}),(0,s.jsx)("th",{className:"px-4 py-3 whitespace-nowrap min-w-[100px]",children:"建案數"}),(0,s.jsx)("th",{className:"px-4 py-3 whitespace-nowrap",children:"筆數"}),(0,s.jsx)("th",{className:"px-4 py-3 whitespace-nowrap",children:"平均總價"}),(0,s.jsx)("th",{className:"px-4 py-3",children:"最低總價"}),(0,s.jsx)("th",{className:"px-4 py-3",children:"1/4位總價"}),(0,s.jsx)("th",{className:"px-4 py-3 text-violet-400",children:"中位數總價"}),(0,s.jsx)("th",{className:"px-4 py-3",children:"3/4位總價"}),(0,s.jsx)("th",{className:"px-4 py-3",children:"最高總價"})]})}),(0,s.jsxs)("tbody",{className:"divide-y divide-white/5",children:[O.map((e,t)=>{let r=_&&null===e.bathrooms,n=H.has(e.roomType),a=r&&n?X(e.roomType):[];return(0,s.jsxs)(i.Fragment,{children:[(0,s.jsxs)("tr",{className:(0,f.cn)("hover:bg-zinc-800/50 transition-colors",n&&"bg-zinc-800/30"),children:[(0,s.jsx)("td",{className:"px-4 py-3 font-medium text-white",children:e.roomType}),(0,s.jsx)("td",{className:"px-4 py-3 text-zinc-400",children:r?(0,s.jsxs)("button",{onClick:()=>{var t;return t=e.roomType,void I(e=>{let r=new Set(e);return r.has(t)?r.delete(t):r.add(t),r})},"data-report-control":"allow",className:"flex items-center gap-1 text-xs px-2 py-0.5 rounded bg-zinc-700/50 hover:bg-zinc-600 hover:text-white transition-colors cursor-pointer",children:[(0,s.jsx)("span",{children:"全部"}),(0,s.jsx)("span",{className:(0,f.cn)("transform transition-transform text-[10px]",n?"rotate-180":""),children:"▼"})]}):e.bathrooms??"-"}),(0,s.jsx)("td",{className:"px-4 py-3",children:e.projectNames&&e.projectNames.length>0?(0,s.jsxs)("button",{onClick:()=>W(e.roomType,e.bathrooms,e.projectNames||[]),className:"px-2 py-1 text-xs font-medium rounded-full bg-violet-500/20 border border-violet-500/50 text-violet-300 hover:bg-violet-500/30 transition-colors cursor-pointer whitespace-nowrap",children:[e.projectNames.length," 建案"]}):(0,s.jsx)("span",{className:"text-zinc-500",children:"-"})}),(0,s.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:e.count.toLocaleString()}),(0,s.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.avgPrice.toLocaleString(void 0,{maximumFractionDigits:0})}),(0,s.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.minPrice.toLocaleString()}),(0,s.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.q1Price.toLocaleString()}),(0,s.jsx)("td",{className:"px-4 py-3 font-mono text-violet-400 font-bold",children:e.medianPrice.toLocaleString()}),(0,s.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.q3Price.toLocaleString()}),(0,s.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.maxPrice.toLocaleString()})]}),a.map((e,r)=>(0,s.jsxs)("tr",{className:"bg-zinc-900/50 hover:bg-zinc-900 border-l-2 border-l-violet-500/30",children:[(0,s.jsxs)("td",{className:"px-4 py-2 font-medium text-zinc-500 text-xs pl-8",children:["↳ ",e.roomType]}),(0,s.jsxs)("td",{className:"px-4 py-2 text-zinc-400 text-xs",children:[e.bathrooms," 衛"]}),(0,s.jsx)("td",{className:"px-4 py-2",children:e.projectNames&&e.projectNames.length>0?(0,s.jsxs)("button",{onClick:()=>W(e.roomType,e.bathrooms,e.projectNames||[]),className:"text-xs text-zinc-500 hover:text-zinc-300 underline decoration-zinc-700",children:[e.projectNames.length," 建案"]}):"-"}),(0,s.jsx)("td",{className:"px-4 py-2 text-zinc-500 text-xs",children:e.count.toLocaleString()}),(0,s.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-500 text-xs",children:e.avgPrice.toLocaleString(void 0,{maximumFractionDigits:0})}),(0,s.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.minPrice.toLocaleString()}),(0,s.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.q1Price.toLocaleString()}),(0,s.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-500 text-xs font-medium",children:e.medianPrice.toLocaleString()}),(0,s.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.q3Price.toLocaleString()}),(0,s.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.maxPrice.toLocaleString()})]},`${t}-sub-${r}`))]},t)}),0===$.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:10,className:"p-8 text-center text-zinc-500",children:"請選擇房型顯示數據"})})]})]})})}),(F||R)&&(0,s.jsxs)("div",{className:"space-y-6 pt-4 border-t border-white/5",children:[t.includes("location-table")&&(0,s.jsxs)(n.c,{title:"區域房型成交分佈",containerRef:x,headerAction:(0,s.jsx)(y.N,{data:Q,filename:"price_band_location_cross_table",label:"匯出",chartType:"price-band-location-table",targetRef:x,snapshotData:F}),children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mb-2","data-html2canvas-ignore":"true",children:[G(),(0,s.jsx)("div",{className:"ml-auto",children:K()})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:F?(0,s.jsxs)("table",{className:"w-full text-sm text-left border-collapse",children:[(0,s.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 font-semibold",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-3 py-2 sticky left-0 bg-zinc-900 z-10 border-r border-white/5",children:"房型"}),F.locations.map(e=>(0,s.jsx)("th",{className:"px-3 py-2 text-center min-w-[80px]",children:e},e)),(0,s.jsx)("th",{className:"px-3 py-2 text-center border-l border-white/5 bg-zinc-900 font-bold text-white",children:"總計"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-white/5",children:F.rows.map((e,t)=>(0,s.jsxs)("tr",{className:"hover:bg-zinc-800/30",children:[(0,s.jsx)("td",{className:"px-3 py-2 font-medium text-zinc-300 sticky left-0 bg-zinc-950/90 border-r border-white/5",children:e.roomType}),e.cells.map((e,t)=>{let r=e>0?Math.min(e/20,1):0,i=e>0?{backgroundColor:`rgba(6, 182, 212, ${.3*r})`}:{};return(0,s.jsx)("td",{className:"px-3 py-2 text-center text-zinc-400",style:i,children:e>0?e:"-"},t)}),(0,s.jsx)("td",{className:"px-3 py-2 text-center font-bold text-white border-l border-white/5 bg-zinc-900/50",children:e.rowTotal})]},t))}),(0,s.jsx)("tfoot",{className:"bg-zinc-900 font-bold border-t-2 border-zinc-700",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-3 py-2 sticky left-0 bg-zinc-900 border-r border-white/5 text-white",children:"總計"}),F.locations.map(e=>(0,s.jsx)("td",{className:"px-3 py-2 text-center text-white",children:F.locationTotals[e]},e)),(0,s.jsx)("td",{className:"px-3 py-2 text-center text-cyan-400 border-l border-white/5 bg-zinc-900",children:F.grandTotal})]})})]}):(0,s.jsx)("div",{className:"p-8 text-center text-zinc-500",children:"無區域分佈數據"})})]}),t.includes("location-chart")&&(0,s.jsxs)(n.c,{title:"區域成交佔比圖表",containerRef:m,headerAction:(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)(y.N,{data:Q,filename:"price_band_location_chart_data",label:"匯出",chartType:"price-band-location-chart",targetRef:m,snapshotData:F,chartId:h})}),children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mb-2","data-html2canvas-ignore":"true",children:[G(),(0,s.jsx)("div",{className:"ml-auto",children:K()})]}),F&&(0,s.jsx)(b,{roomTypes:r,locations:F.locations,crossTable:F.rows.reduce((e,t)=>{let r={};return F.locations.forEach((e,s)=>{r[e]=t.cells[s]}),e[t.roomType]=r,e},{}),dimension:u,chartId:h})]})]}),(0,s.jsx)(g,{isOpen:v,onClose:()=>z(!1),title:k,projects:S}),(0,s.jsx)(g,{isOpen:v,onClose:()=>z(!1),title:k,projects:S}),(0,s.jsx)(w.K,{})]})}},97085:(e,t,r)=>{r.d(t,{A:()=>l});var s=r(95155);r(12115);var i=r(37206),n=r(81477),a=r(37717);let o=(0,i.default)(()=>Promise.all([r.e(7776),r.e(4822)]).then(r.bind(r,44822)),{loadableGenerated:{webpack:()=>[null]},ssr:!1});function l({type:e,series:t,options:r,height:i=350,title:l,description:c,className:d,loading:x}){let m=(0,a.A)(),h={chart:{background:"transparent",foreColor:m.text,toolbar:{show:!1}},theme:{mode:"dark",palette:"palette1"},dataLabels:{enabled:!1,style:{colors:[m.text]}},grid:{borderColor:m.grid,strokeDashArray:4},xaxis:{labels:{style:{colors:m.textMuted}},axisBorder:{color:m.border},axisTicks:{color:m.border}},yaxis:{labels:{style:{colors:m.textMuted}}},tooltip:{theme:"dark",style:{fontSize:"12px"},x:{show:!0}},legend:{labels:{colors:m.textMuted}}},p={...h,...r,chart:{...h.chart,...r.chart}};return(0,s.jsxs)(n.Zp,{className:`p-4 ${d}`,children:[(l||c)&&(0,s.jsxs)("div",{className:"mb-4",children:[l&&(0,s.jsx)("h3",{className:"text-lg font-bold text-text-primary mb-1",children:l}),c&&(0,s.jsx)("p",{className:"text-sm text-text-secondary",children:c})]}),x?(0,s.jsx)("div",{className:"flex items-center justify-center",style:{height:i},children:(0,s.jsx)("div",{className:"loader"})}):(0,s.jsx)(o,{options:p,series:t,type:e,height:i,width:"100%"})]})}}}]);