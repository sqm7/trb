"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2560],{62560:(e,t,s)=>{s.r(t),s.d(t,{default:()=>z});var a=s(95155),l=s(12115),r=s(59481),n=s(15378),i=s(47684),c=s(86765),o=s(68055),d=s(69722),x=s.n(d);s(90737);var p=s(83097),m=s.n(p),h=s(61878),u=s(6296),f=s(56572),g=s(1610),b=s(21975),j=s(45687),y=s(56634);let N=x().icon({iconUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41]});x().Marker.prototype.options.icon=N;let w={cartoDark:{name:"暗色風格 (CartoDB)",url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/attributions">CARTO</a>'},osmDefault:{name:"標準地圖 (OSM)",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'},googleHybrid:{name:"衛星影像 (Google)",url:"https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}",attribution:"&copy; Google"}};function v({onMoveEnd:e}){return(0,r.Po)({moveend:()=>e()}),null}function z({projects:e=[]}){let[t,s]=(0,l.useState)("cartoDark"),[r,x]=(0,l.useState)(""),[p,y]=(0,l.useState)(!1),[N,z]=(0,l.useState)([]),[S,_]=(0,l.useState)(!1),[A,C]=(0,l.useState)(!1),[$,O]=(0,l.useState)(null),D=(0,l.useRef)(null),E=async()=>{if(!D.current||!S)return;let e=D.current;if(15>e.getZoom())return;C(!0);let t=e.getBounds(),s=`${t.getSouth()},${t.getWest()},${t.getNorth()},${t.getEast()}`,a=`[out:json][timeout:25];(way["building"](${s});relation["building"](${s}););out body;>;out skel qt;`;try{let e=await fetch(`https://overpass-api.de/api/interpreter?data=${encodeURIComponent(a)}`),t=await e.json(),s=m()(t);O(s)}catch(e){console.error("Failed to load buildings",e)}finally{C(!1)}},F=async()=>{if(r){y(!0);try{let e=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(r)}&limit=1`),t=await e.json();if(t&&t.length>0){let{lat:e,lon:s,display_name:a}=t[0],l={lat:parseFloat(e),lng:parseFloat(s)};z([{...l,name:a}]),D.current?.flyTo([l.lat,l.lng],17)}}catch(e){console.error("Search failed",e)}finally{y(!1)}}};return(0,a.jsxs)("div",{className:"relative w-full h-full rounded-xl overflow-hidden border border-white/10 shadow-2xl",children:[(0,a.jsxs)("div",{className:"absolute top-4 left-4 z-[500] w-80 flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"bg-zinc-900/90 backdrop-blur-md p-4 rounded-xl border border-white/10 shadow-lg",children:[(0,a.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(h.A,{className:"absolute left-3 top-2.5 h-4 w-4 text-zinc-400"}),(0,a.jsx)("input",{type:"text",value:r,onChange:e=>x(e.target.value),onKeyDown:e=>"Enter"===e.key&&F(),placeholder:"輸入地址或地標...",className:"w-full bg-zinc-800/50 border border-zinc-700 rounded-lg pl-9 pr-3 py-2 text-sm text-white focus:ring-1 focus:ring-cyan-500 outline-none"})]}),(0,a.jsx)("button",{onClick:F,disabled:p,className:"bg-cyan-600 hover:bg-cyan-500 text-white px-3 py-2 rounded-lg transition-colors disabled:opacity-50",children:p?(0,a.jsx)(u.A,{className:"animate-spin h-4 w-4"}):"Go"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"text-xs font-bold text-zinc-500 uppercase flex items-center gap-2",children:[(0,a.jsx)(f.A,{className:"h-3 w-3"})," 地圖風格"]}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(w).map(([e,l])=>(0,a.jsx)("button",{onClick:()=>s(e),className:`text-xs p-2 rounded-lg border transition-all ${t===e?"bg-cyan-500/20 border-cyan-500 text-cyan-400":"bg-zinc-800/50 border-transparent text-zinc-400 hover:bg-zinc-800"}`,children:l.name.split(" ")[0]},e))})]})]}),(0,a.jsxs)("div",{className:"bg-zinc-900/90 backdrop-blur-md p-4 rounded-xl border border-white/10 shadow-lg space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-zinc-200",children:[(0,a.jsx)(g.A,{className:"h-4 w-4 text-orange-400"}),(0,a.jsx)("span",{children:"3D 建物模型"})]}),(0,a.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:S,onChange:e=>{_(e.target.checked),e.target.checked?E():O(null)},className:"sr-only peer"}),(0,a.jsx)("div",{className:"w-9 h-5 bg-zinc-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-cyan-600"})]})]}),A&&(0,a.jsxs)("div",{className:"text-xs text-orange-400 flex items-center gap-2 animate-pulse",children:[(0,a.jsx)(u.A,{className:"h-3 w-3 animate-spin"}),"載入周邊建物資訊..."]}),(0,a.jsxs)("div",{className:"pt-4 border-t border-white/10",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-zinc-400 mb-2",children:[(0,a.jsx)(b.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"手動上傳 GeoJSON"})]}),(0,a.jsx)("input",{type:"file",accept:".geojson,.json",onChange:e=>{let t=e.target.files?.[0];if(t){let e=new FileReader;e.onload=e=>{try{O(JSON.parse(e.target?.result))}catch(e){alert("Invalid GeoJSON")}},e.readAsText(t)}},className:"block w-full text-xs text-zinc-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-zinc-800 file:text-cyan-400 hover:file:bg-zinc-700"})]})]})]}),(0,a.jsxs)(n.W,{center:[25.0478,121.5318],zoom:13,style:{height:"100%",width:"100%"},ref:D,children:[(0,a.jsx)(i.e,{url:w[t].url,attribution:w[t].attribution}),(0,a.jsx)(v,{onMoveEnd:()=>S&&E()}),N.map((e,t)=>(0,a.jsx)(c.p,{position:[e.lat,e.lng],children:(0,a.jsx)(o.z,{children:e.name})},t)),e.map(e=>{let t=(0,j.F0)((0,a.jsxs)("div",{className:"flex flex-col items-center justify-center transform -translate-x-1/2 -translate-y-full",children:[(0,a.jsx)("div",{className:"bg-zinc-950 border-2 border-cyan-500 rounded-full h-8 w-8 flex items-center justify-center shadow-[0_0_15px_rgba(6,182,212,0.5)]",children:(0,a.jsx)(g.A,{className:"h-4 w-4 text-cyan-400"})}),(0,a.jsx)("div",{className:"w-0.5 h-3 bg-cyan-500"})]})),s=(0,d.divIcon)({html:t,className:"custom-leaflet-marker",iconSize:[32,44],iconAnchor:[16,44],popupAnchor:[0,-44]});return(0,a.jsx)(c.p,{position:[e.latitude,e.longitude],icon:s,children:(0,a.jsx)(o.z,{className:"project-popup",minWidth:300,children:(0,a.jsxs)("div",{className:"p-1 min-w-[280px]",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3 border-b border-zinc-200 pb-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-zinc-900 m-0 leading-tight",children:e.project_name}),(0,a.jsx)("p",{className:"text-sm text-zinc-500 mt-1 mb-0",children:e.developer||"未知建商"})]}),"done"===e.enrichment_status&&(0,a.jsx)("span",{className:"bg-emerald-100 text-emerald-700 text-[10px] px-2 py-0.5 rounded-full font-bold whitespace-nowrap",children:"資料完備"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-y-2 gap-x-4 text-sm mt-3",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-zinc-500 text-xs",children:"總戶數"}),(0,a.jsxs)("span",{className:"font-medium text-zinc-800",children:[e.total_households||"-"," 戶"]})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-zinc-500 text-xs",children:"樓層"}),(0,a.jsx)("span",{className:"font-medium text-zinc-800",children:e.total_floors||"-"})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-zinc-500 text-xs",children:"公設比"}),(0,a.jsx)("span",{className:"font-medium text-zinc-800",children:e.public_ratio||"-"})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-zinc-500 text-xs",children:"基地面積"}),(0,a.jsx)("span",{className:"font-medium text-zinc-800",children:e.site_area||"-"})]}),(0,a.jsxs)("div",{className:"flex flex-col col-span-2 mt-1",children:[(0,a.jsx)("span",{className:"text-zinc-500 text-xs",children:"結構"}),(0,a.jsx)("span",{className:"font-medium text-zinc-800 truncate",title:e.structure||"",children:e.structure||"-"})]})]})]})})},`project-${e.county_code}-${e.id}`)}),$&&(0,a.jsx)(k,{data:$})]})]})}function k({data:e}){return(0,a.jsx)(y.k,{data:e,style:{color:"#f97316",weight:1,opacity:.7,fillColor:"#fdba74",fillOpacity:.2}},JSON.stringify(e).slice(0,100))}}}]);