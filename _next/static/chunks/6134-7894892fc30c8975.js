"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6134],{826:(e,t,a)=>{a.d(t,{B:()=>n});var r=a(95155),i=a(12115),s=a(97085);function n({data:e}){let t=(0,i.useMemo)(()=>e&&0!==e.length?[{name:"總價分佈",type:"boxPlot",data:e.map(e=>{let t=[e.minPrice,e.q1Price,e.medianPrice,e.q3Price,e.maxPrice];return t.some(e=>"number"!=typeof e||isNaN(e))?null:{x:null!==e.bathrooms?`${e.roomType}-${e.bathrooms}衛`:e.roomType,y:t.map(e=>Math.round(e))}}).filter(Boolean)}]:[],[e]),a=(0,i.useMemo)(()=>{if(0===t.length||0===t[0].data.length)return{};let e=t[0].data.flatMap(e=>e.y),a=Math.min(...e),r=Math.max(...e),i=r-a,s=0===i?Math.max(.1*a,100):.1*i;return{chart:{type:"boxPlot",height:450,background:"transparent",toolbar:{show:!0},foreColor:"#e5e7eb"},plotOptions:{boxPlot:{colors:{upper:"#06b6d4",lower:"#8b5cf6"},stroke:{colors:["#e5e7eb"]}}},xaxis:{type:"category",labels:{style:{colors:"#9ca3af"},rotate:-45,offsetY:5}},yaxis:{min:Math.max(0,a-s),max:r+s,title:{text:"房屋總價 (萬)",style:{color:"#9ca3af"}},labels:{formatter:e=>`${Math.round(e).toLocaleString()} 萬`,style:{colors:"#9ca3af"}}},tooltip:{custom:function({seriesIndex:e,dataPointIndex:t,w:a}){let r=a.globals.initialSeries[e].data[t].y;if(Array.isArray(r)&&5===r.length){let[e,t,a,i,s]=r;return`
                    <div class="apexcharts-tooltip-box" style="background: #18181b; border: 1px solid #27272a; padding: 8px 12px; border-radius: 8px; color: #fff;">
                        <div><strong>最高總價:</strong> ${s.toLocaleString()} 萬</div>
                        <div><strong>3/4位總價:</strong> ${i.toLocaleString()} 萬</div>
                        <div><strong>中位數總價:</strong> ${a.toLocaleString()} 萬</div>
                        <div><strong>1/4位總價:</strong> ${t.toLocaleString()} 萬</div>
                        <div><strong>最低總價:</strong> ${e.toLocaleString()} 萬</div>
                    </div>
                `}return""}}}},[t]);return e&&0!==e.length&&0!==t.length?(0,r.jsx)(s.A,{type:"boxPlot",series:t,options:a,height:450,className:"w-full"}):(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無總價帶資料可顯示"})}},3083:(e,t,a)=>{a.d(t,{M:()=>n});var r=a(95155),i=a(12115),s=a(97085);function n({data:e,selectedRooms:t,metric:a}){let n=(0,i.useMemo)(()=>({count:{label:"交易筆數",unit:"筆",decimals:0},priceSum:{label:"產權總價",unit:"萬",decimals:0},areaSum:{label:"房屋坪數",unit:"坪",decimals:2}})[a],[a]),l=(0,i.useMemo)(()=>{if(!e||0===t.length)return[];let r=Object.keys(e).sort();return 0===r.length?[]:t.map(t=>({name:t,data:r.map(r=>e[r]?.[t]?.[a]||0)}))},[e,t,a]),o=(0,i.useMemo)(()=>({chart:{type:"line",height:350,background:"transparent",toolbar:{show:!0},zoom:{enabled:!1},foreColor:"#e5e7eb"},stroke:{curve:"smooth",width:2},dataLabels:{enabled:!1},xaxis:{categories:e?Object.keys(e).sort():[],labels:{style:{colors:"#9ca3af"}}},yaxis:{title:{text:n.label,style:{color:"#9ca3af"}},labels:{style:{colors:"#9ca3af"},formatter:e=>e.toLocaleString("zh-TW",{minimumFractionDigits:0,maximumFractionDigits:0})}},legend:{position:"top",horizontalAlign:"right"},tooltip:{theme:"dark",y:{formatter:e=>`${e.toLocaleString("zh-TW",{minimumFractionDigits:n.decimals,maximumFractionDigits:n.decimals})} ${n.unit}`}},grid:{borderColor:"#374151"}}),[e,n]);return e&&0!==Object.keys(e).length&&0!==t.length?(0,r.jsx)(s.A,{type:"line",series:l,options:o,height:350,className:"w-full"}):(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"請選擇房型以顯示銷售趨勢"})}},4439:(e,t,a)=>{a.d(t,{m:()=>n});var r=a(95155),i=a(12115),s=a(97085);function n({data:e,selectedRooms:t,minArea:a,maxArea:n,interval:l,onDataPointClick:o,height:c}){let d=(0,i.useMemo)(()=>[{from:0,to:0,color:"#27272a",name:"0 戶"},{from:1,to:5,color:"#facc15",name:"1-5 戶"},{from:6,to:20,color:"#fbbf24",name:"6-20 戶"},{from:21,to:50,color:"#f97316",name:"21-50 戶"},{from:51,to:1e4,color:"#dc2626",name:"> 50 戶"}],[]),{series:m,maxValue:u}=(0,i.useMemo)(()=>{if(!e||0===t.length)return{series:[],maxValue:0};let r=[];for(let e=a;e<n;e+=l){let t=Number.isInteger(l)&&Number.isInteger(a),i=t?e.toFixed(0):e.toFixed(1),s=t?(e+l).toFixed(0):(e+l).toFixed(1);r.push(`${i}-${s}`)}let i=0;return{series:r.map(r=>{let[s,l]=r.split("-").map(parseFloat);return{name:r,data:t.map(t=>{let r=(e[t]||[]).filter(e=>e>=s&&e<l&&e>=a&&e<=n).length;return r>i&&(i=r),r})}}),maxValue:i}},[e,t,a,n,l]),x=(0,i.useMemo)(()=>({chart:{type:"heatmap",height:c||Math.max(400,22*m.length),background:"transparent",toolbar:{show:!0},foreColor:"#e5e7eb",events:{dataPointSelection:(e,a,r)=>{if(o){let{seriesIndex:e,dataPointIndex:a}=r,i=r.w.globals.seriesNames[e];o(t[a],i)}}}},plotOptions:{heatmap:{radius:0,useFillColorAsStroke:!0,enableShades:!1,colorScale:{ranges:d}}},dataLabels:{enabled:!0,style:{colors:[({value:e})=>0===e?"transparent":"#e5e7eb"]},formatter:function(e){return 0===e?"":e}},xaxis:{type:"category",categories:t},title:{text:"房型面積分佈熱力圖",align:"center",style:{color:"#e5e7eb",fontSize:"16px"}},grid:{borderColor:"#374151"},tooltip:{theme:"dark",y:{formatter:e=>0===e?"無成交紀錄":`${e} 戶`}}}),[m,t,d,o]);return e&&0!==m.length?(0,r.jsx)(s.A,{type:"heatmap",series:m,options:x,height:x.chart?.height||400,className:"w-full h-full"}):(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無面積分佈資料"})}},27529:(e,t,a)=>{a.d(t,{FH:()=>l});var r=a(16385),i=a(55873);async function s(){let{data:{session:e}}=await r.N.auth.getSession();return{"Content-Type":"application/json",apikey:i.m5,Authorization:`Bearer ${e?.access_token||i.m5}`}}async function n(e){let t=await s(),a=await fetch(i.Sn.RANKING_ANALYSIS,{method:"POST",headers:t,body:JSON.stringify({filters:e})});if(!a.ok)throw Error((await a.json().catch(()=>({error:`Analysis request failed: ${a.status}`}))).error||"Analyze data failed");return a.json()}let l={checkAuth:async function(){let{data:{session:e}}=await r.N.auth.getSession();e||console.log("User not logged in, but allowing access.")},getUser:async function(){let{data:{user:e}}=await r.N.auth.getUser();return e},signOut:async function(){let{error:e}=await r.N.auth.signOut();if(e)throw console.error("Sign out failed:",e),e},fetchData:async function(e,t){let a=await s(),r=await fetch(i.Sn.QUERY_DATA,{method:"POST",headers:a,body:JSON.stringify({filters:e,pagination:t})});if(!r.ok)throw Error((await r.json().catch(()=>({error:"Failed to parse server response"}))).error||"Fetch data failed");return r.json()},analyzeData:n,analyzeProjectRanking:n,fetchSubData:async function(e,t,a){if(!e||!t||!a)throw Error(`Insufficient parameters: ${e}, ${t}, ${a}`);let r=await s(),n=await fetch(i.Sn.SUB_DATA,{method:"POST",headers:r,body:JSON.stringify({id:e,type:t,county:a})});if(!n.ok)throw Error((await n.json().catch(()=>({error:"Failed to fetch sub data"}))).error||"Fetch sub data failed");return n.json()},fetchProjectNameSuggestions:async function(e,t,a=[]){let r=await s(),n=await fetch(i.Sn.PROJECT_NAMES,{method:"POST",headers:r,body:JSON.stringify({countyCode:e,query:t,districts:a,detailed:!0})});if(!n.ok)throw Error(`Server error: ${n.status}`);return n.json()},generateShareLink:async function(e){let t=await s(),a=await fetch(i.Sn.GENERATE_SHARE_LINK,{method:"POST",headers:t,body:JSON.stringify(e)});if(!a.ok)throw Error((await a.json().catch(()=>({error:"Generate share link failed"}))).error);return a.json()},getAdminUsers:async function(){let e=await s(),t=await fetch(i.Sn.GET_USERS,{method:"POST",headers:e,body:JSON.stringify({})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to fetch users"}))).error||"Fetch users failed");return t.json()}}},39734:(e,t,a)=>{a.d(t,{g:()=>c});var r=a(12115),i=a(27529),s=a(88743),n=a(55873),l=a(98883);function o(e,t){let a=(e.length-1)*t,r=Math.floor(a);return void 0!==e[r+1]?parseFloat((e[r]+(a-r)*(e[r+1]-e[r])).toFixed(2)):parseFloat(e[r].toFixed(2))}function c(){let e=(0,s.P)(),[t,a]=(0,r.useState)(!1),[c,d]=(0,r.useState)(null),m=(0,r.useCallback)(async()=>{a(!0),d(null),e.setAnalysisData(null);try{let c=e.counties.map(e=>n.WG[e]||e);if(0===c.length){d("請至少選擇一個縣市"),a(!1);return}let{dateRange:m,startDate:u,endDate:x}=e;if("custom"!==m&&(!u||!x)){let e=(0,l.P)(m);e.startDate&&e.endDate&&(u=e.startDate,x=e.endDate)}let h={districts:e.districts,transactionType:e.transactionType,type:e.transactionType,projectNames:e.projectNames,buildingType:e.buildingType,excludeCommercial:e.excludeCommercial,floorPremium:e.floorPremium,dateRange:m,dateStart:u,dateEnd:x};console.log("[useAnalysisData] Analyzing with counties:",c);let p=c.map(e=>{let t={...h,countyCode:e,counties:[e]};return i.FH.analyzeProjectRanking(t).catch(t=>(console.error(`Failed to fetch data for ${e}:`,t),null))}),g=await Promise.all(p),f=null,b=0;for(let e of g)if(e&&e.projectRanking&&e.coreMetrics){var t,r,s;console.log("Merging result for county:",e.projectRanking?.[0]?.county),t=f,f=e?t?(e.transactionDetails&&Array.isArray(e.transactionDetails)&&(t.transactionDetails||(t.transactionDetails=[]),t.transactionDetails=[...t.transactionDetails,...e.transactionDetails]),t.coreMetrics=function(e,t){if(!t)return e;if(!e)return t;let a=(e.totalSaleAmount||0)+(t.totalSaleAmount||0),r=(e.totalHouseArea||0)+(t.totalHouseArea||0),i=(e.transactionCount||0)+(t.transactionCount||0);return{totalSaleAmount:a,totalHouseArea:r,overallAveragePrice:r>0?a/r:0,transactionCount:i,medianPrice:0,q1Price:0,q3Price:0,minPrice:Math.min(e.minPrice||1/0,t.minPrice||1/0),maxPrice:Math.max(e.maxPrice||0,t.maxPrice||0)}}(t.coreMetrics,e.coreMetrics),e.projectRanking&&Array.isArray(e.projectRanking)&&(t.projectRanking=[...t.projectRanking,...e.projectRanking]),t.priceBandAnalysis=function(e,t){if(!t)return e;let a=Array.isArray(e)?e:e?.details||[],r=Array.isArray(t)?t:t?.details||[],i=e?.locationCrossTable||{},s=t?.locationCrossTable||{},n=e?.allDistricts||[],l=t?.allDistricts||[],o=e?.allRoomTypes||[],c=t?.allRoomTypes||[],d=new Map,m=e=>{let t=null!==e.bathrooms&&void 0!==e.bathrooms?String(e.bathrooms):"null",a=(e.roomType||"").replace(/\s+/g,""),r=`${a}-${t}`,i=Number(e.count)||0,s=Number(e.avgPrice)||0,n=Number(e.minPrice)||0,l=Number(e.maxPrice)||0;if(d.has(r)){let t=d.get(r),a=Number(t.count)||0,o=Number(t.avgPrice)||0,c=s*i,m=a+i,u=m>0?(o*a+c)/m:0;if(t.count=m,t.avgPrice=parseFloat(u.toFixed(2)),t.minPrice=Math.min(t.minPrice,n),t.maxPrice=Math.max(t.maxPrice,l),e.projectNames){let a=new Set([...t.projectNames,...e.projectNames]);t.projectNames=Array.from(a)}e.byDistrict&&Object.entries(e.byDistrict).forEach(([e,a])=>{t.byDistrict[e]=(t.byDistrict[e]||0)+a})}else d.set(r,{...e,roomType:a,count:i,avgPrice:s,minPrice:n,maxPrice:l,projectNames:e.projectNames?[...e.projectNames]:[],byDistrict:e.byDistrict?{...e.byDistrict}:{}})};a.forEach(m),r.forEach(m);let u={...i};Object.entries(s).forEach(([e,t])=>{u[e]?Object.entries(t).forEach(([t,a])=>{u[e][t]=(u[e][t]||0)+a}):u[e]={...t}});let x=Array.from(new Set([...n,...l])).sort(),h=Array.from(new Set([...o,...c])).sort();return{details:Array.from(d.values()),locationCrossTable:u,allDistricts:x,allRoomTypes:h}}(t.priceBandAnalysis,e.priceBandAnalysis),t.unitPriceAnalysis=function(e,t){if(!t)return e;let a=(e,t)=>{if(!t)return e;if(!e)return t;let a=(e.count||0)+(t.count||0);if(0===a)return e;let r={arithmetic:0,weighted:0},i=(e,t)=>"number"==typeof e.avgPrice?e.weightedAvgPrice||e.avgPrice:e.avgPrice?.[t]||0;["arithmetic","weighted"].forEach(s=>{let n=i(e,s),l=i(t,s);r[s]=(n*(e.count||0)+l*(t.count||0))/a});let s=Math.min(e.minPrice,t.minPrice),n=Math.max(e.maxPrice,t.maxPrice),l=e.minPrice<t.minPrice?e.minPriceProject:t.minPriceProject;return{count:a,avgPrice:r,minPrice:s,maxPrice:n,minPriceProject:l,maxPriceProject:e.maxPrice>t.maxPrice?e.maxPriceProject:t.maxPriceProject,medianPrice:0,q1Price:0,q3Price:0}},r=a(e.residentialStats,t.residentialStats),i=a(e.officeStats,t.officeStats),s=a(e.storeStats,t.storeStats),n=[...e.typeComparison||[]];return t.typeComparison&&(n=[...n,...t.typeComparison]),{residentialStats:r,officeStats:i,storeStats:s,typeComparison:n}}(t.unitPriceAnalysis,e.unitPriceAnalysis),t.transactionDetails&&t.transactionDetails.length>0&&function(e,t){if(!e||!t||0===t.length)return;let a=[],r={price:0,area:0,count:0},i=[],s={price:0,area:0,count:0},n=[],l={price:0,area:0,count:0},c=()=>({minPrice:1/0,maxPrice:-1/0,minRecord:null,maxRecord:null}),d=c(),m=c(),u=c();t.forEach(e=>{let t=e["建物型態"],o=e["主要用途"],c=e["房屋單價(萬)"],x=e["房屋總價(萬)"]||0,h=e["建物移轉總面積"]||0;if("number"!=typeof c||c<=0)return;let p=a,g=r,f=d;t?.includes("店")||"商業用"===o||e["備註"]?.includes("店")?(p=n,g=l,f=u):(t?.includes("辦公")||t?.includes("廠辦")||t?.includes("事務所")||o?.includes("辦公"))&&(p=i,g=s,f=m),p.push(c),g.price+=x,g.area+=h,g.count+=1,c>f.maxPrice&&(f.maxPrice=c,f.maxRecord=e),c<f.minPrice&&(f.minPrice=c,f.minRecord=e)});let x=(e,t,a,r)=>{e&&(function(e,t){if(!t||0===t.length){e.medianPrice=0,e.q1Price=0,e.q3Price=0;return}t.sort((e,t)=>e-t),e.medianPrice=o(t,.5),e.q1Price=o(t,.25),e.q3Price=o(t,.75)}(e,t),e.count=a.count,e.avgPrice=a.count>0?t.reduce((e,t)=>e+t,0)/a.count:0,e.weightedAvgPrice=a.area>0?a.price/a.area:0,r.maxRecord&&(e.maxPrice=r.maxPrice,e.maxPriceProject=r.maxRecord["建案名稱"],e.maxPriceUnit=r.maxRecord["戶型"]||r.maxRecord["戶別"],e.maxPriceFloor=r.maxRecord["樓層"]),r.minRecord&&(e.minPrice=r.minPrice,e.minPriceProject=r.minRecord["建案名稱"],e.minPriceUnit=r.minRecord["戶型"]||r.minRecord["戶別"],e.minPriceFloor=r.minRecord["樓層"]))};e.residentialStats&&x(e.residentialStats,a,r,d),e.officeStats&&x(e.officeStats,i,s,m),e.storeStats&&x(e.storeStats,n,l,u);let h=new Map;t.forEach(e=>{let t=e["建案名稱"];if(!t)return;h.has(t)||h.set(t,{resSum:{price:0,area:0,count:0},shopSum:{price:0,area:0,count:0},officeSum:{price:0,area:0,count:0},county:e["縣市"],district:e["行政區"]});let a=h.get(t),r=e["建物型態"],i=e["主要用途"],s=e["房屋單價(萬)"],n=e["房屋總價(萬)"]||0,l=e["建物移轉總面積"]||0;"number"!=typeof s||s<=0||(r?.includes("店")||"商業用"===i||e["備註"]?.includes("店")?(a.shopSum.price+=n,a.shopSum.area+=l,a.shopSum.count+=1):r?.includes("辦公")||r?.includes("廠辦")||r?.includes("事務所")||i?.includes("辦公")?(a.officeSum.price+=n,a.officeSum.area+=l,a.officeSum.count+=1):(a.resSum.price+=n,a.resSum.area+=l,a.resSum.count+=1))});let p=[];h.forEach((e,t)=>{let a=e.resSum.area>0?e.resSum.price/e.resSum.area:0,r=e.shopSum.area>0?e.shopSum.price/e.shopSum.area:0,i=e.officeSum.area>0?e.officeSum.price/e.officeSum.area:0;a>0&&(r>0||i>0)&&p.push({projectName:t,county:e.county,district:e.district,residentialAvg:a,shopAvg:r,officeAvg:i,shopMultiple:a>0?r/a:0,officeMultiple:a>0?i/a:0})}),p.sort((e,t)=>e.projectName.localeCompare(t.projectName))}(t.unitPriceAnalysis,t.transactionDetails),t.parkingAnalysis=function(e,t){if(!t)return e;let a=e.parkingRatio,r=t.parkingRatio,i=null;if(a&&r){let e=a.withParking.count,t=a.withoutParking.count,s=r.withParking.count,n=r.withoutParking.count,l=e+s,o=t+n,c=l+o;i={withParking:{count:l,percentage:c>0?l/c*100:0},withoutParking:{count:o,percentage:c>0?o/c*100:0}}}else i=a||r;let s=new Map,n=e=>{if(s.has(e.type)){let t=s.get(e.type),a=t.count+e.count,r=t.transactionCount+e.transactionCount,i=t.avgPrice,n=e.avgPrice,l=r>0?(i*t.transactionCount+n*e.transactionCount)/r:0;t.count=a,t.transactionCount=r,t.avgPrice=l}else s.set(e.type,{...e})};(e.avgPriceByType||[]).forEach(n),(t.avgPriceByType||[]).forEach(n);let l=Array.from(s.values()),o=new Map,c=e=>{if(o.has(e.floor)){let t=o.get(e.floor),a=t.count+e.count;e.rawRecords&&(t.rawRecords=[...t.rawRecords||[],...e.rawRecords]);let r=a>0?(t.avgPrice*t.count+e.avgPrice*e.count)/a:0;t.count=a,t.avgPrice=r,t.minPrice=Math.min(t.minPrice,e.minPrice),t.maxPrice=Math.max(t.maxPrice,e.maxPrice),e.maxPrice>t.maxPrice&&(t.maxPriceProject=e.maxPriceProject,t.maxPriceUnit=e.maxPriceUnit,t.maxPriceFloor=e.maxPriceFloor),e.minPrice<t.minPrice&&(t.minPriceProject=e.minPriceProject,t.minPriceUnit=e.minPriceUnit,t.minPriceFloor=e.minPriceFloor)}else o.set(e.floor,{...e,rawRecords:e.rawRecords?[...e.rawRecords]:[]})};return(e.rampPlanePriceByFloor||[]).forEach(c),(t.rampPlanePriceByFloor||[]).forEach(c),{parkingRatio:i,avgPriceByType:l,rampPlanePriceByFloor:Array.from(o.values())}}(t.parkingAnalysis,e.parkingAnalysis),t.salesVelocityAnalysis=function(e,t){if(!t)return e;let a=e.overall||{},r=t.overall||{},i=a.transactionCount||0,s=r.transactionCount||0,n=i+s,l={avgDaysToSell:0,medianDaysToSell:0,fastestSale:0,transactionCount:n};if(n>0){l.avgDaysToSell=((a.avgDaysToSell||0)*i+(r.avgDaysToSell||0)*s)/n;let e=void 0!==a.fastestSale?a.fastestSale:1/0;l.fastestSale=Math.min(e,void 0!==r.fastestSale?r.fastestSale:1/0),l.fastestSale===1/0&&(l.fastestSale=0),l.medianDaysToSell=((a.medianDaysToSell||0)*i+(r.medianDaysToSell||0)*s)/n}let o=new Map,c=e=>{if(!e)return;let t=e.roomType;if(o.has(t)){let a=o.get(t),r=a.count+e.count,i=a.avgDays||0,s=e.avgDays||0;a.avgDays=r>0?(i*a.count+s*e.count)/r:0,a.count=r}else o.set(t,{...e})};(e.byRoomType||[]).forEach(c),(t.byRoomType||[]).forEach(c);let d=Array.from(o.values()),m=Array.from(new Set([...e.allRoomTypes||[],...t.allRoomTypes||[]])),u={};return["monthly","quarterly","yearly","weekly"].forEach(a=>{let r=e[a]||{},i=t[a]||{},s={};new Set([...Object.keys(r),...Object.keys(i)]).forEach(e=>{let t=r[e]||{},a=i[e]||{},n=new Set([...Object.keys(t),...Object.keys(a)]),l={};n.forEach(e=>{let r=t[e],i=a[e];if(r&&i){let t=r.count+i.count,a=r.priceSum+i.priceSum,s=r.areaSum+i.areaSum;l[e]={count:t,priceSum:a,areaSum:s,avgPrice:s>0?a/s:0}}else r?l[e]={...r}:i&&(l[e]={...i})}),s[e]=l}),u[a]=s}),{overall:l,byRoomType:d,allRoomTypes:m,...u}}(t.salesVelocityAnalysis,e.salesVelocityAnalysis),r=t.priceGridAnalysis,t.priceGridAnalysis=(s=e.priceGridAnalysis)?{projectNames:[...r.projectNames||[],...s.projectNames||[]],byProject:{...r.byProject||{},...s.byProject||{}}}:r,t.areaDistributionAnalysis=function(e,t){if(!t)return e;if(!e)return t;let a={...e};return Object.keys(t).forEach(e=>{a[e]?a[e]=[...a[e],...t[e]]:a[e]=[...t[e]]}),a}(t.areaDistributionAnalysis,e.areaDistributionAnalysis),t):JSON.parse(JSON.stringify(e)):t,b++}if(console.log("Aggregation complete. Total Transaction Details:",f?.transactionDetails?.length),0===b){if(e.projectNames.length>0)throw Error("這段時間 這個建案查詢不到資料");throw Error("無法取得任何縣市的分析數據")}if(b<c.length){let e=c.length-b;d(`注意：有 ${e} 個縣市的資料載入失敗，分析結果可能不完整。`)}e.setAnalysisData(f)}catch(e){console.error("Analysis failed:",e),d(e.message||"無法取得分析數據，請稍後再試。")}finally{a(!1)}},[e]);return{loading:t,error:c,analysisData:e.analysisData,handleAnalyze:m,setError:d,setLoading:a,setAnalysisData:e.setAnalysisData}}},51806:(e,t,a)=>{a.d(t,{a:()=>l});var r=a(95155);a(12115);var i=a(33210),s=a(40980),n=a(81477);function l({isOpen:e,onClose:t,title:a,children:l,className:o,maxWidth:c="max-w-4xl"}){return e?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm animate-in fade-in duration-200",children:[(0,r.jsx)("div",{className:"absolute inset-0",onClick:t}),(0,r.jsxs)(n.Zp,{className:(0,s.cn)("relative w-full max-h-[90vh] flex flex-col overflow-hidden animate-in zoom-in-95 duration-200",c,o),onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border-default",children:[a&&(0,r.jsx)("h2",{className:"text-2xl font-bold text-white",children:a}),(0,r.jsx)("button",{onClick:t,className:"p-1 rounded-full hover:bg-white/10 transition-colors text-gray-400 hover:text-white",children:(0,r.jsx)(i.A,{size:24})})]}),(0,r.jsx)("div",{className:"p-6 overflow-y-auto custom-scrollbar",children:l})]})]}):null}},55873:(e,t,a)=>{a.d(t,{Ib:()=>n,Sn:()=>s,WG:()=>l,m5:()=>r});let r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp4Ym1iYmZyemJ0dXVleXNpY29jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA2ODg5ODksImV4cCI6MjA2NjI2NDk4OX0.1IUynv5eK1xF_3pb-oasqaTrPvbeAOC4Sc1oykPBy4M",i="https://zxbmbbfrzbtuueysicoc.supabase.co/functions/v1",s={QUERY_DATA:`${i}/query-data`,SUB_DATA:`${i}/query-sub-data`,PROJECT_NAMES:`${i}/query-names`,RANKING_ANALYSIS:`${i}/analyze-project-ranking`,GENERATE_SHARE_LINK:`${i}/generate-share-link`,GET_USERS:`${i}/get-users`},n={臺北市:["中正區","大同區","中山區","松山區","大安區","萬華區","信義區","士林區","北投區","內湖區","南港區","文山區"],新北市:["板橋區","三重區","中和區","永和區","新莊區","新店區","樹林區","鶯歌區","三峽區","淡水區","汐止區","瑞芳區","土城區","蘆洲區","五股區","泰山區","林口區","深坑區","石碇區","坪林區","三芝區","石門區","八里區","平溪區","雙溪區","貢寮區","金山區","萬里區","烏來區"],桃園市:["桃園區","中壢區","大溪區","楊梅區","蘆竹區","大園區","龜山區","八德區","龍潭區","平鎮區","新屋區","觀音區","復興區"],臺中市:["中區","東區","南區","西區","北區","北屯區","西屯區","南屯區","太平區","大里區","霧峰區","烏日區","豐原區","后里區","石岡區","東勢區","和平區","新社區","潭子區","大雅區","神岡區","大肚區","沙鹿區","龍井區","梧棲區","清水區","大甲區","外埔區","大安區"],臺南市:["中西區","東區","南區","北區","安平區","安南區","永康區","歸仁區","新化區","左鎮區","玉井區","楠西區","南化區","仁德區","關廟區","龍崎區","官田區","麻豆區","佳里區","西港區","七股區","將軍區","學甲區","北門區","新營區","後壁區","白河區","東山區","六甲區","下營區","柳營區","鹽水區","善化區","大內區","山上區","新市區","安定區"],高雄市:["新興區","前金區","苓雅區","鹽埕區","鼓山區","旗津區","前鎮區","三民區","楠梓區","小港區","左營區","仁武區","大社區","岡山區","路竹區","阿蓮區","田寮區","燕巢區","橋頭區","梓官區","彌陀區","永安區","湖內區","鳳山區","大寮區","林園區","鳥松區","大樹區","旗山區","美濃區","六龜區","內門區","杉林區","甲仙區","桃源區","那瑪夏區","茂林區","茄萣區"],基隆市:["仁愛區","信義區","中正區","中山區","安樂區","暖暖區","七堵區"],新竹市:["東區","北區","香山區"],嘉義市:["東區","西區"],宜蘭縣:["宜蘭市","羅東鎮","蘇澳鎮","頭城鎮","礁溪鄉","壯圍鄉","員山鄉","冬山鄉","五結鄉","三星鄉","大同鄉","南澳鄉"],新竹縣:["竹北市","竹東鎮","新埔鎮","關西鎮","湖口鄉","新豐鄉","芎林鄉","橫山鄉","北埔鄉","寶山鄉","峨眉鄉","尖石鄉","五峰鄉"],苗栗縣:["苗栗市","苑裡鎮","通霄鎮","竹南鎮","頭份鎮","後龍鎮","卓蘭鎮","大湖鄉","公館鄉","銅鑼鄉","南庄鄉","頭屋鄉","三義鄉","西湖鄉","造橋鄉","三灣鄉","獅潭鄉","泰安鄉"],彰化縣:["彰化市","鹿港鎮","和美鎮","線西鄉","伸港鄉","福興鄉","秀水鄉","花壇鄉","芬園鄉","員林鎮","溪湖鎮","田中鎮","大村鄉","埔鹽鄉","埔心鄉","永靖鄉","社頭鄉","二水鄉","北斗鎮","二林鎮","田尾鄉","埤頭鄉","芳苑鄉","大城鄉","竹塘鄉","溪州鄉"],南投縣:["南投市","埔里鎮","草屯鎮","竹山鎮","集集鎮","名間鄉","鹿谷鄉","中寮鄉","魚池鄉","國姓鄉","水里鄉","信義鄉","仁愛鄉"],雲林縣:["斗六市","斗南鎮","虎尾鎮","西螺鎮","土庫鎮","北港鎮","古坑鄉","大埤鄉","莿桐鄉","林內鄉","二崙鄉","崙背鄉","麥寮鄉","東勢鄉","褒忠鄉","台西鄉","元長鄉","四湖鄉","口湖鄉","水林鄉"],嘉義縣:["太保市","朴子市","布袋鎮","大林鎮","民雄鄉","溪口鄉","新港鄉","六腳鄉","東石鄉","義竹鄉","鹿草鄉","水上鄉","中埔鄉","竹崎鄉","梅山鄉","番路鄉","大埔鄉","阿里山鄉"],屏東縣:["屏東市","潮州鎮","東港鎮","恆春鎮","萬丹鄉","長治鄉","麟洛鄉","九如鄉","里港鄉","鹽埔鄉","高樹鄉","萬巒鄉","內埔鄉","竹田鄉","新埤鄉","枋寮鄉","新園鄉","崁頂鄉","林邊鄉","南州鄉","佳冬鄉","琉球鄉","車城鄉","滿州鄉","枋山鄉","霧台鄉","瑪家鄉","泰武鄉","來義鄉","春日鄉","獅子鄉","牡丹鄉","三地門鄉"],花蓮縣:["花蓮市","鳳林鎮","玉里鎮","新城鄉","吉安鄉","壽豐鄉","光復鄉","豐濱鄉","瑞穗鄉","富里鄉","秀林鄉","萬榮鄉","卓溪鄉"],臺東縣:["臺東市","成功鎮","關山鎮","卑南鄉","鹿野鄉","池上鄉","東河鄉","長濱鄉","太麻里鄉","大武鄉","綠島鄉","海端鄉","延平鄉","金峰鄉","達仁鄉","蘭嶼鄉"],澎湖縣:["馬公市","湖西鄉","白沙鄉","西嶼鄉","望安鄉","七美鄉"],金門縣:["金城鎮","金湖鎮","金沙鄉","金寧鄉","烈嶼鄉","烏坵鄉"],連江縣:["南竿鄉","北竿鄉","莒光鄉","東引鄉"]},l={臺北市:"A",新北市:"F",桃園市:"H",臺中市:"B",臺南市:"D",高雄市:"E",基隆市:"C",新竹市:"O",嘉義市:"I",新竹縣:"J",苗栗縣:"K",彰化縣:"N",南投縣:"M",雲林縣:"P",嘉義縣:"Q",屏東縣:"T",宜蘭縣:"G",花蓮縣:"U",臺東縣:"V",澎湖縣:"X",金門縣:"W",連江縣:"Z"}},58822:(e,t,a)=>{a.d(t,{e:()=>n});var r=a(95155);a(12115);var i=a(9425),s=a(68500);function n({children:e}){return(0,r.jsxs)("div",{className:"min-h-screen bg-zinc-950 text-zinc-100 flex",children:[(0,r.jsx)(i.Sidebar,{}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col lg:pl-20 min-w-0 transition-all duration-300",children:[(0,r.jsx)(s.Header,{}),(0,r.jsxs)("main",{className:"flex-1 p-4 md:p-6 lg:p-8",children:[(0,r.jsx)("div",{className:"container-custom py-6 space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500 min-h-[calc(100vh-12rem)]",children:e}),(0,r.jsxs)("footer",{className:"py-8 text-center border-t border-white/5 mt-8",children:[(0,r.jsx)("p",{className:"text-zinc-600 text-sm font-medium",children:"\xa9 2026 平米內參 sqmtalk.com. All rights reserved."}),(0,r.jsx)("a",{href:"mailto:sqmtalk7@gmail.com",className:"block mt-2 text-zinc-700 hover:text-cyan-500 text-xs transition-colors",children:"Contact: sqmtalk7@gmail.com"})]})]})]})]})}},60529:(e,t,a)=>{a.d(t,{p:()=>n});var r=a(95155),i=a(12115),s=a(40980);let n=i.forwardRef(({className:e,type:t,...a},i)=>(0,r.jsx)("input",{type:t,className:(0,s.cn)("flex h-10 w-full rounded-md border border-input bg-zinc-950/50 px-3 py-2 text-sm text-zinc-100 ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...a}));n.displayName="Input"},69690:(e,t,a)=>{a.d(t,{l:()=>n});var r=a(95155),i=a(12115),s=a(97085);function n({data:e,sortKey:t,limit:a=30,chartType:n="auto",height:l}){let o=(0,i.useMemo)(()=>n&&"auto"!==n?n:["averagePrice","minPrice","maxPrice","medianPrice","avgParkingPrice"].includes(t)?"bar":"treemap",[t,n]),c=(0,i.useMemo)(()=>({averagePrice:{title:"建案平均單價排行",unit:"萬/坪"},minPrice:{title:"建案最低單價排行",unit:"萬/坪"},maxPrice:{title:"建案最高單價排行",unit:"萬/坪"},medianPrice:{title:"建案單價中位數排行",unit:"萬/坪"},avgParkingPrice:{title:"車位平均單價排行",unit:"萬"},saleAmountSum:{title:"建案銷售總額佔比",unit:"萬",yLabel:"銷售總額"},houseAreaSum:{title:"建案房屋面積佔比",unit:"坪",yLabel:"房屋面積"},transactionCount:{title:"建案交易筆數佔比",unit:"筆",yLabel:"資料筆數"}})[t]||{title:"建案分析圖表",unit:"",yLabel:"數值"},[t]),d=(0,i.useMemo)(()=>{if(!e||0===e.length)return[];if("bar"!==o)return e.reduce((e,a)=>e+(a[t]||0),0),[{name:c.yLabel||c.unit,data:e.map(e=>({x:e.projectName,y:parseFloat((e[t]||0).toFixed(2))}))}];{let r=[...e].filter(e=>e[t]>0).sort((e,a)=>a[t]-e[t]).slice(0,a);return[{name:c.unit,data:r.map(e=>parseFloat((e[t]||0).toFixed(2)))}]}},[e,t,o,c,a]),m=(0,i.useMemo)(()=>{let r={title:{text:c.title,align:"center",style:{fontSize:"16px",fontWeight:600,color:"#e5e7eb"}}};if("bar"===o){let i=[...e].filter(e=>e[t]>0).sort((e,a)=>a[t]-e[t]).slice(0,a).map(e=>e.projectName);return{...r,chart:{type:"bar",toolbar:{show:!0},animations:{enabled:!1}},tooltip:{theme:"dark",y:{formatter:e=>`${e.toLocaleString()} ${c.unit}`,title:{formatter:(e,t)=>{let a=i[t?.dataPointIndex];return a?`${a}:`:`${e}:`}}},x:{show:!0,formatter:(e,t)=>i[t?.dataPointIndex]||e}},plotOptions:{bar:{horizontal:!1,columnWidth:"60%",borderRadius:4,distributed:!1}},colors:["#8b5cf6"],fill:{type:"gradient",gradient:{shade:"dark",type:"vertical",shadeIntensity:.5,gradientToColors:["#a78bfa"],inverseColors:!0,opacityFrom:1,opacityTo:1,stops:[0,100]}},dataLabels:{enabled:!1},xaxis:{categories:i,labels:{style:{colors:"#9ca3af"},rotate:-45,trim:!0,maxHeight:100}},yaxis:{title:{text:c.unit,style:{color:"#6b7280"}},labels:{style:{colors:"#e5e7eb",fontSize:"12px",fontWeight:500}}},legend:{show:!1}}}{let a=e.reduce((e,a)=>e+(a[t]||0),0);return{...r,tooltip:{theme:"dark",y:{formatter:e=>`${e.toLocaleString()} ${c.unit}`}},chart:{type:"treemap",height:450,toolbar:{show:!0}},plotOptions:{treemap:{distributed:!0,enableShades:!1,colorScale:{ranges:[{from:0,to:.1*a,color:"#06b6d4"},{from:.1*a,to:.3*a,color:"#3b82f6"},{from:.3*a,to:.6*a,color:"#8b5cf6"},{from:.6*a,to:1/0,color:"#d946ef"}]}}},dataLabels:{enabled:!0,style:{fontSize:"11px",fontWeight:500,colors:["#fff"]},formatter:e=>e,offsetY:-2}}}},[o,d,c,e,t,a]);if(!e||0===e.length)return(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無排名資料可顯示"});let u="bar"===o&&d[0]?.data?d[0].data.length:0,x="bar"===o?{width:"100%",minWidth:`${45*u}px`}:{width:"100%"};return(0,r.jsx)("div",{className:`w-full ${"bar"===o?"overflow-x-auto pb-4":""}`,children:(0,r.jsx)("div",{style:x,children:(0,r.jsx)(s.A,{type:"bar"===o?"bar":"treemap",series:d,options:m,height:l||450,className:"w-full"})})})}},70872:(e,t,a)=>{a.d(t,{Bc:()=>l,ZI:()=>d,k$:()=>c,m_:()=>o});var r=a(95155),i=a(12115),s=a(45828),n=a(40980);let l=s.Kq,o=s.bL,c=s.l9,d=i.forwardRef(({className:e,sideOffset:t=4,...a},i)=>(0,r.jsx)(s.UC,{ref:i,sideOffset:t,className:(0,n.cn)("z-50 overflow-hidden rounded-md border border-zinc-800 bg-zinc-950 px-3 py-1.5 text-sm text-zinc-100 shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a}));d.displayName=s.UC.displayName},81477:(e,t,a)=>{a.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>o,Zp:()=>n,aR:()=>l});var r=a(95155),i=a(12115),s=a(40980);let n=i.forwardRef(({className:e,...t},a)=>(0,r.jsx)("div",{ref:a,className:(0,s.cn)("glass-panel rounded-xl text-card-foreground",e),...t}));n.displayName="Card";let l=i.forwardRef(({className:e,...t},a)=>(0,r.jsx)("div",{ref:a,className:(0,s.cn)("flex flex-col space-y-1.5 p-6",e),...t}));l.displayName="CardHeader";let o=i.forwardRef(({className:e,...t},a)=>(0,r.jsx)("h3",{ref:a,className:(0,s.cn)("text-lg font-semibold leading-none tracking-tight text-white",e),...t}));o.displayName="CardTitle";let c=i.forwardRef(({className:e,...t},a)=>(0,r.jsx)("p",{ref:a,className:(0,s.cn)("text-sm text-zinc-400",e),...t}));c.displayName="CardDescription";let d=i.forwardRef(({className:e,...t},a)=>(0,r.jsx)("div",{ref:a,className:(0,s.cn)("p-6 pt-0",e),...t}));d.displayName="CardContent",i.forwardRef(({className:e,...t},a)=>(0,r.jsx)("div",{ref:a,className:(0,s.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"},88042:(e,t,a)=>{a.d(t,{$:()=>c});var r=a(95155),i=a(12115),s=a(47650),n=a(40980),l=a(60529);let o=({children:e,x:t,y:a,visible:n})=>{let[l,o]=(0,i.useState)(!1);return((0,i.useEffect)(()=>(o(!0),()=>o(!1)),[]),l&&n&&!("u"<typeof document))?(0,s.createPortal)((0,r.jsx)("div",{className:"fixed pointer-events-none z-[9999]",style:{left:t,top:a,transform:"translate(-50%, -100%) translateY(-12px)"},children:e}),document.body):null};function c({data:e,minPrice:t,maxPrice:a,interval:s,sizeMetric:c,onMinPriceChange:d,onMaxPriceChange:m,onIntervalChange:u,onSizeMetricChange:x}){let[h,p]=(0,i.useState)("natural"),[g,f]=(0,i.useState)(null),[b,y]=(0,i.useState)({x:0,y:0}),v=(0,i.useRef)(null),[j,w]=(0,i.useState)({width:0,height:0});(0,i.useEffect)(()=>{if(!v.current)return;let e=()=>{v.current&&w({width:v.current.clientWidth,height:v.current.clientHeight})};e(),window.addEventListener("resize",e);let t=setTimeout(e,200);return()=>{window.removeEventListener("resize",e),clearTimeout(t)}},[]);let N=(e,t)=>{let a=e.currentTarget.getBoundingClientRect();y({x:a.left+a.width/2,y:a.top}),f(t)},{buckets:P,validBuckets:S,maxValue:z}=(0,i.useMemo)(()=>{if(!e||0===e.length)return{buckets:[],validBuckets:[],maxValue:0};let r=[];for(let e=t;e<a;e+=s)r.push({min:e,max:Math.min(e+s,a),label:`${e}-${Math.min(e+s,a)}`,count:0,totalArea:0,avgPrice:0,transactions:[]});e.forEach(e=>{let i=e["房屋單價(萬)"],n=e["房屋面積(坪)"]||0;if("number"!=typeof i||i<t||i>=a)return;let l=Math.floor((i-t)/s);l>=0&&l<r.length&&(r[l].count++,r[l].totalArea+=n,r[l].transactions.push(e))});let i=r.filter(e=>e.count>0),n=Math.max(...i.map(e=>"count"===c?e.count:e.totalArea));return{buckets:r,validBuckets:i,maxValue:n}},[e,t,a,s,c]),{nodes:k,onMouseDown:A,dragId:I}=((e,t,a,r,s,n)=>{let[l,o]=(0,i.useState)([]),c=(0,i.useRef)(null),d=(0,i.useRef)(null),m=(0,i.useRef)(null);return(0,i.useEffect)(()=>{if(!e.length||!t||!a)return;let i=t/2,n=a/2,l=e.map((e,t)=>{let a="count"===r?e.count:e.totalArea,i=s>0?30+a/s*80:30;return{id:e.label,value:a,radius:i/2,x:0,y:0,vx:0,vy:0,origIndex:t}});l.sort((e,t)=>e.value-t.value),l=l.map((e,t)=>{let a=2.39996*t,r=10*Math.sqrt(t)*2.5;return{...e,x:i+Math.cos(a)*r,y:n+Math.sin(a)*r}});for(let e=0;e<120;e++)for(let e=0;e<l.length;e++)for(let t=e+1;t<l.length;t++){let a=l[e],r=l[t],i=r.x-a.x,s=r.y-a.y,n=i*i+s*s,o=a.radius+r.radius+5;if(n<o*o&&n>0){let e=Math.sqrt(n),t=o-e,l=i/e,c=s/e,d=.5*t;a.x-=l*d,a.y-=c*d,r.x+=l*d,r.y+=c*d}}o(l)},[e,t,a,r,s]),(0,i.useEffect)(()=>{if(!n)return;let e=e=>{m.current={x:e.clientX,y:e.clientY}},t=()=>{d.current=null,m.current=null};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[n]),(0,i.useEffect)(()=>{if(!n||0===l.length||!t)return;let e=t/2,r=a/2,i=()=>{o(t=>{let a=t.map(e=>({...e})),i=0,s=0,n=0,l=0;d.current&&m.current&&(i=m.current.x-d.current.startX,s=m.current.y-d.current.startY,n=d.current.nodeOrigX+i,l=d.current.nodeOrigY+s),a.forEach(t=>{if(d.current?.id===t.id)t.x=n,t.y=l,t.vx=0,t.vy=0;else{let a=e-t.x,i=r-t.y;t.vx+=.05*a*.05,t.vy+=.05*i*.05,t.vx+=(Math.random()-.5)*.003,t.vy+=(Math.random()-.5)*.003,t.x+=t.vx,t.y+=t.vy,t.vx*=.94,t.vy*=.94}});for(let e=0;e<6;e++)for(let e=0;e<a.length;e++)for(let t=e+1;t<a.length;t++){let r=a[e],i=a[t],s=d.current?.id===r.id,n=d.current?.id===i.id,l=i.x-r.x,o=i.y-r.y,c=l*l+o*o,m=r.radius+i.radius+5;if(c<m*m&&c>0){let e=Math.sqrt(c),t=m-e,a=l/e,d=o/e,u=.5*t;s?(i.x+=a*t,i.y+=d*t):n?(r.x-=a*t,r.y-=d*t):(r.x-=a*u,r.y-=d*u,i.x+=a*u,i.y+=d*u)}}return a}),c.current=requestAnimationFrame(i)};return c.current=requestAnimationFrame(i),()=>{null!==c.current&&cancelAnimationFrame(c.current)}},[n,t,a,l.length]),{nodes:l,onMouseDown:(e,t,a,r)=>{e.preventDefault(),d.current={id:t,startX:e.clientX,startY:e.clientY,nodeOrigX:a,nodeOrigY:r},m.current={x:e.clientX,y:e.clientY}},dragId:d.current?.id}})(S,j.width,j.height,c,z,"natural"===h);if(!e||0===e.length)return(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無交易資料可顯示"});let D=(e,t)=>{let a,r,i=e/(t-1||1);return i<.33?(a="radial-gradient(circle at 30% 30%, rgb(167, 139, 250), rgb(124, 58, 237))",r="rgba(124, 58, 237, 0.4)"):i<.66?(a="radial-gradient(circle at 30% 30%, rgb(34, 211, 238), rgb(8, 145, 178))",r="rgba(8, 145, 178, 0.4)"):(a="radial-gradient(circle at 30% 30%, rgb(52, 211, 153), rgb(5, 150, 105))",r="rgba(5, 150, 105, 0.4)"),{background:a,shadowColor:r}},M=null!==g?S[g]:null;return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(o,{x:b.x,y:b.y,visible:null!==g&&!!M&&!I,children:M&&(0,r.jsxs)("div",{className:"px-4 py-3 bg-zinc-900/90 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl min-w-[160px] animate-in fade-in zoom-in-95 duration-200",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-xs font-medium text-zinc-400",children:"成交單價"}),(0,r.jsx)("span",{className:"text-sm font-bold text-white",children:M.label})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center text-xs",children:[(0,r.jsx)("span",{className:"text-zinc-500",children:"成交筆數"}),(0,r.jsxs)("span",{className:"font-medium text-violet-300",children:[M.count," 筆"]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center text-xs",children:[(0,r.jsx)("span",{className:"text-zinc-500",children:"總銷坪數"}),(0,r.jsxs)("span",{className:"font-medium text-cyan-300",children:[Math.round(M.totalArea)," 坪"]})]})]}),(0,r.jsx)("div",{className:"absolute left-1/2 bottom-0 -mb-1 w-2 h-2 bg-zinc-900/90 border-r border-b border-white/10 rotate-45 -translate-x-1/2"})]})}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4 p-4 bg-zinc-900/30 border border-white/5 rounded-xl",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-zinc-400 text-xs",children:"單價範圍"}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(l.p,{type:"number",value:t,onChange:e=>d(Number(e.target.value)),className:"w-16 h-7 text-xs bg-zinc-950/50 border-white/10 px-2"}),(0,r.jsx)("span",{className:"text-zinc-600",children:"-"}),(0,r.jsx)(l.p,{type:"number",value:a,onChange:e=>m(Number(e.target.value)),className:"w-16 h-7 text-xs bg-zinc-950/50 border-white/10 px-2"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-zinc-400 text-xs",children:"級距"}),(0,r.jsx)(l.p,{type:"number",value:s,onChange:e=>u(Number(e.target.value)),className:"w-14 h-7 text-xs bg-zinc-950/50 border-white/10 px-2"})]}),(0,r.jsxs)("div",{className:"flex bg-zinc-950/50 rounded-md p-0.5 border border-white/10",children:[(0,r.jsx)("button",{onClick:()=>x("count"),className:(0,n.cn)("px-2.5 py-1 text-[10px] rounded transition-colors","count"===c?"bg-violet-500 text-white shadow-sm":"text-zinc-400 hover:text-white"),children:"成交筆數"}),(0,r.jsx)("button",{onClick:()=>x("area"),className:(0,n.cn)("px-2.5 py-1 text-[10px] rounded transition-colors","area"===c?"bg-violet-500 text-white shadow-sm":"text-zinc-400 hover:text-white"),children:"總銷坪數"})]})]}),(0,r.jsxs)("div",{className:"bg-zinc-950/50 p-1 rounded-lg border border-white/5 flex gap-1",children:[(0,r.jsx)("button",{onClick:()=>p("natural"),className:(0,n.cn)("px-3 py-1.5 text-xs font-medium rounded-md transition-all duration-300","natural"===h?"bg-gradient-to-r from-violet-600 to-indigo-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-500 hover:text-zinc-300"),children:(0,r.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,r.jsxs)("span",{className:"relative flex h-2 w-2",children:[(0,r.jsx)("span",{className:(0,n.cn)("absolute inline-flex h-full w-full rounded-full bg-violet-400 opacity-75","natural"===h&&"animate-ping")}),(0,r.jsx)("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-violet-500"})]}),"無重力模式"]})}),(0,r.jsx)("button",{onClick:()=>p("coordinate"),className:(0,n.cn)("px-3 py-1.5 text-xs font-medium rounded-md transition-all duration-300","coordinate"===h?"bg-gradient-to-r from-violet-600 to-indigo-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-500 hover:text-zinc-300"),children:(0,r.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,r.jsxs)("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,r.jsx)("path",{d:"M3 3v18h18"}),(0,r.jsx)("path",{d:"M18 17V9"}),(0,r.jsx)("path",{d:"M13 17V5"}),(0,r.jsx)("path",{d:"M8 17v-3"})]}),"座標模式"]})})]})]}),(0,r.jsxs)("div",{ref:v,className:(0,n.cn)("relative rounded-3xl overflow-hidden border border-white/5 transition-all duration-500","bg-gradient-to-b from-zinc-900 via-zinc-900 to-zinc-950","h-full min-h-[500px]"),children:[(0,r.jsxs)("div",{className:"absolute inset-0 pointer-events-none",children:[(0,r.jsx)("div",{className:"absolute top-0 inset-x-0 h-px bg-gradient-to-r from-transparent via-white/10 to-transparent"}),(0,r.jsx)("div",{className:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-violet-500/10 rounded-full blur-[100px]"}),(0,r.jsx)("div",{className:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-cyan-500/10 rounded-full blur-[100px]"})]}),(0,r.jsxs)("div",{className:"absolute inset-0",children:["natural"===h&&(0,r.jsxs)("div",{className:"absolute inset-0",children:[k.map((e,t)=>{let a=g===e.origIndex,i=I===e.id,s=D(e.origIndex,S.length),l=2*e.radius;return(0,r.jsxs)("div",{className:(0,n.cn)("absolute block rounded-full select-none cursor-grab active:cursor-grabbing will-change-transform",i?"z-[100] scale-110 shadow-2xl":"transition-[transform,box-shadow] duration-75 ease-linear"),style:{width:l,height:l,left:0,top:0,transform:`translate(${e.x-e.radius}px, ${e.y-e.radius}px) scale(${a||i?1.1:1})`,background:s.background,boxShadow:i?`0 25px 50px -12px ${s.shadowColor}, inset 0 2px 20px rgba(255,255,255,0.6)`:a?`0 20px 40px -10px ${s.shadowColor}, inset 0 2px 20px rgba(255,255,255,0.4)`:`0 10px 30px -10px ${s.shadowColor}, inset 0 2px 10px rgba(255,255,255,0.2)`,zIndex:i?100:a?50:10},onMouseEnter:t=>N(t,e.origIndex),onMouseLeave:()=>f(null),onMouseDown:t=>A(t,e.id,e.x,e.y),children:[(0,r.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-white/0 via-white/0 to-white/30 opacity-50 pointer-events-none"}),(0,r.jsx)("div",{className:"absolute top-[15%] left-[15%] w-[25%] h-[15%] rounded-[100%] bg-white blur-[2px] opacity-40 transform -rotate-45 pointer-events-none"}),(0,r.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-center z-20 pointer-events-none",children:[(0,r.jsx)("div",{className:(0,n.cn)("font-bold text-white drop-shadow-md leading-none",l>80?"text-2xl":l>60?"text-lg":"text-sm","mix-blend-overlay opacity-90"),children:e.value>=1?Math.round(e.value):e.value.toFixed(1)}),l>80&&(0,r.jsx)("div",{className:"text-[10px] text-white/70 mt-1 font-medium tracking-wide",children:"count"===c?"筆":"坪"})]})]},e.id)}),(0,r.jsx)("div",{className:"absolute bottom-4 left-0 right-0 text-center text-xs text-zinc-500 font-medium tracking-widest uppercase opacity-50 pointer-events-none",children:"Zero Gravity • Force Layout • Draggable"})]}),"coordinate"===h&&(0,r.jsxs)("div",{className:"absolute inset-0 pt-6 pb-8 px-0",children:[(0,r.jsx)("div",{className:"flex flex-col justify-between h-full py-0 pr-1 text-right w-[46px] border-r border-white/5 relative z-10 float-left",children:[...Array(6)].map((e,i)=>(0,r.jsx)("span",{className:"text-xs font-mono text-zinc-600 block leading-none transform -translate-y-1/2 first:translate-y-0 last:-translate-y-full",children:Math.round(a-(a-t)/5*i)},i))}),(0,r.jsxs)("div",{className:"relative ml-[46px] h-full",children:[(0,r.jsx)("div",{className:"absolute inset-0 flex flex-col justify-between pointer-events-none",children:[...Array(6)].map((e,t)=>(0,r.jsx)("div",{className:"w-full h-px border-t border-dashed border-zinc-800"},t))}),(0,r.jsx)("div",{className:"absolute inset-0",children:S.map((e,i)=>{var s;let l=(s="count"===c?e.count:e.totalArea,0===z?40:40+s/z*100),o=(e.min+e.max)/2,d=i/(S.length-1||1)*90+5,m=100-(o-t)/(a-t)*100,u=g===i,x=D(i,S.length);return(0,r.jsx)("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 transition-all duration-500",style:{left:`${d}%`,top:`${m}%`,zIndex:u?50:20},onMouseEnter:e=>N(e,i),onMouseLeave:()=>f(null),children:(0,r.jsx)("div",{className:(0,n.cn)("relative rounded-full flex items-center justify-center cursor-pointer shadow-lg transition-transform duration-300",u?"scale-110":"scale-100"),style:{width:l,height:l,background:x.background,boxShadow:u?`0 10px 20px -5px ${x.shadowColor}, inset 0 2px 10px rgba(255,255,255,0.3)`:`0 5px 15px -5px ${x.shadowColor}, inset 0 2px 5px rgba(255,255,255,0.2)`},children:(0,r.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-transparent to-white/30 opacity-60"})})},e.label)})}),(0,r.jsxs)("div",{className:"absolute bottom-0 inset-x-0 flex justify-between text-xs text-zinc-600 font-mono translate-y-full pt-1 px-2",children:[(0,r.jsx)("span",{children:"Low Price"}),(0,r.jsx)("span",{children:"High Price"})]})]})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between px-2 text-xs text-zinc-500",children:[(0,r.jsxs)("div",{children:["* Bubble size represents ","count"===c?"Transaction Count":"Total Area"]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-violet-500"}),(0,r.jsx)("span",{children:"Low"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-cyan-500"}),(0,r.jsx)("span",{children:"Mid"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),(0,r.jsx)("span",{children:"High"})]})]})]})]})}},88743:(e,t,a)=>{a.d(t,{M:()=>s,P:()=>n});var r=a(1934);let i={counties:[],districts:[],transactionType:"預售交易",buildingType:"",projectNames:[],dateRange:"1y",startDate:"",endDate:"",excludeCommercial:!1,floorPremium:.3,rankingCurrentPage:1,rankingPageSize:10,currentSort:{key:"saleAmountSum",order:"desc"},currentAverageType:"arithmetic",velocityView:"monthly",velocityMetric:"count",activeTab:"ranking",isFilterBarCompact:!1,analysisData:null,selectedRoomTypes:["套房","1房","2房","3房","4房","毛胚"]},s=["套房","1房","2房","3房","4房","毛胚","店舖","辦公/事務所","廠辦/工廠","其他"],n=(0,r.v)(e=>({...i,setCounties:t=>e({counties:t,districts:[]}),setDistricts:t=>e({districts:t}),setTransactionType:t=>e({transactionType:t}),setBuildingType:t=>e({buildingType:t}),setProjectNames:t=>e({projectNames:t}),setDateRange:(t,a,r)=>e(e=>({dateRange:t,startDate:a||e.startDate,endDate:r||e.endDate})),setCustomDate:(t,a)=>e({startDate:t,endDate:a,dateRange:"custom"}),setExcludeCommercial:t=>e({excludeCommercial:t}),setFloorPremium:t=>e({floorPremium:t}),setRankingCurrentPage:t=>e({rankingCurrentPage:t}),setRankingPageSize:t=>e({rankingPageSize:t}),setCurrentSort:t=>e({currentSort:t}),setCurrentAverageType:t=>e({currentAverageType:t}),setVelocityView:t=>e({velocityView:t}),setVelocityMetric:t=>e({velocityMetric:t}),setActiveTab:t=>e({activeTab:t}),setIsFilterBarCompact:t=>e({isFilterBarCompact:t}),setAnalysisData:t=>e({analysisData:t}),setSelectedRoomTypes:t=>e({selectedRoomTypes:t}),resetFilters:()=>e(i)}))},93398:(e,t,a)=>{a.d(t,{t:()=>x});var r=a(95155),i=a(12115),s=a(47650),n=a(40980),l=a(41159),o=a(89974),c=a(43987),d=a(7810);let m=(e,t=0)=>e?.toLocaleString(void 0,{maximumFractionDigits:t}),u=({children:e,triggerRect:t,isTopRow:a})=>{if(!t)return null;let i={position:"fixed",left:t.left+t.width/2,transform:"translateX(-50%)",zIndex:9999};return a?i.top=t.bottom+8:i.bottom=window.innerHeight-t.top+8,(0,s.createPortal)((0,r.jsx)("div",{style:i,className:"pointer-events-none",children:e}),document.body)};function x({data:e,floorPremium:t=.3,showGrid:a=!0,showSummary:s=!0,showComparison:x=!0}){let{horizontalGrid:h,sortedFloors:p,sortedUnits:g,unitColorMap:f,summary:b,horizontalComparison:y}=e,[v,j]=(0,i.useState)(null),w=()=>{j(null)};return h&&p&&g?(0,r.jsxs)("div",{className:"space-y-8 overflow-x-auto relative",children:[v&&(0,r.jsx)(u,{triggerRect:v.rect,isTopRow:v.isTopRow,children:(0,r.jsx)("div",{className:"w-48 bg-zinc-900 border border-zinc-700 rounded-lg p-3 shadow-xl animate-in fade-in zoom-in-95 duration-200",children:(0,r.jsxs)("div",{className:"space-y-1",children:[0===v.data.premium&&(0,r.jsx)("div",{className:"text-cyan-400 font-bold mb-1",children:"★ 基準戶"}),null!==v.data.premium&&(0,r.jsxs)("div",{className:"text-zinc-300",children:["調價: ",(0,r.jsxs)("span",{className:(0,n.cn)(v.data.premium>0?"text-red-400":v.data.premium<0?"text-violet-400":"text-zinc-400"),children:[v.data.premium>0?"+":"",v.data.premium.toFixed(2),"%"]})]}),(0,r.jsx)("div",{className:"h-px bg-zinc-700 my-2"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-x-2 gap-y-1 text-xs text-zinc-400",children:[(0,r.jsx)("span",{children:"成交總價:"})," ",(0,r.jsxs)("span",{className:"text-white text-right",children:[m(v.data.tooltipInfo.totalPrice),"萬"]}),(0,r.jsx)("span",{children:"房屋總價:"})," ",(0,r.jsxs)("span",{className:"text-white text-right",children:[m(v.data.tooltipInfo.housePrice),"萬"]}),(0,r.jsx)("span",{children:"車位總價:"})," ",(0,r.jsxs)("span",{className:"text-white text-right",children:[m(v.data.tooltipInfo.parkingPrice),"萬"]}),(0,r.jsx)("span",{children:"房屋面積:"})," ",(0,r.jsxs)("span",{className:"text-white text-right",children:[m(v.data.tooltipInfo.houseArea,2),"坪"]})]})]})})}),a&&(0,r.jsx)("div",{className:"min-w-max pb-32",children:(0,r.jsxs)("table",{className:"divide-y divide-zinc-800 border-collapse w-full text-sm",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"sticky left-0 bg-dark-card z-20 p-2 text-zinc-400 border-r border-zinc-800",children:"樓層 \\ 戶別"}),g.map(e=>(0,r.jsx)("th",{className:"p-2 text-zinc-300 font-medium border-l border-zinc-800/50 bg-zinc-900/50",children:e},e))]})}),(0,r.jsx)("tbody",{className:"divide-y divide-zinc-800/50",children:p.map((e,t)=>(0,r.jsxs)("tr",{className:"hover:bg-zinc-800/30 transition-colors",children:[(0,r.jsx)("td",{className:"sticky left-0 bg-dark-card z-10 p-2 font-bold text-zinc-300 border-r border-zinc-800 text-center",children:e}),g.map(a=>{let i=h[e]?.[a];return i&&0!==i.length?(0,r.jsx)("td",{className:"p-1 border-l border-zinc-800/50 align-top",children:(0,r.jsx)("div",{className:"flex flex-col gap-1",children:i.map((e,a)=>{var i;let s=(i=e.premium,e.isStorefront?"rgba(217, 119, 6, 0.4)":e.isOffice?"rgba(37, 99, 235, 0.4)":null===i?"#1f2937":i<0?"rgba(139, 92, 246, 0.4)":0===i?"#06b6d4":i>5?"rgba(244, 63, 94, 0.5)":i>2?"rgba(234, 179, 8, 0.4)":"rgba(34, 197, 94, 0.3)"),m=e.isStorefront?{icon:(0,r.jsx)(l.A,{className:"w-3 h-3"}),label:"店舖"}:e.isOffice?{icon:(0,r.jsx)(o.A,{className:"w-3 h-3"}),label:"辦公"}:e.remark?.includes("露台")?{icon:(0,r.jsx)(c.A,{className:"w-3 h-3"}),label:"露台"}:e.remark?.includes("親友")||e.remark?.includes("員工")?{icon:(0,r.jsx)(d.A,{className:"w-3 h-3"}),label:"親友"}:null,u=0===e.premium,x=t<3;return(0,r.jsxs)("div",{className:(0,n.cn)("p-1.5 rounded text-xs transition-transform hover:scale-105 cursor-default relative group",u&&"ring-1 ring-cyan-500"),style:{backgroundColor:s},onMouseEnter:t=>{j({rect:t.currentTarget.getBoundingClientRect(),data:e,isTopRow:x})},onMouseLeave:w,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,r.jsxs)("span",{className:"font-semibold text-white flex items-center gap-1",children:[m&&(0,r.jsx)("span",{className:"text-zinc-200",title:m.label,children:m.icon}),e.unitPrice.toFixed(1),"萬"]}),e.hasParking&&(0,r.jsx)("span",{className:"flex items-center justify-center w-3.5 h-3.5 bg-blue-500 text-white text-[9px] font-bold rounded-sm ml-0.5",title:"含車位",children:"P"})]}),(0,r.jsx)("div",{className:"text-[10px] text-zinc-300 mt-0.5 font-mono tracking-tight opacity-90",children:e.transactionDate||"-"})]},a)})})},`${e}-${a}`):(0,r.jsx)("td",{className:"p-2 border-l border-zinc-800/50 bg-zinc-900/20 text-center text-zinc-600",children:"-"},`${e}-${a}`)})]},e))})]})}),s&&b&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-zinc-200",children:"調價幅度統計摘要 (排除店舖/辦公室)"}),(0,r.jsx)("div",{className:"overflow-x-auto rounded-lg border border-zinc-800",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left text-zinc-300",children:[(0,r.jsx)("thead",{className:"text-xs text-zinc-400 uppercase bg-zinc-900/50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3",children:"基準房屋總價"}),(0,r.jsx)("th",{className:"px-6 py-3",children:"調價幅度總額"}),(0,r.jsx)("th",{className:"px-6 py-3",children:"總溢價率"}),(0,r.jsx)("th",{className:"px-6 py-3",children:"已售房屋坪數"}),(0,r.jsx)("th",{className:"px-6 py-3",children:"平均單價調價"})]})}),(0,r.jsx)("tbody",{children:(0,r.jsxs)("tr",{className:"bg-zinc-900/20 border-b border-zinc-800",children:[(0,r.jsxs)("td",{className:"px-6 py-4",children:[m(b.totalBaselineHousePrice)," 萬"]}),(0,r.jsxs)("td",{className:(0,n.cn)("px-6 py-4 font-bold",b.totalPricePremiumValue>0?"text-red-400":"text-violet-400"),children:[b.totalPricePremiumValue>0?"+":"",m(b.totalPricePremiumValue)," 萬"]}),(0,r.jsxs)("td",{className:"px-6 py-4",children:[(b.totalPricePremiumValue/b.totalBaselineHousePrice*100).toFixed(2)," %"]}),(0,r.jsxs)("td",{className:"px-6 py-4",children:[m(b.totalSoldArea)," 坪"]}),(0,r.jsxs)("td",{className:(0,n.cn)("px-6 py-4",b.totalPricePremiumValue>0?"text-red-400":"text-violet-400"),children:[(b.totalPricePremiumValue/b.totalSoldArea).toFixed(2)," 萬/坪"]})]})})]})})]}),x&&y&&y.length>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-zinc-200",children:"戶型水平價差與溢價貢獻"}),(0,r.jsx)("div",{className:"overflow-x-auto rounded-lg border border-zinc-800",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left text-zinc-300",children:[(0,r.jsx)("thead",{className:"text-xs text-zinc-400 uppercase bg-zinc-900/50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3",children:"戶型"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"基準戶 (樓/價)"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"水平價差(萬/坪)"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"去化戶數"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"溢價貢獻"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"貢獻佔比"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"基準房屋總價"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"平均單價調價"})]})}),(0,r.jsx)("tbody",{children:y.map((e,t)=>(0,r.jsxs)("tr",{className:"bg-zinc-900/20 border-b border-zinc-800 hover:bg-zinc-800/20",children:[(0,r.jsx)("td",{className:"px-4 py-3 font-medium text-white",children:e.unitType}),(0,r.jsx)("td",{className:"px-4 py-3",children:e.anchorInfo}),(0,r.jsx)("td",{className:(0,n.cn)("px-4 py-3",(e.horizontalPriceDiff||0)>0?"text-red-400":"text-zinc-400"),children:"number"==typeof e.horizontalPriceDiff?`${e.horizontalPriceDiff>0?"+":""}${e.horizontalPriceDiff.toFixed(2)} 萬/坪`:"-"}),(0,r.jsxs)("td",{className:"px-4 py-3",children:[e.unitsSold," 戶"]}),(0,r.jsxs)("td",{className:(0,n.cn)("px-4 py-3 font-bold",e.timePremiumContribution>0?"text-red-400":"text-violet-400"),children:[e.timePremiumContribution>0?"+":"",m(e.timePremiumContribution)," 萬"]}),(0,r.jsxs)("td",{className:"px-4 py-3",children:["number"==typeof e.contributionPercentage?e.contributionPercentage.toFixed(2):"0.00","%"]}),(0,r.jsxs)("td",{className:"px-4 py-3",children:[m(e.baselineHousePrice)," 萬"]}),(0,r.jsxs)("td",{className:"px-4 py-3",children:["number"==typeof e.avgPriceAdjustment?e.avgPriceAdjustment.toFixed(2):"-"," 萬/坪"]})]},t))})]})})]})]}):(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無有效熱力圖資料"})}},96066:(e,t,a)=>{a.d(t,{Q:()=>l});var r=a(1934),i=a(31692);let s={"ranking-chart":{width:400,height:300},"ranking-table":{width:600,height:400},"ranking-metrics":{width:600,height:200},"price-band-chart":{width:450,height:280},"price-band-table":{width:600,height:400},"price-band-location-table":{width:600,height:400},"price-band-location-chart":{width:600,height:400},"unit-price-bubble":{width:380,height:320},"unit-price-stats":{width:1e3,height:400},"type-comparison-table":{width:600,height:350},"sales-velocity-chart":{width:420,height:260},"sales-velocity-table":{width:600,height:400},"sales-heatmap":{width:450,height:350},"sales-heatmap-detail":{width:800,height:400},"parking-pie":{width:300,height:300},"parking-price":{width:400,height:300},"parking-scatter":{width:450,height:350},"parking-floor":{width:400,height:400},heatmap:{width:500,height:350},"heatmap-grid":{width:800,height:500},"heatmap-stats":{width:800,height:120},"heatmap-comparison":{width:800,height:300},"data-list":{width:600,height:400}},n=e=>({id:`page-${Date.now()}`,name:`第 ${e+1} 頁`,items:[]}),l=(0,r.v)()((0,i.Zr)((e,t)=>({pages:[n(0)],currentPageIndex:0,canvasRatio:"16:9",zoomLevel:100,viewMode:"continuous",selectedIds:[],isDragging:!1,draggedItemCount:0,hoveredPageIndex:null,setViewMode:t=>e({viewMode:t}),setDragging:(t,a=0)=>e({isDragging:t,draggedItemCount:a}),setHoveredPageIndex:t=>e({hoveredPageIndex:t}),get items(){let e=t();return e.pages[e.currentPageIndex]?.items||[]},addPage:()=>{e(e=>{let t=n(e.pages.length);return{pages:[...e.pages,t],currentPageIndex:e.pages.length,selectedIds:[]}})},deletePage:t=>{e(e=>{if(e.pages.length<=1||-1===e.pages.findIndex(e=>e.id===t))return e;let a=e.pages.filter(e=>e.id!==t).map((e,t)=>({...e,name:`第 ${t+1} 頁`})),r=Math.min(e.currentPageIndex,a.length-1);return{pages:a,currentPageIndex:r,selectedIds:[]}})},setCurrentPage:t=>{e(e=>({currentPageIndex:Math.max(0,Math.min(t,e.pages.length-1)),selectedIds:[]}))},renamePage:(t,a)=>{e(e=>({pages:e.pages.map(e=>e.id===t?{...e,name:a}:e)}))},reorderPages:(t,a)=>{e(e=>{if(t===a)return e;let r=[...e.pages],[i]=r.splice(t,1);r.splice(a,0,i);let s=r.map((e,t)=>({...e,name:`第 ${t+1} 頁`})),n=e.currentPageIndex;return e.currentPageIndex===t?n=a:t<e.currentPageIndex&&a>=e.currentPageIndex?n=e.currentPageIndex-1:t>e.currentPageIndex&&a<=e.currentPageIndex&&(n=e.currentPageIndex+1),{pages:s,currentPageIndex:n}})},addItem:(t,a)=>{let r=s[t]||{width:400,height:300};e(e=>{let i=e.pages[e.currentPageIndex];if(!i)return e;let s=20*i.items.length,n={id:`item-${Date.now()}`,type:t,x:50+s,y:50+s,width:r.width,height:r.height,scaleMode:"select",panOffset:{x:0,y:0},contentScale:1,data:a};return{pages:e.pages.map((t,a)=>a===e.currentPageIndex?{...t,items:[...t.items,n]}:t),selectedIds:[n.id]}})},updateItem:(t,a)=>{e(e=>({pages:e.pages.map((r,i)=>i===e.currentPageIndex?{...r,items:r.items.map(e=>e.id===t?{...e,...a}:e)}:r)}))},removeItem:t=>{e(e=>({pages:e.pages.map((a,r)=>r===e.currentPageIndex?{...a,items:a.items.filter(e=>e.id!==t)}:a),selectedIds:e.selectedIds.filter(e=>e!==t)}))},moveItemToPage:(t,a)=>{e(e=>{let r=e.pages[e.currentPageIndex],i=r?.items.find(e=>e.id===t);return!i||a===e.currentPageIndex||a<0||a>=e.pages.length?e:{pages:e.pages.map((r,s)=>s===e.currentPageIndex?{...r,items:r.items.filter(e=>e.id!==t)}:s===a?{...r,items:[...r.items,{...i,x:50,y:50}]}:r),selectedIds:[]}})},clearCanvas:()=>{e(e=>({pages:e.pages.map((t,a)=>a===e.currentPageIndex?{...t,items:[]}:t),selectedIds:[]}))},batchUpdateItems:t=>{e(e=>({pages:e.pages.map((a,r)=>r===e.currentPageIndex?{...a,items:a.items.map(e=>t[e.id]?{...e,...t[e.id]}:e)}:a)}))},setCanvasRatio:t=>e({canvasRatio:t}),setZoomLevel:t=>e({zoomLevel:Math.max(25,Math.min(400,t))}),resetZoom:()=>e({zoomLevel:100}),setSelectedIds:t=>e({selectedIds:t}),toggleSelection:t=>{e(e=>({selectedIds:e.selectedIds.includes(t)?e.selectedIds.filter(e=>e!==t):[...e.selectedIds,t]}))},addToSelection:t=>{e(e=>({selectedIds:e.selectedIds.includes(t)?e.selectedIds:[...e.selectedIds,t]}))},clearSelection:()=>e({selectedIds:[]}),removeSelectedItems:()=>{e(e=>e.pages[e.currentPageIndex]?{pages:e.pages.map((t,a)=>a===e.currentPageIndex?{...t,items:t.items.filter(t=>!e.selectedIds.includes(t.id))}:t),selectedIds:[]}:e)},moveSelectedItemsToPage:t=>{e(e=>{if(t===e.currentPageIndex||t<0||t>=e.pages.length)return e;let a=e.pages[e.currentPageIndex].items.filter(t=>e.selectedIds.includes(t.id));return 0===a.length?e:{pages:e.pages.map((r,i)=>i===e.currentPageIndex?{...r,items:r.items.filter(t=>!e.selectedIds.includes(t.id))}:i===t?{...r,items:[...r.items,...a.map((e,t)=>({...e,x:50+20*t,y:50+20*t}))]}:r),selectedIds:[]}})}}),{name:"report-builder-storage"}))},97085:(e,t,a)=>{a.d(t,{A:()=>l});var r=a(95155);a(12115);var i=a(37206),s=a(81477);let n=(0,i.default)(()=>Promise.all([a.e(7776),a.e(4822)]).then(a.bind(a,44822)),{loadableGenerated:{webpack:()=>[null]},ssr:!1});function l({type:e,series:t,options:a,height:i=350,title:l,description:o,className:c,loading:d}){let m={chart:{background:"transparent",toolbar:{show:!1}},theme:{mode:"dark",palette:"palette1"},dataLabels:{enabled:!1},grid:{borderColor:"#374151",strokeDashArray:4},xaxis:{labels:{style:{colors:"#9ca3af"}},axisBorder:{color:"#4b5563"},axisTicks:{color:"#4b5563"}},yaxis:{labels:{style:{colors:"#9ca3af"}}},tooltip:{theme:"dark",style:{fontSize:"12px"},x:{show:!0}}},u={...m,...a,chart:{...m.chart,...a.chart}};return(0,r.jsxs)(s.Zp,{className:`p-4 ${c}`,children:[(l||o)&&(0,r.jsxs)("div",{className:"mb-4",children:[l&&(0,r.jsx)("h3",{className:"text-lg font-bold text-white mb-1",children:l}),o&&(0,r.jsx)("p",{className:"text-sm text-gray-400",children:o})]}),d?(0,r.jsx)("div",{className:"flex items-center justify-center",style:{height:i},children:(0,r.jsx)("div",{className:"loader"})}):(0,r.jsx)(n,{options:u,series:t,type:e,height:i,width:"100%"})]})}},98563:(e,t,a)=>{a.d(t,{E:()=>s});var r=a(95155);a(12115);var i=a(40980);function s({title:e,stats:t,noDataMessage:a="無資料",className:s,averageType:n="weighted"}){if(!t||0===t.count)return(0,r.jsxs)("div",{className:(0,i.cn)("p-6 border border-white/5 rounded-lg bg-zinc-900/30",s),children:[(0,r.jsx)("h3",{className:"text-zinc-400 font-medium mb-4",children:e}),(0,r.jsx)("p",{className:"text-zinc-500 text-center py-4",children:a})]});let l="weighted"===n&&t.weightedAvgPrice?t.weightedAvgPrice:t.avgPrice;return(0,r.jsxs)("div",{className:(0,i.cn)("p-6 border border-white/5 rounded-lg bg-zinc-900/30",s),children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-white",children:e}),(0,r.jsxs)("span",{className:"text-xs text-zinc-500 bg-zinc-800 px-2 py-1 rounded",children:["樣本數: ",t.count]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,r.jsx)("div",{className:"space-y-1",children:(0,r.jsx)("table",{className:"w-full text-sm",children:(0,r.jsxs)("tbody",{className:"divide-y divide-white/5",children:[(0,r.jsxs)("tr",{className:"group",children:[(0,r.jsx)("td",{className:"py-2 text-zinc-400",children:"weighted"===n?"加權平均單價":"算術平均單價"}),(0,r.jsxs)("td",{className:"py-2 text-right font-mono text-white group-hover:text-cyan-400 transition-colors",children:[(0,i.Z)(l)," 萬/坪"]})]}),(0,r.jsxs)("tr",{className:"group",children:[(0,r.jsx)("td",{className:"py-2 text-zinc-400",children:"最低單價"}),(0,r.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors",children:(0,i.Z)(t.minPrice)})]}),(0,r.jsxs)("tr",{className:"group",children:[(0,r.jsx)("td",{className:"py-2 text-zinc-400",children:"1/4分位數"}),(0,r.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors",children:(0,i.Z)(t.q1Price)})]}),(0,r.jsxs)("tr",{className:"group",children:[(0,r.jsx)("td",{className:"py-2 text-violet-400 font-medium",children:"中位數單價"}),(0,r.jsx)("td",{className:"py-2 text-right font-mono text-violet-400 font-bold",children:(0,i.Z)(t.medianPrice)})]}),(0,r.jsxs)("tr",{className:"group",children:[(0,r.jsx)("td",{className:"py-2 text-zinc-400",children:"3/4分位數"}),(0,r.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors",children:(0,i.Z)(t.q3Price)})]}),(0,r.jsxs)("tr",{className:"group",children:[(0,r.jsx)("td",{className:"py-2 text-zinc-400",children:"最高單價"}),(0,r.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors",children:(0,i.Z)(t.maxPrice)})]})]})})}),(0,r.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,r.jsxs)("div",{className:"p-3 bg-zinc-950/50 rounded border border-white/5",children:[(0,r.jsx)("div",{className:"text-cyan-500 font-medium mb-1 text-xs uppercase tracking-wider",children:"最高價建案"}),(0,r.jsx)("div",{className:"text-white font-bold text-lg mb-1",children:t.maxPriceProject||"N/A"}),(0,r.jsxs)("div",{className:"flex gap-4 text-zinc-400 text-xs",children:[(0,r.jsxs)("span",{children:["戶型: ",t.maxPriceUnit||"-"]}),(0,r.jsxs)("span",{children:["樓層: ",t.maxPriceFloor||"-"]})]})]}),(0,r.jsxs)("div",{className:"p-3 bg-zinc-950/50 rounded border border-white/5",children:[(0,r.jsx)("div",{className:"text-green-500 font-medium mb-1 text-xs uppercase tracking-wider",children:"最低價建案"}),(0,r.jsx)("div",{className:"text-white font-bold text-lg mb-1",children:t.minPriceProject||"N/A"}),(0,r.jsxs)("div",{className:"flex gap-4 text-zinc-400 text-xs",children:[(0,r.jsxs)("span",{children:["戶型: ",t.minPriceUnit||"-"]}),(0,r.jsxs)("span",{children:["樓層: ",t.minPriceFloor||"-"]})]})]})]})]})]})}},98883:(e,t,a)=>{a.d(t,{P:()=>r});let r=e=>{let t=new Date,a=new Date;switch(e){case"1q":a.setMonth(t.getMonth()-3);break;case"2q":a.setMonth(t.getMonth()-6);break;case"3q":a.setMonth(t.getMonth()-9);break;case"1y":a.setFullYear(t.getFullYear()-1);break;case"this_year":a=new Date(t.getFullYear(),0,1);break;case"last_2_years":a=new Date(t.getFullYear()-1,0,1);break;case"last_3_years":a=new Date(t.getFullYear()-2,0,1);break;default:return{startDate:"",endDate:""}}return{startDate:a.toISOString().split("T")[0],endDate:t.toISOString().split("T")[0]}}}}]);