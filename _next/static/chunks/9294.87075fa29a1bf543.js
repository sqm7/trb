"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9294],{19835:(e,t,n)=>{n.d(t,{A:()=>l});let l=(0,n(78340).A)("move",[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]])},22651:(e,t,n)=>{n.d(t,{A:()=>l});let l=(0,n(78340).A)("zoom-in",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]])},29294:(e,t,n)=>{n.r(t),n.d(t,{default:()=>g});var l=n(95155),i=n(12115),r=n(21975),s=n(19835),a=n(22390);let o=(0,n(78340).A)("spline",[["circle",{cx:"19",cy:"5",r:"2",key:"mhkx31"}],["circle",{cx:"5",cy:"19",r:"2",key:"v8kfzx"}],["path",{d:"M5 17A12 12 0 0 1 17 5",key:"1okkup"}]]);var d=n(22651),c=n(69220),x=n(68459),u=n(40980);let h={wall:"#60a5fa",window:"#38bdf8",pillar:"#f97316"},m=[{type:"wardrobe",label:"衣櫃",size:{w:80,h:40}},{type:"cabinet",label:"櫃體",size:{w:60,h:30}},{type:"bed",label:"床",size:{w:120,h:80}},{type:"sofa",label:"沙發",size:{w:110,h:50}},{type:"diningTable",label:"餐桌",size:{w:90,h:60}},{type:"desk",label:"書桌",size:{w:80,h:45}},{type:"chair",label:"椅子",size:{w:30,h:30}},{type:"sink",label:"洗手台",size:{w:50,h:35}},{type:"toilet",label:"馬桶",size:{w:35,h:45}},{type:"kitchen",label:"流理台",size:{w:120,h:40}},{type:"fridge",label:"冰箱",size:{w:40,h:35}}],p=()=>Math.random().toString(36).slice(2,10);function g(){let e=(0,i.useRef)(null),t=(0,i.useRef)(null),n=(0,i.useRef)(null),g=(0,i.useRef)({zoomLevel:1,panOffset:{x:0,y:0},isPanning:!1,panStart:{x:0,y:0},drawing:!1,startPoint:{x:0,y:0},endPoint:{x:0,y:0},drawingPoints:[],measureLines:[],wallPaths:[],rooms:[],furniture:[],scale:null,selected:null,draggingFurnitureId:null,dragStartMouse:{x:0,y:0},dragStartFurniturePos:{x:0,y:0},snappedPoint:null,isSpacePressed:!1,isShiftPressed:!1,isOrthoMode:!1}),[f,y]=(0,i.useState)({mode:null,hasImage:!1,scaleSet:!1,infoText:"請上傳平面圖開始",fillColor:"#4ade80",fillOpacity:.2,imageOpacity:.7,boundaryFillColor:"#22c55e",boundaryFillOpacity:.15,zoomDisplay:100,isOrtho:!1,selectedFurnitureType:"wardrobe",wallThicknessDefault:15}),[b,w]=(0,i.useState)(null),v=e=>({x:(e.x-g.current.panOffset.x)/g.current.zoomLevel,y:(e.y-g.current.panOffset.y)/g.current.zoomLevel}),k=(e,t)=>Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2),j=e=>{let t=0;for(let n=0,l=e.length;n<l;n++)t+=e[n].x*e[n===l-1?0:n+1].y-e[n===l-1?0:n+1].x*e[n].y;return Math.abs(t/2)},P=(e,t)=>{let n=parseInt(e.slice(1,3),16),l=parseInt(e.slice(3,5),16),i=parseInt(e.slice(5,7),16);return`rgba(${n}, ${l}, ${i}, ${t})`},z=(e,t,n)=>{let l=n.x-t.x,i=n.y-t.y,r=e.x-t.x,s=e.y-t.y,a=l*l+i*i;if(0===a)return k(e,t);let o=Math.max(0,Math.min(1,(r*l+s*i)/a));return k(e,{x:t.x+l*o,y:t.y+i*o})},N=(e,t,n)=>{let l=n.x-t.x,i=n.y-t.y,r=e.x-t.x,s=e.y-t.y,a=l*l+i*i;if(0===a)return{point:t,t:0};let o=Math.max(0,Math.min(1,(r*l+s*i)/a));return{point:{x:t.x+l*o,y:t.y+i*o},t:o}},S=(e,t)=>{let n=!1;for(let l=0,i=t.length-1;l<t.length;i=l++){let r=t[l].x,s=t[l].y,a=t[i].x,o=t[i].y;s>e.y!=o>e.y&&e.x<(a-r)*(e.y-s)/(o-s+1e-5)+r&&(n=!n)}return n},T=e=>m.find(t=>t.type===e)||m[0],F=e=>{let t=T(e.type),n=t.size.w*e.scale/2,l=t.size.h*e.scale/2,i=Math.cos(e.rotation),r=Math.sin(e.rotation),s=[{x:-n,y:-l},{x:n,y:-l},{x:n,y:l},{x:-n,y:l}].map(t=>({x:e.position.x+t.x*i-t.y*r,y:e.position.y+t.x*r+t.y*i})),a=s.map(e=>e.x),o=s.map(e=>e.y);return{minX:Math.min(...a),maxX:Math.max(...a),minY:Math.min(...o),maxY:Math.max(...o)}},L=(e,t,n,l,i)=>{e.save();let r=13/i;e.font=`bold ${r}px sans-serif`,e.fillStyle="rgba(0,0,0,0.7)";let s=e.measureText(t).width;e.fillRect(n.x-s/2-2/i,n.y-r-2/i,s+4/i,r+4/i),e.fillStyle=l,e.textAlign="center",e.fillText(t,n.x,n.y-4/i),e.restore()},C=()=>g.current.wallPaths.find(e=>e.isBoundary)||null,M=()=>{let e=g.current;if(!e.scale)return null;let t=C();if(!t||t.points.length<3)return null;let n=[],l=t.segments,i=t.points.length;for(let t=0;t<i;t++){let i=l[t%l.length],r=i?.thicknessCm??f.wallThicknessDefault;n.push(r*e.scale)}let r=((e,t)=>{if(e.length<3)return[];let n=(e=>{let t=0;for(let n=0,l=e.length;n<l;n++){let i=e[n],r=e[n===l-1?0:n+1];t+=i.x*r.y-r.x*i.y}return t/2})(e)>0,l=(e,t)=>{let l=t.x-e.x,i=t.y-e.y,r=Math.sqrt(l*l+i*i)||1,s=-i/r,a=l/r;return n?{x:s,y:a}:{x:-s,y:-a}},i=[],r=e.length;for(let n=0;n<r;n++){let s=e[(n-1+r)%r],a=e[n],o=e[(n+1)%r],d=t[(n-1+r)%r],c=t[n],x=l(s,a),u=l(a,o),h={x:s.x+x.x*d,y:s.y+x.y*d},m={x:a.x+x.x*d,y:a.y+x.y*d},p={x:a.x+u.x*c,y:a.y+u.y*c},g={x:o.x+u.x*c,y:o.y+u.y*c},f=(h.x-m.x)*(p.y-g.y)-(h.y-m.y)*(p.x-g.x);if(1e-5>Math.abs(f)){i.push({x:a.x+x.x*d,y:a.y+x.y*d});continue}let y=((h.x*m.y-h.y*m.x)*(p.x-g.x)-(h.x-m.x)*(p.x*g.y-p.y*g.x))/f,b=((h.x*m.y-h.y*m.x)*(p.y-g.y)-(h.y-m.y)*(p.x*g.y-p.y*g.x))/f;i.push({x:y,y:b})}return i})(t.points,n.map(e=>e));if(r.length<3)return null;let s=j(r)/(e.scale*e.scale);return{areaCm2:s,areaM2:s/1e4,areaPing:s/33057.9,polygon:r}},E=(0,i.useCallback)(()=>{let t=e.current,l=t?.getContext("2d");if(!t||!l)return;let i=g.current,{width:r,height:s}=t;if(l.clearRect(0,0,r,s),l.save(),l.translate(i.panOffset.x,i.panOffset.y),l.scale(i.zoomLevel,i.zoomLevel),n.current){let e=n.current;l.save(),l.globalAlpha=f.imageOpacity,l.drawImage(e,-e.naturalWidth/2,-e.naturalHeight/2),l.restore()}let a=C(),o=M()?.polygon||null;if(a&&a.points.length>=3){l.beginPath(),l.moveTo(a.points[0].x,a.points[0].y);for(let e=1;e<a.points.length;e++)l.lineTo(a.points[e].x,a.points[e].y);l.closePath(),l.fillStyle=P(f.boundaryFillColor,f.boundaryFillOpacity),l.fill()}if(i.wallPaths.forEach(e=>{if(!(e.points.length<2))for(let t=0;t<e.points.length;t++){let n=e.points[t],r=e.points[(t+1)%e.points.length];if(!e.isBoundary&&t===e.points.length-1)break;let s=e.segments[t%e.segments.length],a=b?.kind==="wall"&&b.pathId===e.id&&b.segmentIndex===t,o=e.isBoundary?"#a855f7":h[s.wallType],d=Math.max(2,(i.scale?(s.thicknessCm||f.wallThicknessDefault)*i.scale:6)/12)/i.zoomLevel;l.beginPath(),l.moveTo(n.x,n.y),l.lineTo(r.x,r.y),"window"===s.wallType?l.setLineDash([8/i.zoomLevel,6/i.zoomLevel]):l.setLineDash([]),l.strokeStyle=a?"#facc15":o,l.lineWidth=a?1.6*d:d,l.stroke(),l.setLineDash([])}}),o&&o.length>=3){l.beginPath(),l.moveTo(o[0].x,o[0].y);for(let e=1;e<o.length;e++)l.lineTo(o[e].x,o[e].y);l.closePath(),l.strokeStyle="#a78bfa",l.lineWidth=1.6/i.zoomLevel,l.setLineDash([6/i.zoomLevel,6/i.zoomLevel]),l.stroke(),l.setLineDash([])}if(i.rooms.forEach(e=>{if(e.points.length<3)return;let t=b?.kind==="room"&&b.id===e.id;l.beginPath(),l.moveTo(e.points[0].x,e.points[0].y);for(let t=1;t<e.points.length;t++)l.lineTo(e.points[t].x,e.points[t].y);if(l.closePath(),l.fillStyle=P(e.fillColor,e.fillOpacity),l.fill(),l.strokeStyle=t?"#facc15":"#34d399",l.lineWidth=(t?3:2)/i.zoomLevel,l.stroke(),i.scale){let t=j(e.points)/(i.scale*i.scale),n=(e=>{if(0===e.length)return{x:0,y:0};let t=0,n=0,l=0;for(let i=0;i<e.length;i++){let r=e[i],s=e[(i+1)%e.length],a=r.x*s.y-s.x*r.y;l+=a,t+=(r.x+s.x)*a,n+=(r.y+s.y)*a}let i=3*l;return 0===i?e[0]:{x:t/i,y:n/i}})(e.points);L(l,`${e.name} ${(t/33057.9).toFixed(2)} 坪`,n,"#fbbf24",i.zoomLevel)}}),i.measureLines.forEach(e=>{if(l.beginPath(),l.moveTo(e.pixelStart.x,e.pixelStart.y),l.lineTo(e.pixelEnd.x,e.pixelEnd.y),l.strokeStyle=e.color,l.lineWidth=2/i.zoomLevel,l.stroke(),i.scale){let t=k(e.pixelStart,e.pixelEnd)/i.scale,n={x:(e.pixelStart.x+e.pixelEnd.x)/2,y:(e.pixelStart.y+e.pixelEnd.y)/2};L(l,`${t.toFixed(1)} cm`,n,"#f87171",i.zoomLevel)}}),i.furniture.forEach(e=>{let t=b?.kind==="furniture"&&b.id===e.id;((e,t,n,l)=>{let i=T(t.type),r=i.size.w*t.scale,s=i.size.h*t.scale;e.save(),e.translate(t.position.x,t.position.y),e.rotate(t.rotation),e.lineWidth=2/l,e.strokeStyle=n?"#facc15":"#e5e7eb";let a=(t,n,l,i)=>e.strokeRect(t,n,l,i),o=(t,n,l)=>{e.beginPath(),e.arc(t,n,l,0,2*Math.PI),e.stroke()};switch(t.type){case"bed":a(-r/2,-s/2,r,s),a(-r/2,-s/2,r,.25*s),a(-r/2+.08*r,-s/2+.06*s,.28*r,.14*s),a(r/2-.36*r,-s/2+.06*s,.28*r,.14*s),e.beginPath(),e.moveTo(-r/2,-(.05*s)),e.lineTo(r/2,-(.05*s)),e.stroke();break;case"sofa":a(-r/2,-s/2,r,s),a(-r/2,-s/2,r,.3*s),a(-r/2,-s/2,.15*r,s),a(r/2-.15*r,-s/2,.15*r,s),e.beginPath(),e.moveTo(0,-s/2),e.lineTo(0,s/2),e.stroke();break;case"wardrobe":a(-r/2,-s/2,r,s),e.beginPath(),e.moveTo(0,-s/2),e.lineTo(0,s/2),e.stroke(),o(-(.15*r),0,Math.max(2,.03*r)),o(.15*r,0,Math.max(2,.03*r));break;case"cabinet":a(-r/2,-s/2,r,s),e.beginPath(),e.moveTo(-r/2,-s/6),e.lineTo(r/2,-s/6),e.moveTo(-r/2,s/6),e.lineTo(r/2,s/6),e.stroke();break;case"diningTable":{a(-r/2,-s/2,r,s);let e=.18*r,t=.28*s;a(-r/2-.9*e,-t/2,e,t),a(r/2-.1*e,-t/2,e,t),a(-e/2,-s/2-.9*t,e,t),a(-e/2,s/2-.1*t,e,t);break}case"desk":a(-r/2,-s/2,r,s),e.beginPath(),e.moveTo(-r/2,-s/6),e.lineTo(r/2,-s/6),e.stroke(),a(r/2-.22*r,-s/2,.2*r,.45*s),e.beginPath(),e.moveTo(r/2-.22*r,-s/2+.22*s),e.lineTo(r/2-.02*r,-s/2+.22*s),e.stroke();break;case"chair":a(-r/2,-s/4,r,s/2),a(-r/2,-s/2,r,s/4),e.beginPath(),e.moveTo(-r/2,s/4),e.lineTo(-r/2,s/2),e.moveTo(r/2,s/4),e.lineTo(r/2,s/2),e.stroke();break;case"sink":a(-r/2,-s/2,r,s),o(0,0,.25*Math.min(r,s)),e.beginPath(),e.moveTo(0,-s/2),e.lineTo(0,-s/2-.2*s),e.stroke();break;case"toilet":a(-r/2,-s/2,r,.35*s),e.beginPath(),e.ellipse(0,.1*s,.4*r,.35*s,0,0,2*Math.PI),e.stroke(),e.beginPath(),e.ellipse(0,.1*s,.2*r,.18*s,0,0,2*Math.PI),e.stroke();break;case"kitchen":a(-r/2,-s/2,r,s),o(-(.2*r),0,.18*Math.min(r,s)),o(.2*r,0,.18*Math.min(r,s)),a(-r/2+.05*r,-s/2+.05*s,.35*r,.4*s);break;case"fridge":a(-r/2,-s/2,r,s),e.beginPath(),e.moveTo(-r/2,-s/2+.45*s),e.lineTo(r/2,-s/2+.45*s),e.stroke(),e.beginPath(),e.moveTo(r/2-.15*r,-s/2+.1*s),e.lineTo(r/2-.15*r,-s/2+.4*s),e.moveTo(r/2-.15*r,-s/2+.55*s),e.lineTo(r/2-.15*r,-s/2+.85*s),e.stroke();break;default:a(-r/2,-s/2,r,s)}e.restore()})(l,e,t,i.zoomLevel)}),i.drawing){if("setScale"===f.mode||"measureLine"===f.mode)l.beginPath(),l.moveTo(i.startPoint.x,i.startPoint.y),l.lineTo(i.endPoint.x,i.endPoint.y),l.strokeStyle="#ef4444",l.lineWidth=2/i.zoomLevel,l.stroke();else if(("drawBoundary"===f.mode||"drawRoom"===f.mode||"drawWall"===f.mode)&&i.drawingPoints.length>0){l.beginPath(),l.moveTo(i.drawingPoints[0].x,i.drawingPoints[0].y);for(let e=1;e<i.drawingPoints.length;e++)l.lineTo(i.drawingPoints[e].x,i.drawingPoints[e].y);l.lineTo(i.endPoint.x,i.endPoint.y),l.strokeStyle="#38bdf8",l.lineWidth=2/i.zoomLevel,l.stroke()}}if(i.snappedPoint){let e,t={x:(e=i.snappedPoint).x*g.current.zoomLevel+g.current.panOffset.x,y:e.y*g.current.zoomLevel+g.current.panOffset.y};l.beginPath(),l.arc(t.x,t.y,6,0,2*Math.PI),l.strokeStyle="#facc15",l.lineWidth=2,l.stroke()}l.restore()},[b,f]);(0,i.useEffect)(()=>{g.current.isOrthoMode=f.isOrtho,E()},[f.isOrtho,E]),(0,i.useEffect)(()=>{E()},[f.imageOpacity,f.fillColor,f.fillOpacity,f.boundaryFillColor,f.boundaryFillOpacity,f.mode,f.wallThicknessDefault,b,E]);let I=e=>{g.current.selected=e,w(e)},O=(0,i.useCallback)(()=>{let e=g.current;if(e.drawingPoints.length>=3){let t={id:p(),points:[...e.drawingPoints],segments:Array.from({length:e.drawingPoints.length},()=>({wallType:"wall",thicknessCm:f.wallThicknessDefault})),isBoundary:!0};e.wallPaths=e.wallPaths.filter(e=>!e.isBoundary),e.wallPaths.push(t),y(e=>({...e,infoText:`外框建立完成。`}))}e.drawingPoints=[],e.drawing=!1,E()},[E,f.wallThicknessDefault]),R=(0,i.useCallback)(()=>{let e=g.current;if(e.drawingPoints.length>=2){let t={id:p(),points:[...e.drawingPoints],segments:Array.from({length:e.drawingPoints.length-1},()=>({wallType:"wall",thicknessCm:f.wallThicknessDefault}))};e.wallPaths.push(t),y(e=>({...e,infoText:`線稿已新增。`}))}e.drawingPoints=[],e.drawing=!1,E()},[E,f.wallThicknessDefault]),D=(0,i.useCallback)(()=>{let e=g.current;if(e.drawingPoints.length>=3){let t={id:p(),name:`空間 ${e.rooms.length+1}`,points:[...e.drawingPoints],fillColor:f.fillColor,fillOpacity:f.fillOpacity,zone:"indoor"};e.rooms.push(t),y(e=>({...e,infoText:`空間已新增。`}))}e.drawingPoints=[],e.drawing=!1,E()},[E,f.fillColor,f.fillOpacity]);(0,i.useEffect)(()=>{let e=e=>{if("Shift"===e.key&&(g.current.isShiftPressed=!0),"Space"===e.code&&(g.current.isSpacePressed=!0),"Escape"===e.key){let e=g.current;(e.drawing||e.drawingPoints.length>0)&&(e.drawingPoints=[],e.drawing=!1,y(e=>({...e,infoText:"已取消繪製"})),E())}"Enter"===e.code&&("drawBoundary"===f.mode&&O(),"drawWall"===f.mode&&R(),"drawRoom"===f.mode&&D())},t=e=>{"Shift"===e.key&&(g.current.isShiftPressed=!1),"Space"===e.code&&(g.current.isSpacePressed=!1)};return window.addEventListener("keydown",e),window.addEventListener("keyup",t),()=>{window.removeEventListener("keydown",e),window.removeEventListener("keyup",t)}},[O,R,D,f.mode,E]),(0,i.useEffect)(()=>{let n=()=>{t.current&&e.current&&(e.current.width=t.current.clientWidth,e.current.height=t.current.clientHeight,E())};window.addEventListener("resize",n),n();let l=e=>{"Space"===e.code&&(g.current.isSpacePressed=!0)},i=e=>{"Space"===e.code&&(g.current.isSpacePressed=!1)};return window.addEventListener("keydown",l),window.addEventListener("keyup",i),()=>{window.removeEventListener("resize",n),window.removeEventListener("keydown",l),window.removeEventListener("keyup",i)}},[E]);let A=(()=>{if(!b||"wall"!==b.kind)return null;let e=g.current.wallPaths.find(e=>e.id===b.pathId);if(!e)return null;let t=e.segments[b.segmentIndex];return{path:e,segment:t,segmentIndex:b.segmentIndex}})();(()=>{if(b&&"room"===b.kind)return g.current.rooms.find(e=>e.id===b.id)})();let $=b&&"furniture"===b.kind&&g.current.furniture.find(e=>e.id===b.id)||null,W=M(),B=C(),X=g.current.scale,Y=!!X,_=g.current.rooms.map(e=>{let t=Y?j(e.points)/(X*X):null;return{room:e,areaCm2:t}}),U=Y?_.reduce((e,t)=>e+((t.room.zone??"indoor")==="indoor"&&t.areaCm2||0),0):null,H=Y?_.reduce((e,t)=>e+((t.room.zone??"indoor")==="public"&&t.areaCm2||0),0):null,V=X&&null!==U&&null!==H?U+H:null,q=V&&V>0&&null!==H?H/V:null,G=(e,t)=>{y(n=>({...n,mode:e,infoText:t}))},K=[{id:"upload",label:"Step 1 上傳平面圖",done:f.hasImage,action:"upload"},{id:"scale",label:"Step 2 設定比例尺",done:f.scaleSet,action:()=>G("setScale","Step 2：請標出已知距離並輸入實際公分")},{id:"boundary",label:"Step 3 繪製外框",done:!!B&&B.points.length>=3,action:()=>G("drawBoundary","Step 3：繪製外框（右鍵或 Enter 結束）")},{id:"rooms",label:"Step 4 繪製空間",done:g.current.rooms.length>0,action:()=>G("drawRoom","Step 4：繪製各空間範圍")},{id:"furniture",label:"Step 5 家具配置（可選）",done:g.current.furniture.length>0,action:()=>G("placeFurniture","Step 5：拖放家具並可旋轉/縮放")}];return(0,l.jsxs)("div",{className:"flex flex-col h-full w-full gap-4 relative",ref:t,children:[(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-2 p-2 bg-zinc-900/80 backdrop-blur border border-white/5 rounded-xl z-10 w-full lg:w-max lg:absolute lg:top-4 lg:left-1/2 lg:-translate-x-1/2 shadow-xl",children:[(0,l.jsx)("input",{type:"file",id:"fp-upload",className:"hidden",accept:"image/*",onChange:t=>{let l=t.target.files?.[0];if(!l)return;let i=new FileReader;i.onload=t=>{let l=new Image;l.onload=()=>{n.current=l,g.current.panOffset={x:(e.current?.width||0)/2,y:(e.current?.height||0)/2};let t=e.current;if(t){let e=t.width/l.naturalWidth,n=t.height/l.naturalHeight;g.current.zoomLevel=.9*Math.min(e,n),y(e=>({...e,zoomDisplay:Math.round(100*g.current.zoomLevel)}))}y(e=>({...e,hasImage:!0,infoText:"圖片已載入。請設定比例尺 (Step 1)。"})),E()},l.src=t.target?.result},i.readAsDataURL(l)}}),(0,l.jsx)("label",{htmlFor:"fp-upload",className:"p-2 hover:bg-zinc-800 rounded-lg cursor-pointer text-zinc-400 hover:text-white transition-colors",title:"上傳圖片",children:(0,l.jsx)(r.A,{className:"h-5 w-5"})}),(0,l.jsx)("div",{className:"h-6 w-px bg-white/10 mx-1"}),(0,l.jsxs)("button",{onClick:()=>y(e=>({...e,mode:"setScale"})),className:(0,u.cn)("p-2 rounded-lg transition-colors flex items-center gap-2","setScale"===f.mode?"bg-cyan-600 text-white":"text-zinc-400 hover:bg-zinc-800"),disabled:!f.hasImage,title:"1. 設定比例尺",children:[(0,l.jsx)(s.A,{className:"h-5 w-5 rotate-45"}),(0,l.jsx)("span",{className:"text-xs font-bold hidden lg:block",children:"比例尺"})]}),(0,l.jsxs)("button",{onClick:()=>y(e=>({...e,mode:"measureLine"})),className:(0,u.cn)("p-2 rounded-lg transition-colors flex items-center gap-2","measureLine"===f.mode?"bg-cyan-600 text-white":"text-zinc-400 hover:bg-zinc-800"),disabled:!f.scaleSet,title:"測量長度",children:[(0,l.jsx)(a.A,{className:"h-5 w-5"}),(0,l.jsx)("span",{className:"text-xs font-bold hidden lg:block",children:"測距"})]}),(0,l.jsxs)("button",{onClick:()=>y(e=>({...e,mode:"drawBoundary"})),className:(0,u.cn)("p-2 rounded-lg transition-colors flex items-center gap-2","drawBoundary"===f.mode?"bg-violet-600 text-white":"text-zinc-400 hover:bg-zinc-800"),title:"外框（牆）",children:[(0,l.jsx)(o,{className:"h-5 w-5"}),(0,l.jsx)("span",{className:"text-xs font-bold hidden lg:block",children:"外框"})]}),(0,l.jsxs)("button",{onClick:()=>y(e=>({...e,mode:"drawWall"})),className:(0,u.cn)("p-2 rounded-lg transition-colors flex items-center gap-2","drawWall"===f.mode?"bg-blue-600 text-white":"text-zinc-400 hover:bg-zinc-800"),title:"線稿（牆線）",children:[(0,l.jsx)(o,{className:"h-5 w-5"}),(0,l.jsx)("span",{className:"text-xs font-bold hidden lg:block",children:"線稿"})]}),(0,l.jsxs)("button",{onClick:()=>y(e=>({...e,mode:"drawRoom"})),className:(0,u.cn)("p-2 rounded-lg transition-colors flex items-center gap-2","drawRoom"===f.mode?"bg-emerald-600 text-white":"text-zinc-400 hover:bg-zinc-800"),title:"空間範圍",children:[(0,l.jsx)(o,{className:"h-5 w-5"}),(0,l.jsx)("span",{className:"text-xs font-bold hidden lg:block",children:"空間"})]}),(0,l.jsxs)("button",{onClick:()=>y(e=>({...e,mode:"placeFurniture"})),className:(0,u.cn)("p-2 rounded-lg transition-colors flex items-center gap-2","placeFurniture"===f.mode?"bg-amber-600 text-white":"text-zinc-400 hover:bg-zinc-800"),title:"放置家具",children:[(0,l.jsx)("span",{className:"text-xs font-bold hidden lg:block",children:"家具"}),(0,l.jsx)("span",{className:"text-xs font-bold",children:"+F"})]}),(0,l.jsxs)("button",{onClick:()=>y(e=>({...e,mode:"select"})),className:(0,u.cn)("p-2 rounded-lg transition-colors flex items-center gap-2","select"===f.mode?"bg-slate-600 text-white":"text-zinc-400 hover:bg-zinc-800"),title:"選取/編輯",children:[(0,l.jsx)(s.A,{className:"h-5 w-5"}),(0,l.jsx)("span",{className:"text-xs font-bold hidden lg:block",children:"選取"})]}),(0,l.jsx)("div",{className:"h-6 w-px bg-white/10 mx-1"}),(0,l.jsxs)("button",{onClick:()=>y(e=>({...e,isOrtho:!e.isOrtho})),className:(0,u.cn)("p-2 rounded-lg transition-colors flex items-center gap-2",f.isOrtho?"bg-purple-600 text-white":"text-zinc-400 hover:bg-zinc-800"),title:"垂直/水平鎖定 (Shift)",children:[(0,l.jsx)(s.A,{className:"h-5 w-5"}),(0,l.jsx)("span",{className:"text-xs font-bold hidden lg:block",children:"正交"})]}),(0,l.jsx)("div",{className:"h-6 w-px bg-white/10 mx-1"}),(0,l.jsx)("button",{onClick:()=>{g.current.zoomLevel=Math.min(1.1*g.current.zoomLevel,5),y(e=>({...e,zoomDisplay:Math.round(100*g.current.zoomLevel)})),E()},className:"p-2 text-zinc-400 hover:bg-zinc-800 rounded-lg transition-colors",title:"放大",children:(0,l.jsx)(d.A,{className:"h-5 w-5"})}),(0,l.jsx)("button",{onClick:()=>{g.current.zoomLevel=Math.max(g.current.zoomLevel/1.1,.2),y(e=>({...e,zoomDisplay:Math.round(100*g.current.zoomLevel)})),E()},className:"p-2 text-zinc-400 hover:bg-zinc-800 rounded-lg transition-colors",title:"縮小",children:(0,l.jsx)(c.A,{className:"h-5 w-5"})}),(0,l.jsx)("div",{className:"h-6 w-px bg-white/10 mx-1"}),(0,l.jsx)("button",{onClick:()=>{confirm("清除所有繪製？")&&(g.current.measureLines=[],g.current.wallPaths=[],g.current.rooms=[],g.current.furniture=[],g.current.scale=null,I(null),y(e=>({...e,scaleSet:!1,infoText:"已清除，請重新設定比例尺"})),E())},className:"p-2 text-red-400 hover:bg-red-500/10 rounded-lg transition-colors",title:"全部清除",children:(0,l.jsx)(x.A,{className:"h-5 w-5"})}),(0,l.jsxs)("div",{className:"flex items-center gap-2 pl-2",children:[(0,l.jsx)("span",{className:"text-xs text-zinc-400",children:"圖片透明度"}),(0,l.jsx)("input",{type:"range",min:.1,max:1,step:.05,value:f.imageOpacity,onChange:e=>y(t=>({...t,imageOpacity:parseFloat(e.target.value)})),className:"w-24"})]})]}),(0,l.jsx)("div",{className:"absolute top-4 right-4 z-10 bg-black/60 backdrop-blur px-3 py-1.5 rounded-full border border-white/10 text-xs text-zinc-300",children:f.infoText}),(0,l.jsxs)("div",{className:"absolute top-20 right-4 z-10 w-80 bg-zinc-900/80 border border-white/5 rounded-xl shadow-xl p-4 space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-sm font-semibold text-white",children:"使用流程"}),(0,l.jsx)("div",{className:"mt-2 space-y-2 text-xs",children:K.map(e=>(0,l.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:(0,u.cn)("h-2.5 w-2.5 rounded-full",e.done?"bg-emerald-400":"bg-zinc-600")}),(0,l.jsx)("span",{className:e.done?"text-emerald-200":"text-zinc-300",children:e.label})]}),"upload"===e.action?(0,l.jsx)("label",{htmlFor:"fp-upload",className:"cursor-pointer rounded-full border border-white/10 px-2 py-0.5 text-[11px] text-zinc-300 hover:border-white/20",children:"上傳"}):(0,l.jsx)("button",{type:"button",onClick:e.action,className:"rounded-full border border-white/10 px-2 py-0.5 text-[11px] text-zinc-300 hover:border-white/20",children:"前往"})]},e.id))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-sm font-semibold text-white",children:"外框 / 淨面積"}),(0,l.jsx)("p",{className:"text-xs text-zinc-400",children:"外框牆厚可在選取牆段後調整"}),(0,l.jsxs)("div",{className:"mt-2 flex items-center justify-between text-xs",children:[(0,l.jsx)("span",{className:"text-zinc-400",children:"預設牆厚 (cm)"}),(0,l.jsx)("input",{type:"number",min:1,value:f.wallThicknessDefault,onChange:e=>y(t=>({...t,wallThicknessDefault:parseFloat(e.target.value||"0")})),className:"w-20 bg-zinc-900 border border-white/10 rounded px-2 py-1 text-white"})]}),(0,l.jsxs)("div",{className:"mt-2 flex items-center justify-between text-xs",children:[(0,l.jsx)("span",{className:"text-zinc-400",children:"外框填色"}),(0,l.jsx)("input",{type:"color",value:f.boundaryFillColor,onChange:e=>y(t=>({...t,boundaryFillColor:e.target.value})),className:"h-6 w-10 bg-transparent border border-white/10 rounded"})]}),(0,l.jsxs)("div",{className:"mt-2 flex items-center justify-between text-xs",children:[(0,l.jsx)("span",{className:"text-zinc-400",children:"外框透明度"}),(0,l.jsx)("input",{type:"range",min:0,max:.6,step:.05,value:f.boundaryFillOpacity,onChange:e=>y(t=>({...t,boundaryFillOpacity:parseFloat(e.target.value)})),className:"w-24"})]}),W?(0,l.jsxs)("div",{className:"mt-2 space-y-1 text-xs text-zinc-200",children:[(0,l.jsxs)("div",{children:["淨面積：",W.areaM2.toFixed(2)," ㎡"]}),(0,l.jsxs)("div",{children:["坪數：",W.areaPing.toFixed(2)," 坪"]}),(0,l.jsxs)("div",{children:["面積：",W.areaCm2.toFixed(0)," cm\xb2"]})]}):(0,l.jsx)("p",{className:"mt-2 text-xs text-zinc-500",children:"尚未設定外框或比例尺"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-sm font-semibold text-white",children:"房間列表"}),(0,l.jsx)("div",{className:"mt-2 space-y-2 max-h-48 overflow-auto",children:0===g.current.rooms.length?(0,l.jsx)("p",{className:"text-xs text-zinc-500",children:"尚未新增空間"}):g.current.rooms.map(e=>{let t=g.current.scale?j(e.points)/(g.current.scale*g.current.scale):null,n=null!==t?t/1e4:null,i=null!==t?t/33057.9:null;return(0,l.jsxs)("div",{className:"rounded-lg border border-white/10 bg-zinc-950/40 p-2",children:[(0,l.jsx)("input",{value:e.name,onChange:t=>{e.name=t.target.value,E(),w(t=>t&&"room"===t.kind&&t.id===e.id?{...t}:t)},className:"w-full bg-transparent text-xs text-white mb-1 outline-none border-b border-white/10"}),(0,l.jsxs)("div",{className:"flex items-center justify-between text-[11px] text-zinc-400 mb-1",children:[(0,l.jsx)("span",{children:"類型"}),(0,l.jsxs)("select",{value:e.zone??"indoor",onChange:t=>{e.zone=t.target.value,E()},className:"bg-zinc-900 border border-white/10 rounded px-1 py-0.5 text-white",children:[(0,l.jsx)("option",{value:"indoor",children:"室內"}),(0,l.jsx)("option",{value:"public",children:"公設"})]})]}),(0,l.jsxs)("div",{className:"text-[11px] text-zinc-400 flex flex-col gap-0.5",children:[(0,l.jsxs)("span",{children:["坪數：",null!==i?i.toFixed(2):"-"]}),(0,l.jsxs)("span",{children:["平方公尺：",null!==n?n.toFixed(2):"-"]}),(0,l.jsxs)("span",{children:["面積：",null!==t?t.toFixed(0):"-"]})]})]},e.id)})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-sm font-semibold text-white",children:"室內 / 公設統計"}),Y?(0,l.jsxs)("div",{className:"mt-2 space-y-1 text-xs text-zinc-200",children:[(0,l.jsxs)("div",{children:["室內：",null!==U?(U/33057.9).toFixed(2):"-"," 坪 /"," ",null!==U?(U/1e4).toFixed(2):"-"," ㎡"]}),(0,l.jsxs)("div",{children:["公設：",null!==H?(H/33057.9).toFixed(2):"-"," 坪 /"," ",null!==H?(H/1e4).toFixed(2):"-"," ㎡"]}),(0,l.jsxs)("div",{children:["公設比：",null!==q?`${(100*q).toFixed(1)}%`:"-"]})]}):(0,l.jsx)("p",{className:"mt-2 text-xs text-zinc-500",children:"請先設定比例尺"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-sm font-semibold text-white",children:"報表輸出"}),(0,l.jsxs)("div",{className:"mt-2 flex flex-wrap gap-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>{var t,n;let l,i=e.current;if(!i)return;let r=_.slice(0,10),s=Math.max(0,_.length-r.length),a=160+18*r.length+18*!!s,o=document.createElement("canvas");o.width=i.width+64,o.height=i.height+64+48+a;let d=o.getContext("2d");if(!d)return;d.fillStyle="#0b0c10",d.fillRect(0,0,o.width,o.height),d.fillStyle="#e5e7eb",d.font="bold 20px sans-serif",d.fillText("平面圖測量報表",32,52),d.font="12px sans-serif",d.fillStyle="#94a3b8",d.fillText(new Date().toLocaleString("zh-TW"),32,72),d.strokeStyle="#1f2937",d.lineWidth=2,d.strokeRect(32,80,i.width,i.height),d.drawImage(i,32,80);let c=80+i.height+28;d.fillStyle="#e5e7eb",d.font="bold 14px sans-serif",d.fillText("面積統計",32,c),c+=18,d.font="12px sans-serif";let x=e=>null==e?"-":`${(e/33057.9).toFixed(2)} 坪 / ${(e/1e4).toFixed(2)} ㎡`;d.fillStyle="#cbd5f5",d.fillText(`室內面積：${x(U)}`,32,c),c+=16,d.fillText(`公設面積：${x(H)}`,32,c),c+=16,d.fillText(`公設比：${null!==q?(100*q).toFixed(1)+"%":"-"}`,32,c),c+=22,d.fillStyle="#e5e7eb",d.font="bold 14px sans-serif",d.fillText("空間明細",32,c),c+=18,d.font="12px sans-serif",d.fillStyle="#cbd5f5",r.forEach(e=>{let t=(e.room.zone??"indoor")==="public"?"公設":"室內",n=e.areaCm2,l=null!==n?n/1e4:null,i=null!==n?n/33057.9:null;d.fillText(`${e.room.name} (${t}) - ${null!==i?i.toFixed(2):"-"} 坪 / ${null!==l?l.toFixed(2):"-"} ㎡`,32,c),c+=16}),s&&(d.fillStyle="#94a3b8",d.fillText(`... 另有 ${s} 個空間`,32,c)),t=o.toDataURL("image/png"),n=`平面圖_報表_${Date.now()}.png`,(l=document.createElement("a")).href=t,l.download=n,l.click()},className:"rounded-lg border border-emerald-400/30 bg-emerald-500/10 px-3 py-1.5 text-xs text-emerald-200 hover:bg-emerald-500/20",children:"匯出報表 PNG"}),(0,l.jsx)("button",{type:"button",onClick:()=>{var e,t;let n,l;0!==g.current.rooms.length&&(e=new Blob(["\uFEFF"+[["名稱","類型","坪數","平方公尺","面積cm2"],..._.map(e=>{let t=e.room,n=(t.zone??"indoor")==="public"?"公設":"室內",l=e.areaCm2,i=null!==l?l/1e4:null,r=null!==l?l/33057.9:null;return[t.name,n,null!==r?r.toFixed(2):"",null!==i?i.toFixed(2):"",null!==l?l.toFixed(0):""]})].map(e=>e.join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),t=`平面圖_房間表_${Date.now()}.csv`,n=URL.createObjectURL(e),(l=document.createElement("a")).href=n,l.download=t,l.click(),URL.revokeObjectURL(n))},className:"rounded-lg border border-white/10 px-3 py-1.5 text-xs text-zinc-200 hover:border-white/20",children:"匯出房間表 CSV"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-sm font-semibold text-white",children:"家具"}),(0,l.jsx)("div",{className:"grid grid-cols-2 gap-2 mt-2",children:m.map(e=>(0,l.jsx)("button",{onClick:()=>y(t=>({...t,mode:"placeFurniture",selectedFurnitureType:e.type})),className:(0,u.cn)("text-xs rounded-lg border px-2 py-1.5",f.selectedFurnitureType===e.type&&"placeFurniture"===f.mode?"border-amber-400 bg-amber-500/10 text-amber-200":"border-white/10 text-zinc-400 hover:border-white/20"),children:e.label},e.type))})]}),A&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-sm font-semibold text-white",children:"牆段設定"}),(0,l.jsxs)("div",{className:"mt-2 space-y-2 text-xs",children:[(0,l.jsxs)("label",{className:"flex items-center justify-between gap-2",children:[(0,l.jsx)("span",{className:"text-zinc-400",children:"類型"}),(0,l.jsxs)("select",{value:A.segment.wallType,onChange:e=>{A.segment.wallType=e.target.value,E()},className:"bg-zinc-900 border border-white/10 rounded px-2 py-1 text-white",children:[(0,l.jsx)("option",{value:"wall",children:"牆"}),(0,l.jsx)("option",{value:"window",children:"窗"}),(0,l.jsx)("option",{value:"pillar",children:"柱"})]})]}),(0,l.jsxs)("label",{className:"flex items-center justify-between gap-2",children:[(0,l.jsx)("span",{className:"text-zinc-400",children:"牆厚 (cm)"}),(0,l.jsx)("input",{type:"number",min:1,value:A.segment.thicknessCm,onChange:e=>{A.segment.thicknessCm=parseFloat(e.target.value||"0"),E()},className:"w-20 bg-zinc-900 border border-white/10 rounded px-2 py-1 text-white"})]}),(0,l.jsx)("button",{type:"button",onClick:()=>{let e=A.path,t=A.segmentIndex,n=e.points[t],l=e.points[(t+1)%e.points.length],i={x:(n.x+l.x)/2,y:(n.y+l.y)/2};e.points.splice(t+1,0,i);let r=e.segments[t];e.segments.splice(t,1,{...r},{...r}),I({kind:"wall",pathId:e.id,segmentIndex:t}),E()},className:"w-full mt-1 rounded-lg border border-amber-500/30 text-amber-300 hover:bg-amber-500/10 px-2 py-1.5",children:"分割線段"}),(0,l.jsx)("p",{className:"text-[10px] text-zinc-500",children:"選取牆段後，按住 Alt 點擊線段可分割區間"})]})]}),$&&(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-sm font-semibold text-white",children:"家具設定"}),(0,l.jsxs)("div",{className:"mt-2 space-y-2 text-xs",children:[(0,l.jsxs)("label",{className:"flex items-center justify-between gap-2",children:[(0,l.jsx)("span",{className:"text-zinc-400",children:"旋轉"}),(0,l.jsx)("input",{type:"range",min:0,max:360,value:180*$.rotation/Math.PI,onChange:e=>{$.rotation=parseFloat(e.target.value)*Math.PI/180,E()},className:"w-32"})]}),(0,l.jsxs)("label",{className:"flex items-center justify-between gap-2",children:[(0,l.jsx)("span",{className:"text-zinc-400",children:"縮放"}),(0,l.jsx)("input",{type:"range",min:.4,max:2,step:.05,value:$.scale,onChange:e=>{$.scale=parseFloat(e.target.value),E()},className:"w-32"})]})]})]})]}),(0,l.jsx)("canvas",{ref:e,className:(0,u.cn)("w-full h-full bg-zinc-950 cursor-crosshair touch-none",g.current.isPanning?"cursor-grab active:cursor-grabbing":""),onMouseDown:t=>{let n=g.current,l=e.current?.getBoundingClientRect();if(!l)return;let i=v({x:t.clientX-l.left,y:t.clientY-l.top});if(0===t.button){if(n.isSpacePressed){n.isPanning=!0,n.panStart={x:t.clientX,y:t.clientY};return}if(n.startPoint=n.snappedPoint?{...n.snappedPoint}:i,"select"===f.mode){let e,l,r,s,a=(e=>{for(let t of g.current.furniture){let n=F(t);if(e.x>=n.minX&&e.x<=n.maxX&&e.y>=n.minY&&e.y<=n.maxY)return t}return null})(i);if(a){I({kind:"furniture",id:a.id}),n.draggingFurnitureId=a.id,n.dragStartMouse={x:i.x,y:i.y},n.dragStartFurniturePos={...a.position},E();return}let o=(l=10/(e=g.current).zoomLevel,r=null,s=l,e.wallPaths.forEach(e=>{let t=e.isBoundary?e.points.length:e.points.length-1;for(let n=0;n<t;n++){let t=e.points[n],l=e.points[(n+1)%e.points.length],a=z(i,t,l);if(a<s){s=a;let o=N(i,t,l);r={pathId:e.id,segmentIndex:n,point:o.point}}}}),r);if(o){if(t.altKey){let e=n.wallPaths.find(e=>e.id===o.pathId);if(e){e.points.splice(o.segmentIndex+1,0,o.point);let t=e.segments[o.segmentIndex];e.segments.splice(o.segmentIndex,1,{...t},{...t}),y(e=>({...e,infoText:"已分割線段"})),E()}return}I({kind:"wall",pathId:o.pathId,segmentIndex:o.segmentIndex}),E();return}let d=(e=>{for(let t of g.current.rooms)if(S(e,t.points))return t;return null})(i);d?I({kind:"room",id:d.id}):I(null),E();return}if("drawBoundary"===f.mode||"drawWall"===f.mode||"drawRoom"===f.mode){n.drawing=!0,n.drawingPoints.push(n.startPoint),n.endPoint={...n.startPoint},E();return}if("placeFurniture"===f.mode){let e={id:p(),type:f.selectedFurnitureType,position:n.startPoint,rotation:0,scale:1};n.furniture.push(e),I({kind:"furniture",id:e.id}),E();return}("measureLine"===f.mode||"setScale"===f.mode)&&(n.drawing=!0,n.endPoint={...n.startPoint},E())}},onMouseMove:t=>{var n,l;let i,r,s,a,o=g.current,d=e.current?.getBoundingClientRect();if(!d)return;let c=t.clientX-d.left,x=t.clientY-d.top;if(o.isPanning){let e=t.clientX-o.panStart.x,n=t.clientY-o.panStart.y;o.panOffset.x+=e,o.panOffset.y+=n,o.panStart={x:t.clientX,y:t.clientY},E();return}let u=v({x:c,y:x});if("select"===f.mode&&o.draggingFurnitureId){let e=o.furniture.find(e=>e.id===o.draggingFurnitureId);e&&(e.position={x:o.dragStartFurniturePos.x+(u.x-o.dragStartMouse.x),y:o.dragStartFurniturePos.y+(u.y-o.dragStartMouse.y)},E());return}r=15/(i=g.current).zoomLevel,s=null,a=e=>{let t=k(u,e);t<r&&(r=t,s=e)},i.wallPaths.forEach(e=>e.points.forEach(e=>a(e))),i.rooms.forEach(e=>e.points.forEach(e=>a(e))),i.drawingPoints.forEach(e=>a(e)),i.snappedPoint=s;let h=o.snappedPoint?{...o.snappedPoint}:u;if(o.drawing&&(o.isShiftPressed||o.isOrthoMode)){let e=o.startPoint;("drawBoundary"===f.mode||"drawWall"===f.mode||"drawRoom"===f.mode)&&o.drawingPoints.length>0&&(e=o.drawingPoints[o.drawingPoints.length-1]),n=e,h=Math.abs((l=h).x-n.x)>Math.abs(l.y-n.y)?{x:l.x,y:n.y}:{x:n.x,y:l.y}}o.endPoint=h,E()},onMouseUp:()=>{let e=g.current;if(e.isPanning){e.isPanning=!1;return}if(e.draggingFurnitureId){e.draggingFurnitureId=null;return}if(!e.drawing)return;if("drawBoundary"===f.mode){if(e.drawingPoints.length>=2){let t=e.drawingPoints[0],n=15/e.zoomLevel;k(e.endPoint,t)<n&&O()}return}if("drawRoom"===f.mode){if(e.drawingPoints.length>=2){let t=e.drawingPoints[0],n=15/e.zoomLevel;k(e.endPoint,t)<n&&D()}return}if("drawWall"===f.mode)return;let t=k(e.startPoint,e.endPoint);if(!(t<1/e.zoomLevel)){if("setScale"===f.mode){let n=parseFloat(prompt("請輸入這段距離的實際長度(公分) e.g. 100","100")||"");n>0&&(e.scale=t/n,e.measureLines.push({type:"line",pixelStart:e.startPoint,pixelEnd:e.endPoint,color:"#06b6d4"}),y(t=>({...t,scaleSet:!0,mode:null,infoText:`比例尺已設定: ${(e.scale||0).toFixed(2)} px/cm`})))}else"measureLine"===f.mode&&e.scale&&e.measureLines.push({type:"line",pixelStart:e.startPoint,pixelEnd:e.endPoint,color:"#facc15"});e.drawing=!1,E()}},onContextMenu:e=>{e.preventDefault();let t=g.current;"drawBoundary"===f.mode?O():"drawWall"===f.mode?R():"drawRoom"===f.mode?D():(t.drawingPoints=[],t.drawing=!1,E())}}),(0,l.jsx)("div",{className:"absolute bottom-4 left-4 text-[10px] text-zinc-500 pointer-events-none bg-black/40 p-2 rounded-lg backdrop-blur-sm border border-white/5",children:(0,l.jsx)("p",{children:"左鍵: 繪圖 | 右鍵/Enter: 結束 | Esc: 取消 | Shift: 正交 | 空白鍵: 平移 | Alt+點牆段: 分割"})})]})}},68459:(e,t,n)=>{n.d(t,{A:()=>l});let l=(0,n(78340).A)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},69220:(e,t,n)=>{n.d(t,{A:()=>l});let l=(0,n(78340).A)("zoom-out",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]])}}]);