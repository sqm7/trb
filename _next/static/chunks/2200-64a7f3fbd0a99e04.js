"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2200],{4439:(e,t,r)=>{r.d(t,{m:()=>s});var a=r(95155),o=r(12115),n=r(97085),i=r(37717);function s({data:e,selectedRooms:t,minArea:r,maxArea:s,interval:l,onDataPointClick:c,height:d,chartId:f}){let h=(0,i.A)(),u=(0,o.useMemo)(()=>[{from:0,to:0,color:h.surface||"#27272a",name:"0 戶"},{from:1,to:5,color:"#facc15",name:"1-5 戶"},{from:6,to:20,color:"#fbbf24",name:"6-20 戶"},{from:21,to:50,color:"#f97316",name:"21-50 戶"},{from:51,to:1e4,color:"#dc2626",name:"> 50 戶"}],[h]),{series:m,maxValue:b}=(0,o.useMemo)(()=>{if(!e||0===t.length)return{series:[],maxValue:0};let a=[];for(let e=r;e<s;e+=l){let t=Number.isInteger(l)&&Number.isInteger(r),o=t?e.toFixed(0):e.toFixed(1),n=t?(e+l).toFixed(0):(e+l).toFixed(1);a.push(`${o}-${n}`)}let o=0;return{series:a.map(a=>{let[n,i]=a.split("-").map(parseFloat);return{name:a,data:t.map(t=>{let a=(e[t]||[]).filter(e=>e>=n&&e<i&&e>=r&&e<=s).length;return a>o&&(o=a),a})}}),maxValue:o}},[e,t,r,s,l]),y=(0,o.useMemo)(()=>({chart:{type:"heatmap",height:d||Math.max(400,22*m.length),background:"transparent",toolbar:{show:!1},foreColor:h.text,id:f,events:{dataPointSelection:(e,r,a)=>{if(c){let{seriesIndex:e,dataPointIndex:r}=a,o=a.w.globals.seriesNames[e];c(t[r],o)}}}},plotOptions:{heatmap:{radius:0,useFillColorAsStroke:!0,enableShades:!1,colorScale:{ranges:u}}},dataLabels:{enabled:!0,style:{colors:[({value:e})=>0===e?"transparent":h.text]},formatter:function(e){return 0===e?"":e}},xaxis:{type:"category",categories:t},title:{text:"房型面積分佈熱力圖",align:"center",style:{color:h.text,fontSize:"16px"}},grid:{borderColor:h.grid},tooltip:{theme:"dark",y:{formatter:e=>0===e?"無成交紀錄":`${e} 戶`}}}),[m,t,u,c,h,f,d]);return e&&0!==m.length?(0,a.jsx)(n.A,{type:"heatmap",series:m,options:y,height:y.chart?.height||400,className:"w-full h-full"}):(0,a.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無面積分佈資料"})}},27529:(e,t,r)=>{r.d(t,{FH:()=>s});var a=r(16385),o=r(55873);async function n(){let{data:{session:e}}=await a.N.auth.getSession();return{"Content-Type":"application/json",apikey:o.m5,Authorization:`Bearer ${e?.access_token||o.m5}`}}async function i(e){let t=await n(),r=await fetch(o.Sn.RANKING_ANALYSIS,{method:"POST",headers:t,body:JSON.stringify({filters:e})});if(!r.ok)throw Error((await r.json().catch(()=>({error:`Analysis request failed: ${r.status}`}))).error||"Analyze data failed");return r.json()}let s={checkAuth:async function(){let{data:{session:e}}=await a.N.auth.getSession();e||console.log("User not logged in, but allowing access.")},getUser:async function(){let{data:{user:e}}=await a.N.auth.getUser();return e},signOut:async function(){let{error:e}=await a.N.auth.signOut();if(e)throw console.error("Sign out failed:",e),e},fetchData:async function(e,t){let r=await n(),a=await fetch(o.Sn.QUERY_DATA,{method:"POST",headers:r,body:JSON.stringify({filters:e,pagination:t})});if(!a.ok)throw Error((await a.json().catch(()=>({error:"Failed to parse server response"}))).error||"Fetch data failed");return a.json()},analyzeData:i,analyzeProjectRanking:i,fetchSubData:async function(e,t,r){if(!e||!t||!r)throw Error(`Insufficient parameters: ${e}, ${t}, ${r}`);let a=await n(),i=await fetch(o.Sn.SUB_DATA,{method:"POST",headers:a,body:JSON.stringify({id:e,type:t,county:r})});if(!i.ok)throw Error((await i.json().catch(()=>({error:"Failed to fetch sub data"}))).error||"Fetch sub data failed");return i.json()},fetchProjectNameSuggestions:async function(e,t,r=[]){let a=await n(),i=t.replace(/\u3127/g,"一"),s=await fetch(o.Sn.PROJECT_NAMES,{method:"POST",headers:a,body:JSON.stringify({countyCode:e,query:i,districts:r,detailed:!0})});if(!s.ok)throw Error(`Server error: ${s.status}`);return s.json()},getAdminUsers:async function(){let e=await n(),t=await fetch(o.Sn.GET_USERS,{method:"POST",headers:e,body:JSON.stringify({})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to fetch users"}))).error||"Fetch users failed");return t.json()},getUserActivity:async function(e,t=200,r=0){let a=await n(),i=await fetch(o.Sn.GET_USER_ACTIVITY,{method:"POST",headers:a,body:JSON.stringify({userId:e,limit:t,offset:r})});if(!i.ok)throw Error((await i.json().catch(()=>({error:"Failed to fetch user activity"}))).error||"Fetch user activity failed");return i.json()},getActivityStats:async function(){let e=await n(),t=await fetch(o.Sn.GET_ACTIVITY_STATS,{method:"POST",headers:e,body:JSON.stringify({})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to fetch activity stats"}))).error||"Fetch activity stats failed");return t.json()},validateReferralCode:async function(e){let t=await n();return(await fetch(o.Sn.VALIDATE_REFERRAL_CODE,{method:"POST",headers:t,body:JSON.stringify({code:e})})).json()},activateSubscription:async function(e){let t=await n(),r=await fetch(o.Sn.ACTIVATE_SUBSCRIPTION,{method:"POST",headers:t,body:JSON.stringify(e)});if(!r.ok)throw Error((await r.json().catch(()=>({error:"Activation failed"}))).error||"Activation failed");return r.json()},bindReferralCode:async function(e){let t=await n(),r=await fetch(o.Sn.BIND_REFERRAL_CODE,{method:"POST",headers:t,body:JSON.stringify("string"==typeof e?{code:e}:e)});if(!r.ok)throw Error((await r.json().catch(()=>({error:"Failed to bind referral code"}))).error||"Failed to bind referral code");return r.json()},clearReferralCode:async function(){let e=await n(),t=await fetch(o.Sn.BIND_REFERRAL_CODE,{method:"POST",headers:e,body:JSON.stringify({action:"clear"})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to clear referral code"}))).error||"Failed to clear referral code");return t.json()},getReferralDashboard:async function(){let e=await n(),t=await fetch(o.Sn.GET_REFERRAL_DASHBOARD,{method:"POST",headers:e,body:JSON.stringify({})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to fetch referral data"}))).error||"Fetch referral dashboard failed");return t.json()},consumeReferralFeature:async function(e,t="consume"){let r=await n(),a=await fetch(o.Sn.CONSUME_REFERRAL_FEATURE,{method:"POST",headers:r,body:JSON.stringify({feature:e,mode:t})});if(!a.ok){let e=await a.json().catch(()=>({error:"Failed to consume feature"}));throw Error(e.error||e.reason||"Failed to consume feature")}return a.json()}}},37717:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(12115);let o=(e,t)=>getComputedStyle(document.documentElement).getPropertyValue(e).trim()||t,n=e=>{let t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/i);return t?[Number(t[1]),Number(t[2]),Number(t[3])]:null},i=e=>{let t=e.replace("#","").trim();if(![3,6].includes(t.length))return null;let r=parseInt(3===t.length?t.split("").map(e=>e+e).join(""):t,16);return Number.isNaN(r)?null:[r>>16&255,r>>8&255,255&r]},s=()=>{let e=[o("--color-chart-1","#8b5cf6"),o("--color-chart-2","#06b6d4"),o("--color-chart-3","#10b981"),o("--color-chart-4","#f43f5e"),o("--color-chart-5","#f59e0b")],t=o("--color-dark-bg","#09090b");return{bg:o("--color-dark-bg","#09090b"),card:o("--color-dark-card","#18181b"),surface:o("--color-dark-surface","#27272a"),primary:o("--color-primary","#8b5cf6"),primaryHover:o("--color-primary-hover","#7c3aed"),accent:o("--color-chart-2","#06b6d4"),accentAlt:o("--color-chart-4","#f43f5e"),text:o("--color-text-primary","#fafafa"),textMuted:o("--color-text-secondary","#a1a1aa"),border:o("--color-border","#27272a"),grid:o("--color-zinc-700","#3f3f46"),danger:o("--color-destructive","#ef4444"),warning:o("--color-amber-500","#f59e0b"),success:o("--color-emerald-500","#10b981"),chart:e,chartPalette:((e,t)=>{if(0===e.length)return[];let r=e.map(e=>((e,t,r=.35)=>{let a=i(e)??n(e),o=i(t)??n(t);if(!a||!o)return e;let s=(e,t)=>Math.round(e*(1-r)+t*r),l=s(a[0],o[0]),c=s(a[1],o[1]),d=s(a[2],o[2]);return`rgb(${l}, ${c}, ${d})`})(e,t,.4));return[...e,...r]})(e,t)}};function l(){let[e,t]=(0,a.useState)(()=>s());return(0,a.useEffect)(()=>{let e=()=>t(s());e();let r=new MutationObserver(e);r.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]});let a=t=>{"sqm_theme"===t.key&&e()};return window.addEventListener("storage",a),()=>{r.disconnect(),window.removeEventListener("storage",a)}},[]),(0,a.useMemo)(()=>e,[e])}},51806:(e,t,r)=>{r.d(t,{a:()=>s});var a=r(95155);r(12115);var o=r(33210),n=r(40980),i=r(81477);function s({isOpen:e,onClose:t,title:r,children:s,className:l,maxWidth:c="max-w-4xl"}){return e?(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm animate-in fade-in duration-200",children:[(0,a.jsx)("div",{className:"absolute inset-0",onClick:t}),(0,a.jsxs)(i.Zp,{className:(0,n.cn)("relative w-full max-h-[90vh] flex flex-col overflow-hidden animate-in zoom-in-95 duration-200",c,l),"data-report-control":"allow",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[r&&(0,a.jsx)("h2",{className:"text-2xl font-bold text-white",children:r}),(0,a.jsx)("button",{onClick:t,className:"p-1 rounded-full hover:bg-white/10 transition-colors text-gray-400 hover:text-white",children:(0,a.jsx)(o.A,{size:24})})]}),(0,a.jsx)("div",{className:"p-6 overflow-y-auto custom-scrollbar",children:s})]})]}):null}},81477:(e,t,r)=>{r.d(t,{BT:()=>c,Wu:()=>d,ZB:()=>l,Zp:()=>i,aR:()=>s});var a=r(95155),o=r(12115),n=r(40980);let i=o.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,n.cn)("glass-panel rounded-xl text-card-foreground",e),...t}));i.displayName="Card";let s=o.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",e),...t}));s.displayName="CardHeader";let l=o.forwardRef(({className:e,...t},r)=>(0,a.jsx)("h3",{ref:r,className:(0,n.cn)("text-lg font-semibold leading-none tracking-tight text-white",e),...t}));l.displayName="CardTitle";let c=o.forwardRef(({className:e,...t},r)=>(0,a.jsx)("p",{ref:r,className:(0,n.cn)("text-sm text-zinc-400",e),...t}));c.displayName="CardDescription";let d=o.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,n.cn)("p-6 pt-0",e),...t}));d.displayName="CardContent",o.forwardRef(({className:e,...t},r)=>(0,a.jsx)("div",{ref:r,className:(0,n.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"},97085:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(95155);r(12115);var o=r(37206),n=r(81477),i=r(37717);let s=(0,o.default)(()=>Promise.all([r.e(7776),r.e(4822)]).then(r.bind(r,44822)),{loadableGenerated:{webpack:()=>[null]},ssr:!1});function l({type:e,series:t,options:r,height:o=350,title:l,description:c,className:d,loading:f}){let h=(0,i.A)(),u={chart:{background:"transparent",foreColor:h.text,toolbar:{show:!1}},theme:{mode:"dark",palette:"palette1"},dataLabels:{enabled:!1,style:{colors:[h.text]}},grid:{borderColor:h.grid,strokeDashArray:4},xaxis:{labels:{style:{colors:h.textMuted}},axisBorder:{color:h.border},axisTicks:{color:h.border}},yaxis:{labels:{style:{colors:h.textMuted}}},tooltip:{theme:"dark",style:{fontSize:"12px"},x:{show:!0}},legend:{labels:{colors:h.textMuted}}},m={...u,...r,chart:{...u.chart,...r.chart}};return(0,a.jsxs)(n.Zp,{className:`p-4 ${d}`,children:[(l||c)&&(0,a.jsxs)("div",{className:"mb-4",children:[l&&(0,a.jsx)("h3",{className:"text-lg font-bold text-text-primary mb-1",children:l}),c&&(0,a.jsx)("p",{className:"text-sm text-text-secondary",children:c})]}),f?(0,a.jsx)("div",{className:"flex items-center justify-center",style:{height:o},children:(0,a.jsx)("div",{className:"loader"})}):(0,a.jsx)(s,{options:m,series:t,type:e,height:o,width:"100%"})]})}}}]);