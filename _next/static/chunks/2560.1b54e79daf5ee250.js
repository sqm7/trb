"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2560],{62560:(e,t,a)=>{a.r(t),a.d(t,{default:()=>v});var r=a(95155),s=a(12115),l=a(59481),n=a(15378),o=a(47684),i=a(86765),c=a(68055),d=a(69722),p=a.n(d);a(90737);var h=a(83097),u=a.n(h),x=a(61878),f=a(6296),m=a(56572),g=a(1610),b=a(21975),y=a(56634);let j=p().icon({iconUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41]});p().Marker.prototype.options.icon=j;let w={cartoDark:{name:"暗色風格 (CartoDB)",url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/attributions">CARTO</a>'},osmDefault:{name:"標準地圖 (OSM)",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'},googleHybrid:{name:"衛星影像 (Google)",url:"https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}",attribution:"&copy; Google"}};function N({onMoveEnd:e}){return(0,l.Po)({moveend:()=>e()}),null}function v(){let[e,t]=(0,s.useState)("cartoDark"),[a,l]=(0,s.useState)(""),[d,p]=(0,s.useState)(!1),[h,y]=(0,s.useState)([]),[j,v]=(0,s.useState)(!1),[z,S]=(0,s.useState)(!1),[C,O]=(0,s.useState)(null),A=(0,s.useRef)(null),$=async()=>{if(!A.current||!j)return;let e=A.current;if(15>e.getZoom())return;S(!0);let t=e.getBounds(),a=`${t.getSouth()},${t.getWest()},${t.getNorth()},${t.getEast()}`,r=`[out:json][timeout:25];(way["building"](${a});relation["building"](${a}););out body;>;out skel qt;`;try{let e=await fetch(`https://overpass-api.de/api/interpreter?data=${encodeURIComponent(r)}`),t=await e.json(),a=u()(t);O(a)}catch(e){console.error("Failed to load buildings",e)}finally{S(!1)}},D=async()=>{if(a){p(!0);try{let e=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(a)}&limit=1`),t=await e.json();if(t&&t.length>0){let{lat:e,lon:a,display_name:r}=t[0],s={lat:parseFloat(e),lng:parseFloat(a)};y([{...s,name:r}]),A.current?.flyTo([s.lat,s.lng],17)}}catch(e){console.error("Search failed",e)}finally{p(!1)}}};return(0,r.jsxs)("div",{className:"relative w-full h-full rounded-xl overflow-hidden border border-white/10 shadow-2xl",children:[(0,r.jsxs)("div",{className:"absolute top-4 left-4 z-[500] w-80 flex flex-col gap-4",children:[(0,r.jsxs)("div",{className:"bg-zinc-900/90 backdrop-blur-md p-4 rounded-xl border border-white/10 shadow-lg",children:[(0,r.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,r.jsxs)("div",{className:"relative flex-1",children:[(0,r.jsx)(x.A,{className:"absolute left-3 top-2.5 h-4 w-4 text-zinc-400"}),(0,r.jsx)("input",{type:"text",value:a,onChange:e=>l(e.target.value),onKeyDown:e=>"Enter"===e.key&&D(),placeholder:"輸入地址或地標...",className:"w-full bg-zinc-800/50 border border-zinc-700 rounded-lg pl-9 pr-3 py-2 text-sm text-white focus:ring-1 focus:ring-cyan-500 outline-none"})]}),(0,r.jsx)("button",{onClick:D,disabled:d,className:"bg-cyan-600 hover:bg-cyan-500 text-white px-3 py-2 rounded-lg transition-colors disabled:opacity-50",children:d?(0,r.jsx)(f.A,{className:"animate-spin h-4 w-4"}):"Go"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("label",{className:"text-xs font-bold text-zinc-500 uppercase flex items-center gap-2",children:[(0,r.jsx)(m.A,{className:"h-3 w-3"})," 地圖風格"]}),(0,r.jsx)("div",{className:"grid grid-cols-3 gap-2",children:Object.entries(w).map(([a,s])=>(0,r.jsx)("button",{onClick:()=>t(a),className:`text-xs p-2 rounded-lg border transition-all ${e===a?"bg-cyan-500/20 border-cyan-500 text-cyan-400":"bg-zinc-800/50 border-transparent text-zinc-400 hover:bg-zinc-800"}`,children:s.name.split(" ")[0]},a))})]})]}),(0,r.jsxs)("div",{className:"bg-zinc-900/90 backdrop-blur-md p-4 rounded-xl border border-white/10 shadow-lg space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-zinc-200",children:[(0,r.jsx)(g.A,{className:"h-4 w-4 text-orange-400"}),(0,r.jsx)("span",{children:"3D 建物模型"})]}),(0,r.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:j,onChange:e=>{v(e.target.checked),e.target.checked?$():O(null)},className:"sr-only peer"}),(0,r.jsx)("div",{className:"w-9 h-5 bg-zinc-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-cyan-600"})]})]}),z&&(0,r.jsxs)("div",{className:"text-xs text-orange-400 flex items-center gap-2 animate-pulse",children:[(0,r.jsx)(f.A,{className:"h-3 w-3 animate-spin"}),"載入周邊建物資訊..."]}),(0,r.jsxs)("div",{className:"pt-4 border-t border-white/10",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm text-zinc-400 mb-2",children:[(0,r.jsx)(b.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:"手動上傳 GeoJSON"})]}),(0,r.jsx)("input",{type:"file",accept:".geojson,.json",onChange:e=>{let t=e.target.files?.[0];if(t){let e=new FileReader;e.onload=e=>{try{O(JSON.parse(e.target?.result))}catch(e){alert("Invalid GeoJSON")}},e.readAsText(t)}},className:"block w-full text-xs text-zinc-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-zinc-800 file:text-cyan-400 hover:file:bg-zinc-700"})]})]})]}),(0,r.jsxs)(n.W,{center:[25.0478,121.5318],zoom:13,style:{height:"100%",width:"100%"},ref:A,children:[(0,r.jsx)(o.e,{url:w[e].url,attribution:w[e].attribution}),(0,r.jsx)(N,{onMoveEnd:()=>j&&$()}),h.map((e,t)=>(0,r.jsx)(i.p,{position:[e.lat,e.lng],children:(0,r.jsx)(c.z,{children:e.name})},t)),C&&(0,r.jsx)(k,{data:C})]})]})}function k({data:e}){return(0,r.jsx)(y.k,{data:e,style:{color:"#f97316",weight:1,opacity:.7,fillColor:"#fdba74",fillOpacity:.2}},JSON.stringify(e).slice(0,100))}}}]);