"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5679],{39734:(e,r,t)=>{t.d(r,{g:()=>l});var a=t(12115),i=t(27529),n=t(88743),c=t(55873),o=t(98883);function s(e,r){let t=(e.length-1)*r,a=Math.floor(t);return void 0!==e[a+1]?parseFloat((e[a]+(t-a)*(e[a+1]-e[a])).toFixed(2)):parseFloat(e[a].toFixed(2))}function l(){let e=(0,n.P)(),[r,t]=(0,a.useState)(!1),[l,m]=(0,a.useState)(null),u=(0,a.useCallback)(async()=>{t(!0),m(null),e.setAnalysisData(null);try{let l=e.counties.map(e=>c.WG[e]||e);if(0===l.length){m("請至少選擇一個縣市"),t(!1);return}let{dateRange:u,startDate:p,endDate:f}=e;if("custom"!==u&&(!p||!f)){let e=(0,o.P)(u);e.startDate&&e.endDate&&(p=e.startDate,f=e.endDate)}let P={districts:e.districts,transactionType:e.transactionType,type:e.transactionType,projectNames:e.projectNames,buildingType:e.buildingType,excludeCommercial:e.excludeCommercial,floorPremium:e.floorPremium,dateRange:u,dateStart:p,dateEnd:f};console.log("[useAnalysisData] Analyzing with counties:",l);let d=l.map(e=>{let r={...P,countyCode:e,counties:[e]};return i.FH.analyzeProjectRanking(r).catch(r=>(console.error(`Failed to fetch data for ${e}:`,r),null))}),y=await Promise.all(d),h=null,g=0;for(let e of y)if(e&&e.projectRanking&&e.coreMetrics){var r,a,n;console.log("Merging result for county:",e.projectRanking?.[0]?.county),r=h,h=e?r?(e.transactionDetails&&Array.isArray(e.transactionDetails)&&(r.transactionDetails||(r.transactionDetails=[]),r.transactionDetails=[...r.transactionDetails,...e.transactionDetails]),r.coreMetrics=function(e,r){if(!r)return e;if(!e)return r;let t=(e.totalSaleAmount||0)+(r.totalSaleAmount||0),a=(e.totalHouseArea||0)+(r.totalHouseArea||0),i=(e.transactionCount||0)+(r.transactionCount||0);return{totalSaleAmount:t,totalHouseArea:a,overallAveragePrice:a>0?t/a:0,transactionCount:i,medianPrice:0,q1Price:0,q3Price:0,minPrice:Math.min(e.minPrice||1/0,r.minPrice||1/0),maxPrice:Math.max(e.maxPrice||0,r.maxPrice||0)}}(r.coreMetrics,e.coreMetrics),e.projectRanking&&Array.isArray(e.projectRanking)&&(r.projectRanking=[...r.projectRanking,...e.projectRanking]),r.priceBandAnalysis=function(e,r){if(!r)return e;let t=Array.isArray(e)?e:e?.details||[],a=Array.isArray(r)?r:r?.details||[],i=e?.locationCrossTable||{},n=r?.locationCrossTable||{},c=e?.allDistricts||[],o=r?.allDistricts||[],s=e?.allRoomTypes||[],l=r?.allRoomTypes||[],m=new Map,u=e=>{let r=null!==e.bathrooms&&void 0!==e.bathrooms?String(e.bathrooms):"null",t=(e.roomType||"").replace(/\s+/g,""),a=`${t}-${r}`,i=Number(e.count)||0,n=Number(e.avgPrice)||0,c=Number(e.minPrice)||0,o=Number(e.maxPrice)||0;if(m.has(a)){let r=m.get(a),t=Number(r.count)||0,s=Number(r.avgPrice)||0,l=n*i,u=t+i,p=u>0?(s*t+l)/u:0;if(r.count=u,r.avgPrice=parseFloat(p.toFixed(2)),r.minPrice=Math.min(r.minPrice,c),r.maxPrice=Math.max(r.maxPrice,o),e.projectNames){let t=new Set([...r.projectNames,...e.projectNames]);r.projectNames=Array.from(t)}e.byDistrict&&Object.entries(e.byDistrict).forEach(([e,t])=>{r.byDistrict[e]=(r.byDistrict[e]||0)+t})}else m.set(a,{...e,roomType:t,count:i,avgPrice:n,minPrice:c,maxPrice:o,projectNames:e.projectNames?[...e.projectNames]:[],byDistrict:e.byDistrict?{...e.byDistrict}:{}})};t.forEach(u),a.forEach(u);let p={...i};Object.entries(n).forEach(([e,r])=>{p[e]?Object.entries(r).forEach(([r,t])=>{p[e][r]=(p[e][r]||0)+t}):p[e]={...r}});let f=Array.from(new Set([...c,...o])).sort(),P=Array.from(new Set([...s,...l])).sort();return{details:Array.from(m.values()),locationCrossTable:p,allDistricts:f,allRoomTypes:P}}(r.priceBandAnalysis,e.priceBandAnalysis),r.unitPriceAnalysis=function(e,r){if(!r)return e;let t=(e,r)=>{if(!r)return e;if(!e)return r;let t=(e.count||0)+(r.count||0);if(0===t)return e;let a={arithmetic:0,weighted:0},i=(e,r)=>"number"==typeof e.avgPrice?e.weightedAvgPrice||e.avgPrice:e.avgPrice?.[r]||0;["arithmetic","weighted"].forEach(n=>{let c=i(e,n),o=i(r,n);a[n]=(c*(e.count||0)+o*(r.count||0))/t});let n=Math.min(e.minPrice,r.minPrice),c=Math.max(e.maxPrice,r.maxPrice),o=e.minPrice<r.minPrice?e.minPriceProject:r.minPriceProject;return{count:t,avgPrice:a,minPrice:n,maxPrice:c,minPriceProject:o,maxPriceProject:e.maxPrice>r.maxPrice?e.maxPriceProject:r.maxPriceProject,medianPrice:0,q1Price:0,q3Price:0}},a=t(e.residentialStats,r.residentialStats),i=t(e.officeStats,r.officeStats),n=t(e.storeStats,r.storeStats),c=[...e.typeComparison||[]];return r.typeComparison&&(c=[...c,...r.typeComparison]),{residentialStats:a,officeStats:i,storeStats:n,typeComparison:c}}(r.unitPriceAnalysis,e.unitPriceAnalysis),r.transactionDetails&&r.transactionDetails.length>0&&function(e,r){if(!e||!r||0===r.length)return;let t=[],a={price:0,area:0,count:0},i=[],n={price:0,area:0,count:0},c=[],o={price:0,area:0,count:0},l=()=>({minPrice:1/0,maxPrice:-1/0,minRecord:null,maxRecord:null}),m=l(),u=l(),p=l();r.forEach(e=>{let r=e["建物型態"],s=e["主要用途"],l=e["房屋單價(萬)"],f=e["房屋總價(萬)"]||0,P=e["建物移轉總面積"]||0;if("number"!=typeof l||l<=0)return;let d=t,y=a,h=m;r?.includes("店")||"商業用"===s||e["備註"]?.includes("店")?(d=c,y=o,h=p):(r?.includes("辦公")||r?.includes("廠辦")||r?.includes("事務所")||s?.includes("辦公"))&&(d=i,y=n,h=u),d.push(l),y.price+=f,y.area+=P,y.count+=1,l>h.maxPrice&&(h.maxPrice=l,h.maxRecord=e),l<h.minPrice&&(h.minPrice=l,h.minRecord=e)});let f=(e,r,t,a)=>{e&&(function(e,r){if(!r||0===r.length){e.medianPrice=0,e.q1Price=0,e.q3Price=0;return}r.sort((e,r)=>e-r),e.medianPrice=s(r,.5),e.q1Price=s(r,.25),e.q3Price=s(r,.75)}(e,r),e.count=t.count,e.avgPrice=t.count>0?r.reduce((e,r)=>e+r,0)/t.count:0,e.weightedAvgPrice=t.area>0?t.price/t.area:0,a.maxRecord&&(e.maxPrice=a.maxPrice,e.maxPriceProject=a.maxRecord["建案名稱"],e.maxPriceUnit=a.maxRecord["戶型"]||a.maxRecord["戶別"],e.maxPriceFloor=a.maxRecord["樓層"]),a.minRecord&&(e.minPrice=a.minPrice,e.minPriceProject=a.minRecord["建案名稱"],e.minPriceUnit=a.minRecord["戶型"]||a.minRecord["戶別"],e.minPriceFloor=a.minRecord["樓層"]))};e.residentialStats&&f(e.residentialStats,t,a,m),e.officeStats&&f(e.officeStats,i,n,u),e.storeStats&&f(e.storeStats,c,o,p);let P=new Map;r.forEach(e=>{let r=e["建案名稱"];if(!r)return;P.has(r)||P.set(r,{resSum:{price:0,area:0,count:0},shopSum:{price:0,area:0,count:0},officeSum:{price:0,area:0,count:0},county:e["縣市"],district:e["行政區"]});let t=P.get(r),a=e["建物型態"],i=e["主要用途"],n=e["房屋單價(萬)"],c=e["房屋總價(萬)"]||0,o=e["建物移轉總面積"]||0;"number"!=typeof n||n<=0||(a?.includes("店")||"商業用"===i||e["備註"]?.includes("店")?(t.shopSum.price+=c,t.shopSum.area+=o,t.shopSum.count+=1):a?.includes("辦公")||a?.includes("廠辦")||a?.includes("事務所")||i?.includes("辦公")?(t.officeSum.price+=c,t.officeSum.area+=o,t.officeSum.count+=1):(t.resSum.price+=c,t.resSum.area+=o,t.resSum.count+=1))});let d=[];P.forEach((e,r)=>{let t=e.resSum.area>0?e.resSum.price/e.resSum.area:0,a=e.shopSum.area>0?e.shopSum.price/e.shopSum.area:0,i=e.officeSum.area>0?e.officeSum.price/e.officeSum.area:0;t>0&&(a>0||i>0)&&d.push({projectName:r,county:e.county,district:e.district,residentialAvg:t,shopAvg:a,officeAvg:i,shopMultiple:t>0?a/t:0,officeMultiple:t>0?i/t:0})}),d.sort((e,r)=>e.projectName.localeCompare(r.projectName))}(r.unitPriceAnalysis,r.transactionDetails),r.parkingAnalysis=function(e,r){if(!r)return e;let t=e.parkingRatio,a=r.parkingRatio,i=null;if(t&&a){let e=t.withParking.count,r=t.withoutParking.count,n=a.withParking.count,c=a.withoutParking.count,o=e+n,s=r+c,l=o+s;i={withParking:{count:o,percentage:l>0?o/l*100:0},withoutParking:{count:s,percentage:l>0?s/l*100:0}}}else i=t||a;let n=new Map,c=e=>{if(n.has(e.type)){let r=n.get(e.type),t=r.count+e.count,a=r.transactionCount+e.transactionCount,i=r.avgPrice,c=e.avgPrice,o=a>0?(i*r.transactionCount+c*e.transactionCount)/a:0;r.count=t,r.transactionCount=a,r.avgPrice=o}else n.set(e.type,{...e})};(e.avgPriceByType||[]).forEach(c),(r.avgPriceByType||[]).forEach(c);let o=Array.from(n.values()),s=new Map,l=e=>{if(s.has(e.floor)){let r=s.get(e.floor),t=r.count+e.count;e.rawRecords&&(r.rawRecords=[...r.rawRecords||[],...e.rawRecords]);let a=t>0?(r.avgPrice*r.count+e.avgPrice*e.count)/t:0;r.count=t,r.avgPrice=a,r.minPrice=Math.min(r.minPrice,e.minPrice),r.maxPrice=Math.max(r.maxPrice,e.maxPrice),e.maxPrice>r.maxPrice&&(r.maxPriceProject=e.maxPriceProject,r.maxPriceUnit=e.maxPriceUnit,r.maxPriceFloor=e.maxPriceFloor),e.minPrice<r.minPrice&&(r.minPriceProject=e.minPriceProject,r.minPriceUnit=e.minPriceUnit,r.minPriceFloor=e.minPriceFloor)}else s.set(e.floor,{...e,rawRecords:e.rawRecords?[...e.rawRecords]:[]})};return(e.rampPlanePriceByFloor||[]).forEach(l),(r.rampPlanePriceByFloor||[]).forEach(l),{parkingRatio:i,avgPriceByType:o,rampPlanePriceByFloor:Array.from(s.values())}}(r.parkingAnalysis,e.parkingAnalysis),r.salesVelocityAnalysis=function(e,r){if(!r)return e;let t=e.overall||{},a=r.overall||{},i=t.transactionCount||0,n=a.transactionCount||0,c=i+n,o={avgDaysToSell:0,medianDaysToSell:0,fastestSale:0,transactionCount:c};if(c>0){o.avgDaysToSell=((t.avgDaysToSell||0)*i+(a.avgDaysToSell||0)*n)/c;let e=void 0!==t.fastestSale?t.fastestSale:1/0;o.fastestSale=Math.min(e,void 0!==a.fastestSale?a.fastestSale:1/0),o.fastestSale===1/0&&(o.fastestSale=0),o.medianDaysToSell=((t.medianDaysToSell||0)*i+(a.medianDaysToSell||0)*n)/c}let s=new Map,l=e=>{if(!e)return;let r=e.roomType;if(s.has(r)){let t=s.get(r),a=t.count+e.count,i=t.avgDays||0,n=e.avgDays||0;t.avgDays=a>0?(i*t.count+n*e.count)/a:0,t.count=a}else s.set(r,{...e})};(e.byRoomType||[]).forEach(l),(r.byRoomType||[]).forEach(l);let m=Array.from(s.values()),u=Array.from(new Set([...e.allRoomTypes||[],...r.allRoomTypes||[]])),p={};return["monthly","quarterly","yearly","weekly"].forEach(t=>{let a=e[t]||{},i=r[t]||{},n={};new Set([...Object.keys(a),...Object.keys(i)]).forEach(e=>{let r=a[e]||{},t=i[e]||{},c=new Set([...Object.keys(r),...Object.keys(t)]),o={};c.forEach(e=>{let a=r[e],i=t[e];if(a&&i){let r=a.count+i.count,t=a.priceSum+i.priceSum,n=a.areaSum+i.areaSum;o[e]={count:r,priceSum:t,areaSum:n,avgPrice:n>0?t/n:0}}else a?o[e]={...a}:i&&(o[e]={...i})}),n[e]=o}),p[t]=n}),{overall:o,byRoomType:m,allRoomTypes:u,...p}}(r.salesVelocityAnalysis,e.salesVelocityAnalysis),a=r.priceGridAnalysis,r.priceGridAnalysis=(n=e.priceGridAnalysis)?{projectNames:[...a.projectNames||[],...n.projectNames||[]],byProject:{...a.byProject||{},...n.byProject||{}}}:a,r.areaDistributionAnalysis=function(e,r){if(!r)return e;if(!e)return r;let t={...e};return Object.keys(r).forEach(e=>{t[e]?t[e]=[...t[e],...r[e]]:t[e]=[...r[e]]}),t}(r.areaDistributionAnalysis,e.areaDistributionAnalysis),r):JSON.parse(JSON.stringify(e)):r,g++}if(console.log("Aggregation complete. Total Transaction Details:",h?.transactionDetails?.length),0===g){if(e.projectNames.length>0)throw Error("這段時間 這個建案查詢不到資料");throw Error("無法取得任何縣市的分析數據")}if(g<l.length){let e=l.length-g;m(`注意：有 ${e} 個縣市的資料載入失敗，分析結果可能不完整。`)}e.setAnalysisData(h)}catch(e){console.error("Analysis failed:",e),m(e.message||"無法取得分析數據，請稍後再試。")}finally{t(!1)}},[e]);return{loading:r,error:l,analysisData:e.analysisData,handleAnalyze:u,setError:m,setLoading:t,setAnalysisData:e.setAnalysisData}}},95542:(e,r,t)=>{t.d(r,{e:()=>u});var a=t(95155);t(12115);var i=t(9425),n=t(68500),c=t(92564),o=t(97810),s=t(99815),l=t(92289);function m(){return(0,a.jsxs)("footer",{className:"text-center py-10 mt-12 border-t border-white/5 bg-black/20 text-zinc-500 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center gap-6 flex-wrap px-4",children:[(0,a.jsxs)("a",{href:"https://line.me/R/ti/p/@425ohbmf",target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-2 hover:text-[#06C755] transition-colors",title:"加入 LINE 官方帳號",children:[(0,a.jsx)("div",{className:"p-2 rounded-full bg-zinc-900 group-hover:bg-[#06C755]/10 transition-colors",children:(0,a.jsx)(c.A,{className:"w-4 h-4"})}),(0,a.jsx)("span",{children:"官方帳號"})]}),(0,a.jsxs)("a",{href:"https://medium.com/@sqmtalk7",target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-2 hover:text-white transition-colors",title:"閱讀開發者日誌",children:[(0,a.jsx)("div",{className:"p-2 rounded-full bg-zinc-900 group-hover:bg-white/10 transition-colors",children:(0,a.jsx)(o.A,{className:"w-4 h-4"})}),(0,a.jsx)("span",{children:"開發者日誌"})]}),(0,a.jsxs)("a",{href:"https://www.threads.net/@sqm.talk",target:"_blank",rel:"noopener noreferrer",className:"group flex items-center gap-2 hover:text-white transition-colors",title:"追蹤 Threads",children:[(0,a.jsx)("div",{className:"p-2 rounded-full bg-zinc-900 group-hover:bg-white/10 transition-colors",children:(0,a.jsx)(s.A,{className:"w-4 h-4"})}),(0,a.jsx)("span",{children:"Threads"})]}),(0,a.jsxs)("a",{href:"mailto:sqmtalk7@gmail.com",className:"group flex items-center gap-2 hover:text-cyan-400 transition-colors",title:"聯絡我們",children:[(0,a.jsx)("div",{className:"p-2 rounded-full bg-zinc-900 group-hover:bg-cyan-500/10 transition-colors",children:(0,a.jsx)(l.A,{className:"w-4 h-4"})}),(0,a.jsx)("span",{children:"Email"})]})]}),(0,a.jsxs)("div",{className:"mt-8 space-y-2 text-xs text-zinc-600",children:[(0,a.jsx)("p",{children:"資料來源：內政部實價登錄"}),(0,a.jsx)("p",{children:"版權所有 \xa9 2025 平米內參. 保留一切權利."})]})]})}function u({children:e}){return(0,a.jsxs)("div",{className:"min-h-screen bg-zinc-950 text-zinc-100 flex",children:[(0,a.jsx)(i.Sidebar,{}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col lg:pl-20 min-w-0 transition-all duration-300",children:[(0,a.jsx)(n.Header,{}),(0,a.jsxs)("main",{className:"flex-1 p-4 md:p-6 lg:p-8",children:[(0,a.jsx)("div",{className:"container-custom py-6 space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500 min-h-[calc(100vh-12rem)]",children:e}),(0,a.jsx)(m,{})]})]})]})}}}]);