(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6907],{8451:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var s=r(95155),a=r(12115),i=r(73321),n=r(16385),l=r(27529),d=r(52530),c=r(53961),o=r(94514),m=r(33210),x=r(68041),u=r(38346),h=r(85993),f=r(40980),p=r(51806);let b={地圖模式:"map_mode",平面圖測量:"floor_plan",報表編輯器:"report_builder",總覽儀表板:"dashboard_metrics",會員方案:"manage_plans","系統公告 (查看)":"system_announcement",系統設定:"system_settings"},_=[{category:"核心功能",items:[{name:"地圖模式",subtext:"側邊欄 > 地圖模式"},{name:"平面圖測量",subtext:"側邊欄 > 平面圖測量（扣次以成功上傳為準）"},{name:"總覽儀表板",subtext:"側邊欄 > 總覽儀表板（按下分析報表扣次）"},{name:"報表編輯器",subtext:"側邊欄 > 報表編輯器（扣次以匯出成功為準）"}]},{category:"系統設定",items:[{name:"會員方案",subtext:"側邊欄 > 會員方案"},{name:"系統公告 (查看)",subtext:"側邊欄 > 系統公告"},{name:"系統設定",subtext:"側邊欄 > 系統設定"}]}],v=[{name:"總覽儀表板"},{name:"平面圖測量"},{name:"報表編輯器"}];function g(){let e=(0,i.useRouter)(),[t,r]=(0,a.useState)([]),[g,j]=(0,a.useState)(null),[y,w]=(0,a.useState)(null),[N,z]=(0,a.useState)("none"),[S,k]=(0,a.useState)(null),[O,D]=(0,a.useState)(null),[T,E]=(0,a.useState)(!1),[A,R]=(0,a.useState)(""),[L,F]=(0,a.useState)(null),[C,I]=(0,a.useState)(null),[P,$]=(0,a.useState)(!1),[J,U]=(0,a.useState)(!1),{role:B,isLoading:V}=(0,u.h)(),{fetchFlags:q,flags:G}=(0,h.T)(),H=!V&&"user"===B,M=!V&&("pro"===B||"pro_max"===B),Y=M||!V&&("admin"===B||"super_admin"===B);(0,a.useEffect)(()=>{(async()=>{try{let{data:e}=await n.N.from("pricing_tiers").select("*");e&&r(e)}catch(e){console.error("Error fetching pricing:",e)}})()},[]),(0,a.useEffect)(()=>{q()},[q]);let Z=async()=>{try{let{data:{user:e}}=await n.N.auth.getUser();if(!e){j(null),w(null),z("none");return}let t=await l.FH.getReferralDashboard();j(t?.active_count??0),w(t?.bound_code?.code??null),z(t?.bound_status??"none")}catch(e){console.error("Error fetching referral stats:",e)}};(0,a.useEffect)(()=>{Z()},[]),(0,a.useEffect)(()=>{(async()=>{try{let{data:e,error:t}=await n.N.from("referral_codes").select("code, feature_limits, daily_reset_enabled, monthly_reset_enabled").eq("code_type","seed").eq("is_default_l1",!0).maybeSingle();if(t)throw t;e?.code?k({code:e.code,feature_limits:e.feature_limits||{},daily_reset_enabled:e.daily_reset_enabled??!1,monthly_reset_enabled:e.monthly_reset_enabled??!1}):k(null)}catch(e){console.error("Error fetching default seed:",e),k(null)}})()},[]),(0,a.useEffect)(()=>{(async()=>{try{let{data:e,error:t}=await n.N.from("referral_codes").select("code, promo_tier_code").eq("code_type","seed").eq("is_default_l2",!0).maybeSingle();if(t)throw t;e?.code?D({code:e.code,promo_tier_code:e.promo_tier_code??null}):D(null)}catch(e){console.error("Error fetching default promo seed:",e),D(null)}})()},[]);let W=[...t].sort((e,t)=>(e.min_referrals??0)-(t.min_referrals??0)),K=W.length?W.filter(e=>"Free"!==e.tier_code):[{tier_code:"A",label:"PRO 標準方案",price:1499,description:"定錨價",min_referrals:0},{tier_code:"B",label:"PRO 好友方案",price:950,description:"好友價",min_referrals:1},{tier_code:"C",label:"PRO VIP 方案",price:750,description:"尊榮價",min_referrals:2}],Q=K.find(e=>(e.min_referrals??0)===0)||K[0],X=O?.promo_tier_code?K.find(e=>e.tier_code===O.promo_tier_code):null,ee=X?.price??null,et=!!O,er=e=>void 0===e?"未開啟":null===e?"不限次":`可用 ${e} 次`,es=(0,a.useMemo)(()=>[{key:"dashboard_metrics",label:"總儀表板"},{key:"floor_plan",label:"平面圖測量"},{key:"report_builder",label:"報表編輯器"}].map(e=>{let t=G?.[e.key]?.overrides?.user;return t?.access==="time_limited"?{...e,override:t}:null}).filter(Boolean),[G]),ea=es.length>0,ei=e=>{if(!e)return"未設定";let t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleString()},en={none:"text-zinc-500 bg-zinc-800/60 border-zinc-700",active:"text-emerald-300 bg-emerald-500/10 border-emerald-500/30",inactive:"text-red-300 bg-red-500/10 border-red-500/30",expired:"text-orange-300 bg-orange-500/10 border-orange-500/30",not_started:"text-amber-300 bg-amber-500/10 border-amber-500/30",invalid:"text-red-300 bg-red-500/10 border-red-500/30"},el=(e,t)=>{let r=b[e];if(!r)return{allowed:!1};if("super_admin"===t)return{allowed:!0};let s=G?.[r];if(!s)return{allowed:!1};let a=["user","pro","pro_max","admin","super_admin"],i=a.indexOf(t),n=a.indexOf(s.default_min_role||"user"),l=s.overrides?.[t];if(l){if("granted"===l.access)return{allowed:!0,isOverride:!0};if("denied"===l.access)return{allowed:!1,isOverride:!0};if("time_limited"===l.access){let e=Date.now(),t=l.start_time?new Date(l.start_time).getTime():0,r=l.end_time?new Date(l.end_time).getTime():1/0;return{allowed:e>=t&&e<=r,isTimeLimited:!0,endTime:l.end_time,override:l}}}return{allowed:i>=n}},ed=e=>{let t="總覽儀表板"===e?"dashboard":"平面圖測量"===e?"floor_plan":"報表編輯器"===e?"report_builder":null;if(!t)return null;let r=S?.feature_limits?.[t],s=void 0!==r;return{featureKey:t,limitValue:r,hasGrant:s,allows:s&&(null===r||"number"==typeof r&&r>0)}},ec=(e,t)=>{let r=el(e,t).allowed,a=null,i=null,n=!1;if("user"===t){let t=b[e],l=t?G?.[t]?.overrides?.user:void 0,o=ed(e);if(o?.allows&&(r=!0),o?.hasGrant&&!l?.access){let t=null===o.limitValue?"不限次":`可用 ${o.limitValue??0} 次`;i=(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center group relative",children:[(0,s.jsxs)("div",{className:"text-[10px] px-1.5 py-0.5 rounded border whitespace-nowrap flex items-center gap-1 bg-sky-500/10 text-sky-300 border-sky-500/30",children:[(0,s.jsx)(d.A,{className:"w-3 h-3"}),"預設"]}),(0,s.jsxs)("div",{className:"absolute top-full mt-2 hidden group-hover:block bg-black border border-zinc-700 p-2 rounded text-xs text-white z-[200] whitespace-nowrap pointer-events-none shadow-lg",children:[(0,s.jsxs)("div",{children:["種子碼：",S?.code??"未設定"]}),(0,s.jsxs)("div",{children:[e,"：",t]})]})]})}if(l?.access==="time_limited"){let e=Date.now(),t=l.start_time?new Date(l.start_time).getTime():0,r=l.end_time?new Date(l.end_time).getTime():1/0,i=e>=t&&e<=r;n=!0;let d=null===l.usage_limit?"不限次":void 0!==l.usage_limit?`每位 L1 可用 ${l.usage_limit} 次`:"未設定次數",o=null===l.usage_limit?"":l.daily_reset_enabled?"每日回溯":l.monthly_reset_enabled?"每月回溯":"無回溯";a=(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center group relative",children:[(0,s.jsxs)("div",{className:(0,f.cn)("text-[10px] px-1.5 py-0.5 rounded border whitespace-nowrap flex items-center gap-1",i?"bg-amber-500/20 text-amber-400 border-amber-500/30":"bg-zinc-800 text-zinc-500 border-zinc-700"),children:[(0,s.jsx)(c.A,{className:(0,f.cn)("w-3 h-3",i?"fill-amber-400":"")}),i?"限時":"過期"]}),(0,s.jsxs)("div",{className:"absolute top-full mt-2 hidden group-hover:block bg-black border border-zinc-700 p-2 rounded text-xs text-white z-[200] whitespace-nowrap pointer-events-none shadow-lg",children:[(0,s.jsxs)("div",{children:["到期: ",l.end_time?new Date(l.end_time).toLocaleDateString():"未設定"]}),(0,s.jsxs)("div",{children:["次數: ",d]}),o&&(0,s.jsxs)("div",{children:["回溯: ",o]})]})]})}}let l=n?(0,s.jsx)(c.A,{className:(0,f.cn)("h-5 w-5 mx-auto",r?"text-amber-400":"text-zinc-600")}):r?(0,s.jsx)(o.A,{className:"h-5 w-5 mx-auto text-emerald-400"}):(0,s.jsx)(m.A,{className:"h-4 w-4 mx-auto text-zinc-600"});return a?(0,s.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[a,l]}):i?(0,s.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[i,l]}):l},eo=(e,t)=>{let r=((e,t)=>{let r=el(e,t).allowed,s=!1;if("user"===t){let t=ed(e);t?.allows&&(r=!0);let a=b[e],i=a?G?.[a]?.overrides?.user:void 0;if(i?.access==="time_limited"){let e=Date.now(),t=i.start_time?new Date(i.start_time).getTime():0,a=i.end_time?new Date(i.end_time).getTime():1/0;r=e>=t&&e<=a,s=!0}}return{allowed:r,isTimeLimited:s}})(e,t);if("user"===t){let t=ed(e),r=b[e],a=r?G?.[r]?.overrides?.user:void 0;if(a?.access==="time_limited"){let e=Date.now(),t=a.start_time?new Date(a.start_time).getTime():0,r=a.end_time?new Date(a.end_time).getTime():1/0,i=e>=t&&e<=r,n=null===a.usage_limit?"不限次":void 0!==a.usage_limit?`每位 L1 可用 ${a.usage_limit} 次`:"未設定次數",l=null===a.usage_limit?"":a.daily_reset_enabled?"每日回溯":a.monthly_reset_enabled?"每月回溯":"無回溯";return(0,s.jsxs)("div",{className:"inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[11px] group relative cursor-help",children:[(0,s.jsxs)("div",{className:(0,f.cn)("inline-flex items-center gap-1",i?"text-amber-300":"text-zinc-500"),children:[(0,s.jsx)(c.A,{className:(0,f.cn)("h-3.5 w-3.5",i?"text-amber-400":"text-zinc-500")}),"限時"]}),(0,s.jsxs)("div",{className:"absolute top-full mt-2 hidden group-hover:block bg-black border border-zinc-700 p-2 rounded text-xs text-white z-[200] whitespace-nowrap pointer-events-none shadow-lg",children:[(0,s.jsxs)("div",{children:["到期: ",a.end_time?new Date(a.end_time).toLocaleDateString():"未設定"]}),(0,s.jsxs)("div",{children:["次數: ",n]}),l&&(0,s.jsxs)("div",{children:["回溯: ",l]})]})]})}if(t?.hasGrant&&!a?.access){let r=(e=>{if(void 0===e)return"未開啟";let t=S?.daily_reset_enabled?"每日":S?.monthly_reset_enabled?"每月":"";return null===e?t?`${t}不限次`:"不限次":t?`${t}可用 ${e} 次`:`可用 ${e} 次`})(t.limitValue);return(0,s.jsxs)("div",{className:"inline-flex items-center gap-1 rounded-full border border-sky-500/30 bg-sky-500/10 px-2 py-0.5 text-[11px] text-sky-300 group relative cursor-help",children:[(0,s.jsx)(d.A,{className:"h-3.5 w-3.5"}),"預設",(0,s.jsxs)("div",{className:"absolute top-full mt-2 hidden group-hover:block bg-black border border-zinc-700 p-2 rounded text-xs text-white z-[200] whitespace-nowrap pointer-events-none shadow-lg",children:[(0,s.jsxs)("div",{children:["種子碼：",S?.code??"未設定"]}),(0,s.jsxs)("div",{children:[e,"：",r]})]})]})}}return r.isTimeLimited?(0,s.jsxs)("div",{className:(0,f.cn)("inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-[11px]",r.allowed?"border-amber-500/30 bg-amber-500/10 text-amber-300":"border-zinc-700 bg-zinc-800 text-zinc-500"),children:[(0,s.jsx)(c.A,{className:(0,f.cn)("h-3.5 w-3.5",r.allowed?"text-amber-400":"text-zinc-500")}),"限時"]}):r.allowed?(0,s.jsxs)("div",{className:"inline-flex items-center gap-1 rounded-full border border-emerald-500/30 bg-emerald-500/10 px-2 py-0.5 text-[11px] text-emerald-300",children:[(0,s.jsx)(o.A,{className:"h-3.5 w-3.5"}),"可用"]}):(0,s.jsxs)("div",{className:"inline-flex items-center gap-1 rounded-full border border-zinc-700 bg-zinc-800 px-2 py-0.5 text-[11px] text-zinc-500",children:[(0,s.jsx)(m.A,{className:"h-3.5 w-3.5"}),"未開放"]})},em=async()=>{try{let{data:{session:t}}=await n.N.auth.getSession();if(t?.user)return void e.push("/dashboard")}catch(e){console.error("Failed to check session:",e)}e.push("/")},ex=async()=>{try{let{data:{session:t}}=await n.N.auth.getSession();if(!t?.user)return void e.push("/")}catch(t){console.error("Failed to check session:",t),e.push("/");return}F(null),I(null),E(!0)},eu=async()=>{if(!H)return void F("僅一般會員可更換推薦碼");let e=A.trim().toUpperCase();if(!e)return void F("請輸入推薦碼");$(!0),F(null),I(null);try{await l.FH.bindReferralCode(e),R(""),I("推薦碼已更新"),await Z()}catch(e){F(e?.message||"綁定失敗，請稍後再試")}finally{$(!1)}},eh=async()=>{if(!H)return void F("僅一般會員可清除推薦碼");if(!y)return void F("目前沒有已綁定的推薦碼");U(!0),F(null),I(null);try{await l.FH.clearReferralCode(),I("推薦碼已清除"),await Z()}catch(e){F(e?.message||"清除失敗，請稍後再試")}finally{U(!1)}};return(0,s.jsx)(x.e,{children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-violet-600/20 rounded-full blur-[128px] pointer-events-none"}),(0,s.jsx)("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-cyan-600/20 rounded-full blur-[128px] pointer-events-none"}),(0,s.jsxs)("div",{className:"relative z-10",children:[(0,s.jsxs)("div",{className:"text-center max-w-3xl mx-auto mb-16",children:[(0,s.jsx)("h1",{className:"text-4xl md:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white via-zinc-200 to-zinc-400 mb-6",children:"會員方案與權限"}),(0,s.jsx)("p",{className:"text-xl text-zinc-400 leading-relaxed",children:"解鎖完整的房地產市場洞察，做出更精準的投資決策。"})]}),(0,s.jsxs)("div",{className:"max-w-5xl mx-auto mb-24 space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:(0,f.cn)("relative rounded-2xl border p-6 bg-zinc-900/60 flex flex-col h-full",H?"border-emerald-500/40 shadow-[0_0_24px_rgba(16,185,129,0.15)]":"border-zinc-800"),children:[(0,s.jsx)("div",{className:"text-xs text-emerald-300",children:"L1 Basic"}),(0,s.jsx)("div",{className:"mt-2 text-xl font-semibold text-white",children:"一般會員"}),(0,s.jsx)("div",{className:"mt-3 min-h-[72px] flex flex-col justify-center",children:(0,s.jsx)("div",{className:"text-2xl font-bold text-white",children:"免費 / 月"})}),(0,s.jsx)("div",{className:"mt-2 text-sm text-zinc-400",children:"基礎瀏覽與限時/推薦碼體驗"}),(0,s.jsxs)("div",{className:"mt-4 space-y-2 text-sm text-zinc-300 min-h-[140px]",children:[v.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:e.name}),eo(e.name,"user")]},e.name)),et&&(0,s.jsxs)("div",{className:"flex items-center justify-between opacity-0",children:[(0,s.jsx)("span",{children:"官方優惠碼"}),(0,s.jsx)("span",{className:"inline-flex items-center gap-1 rounded-full border border-amber-500/30 bg-amber-500/10 px-2 py-0.5 text-[11px] text-amber-300",children:"促銷"})]})]}),(0,s.jsxs)("div",{className:"mt-auto space-y-3",children:[(0,s.jsx)("div",{className:(0,f.cn)("inline-flex items-center gap-2 text-xs border px-2 py-1 rounded-full",H?"text-emerald-300 border-emerald-500/30 bg-emerald-500/10":"text-transparent border-transparent bg-transparent"),children:"你目前是 L1"}),(0,s.jsx)("button",{onClick:em,className:"w-full rounded-xl border border-emerald-500/40 bg-emerald-500/10 px-4 py-2 text-sm font-semibold text-emerald-200 hover:bg-emerald-500/20 transition-colors",children:"L1｜LINE 登入會員"})]})]}),(0,s.jsxs)("div",{className:(0,f.cn)("relative rounded-2xl border p-6 bg-zinc-900/60 flex flex-col h-full","pro"===B?"border-cyan-400/40 shadow-[0_0_24px_rgba(34,211,238,0.15)]":"border-zinc-800"),children:[(0,s.jsx)("div",{className:"text-xs text-cyan-300",children:"L2 Pro"}),(0,s.jsx)("div",{className:"mt-2 text-xl font-semibold text-white",children:"進階會員"}),(0,s.jsx)("div",{className:"mt-3 min-h-[72px] flex flex-col justify-center",children:null!==ee&&Q?.price?(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsxs)("span",{className:"text-sm text-zinc-500 line-through decoration-red-500 decoration-2",children:["NT$ ",Q.price," / 月"]}),(0,s.jsxs)("span",{className:"text-2xl font-bold text-amber-300",children:["NT$ ",ee," / 月"]})]}):(0,s.jsx)("div",{className:"text-2xl font-bold text-white",children:Q?.price?`NT$ ${Q.price} / 月`:"依推薦階梯 / 月"})}),(0,s.jsx)("div",{className:"mt-2 text-sm text-zinc-400",children:"價格依推薦階梯自動調整"}),(0,s.jsxs)("div",{className:"mt-4 space-y-2 text-sm text-zinc-300 min-h-[140px]",children:[v.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:e.name}),eo(e.name,"pro")]},e.name)),O&&(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:"官方優惠碼"}),(0,s.jsxs)("div",{className:"inline-flex items-center gap-1 rounded-full border border-amber-500/30 bg-amber-500/10 px-2 py-0.5 text-[11px] text-amber-300 group relative cursor-help",children:["促銷",(0,s.jsxs)("div",{className:"absolute top-full mt-2 hidden group-hover:block bg-black border border-zinc-700 p-2 rounded text-xs text-white z-[200] whitespace-nowrap pointer-events-none shadow-lg",children:[(0,s.jsxs)("div",{children:["種子碼：",O.code]}),(0,s.jsxs)("div",{children:["方案：",O.promo_tier_code||"未指定"]}),null!==ee&&(0,s.jsxs)("div",{children:["促銷價：NT$ ",ee," / 月"]})]})]})]})]}),(0,s.jsxs)("div",{className:"mt-auto space-y-3",children:[(0,s.jsx)("div",{className:(0,f.cn)("inline-flex items-center gap-2 text-xs border px-2 py-1 rounded-full","pro"===B?"text-cyan-300 border-cyan-500/30 bg-cyan-500/10":"text-transparent border-transparent bg-transparent"),children:"你目前是 L2"}),(0,s.jsx)("button",{onClick:ex,className:"w-full rounded-xl border border-cyan-500/40 bg-cyan-500/10 px-4 py-2 text-sm font-semibold text-cyan-200 hover:bg-cyan-500/20 transition-colors",children:"L2｜訂閱"})]})]}),(0,s.jsxs)("div",{className:(0,f.cn)("relative rounded-2xl border p-6 bg-zinc-900/60 flex flex-col h-full","pro_max"===B?"border-amber-400/40 shadow-[0_0_24px_rgba(251,191,36,0.15)]":"border-zinc-800"),children:[(0,s.jsx)("div",{className:"text-xs text-amber-300",children:"L3 Pro Max"}),(0,s.jsx)("div",{className:"mt-2 text-xl font-semibold text-white",children:"最高等級"}),(0,s.jsx)("div",{className:"mt-3 min-h-[72px] flex flex-col justify-center",children:(0,s.jsx)("div",{className:"text-2xl font-bold text-white",children:"依方案 / 月"})}),(0,s.jsx)("div",{className:"mt-2 text-sm text-zinc-400",children:"最高權限與進階功能"}),(0,s.jsxs)("div",{className:"mt-4 space-y-2 text-sm text-zinc-300 min-h-[140px]",children:[v.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:e.name}),eo(e.name,"pro_max")]},e.name)),et&&(0,s.jsxs)("div",{className:"flex items-center justify-between opacity-0",children:[(0,s.jsx)("span",{children:"官方優惠碼"}),(0,s.jsx)("span",{className:"inline-flex items-center gap-1 rounded-full border border-amber-500/30 bg-amber-500/10 px-2 py-0.5 text-[11px] text-amber-300",children:"促銷"})]})]}),(0,s.jsxs)("div",{className:"mt-auto space-y-3",children:[(0,s.jsx)("div",{className:(0,f.cn)("inline-flex items-center gap-2 text-xs border px-2 py-1 rounded-full","pro_max"===B?"text-amber-300 border-amber-500/30 bg-amber-500/10":"text-transparent border-transparent bg-transparent"),children:"你目前是 L3"}),(0,s.jsx)("button",{disabled:!0,className:"w-full rounded-xl border border-zinc-700 bg-zinc-800 px-4 py-2 text-sm font-semibold text-zinc-500 cursor-not-allowed",children:"L3｜陸續推出"})]})]})]}),H&&(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"bg-zinc-900/60 border border-zinc-800 rounded-2xl p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-white",children:"L1 權限表內容（預設種子碼）"}),S?.code?(0,s.jsx)("span",{className:"text-[10px] text-sky-300 border border-sky-500/30 bg-sky-500/10 px-2 py-0.5 rounded-full",children:S.code}):(0,s.jsx)("span",{className:"text-[10px] text-zinc-500 border border-zinc-700 px-2 py-0.5 rounded-full",children:"未設定"})]}),(0,s.jsxs)("div",{className:"mt-4 space-y-3 text-sm text-zinc-400",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:"總儀表板"}),(0,s.jsx)("span",{className:"text-zinc-200",children:er(S?.feature_limits?.dashboard)})]}),(0,s.jsx)("div",{className:"text-[10px] text-zinc-500",children:"包含：核心指標與排名、總價帶分析、單價分析、調價熱力圖、政策時光機、銷售速度與房型、車位分析、交易明細列表、分享報表"}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:"平面圖測量"}),(0,s.jsx)("span",{className:"text-zinc-200",children:er(S?.feature_limits?.floor_plan)})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:"報表編輯器"}),(0,s.jsx)("span",{className:"text-zinc-200",children:er(S?.feature_limits?.report_builder)})]})]})]}),(0,s.jsxs)("div",{className:"bg-zinc-900/60 border border-zinc-800 rounded-2xl p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-white",children:"L1 限時開放"}),(0,s.jsx)("span",{className:"text-[10px] text-amber-300 border border-amber-500/30 bg-amber-500/10 px-2 py-0.5 rounded-full",children:ea?"已設定":"未設定"})]}),ea?(0,s.jsx)("div",{className:"mt-4 space-y-4 text-sm text-zinc-400",children:es.map(e=>{var t,r;return(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-zinc-200",children:[(0,s.jsx)("span",{children:e.label}),(0,s.jsx)("span",{children:(t=e.override,t?.usage_limit===null?"不限次":t?.usage_limit===void 0?"未設定":`每位 L1 可用 ${t.usage_limit} 次`)})]}),(0,s.jsxs)("div",{className:"text-[10px] text-zinc-500",children:[ei(e.override.start_time)," ~ ",ei(e.override.end_time)]}),(0,s.jsxs)("div",{className:"text-[10px] text-zinc-500",children:["回溯：",(r=e.override,r?.usage_limit===null?"":r?.daily_reset_enabled?"每日回溯":r?.monthly_reset_enabled?"每月回溯":"無回溯")]})]},e.key)})}):(0,s.jsx)("p",{className:"mt-4 text-sm text-zinc-500",children:"目前沒有設定限時開放"})]})]}),M&&(0,s.jsxs)("div",{className:"bg-zinc-900/60 border border-zinc-800 rounded-2xl p-6 text-zinc-400",children:["目前為 ","pro_max"===B?"Pro Max":"Pro"," 會員，可參考價格方案階梯與權限表。"]})]}),(0,s.jsx)("div",{className:"max-w-5xl mx-auto mb-24",children:(0,s.jsxs)("div",{className:"bg-zinc-900/40 border border-zinc-800 rounded-2xl p-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"inline-flex items-center gap-2 rounded-full border border-cyan-500/30 bg-cyan-500/10 px-3 py-1 text-xs text-cyan-200 mb-3",children:"僅適用 PRO 方案"}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-white",children:"推薦階梯 / 團購規則"}),(0,s.jsx)("p",{className:"text-sm text-zinc-400 mt-2",children:"推薦人數越多，方案越優惠，價格依方案階梯自動調整。"})]}),(0,s.jsxs)("div",{className:"flex flex-col items-end gap-1 text-xs text-zinc-500",children:[(0,s.jsx)("span",{children:"推薦碼訂閱套用「推薦 1 人」門檻"}),null!==g&&(0,s.jsxs)("span",{className:"text-zinc-300",children:["目前已推薦 ",(0,s.jsx)("span",{className:"text-white font-semibold",children:g})," 人"]})]})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:K.map(e=>{let t=e.min_referrals??0;return(0,s.jsxs)("div",{className:"rounded-2xl border border-zinc-800 bg-gradient-to-br from-zinc-950/80 via-zinc-950/40 to-zinc-900/80 p-5 shadow-[0_0_20px_rgba(0,0,0,0.35)]",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"text-xs text-zinc-500",children:["方案代碼 ",e.tier_code]}),(0,s.jsxs)("div",{className:"text-xs text-zinc-400",children:["推薦 ",t," 人"]})]}),(0,s.jsx)("div",{className:"mt-3 text-lg font-semibold text-white",children:e.label}),(0,s.jsxs)("div",{className:"mt-2 text-2xl font-bold text-white",children:["NT$ ",e.price," ",(0,s.jsx)("span",{className:"text-sm text-zinc-400",children:"/ 月"})]}),e.description&&(0,s.jsx)("div",{className:"text-xs text-zinc-500 mt-2",children:e.description})]},e.tier_code)})}),(0,s.jsxs)("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-zinc-400",children:[(0,s.jsxs)("div",{className:"rounded-xl border border-zinc-800 bg-zinc-950/60 p-4",children:[(0,s.jsx)("div",{className:"text-white font-semibold mb-1",children:"1. 生成推薦碼"}),(0,s.jsx)("div",{children:"在「系統設定」建立你的專屬推薦碼，先分享給朋友。"})]}),(0,s.jsxs)("div",{className:"rounded-xl border border-zinc-800 bg-zinc-950/60 p-4",children:[(0,s.jsx)("div",{className:"text-white font-semibold mb-1",children:"2. 朋友先訂閱"}),(0,s.jsx)("div",{children:"朋友使用你的推薦碼訂閱，你的推薦人數會累計。"})]}),(0,s.jsxs)("div",{className:"rounded-xl border border-zinc-800 bg-zinc-950/60 p-4",children:[(0,s.jsx)("div",{className:"text-white font-semibold mb-1",children:"3. 你再購買"}),(0,s.jsx)("div",{children:"依推薦人數門檻自動套用對應方案，價格更優惠。"})]})]})]})}),Y&&(0,s.jsxs)("div",{className:"max-w-5xl mx-auto bg-dark-card rounded-2xl border border-zinc-800 mb-20 shadow-2xl",children:[(0,s.jsxs)("div",{className:"p-6 border-b border-zinc-800 bg-zinc-900/50",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-white",children:"詳細權限比較表"}),(0,s.jsx)("p",{className:"text-sm text-zinc-400 mt-2",children:"依照角色權限表與目前設定顯示。"})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-left border-collapse",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-4 border-b border-zinc-800 bg-zinc-900/30 w-1/3",children:"功能項目"}),(0,s.jsx)("th",{className:"p-4 border-b border-zinc-800 bg-zinc-900/30 text-center w-1/5",children:"L1 Basic"}),(0,s.jsx)("th",{className:"p-4 border-b border-zinc-800 bg-zinc-900/30 text-center w-1/5 text-cyan-400",children:"L2 Pro"}),(0,s.jsx)("th",{className:"p-4 border-b border-zinc-800 bg-zinc-900/30 text-center w-1/5 text-amber-400",children:"L3 Pro Max"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-zinc-800 text-sm text-zinc-300",children:_.map(e=>(0,s.jsxs)(a.Fragment,{children:[(0,s.jsx)("tr",{className:"bg-zinc-900/20",children:(0,s.jsx)("td",{colSpan:4,className:"py-2 px-4 text-xs font-bold text-zinc-500 uppercase",children:e.category})}),e.items.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-zinc-800/30",children:[(0,s.jsxs)("td",{className:"p-4",children:[(0,s.jsx)("div",{className:"text-sm text-zinc-200",children:e.name}),e.subtext&&(0,s.jsx)("div",{className:"text-[11px] text-zinc-500 mt-1",children:e.subtext})]}),(0,s.jsx)("td",{className:"text-center",children:ec(e.name,"user")}),(0,s.jsx)("td",{className:"text-center",children:ec(e.name,"pro")}),(0,s.jsx)("td",{className:"text-center",children:ec(e.name,"pro_max")})]},e.name))]},e.category))})]})})]}),(0,s.jsx)(p.a,{isOpen:T,onClose:()=>E(!1),title:"L2 訂閱與推薦碼",maxWidth:"max-w-2xl",children:(0,s.jsxs)("div",{className:"space-y-6 text-sm text-zinc-300",children:[(0,s.jsxs)("div",{className:"rounded-xl border border-zinc-800 bg-zinc-900/70 p-4 space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-white",children:"L2 促銷標籤"}),O?(0,s.jsx)("span",{className:"inline-flex items-center gap-1 rounded-full border border-amber-500/30 bg-amber-500/10 px-2 py-0.5 text-[11px] text-amber-300",children:"促銷"}):(0,s.jsx)("span",{className:"text-[11px] text-zinc-500 border border-zinc-700 px-2 py-0.5 rounded-full",children:"未設定"})]}),O?(0,s.jsxs)("div",{className:"space-y-1 text-xs text-zinc-400",children:[(0,s.jsxs)("div",{children:["種子碼：",(0,s.jsx)("span",{className:"text-zinc-200",children:O.code})]}),(0,s.jsxs)("div",{children:["方案：",(0,s.jsx)("span",{className:"text-zinc-200",children:O.promo_tier_code||"未指定"})]}),null!==ee&&(0,s.jsxs)("div",{children:["促銷價：",(0,s.jsxs)("span",{className:"text-amber-300 font-semibold",children:["NT$ ",ee," / 月"]})]})]}):(0,s.jsx)("p",{className:"text-xs text-zinc-500",children:"目前沒有官方 L2 促銷方案。"})]}),(0,s.jsxs)("div",{className:"rounded-xl border border-zinc-800 bg-zinc-900/70 p-4 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-sm font-semibold text-white",children:"推薦碼設定"}),(0,s.jsx)("span",{className:(0,f.cn)("text-[10px] px-2 py-0.5 rounded-full border",en[N]||en.none),children:{none:"未綁定",active:"有效",inactive:"已停用",expired:"已過期",not_started:"未生效",invalid:"已失效"}[N]||"未綁定"})]}),y?(0,s.jsxs)("div",{className:"flex items-center justify-between rounded-lg border border-zinc-800 bg-zinc-950/60 px-3 py-2",children:[(0,s.jsx)("span",{className:"text-xs text-zinc-400",children:"目前綁定"}),(0,s.jsx)("span",{className:"font-mono text-sm text-white tracking-wider",children:y})]}):(0,s.jsx)("p",{className:"text-xs text-zinc-500",children:"尚未綁定推薦碼，可輸入或更換。"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{value:A,onChange:e=>R(e.target.value),placeholder:"輸入推薦碼 (例如: EVENT2026)",disabled:!H,className:"flex-1 bg-zinc-900/60 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-white placeholder:text-zinc-500 focus:outline-none focus:ring-2 focus:ring-cyan-500/40 disabled:opacity-60"}),(0,s.jsx)("button",{onClick:eu,disabled:!H||P,className:"px-4 py-2 rounded-lg bg-cyan-600/80 hover:bg-cyan-500 text-white text-sm font-medium disabled:opacity-50",children:P?"更新中...":"綁定/更換"}),(0,s.jsx)("button",{onClick:eh,disabled:!H||J||!y,className:"px-4 py-2 rounded-lg border border-zinc-700 bg-zinc-900/60 text-zinc-200 text-sm font-medium hover:bg-zinc-800 disabled:opacity-40",children:J?"清除中...":"清除"})]}),L&&(0,s.jsx)("p",{className:"text-xs text-red-400",children:L}),C&&(0,s.jsx)("p",{className:"text-xs text-emerald-400",children:C}),!H&&(0,s.jsx)("p",{className:"text-[11px] text-zinc-500",children:"推薦碼更換/清除僅提供一般會員操作。"})]})]})})]})]})})}},27529:(e,t,r)=>{"use strict";r.d(t,{FH:()=>l});var s=r(16385),a=r(55873);async function i(){let{data:{session:e}}=await s.N.auth.getSession();return{"Content-Type":"application/json",apikey:a.m5,Authorization:`Bearer ${e?.access_token||a.m5}`}}async function n(e){let t=await i(),r=await fetch(a.Sn.RANKING_ANALYSIS,{method:"POST",headers:t,body:JSON.stringify({filters:e})});if(!r.ok)throw Error((await r.json().catch(()=>({error:`Analysis request failed: ${r.status}`}))).error||"Analyze data failed");return r.json()}let l={checkAuth:async function(){let{data:{session:e}}=await s.N.auth.getSession();e||console.log("User not logged in, but allowing access.")},getUser:async function(){let{data:{user:e}}=await s.N.auth.getUser();return e},signOut:async function(){let{error:e}=await s.N.auth.signOut();if(e)throw console.error("Sign out failed:",e),e},fetchData:async function(e,t){let r=await i(),s=await fetch(a.Sn.QUERY_DATA,{method:"POST",headers:r,body:JSON.stringify({filters:e,pagination:t})});if(!s.ok)throw Error((await s.json().catch(()=>({error:"Failed to parse server response"}))).error||"Fetch data failed");return s.json()},analyzeData:n,analyzeProjectRanking:n,fetchSubData:async function(e,t,r){if(!e||!t||!r)throw Error(`Insufficient parameters: ${e}, ${t}, ${r}`);let s=await i(),n=await fetch(a.Sn.SUB_DATA,{method:"POST",headers:s,body:JSON.stringify({id:e,type:t,county:r})});if(!n.ok)throw Error((await n.json().catch(()=>({error:"Failed to fetch sub data"}))).error||"Fetch sub data failed");return n.json()},fetchProjectNameSuggestions:async function(e,t,r=[]){let s=await i(),n=t.replace(/\u3127/g,"一"),l=await fetch(a.Sn.PROJECT_NAMES,{method:"POST",headers:s,body:JSON.stringify({countyCode:e,query:n,districts:r,detailed:!0})});if(!l.ok)throw Error(`Server error: ${l.status}`);return l.json()},getAdminUsers:async function(){let e=await i(),t=await fetch(a.Sn.GET_USERS,{method:"POST",headers:e,body:JSON.stringify({})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to fetch users"}))).error||"Fetch users failed");return t.json()},getUserActivity:async function(e,t=200,r=0){let s=await i(),n=await fetch(a.Sn.GET_USER_ACTIVITY,{method:"POST",headers:s,body:JSON.stringify({userId:e,limit:t,offset:r})});if(!n.ok)throw Error((await n.json().catch(()=>({error:"Failed to fetch user activity"}))).error||"Fetch user activity failed");return n.json()},getActivityStats:async function(){let e=await i(),t=await fetch(a.Sn.GET_ACTIVITY_STATS,{method:"POST",headers:e,body:JSON.stringify({})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to fetch activity stats"}))).error||"Fetch activity stats failed");return t.json()},validateReferralCode:async function(e){let t=await i();return(await fetch(a.Sn.VALIDATE_REFERRAL_CODE,{method:"POST",headers:t,body:JSON.stringify({code:e})})).json()},activateSubscription:async function(e){let t=await i(),r=await fetch(a.Sn.ACTIVATE_SUBSCRIPTION,{method:"POST",headers:t,body:JSON.stringify(e)});if(!r.ok)throw Error((await r.json().catch(()=>({error:"Activation failed"}))).error||"Activation failed");return r.json()},bindReferralCode:async function(e){let t=await i(),r=await fetch(a.Sn.BIND_REFERRAL_CODE,{method:"POST",headers:t,body:JSON.stringify({code:e})});if(!r.ok)throw Error((await r.json().catch(()=>({error:"Failed to bind referral code"}))).error||"Failed to bind referral code");return r.json()},clearReferralCode:async function(){let e=await i(),t=await fetch(a.Sn.BIND_REFERRAL_CODE,{method:"POST",headers:e,body:JSON.stringify({action:"clear"})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to clear referral code"}))).error||"Failed to clear referral code");return t.json()},getReferralDashboard:async function(){let e=await i(),t=await fetch(a.Sn.GET_REFERRAL_DASHBOARD,{method:"POST",headers:e,body:JSON.stringify({})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to fetch referral data"}))).error||"Fetch referral dashboard failed");return t.json()},consumeReferralFeature:async function(e,t="consume"){let r=await i(),s=await fetch(a.Sn.CONSUME_REFERRAL_FEATURE,{method:"POST",headers:r,body:JSON.stringify({feature:e,mode:t})});if(!s.ok){let e=await s.json().catch(()=>({error:"Failed to consume feature"}));throw Error(e.error||e.reason||"Failed to consume feature")}return s.json()}}},38346:(e,t,r)=>{"use strict";r.d(t,{h:()=>i});var s=r(12115),a=r(16385);function i(){let[e,t]=(0,s.useState)(null),[r,i]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let e=!0,r=async()=>{try{let{data:{session:r}}=await a.N.auth.getSession();if(!r?.user){e&&(t(null),i(!1));return}let{data:s,error:n}=await a.N.from("profiles").select("role").eq("id",r.user.id).single();e&&(s?t(s.role):t("user"),i(!1))}catch(r){console.error("Error fetching user role:",r),e&&(t("user"),i(!1))}};r();let{data:{subscription:s}}=a.N.auth.onAuthStateChange((e,s)=>{s?r():t(null)});return()=>{e=!1,s.unsubscribe()}},[]),{role:e,isLoading:r}}},51806:(e,t,r)=>{"use strict";r.d(t,{a:()=>l});var s=r(95155);r(12115);var a=r(33210),i=r(40980),n=r(81477);function l({isOpen:e,onClose:t,title:r,children:l,className:d,maxWidth:c="max-w-4xl"}){return e?(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm animate-in fade-in duration-200",children:[(0,s.jsx)("div",{className:"absolute inset-0",onClick:t}),(0,s.jsxs)(n.Zp,{className:(0,i.cn)("relative w-full max-h-[90vh] flex flex-col overflow-hidden animate-in zoom-in-95 duration-200",c,d),"data-report-control":"allow",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border",children:[r&&(0,s.jsx)("h2",{className:"text-2xl font-bold text-white",children:r}),(0,s.jsx)("button",{onClick:t,className:"p-1 rounded-full hover:bg-white/10 transition-colors text-gray-400 hover:text-white",children:(0,s.jsx)(a.A,{size:24})})]}),(0,s.jsx)("div",{className:"p-6 overflow-y-auto custom-scrollbar",children:l})]})]}):null}},78720:(e,t,r)=>{Promise.resolve().then(r.bind(r,8451))},81477:(e,t,r)=>{"use strict";r.d(t,{BT:()=>c,Wu:()=>o,ZB:()=>d,Zp:()=>n,aR:()=>l});var s=r(95155),a=r(12115),i=r(40980);let n=a.forwardRef(({className:e,...t},r)=>(0,s.jsx)("div",{ref:r,className:(0,i.cn)("glass-panel rounded-xl text-card-foreground",e),...t}));n.displayName="Card";let l=a.forwardRef(({className:e,...t},r)=>(0,s.jsx)("div",{ref:r,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",e),...t}));l.displayName="CardHeader";let d=a.forwardRef(({className:e,...t},r)=>(0,s.jsx)("h3",{ref:r,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight text-white",e),...t}));d.displayName="CardTitle";let c=a.forwardRef(({className:e,...t},r)=>(0,s.jsx)("p",{ref:r,className:(0,i.cn)("text-sm text-zinc-400",e),...t}));c.displayName="CardDescription";let o=a.forwardRef(({className:e,...t},r)=>(0,s.jsx)("div",{ref:r,className:(0,i.cn)("p-6 pt-0",e),...t}));o.displayName="CardContent",a.forwardRef(({className:e,...t},r)=>(0,s.jsx)("div",{ref:r,className:(0,i.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter"},85993:(e,t,r)=>{"use strict";r.d(t,{T:()=>n});var s=r(1934),a=r(16385);let i={map_mode:{key:"map_mode",is_active:!0,default_min_role:"user",overrides:{}},floor_plan:{key:"floor_plan",is_active:!0,default_min_role:"user",overrides:{}},report_builder:{key:"report_builder",is_active:!0,default_min_role:"pro",overrides:{}},export_report:{key:"export_report",is_active:!0,default_min_role:"pro",overrides:{}},market_heatmap:{key:"market_heatmap",is_active:!0,default_min_role:"pro",overrides:{user:{access:"time_limited",start_time:new Date().toISOString(),end_time:new Date(Date.now()+2592e6).toISOString(),is_manual_override:!0}}},price_analysis:{key:"price_analysis",is_active:!0,default_min_role:"pro",overrides:{user:{access:"time_limited",start_time:new Date().toISOString(),end_time:new Date(Date.now()+2592e6).toISOString(),is_manual_override:!0}}},total_price_analysis:{key:"total_price_analysis",is_active:!0,default_min_role:"pro",overrides:{user:{access:"time_limited",start_time:new Date().toISOString(),end_time:new Date(Date.now()+2592e6).toISOString(),is_manual_override:!0}}},policy_timeline:{key:"policy_timeline",is_active:!0,default_min_role:"pro",overrides:{user:{access:"time_limited",start_time:new Date().toISOString(),end_time:new Date(Date.now()+2592e6).toISOString(),is_manual_override:!0}}},sales_velocity:{key:"sales_velocity",is_active:!0,default_min_role:"pro",overrides:{user:{access:"time_limited",start_time:new Date().toISOString(),end_time:new Date(Date.now()+2592e6).toISOString(),is_manual_override:!0}}},parking_analysis:{key:"parking_analysis",is_active:!0,default_min_role:"pro",overrides:{user:{access:"time_limited",start_time:new Date().toISOString(),end_time:new Date(Date.now()+2592e6).toISOString(),is_manual_override:!0}}},transaction_list:{key:"transaction_list",is_active:!0,default_min_role:"pro",overrides:{user:{access:"time_limited",start_time:new Date().toISOString(),end_time:new Date(Date.now()+2592e6).toISOString(),is_manual_override:!0}}},share_report:{key:"share_report",is_active:!0,default_min_role:"pro",overrides:{user:{access:"time_limited",start_time:new Date().toISOString(),end_time:new Date(Date.now()+2592e6).toISOString(),is_manual_override:!0}}},system_settings:{key:"system_settings",is_active:!0,default_min_role:"user",overrides:{}},system_announcement:{key:"system_announcement",is_active:!0,default_min_role:"user",overrides:{}},admin_panel:{key:"admin_panel",is_active:!0,default_min_role:"admin",overrides:{}},manage_members:{key:"manage_members",is_active:!0,default_min_role:"admin",overrides:{}},delete_members:{key:"delete_members",is_active:!0,default_min_role:"super_admin",overrides:{}},manage_projects:{key:"manage_projects",is_active:!0,default_min_role:"admin",overrides:{}},post_annoucement:{key:"post_annoucement",is_active:!0,default_min_role:"admin",overrides:{}},upload_tools:{key:"upload_tools",is_active:!0,default_min_role:"admin",overrides:{}},edit_permissions:{key:"edit_permissions",is_active:!0,default_min_role:"super_admin",overrides:{}},manage_plans:{key:"manage_plans",is_active:!0,default_min_role:"admin",overrides:{}},dashboard_metrics:{key:"dashboard_metrics",is_active:!0,default_min_role:"user",overrides:{}}},n=(0,s.v)((e,t)=>({flags:i,isLoading:!0,error:null,fetchFlags:async()=>{e({isLoading:!0,error:null});try{let{data:t,error:r}=await a.N.from("feature_flags").select("*");if(r){console.warn("Failed to fetch feature flags (using defaults):",r.message),e({isLoading:!1});return}if(t&&t.length>0){let r={...i};t.forEach(e=>{r[e.key]&&(r[e.key]={...r[e.key],...e,overrides:e.overrides||{}})}),e({flags:r,isLoading:!1})}else e({isLoading:!1})}catch(t){console.error("Feature flag fetch error:",t),e({isLoading:!1,error:t.message})}},updateFlag:async(r,s)=>{let i=t().flags,n=i[r],l={...n,...s};e({flags:{...i,[r]:l}});try{let{error:e}=await a.N.from("feature_flags").upsert({key:r,is_active:l.is_active,default_min_role:l.default_min_role,overrides:l.overrides,updated_at:new Date().toISOString()});if(e)throw e}catch(t){throw console.error("Failed to update feature flag:",t),e({flags:{...i,[r]:n}}),t}},checkAccess:(e,r)=>{let s=t().flags[e];if(!s||!s.is_active)return{allowed:!1,reason:"default"};let a=r||"user",i=s.overrides[a];if(i){if("granted"===i.access)return{allowed:!0,reason:"override"};if("denied"===i.access)return{allowed:!1,reason:"override"};if("time_limited"===i.access){let e=new Date().getTime(),t=i.start_time?new Date(i.start_time).getTime():0,r=i.end_time?new Date(i.end_time).getTime():1/0;return e>=t&&e<=r?{allowed:!0,reason:"beta",remainingTime:r-e}:{allowed:!1,reason:"override"}}}let n=["user","pro","pro_max","admin","super_admin"];return n.indexOf(a)>=n.indexOf(s.default_min_role||"user")?{allowed:!0,reason:"default"}:{allowed:!1,reason:"default"}}}))}},e=>{e.O(0,[4764,3242,8500,5772,6648,8041,8441,3794,7358],()=>e(e.s=78720)),_N_E=e.O()}]);