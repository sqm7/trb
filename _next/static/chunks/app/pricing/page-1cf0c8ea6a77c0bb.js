(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6907],{8451:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var s=r(95155),i=r(12115),a=r(16385),n=r(27529),l=r(52530),d=r(53961),c=r(94514),o=r(33210),m=r(68041),x=r(38346),u=r(85993),h=r(40980);let _={地圖模式:"map_mode",平面圖測量:"floor_plan",報表編輯器:"report_builder",總覽儀表板:"dashboard_metrics",會員方案:"manage_plans","系統公告 (查看)":"system_announcement",系統設定:"system_settings"},f=[{category:"核心功能",items:[{name:"地圖模式",subtext:"側邊欄 > 地圖模式"},{name:"平面圖測量",subtext:"側邊欄 > 平面圖測量（扣次以成功上傳為準）"},{name:"總覽儀表板",subtext:"側邊欄 > 總覽儀表板（按下分析報表扣次）"},{name:"報表編輯器",subtext:"側邊欄 > 報表編輯器（扣次以匯出成功為準）"}]},{category:"系統設定",items:[{name:"會員方案",subtext:"側邊欄 > 會員方案"},{name:"系統公告 (查看)",subtext:"側邊欄 > 系統公告"},{name:"系統設定",subtext:"側邊欄 > 系統設定"}]}],b=[{name:"總覽儀表板"},{name:"平面圖測量"},{name:"報表編輯器"}];function p(){let[e,t]=(0,i.useState)([]),[r,p]=(0,i.useState)(null),[v,g]=(0,i.useState)(null),{role:w,isLoading:j}=(0,x.h)(),{fetchFlags:y,flags:N}=(0,u.T)(),S=!j&&"user"===w,z=!j&&("pro"===w||"pro_max"===w),k=z||!j&&("admin"===w||"super_admin"===w);(0,i.useEffect)(()=>{(async()=>{try{let{data:e}=await a.N.from("pricing_tiers").select("*");e&&t(e)}catch(e){console.error("Error fetching pricing:",e)}})()},[]),(0,i.useEffect)(()=>{y()},[y]),(0,i.useEffect)(()=>{(async()=>{try{let{data:{user:e}}=await a.N.auth.getUser();if(!e)return;let t=await n.FH.getReferralDashboard();p(t?.active_count??0)}catch(e){console.error("Error fetching referral stats:",e)}})()},[]),(0,i.useEffect)(()=>{(async()=>{try{let{data:e,error:t}=await a.N.from("referral_codes").select("code, feature_limits").eq("code_type","seed").eq("is_default_l1",!0).maybeSingle();if(t)throw t;e?.code?g({code:e.code,feature_limits:e.feature_limits||{}}):g(null)}catch(e){console.error("Error fetching default seed:",e),g(null)}})()},[]);let O=[...e].sort((e,t)=>(e.min_referrals??0)-(t.min_referrals??0)),D=O.length?O.filter(e=>"Free"!==e.tier_code):[{tier_code:"A",label:"PRO 標準方案",price:1499,description:"定錨價",min_referrals:0},{tier_code:"B",label:"PRO 好友方案",price:950,description:"好友價",min_referrals:1},{tier_code:"C",label:"PRO VIP 方案",price:750,description:"尊榮價",min_referrals:2}],E=D.find(e=>(e.min_referrals??0)===0)||D[0],T=e=>void 0===e?"未開啟":null===e?"不限次":`可用 ${e} 次`,A=(0,i.useMemo)(()=>[{key:"dashboard_metrics",label:"總儀表板"},{key:"floor_plan",label:"平面圖測量"},{key:"report_builder",label:"報表編輯器"}].map(e=>{let t=N?.[e.key]?.overrides?.user;return t?.access==="time_limited"?{...e,override:t}:null}).filter(Boolean),[N]),F=A.length>0,I=e=>{if(!e)return"未設定";let t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleString()},L=(e,t)=>{let r=_[e];if(!r)return{allowed:!1};if("super_admin"===t)return{allowed:!0};let s=N?.[r];if(!s)return{allowed:!1};let i=["user","pro","pro_max","admin","super_admin"],a=i.indexOf(t),n=i.indexOf(s.default_min_role||"user"),l=s.overrides?.[t];if(l){if("granted"===l.access)return{allowed:!0,isOverride:!0};if("denied"===l.access)return{allowed:!1,isOverride:!0};if("time_limited"===l.access){let e=Date.now(),t=l.start_time?new Date(l.start_time).getTime():0,r=l.end_time?new Date(l.end_time).getTime():1/0;return{allowed:e>=t&&e<=r,isTimeLimited:!0,endTime:l.end_time,override:l}}}return{allowed:a>=n}},R=e=>{let t="總覽儀表板"===e?"dashboard":"平面圖測量"===e?"floor_plan":"報表編輯器"===e?"report_builder":null;if(!t)return null;let r=v?.feature_limits?.[t],s=void 0!==r;return{featureKey:t,limitValue:r,hasGrant:s,allows:s&&(null===r||"number"==typeof r&&r>0)}},P=(e,t)=>{let r=L(e,t).allowed,i=null,a=null,n=!1;if("user"===t){let t=R(e);if(t?.allows&&(r=!0),t?.hasGrant){let r=null===t.limitValue?"不限次":`可用 ${t.limitValue??0} 次`;a=(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center group relative",children:[(0,s.jsxs)("div",{className:"text-[10px] px-1.5 py-0.5 rounded border whitespace-nowrap flex items-center gap-1 bg-sky-500/10 text-sky-300 border-sky-500/30",children:[(0,s.jsx)(l.A,{className:"w-3 h-3"}),"預設"]}),(0,s.jsxs)("div",{className:"absolute top-full mt-2 hidden group-hover:block bg-black border border-zinc-700 p-2 rounded text-xs text-white z-[200] whitespace-nowrap pointer-events-none shadow-lg",children:[(0,s.jsxs)("div",{children:["種子碼：",v?.code??"未設定"]}),(0,s.jsxs)("div",{children:[e,"：",r]})]})]})}let c=_[e],o=c?N?.[c]?.overrides?.user:void 0;if(o?.access==="time_limited"){let e=Date.now(),t=o.start_time?new Date(o.start_time).getTime():0,r=o.end_time?new Date(o.end_time).getTime():1/0,a=e>=t&&e<=r;n=!0;let l=null===o.usage_limit?"不限次":void 0!==o.usage_limit?`每位 L1 可用 ${o.usage_limit} 次`:"未設定次數",c=o.daily_reset_enabled?"每日回溯":o.monthly_reset_enabled?"每月回溯":"無回溯";i=(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center group relative",children:[(0,s.jsxs)("div",{className:(0,h.cn)("text-[10px] px-1.5 py-0.5 rounded border whitespace-nowrap flex items-center gap-1",a?"bg-amber-500/20 text-amber-400 border-amber-500/30":"bg-zinc-800 text-zinc-500 border-zinc-700"),children:[(0,s.jsx)(d.A,{className:(0,h.cn)("w-3 h-3",a?"fill-amber-400":"")}),a?"限時":"過期"]}),(0,s.jsxs)("div",{className:"absolute top-full mt-2 hidden group-hover:block bg-black border border-zinc-700 p-2 rounded text-xs text-white z-[200] whitespace-nowrap pointer-events-none shadow-lg",children:[(0,s.jsxs)("div",{children:["到期: ",o.end_time?new Date(o.end_time).toLocaleDateString():"未設定"]}),(0,s.jsxs)("div",{children:["次數: ",l]}),(0,s.jsxs)("div",{children:["回溯: ",c]})]})]})}}let m=n?(0,s.jsx)(d.A,{className:(0,h.cn)("h-5 w-5 mx-auto",r?"text-amber-400":"text-zinc-600")}):r?(0,s.jsx)(c.A,{className:"h-5 w-5 mx-auto text-emerald-400"}):(0,s.jsx)(o.A,{className:"h-4 w-4 mx-auto text-zinc-600"});return i||a?(0,s.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[i,a,m]}):m},C=(e,t)=>{let r=((e,t)=>{let r=L(e,t).allowed,s=!1;if("user"===t){let t=R(e);t?.allows&&(r=!0);let i=_[e],a=i?N?.[i]?.overrides?.user:void 0;if(a?.access==="time_limited"){let e=Date.now(),t=a.start_time?new Date(a.start_time).getTime():0,i=a.end_time?new Date(a.end_time).getTime():1/0;r=e>=t&&e<=i,s=!0}}return{allowed:r,isTimeLimited:s}})(e,t);return r.isTimeLimited?(0,s.jsx)(d.A,{className:(0,h.cn)("h-4 w-4",r.allowed?"text-amber-400":"text-zinc-600")}):r.allowed?(0,s.jsx)(c.A,{className:"h-4 w-4 text-emerald-400"}):(0,s.jsx)(o.A,{className:"h-4 w-4 text-zinc-600"})};return(0,s.jsx)(m.e,{children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-violet-600/20 rounded-full blur-[128px] pointer-events-none"}),(0,s.jsx)("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-cyan-600/20 rounded-full blur-[128px] pointer-events-none"}),(0,s.jsxs)("div",{className:"relative z-10",children:[(0,s.jsxs)("div",{className:"text-center max-w-3xl mx-auto mb-16",children:[(0,s.jsx)("h1",{className:"text-4xl md:text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white via-zinc-200 to-zinc-400 mb-6",children:"會員方案與權限"}),(0,s.jsx)("p",{className:"text-xl text-zinc-400 leading-relaxed",children:"解鎖完整的房地產市場洞察，做出更精準的投資決策。"})]}),(0,s.jsxs)("div",{className:"max-w-5xl mx-auto mb-24 space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:(0,h.cn)("relative rounded-2xl border p-6 bg-zinc-900/60",S?"border-emerald-500/40 shadow-[0_0_24px_rgba(16,185,129,0.15)]":"border-zinc-800"),children:[(0,s.jsx)("div",{className:"text-xs text-emerald-300",children:"L1 Basic"}),(0,s.jsx)("div",{className:"mt-2 text-xl font-semibold text-white",children:"一般會員"}),(0,s.jsx)("div",{className:"mt-3 text-2xl font-bold text-white",children:"免費"}),(0,s.jsx)("div",{className:"mt-2 text-sm text-zinc-400",children:"基礎瀏覽與限時/推薦碼體驗"}),(0,s.jsx)("div",{className:"mt-4 space-y-2 text-sm text-zinc-300",children:b.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:e.name}),C(e.name,"user")]},e.name))}),(0,s.jsxs)("div",{className:"mt-3 flex items-center justify-between text-[11px] text-zinc-500",children:[(0,s.jsx)("span",{children:"預設種子碼"}),(0,s.jsx)("span",{className:"text-zinc-300",children:v?.code??"未設定"})]}),S&&(0,s.jsx)("div",{className:"mt-4 inline-flex items-center gap-2 text-xs text-emerald-300 border border-emerald-500/30 bg-emerald-500/10 px-2 py-1 rounded-full",children:"你目前是 L1"})]}),(0,s.jsxs)("div",{className:(0,h.cn)("relative rounded-2xl border p-6 bg-zinc-900/60","pro"===w?"border-cyan-400/40 shadow-[0_0_24px_rgba(34,211,238,0.15)]":"border-zinc-800"),children:[(0,s.jsx)("div",{className:"text-xs text-cyan-300",children:"L2 Pro"}),(0,s.jsx)("div",{className:"mt-2 text-xl font-semibold text-white",children:"進階會員"}),(0,s.jsx)("div",{className:"mt-3 text-2xl font-bold text-white",children:E?.price?`NT$ ${E.price}`:"依推薦階梯"}),(0,s.jsx)("div",{className:"mt-2 text-sm text-zinc-400",children:"價格依推薦階梯自動調整"}),(0,s.jsx)("div",{className:"mt-4 space-y-2 text-sm text-zinc-300",children:b.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:e.name}),C(e.name,"pro")]},e.name))}),"pro"===w&&(0,s.jsx)("div",{className:"mt-4 inline-flex items-center gap-2 text-xs text-cyan-300 border border-cyan-500/30 bg-cyan-500/10 px-2 py-1 rounded-full",children:"你目前是 L2"})]}),(0,s.jsxs)("div",{className:(0,h.cn)("relative rounded-2xl border p-6 bg-zinc-900/60","pro_max"===w?"border-amber-400/40 shadow-[0_0_24px_rgba(251,191,36,0.15)]":"border-zinc-800"),children:[(0,s.jsx)("div",{className:"text-xs text-amber-300",children:"L3 Pro Max"}),(0,s.jsx)("div",{className:"mt-2 text-xl font-semibold text-white",children:"最高等級"}),(0,s.jsx)("div",{className:"mt-3 text-2xl font-bold text-white",children:"依方案"}),(0,s.jsx)("div",{className:"mt-2 text-sm text-zinc-400",children:"最高權限與進階功能"}),(0,s.jsx)("div",{className:"mt-4 space-y-2 text-sm text-zinc-300",children:b.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:e.name}),C(e.name,"pro_max")]},e.name))}),"pro_max"===w&&(0,s.jsx)("div",{className:"mt-4 inline-flex items-center gap-2 text-xs text-amber-300 border border-amber-500/30 bg-amber-500/10 px-2 py-1 rounded-full",children:"你目前是 L3"})]})]}),S&&(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"bg-zinc-900/60 border border-zinc-800 rounded-2xl p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-white",children:"L1 權限表內容（預設種子碼）"}),v?.code?(0,s.jsx)("span",{className:"text-[10px] text-sky-300 border border-sky-500/30 bg-sky-500/10 px-2 py-0.5 rounded-full",children:v.code}):(0,s.jsx)("span",{className:"text-[10px] text-zinc-500 border border-zinc-700 px-2 py-0.5 rounded-full",children:"未設定"})]}),(0,s.jsxs)("div",{className:"mt-4 space-y-3 text-sm text-zinc-400",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:"總儀表板"}),(0,s.jsx)("span",{className:"text-zinc-200",children:T(v?.feature_limits?.dashboard)})]}),(0,s.jsx)("div",{className:"text-[10px] text-zinc-500",children:"包含：核心指標與排名、總價帶分析、單價分析、調價熱力圖、政策時光機、銷售速度與房型、車位分析、交易明細列表、分享報表"}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:"平面圖測量"}),(0,s.jsx)("span",{className:"text-zinc-200",children:T(v?.feature_limits?.floor_plan)})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:"報表編輯器"}),(0,s.jsx)("span",{className:"text-zinc-200",children:T(v?.feature_limits?.report_builder)})]})]})]}),(0,s.jsxs)("div",{className:"bg-zinc-900/60 border border-zinc-800 rounded-2xl p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-white",children:"L1 限時開放"}),(0,s.jsx)("span",{className:"text-[10px] text-amber-300 border border-amber-500/30 bg-amber-500/10 px-2 py-0.5 rounded-full",children:F?"已設定":"未設定"})]}),F?(0,s.jsx)("div",{className:"mt-4 space-y-4 text-sm text-zinc-400",children:A.map(e=>{var t,r;return(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-zinc-200",children:[(0,s.jsx)("span",{children:e.label}),(0,s.jsx)("span",{children:(t=e.override,t?.usage_limit===null?"不限次":t?.usage_limit===void 0?"未設定":`每位 L1 可用 ${t.usage_limit} 次`)})]}),(0,s.jsxs)("div",{className:"text-[10px] text-zinc-500",children:[I(e.override.start_time)," ~ ",I(e.override.end_time)]}),(0,s.jsxs)("div",{className:"text-[10px] text-zinc-500",children:["回溯：",(r=e.override,r?.daily_reset_enabled?"每日回溯":r?.monthly_reset_enabled?"每月回溯":"無回溯")]})]},e.key)})}):(0,s.jsx)("p",{className:"mt-4 text-sm text-zinc-500",children:"目前沒有設定限時開放"})]})]}),z&&(0,s.jsxs)("div",{className:"bg-zinc-900/60 border border-zinc-800 rounded-2xl p-6 text-zinc-400",children:["目前為 ","pro_max"===w?"Pro Max":"Pro"," 會員，可參考價格方案階梯與權限表。"]})]}),(0,s.jsx)("div",{className:"max-w-5xl mx-auto mb-24",children:(0,s.jsxs)("div",{className:"bg-zinc-900/40 border border-zinc-800 rounded-2xl p-8",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-white",children:"推薦階梯 / 團購規則"}),(0,s.jsx)("p",{className:"text-sm text-zinc-400 mt-2",children:"推薦人數越多，方案越優惠。門檻由管理者在價格方案設定。"})]}),(0,s.jsxs)("div",{className:"flex flex-col items-end gap-1 text-xs text-zinc-500",children:[(0,s.jsx)("span",{children:"推薦碼訂閱套用「推薦 1 人」門檻"}),null!==r&&(0,s.jsxs)("span",{className:"text-zinc-300",children:["目前已推薦 ",(0,s.jsx)("span",{className:"text-white font-semibold",children:r})," 人"]})]})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:D.map(e=>{let t=e.min_referrals??0;return(0,s.jsxs)("div",{className:"rounded-xl border border-zinc-800 bg-zinc-950/70 p-5",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"text-xs text-zinc-500",children:["方案代碼 ",e.tier_code]}),(0,s.jsxs)("div",{className:"text-xs text-zinc-400",children:["推薦 ",t," 人"]})]}),(0,s.jsx)("div",{className:"mt-3 text-lg font-semibold text-white",children:e.label}),(0,s.jsxs)("div",{className:"mt-2 text-2xl font-bold text-white",children:["NT$ ",e.price]}),e.description&&(0,s.jsx)("div",{className:"text-xs text-zinc-500 mt-2",children:e.description})]},e.tier_code)})}),(0,s.jsxs)("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-zinc-400",children:[(0,s.jsxs)("div",{className:"rounded-xl border border-zinc-800 bg-zinc-950/60 p-4",children:[(0,s.jsx)("div",{className:"text-white font-semibold mb-1",children:"1. 生成推薦碼"}),(0,s.jsx)("div",{children:"在「系統設定」建立你的專屬推薦碼，先分享給朋友。"})]}),(0,s.jsxs)("div",{className:"rounded-xl border border-zinc-800 bg-zinc-950/60 p-4",children:[(0,s.jsx)("div",{className:"text-white font-semibold mb-1",children:"2. 朋友先訂閱"}),(0,s.jsx)("div",{children:"朋友使用你的推薦碼訂閱，你的推薦人數會累計。"})]}),(0,s.jsxs)("div",{className:"rounded-xl border border-zinc-800 bg-zinc-950/60 p-4",children:[(0,s.jsx)("div",{className:"text-white font-semibold mb-1",children:"3. 你再購買"}),(0,s.jsx)("div",{children:"依推薦人數門檻自動套用對應方案，價格更優惠。"})]})]})]})}),k&&(0,s.jsxs)("div",{className:"max-w-5xl mx-auto bg-dark-card rounded-2xl border border-zinc-800 mb-20 shadow-2xl",children:[(0,s.jsxs)("div",{className:"p-6 border-b border-zinc-800 bg-zinc-900/50",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-white",children:"詳細權限比較表"}),(0,s.jsx)("p",{className:"text-sm text-zinc-400 mt-2",children:"依照角色權限表與目前設定顯示。"})]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full text-left border-collapse",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-4 border-b border-zinc-800 bg-zinc-900/30 w-1/3",children:"功能項目"}),(0,s.jsx)("th",{className:"p-4 border-b border-zinc-800 bg-zinc-900/30 text-center w-1/5",children:"L1 Basic"}),(0,s.jsx)("th",{className:"p-4 border-b border-zinc-800 bg-zinc-900/30 text-center w-1/5 text-cyan-400",children:"L2 Pro"}),(0,s.jsx)("th",{className:"p-4 border-b border-zinc-800 bg-zinc-900/30 text-center w-1/5 text-amber-400",children:"L3 Pro Max"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-zinc-800 text-sm text-zinc-300",children:f.map(e=>(0,s.jsxs)(i.Fragment,{children:[(0,s.jsx)("tr",{className:"bg-zinc-900/20",children:(0,s.jsx)("td",{colSpan:4,className:"py-2 px-4 text-xs font-bold text-zinc-500 uppercase",children:e.category})}),e.items.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-zinc-800/30",children:[(0,s.jsxs)("td",{className:"p-4",children:[(0,s.jsx)("div",{className:"text-sm text-zinc-200",children:e.name}),e.subtext&&(0,s.jsx)("div",{className:"text-[11px] text-zinc-500 mt-1",children:e.subtext})]}),(0,s.jsx)("td",{className:"text-center",children:P(e.name,"user")}),(0,s.jsx)("td",{className:"text-center",children:P(e.name,"pro")}),(0,s.jsx)("td",{className:"text-center",children:P(e.name,"pro_max")})]},e.name))]},e.category))})]})})]})]})]})})}},27529:(e,t,r)=>{"use strict";r.d(t,{FH:()=>l});var s=r(16385),i=r(55873);async function a(){let{data:{session:e}}=await s.N.auth.getSession();return{"Content-Type":"application/json",apikey:i.m5,Authorization:`Bearer ${e?.access_token||i.m5}`}}async function n(e){let t=await a(),r=await fetch(i.Sn.RANKING_ANALYSIS,{method:"POST",headers:t,body:JSON.stringify({filters:e})});if(!r.ok)throw Error((await r.json().catch(()=>({error:`Analysis request failed: ${r.status}`}))).error||"Analyze data failed");return r.json()}let l={checkAuth:async function(){let{data:{session:e}}=await s.N.auth.getSession();e||console.log("User not logged in, but allowing access.")},getUser:async function(){let{data:{user:e}}=await s.N.auth.getUser();return e},signOut:async function(){let{error:e}=await s.N.auth.signOut();if(e)throw console.error("Sign out failed:",e),e},fetchData:async function(e,t){let r=await a(),s=await fetch(i.Sn.QUERY_DATA,{method:"POST",headers:r,body:JSON.stringify({filters:e,pagination:t})});if(!s.ok)throw Error((await s.json().catch(()=>({error:"Failed to parse server response"}))).error||"Fetch data failed");return s.json()},analyzeData:n,analyzeProjectRanking:n,fetchSubData:async function(e,t,r){if(!e||!t||!r)throw Error(`Insufficient parameters: ${e}, ${t}, ${r}`);let s=await a(),n=await fetch(i.Sn.SUB_DATA,{method:"POST",headers:s,body:JSON.stringify({id:e,type:t,county:r})});if(!n.ok)throw Error((await n.json().catch(()=>({error:"Failed to fetch sub data"}))).error||"Fetch sub data failed");return n.json()},fetchProjectNameSuggestions:async function(e,t,r=[]){let s=await a(),n=t.replace(/\u3127/g,"一"),l=await fetch(i.Sn.PROJECT_NAMES,{method:"POST",headers:s,body:JSON.stringify({countyCode:e,query:n,districts:r,detailed:!0})});if(!l.ok)throw Error(`Server error: ${l.status}`);return l.json()},getAdminUsers:async function(){let e=await a(),t=await fetch(i.Sn.GET_USERS,{method:"POST",headers:e,body:JSON.stringify({})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to fetch users"}))).error||"Fetch users failed");return t.json()},getUserActivity:async function(e,t=200,r=0){let s=await a(),n=await fetch(i.Sn.GET_USER_ACTIVITY,{method:"POST",headers:s,body:JSON.stringify({userId:e,limit:t,offset:r})});if(!n.ok)throw Error((await n.json().catch(()=>({error:"Failed to fetch user activity"}))).error||"Fetch user activity failed");return n.json()},getActivityStats:async function(){let e=await a(),t=await fetch(i.Sn.GET_ACTIVITY_STATS,{method:"POST",headers:e,body:JSON.stringify({})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to fetch activity stats"}))).error||"Fetch activity stats failed");return t.json()},validateReferralCode:async function(e){let t=await a();return(await fetch(i.Sn.VALIDATE_REFERRAL_CODE,{method:"POST",headers:t,body:JSON.stringify({code:e})})).json()},activateSubscription:async function(e){let t=await a(),r=await fetch(i.Sn.ACTIVATE_SUBSCRIPTION,{method:"POST",headers:t,body:JSON.stringify(e)});if(!r.ok)throw Error((await r.json().catch(()=>({error:"Activation failed"}))).error||"Activation failed");return r.json()},bindReferralCode:async function(e){let t=await a(),r=await fetch(i.Sn.BIND_REFERRAL_CODE,{method:"POST",headers:t,body:JSON.stringify({code:e})});if(!r.ok)throw Error((await r.json().catch(()=>({error:"Failed to bind referral code"}))).error||"Failed to bind referral code");return r.json()},getReferralDashboard:async function(){let e=await a(),t=await fetch(i.Sn.GET_REFERRAL_DASHBOARD,{method:"POST",headers:e,body:JSON.stringify({})});if(!t.ok)throw Error((await t.json().catch(()=>({error:"Failed to fetch referral data"}))).error||"Fetch referral dashboard failed");return t.json()},consumeReferralFeature:async function(e,t="consume"){let r=await a(),s=await fetch(i.Sn.CONSUME_REFERRAL_FEATURE,{method:"POST",headers:r,body:JSON.stringify({feature:e,mode:t})});if(!s.ok){let e=await s.json().catch(()=>({error:"Failed to consume feature"}));throw Error(e.error||e.reason||"Failed to consume feature")}return s.json()}}},38346:(e,t,r)=>{"use strict";r.d(t,{h:()=>a});var s=r(12115),i=r(16385);function a(){let[e,t]=(0,s.useState)(null),[r,a]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{let e=!0,r=async()=>{try{let{data:{session:r}}=await i.N.auth.getSession();if(!r?.user){e&&(t(null),a(!1));return}let{data:s,error:n}=await i.N.from("profiles").select("role").eq("id",r.user.id).single();e&&(s?t(s.role):t("user"),a(!1))}catch(r){console.error("Error fetching user role:",r),e&&(t("user"),a(!1))}};r();let{data:{subscription:s}}=i.N.auth.onAuthStateChange((e,s)=>{s?r():t(null)});return()=>{e=!1,s.unsubscribe()}},[]),{role:e,isLoading:r}}},78720:(e,t,r)=>{Promise.resolve().then(r.bind(r,8451))},85993:(e,t,r)=>{"use strict";r.d(t,{T:()=>n});var s=r(1934),i=r(16385);let a={map_mode:{key:"map_mode",is_active:!0,default_min_role:"user",overrides:{}},floor_plan:{key:"floor_plan",is_active:!0,default_min_role:"user",overrides:{}},report_builder:{key:"report_builder",is_active:!0,default_min_role:"pro",overrides:{}},export_report:{key:"export_report",is_active:!0,default_min_role:"pro",overrides:{}},market_heatmap:{key:"market_heatmap",is_active:!0,default_min_role:"pro",overrides:{user:{access:"time_limited",start_time:new Date().toISOString(),end_time:new Date(Date.now()+2592e6).toISOString(),is_manual_override:!0}}},price_analysis:{key:"price_analysis",is_active:!0,default_min_role:"pro",overrides:{user:{access:"time_limited",start_time:new Date().toISOString(),end_time:new Date(Date.now()+2592e6).toISOString(),is_manual_override:!0}}},total_price_analysis:{key:"total_price_analysis",is_active:!0,default_min_role:"pro",overrides:{user:{access:"time_limited",start_time:new Date().toISOString(),end_time:new Date(Date.now()+2592e6).toISOString(),is_manual_override:!0}}},policy_timeline:{key:"policy_timeline",is_active:!0,default_min_role:"pro",overrides:{user:{access:"time_limited",start_time:new Date().toISOString(),end_time:new Date(Date.now()+2592e6).toISOString(),is_manual_override:!0}}},sales_velocity:{key:"sales_velocity",is_active:!0,default_min_role:"pro",overrides:{user:{access:"time_limited",start_time:new Date().toISOString(),end_time:new Date(Date.now()+2592e6).toISOString(),is_manual_override:!0}}},parking_analysis:{key:"parking_analysis",is_active:!0,default_min_role:"pro",overrides:{user:{access:"time_limited",start_time:new Date().toISOString(),end_time:new Date(Date.now()+2592e6).toISOString(),is_manual_override:!0}}},transaction_list:{key:"transaction_list",is_active:!0,default_min_role:"pro",overrides:{user:{access:"time_limited",start_time:new Date().toISOString(),end_time:new Date(Date.now()+2592e6).toISOString(),is_manual_override:!0}}},share_report:{key:"share_report",is_active:!0,default_min_role:"pro",overrides:{user:{access:"time_limited",start_time:new Date().toISOString(),end_time:new Date(Date.now()+2592e6).toISOString(),is_manual_override:!0}}},system_settings:{key:"system_settings",is_active:!0,default_min_role:"user",overrides:{}},system_announcement:{key:"system_announcement",is_active:!0,default_min_role:"user",overrides:{}},admin_panel:{key:"admin_panel",is_active:!0,default_min_role:"admin",overrides:{}},manage_members:{key:"manage_members",is_active:!0,default_min_role:"admin",overrides:{}},delete_members:{key:"delete_members",is_active:!0,default_min_role:"super_admin",overrides:{}},manage_projects:{key:"manage_projects",is_active:!0,default_min_role:"admin",overrides:{}},post_annoucement:{key:"post_annoucement",is_active:!0,default_min_role:"admin",overrides:{}},upload_tools:{key:"upload_tools",is_active:!0,default_min_role:"admin",overrides:{}},edit_permissions:{key:"edit_permissions",is_active:!0,default_min_role:"super_admin",overrides:{}},manage_plans:{key:"manage_plans",is_active:!0,default_min_role:"admin",overrides:{}},dashboard_metrics:{key:"dashboard_metrics",is_active:!0,default_min_role:"user",overrides:{}}},n=(0,s.v)((e,t)=>({flags:a,isLoading:!0,error:null,fetchFlags:async()=>{e({isLoading:!0,error:null});try{let{data:t,error:r}=await i.N.from("feature_flags").select("*");if(r){console.warn("Failed to fetch feature flags (using defaults):",r.message),e({isLoading:!1});return}if(t&&t.length>0){let r={...a};t.forEach(e=>{r[e.key]&&(r[e.key]={...r[e.key],...e,overrides:e.overrides||{}})}),e({flags:r,isLoading:!1})}else e({isLoading:!1})}catch(t){console.error("Feature flag fetch error:",t),e({isLoading:!1,error:t.message})}},updateFlag:async(r,s)=>{let a=t().flags,n=a[r],l={...n,...s};e({flags:{...a,[r]:l}});try{let{error:e}=await i.N.from("feature_flags").upsert({key:r,is_active:l.is_active,default_min_role:l.default_min_role,overrides:l.overrides,updated_at:new Date().toISOString()});if(e)throw e}catch(t){throw console.error("Failed to update feature flag:",t),e({flags:{...a,[r]:n}}),t}},checkAccess:(e,r)=>{let s=t().flags[e];if(!s||!s.is_active)return{allowed:!1,reason:"default"};let i=r||"user",a=s.overrides[i];if(a){if("granted"===a.access)return{allowed:!0,reason:"override"};if("denied"===a.access)return{allowed:!1,reason:"override"};if("time_limited"===a.access){let e=new Date().getTime(),t=a.start_time?new Date(a.start_time).getTime():0,r=a.end_time?new Date(a.end_time).getTime():1/0;return e>=t&&e<=r?{allowed:!0,reason:"beta",remainingTime:r-e}:{allowed:!1,reason:"override"}}}let n=["user","pro","pro_max","admin","super_admin"];return n.indexOf(i)>=n.indexOf(s.default_min_role||"user")?{allowed:!0,reason:"default"}:{allowed:!1,reason:"default"}}}))}},e=>{e.O(0,[4764,3242,8500,5772,6648,8041,8441,3794,7358],()=>e(e.s=78720)),_N_E=e.O()}]);