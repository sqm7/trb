(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4885],{19246:(e,s,t)=>{Promise.resolve().then(t.bind(t,88640))},88640:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>K});var a=t(95155),r=t(39092),l=t.n(r),d=t(12115),c=t(16385),i=t(59386),n=t.n(i);let o={A:"臺北市",B:"臺中市",C:"基隆市",D:"臺南市",E:"高雄市",F:"新北市",G:"宜蘭縣",H:"桃園市",I:"嘉義市",J:"新竹縣",K:"苗栗縣",M:"南投縣",N:"彰化縣",O:"新竹市",P:"雲林縣",Q:"嘉義縣",T:"屏東縣",U:"花蓮縣",V:"臺東縣",W:"金門縣",X:"澎湖縣",Z:"連江縣"},x={a:{編號:"編號",鄉鎮市區:"行政區",交易標的:"交易標的",土地位置建物門牌:"地址",交易年月日:"交易日",交易筆棟數:"交易筆棟數",移轉層次:"樓層",建物型態:"建物型態",主要用途:"主要用途",建物移轉總面積平方公尺:"產權面積_房車","建物現況格局-房":"房數","建物現況格局-廳":"廳數","建物現況格局-衛":"衛浴數",總價元:"交易總價",車位類別:"車位類別",車位移轉總面積平方公尺:"車位總面積",車位總價元:"車位總價",備註:"備註",主建物面積:"主建物面積",附屬建物面積:"附屬建物面積",陽台面積:"陽台面積"},a_build:{編號:"編號",屋齡:"交易屋齡",主要建材:"結構",建築完成年月日:"完工日",建築完成日期:"完工日",總層數:"總樓層",移轉情形:"移轉情形"},a_land:{編號:"編號",土地位置:"地號_段",地號:"地號",土地移轉面積平方公尺:"土地持分面積",使用分區或編定:"使用分區",非都市土地使用分區:"使用分區",權利人持分分母:"持分分母",權利人持分分子:"持分分子"},a_park:{編號:"編號",車位類別:"車位類別",車位價格:"車位價格",車位面積平方公尺:"車位面積",車位所在樓層:"車位樓層"},b:{編號:"編號",鄉鎮市區:"行政區",交易標的:"交易標的",土地位置建物門牌:"地址","土地位置/建物門牌":"地址",交易年月日:"交易日",交易筆棟數:"交易筆棟數",移轉層次:"樓層",總層數:"總樓層",總樓層數:"總樓層",建物型態:"建物型態",主要用途:"主要用途",建物移轉總面積平方公尺:"產權面積_房車","建物移轉總面積(平方公尺)":"產權面積_房車","建物現況格局-房":"房數","建物現況格局-廳":"廳數","建物現況格局-衛":"衛浴數","建物現況格局-隔間":"建物現況格局-隔間",主要建材:"主要建材",建築完成年月:"建築完成年月",有無管理組織:"有無管理組織","有無備註欄(Y/N)":"有無備註欄",有無備註欄:"有無備註欄","土地移轉總面積(平方公尺)":"土地移轉總面積",都市土地使用分區:"都市土地使用分區",非都市土地使用分區:"非都市土地使用分區",非都市土地使用編定:"非都市土地使用編定",總價元:"交易總價","總價(元)":"交易總價","單價(元/平方公尺)":"單價(元/平方公尺)",車位類別:"車位類別",車位移轉總面積平方公尺:"車位總面積","車位移轉總面積(平方公尺)":"車位總面積",車位總價元:"車位總價","車位總價(元)":"車位總價",交易標的橫坐標:"交易標的橫坐標",交易標的縱坐標:"交易標的縱坐標",備註:"備註",建案名稱:"建案名稱",棟及號:"戶別",解約情形:"解約情形"},b_land:{編號:"編號",土地位置:"地號_段",地號:"地號",土地移轉面積平方公尺:"土地持分面積",使用分區或編定:"使用分區",非都市土地使用分區:"使用分區",權利人持分分母:"持分分母",權利人持分分子:"持分分子",移轉情形:"移轉情形"},b_park:{編號:"編號",車位類別:"車位類別",車位價格:"車位價格",車位面積平方公尺:"車位面積",車位所在樓層:"車位樓層"},c:{編號:"編號",鄉鎮市區:"行政區",交易標的:"交易標的",土地位置建物門牌:"地址",租賃年月日:"交易日",租賃筆棟數:"交易筆棟數",租賃層次:"樓層",建物型態:"建物型態",主要用途:"主要用途",建物總面積平方公尺:"租賃面積","建物現況格局-房":"房數","建物現況格局-廳":"廳數","建物現況格局-衛":"衛浴數",總額元:"交易總價",車位類別:"車位類別",車位面積平方公尺:"車位總面積",車位總額元:"車位總價",備註:"備註",出租型態:"出租型態",租賃期間:"租賃期間",附屬設備:"附屬設備",租賃住宅服務:"租賃住宅服務"},c_build:{編號:"編號",屋齡:"交易屋齡",主要建材:"結構",建築完成年月日:"完工日",建築完成日期:"完工日",總層數:"總樓層",移轉情形:"移轉情形"},c_land:{編號:"編號",土地位置:"地號_段",地號:"地號",土地移轉面積平方公尺:"土地租賃面積",使用分區或編定:"使用分區",非都市土地使用分區:"使用分區"},c_park:{編號:"編號",車位類別:"車位類別",車位價格:"車位價格",車位面積平方公尺:"車位面積",車位所在樓層:"車位樓層"}};function f(e){if("string"!=typeof e&&"number"!=typeof e)return null;let s=parseFloat(String(e).replace(/,/g,""));return isNaN(s)?null:s}function m(e){if(null==e)return null;let s=String(e).trim();return s.length>0?s:null}function h(e){return"edit"===e?3:"list"===e?2:1}let u=null,j=new Map;async function g(){if(u)return u;let e=await Promise.all([t.e(3524),t.e(8436)]).then(t.bind(t,15967));return u=e?.default??e}async function b(e,s=""){let t=[];for await(let a of e.values()){let e=s?`${s}/${a.name}`:a.name;if("file"===a.kind){let s=a.name.toLowerCase();if(s.endsWith(".csv")){let s=/^([a-z])_lvr_land_([a-c](?:_build|_land|_park)?)\.csv$/i,r=a.name.match(s);r&&t.push({handle:a,name:a.name,fullPath:e,countyCode:r[1].toLowerCase(),tableType:r[2].toLowerCase(),isMain:!r[2].includes("_"),sourceType:"opendata",sourcePriority:h("opendata")})}else if(s.endsWith(".xls")||s.endsWith(".xlsx")){let s=/^(list|edit)_([a-z])\d+_\d+\.(xls|xlsx)$/i,r=a.name.match(s);if(r){let s=r[1].toLowerCase(),l=r[2].toLowerCase(),d=await a.getFile(),c=await d.arrayBuffer(),i=await g(),n=i.read(c,{type:"array"});for(let r of(j.set(a,n),n.SheetNames)){let d=n.Sheets[r],c=function(e,s){if(e.includes("預售"))return"b";if(e.includes("停車位"))return"b_park";if(e.startsWith("土地"))return"b_land";let t=new Set(s);return t.has("車位價格")&&t.has("車位面積平方公尺")?"b_park":t.has("土地位置")&&t.has("地號")?"b_land":t.has("建案名稱")&&t.has("總價(元)")?"b":null}(r,(i.utils.sheet_to_json(d,{header:1,raw:!0,defval:""})[0]||[]).map(e=>String(e).trim()).filter(e=>e));c&&t.push({handle:a,name:a.name,fullPath:`${e}#${r}`,countyCode:l,tableType:c,isMain:"b"===c,sourceType:s,sourcePriority:h(s),sheetName:r})}}}}else"directory"===a.kind&&t.push(...await b(a,e))}return t}async function p(e,s,t){let a=e.handle,r=await a.getFile(),l=[];if(r.name.toLowerCase().endsWith(".csv")){let s=await new Promise(e=>{n().parse(r,{header:!0,skipEmptyLines:!0,transformHeader:e=>e.trim(),complete:e})});if(s.errors&&s.errors.length>0){let a=["TooManyFields","TooFewFields","MissingQuotes"],r=s.errors.filter(e=>!a.includes(e.code));if(r.length>0)throw Error(`CSV 嚴重解析錯誤: ${r[0].message}`);t&&s.errors.forEach(s=>{t(`檔案 ${e.fullPath} 有解析警告 (已忽略): ${s.message} (行: ${(s.row||0)+2})`,"warning")})}if(!s.data||0===s.data.length)return[];l=s.data}else if(r.name.toLowerCase().endsWith(".xls")||r.name.toLowerCase().endsWith(".xlsx")){if(!e.sheetName)throw Error(`檔案 ${e.name} 缺少分頁資訊，無法解析。`);let s=await g(),t=j.get(a);if(!t){let e=await r.arrayBuffer();t=s.read(e,{type:"array"}),j.set(a,t)}let d=t.Sheets[e.sheetName];if(!d)throw Error(`檔案 ${e.name} 找不到分頁 ${e.sheetName}`);let c=s.utils.sheet_to_json(d,{header:1,raw:!0,defval:""}),i=(c[0]||[]).map(e=>String(e).trim());l=c.slice(1).map(e=>{let s={};return i.forEach((t,a)=>{t&&(s[t]=e[a])}),s}).filter(e=>!Object.values(e).every(e=>null==e||""===e))}else throw Error(`不支援的檔案格式: ${e.name}`);if(!l||0===l.length)return[];l[0]["編號"]?.toLowerCase?.().includes("serial number")&&l.shift();let d=x[e.tableType];if(!d)throw Error(`檔案 ${e.name} 找不到對應的欄位規則。`);let c=l.map(s=>{let t=function(e,s){let t={};Array.from(new Set(Object.values(s))).forEach(e=>t[e]=null);let a=null,r=null;for(let l in e){let d=s[l.trim()];if(d){let s=e[l];if(void 0===s||""===s||null===s)continue;"樓層"===d||"總樓層"===d?t[d]=function(e){if(!e||"string"!=typeof e)return null;let s=String(e).replace(/層|樓/g,""),t={一:1,二:2,三:3,四:4,五:5,六:6,七:7,八:8,九:9,十:10};if(!isNaN(parseInt(s)))return parseInt(s,10);if(s.includes("地下"))return -1;let a=0;if(s.startsWith("十"))a=10+(t[s[1]]||0);else if(s.includes("十")){let e=s.split("十");a=10*(t[e[0]]||1)+(t[e[1]]||0)}else a=t[s]||0;return a>0?a:null}(s):d.includes("日")?t[d]=function(e){if(!e)return null;let s=String(e).match(/(\d{2,3})[^\d]*(\d{1,2})[^\d]*(\d{1,2})/);if(!s)return null;try{let e=parseInt(s[1],10),t=parseInt(s[2],10),a=parseInt(s[3],10);if(isNaN(e)||isNaN(t)||isNaN(a))return null;let r=e+1911,l=String(t).padStart(2,"0"),d=String(a).padStart(2,"0"),c=new Date(`${r}-${l}-${d}`);if(isNaN(c.getTime())||c.getDate()!==a)return null;return`${r}-${l}-${d}`}catch(e){return null}}(String(s)):["交易總價","車位總價","房數","廳數","衛浴數","持分分母","持分分子","交易屋齡","車位價格","單價(元/平方公尺)"].includes(d)?t[d]=f(s):"交易標的橫坐標"===d?(a=f(s),t[d]=a):"交易標的縱坐標"===d?(r=f(s),t[d]=r):d.includes("面積")?t[d]=f(s):t[d]=String(s)}}if(null!==a&&null!==r){let e=function(e,s){if(!isFinite(e)||!isFinite(s))return null;let t=Math.sqrt(1-40408299984659.16/0x24ffb2985f71),a=t*t/(1-t*t),r=(s-0)/.9999/(6378137*(1-Math.pow(t,2)/4-3*Math.pow(t,4)/64-5*Math.pow(t,6)/256)),l=(1-Math.sqrt(1-t*t))/(1+Math.sqrt(1-t*t)),d=r+(3*l/2-27*Math.pow(l,3)/32)*Math.sin(2*r)+(21*Math.pow(l,2)/16-55*Math.pow(l,4)/32)*Math.sin(4*r)+151*Math.pow(l,3)/96*Math.sin(6*r)+1097*Math.pow(l,4)/512*Math.sin(8*r),c=Math.sin(d),i=Math.cos(d),n=Math.tan(d),o=a*i*i,x=n*n,f=6378137*(1-t*t)/Math.pow(1-t*t*c*c,1.5),m=6378137/Math.sqrt(1-t*t*c*c),h=(e-25e4)/(.9999*m);return{lat:180*(d-m*n/f*(h*h/2-(5+3*x+10*o-4*o*o-9*a)*Math.pow(h,4)/24+(61+90*x+298*o+45*x*x-252*a-3*o*o)*Math.pow(h,6)/720))/Math.PI,lng:180*(121*Math.PI/180+(h-(1+2*x+o)*Math.pow(h,3)/6+(5-2*o+28*x-3*o*o+8*a+24*x*x)*Math.pow(h,5)/120)/i)/Math.PI}}(a,r);e&&(t["交易標的經度"]=e.lng,t["交易標的緯度"]=e.lat)}return t}(s,d);return e.tableType.startsWith("b")&&(t.data_source=e.sourceType,t.source_priority=e.sourcePriority),t});if(s&&s.size>0){let e=0;c=c.map(t=>{let a=t["建案名稱"];if(a&&s.has(a)){let r=s.get(a);r&&(t["建案名稱"]=r,e++)}return t}),e>0&&t&&t(`已自動替換 ${e} 筆建案名稱`,"info")}return c}let y=new Map,w=new Set,N=new Map,v=new Set,k=new Set,$=new Set,S=200,_={new:0,updated:0,identical:0,subAdded:0,errors:0,warnings:0,newRecords:[],updatedRecords:[],identicalRecords:[],errorFiles:[],warningRecords:[],detailLimit:200,detailTruncated:{new:0,updated:0,identical:0,errors:0,warnings:0}};function C(e,s,t,a=S){e.length<a?e.push(s):_.detailTruncated[t]+=1}function M(e,s){_.errorFiles.length<S?_.errorFiles.push({file:e,message:s}):_.detailTruncated.errors+=1}function P(e){var s,t;let a=[e.file??"",e.table??"",e.id??"",e.message].join("|");if(v.has(a))return;v.add(a),_.warnings+=1,C(_.warningRecords,e,"warnings");let r=(s=e.table,t=e.id,s&&t?`${s}|${t}`:null);r&&("park_count_exceed"===e.issue&&k.add(r),("park_count_mismatch"===e.issue||"park_main_zero"===e.issue||"park_missing_main"===e.issue)&&$.add(r))}async function z(e){try{let{data:s,error:t}=await c.N.from("project_name_mappings").select("old_name, new_name");if(t)return e&&e(`載入建案名稱對應失敗: ${t.message}`,"warning"),new Map;let a=new Map;return s?.forEach(e=>{a.set(e.old_name,e.new_name)}),e&&e(`已載入 ${a.size} 筆建案名稱對應規則`,"info"),y=a,a}catch(s){return e&&e(`載入建案名稱對應時發生錯誤: ${s.message}`,"warning"),new Map}}async function E(e,s,t){try{let a=`${e.countyCode}_lvr_land_${e.tableType}`,r=await p(e,y,(e,t)=>s(e,t));if(!r||0===r.length)return void s(`${e.fullPath}: 檔案為空或無有效資料，已跳過`,"warning");let l=t?.chunkSize??500;for(let d=0;d<r.length;d+=l){let i=r.slice(d,d+l),n=i.map(e=>m(e["編號"])).filter(Boolean),{data:o,error:h}=await c.N.from(a).select("*").in("編號",n);if(h)throw h;let u=new Map((o||[]).map(e=>[e["編號"],e])),j=[],g=[],b=[],p=0,y=0,N=e.tableType.startsWith("b"),v=N?e.sourcePriority??1:0;for(let s of i){let r=m(s["編號"]);r&&(s["編號"]=r);let l=r?u.get(r):void 0;if(l){let d=N?Number(l.source_priority??0):0;if(N&&v<d){y++,C(_.identicalRecords,l,"identical",t?.detailLimit);continue}let c=N&&v>d;if(c||!function(e,s,t){let a=x[t];if(!a)return!1;for(let t of Object.values(a)){if("id"===t||"建案名稱"===t)continue;let a=e[t],r=s[t];if(null==a||""===a)continue;let l=null!=a?String(a):"",d=null!=r?String(r):"";if(t.includes("面積")){let e=f(a)||0;if(Math.abs(e-(f(r)||0))>.001)return!1}else if(l!==d)return!1}return!0}(s,l,e.tableType)){let d=function(e,s,t){let a=x[t];if(!a)return[];let r=[];for(let t of Object.values(a)){if("id"===t||"建案名稱"===t)continue;let a=e[t],l=s[t];if(null!=a&&""!==a)if(t.includes("面積")){let e=f(a)||0;Math.abs(e-(f(l)||0))>.001&&r.push({field:t,oldValue:l,newValue:a})}else(null!=a?String(a):"")!==(null!=l?String(l):"")&&r.push({field:t,oldValue:l,newValue:a})}return r}(s,l,e.tableType),i=c&&0===d.length?"priority":"diff";b.push(r||s["編號"]),g.push(s),C(_.updatedRecords,{id:r||s["編號"],file:e.fullPath,table:a,reason:i,diffFields:d,oldData:l,newData:s},"updated",t?.detailLimit)}else p++,C(_.identicalRecords,l,"identical",t?.detailLimit)}else j.push(s),C(_.newRecords,s,"new",t?.detailLimit)}let k=p+y,$=[`${e.fullPath} (區塊 ${Math.floor(d/l)+1}): 新增 ${j.length}, 更新 ${g.length}, 跳過 ${k}`];if(y>0&&$.push(`(低優先權略過 ${y})`),s($.join(" "),"info"),_.new+=j.length,_.updated+=g.length,_.identical+=k,[...j.map(e=>m(e["編號"])||e["編號"]),...g.map(e=>m(e["編號"])||e["編號"])].forEach(e=>w.add(e)),b.length>0){await T(e.countyCode,e.tableType,b,s);let{error:t}=await c.N.from(a).delete().in("編號",b);if(t)throw t}let S=[...j,...g];if(S.length>0){let{error:e}=await c.N.from(a).insert(S);if(e)throw e}}}catch(t){s(`${e.fullPath} 上傳失敗: ${t.message}`,"error"),_.errors++,M(e.fullPath,t.message)}}async function L(e,s,t){try{let a=`${e.countyCode}_lvr_land_${e.tableType}`,r=await p(e,y,(e,t)=>s(e,t));if(!r||0===r.length)return void s(`${e.fullPath}: 檔案為空或無有效資料，已跳過`,"warning");if(e.tableType.startsWith("b_")){let l=`${e.countyCode}_lvr_land_b`,d=new Map;r.forEach(e=>{let s=m(e["編號"]);s&&(d.has(s)||d.set(s,[]),d.get(s).push(e))});let i=Array.from(d.keys()),n=t?.chunkSize??500,o=0,x=0,f=0;for(let t=0;t<i.length;t+=n){let r=i.slice(t,t+n),{data:h,error:u}=await c.N.from(l).select("編號, source_priority, 車位數").in("編號",r);if(u)throw u;let j=new Map((h||[]).map(e=>[e["編號"],e])),g=[];for(let s of r){let t=d.get(s)||[],a=j.get(s);if(!a){x+=t.length;continue}let r=e.sourcePriority??1,l=Number(a.source_priority??0);if(r<l){f+=t.length;continue}g.push(...t)}if(g.length>0){let{error:t}=await c.N.from(a).insert(g);if(t)throw t;if(o+=g.length,"b_park"===e.tableType){let t=Array.from(new Set(g.map(e=>m(e["編號"])).filter(Boolean)));if(t.length>0){let e=N.get(a);e||(e=new Set,N.set(a,e)),t.forEach(s=>e.add(s))}await A(a,t,j,e.fullPath,s)}}}if(o>0){_.subAdded+=o;let t=[`${e.fullPath}: 成功新增 ${o} 筆關聯的附表紀錄`];x>0&&t.push(`(找不到主表 ${x})`),f>0&&t.push(`(低優先權略過 ${f})`),s(t.join(" "),"success")}else{let t=[`${e.fullPath}: 無可插入的附表資料`];x>0&&t.push(`(找不到主表 ${x})`),f>0&&t.push(`(低優先權略過 ${f})`),s(t.join(" "),"info")}}else{let t=r.filter(e=>{let s=m(e["編號"]);return s&&(e["編號"]=s),!!s&&w.has(s)});if(t.length>0){let{error:r}=await c.N.from(a).insert(t);if(r)throw r;_.subAdded+=t.length,s(`${e.fullPath}: 成功新增 ${t.length} 筆關聯的附表紀錄`,"success")}else s(`${e.fullPath}: 無對應的主表變更，已跳過`,"info")}}catch(t){s(`${e.fullPath} 上傳失敗: ${t.message}`,"error"),_.errors++,M(e.fullPath,t.message)}}async function T(e,s,t,a){if(0!==t.length)for(let r of["_park","_land"]){let l=`${e}_lvr_land_${s}${r}`,{error:d}=await c.N.from(l).delete().in("編號",t);if(d){let e=d?.message||"";if("42P01"===(d?.code||"")||e.includes("does not exist")){a(`${l} 不存在，略過刪除`,"warning");continue}throw d}a(`${l}: 已清除對應附表資料 (${t.length} 筆主表編號)`,"warning")}}async function R(e,s){if("recent"===e){if(0===N.size)return s("本次上傳沒有可檢查的車位附表資料","info"),_;for(let[e,t]of(s("開始檢查本次上傳的車位數量是否與主表一致...","info"),N.entries())){let a=Array.from(t);await F(e,a,`本次上傳檢查`,s)}if(k.size>0){let e=0,t=0;k.forEach(s=>{$.has(s)?e+=1:t+=1}),s(`本次上傳檢查結果：仍不一致 ${e} 筆，已消失 ${t} 筆`,"info")}return s("本次上傳車位數量檢查完成","success"),_}for(let e of(s("開始全庫車位數量檢查（可能需較久時間）...","warning"),"abcdefghijklmnopqrstuvwxyz".split(""))){let t=`${e}_lvr_land_b_park`,a=await I(t,s);0!==a.length&&await F(t,a,`全庫檢查`,s)}return s("全庫車位數量檢查完成","success"),_}async function I(e,s){let t=0,a=new Set;for(;;){let{data:r,error:l}=await c.N.from(e).select("編號").range(t,t+1e4-1);if(l){let t=l?.message||"";if("42P01"===(l?.code||"")||t.includes("does not exist"))return s(`${e} 不存在，略過全庫檢查`,"warning"),[];throw l}if(!r||0===r.length||(r.forEach(e=>{let s=m(e["編號"]);s&&a.add(s)}),r.length<1e4))break;t+=1e4}return Array.from(a)}async function F(e,s,t,a){if(0===s.length)return;let r=e.replace("_park",""),l=new Map;for(let t=0;t<s.length;t+=1e3){let a=s.slice(t,t+1e3),{data:r,error:d}=await c.N.from(e).select("編號").in("編號",a);if(d)throw d;r?.forEach(e=>{let s=m(e["編號"]);s&&l.set(s,(l.get(s)||0)+1)})}let d=new Map;for(let e=0;e<s.length;e+=1e3){let t=s.slice(e,e+1e3),{data:a,error:l}=await c.N.from(r).select("編號, 車位數").in("編號",t);if(l)throw l;a?.forEach(e=>{let s=m(e["編號"]);s&&d.set(s,e)})}s.forEach(s=>{let r=m(s)||s,c=l.get(r)||0,i=d.get(r);if(!i){let s=`${e} 編號 ${r}: 找不到主表資料 (${t})`;a(s,"warning"),P({file:t,table:e,id:r,message:s,stage:"audit",issue:"park_missing_main"});return}let n=Number(i["車位數"]??0);if(0===n&&c>0){let s=`${e} 編號 ${r}: 主表車位數為 0，但附表有 ${c} 筆 (${t})`;a(s,"warning"),P({file:t,table:e,id:r,message:s,stage:"audit",issue:"park_main_zero"});return}if(n>0&&c!==n){let s=`${e} 編號 ${r}: 車位筆數 ${c} 與主表車位數 ${n} 不一致 (${t})`;a(s,"warning"),P({file:t,table:e,id:r,message:s,stage:"audit",issue:"park_count_mismatch"})}})}async function A(e,s,t,a,r){if(0===s.length)return;let{data:l,error:d}=await c.N.from(e).select("id, 編號, 車位類別, 車位價格, 車位面積, 車位樓層").in("編號",s);if(d)throw d;let i=new Map;for(let[s,d]of((l||[]).forEach(e=>{let s=m(e["編號"]);s&&(i.has(s)||i.set(s,[]),i.get(s).push(e))}),i.entries())){let l=new Set,c=0;for(let e of d){let s=function(e){let s=null!==e["車位面積"]&&void 0!==e["車位面積"]?Number(e["車位面積"]).toFixed(3):"",t=null!==e["車位價格"]&&void 0!==e["車位價格"]?String(e["車位價格"]):"";return[e["車位類別"]??"",t,s,e["車位樓層"]??""].join("|")}(e);l.has(s)?c+=1:l.add(s)}if(c>0){let t=`${e} 編號 ${s}: 偵測到疑似重複車位 ${c} 筆 (未刪除)`;r(t,"warning"),P({file:a,table:e,id:s,message:t,stage:"upload",issue:"park_duplicate"})}let i=d.length,n=Number(t.get(s)?.["車位數"]??0);if(n>0&&i>n){let t=`${e} 編號 ${s}: 車位筆數 ${i} 超過主表車位數 ${n} (未刪除)`;r(t,"warning"),P({file:a,table:e,id:s,message:t,stage:"upload",issue:"park_count_exceed"})}}}var O=t(73321),D=t(36228);function U(e,s){if(!e||!s)throw Error("請提供完整的 Supabase URL 和 Service Role Key");return(0,D.UU)(e,s,{auth:{persistSession:!1}})}async function W(e,s,t,a,r){try{let l=U(r.url,r.key),d=`${e.toLowerCase()}_lvr_land_${s}`;console.log(`[AdminService] Searching ${d} for ${t} like %${a}%`);let{data:c,error:i}=await l.from(d).select("*").ilike(t,`%${a}%`).limit(100);if(i)throw i;return{success:!0,data:c,tableName:d}}catch(e){return console.error("Search error:",e),{success:!1,error:e.message}}}async function V(e,s,t,a,r,l,d,c){try{let i=U(c.url,c.key);if(!s||0===s.length)throw Error("沒有選擇任何要更新的資料");console.log(`[AdminService] Batch updating ${e}, Count: ${s.length}, Field: ${t}`);let{error:n}=await i.from(e).update({[t]:""===a?null:a}).in("編號",s);if(n)throw n;let o=r&&r.includes("?");return"建案名稱"===t&&r&&a&&r!==a&&o&&(console.log(`[AdminService] Detected encoding fix (old: ${r}, new: ${a}). Saving mapping.`),await B(r,a,l,d,i)),{success:!0,count:s.length}}catch(e){return console.error("Batch update error:",e),{success:!1,error:e.message}}}async function B(e,s,t,a,r){try{let l={old_name:e,new_name:s,updated_at:new Date().toISOString()};t&&(l.district=t),a&&(l.city=a);let{error:d}=await r.from("project_name_mappings").upsert(l,{onConflict:"old_name"});d&&console.error("Failed to save mapping:",d)}catch(e){console.error("Error saving mapping:",e)}}var J=t(14670),q=t(80723);function K(){let e,s,t,r,i,n,f=(0,O.useRouter)(),{guard:m}=(0,J.X)("upload_tools"),[h,u]=(0,d.useState)([]),[j,g]=(0,d.useState)(!1),[p,y]=(0,d.useState)([]),[C,M]=(0,d.useState)("all"),[P,T]=(0,d.useState)(""),[I,F]=(0,d.useState)(0),[A,D]=(0,d.useState)(null),[U,B]=(0,d.useState)(500),[K,H]=(0,d.useState)(200),[G,Q]=(0,d.useState)(50),[X,Y]=(0,d.useState)(null),[Z,ee]=(0,d.useState)(1),[es,et]=(0,d.useState)(!1),[ea,er]=(0,d.useState)(""),[el,ed]=(0,d.useState)(""),[ec,ei]=(0,d.useState)(!1),[en,eo]=(0,d.useState)("f"),[ex,ef]=(0,d.useState)("b"),[em,eh]=(0,d.useState)("建案名稱"),[eu,ej]=(0,d.useState)(""),[eg,eb]=(0,d.useState)([]),[ep,ey]=(0,d.useState)(!1),[ew,eN]=(0,d.useState)(new Set),[ev,ek]=(0,d.useState)("建案名稱"),[e$,eS]=(0,d.useState)(""),[e_,eC]=(0,d.useState)(!1),[eM,eP]=(0,d.useState)(!1),[ez,eE]=(0,d.useState)(null),[eL,eT]=(0,d.useState)(new Set),[eR,eI]=(0,d.useState)(!1),eF=(e,s)=>{let t=new Date().toLocaleTimeString();u(a=>[...a,{id:Date.now()+Math.random(),text:e,type:s,time:t}])},eA=async()=>{if(!ea||!el)return void eF("請填寫完整的 Supabase URL 和 Service Role Key。","error");eF("正在測試連線...","info");try{let{error:e}=await c.N.from("county_codes").select("code",{count:"exact",head:!0});if(e&&"42P01"!==e.code)throw e;eF("連線成功！","success"),ei(!0),z((e,s)=>eF(e,s))}catch(e){eF(`連線失敗: ${e.message}`,"error"),ei(!1)}},eO=async()=>{u([]),y([]),D(null);try{if(!window.showDirectoryPicker)return void eF("您的瀏覽器不支援資料夾選擇功能，請使用 Chrome 或 Edge。","error");eF("正在掃描資料夾...","info");let e=await window.showDirectoryPicker(),s=await b(e);if(0===s.length)return void eF("在選擇的資料夾中沒有找到符合命名規則的檔案。","warning");y(s),eF(`掃描完成！找到 ${s.length} 個有效檔案。`,"success")}catch(e){"AbortError"!==e.name&&eF(`選擇資料夾時發生錯誤: ${e.message}`,"error")}},eD=async()=>{var e;if(0===p.length)return;if(!ec)return void eF("請先確認資料庫連線成功。","error");g(!0);let s=Math.max(1,Math.min(U||500,5e3)),t=Math.max(1,Math.min(K||200,5e3));e={detailLimit:t},e?.detailLimit!==void 0&&(S=Math.max(1,Math.min(e.detailLimit,5e3))),w=new Set,N=new Map,v=new Set,k=new Set,$=new Set,_={new:0,updated:0,identical:0,subAdded:0,errors:0,warnings:0,newRecords:[],updatedRecords:[],identicalRecords:[],errorFiles:[],warningRecords:[],detailLimit:S,detailTruncated:{new:0,updated:0,identical:0,errors:0,warnings:0}},u([]),D(null),eF("開始上傳任務...","info");let a={chunkSize:s,detailLimit:t},r=p;if("all"!==C&&(r=p.filter(e=>e.tableType.startsWith(C))),0===r.length){eF(`找不到符合「${{all:"全選",a:"中古",b:"預售",c:"租賃"}[C]}」類型的檔案...`,"warning"),g(!1);return}let l=[...r.filter(e=>e.isMain)].sort((e,s)=>(s.sourcePriority||0)-(e.sourcePriority||0)),d=[...r.filter(e=>!e.isMain)].sort((e,s)=>(s.sourcePriority||0)-(e.sourcePriority||0));eF(`--- 階段 1: 主表 (智慧更新) ---`,"info");for(let e=0;e<l.length;e++){let s=l[e];T(s.fullPath),F(Math.round(e/l.length*100)),await E(s,eF,a)}eF(`--- 階段 2: 附表 (智慧連動) ---`,"info");for(let e=0;e<d.length;e++){let s=d[e];T(s.fullPath),F(Math.round(e/d.length*100)),await L(s,eF,a)}T(""),F(100),await R("recent",eF);let c=_;D(c),eF(`所有檔案處理完成！新增: ${c.new}, 更新: ${c.updated}, 錯誤: ${c.errors}`,"success"),g(!1)},eU=async()=>{if(!es){et(!0);try{await R("all",eF);let e=_;D({...e})}catch(e){eF(`全庫車位數檢查失敗: ${e.message}`,"error")}finally{et(!1)}}},eW=async()=>{if(!ea||!el)return void eF("請先填寫資料庫連線資訊 (URL & Key)","error");if(!eu.trim())return void eF("請輸入搜尋關鍵字","warning");eC(!0),u([]),eF(`正在搜尋: ${o[en.toUpperCase()]} ${ex} ${em} containing "${eu}"...`,"info");try{let e=await W(en,ex,em,eu.trim(),{url:ea,key:el});e.success&&e.data?(eb(e.data),eE({tableName:e.tableName,city:o[en.toUpperCase()]}),ey(!0),eN(new Set),eF(`搜尋完成，找到 ${e.data.length} 筆資料`,"success")):eF(`搜尋失敗: ${e.error}`,"error")}catch(e){eF(`搜尋發生錯誤: ${e.message}`,"error")}finally{eC(!1)}},eV=async()=>{if(!ez||0===ew.size)return;let e=null,s=null;if("建案名稱"===ev){let t=Array.from(ew)[0],a=eg.find(e=>e["編號"]===t);a&&(e=a["建案名稱"],s=a["行政區"])}eP(!0),eF(`開始批次更新 ${ew.size} 筆資料...`,"info");try{let t=await V(ez.tableName,Array.from(ew),ev,e$,e,s,ez.city,{url:ea,key:el});t.success?(eF(`成功更新 ${t.count} 筆資料！`,"success"),ey(!1)):eF(`批次更新失敗: ${t.error}`,"error")}catch(e){eF(`批次更新發生錯誤: ${e.message}`,"error")}finally{eP(!1)}},eB=e=>{let s=new Set(ew);s.has(e)?s.delete(e):s.add(e),eN(s)},eJ=()=>{ew.size===eg.length?eN(new Set):eN(new Set(eg.map(e=>e["編號"])))},eq=e=>{let s=new Set(eL);s.has(e)?s.delete(e):s.add(e),eT(s)};(0,d.useEffect)(()=>{X&&ee(1)},[X,G]);let eK=A&&X?"new"===X?{title:"新增明細",items:A.newRecords,truncated:A.detailTruncated.new}:"updated"===X?{title:"更新/搜尋明細",items:A.updatedRecords,truncated:A.detailTruncated.updated}:"identical"===X?{title:"跳過明細",items:A.identicalRecords,truncated:A.detailTruncated.identical}:"warnings"===X?{title:"警告明細",items:A.warningRecords,truncated:A.detailTruncated.warnings}:{title:"錯誤檔案",items:A.errorFiles,truncated:A.detailTruncated.errors}:null,eH=eK?(e=eK.items.length,n=Math.min((i=((r=Math.min(Z,t=Math.max(1,Math.ceil(e/(s=Math.max(1,Math.min(G||50,A?.detailLimit||G)))))))-1)*s)+s,e),{total:e,pageSize:s,totalPages:t,currentPage:r,startIndex:i,endIndex:n}):null;return m||(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 min-h-screen bg-dark-bg text-gray-100 p-8 font-sans",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 max-w-7xl mx-auto space-y-8",children:[(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 flex justify-between items-center bg-dark-card p-6 rounded-xl border border-gray-700 shadow-lg",children:(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 flex items-center gap-4",children:[(0,a.jsx)("button",{onClick:()=>f.push("/dashboard"),className:"jsx-4f044084e7cd90f7 text-zinc-400 hover:text-white transition-colors",children:(0,a.jsx)(q.A,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsxs)("h1",{className:"jsx-4f044084e7cd90f7 text-3xl font-extrabold text-white tracking-tight",children:["平米內參 ",(0,a.jsx)("span",{className:"jsx-4f044084e7cd90f7 text-amber-400",children:"資料上傳工具"})]}),(0,a.jsx)("p",{className:"jsx-4f044084e7cd90f7 text-gray-400 mt-2 text-sm",children:"高效能、智慧化的實價登錄資料批次處理系統 v2.0 (Next.js)"})]})]})}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 space-y-6",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 bg-dark-card p-6 rounded-xl border border-gray-700 shadow-lg",children:[(0,a.jsxs)("h2",{className:"jsx-4f044084e7cd90f7 text-xl font-bold text-white mb-4 flex items-center",children:[(0,a.jsx)("span",{className:"jsx-4f044084e7cd90f7 bg-amber-900 text-amber-400 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm",children:"1"}),"資料庫連線"]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 space-y-4",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("label",{className:"jsx-4f044084e7cd90f7 block text-sm font-medium text-gray-400 mb-1",children:"Supabase URL"}),(0,a.jsx)("input",{type:"text",value:ea,onChange:e=>er(e.target.value),placeholder:"https://xyz.supabase.co",className:"jsx-4f044084e7cd90f7 w-full bg-gray-800 border-gray-600 rounded-lg px-3 py-2 text-white focus:ring-amber-500 focus:border-amber-500 placeholder-gray-600"})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("label",{className:"jsx-4f044084e7cd90f7 block text-sm font-medium text-gray-400 mb-1",children:"Service Role Key"}),(0,a.jsx)("input",{type:"password",value:el,onChange:e=>ed(e.target.value),placeholder:"eyJhhGciOiJIUzI1NiIsInR5cCI...",className:"jsx-4f044084e7cd90f7 w-full bg-gray-800 border-gray-600 rounded-lg px-3 py-2 text-white focus:ring-amber-500 focus:border-amber-500 placeholder-gray-600"})]}),(0,a.jsx)("button",{onClick:eA,className:`jsx-4f044084e7cd90f7 w-full font-bold py-2 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 ${ec?"bg-green-600 hover:bg-green-500 text-white cursor-default":"bg-gray-700 hover:bg-gray-600 text-white"}`,children:ec?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("i",{className:"jsx-4f044084e7cd90f7 fas fa-check"})," 連線成功"]}):"測試連線"})]})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 bg-dark-card p-6 rounded-xl border border-gray-700 shadow-lg",children:[(0,a.jsxs)("h2",{className:"jsx-4f044084e7cd90f7 text-xl font-bold text-white mb-4 flex items-center",children:[(0,a.jsx)("span",{className:"jsx-4f044084e7cd90f7 bg-amber-900 text-amber-400 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm",children:"2"}),"選擇資料來源"]}),(0,a.jsxs)("button",{onClick:eO,disabled:j,className:"jsx-4f044084e7cd90f7 w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[(0,a.jsx)("i",{className:"jsx-4f044084e7cd90f7 fas fa-folder-open text-xl"})," 選擇 lvr_land 資料夾"]}),p.length>0&&(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 mt-4 p-3 bg-gray-800/50 rounded-lg text-sm",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 flex justify-between text-gray-300 mb-1",children:[(0,a.jsx)("span",{className:"jsx-4f044084e7cd90f7",children:"已找到檔案:"}),(0,a.jsxs)("span",{className:"jsx-4f044084e7cd90f7 font-bold text-white",children:[p.length," 個"]})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 flex justify-between text-gray-400 text-xs",children:[(0,a.jsx)("span",{className:"jsx-4f044084e7cd90f7",children:"主表 (Main):"}),(0,a.jsx)("span",{className:"jsx-4f044084e7cd90f7",children:p.filter(e=>e.isMain).length})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 flex justify-between text-gray-400 text-xs",children:[(0,a.jsx)("span",{className:"jsx-4f044084e7cd90f7",children:"附表 (Sub):"}),(0,a.jsx)("span",{className:"jsx-4f044084e7cd90f7",children:p.filter(e=>!e.isMain).length})]})]})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 bg-dark-card p-6 rounded-xl border border-gray-700 shadow-lg",children:[(0,a.jsxs)("h2",{className:"jsx-4f044084e7cd90f7 text-xl font-bold text-white mb-4 flex items-center",children:[(0,a.jsx)("span",{className:"jsx-4f044084e7cd90f7 bg-amber-900 text-amber-400 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm",children:"3"}),"開始處理"]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 space-y-4",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("label",{className:"jsx-4f044084e7cd90f7 block text-sm font-medium text-gray-400 mb-1",children:"上傳批次筆數"}),(0,a.jsx)("input",{type:"number",min:1,max:5e3,value:U,onChange:e=>B(Number(e.target.value)),className:"jsx-4f044084e7cd90f7 w-full bg-gray-800 border-gray-600 rounded-lg px-3 py-2 text-white focus:ring-amber-500 focus:border-amber-500"})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("label",{className:"jsx-4f044084e7cd90f7 block text-sm font-medium text-gray-400 mb-1",children:"明細保留筆數"}),(0,a.jsx)("input",{type:"number",min:1,max:5e3,value:K,onChange:e=>H(Number(e.target.value)),className:"jsx-4f044084e7cd90f7 w-full bg-gray-800 border-gray-600 rounded-lg px-3 py-2 text-white focus:ring-amber-500 focus:border-amber-500"})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("label",{className:"jsx-4f044084e7cd90f7 block text-sm font-medium text-gray-400 mb-1",children:"明細每頁筆數"}),(0,a.jsx)("input",{type:"number",min:1,max:5e3,value:G,onChange:e=>Q(Number(e.target.value)),className:"jsx-4f044084e7cd90f7 w-full bg-gray-800 border-gray-600 rounded-lg px-3 py-2 text-white focus:ring-amber-500 focus:border-amber-500"})]}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 md:col-span-2 text-xs text-gray-500",children:"上傳批次預設 500；明細保留筆數預設 200；每頁顯示預設 50，上限 5000。"})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("label",{className:"jsx-4f044084e7cd90f7 block text-sm font-medium text-gray-400 mb-2",children:"上傳類型"}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 grid grid-cols-2 gap-2",children:["all","a","b","c"].map(e=>(0,a.jsxs)("label",{className:`jsx-4f044084e7cd90f7 cursor-pointer border rounded-lg p-2 text-center transition-all ${C===e?"bg-amber-900/30 border-amber-500 text-amber-400":"bg-gray-800 border-gray-700 text-gray-400 hover:border-gray-500"}`,children:[(0,a.jsx)("input",{type:"radio",name:"uploadType",value:e,checked:C===e,onChange:e=>M(e.target.value),disabled:j,className:"jsx-4f044084e7cd90f7 sr-only"}),(0,a.jsx)("span",{className:"jsx-4f044084e7cd90f7 font-bold",children:"all"===e?"全部":"a"===e?"中古":"b"===e?"預售":"租賃"})]},e))})]}),(0,a.jsxs)("button",{onClick:eD,disabled:!ec||0===p.length||j,className:"jsx-4f044084e7cd90f7 w-full bg-gradient-to-r from-amber-600 to-blue-600 hover:from-amber-500 hover:to-blue-500 text-white font-bold py-3 px-4 rounded-lg shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[j?(0,a.jsx)("i",{className:"jsx-4f044084e7cd90f7 fas fa-spinner fa-spin"}):(0,a.jsx)("i",{className:"jsx-4f044084e7cd90f7 fas fa-rocket"}),j?"處理中...":"開始上傳"]})]})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 bg-dark-card p-6 rounded-xl border border-gray-700 shadow-lg",children:[(0,a.jsxs)("h2",{className:"jsx-4f044084e7cd90f7 text-xl font-bold text-white mb-4 flex items-center",children:[(0,a.jsx)("span",{className:"jsx-4f044084e7cd90f7 bg-amber-900 text-amber-400 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm",children:"4"}),"資料批次修改 (獨立功能)"]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 space-y-4",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("label",{className:"jsx-4f044084e7cd90f7 block text-sm font-medium text-gray-400 mb-1",children:"選擇縣市"}),(0,a.jsx)("select",{value:en,onChange:e=>eo(e.target.value),className:"jsx-4f044084e7cd90f7 w-full bg-gray-800 border-gray-600 rounded-lg px-3 py-2 text-white focus:ring-amber-500 focus:border-amber-500",children:Object.entries(o).map(([e,s])=>(0,a.jsx)("option",{value:e.toLowerCase(),className:"jsx-4f044084e7cd90f7",children:s},e))})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("label",{className:"jsx-4f044084e7cd90f7 block text-sm font-medium text-gray-400 mb-2",children:"交易類型"}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 grid grid-cols-2 gap-2",children:["a","b","c"].map(e=>(0,a.jsxs)("label",{className:`jsx-4f044084e7cd90f7 cursor-pointer border rounded-lg p-2 text-center transition-all ${ex===e?"bg-amber-900/30 border-amber-500 text-amber-400":"bg-gray-800 border-gray-700 text-gray-400 hover:border-gray-500"}`,children:[(0,a.jsx)("input",{type:"radio",name:"updateType",value:e,checked:ex===e,onChange:e=>ef(e.target.value),disabled:e_,className:"jsx-4f044084e7cd90f7 sr-only"}),(0,a.jsx)("span",{className:"jsx-4f044084e7cd90f7 font-bold",children:"a"===e?"中古":"b"===e?"預售":"租賃"})]},e))})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("label",{className:"jsx-4f044084e7cd90f7 block text-sm font-medium text-gray-400 mb-1",children:"搜尋欄位"}),(0,a.jsxs)("select",{value:em,onChange:e=>eh(e.target.value),className:"jsx-4f044084e7cd90f7 w-full bg-gray-800 border-gray-600 rounded-lg px-3 py-2 text-white focus:ring-amber-500 focus:border-amber-500",children:[Array.from(new Set(Object.values(x[ex]||{}))).filter(e=>!["編號","id"].includes(e)).sort().map(e=>(0,a.jsx)("option",{value:e,className:"jsx-4f044084e7cd90f7",children:e},e)),(0,a.jsx)("option",{value:"編號",className:"jsx-4f044084e7cd90f7",children:"編號"})]})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("label",{className:"jsx-4f044084e7cd90f7 block text-sm font-medium text-gray-400 mb-1",children:"關鍵字"}),(0,a.jsx)("input",{type:"text",value:eu,onChange:e=>ej(e.target.value),placeholder:"輸入關鍵字...",autoComplete:"off",className:"jsx-4f044084e7cd90f7 w-full bg-gray-800 border-gray-600 rounded-lg px-3 py-2 text-white focus:ring-amber-500 focus:border-amber-500 placeholder-gray-600"})]}),(0,a.jsxs)("button",{onClick:eW,disabled:!ec||e_,className:"jsx-4f044084e7cd90f7 w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 disabled:opacity-50",children:[e_?(0,a.jsx)("i",{className:"jsx-4f044084e7cd90f7 fas fa-spinner fa-spin"}):(0,a.jsx)("i",{className:"jsx-4f044084e7cd90f7 fas fa-search"}),e_?"搜尋中...":"搜尋資料"]})]})]})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 lg:col-span-2 space-y-6",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 bg-dark-card p-6 rounded-xl border border-gray-700 shadow-lg",children:[(0,a.jsxs)("h3",{className:"jsx-4f044084e7cd90f7 text-gray-300 font-bold mb-4 flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("i",{className:"jsx-4f044084e7cd90f7 fas fa-tasks mr-2 text-purple-400"}),"執行進度"]}),j&&(0,a.jsxs)("span",{className:"jsx-4f044084e7cd90f7 text-amber-400",children:[I,"%"]})]}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 w-full bg-gray-700 rounded-full h-4 mb-2 overflow-hidden",children:(0,a.jsx)("div",{style:{width:`${I}%`},className:"jsx-4f044084e7cd90f7 bg-gradient-to-r from-amber-500 to-purple-500 h-4 rounded-full transition-all duration-300 relative",children:j&&(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 absolute inset-0 bg-white/20 animate-pulse"})})}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-xs text-gray-500 h-5",children:P&&`正在處理: ${P}`})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 bg-black/60 p-4 rounded-xl border border-gray-800 h-[500px] overflow-hidden flex flex-col font-mono text-sm shadow-inner",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 flex justify-between items-center mb-2 border-b border-gray-800 pb-2",children:[(0,a.jsxs)("span",{className:"jsx-4f044084e7cd90f7 text-gray-400 font-bold",children:[(0,a.jsx)("i",{className:"jsx-4f044084e7cd90f7 fas fa-terminal mr-2"}),"系統日誌"]}),(0,a.jsx)("button",{onClick:()=>u([]),className:"jsx-4f044084e7cd90f7 text-xs text-gray-600 hover:text-gray-300 transition-colors",children:"清除"})]}),(0,a.jsxs)("div",{ref:e=>{e&&(e.scrollTop=e.scrollHeight)},className:"jsx-4f044084e7cd90f7 flex-1 overflow-y-auto space-y-1 p-2 custom-scrollbar",children:[h.map(e=>(0,a.jsxs)("div",{className:`jsx-4f044084e7cd90f7 flex gap-3 leading-relaxed border-b border-white/5 pb-1 ${"error"===e.type?"text-red-400 bg-red-900/10":"warning"===e.type?"text-yellow-400":"success"===e.type?"text-emerald-400":"text-gray-300"}`,children:[(0,a.jsxs)("span",{className:"jsx-4f044084e7cd90f7 text-gray-600 select-none",children:["[",e.time,"]"]}),(0,a.jsx)("span",{className:"jsx-4f044084e7cd90f7 break-all",children:e.text})]},e.id)),0===h.length&&(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-gray-700 italic text-center mt-20",children:"等待任務啟動..."})]})]}),A&&(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 bg-emerald-900/20 border border-emerald-800 p-4 rounded-xl text-center",children:[(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-3xl font-bold text-emerald-400",children:A.new}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-sm text-emerald-200/70 uppercase tracking-wider mt-1",children:"New"})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 bg-yellow-900/20 border border-yellow-800 p-4 rounded-xl text-center",children:[(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-3xl font-bold text-yellow-400",children:A.updated}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-sm text-yellow-200/70 uppercase tracking-wider mt-1",children:"Updated"})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 bg-gray-800/40 border border-gray-700 p-4 rounded-xl text-center",children:[(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-3xl font-bold text-gray-400",children:A.identical}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-sm text-gray-500 uppercase tracking-wider mt-1",children:"Skipped"})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 bg-red-900/20 border border-red-800 p-4 rounded-xl text-center",children:[(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-3xl font-bold text-red-400",children:A.errors}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-sm text-red-200/70 uppercase tracking-wider mt-1",children:"Errors"})]})]}),A&&(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 flex flex-wrap gap-2",children:[(0,a.jsxs)("button",{onClick:()=>Y("new"),className:"jsx-4f044084e7cd90f7 px-3 py-2 rounded-lg border border-emerald-700 text-emerald-300 hover:bg-emerald-900/30 transition-colors text-sm",children:["新增明細 (",A.newRecords.length,")"]}),(0,a.jsxs)("button",{onClick:()=>Y("updated"),className:"jsx-4f044084e7cd90f7 px-3 py-2 rounded-lg border border-yellow-700 text-yellow-300 hover:bg-yellow-900/30 transition-colors text-sm",children:["更新/搜尋明細 (",A.updatedRecords.length,")"]}),(0,a.jsxs)("button",{onClick:()=>Y("identical"),className:"jsx-4f044084e7cd90f7 px-3 py-2 rounded-lg border border-gray-700 text-gray-300 hover:bg-gray-800/60 transition-colors text-sm",children:["跳過明細 (",A.identicalRecords.length,")"]}),(0,a.jsxs)("button",{onClick:()=>Y("errors"),className:"jsx-4f044084e7cd90f7 px-3 py-2 rounded-lg border border-red-700 text-red-300 hover:bg-red-900/30 transition-colors text-sm",children:["錯誤檔案 (",A.errorFiles.length,")"]}),(0,a.jsxs)("button",{onClick:()=>Y("warnings"),className:"jsx-4f044084e7cd90f7 px-3 py-2 rounded-lg border border-amber-700 text-amber-300 hover:bg-amber-900/30 transition-colors text-sm",children:["警告明細 (",A.warningRecords.length,")"]}),(0,a.jsx)("button",{onClick:eU,disabled:es||j,className:"jsx-4f044084e7cd90f7 px-3 py-2 rounded-lg border border-blue-700 text-blue-300 hover:bg-blue-900/30 transition-colors text-sm disabled:opacity-50",children:es?"全庫檢查中...":"全庫車位數檢查"}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 text-xs text-gray-500 flex items-center",children:["明細上限 ",A.detailLimit," 筆"]})]})]})]})]}),eK&&(0,a.jsx)("div",{onClick:()=>Y(null),className:"jsx-4f044084e7cd90f7 fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4",children:(0,a.jsxs)("div",{onClick:e=>e.stopPropagation(),className:"jsx-4f044084e7cd90f7 bg-dark-bg border border-gray-700 rounded-xl w-full max-w-6xl max-h-[90vh] flex flex-col shadow-2xl",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 p-4 border-b border-gray-700 flex justify-between items-center bg-dark-card rounded-t-xl",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("h3",{className:"jsx-4f044084e7cd90f7 text-xl font-bold text-white",children:eK.title}),(0,a.jsxs)("p",{className:"jsx-4f044084e7cd90f7 text-sm text-gray-400 mt-1",children:["顯示 ",eH?.startIndex!==void 0?`${eH.startIndex+1}-${eH.endIndex}`:eK.items.length," / ",eK.items.length," 筆",A&&`（保留上限 ${A.detailLimit}）`,eK.truncated>0&&`，超出未顯示 ${eK.truncated} 筆`]})]}),(0,a.jsx)("button",{onClick:()=>Y(null),className:"jsx-4f044084e7cd90f7 text-gray-400 hover:text-white transition-colors",children:(0,a.jsx)("i",{className:"jsx-4f044084e7cd90f7 fas fa-times text-xl"})})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 p-4 border-b border-gray-700 flex items-center justify-between text-sm text-gray-400",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:["每頁 ",eH?.pageSize??G," 筆"]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>ee(Math.max(1,(eH?.currentPage||1)-1)),disabled:1>=(eH?.currentPage||1),className:"jsx-4f044084e7cd90f7 px-2 py-1 rounded border border-gray-700 text-gray-300 hover:bg-gray-800 disabled:opacity-40",children:"上一頁"}),(0,a.jsxs)("span",{className:"jsx-4f044084e7cd90f7",children:[eH?.currentPage||1," / ",eH?.totalPages||1]}),(0,a.jsx)("button",{onClick:()=>ee(Math.min(eH?.totalPages||1,(eH?.currentPage||1)+1)),disabled:(eH?.currentPage||1)>=(eH?.totalPages||1),className:"jsx-4f044084e7cd90f7 px-2 py-1 rounded border border-gray-700 text-gray-300 hover:bg-gray-800 disabled:opacity-40",children:"下一頁"})]})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 p-4 overflow-y-auto space-y-3",children:["updated"===X&&eK.items.slice(eH?.startIndex||0,eH?.endIndex||eK.items.length).map((e,s)=>(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 bg-gray-900/60 border border-gray-700 rounded-lg p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 flex flex-wrap items-center justify-between gap-2",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 text-sm text-gray-200",children:[(0,a.jsx)("span",{className:"jsx-4f044084e7cd90f7 text-gray-400",children:"編號:"})," ",e.id||e?.newData?.["編號"]||"-"]}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-xs text-gray-500 break-all",children:e.file})]}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-xs text-amber-300",children:"priority"===e.reason?"更新原因：來源優先級較高 (edit > list > opendata)":"更新原因：欄位內容不同"}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 space-y-2",children:[(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-xs uppercase tracking-wider text-gray-400",children:"欄位差異"}),e.diffFields&&e.diffFields.length>0?(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 space-y-2",children:e.diffFields.map((e,s)=>(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 text-xs text-gray-200 grid grid-cols-1 md:grid-cols-3 gap-2 bg-gray-800/60 p-2 rounded",children:[(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-gray-300",children:e.field}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 text-red-300 break-all",children:["舊: ",String(e.oldValue??"")]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 text-emerald-300 break-all",children:["新: ",String(e.newValue??"")]})]},s))}):(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-xs text-gray-500",children:"沒有可比對的欄位差異"})]}),(0,a.jsxs)("details",{className:"jsx-4f044084e7cd90f7 text-xs text-gray-400",children:[(0,a.jsx)("summary",{className:"jsx-4f044084e7cd90f7 cursor-pointer select-none",children:"查看完整舊/新資料"}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 grid grid-cols-1 md:grid-cols-2 gap-4 mt-3",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-xs uppercase tracking-wider text-gray-400 mb-2",children:"舊資料"}),(0,a.jsx)("pre",{className:"jsx-4f044084e7cd90f7 text-xs text-gray-200 whitespace-pre-wrap break-all",children:JSON.stringify(e.oldData,null,2)})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-xs uppercase tracking-wider text-gray-400 mb-2",children:"新資料"}),(0,a.jsx)("pre",{className:"jsx-4f044084e7cd90f7 text-xs text-gray-200 whitespace-pre-wrap break-all",children:JSON.stringify(e.newData,null,2)})]})]})]})]},s)),"new"===X&&eK.items.slice(eH?.startIndex||0,eH?.endIndex||eK.items.length).map((e,s)=>(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 bg-gray-900/60 border border-gray-700 rounded-lg p-4",children:(0,a.jsx)("pre",{className:"jsx-4f044084e7cd90f7 text-xs text-gray-200 whitespace-pre-wrap break-all",children:JSON.stringify(e,null,2)})},s)),"identical"===X&&eK.items.slice(eH?.startIndex||0,eH?.endIndex||eK.items.length).map((e,s)=>(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 bg-gray-900/60 border border-gray-700 rounded-lg p-4",children:(0,a.jsx)("pre",{className:"jsx-4f044084e7cd90f7 text-xs text-gray-200 whitespace-pre-wrap break-all",children:JSON.stringify(e,null,2)})},s)),"errors"===X&&eK.items.slice(eH?.startIndex||0,eH?.endIndex||eK.items.length).map((e,s)=>(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 bg-red-900/20 border border-red-800 rounded-lg p-4",children:[(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-sm text-red-200 font-semibold",children:e.file}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-xs text-red-300 mt-1 break-all",children:e.message})]},s)),"warnings"===X&&eK.items.slice(eH?.startIndex||0,eH?.endIndex||eK.items.length).map((e,s)=>(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 bg-amber-900/20 border border-amber-800 rounded-lg p-4 space-y-2",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 text-[11px] text-amber-300/70",children:["來源: ","audit"===e.stage?"最終檢查":"上傳警告"]}),e.file&&(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-xs text-amber-200 break-all",children:e.file}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 text-sm text-amber-100 font-semibold",children:["編號: ",e.id||"-"]}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-xs text-amber-200 break-all",children:e.message}),e.table&&(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-[11px] text-amber-300/70",children:e.table})]},s)),0===eK.items.length&&(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-sm text-gray-500 text-center py-10",children:"目前沒有可顯示的明細"})]}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 p-4 border-t border-gray-700 flex justify-end bg-dark-card rounded-b-xl",children:(0,a.jsx)("button",{onClick:()=>Y(null),className:"jsx-4f044084e7cd90f7 px-4 py-2 rounded-lg border border-gray-700 text-gray-300 hover:bg-gray-800 transition-colors",children:"關閉"})})]})}),ep&&(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4",children:(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 bg-dark-bg border border-gray-700 rounded-xl w-full max-w-6xl max-h-[90vh] flex flex-col shadow-2xl",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 p-4 border-b border-gray-700 flex justify-between items-center bg-dark-card rounded-t-xl",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("h3",{className:"jsx-4f044084e7cd90f7 text-xl font-bold text-white",children:"批次修改搜尋結果"}),(0,a.jsxs)("p",{className:"jsx-4f044084e7cd90f7 text-sm text-gray-400 mt-1",children:["資料表: ",ez?.tableName," | 搜尋條件: ",o[en.toUpperCase()]," ",em," like '%",eu,"%' | 共 ",eg.length," 筆"]})]}),(0,a.jsx)("button",{onClick:()=>ey(!1),className:"jsx-4f044084e7cd90f7 text-gray-400 hover:text-white transition-colors",children:(0,a.jsx)("i",{className:"jsx-4f044084e7cd90f7 fas fa-times text-xl"})})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 p-4 border-b border-gray-700 bg-gray-800/50 flex gap-4 items-end flex-wrap",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 flex items-center gap-2 text-sm text-gray-300",children:[(0,a.jsx)("input",{type:"checkbox",checked:ew.size>0&&ew.size===eg.length,onChange:eJ,className:"jsx-4f044084e7cd90f7 form-checkbox h-5 w-5 text-amber-600 bg-gray-700 border-gray-600 rounded"}),(0,a.jsxs)("span",{className:"jsx-4f044084e7cd90f7",children:["全選 (",ew.size," 筆)"]})]}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 flex-1"}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 flex gap-2 items-center",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("label",{className:"jsx-4f044084e7cd90f7 block text-xs text-gray-400 mb-1",children:"欲修改欄位"}),(0,a.jsx)("select",{value:ev,onChange:e=>ek(e.target.value),className:"jsx-4f044084e7cd90f7 bg-gray-800 border-gray-600 rounded px-3 py-1.5 text-sm text-white focus:ring-amber-500",children:Array.from(new Set(Object.values(x[ex]||{}))).filter(e=>!["編號","id"].includes(e)).sort().map(e=>(0,a.jsx)("option",{value:e,className:"jsx-4f044084e7cd90f7",children:e},e))})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("label",{className:"jsx-4f044084e7cd90f7 block text-xs text-gray-400 mb-1",children:"新數值"}),(0,a.jsx)("input",{type:"text",value:e$,onChange:e=>eS(e.target.value),placeholder:"輸入新內容...",className:"jsx-4f044084e7cd90f7 bg-gray-800 border-gray-600 rounded px-3 py-1.5 text-sm text-white w-48 focus:ring-amber-500"})]}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 pb-0.5",children:(0,a.jsx)("button",{onClick:eV,disabled:0===ew.size||eM,className:"jsx-4f044084e7cd90f7 bg-red-600 hover:bg-red-500 text-white font-bold py-1.5 px-4 rounded transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed h-[34px]",children:eM?"更新中...":"執行批次更新"})})]})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 flex-1 overflow-auto px-0 pb-4 pt-0 custom-scrollbar",children:[(0,a.jsxs)("table",{className:"jsx-4f044084e7cd90f7 w-full text-left border-collapse table-fixed",children:[(0,a.jsxs)("colgroup",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("col",{className:"jsx-4f044084e7cd90f7 w-12"}),(0,a.jsx)("col",{className:"jsx-4f044084e7cd90f7 w-64"}),(0,a.jsx)("col",{className:"jsx-4f044084e7cd90f7 w-24"}),(0,a.jsx)("col",{className:"jsx-4f044084e7cd90f7 w-56"}),(0,a.jsx)("col",{className:"jsx-4f044084e7cd90f7"}),(0,a.jsx)("col",{className:"jsx-4f044084e7cd90f7 w-16"})]}),(0,a.jsx)("thead",{className:"jsx-4f044084e7cd90f7 bg-gray-900 sticky top-0 z-10 backdrop-blur",children:(0,a.jsxs)("tr",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("th",{className:"jsx-4f044084e7cd90f7 p-3 text-xs font-bold text-gray-400 border-b border-gray-700 whitespace-nowrap",children:"選取"}),(0,a.jsx)("th",{className:"jsx-4f044084e7cd90f7 p-3 text-xs font-bold text-gray-400 border-b border-gray-700 whitespace-nowrap",children:"編號"}),(0,a.jsx)("th",{className:"jsx-4f044084e7cd90f7 p-3 text-xs font-bold text-gray-400 border-b border-gray-700 whitespace-nowrap",children:"行政區"}),(0,a.jsx)("th",{className:"jsx-4f044084e7cd90f7 p-3 text-xs font-bold text-gray-400 border-b border-gray-700 whitespace-nowrap",children:"建案名稱"}),(0,a.jsx)("th",{className:"jsx-4f044084e7cd90f7 p-3 text-xs font-bold text-gray-400 border-b border-gray-700 whitespace-nowrap",children:"地址/位置"}),(0,a.jsx)("th",{className:"jsx-4f044084e7cd90f7 p-3 text-xs font-bold text-gray-400 border-b border-gray-700 whitespace-nowrap",children:"操作"})]})}),(0,a.jsx)("tbody",{className:"jsx-4f044084e7cd90f7 text-sm",children:eg.map((e,s)=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("tr",{className:"jsx-4f044084e7cd90f7 hover:bg-white/5 border-b border-gray-800",children:[(0,a.jsx)("td",{className:"jsx-4f044084e7cd90f7 p-3",children:(0,a.jsx)("input",{type:"checkbox",checked:ew.has(e["編號"]),onChange:()=>eB(e["編號"]),className:"jsx-4f044084e7cd90f7 form-checkbox h-4 w-4 text-amber-600 bg-gray-700 border-gray-600 rounded"})}),(0,a.jsx)("td",{className:"jsx-4f044084e7cd90f7 p-3 font-mono text-xs text-gray-400 break-all",children:e["編號"]}),(0,a.jsx)("td",{className:"jsx-4f044084e7cd90f7 p-3 whitespace-nowrap",children:e["行政區"]}),(0,a.jsx)("td",{className:"jsx-4f044084e7cd90f7 p-3 text-amber-300 truncate",children:e["建案名稱"]}),(0,a.jsx)("td",{className:"jsx-4f044084e7cd90f7 p-3 text-gray-400 truncate",children:e["其他門牌"]||e["地址"]||e["土地位置建物門牌"]}),(0,a.jsx)("td",{className:"jsx-4f044084e7cd90f7 p-3",children:(0,a.jsx)("button",{onClick:()=>eq(s),className:"jsx-4f044084e7cd90f7 text-gray-500 hover:text-white text-xs underline",children:eL.has(s)?"收合":"明細"})})]},e["編號"]),eL.has(s)&&(0,a.jsx)("tr",{className:"jsx-4f044084e7cd90f7 bg-gray-900/50",children:(0,a.jsx)("td",{colSpan:6,className:"jsx-4f044084e7cd90f7 p-4 border-b border-gray-800",children:(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 grid grid-cols-2 md:grid-cols-4 gap-4 text-xs",children:Object.entries(e).filter(([e])=>"id"!==e).map(([e,s])=>(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-gray-500 mb-1",children:e}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-gray-300 break-all",children:String(s)})]},e))})})})]}))})]}),0===eg.length&&(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-center py-20 text-gray-500",children:"無符合資料"})]})]})}),ep&&(0,a.jsx)("div",{onClick:()=>ey(!1),className:"jsx-4f044084e7cd90f7 fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 transition-opacity animate-in fade-in duration-200",children:(0,a.jsxs)("div",{onClick:e=>e.stopPropagation(),className:"jsx-4f044084e7cd90f7 bg-dark-bg border border-gray-700 rounded-xl w-full max-w-6xl max-h-[90vh] flex flex-col shadow-2xl relative",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 p-4 border-b border-gray-700 flex justify-between items-center bg-dark-card rounded-t-xl",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("h3",{className:"jsx-4f044084e7cd90f7 text-xl font-bold text-white",children:"批次修改搜尋結果"}),(0,a.jsxs)("p",{className:"jsx-4f044084e7cd90f7 text-sm text-gray-400 mt-1",children:["資料表: ",ez?.tableName," | 搜尋條件: ",o[en.toUpperCase()]," ",em," like '%",eu,"%' | 共 ",eg.length," 筆"]})]}),(0,a.jsx)("button",{onClick:()=>ey(!1),title:"關閉視窗 (Esc)",className:"jsx-4f044084e7cd90f7 text-gray-400 hover:text-white hover:bg-gray-700/50 p-2 rounded-full transition-colors flex items-center justify-center w-8 h-8",children:(0,a.jsx)("i",{className:"jsx-4f044084e7cd90f7 fas fa-times text-xl"})})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 bg-dark-card border-b border-gray-700",children:[(0,a.jsxs)("button",{onClick:()=>eI(!eR),className:"jsx-4f044084e7cd90f7 w-full text-center py-2 text-xs text-gray-500 hover:text-white hover:bg-gray-700/50 transition-colors flex items-center justify-center gap-2",children:[(0,a.jsx)("i",{className:`jsx-4f044084e7cd90f7 fas fa-search ${eR?"text-amber-400":""}`}),eR?"收合搜尋條件":"再次搜尋 / 修改條件"]}),eR&&(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 p-4 grid grid-cols-1 md:grid-cols-5 gap-4 animate-in slide-in-from-top-2 duration-200",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("label",{className:"jsx-4f044084e7cd90f7 block text-xs text-gray-400 mb-1",children:"縣市"}),(0,a.jsx)("select",{value:en,onChange:e=>eo(e.target.value),className:"jsx-4f044084e7cd90f7 w-full bg-gray-800 border-gray-600 rounded px-2 py-1.5 text-sm text-white focus:ring-amber-500",children:Object.entries(o).map(([e,s])=>(0,a.jsx)("option",{value:e.toLowerCase(),className:"jsx-4f044084e7cd90f7",children:s},e))})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("label",{className:"jsx-4f044084e7cd90f7 block text-xs text-gray-400 mb-1",children:"類型"}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 flex bg-gray-800 rounded border border-gray-600 p-0.5",children:["a","b","c"].map(e=>(0,a.jsx)("button",{onClick:()=>ef(e),className:`jsx-4f044084e7cd90f7 flex-1 text-xs py-1 rounded transition-colors ${ex===e?"bg-amber-900 text-amber-400":"text-gray-400 hover:text-white"}`,children:"a"===e?"中古":"b"===e?"預售":"租賃"},e))})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("label",{className:"jsx-4f044084e7cd90f7 block text-xs text-gray-400 mb-1",children:"欄位"}),(0,a.jsxs)("select",{value:em,onChange:e=>eh(e.target.value),className:"jsx-4f044084e7cd90f7 w-full bg-gray-800 border-gray-600 rounded px-2 py-1.5 text-sm text-white focus:ring-amber-500",children:[Array.from(new Set(Object.values(x[ex]||{}))).filter(e=>!["編號","id"].includes(e)).sort().map(e=>(0,a.jsx)("option",{value:e,className:"jsx-4f044084e7cd90f7",children:e},e)),(0,a.jsx)("option",{value:"編號",className:"jsx-4f044084e7cd90f7",children:"編號"})]})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("label",{className:"jsx-4f044084e7cd90f7 block text-xs text-gray-400 mb-1",children:"關鍵字"}),(0,a.jsx)("input",{type:"text",value:eu,onChange:e=>ej(e.target.value),placeholder:"關鍵字...",autoComplete:"off",className:"jsx-4f044084e7cd90f7 w-full bg-gray-800 border-gray-600 rounded px-2 py-1.5 text-sm text-white focus:ring-amber-500"})]}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 flex items-end",children:(0,a.jsxs)("button",{onClick:eW,disabled:e_,className:"jsx-4f044084e7cd90f7 w-full bg-amber-600 hover:bg-amber-500 text-white font-bold py-1.5 px-4 rounded transition-colors text-sm h-[34px] flex items-center justify-center gap-2 disabled:opacity-50",children:[e_?(0,a.jsx)("i",{className:"jsx-4f044084e7cd90f7 fas fa-spinner fa-spin"}):(0,a.jsx)("i",{className:"jsx-4f044084e7cd90f7 fas fa-search"}),"搜尋"]})})]})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 p-4 border-b border-gray-700 bg-gray-800/50 flex gap-4 items-end flex-wrap",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 flex items-center gap-2 text-sm text-gray-300",children:[(0,a.jsx)("input",{type:"checkbox",checked:ew.size>0&&ew.size===eg.length,onChange:eJ,className:"jsx-4f044084e7cd90f7 form-checkbox h-5 w-5 text-amber-600 bg-gray-700 border-gray-600 rounded"}),(0,a.jsxs)("span",{className:"jsx-4f044084e7cd90f7",children:["全選 (",ew.size," 筆)"]})]}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 flex-1"}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 flex gap-2 items-center",children:[(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("label",{className:"jsx-4f044084e7cd90f7 block text-xs text-gray-400 mb-1",children:"欲修改欄位"}),(0,a.jsx)("select",{value:ev,onChange:e=>ek(e.target.value),className:"jsx-4f044084e7cd90f7 bg-gray-800 border-gray-600 rounded px-3 py-1.5 text-sm text-white focus:ring-amber-500",children:Array.from(new Set(Object.values(x[ex]||{}))).filter(e=>!["編號","id"].includes(e)).sort().map(e=>(0,a.jsx)("option",{value:e,className:"jsx-4f044084e7cd90f7",children:e},e))})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("label",{className:"jsx-4f044084e7cd90f7 block text-xs text-gray-400 mb-1",children:"新數值"}),(0,a.jsx)("input",{type:"text",value:e$,onChange:e=>eS(e.target.value),placeholder:"輸入新內容...",className:"jsx-4f044084e7cd90f7 bg-gray-800 border-gray-600 rounded px-3 py-1.5 text-sm text-white w-48 focus:ring-amber-500"})]}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 pb-0.5",children:(0,a.jsx)("button",{onClick:eV,disabled:0===ew.size||eM,className:"jsx-4f044084e7cd90f7 bg-red-600 hover:bg-red-500 text-white font-bold py-1.5 px-4 rounded transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed h-[34px]",children:eM?"更新中...":"執行批次更新"})})]})]}),(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7 flex-1 overflow-auto px-0 pb-4 pt-0 custom-scrollbar",children:[(0,a.jsxs)("table",{className:"jsx-4f044084e7cd90f7 w-full text-left border-collapse table-fixed",children:[(0,a.jsxs)("colgroup",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("col",{className:"jsx-4f044084e7cd90f7 w-12"}),(0,a.jsx)("col",{className:"jsx-4f044084e7cd90f7 w-64"}),(0,a.jsx)("col",{className:"jsx-4f044084e7cd90f7 w-24"}),(0,a.jsx)("col",{className:"jsx-4f044084e7cd90f7 w-56"}),(0,a.jsx)("col",{className:"jsx-4f044084e7cd90f7"}),(0,a.jsx)("col",{className:"jsx-4f044084e7cd90f7 w-16"})]}),(0,a.jsx)("thead",{className:"jsx-4f044084e7cd90f7 bg-gray-900 sticky top-0 z-10 backdrop-blur",children:(0,a.jsxs)("tr",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("th",{className:"jsx-4f044084e7cd90f7 p-3 text-xs font-bold text-gray-400 border-b border-gray-700 whitespace-nowrap",children:"選取"}),(0,a.jsx)("th",{className:"jsx-4f044084e7cd90f7 p-3 text-xs font-bold text-gray-400 border-b border-gray-700 whitespace-nowrap",children:"編號"}),(0,a.jsx)("th",{className:"jsx-4f044084e7cd90f7 p-3 text-xs font-bold text-gray-400 border-b border-gray-700 whitespace-nowrap",children:"行政區"}),(0,a.jsx)("th",{className:"jsx-4f044084e7cd90f7 p-3 text-xs font-bold text-gray-400 border-b border-gray-700 whitespace-nowrap",children:"建案名稱"}),(0,a.jsx)("th",{className:"jsx-4f044084e7cd90f7 p-3 text-xs font-bold text-gray-400 border-b border-gray-700 whitespace-nowrap",children:"地址/位置"}),(0,a.jsx)("th",{className:"jsx-4f044084e7cd90f7 p-3 text-xs font-bold text-gray-400 border-b border-gray-700 whitespace-nowrap",children:"操作"})]})}),(0,a.jsx)("tbody",{className:"jsx-4f044084e7cd90f7 text-sm",children:eg.map((e,s)=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("tr",{className:"jsx-4f044084e7cd90f7 hover:bg-white/5 border-b border-gray-800",children:[(0,a.jsx)("td",{className:"jsx-4f044084e7cd90f7 p-3",children:(0,a.jsx)("input",{type:"checkbox",checked:ew.has(e["編號"]),onChange:()=>eB(e["編號"]),className:"jsx-4f044084e7cd90f7 form-checkbox h-4 w-4 text-amber-600 bg-gray-700 border-gray-600 rounded"})}),(0,a.jsx)("td",{className:"jsx-4f044084e7cd90f7 p-3 font-mono text-xs text-gray-400 break-all",children:e["編號"]}),(0,a.jsx)("td",{className:"jsx-4f044084e7cd90f7 p-3 whitespace-nowrap",children:e["行政區"]}),(0,a.jsx)("td",{className:"jsx-4f044084e7cd90f7 p-3 text-amber-300 truncate",children:e["建案名稱"]}),(0,a.jsx)("td",{className:"jsx-4f044084e7cd90f7 p-3 text-gray-400 truncate",children:e["其他門牌"]||e["地址"]||e["土地位置建物門牌"]}),(0,a.jsx)("td",{className:"jsx-4f044084e7cd90f7 p-3",children:(0,a.jsx)("button",{onClick:()=>eq(s),className:"jsx-4f044084e7cd90f7 text-gray-500 hover:text-white text-xs underline",children:eL.has(s)?"收合":"明細"})})]},e["編號"]),eL.has(s)&&(0,a.jsx)("tr",{className:"jsx-4f044084e7cd90f7 bg-gray-900/50",children:(0,a.jsx)("td",{colSpan:6,className:"jsx-4f044084e7cd90f7 p-4 border-b border-gray-800",children:(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 grid grid-cols-2 md:grid-cols-4 gap-4 text-xs",children:Object.entries(e).filter(([e])=>"id"!==e).map(([e,s])=>(0,a.jsxs)("div",{className:"jsx-4f044084e7cd90f7",children:[(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-gray-500 mb-1",children:e}),(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-gray-300 break-all",children:String(s)})]},e))})})})]}))})]}),0===eg.length&&(0,a.jsx)("div",{className:"jsx-4f044084e7cd90f7 text-center py-20 text-gray-500",children:"無符合資料"})]})]})}),(0,a.jsx)(l(),{id:"4f044084e7cd90f7",children:".custom-scrollbar::-webkit-scrollbar{width:8px}.custom-scrollbar::-webkit-scrollbar-track{background:rgba(0,0,0,.2)}.custom-scrollbar::-webkit-scrollbar-thumb{background:rgba(255,255,255,.1);border-radius:4px}.custom-scrollbar::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,.2)}"})]})}}},e=>{e.O(0,[4764,5969,2903,8962,4670,8441,3794,7358],()=>e(e.s=19246)),_N_E=e.O()}]);