(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3321],{1610:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("building",[["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M9 22v-3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3",key:"cabbwy"}],["rect",{x:"4",y:"2",width:"16",height:"20",rx:"2",key:"1uxh74"}]])},6296:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},9199:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]])},13545:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},14403:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]])},16385:(e,t,s)=>{"use strict";s.d(t,{N:()=>r});var a=s(36228),n=s(55873);let l=n.VI,i=n.m5;l&&i||console.error("Missing Supabase URL or Key");let r=(0,a.UU)(l,i,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}})},20509:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>M});var a=s(95155),n=s(12115),l=s(16385),i=s(73321),r=s(86120),c=s(78340);let d=(0,c.A)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var o=s(53961),x=s(84980),p=s(80723),h=s(6296),u=s(66088),m=s(61878),b=s(50049),g=s(21362),f=s(1610);let j=(0,c.A)("drafting-compass",[["path",{d:"m12.99 6.74 1.93 3.44",key:"iwagvd"}],["path",{d:"M19.136 12a10 10 0 0 1-14.271 0",key:"ppmlo4"}],["path",{d:"m21 21-2.16-3.84",key:"vylbct"}],["path",{d:"m3 21 8.02-14.26",key:"1ssaw4"}],["circle",{cx:"12",cy:"5",r:"2",key:"f1ur92"}]]),y=(0,c.A)("maximize-2",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]]),v=(0,c.A)("circle-parking",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9 17V7h4a3 3 0 0 1 0 6H9",key:"1dfk2c"}]]);var N=s(55243),z=s(95057),w=s(33210),k=s(13545),A=s(8875);let _=[{label:"台北市",code:"a"},{label:"台中市",code:"b"},{label:"基隆市",code:"c"},{label:"台南市",code:"d"},{label:"高雄市",code:"e"},{label:"新北市",code:"f"},{label:"宜蘭縣",code:"g"},{label:"桃園市",code:"h"},{label:"嘉義市",code:"i"},{label:"新竹縣",code:"j"},{label:"苗栗縣",code:"k"},{label:"南投縣",code:"m"},{label:"彰化縣",code:"n"},{label:"新竹市",code:"o"},{label:"雲林縣",code:"p"},{label:"嘉義縣",code:"q"},{label:"屏東縣",code:"t"},{label:"花蓮縣",code:"u"},{label:"台東縣",code:"v"},{label:"金門縣",code:"w"},{label:"澎湖縣",code:"x"},{label:"連江縣",code:"z"}];function C(){let e=(0,i.useRouter)(),{isAdmin:t,isLoading:s}=(0,r.b)(),[c,C]=(0,n.useState)(_[0]),[M,S]=(0,n.useState)([]),[I,q]=(0,n.useState)(!0),[E,L]=(0,n.useState)(""),[$,P]=(0,n.useState)("all"),[O,V]=(0,n.useState)(null),[D,R]=(0,n.useState)(null),[T,U]=(0,n.useState)(!1),[H,J]=(0,n.useState)(null),[Y,B]=(0,n.useState)([]),[X,G]=(0,n.useState)(!1),{permissions:F}=(0,r.b)();(0,n.useEffect)(()=>{if(!s&&t&&F){let{accessibleCounties:e,isSuperAdmin:t}=F;if(!t&&null!==e&&!e.includes(c.code)){let t=_.find(t=>e.includes(t.code));t&&C(t)}}},[s,t,F,c]),(0,n.useEffect)(()=>{!s&&t&&Z()},[s,t,c,$]);let Z=async()=>{q(!0);try{let e=`${c.code.toLowerCase()}_projects`,t=l.N.from(e).select("*");"all"!==$&&(t=t.eq("enrichment_status",$));let{data:s,error:a}=await t.order("project_name",{ascending:!0}).limit(200);if(a)throw a;S(s||[])}catch(e){console.error("Error fetching projects:",e)}finally{q(!1)}},K=(0,i.useSearchParams)().get("openConfig");(0,n.useEffect)(()=>{if(!I&&M.length>0&&K&&!H){let e=M.find(e=>e.project_name===K);e&&ee(e)}},[I,M,K,H]);let Q=async e=>{R(e.id);try{let t=`${c.code.toLowerCase()}_projects`,{error:s}=await l.N.from(t).update({...e,last_enriched_at:new Date().toISOString()}).eq("id",e.id);if(s)throw s;S(t=>t.map(t=>t.id===e.id?{...e}:t))}catch(e){alert("儲存失敗："+e.message)}finally{R(null)}},W=async()=>{U(!0);try{let e=`${c.code.toLowerCase()}_projects`,t=M.filter(e=>"pending"===e.enrichment_status).slice(0,10);if(0===t.length)return void alert("當前列表中沒有「待補」的建案。");let s=t.map(e=>e.id),{error:a}=await l.N.from(e).update({enrichment_status:"requested"}).in("id",s);if(a)throw a;S(e=>e.map(e=>s.includes(e.id)?{...e,enrichment_status:"requested"}:e)),alert(`已成功將 ${s.length} 筆建案「委託」給 Agent。現在請在對話框輸入 /batch-enrich，我將會立刻開始處理！`)}catch(e){alert("操作失敗："+e.message)}finally{U(!1)}},ee=async e=>{J(e),G(!0);try{let t=c.code.toLowerCase(),s=`${t}_lvr_land_a`,a=`${t}_lvr_land_b`,[n,i]=await Promise.all([l.N.from(s).select("*").eq("建案名稱",e.project_name),l.N.from(a).select("*").eq("建案名稱",e.project_name)]);n.error&&console.warn("Error fetching table A:",n.error),i.error&&console.warn("Error fetching table B:",i.error);let r=n.data||[],d=i.data||[],o=[...r,...d];B(o)}catch(e){console.error("Error fetching transactions:",e),alert("無法讀取實價登錄資料："+e.message),J(null)}finally{G(!1)}},et=({status:e})=>{switch(e){case"done":return(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 text-[10px] font-medium bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 rounded-full",children:[(0,a.jsx)(d,{className:"h-3 w-3"})," 完備"]});case"requested":return(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 text-[10px] font-medium bg-amber-500/10 text-amber-400 border border-amber-500/20 rounded-full animate-pulse",children:[(0,a.jsx)(o.A,{className:"h-3 w-3"})," 代辦 (Agent)"]});default:return(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 text-[10px] font-medium bg-zinc-800 text-zinc-400 border border-zinc-700 rounded-full",children:[(0,a.jsx)(x.A,{className:"h-3 w-3"})," 待補 (人工)"]})}},es=M.filter(e=>e.project_name.toLowerCase().includes(E.toLowerCase())||e.developer?.toLowerCase().includes(E.toLowerCase())||e.affiliated_companies?.toLowerCase().includes(E.toLowerCase()));return s?null:t?(0,a.jsxs)("div",{className:"min-h-screen bg-dark-bg text-gray-100 p-4 md:p-8",children:[(0,a.jsxs)("div",{className:"max-w-7xl mx-auto font-sans",children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-10",children:[(0,a.jsxs)("div",{className:"flex items-center gap-5",children:[(0,a.jsx)("button",{onClick:()=>e.push("/dashboard"),className:"p-2 hover:bg-zinc-800 rounded-full transition-colors text-zinc-500 hover:text-white",children:(0,a.jsx)(p.A,{className:"h-6 w-6"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("h1",{className:"text-3xl font-black text-white tracking-tight",children:"建案數據中控台"}),(0,a.jsx)("span",{className:"px-2 py-0.5 bg-indigo-500/20 text-indigo-400 text-[10px] font-bold rounded uppercase tracking-widest",children:"Admin v2.0"})]}),(0,a.jsx)("p",{className:"text-zinc-500 text-sm mt-1",children:"即時管理全台建案規格與補全狀態"})]})]}),(0,a.jsxs)("button",{onClick:W,disabled:T,className:"flex items-center gap-2 px-5 py-2.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-bold shadow-lg shadow-indigo-500/20 transition-all active:scale-95 disabled:opacity-50",children:[T?(0,a.jsx)(h.A,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(o.A,{className:"h-4 w-4"}),"委託 Agent 補全數據 (下 10 筆)"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 mb-8 bg-zinc-900/50 p-4 rounded-2xl border border-zinc-800/50 backdrop-blur-sm",children:[(0,a.jsxs)("div",{className:"md:col-span-2 relative",children:[(0,a.jsx)("select",{value:c.code,onChange:e=>C(_.find(t=>t.code===e.target.value)),className:"w-full bg-zinc-950 border border-zinc-800 rounded-xl px-4 py-3 text-sm font-bold focus:ring-2 focus:ring-indigo-500/50 outline-none appearance-none cursor-pointer",children:_.map(e=>{let t=F?.isSuperAdmin||F?.accessibleCounties===null||F?.accessibleCounties?.includes(e.code);return(0,a.jsxs)("option",{value:e.code,disabled:!t,className:t?"":"text-zinc-600 bg-zinc-900",children:[e.label," ",t?"":"(無權限)"]},e.code)})}),(0,a.jsx)(u.A,{className:"absolute right-4 top-1/2 -translate-y-1/2 h-4 w-4 text-zinc-600 pointer-events-none"})]}),(0,a.jsxs)("div",{className:"md:col-span-6 relative",children:[(0,a.jsx)(m.A,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-4 w-4 text-zinc-600"}),(0,a.jsx)("input",{type:"text",placeholder:"搜尋建案名稱、建設公司、關係企業...",value:E,onChange:e=>L(e.target.value),className:"w-full bg-zinc-950 border border-zinc-800 rounded-xl pl-11 pr-4 py-3 text-sm focus:ring-2 focus:ring-indigo-500/50 outline-none"})]}),(0,a.jsxs)("div",{className:"md:col-span-2 relative",children:[(0,a.jsxs)("select",{value:$,onChange:e=>P(e.target.value),className:"w-full bg-zinc-950 border border-zinc-800 rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-indigo-500/50 outline-none appearance-none cursor-pointer",children:[(0,a.jsx)("option",{value:"all",children:"全部狀態"}),(0,a.jsx)("option",{value:"requested",children:"代辦 (Agent)"}),(0,a.jsx)("option",{value:"pending",children:"待補 (人工)"}),(0,a.jsx)("option",{value:"done",children:"完備"})]}),(0,a.jsx)(u.A,{className:"absolute right-4 top-1/2 -translate-y-1/2 h-4 w-4 text-zinc-600 pointer-events-none"})]}),(0,a.jsxs)("div",{className:"md:col-span-2 flex items-center justify-center text-zinc-600 text-xs font-mono",children:["Count: ",es.length]})]}),(0,a.jsx)("div",{className:"space-y-4",children:I?(0,a.jsxs)("div",{className:"py-20 flex flex-col items-center gap-4",children:[(0,a.jsx)(h.A,{className:"h-10 w-10 text-indigo-500 animate-spin"}),(0,a.jsx)("span",{className:"text-zinc-500 font-medium",children:"盤點數據中..."})]}):0===es.length?(0,a.jsx)("div",{className:"py-20 text-center text-zinc-500 border-2 border-dashed border-zinc-800 rounded-3xl",children:"尚無符合條件的數據"}):es.map(e=>{let t=O===e.id;return(0,a.jsxs)("div",{className:`group border transition-all duration-300 rounded-2xl overflow-hidden ${t?"bg-zinc-900 border-indigo-500/50 shadow-2xl shadow-indigo-500/10":"bg-zinc-900/40 border-zinc-800 hover:border-zinc-700"}`,children:[(0,a.jsxs)("div",{onClick:()=>V(t?null:e.id),className:"px-6 py-5 cursor-pointer flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,a.jsx)("div",{className:`p-2 rounded-xl transition-colors ${t?"bg-indigo-500 text-white":"bg-zinc-800 text-zinc-400 group-hover:bg-zinc-700"}`,children:(0,a.jsx)(b.A,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-base font-bold text-white group-hover:text-indigo-400 transition-colors",children:e.project_name}),(0,a.jsxs)("div",{className:"flex items-center gap-3 mt-1",children:[(0,a.jsx)("span",{className:"text-xs text-zinc-500 font-medium",children:e.developer||"建商未載"}),(0,a.jsx)("span",{className:"w-1 h-1 bg-zinc-700 rounded-full"}),(0,a.jsx)("span",{className:"text-[10px] text-zinc-600 uppercase font-mono tracking-tighter",children:e.id.split("-")[0]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-8",children:[(0,a.jsx)("div",{className:"hidden md:block",children:(0,a.jsx)(et,{status:e.enrichment_status})}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-[10px] text-zinc-600 font-bold uppercase tracking-widest leading-none",children:"Last Sync"}),(0,a.jsx)("p",{className:"text-xs text-zinc-400 mt-1",children:e.last_enriched_at?new Date(e.last_enriched_at).toLocaleDateString("zh-TW"):"-"})]}),(0,a.jsx)(g.A,{className:`h-5 w-5 text-zinc-600 transition-transform duration-300 ${t?"rotate-90 text-indigo-400":""}`})]})]})]}),t&&(0,a.jsx)("div",{className:"px-6 pb-6 pt-2 border-t border-zinc-800 animate-in slide-in-from-top-4 duration-300",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-x-8 gap-y-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-indigo-400",children:[(0,a.jsx)(f.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"開發與關係企業"})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] text-zinc-600 font-bold block mb-1",children:"投資建設"}),(0,a.jsx)("input",{type:"text",value:e.developer||"",onChange:t=>S(s=>s.map(s=>s.id===e.id?{...s,developer:t.target.value}:s)),className:"w-full bg-zinc-950 border border-zinc-800 rounded-lg px-3 py-1.5 text-xs text-zinc-300 focus:border-indigo-500 outline-none"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] text-zinc-600 font-bold block mb-1",children:"關係企業"}),(0,a.jsx)("input",{type:"text",value:e.affiliated_companies||"",onChange:t=>S(s=>s.map(s=>s.id===e.id?{...s,affiliated_companies:t.target.value}:s)),className:"w-full bg-zinc-950 border border-zinc-800 rounded-lg px-3 py-1.5 text-xs text-zinc-300 focus:border-indigo-500 outline-none"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] text-zinc-600 font-bold block mb-1",children:"工程營造"}),(0,a.jsx)("input",{type:"text",value:e.contractor||"",onChange:t=>S(s=>s.map(s=>s.id===e.id?{...s,contractor:t.target.value}:s)),className:"w-full bg-zinc-950 border border-zinc-800 rounded-lg px-3 py-1.5 text-xs text-zinc-300 focus:border-indigo-500 outline-none"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-indigo-400",children:[(0,a.jsx)(j,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"規劃與案名"})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] text-zinc-600 font-bold block mb-1",children:"建築設計"}),(0,a.jsx)("input",{type:"text",value:e.architect||"",onChange:t=>S(s=>s.map(s=>s.id===e.id?{...s,architect:t.target.value}:s)),className:"w-full bg-zinc-950 border border-zinc-800 rounded-lg px-3 py-1.5 text-xs text-zinc-300 focus:border-indigo-500 outline-none"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] text-zinc-600 font-bold block mb-1",children:"代銷企劃"}),(0,a.jsx)("input",{type:"text",value:e.sales_agent||"",onChange:t=>S(s=>s.map(s=>s.id===e.id?{...s,sales_agent:t.target.value}:s)),className:"w-full bg-zinc-950 border border-zinc-800 rounded-lg px-3 py-1.5 text-xs text-zinc-300 focus:border-indigo-500 outline-none"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] text-zinc-600 font-bold block mb-1",children:"建造執照"}),(0,a.jsx)("input",{type:"text",value:e.construction_license||"",onChange:t=>S(s=>s.map(s=>s.id===e.id?{...s,construction_license:t.target.value}:s)),className:"w-full bg-zinc-950 border border-zinc-800 rounded-lg px-3 py-1.5 text-xs text-zinc-300 focus:border-indigo-500 outline-none"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-indigo-400",children:[(0,a.jsx)(y,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"基地與規格"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] text-zinc-600 font-bold block mb-1",children:"基地規模(坪)"}),(0,a.jsx)("input",{type:"text",value:e.site_area||"",onChange:t=>S(s=>s.map(s=>s.id===e.id?{...s,site_area:t.target.value}:s)),className:"w-full bg-zinc-950 border border-zinc-800 rounded-lg px-3 py-1.5 text-xs text-zinc-300 outline-none"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] text-zinc-600 font-bold block mb-1",children:"公設比"}),(0,a.jsx)("input",{type:"text",value:e.public_ratio||"",onChange:t=>S(s=>s.map(s=>s.id===e.id?{...s,public_ratio:t.target.value}:s)),className:"w-full bg-zinc-950 border border-zinc-800 rounded-lg px-3 py-1.5 text-xs text-zinc-300 outline-none"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] text-zinc-600 font-bold block mb-1",children:"地上層"}),(0,a.jsx)("input",{type:"text",value:e.total_floors||"",onChange:t=>S(s=>s.map(s=>s.id===e.id?{...s,total_floors:t.target.value}:s)),className:"w-full bg-zinc-950 border border-zinc-800 rounded-lg px-3 py-1.5 text-xs text-zinc-300 outline-none"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] text-zinc-600 font-bold block mb-1",children:"地下層"}),(0,a.jsx)("input",{type:"text",value:e.basement_floors||"",onChange:t=>S(s=>s.map(s=>s.id===e.id?{...s,basement_floors:t.target.value}:s)),className:"w-full bg-zinc-950 border border-zinc-800 rounded-lg px-3 py-1.5 text-xs text-zinc-300 outline-none"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"text-[10px] text-zinc-600 font-bold block mb-1",children:"土地使用分區 (新)"}),(0,a.jsx)("input",{type:"text",value:e.land_use_zoning||"",onChange:t=>S(s=>s.map(s=>s.id===e.id?{...s,land_use_zoning:t.target.value}:s)),className:"w-full bg-zinc-950 border border-zinc-800 rounded-lg px-3 py-1.5 text-xs text-zinc-300 outline-none"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] text-zinc-600 font-bold block mb-1",children:"地號"}),(0,a.jsx)("input",{type:"text",value:e.land_plot_number||"",onChange:t=>S(s=>s.map(s=>s.id===e.id?{...s,land_plot_number:t.target.value}:s)),className:"w-full bg-zinc-950 border border-zinc-800 rounded-lg px-3 py-1.5 text-xs text-zinc-300 outline-none"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] text-zinc-600 font-bold block mb-1",children:"社區戶數"}),(0,a.jsx)("input",{type:"number",value:e.community_unit_count||"",onChange:t=>S(s=>s.map(s=>s.id===e.id?{...s,community_unit_count:parseInt(t.target.value)||0}:s)),className:"w-full bg-zinc-950 border border-zinc-800 rounded-lg px-3 py-1.5 text-xs text-zinc-300 outline-none"})]}),(0,a.jsxs)("div",{className:"col-span-2",children:[(0,a.jsx)("label",{className:"text-[10px] text-zinc-600 font-bold block mb-1",children:"結構類型"}),(0,a.jsx)("input",{type:"text",value:e.structure||"",onChange:t=>S(s=>s.map(s=>s.id===e.id?{...s,structure:t.target.value}:s)),className:"w-full bg-zinc-950 border border-zinc-800 rounded-lg px-3 py-1.5 text-xs text-zinc-300 outline-none"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-indigo-400",children:[(0,a.jsx)(v,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"車位與狀態"})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] text-zinc-600 font-bold block mb-1",children:"車位/數量"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",placeholder:"型態",value:e.parking_type||"",onChange:t=>S(s=>s.map(s=>s.id===e.id?{...s,parking_type:t.target.value}:s)),className:"w-2/3 bg-zinc-950 border border-zinc-800 rounded-lg px-3 py-1.5 text-xs text-zinc-300 outline-none"}),(0,a.jsx)("input",{type:"text",placeholder:"數",value:e.parking_count||"",onChange:t=>S(s=>s.map(s=>s.id===e.id?{...s,parking_count:t.target.value}:s)),className:"w-1/3 bg-zinc-950 border border-zinc-800 rounded-lg px-3 py-1.5 text-xs text-zinc-300 outline-none"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-[10px] text-zinc-600 font-bold block mb-1",children:"標記狀態"}),(0,a.jsx)("div",{className:"flex gap-1",children:[{val:"requested",label:"代辦"},{val:"pending",label:"待補"},{val:"done",label:"完備"}].map(t=>(0,a.jsx)("button",{onClick:()=>S(s=>s.map(s=>s.id===e.id?{...s,enrichment_status:t.val}:s)),className:`flex-1 py-1 rounded text-[9px] font-bold border transition-colors ${e.enrichment_status===t.val?"bg-indigo-500 border-indigo-400 text-white":"bg-zinc-950 border-zinc-800 text-zinc-600 hover:text-zinc-400"}`,children:t.label},t.val))})]}),(0,a.jsxs)("button",{onClick:()=>Q(e),disabled:D===e.id,className:"w-full mt-4 flex items-center justify-center gap-2 py-3 bg-white text-black hover:bg-zinc-200 rounded-xl font-black text-xs uppercase transition-all shadow-xl shadow-white/5 active:scale-95 disabled:opacity-50",children:[D===e.id?(0,a.jsx)(h.A,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(N.A,{className:"h-4 w-4"}),"確認並儲存變更"]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-indigo-400",children:[(0,a.jsx)(z.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-[10px] font-black uppercase tracking-widest",children:"平面圖配置"})]}),(0,a.jsxs)("div",{className:"p-4 bg-zinc-950/50 rounded-xl border border-zinc-800/50",children:[(0,a.jsx)("p",{className:"text-xs text-zinc-400 mb-3",children:"您可以直接在此設定樓層戶型配置。設定完成並發布後，將同步更新至前台報表。"}),(0,a.jsxs)("button",{onClick:()=>ee(e),className:"flex items-center gap-2 px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-white rounded-lg text-xs font-bold transition-colors border border-zinc-700 hover:border-zinc-600",children:[(0,a.jsx)(z.A,{className:"h-4 w-4"}),"開啟配置編輯器"]})]})]})]})})]},e.id)})})]}),H&&(0,a.jsx)("div",{className:"fixed inset-0 z-[100] bg-black/90 backdrop-blur-sm flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-dark-card w-full max-w-6xl h-[90vh] rounded-2xl border border-zinc-700 shadow-2xl flex flex-col overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-zinc-700 bg-zinc-900",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(z.A,{className:"h-5 w-5 text-indigo-400"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-sm font-bold text-white",children:["配置編輯器：",H.project_name]}),(0,a.jsx)("p",{className:"text-xs text-zinc-500",children:"Admin Mode"})]})]}),(0,a.jsx)("button",{onClick:()=>J(null),className:"p-2 hover:bg-zinc-800 rounded-lg text-zinc-400 hover:text-white transition-colors",children:(0,a.jsx)(w.A,{className:"h-5 w-5"})})]}),(0,a.jsx)("div",{className:"flex-1 overflow-auto bg-dark-bg relative",children:X?(0,a.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-4 text-zinc-400",children:[(0,a.jsx)(h.A,{className:"h-8 w-8 animate-spin text-indigo-500"}),(0,a.jsx)("span",{className:"text-xs font-mono",children:"載入交易資料中..."})]}):Y.length>0?(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)(A.sB,{transactions:Y,project:H.project_name,configOnly:!0,title:`平面配置設定 - ${H.project_name}`,mode:"admin"})}):(0,a.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center gap-4 text-zinc-500",children:[(0,a.jsx)(k.A,{className:"h-10 w-10 opacity-50"}),(0,a.jsx)("p",{children:"此建案尚無實價登錄資料，無法進行配置。"}),(0,a.jsx)("button",{onClick:()=>J(null),className:"px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-white rounded-lg text-xs font-bold transition-colors",children:"關閉"})]})})]})})]}):(0,a.jsx)("div",{className:"p-8 text-center text-white",children:"權限不足"})}function M(){return(0,a.jsx)(n.Suspense,{fallback:(0,a.jsx)("div",{className:"min-h-screen bg-dark-bg flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-zinc-500 flex flex-col items-center gap-2",children:[(0,a.jsx)(h.A,{className:"h-8 w-8 animate-spin"}),(0,a.jsx)("span",{children:"載入中..."})]})}),children:(0,a.jsx)(C,{})})}},21362:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},50049:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("building-2",[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]])},51914:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},53961:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]])},55243:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},55873:(e,t,s)=>{"use strict";s.d(t,{Ib:()=>r,Sn:()=>i,VI:()=>a,WG:()=>c,m5:()=>n});let a="https://zxbmbbfrzbtuueysicoc.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp4Ym1iYmZyemJ0dXVleXNpY29jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA2ODg5ODksImV4cCI6MjA2NjI2NDk4OX0.1IUynv5eK1xF_3pb-oasqaTrPvbeAOC4Sc1oykPBy4M",l="https://zxbmbbfrzbtuueysicoc.supabase.co/functions/v1",i={QUERY_DATA:`${l}/query-data`,SUB_DATA:`${l}/query-sub-data`,PROJECT_NAMES:`${l}/query-names`,RANKING_ANALYSIS:`${l}/analyze-project-ranking`,GET_USERS:`${l}/get-users`,GET_USER_ACTIVITY:`${l}/get-user-activity`},r={臺北市:["中正區","大同區","中山區","松山區","大安區","萬華區","信義區","士林區","北投區","內湖區","南港區","文山區"],新北市:["板橋區","三重區","中和區","永和區","新莊區","新店區","樹林區","鶯歌區","三峽區","淡水區","汐止區","瑞芳區","土城區","蘆洲區","五股區","泰山區","林口區","深坑區","石碇區","坪林區","三芝區","石門區","八里區","平溪區","雙溪區","貢寮區","金山區","萬里區","烏來區"],桃園市:["桃園區","中壢區","大溪區","楊梅區","蘆竹區","大園區","龜山區","八德區","龍潭區","平鎮區","新屋區","觀音區","復興區"],臺中市:["中區","東區","南區","西區","北區","北屯區","西屯區","南屯區","太平區","大里區","霧峰區","烏日區","豐原區","后里區","石岡區","東勢區","和平區","新社區","潭子區","大雅區","神岡區","大肚區","沙鹿區","龍井區","梧棲區","清水區","大甲區","外埔區","大安區"],臺南市:["中西區","東區","南區","北區","安平區","安南區","永康區","歸仁區","新化區","左鎮區","玉井區","楠西區","南化區","仁德區","關廟區","龍崎區","官田區","麻豆區","佳里區","西港區","七股區","將軍區","學甲區","北門區","新營區","後壁區","白河區","東山區","六甲區","下營區","柳營區","鹽水區","善化區","大內區","山上區","新市區","安定區"],高雄市:["新興區","前金區","苓雅區","鹽埕區","鼓山區","旗津區","前鎮區","三民區","楠梓區","小港區","左營區","仁武區","大社區","岡山區","路竹區","阿蓮區","田寮區","燕巢區","橋頭區","梓官區","彌陀區","永安區","湖內區","鳳山區","大寮區","林園區","鳥松區","大樹區","旗山區","美濃區","六龜區","內門區","杉林區","甲仙區","桃源區","那瑪夏區","茂林區","茄萣區"],基隆市:["仁愛區","信義區","中正區","中山區","安樂區","暖暖區","七堵區"],新竹市:["東區","北區","香山區"],嘉義市:["東區","西區"],宜蘭縣:["宜蘭市","羅東鎮","蘇澳鎮","頭城鎮","礁溪鄉","壯圍鄉","員山鄉","冬山鄉","五結鄉","三星鄉","大同鄉","南澳鄉"],新竹縣:["竹北市","竹東鎮","新埔鎮","關西鎮","湖口鄉","新豐鄉","芎林鄉","橫山鄉","北埔鄉","寶山鄉","峨眉鄉","尖石鄉","五峰鄉"],苗栗縣:["苗栗市","苑裡鎮","通霄鎮","竹南鎮","頭份鎮","後龍鎮","卓蘭鎮","大湖鄉","公館鄉","銅鑼鄉","南庄鄉","頭屋鄉","三義鄉","西湖鄉","造橋鄉","三灣鄉","獅潭鄉","泰安鄉"],彰化縣:["彰化市","鹿港鎮","和美鎮","線西鄉","伸港鄉","福興鄉","秀水鄉","花壇鄉","芬園鄉","員林鎮","溪湖鎮","田中鎮","大村鄉","埔鹽鄉","埔心鄉","永靖鄉","社頭鄉","二水鄉","北斗鎮","二林鎮","田尾鄉","埤頭鄉","芳苑鄉","大城鄉","竹塘鄉","溪州鄉"],南投縣:["南投市","埔里鎮","草屯鎮","竹山鎮","集集鎮","名間鄉","鹿谷鄉","中寮鄉","魚池鄉","國姓鄉","水里鄉","信義鄉","仁愛鄉"],雲林縣:["斗六市","斗南鎮","虎尾鎮","西螺鎮","土庫鎮","北港鎮","古坑鄉","大埤鄉","莿桐鄉","林內鄉","二崙鄉","崙背鄉","麥寮鄉","東勢鄉","褒忠鄉","台西鄉","元長鄉","四湖鄉","口湖鄉","水林鄉"],嘉義縣:["太保市","朴子市","布袋鎮","大林鎮","民雄鄉","溪口鄉","新港鄉","六腳鄉","東石鄉","義竹鄉","鹿草鄉","水上鄉","中埔鄉","竹崎鄉","梅山鄉","番路鄉","大埔鄉","阿里山鄉"],屏東縣:["屏東市","潮州鎮","東港鎮","恆春鎮","萬丹鄉","長治鄉","麟洛鄉","九如鄉","里港鄉","鹽埔鄉","高樹鄉","萬巒鄉","內埔鄉","竹田鄉","新埤鄉","枋寮鄉","新園鄉","崁頂鄉","林邊鄉","南州鄉","佳冬鄉","琉球鄉","車城鄉","滿州鄉","枋山鄉","霧台鄉","瑪家鄉","泰武鄉","來義鄉","春日鄉","獅子鄉","牡丹鄉","三地門鄉"],花蓮縣:["花蓮市","鳳林鎮","玉里鎮","新城鄉","吉安鄉","壽豐鄉","光復鄉","豐濱鄉","瑞穗鄉","富里鄉","秀林鄉","萬榮鄉","卓溪鄉"],臺東縣:["臺東市","成功鎮","關山鎮","卑南鄉","鹿野鄉","池上鄉","東河鄉","長濱鄉","太麻里鄉","大武鄉","綠島鄉","海端鄉","延平鄉","金峰鄉","達仁鄉","蘭嶼鄉"],澎湖縣:["馬公市","湖西鄉","白沙鄉","西嶼鄉","望安鄉","七美鄉"],金門縣:["金城鎮","金湖鎮","金沙鄉","金寧鄉","烈嶼鄉","烏坵鄉"],連江縣:["南竿鄉","北竿鄉","莒光鄉","東引鄉"]},c={臺北市:"A",新北市:"F",桃園市:"H",臺中市:"B",臺南市:"D",高雄市:"E",基隆市:"C",新竹市:"O",嘉義市:"I",新竹縣:"J",苗栗縣:"K",彰化縣:"N",南投縣:"M",雲林縣:"P",嘉義縣:"Q",屏東縣:"T",宜蘭縣:"G",花蓮縣:"U",臺東縣:"V",澎湖縣:"X",金門縣:"W",連江縣:"Z"}},62032:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("shield-alert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]])},63888:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("arrow-left-right",[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]])},66614:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]])},67514:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]])},67635:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]])},75942:(e,t,s)=>{Promise.resolve().then(s.bind(s,20509))},80723:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},82482:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]])},84980:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},86120:(e,t,s)=>{"use strict";s.d(t,{b:()=>p,i:()=>h});var a=s(95155),n=s(12115),l=s(73321),i=s(16385),r=s(39430),c=s(62032),d=s(66614),o=s(80723);function x(){let e=(0,l.useRouter)();return(0,a.jsxs)("div",{className:"min-h-screen bg-black flex items-center justify-center p-4 relative overflow-hidden",children:[(0,a.jsx)("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-red-600/10 rounded-full blur-[128px] pointer-events-none"}),(0,a.jsx)("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-amber-600/10 rounded-full blur-[128px] pointer-events-none"}),(0,a.jsx)("div",{className:"relative z-10 max-w-md w-full",children:(0,a.jsxs)(r.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5},className:"bg-zinc-900/50 backdrop-blur-xl border border-red-500/20 rounded-3xl p-8 shadow-2xl overflow-hidden",children:[(0,a.jsxs)(r.P.div,{className:"w-20 h-20 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-6 border border-red-500/20 relative",initial:{rotate:-180,opacity:0},animate:{rotate:0,opacity:1},transition:{delay:.2,type:"spring"},children:[(0,a.jsx)(c.A,{className:"w-10 h-10 text-red-500"}),(0,a.jsx)(r.P.div,{className:"absolute inset-0 bg-red-500/20 rounded-full",animate:{scale:[1,1.2,1]},transition:{duration:2,repeat:1/0}})]}),(0,a.jsxs)("div",{className:"text-center space-y-3 mb-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-white tracking-tight",children:"Access Denied"}),(0,a.jsxs)("p",{className:"text-zinc-400 text-sm leading-relaxed",children:["權限不足。此區域僅限系統管理員訪問。",(0,a.jsx)("br",{}),"若您認為這是錯誤，請聯繫技術支援。"]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("button",{onClick:()=>e.push("/dashboard"),className:"w-full flex items-center justify-center gap-2 bg-white text-black hover:bg-zinc-200 font-bold py-3.5 px-4 rounded-xl transition-all active:scale-[0.98]",children:[(0,a.jsx)(d.A,{className:"w-4 h-4"}),"返回主控台 (Dashboard)"]}),(0,a.jsxs)("button",{onClick:()=>e.back(),className:"w-full flex items-center justify-center gap-2 bg-transparent hover:bg-white/5 text-zinc-400 hover:text-white font-medium py-3.5 px-4 rounded-xl border border-white/5 hover:border-white/10 transition-all active:scale-[0.98]",children:[(0,a.jsx)(o.A,{className:"w-4 h-4"}),"回上一頁"]})]}),(0,a.jsx)(r.P.div,{className:"mt-8 pt-6 border-t border-white/5 text-center",initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},children:(0,a.jsx)("p",{className:"text-[10px] text-zinc-600 font-mono uppercase tracking-widest",children:"Error: 403_FORBIDDEN"})})]})})]})}function p(){let[e,t]=(0,n.useState)({user:null,isAdmin:!1,permissions:{canPostAnnouncement:!1,accessibleCounties:[],isSuperAdmin:!1},isLoading:!0,error:null});return(0,n.useEffect)(()=>{let e=async()=>{try{let{data:{session:e},error:s}=await i.N.auth.getSession();if(s)throw s;if(!e?.user)return void t({user:null,isAdmin:!1,permissions:{canPostAnnouncement:!1,accessibleCounties:[],isSuperAdmin:!1},isLoading:!1,error:null});let{data:a,error:n}=await i.N.from("profiles").select("role, accessible_counties, can_post_announcement").eq("id",e.user.id).single();if(n){console.warn("Profile fetch error:",n),t({user:e.user,isAdmin:!1,permissions:{canPostAnnouncement:!1,accessibleCounties:[],isSuperAdmin:!1},isLoading:!1,error:null});return}let l=a?.role==="super_admin",r=a?.role==="admin"||l,c=l?null:a?.accessible_counties,d=!!l||a?.can_post_announcement||!1;t({user:e.user,isAdmin:r,permissions:{canPostAnnouncement:d,accessibleCounties:c,isSuperAdmin:l},isLoading:!1,error:null})}catch(e){console.error("Admin auth check error:",e),t({user:null,isAdmin:!1,permissions:{canPostAnnouncement:!1,accessibleCounties:[],isSuperAdmin:!1},isLoading:!1,error:e.message})}};e();let{data:{subscription:s}}=i.N.auth.onAuthStateChange(()=>{e()});return()=>s.unsubscribe()},[]),e}function h(e){return function(t){let{user:s,isAdmin:i,isLoading:r,error:c}=p(),d=(0,l.useRouter)();return((0,n.useEffect)(()=>{r||i||d.replace("/")},[r,i,d]),r)?(0,a.jsx)("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)("div",{className:"h-8 w-8 border-2 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin mx-auto"}),(0,a.jsx)("p",{className:"text-zinc-500 text-sm",children:"驗證管理員權限..."})]})}):s?i?(0,a.jsx)(e,{...t}):(0,a.jsx)(x,{}):(0,a.jsx)("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center space-y-4 p-8",children:[(0,a.jsx)("div",{className:"text-4xl",children:"\uD83D\uDD12"}),(0,a.jsx)("h1",{className:"text-xl font-bold text-white",children:"請先登入"}),(0,a.jsx)("p",{className:"text-zinc-500",children:"此頁面需要登入才能訪問"}),(0,a.jsx)("button",{onClick:()=>d.push("/"),className:"bg-cyan-600 hover:bg-cyan-500 text-white px-6 py-2 rounded-lg transition-colors",children:"前往登入"})]})})}}},89823:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},94514:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},95057:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(78340).A)("layout-template",[["rect",{width:"18",height:"7",x:"3",y:"3",rx:"1",key:"f1a2em"}],["rect",{width:"9",height:"7",x:"3",y:"14",rx:"1",key:"jqznyg"}],["rect",{width:"5",height:"7",x:"16",y:"14",rx:"1",key:"q5h2i8"}]])}},e=>{e.O(0,[4764,5969,319,8875,8441,3794,7358],()=>e(e.s=75942)),_N_E=e.O()}]);