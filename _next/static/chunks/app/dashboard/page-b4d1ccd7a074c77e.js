(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{39488:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>es});var t=a(95155),l=a(12115),i=a(39430),n=a(95542),r=a(88743),c=a(40980),o=a(33210),d=a(94514);let x=(0,l.forwardRef)(({options:e,value:s,onChange:a,placeholder:i="Select...",maxItems:n,disabled:r=!1,className:x,onSearch:m,loading:u=!1,onFocus:h},p)=>{let[f,v]=(0,l.useState)(""),[b,j]=(0,l.useState)(!1),g=(0,l.useRef)(null),N=(0,l.useRef)(null),y=m?e:e.filter(e=>e.label.toLowerCase().includes(f.toLowerCase()));return s.map(s=>{let a=e.find(e=>e.value===s);return a?a.label:s}),(0,l.useEffect)(()=>{let e=e=>{g.current&&!g.current.contains(e.target)&&j(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,l.useEffect)(()=>{m&&m(f)},[f,m]),(0,t.jsxs)("div",{className:(0,c.cn)("relative w-full",x),ref:g,children:[(0,t.jsxs)("div",{className:(0,c.cn)("flex items-center gap-2 bg-zinc-950/50 border border-input rounded-md px-2 py-1.5 h-[42px] overflow-x-auto custom-scrollbar cursor-text transition-all",b&&"ring-2 ring-ring ring-offset-0 border-ring",r&&"bg-zinc-900/50 cursor-not-allowed opacity-50"),onClick:()=>!r&&N.current?.focus(),children:[s.map(l=>{let i=e.find(e=>e.value===l),n=i?i.label:l;return(0,t.jsxs)("span",{className:"bg-violet-500/20 text-violet-200 border border-violet-500/30 text-xs rounded-full px-2 py-0.5 flex items-center gap-1 animate-in fade-in zoom-in-95 duration-100 whitespace-nowrap shrink-0",children:[n,!r&&(0,t.jsx)(o.A,{size:12,className:"cursor-pointer hover:text-white transition-colors",onClick:e=>{e.stopPropagation(),a(s.filter(e=>e!==l))}})]},l)}),(0,t.jsx)("input",{ref:N,type:"text",value:f,onChange:e=>v(e.target.value),onFocus:()=>{j(!0),h?.()},onKeyDown:e=>{"Backspace"===e.key&&""===f&&s.length>0&&a(s.slice(0,-1))},placeholder:0===s.length?i:"",className:(0,c.cn)("bg-transparent outline-none flex-grow min-w-[60px] text-zinc-100 placeholder:text-zinc-500 text-sm",r&&"cursor-not-allowed"),disabled:r})]}),b&&!r&&(0,t.jsx)("div",{className:"absolute z-[110] w-full mt-1 bg-zinc-900 border border-zinc-700 rounded-md shadow-xl max-h-60 overflow-y-auto custom-scrollbar animate-in fade-in slide-in-from-top-2 duration-100",children:u?(0,t.jsx)("div",{className:"p-2 text-center text-zinc-500 text-sm",children:"Loading..."}):0===y.length?(0,t.jsx)("div",{className:"p-2 text-center text-zinc-500 text-sm",children:"No options found"}):y.map((e,i)=>{if(!e)return null;let r=0===i||e.group!==y[i-1]?.group;return(0,t.jsxs)(l.Fragment,{children:[r&&e.group&&(0,t.jsx)("div",{className:"px-2 py-1 bg-zinc-800/50 text-xs font-semibold text-zinc-400 sticky top-0 backdrop-blur-sm z-10",children:e.group}),(0,t.jsxs)("div",{className:(0,c.cn)("px-3 py-2 cursor-pointer text-sm flex items-start justify-between hover:bg-zinc-800 transition-colors",s.includes(e.value)&&"bg-violet-500/10 text-violet-400"),onClick:()=>(e=>{if(s.includes(e))a(s.filter(s=>s!==e));else{if(n&&s.length>=n)return;a([...s,e])}v("")})(e.value),children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"font-medium",children:e.label}),e.details&&(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-0.5",children:[(e.details.county||e.details.district)&&(0,t.jsxs)("span",{className:"text-xs text-zinc-500 bg-zinc-800/80 px-1.5 rounded border border-zinc-700",children:[e.details.county,e.details.district]}),e.details.date&&(0,t.jsx)("span",{className:"text-xs text-zinc-600 font-mono",children:e.details.date.substring(0,7)})]})]}),s.includes(e.value)&&(0,t.jsx)(d.A,{size:16,className:"mt-1"})]})]},e.value)})})]})});x.displayName="MultiSelect";var m=a(29991),u=a(89239),h=a(60529),p=a(92622),f=a(26179),v=a(80642),b=a(55873),j=a(27529),g=a(98883);let N=[{value:"ranking",label:"核心指標與排名"},{value:"price-band",label:"總價帶分析"},{value:"unit-price",label:"單價分析"},{value:"heatmap",label:"調價熱力圖"},{value:"timeline",label:"政策時光機"},{value:"velocity",label:"銷售速度與房型"},{value:"parking",label:"車位分析"},{value:"data-list",label:"交易明細列表"}];function y({onAnalyze:e,isLoading:s,analysisData:a}){let n,{counties:d,districts:y,transactionType:w,buildingType:z,projectNames:k,dateRange:C,startDate:A,endDate:S,excludeCommercial:E,activeTab:_,setCounties:P,setDistricts:R,setTransactionType:D,setBuildingType:$,setProjectNames:L,setDateRange:T,setCustomDate:G,setExcludeCommercial:B,setActiveTab:F,resetFilters:O,isFilterBarCompact:q,setIsFilterBarCompact:I}=(0,r.P)(),[U,M]=(0,l.useState)(!1),[J,V]=(0,l.useState)([]),[Y,H]=(0,l.useState)(!1),Q=Object.keys(b.WG).map(e=>({label:e,value:e})),W=l.useMemo(()=>0===d.length?[]:d.flatMap(e=>(b.Ib[e]||[]).map(s=>({label:s,value:s,group:e}))),[d]),K=(0,l.useRef)(null),[Z,X]=(0,l.useState)(null),ee=(0,l.useCallback)(async e=>{if(0===d.length)return void V([]);H(!0),X(null);try{let s=d.map(async s=>{let a=b.WG[s],t=y.filter(e=>b.Ib[s]?.includes(e));return j.FH.fetchProjectNameSuggestions(a,e,t).then(e=>{let a=[];return Array.isArray(e)?a=e:e&&e.data&&Array.isArray(e.data)?a=e.data:e&&e.names&&Array.isArray(e.names)&&(a=e.names),a.map(e=>{let a="string"==typeof e,t=a?e:e.name||e.建案名稱||String(e);return{label:t,value:t,group:s,details:a?void 0:{county:s,district:e.district||e.行政區,date:e.earliestDate||e.交易日}}})}).catch(e=>(console.error(`Failed to fetch projects for ${s}:`,e),[]))}),a=(await Promise.all(s)).flat(),t=Array.from(new Map(a.map(e=>[e.value,e])).values());V(t),0===t.length&&e.length>=2&&console.log(`No projects found for query "${e}" in counties: ${d.join(", ")}`)}catch(e){console.error("Project search error:",e),X("搜尋失敗，請稍後再試")}finally{H(!1)}},[d,y]),es=(0,l.useCallback)(e=>{K.current&&clearTimeout(K.current),K.current=setTimeout(()=>{ee(e)},300)},[ee]);(0,l.useEffect)(()=>()=>{K.current&&clearTimeout(K.current)},[]);let ea=(0,l.useRef)(null),[et,el]=(0,l.useState)(0);return(0,l.useEffect)(()=>{if(!ea.current)return;let e=new ResizeObserver(e=>{for(let s of e)el(s.contentRect.height)});return e.observe(ea.current),()=>e.disconnect()},[q]),(0,l.useEffect)(()=>{let e=()=>{let e=window.scrollY;e>250?q||I(!0):e<120&&q&&I(!1)};return window.addEventListener("scroll",e,{passive:!0}),()=>window.removeEventListener("scroll",e)},[q,I]),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(v.N,{children:q&&(0,t.jsxs)(i.P.div,{initial:{opacity:0,y:-20,x:"-50%",scale:.95},animate:{opacity:1,y:0,x:"-50%",scale:1},exit:{opacity:0,y:-20,x:"-50%",scale:.95},transition:{duration:.2,ease:"easeOut"},className:"fixed top-3 left-1/2 z-[100] p-1 glass-card rounded-full shadow-2xl flex items-center justify-between gap-1 transition-all mx-auto max-w-[95vw] md:max-w-7xl backdrop-blur-2xl border border-white/20 origin-top",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 pl-2 pr-2 py-1.5 hover:bg-white/5 rounded-full transition-colors cursor-pointer shrink-0",onClick:()=>{I(!1),window.scrollTo({top:0,behavior:"smooth"})},children:[(0,t.jsx)("div",{className:"h-7 w-7 rounded-full bg-violet-600/30 text-violet-300 flex items-center justify-center shrink-0 border border-violet-500/30",children:(0,t.jsx)(p.A,{className:"h-3.5 w-3.5"})}),(0,t.jsxs)("div",{className:"flex flex-col leading-none overflow-hidden max-w-[100px] xs:max-w-[140px]",children:[(0,t.jsxs)("span",{className:"text-[10px] text-zinc-400 font-medium truncate",children:[(n=[],d.length>0&&n.push(`${d.length} 縣市`),w&&n.push(w.replace("交易","")),"custom"!==C?n.push({"1q":"近一季","2q":"近兩季","3q":"近三季","1y":"近一年",this_year:"今年",last_2_years:"近兩年"}[C]||C):n.push("自訂期間"),n.join(" • ")||"請選擇篩選條件").split("•")[0],"..."]}),(0,t.jsx)("span",{className:"text-[9px] text-zinc-600 font-mono mt-0.5",children:"點擊展開"})]})]}),(0,t.jsx)("div",{className:"flex-1 min-w-0 flex items-center gap-1 px-1 border-l border-white/10 overflow-x-auto mask-fade-right pb-2 pr-8",children:N.map(e=>(0,t.jsx)("button",{onClick:s=>{s.stopPropagation(),F(e.value)},className:(0,c.cn)("px-2.5 py-1 rounded-full text-[10px] font-bold transition-all whitespace-nowrap active:scale-95 touch-manipulation",_===e.value?"bg-violet-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-500 hover:text-zinc-300 bg-zinc-800/20"),children:e.label.replace("分析","").replace("指標與","").replace("交易","")},e.value))}),(0,t.jsx)("div",{className:"pr-2 pl-1 hidden sm:block",children:(0,t.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-cyan-500/50 animate-pulse",title:"操作中"})})]},"compact-pill")}),(0,t.jsxs)("div",{ref:ea,className:`p-4 md:p-6 glass-card rounded-xl shadow-lg transition-opacity duration-200 ${q?"opacity-0 pointer-events-none":"opacity-100"}`,children:[(0,t.jsxs)("div",{className:"flex md:hidden items-center justify-between mb-4",children:[(0,t.jsxs)("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[(0,t.jsx)(p.A,{className:"h-5 w-5 text-violet-500"}),"篩選條件"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(u.$,{variant:"outline",size:"sm",onClick:()=>M(!U),className:"border-zinc-700 text-zinc-300",children:[U?(0,t.jsx)(o.A,{className:"h-4 w-4"}):(0,t.jsx)(p.A,{className:"h-4 w-4"}),U?"收起":"展開"]}),(0,t.jsx)(u.$,{variant:"default",size:"sm",className:"bg-violet-600 text-white",disabled:0===d.length||s,onClick:e,children:s?"...":"分析"})]})]}),(0,t.jsxs)("div",{className:`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-7 gap-4 items-end ${U?"block":"hidden md:grid"}`,children:[(0,t.jsxs)("div",{className:"xl:col-span-1",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-zinc-300",children:"縣市"}),d.length>3&&(0,t.jsxs)("span",{className:"text-xs text-amber-500 font-normal animate-in fade-in",children:["(已選 ",d.length,"/6)"]})]}),d.length>0&&(0,t.jsx)("button",{onClick:()=>P([]),className:"text-xs text-cyan-400 hover:text-cyan-300",children:"清除"})]}),(0,t.jsx)(x,{options:Q,value:d,onChange:e=>{e.length>6||P(e)},placeholder:"請選擇縣市...",maxItems:6})]}),(0,t.jsxs)("div",{className:"xl:col-span-1",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-zinc-300",children:"行政區"}),y.length>0&&(0,t.jsx)("button",{onClick:()=>R([]),className:"text-xs text-cyan-400 hover:text-cyan-300",children:"清除"})]}),(0,t.jsx)(x,{options:W,value:y,onChange:e=>{R(e)},placeholder:d.length>0?"請選擇行政區...":"請先選縣市",disabled:0===d.length})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"交易類型"}),(0,t.jsxs)(m.l,{value:w,onChange:e=>D(e.target.value),children:[(0,t.jsx)("option",{value:"預售交易",children:"預售交易"}),(0,t.jsx)("option",{value:"中古交易",disabled:!0,children:"中古交易 (開發中)"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"建物型態"}),(0,t.jsxs)(m.l,{value:z,onChange:e=>$(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"全部"}),(0,t.jsx)("option",{value:"住宅大樓(11層含以上有電梯)",children:"住宅大樓"}),(0,t.jsx)("option",{value:"華廈(10層含以下有電梯)",children:"華廈"}),(0,t.jsx)("option",{value:"公寓(5層含以下無電梯)",children:"公寓"}),(0,t.jsx)("option",{value:"套房(1房(1廳)1衛)",children:"套房"}),(0,t.jsx)("option",{value:"透天厝",children:"透天厝"}),(0,t.jsx)("option",{value:"店面(店鋪)",children:"店面"}),(0,t.jsx)("option",{value:"辦公商業大樓",children:"辦公商業大樓"}),(0,t.jsx)("option",{value:"工廠",children:"工廠/廠辦"}),(0,t.jsx)("option",{value:"其他",children:"其他"})]})]}),(0,t.jsxs)("div",{className:"xl:col-span-3",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-zinc-300",children:"建案名稱"}),k.length>0&&(0,t.jsx)("button",{onClick:()=>L([]),className:"text-xs text-cyan-400 hover:text-cyan-300",children:"清除"})]}),(0,t.jsx)(x,{options:J,value:k,onChange:L,placeholder:d.length>0?"輸入建案名稱搜尋...":"請先選縣市",disabled:0===d.length,onSearch:es,loading:Y,onFocus:()=>{0===k.length&&0===J.length&&ee("")}}),Z&&(0,t.jsx)("span",{className:"text-xs text-red-400 mt-1",children:Z})]}),(0,t.jsxs)("div",{className:"xl:col-span-3 sm:col-span-2 grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"快捷時間"}),(0,t.jsxs)(m.l,{value:C,onChange:e=>{let s=e.target.value;if("custom"===s)T("custom",A,S);else{let{startDate:e,endDate:a}=(0,g.P)(s);e&&a&&T(s,e,a)}},children:[(0,t.jsx)("option",{value:"custom",children:"自訂範圍"}),(0,t.jsx)("option",{value:"1q",children:"近一季 (3個月)"}),(0,t.jsx)("option",{value:"2q",children:"近兩季 (6個月)"}),(0,t.jsx)("option",{value:"3q",children:"近三季 (9個月)"}),(0,t.jsx)("option",{value:"1y",children:"近一年 (12個月)"}),(0,t.jsx)("option",{value:"this_year",children:"今年以來"}),(0,t.jsx)("option",{value:"last_2_years",children:"去年＋今年"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"起始日期"}),(0,t.jsx)(h.p,{type:"date",value:A,onChange:e=>G(e.target.value,S),className:"bg-zinc-950/50 border-input text-zinc-100"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-zinc-300",children:"結束日期"}),(0,t.jsx)("button",{onClick:()=>{G(A,new Date().toISOString().split("T")[0])},className:"text-xs text-cyan-400 hover:text-cyan-300",children:"抓取今日"})]}),(0,t.jsx)(h.p,{type:"date",value:S,onChange:e=>G(A,e.target.value),className:"bg-zinc-950/50 border-input text-zinc-100"})]})]}),(0,t.jsxs)("div",{className:"xl:col-span-4 sm:col-span-2 flex items-end gap-4 justify-end mt-4 md:mt-0",children:[(0,t.jsx)("div",{className:"flex items-center gap-4 mr-auto",children:(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm text-zinc-300 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:E,onChange:e=>B(e.target.checked),className:"rounded border-zinc-600 bg-zinc-800 text-violet-500 focus:ring-violet-500 accent-violet-500"}),(0,t.jsx)("span",{children:"排除商辦/店面"})]})}),(0,t.jsxs)(u.$,{variant:"default",className:"bg-violet-600 hover:bg-violet-500 text-white min-w-[120px] hidden md:flex",disabled:0===d.length||s,onClick:()=>{localStorage.setItem("reportReady","true"),window.dispatchEvent(new Event("reportReady")),e?.()},children:[s?(0,t.jsx)("span",{className:"animate-spin mr-2",children:"⟳"}):(0,t.jsx)(f.A,{className:"mr-2 h-4 w-4"}),s?"分析中...":"分析報表"]})]})]})]})]})}var w=a(55810),z=a(75444),k=a(53812),C=a(37847),A=a(83632),S=a(71072),E=a(31840),_=a(30327),P=a(53810),R=a(13545),D=a(6296),$=a(57518);let L=$.bL,T=l.forwardRef(({className:e,...s},a)=>(0,t.jsx)($.B8,{ref:a,className:(0,c.cn)("inline-flex h-10 items-center justify-center rounded-md bg-zinc-800 p-1 text-zinc-400",e),...s}));T.displayName=$.B8.displayName;let G=l.forwardRef(({className:e,...s},a)=>(0,t.jsx)($.l9,{ref:a,className:(0,c.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-zinc-950 data-[state=active]:text-white data-[state=active]:shadow-sm",e),...s}));G.displayName=$.l9.displayName;let B=l.forwardRef(({className:e,...s},a)=>(0,t.jsx)($.UC,{ref:a,className:(0,c.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...s}));B.displayName=$.UC.displayName;var F=a(16385),O=a(39734),q=a(92451),I=a(84980),U=a(67635),M=a(29483);let J=M.bL,V=M.l9,Y=M.ZL;M.bm;let H=l.forwardRef(({className:e,...s},a)=>(0,t.jsx)(M.hJ,{ref:a,className:(0,c.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s}));H.displayName=M.hJ.displayName;let Q=l.forwardRef(({className:e,children:s,...a},l)=>(0,t.jsxs)(Y,{children:[(0,t.jsx)(H,{}),(0,t.jsxs)(M.UC,{ref:l,className:(0,c.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-1/2 data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-1/2 sm:rounded-lg",e),...a,children:[s,(0,t.jsxs)(M.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,t.jsx)(o.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));Q.displayName=M.UC.displayName;let W=({className:e,...s})=>(0,t.jsx)("div",{className:(0,c.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...s});W.displayName="DialogHeader";let K=l.forwardRef(({className:e,...s},a)=>(0,t.jsx)(M.hE,{ref:a,className:(0,c.cn)("text-lg font-semibold leading-none tracking-tight",e),...s}));function Z({trigger:e,analysisData:s}){let[a,i]=(0,l.useState)(!1),[n,c]=(0,l.useState)(!1),[o,x]=(0,l.useState)(null),[m,p]=(0,l.useState)(null),[f,v]=(0,l.useState)(""),[b,j]=(0,l.useState)(!1),g=(0,r.P)(e=>e),N=async()=>{c(!0);try{let e={filters:{counties:g.counties,districts:g.districts,projectNames:g.projectNames,selectedRoomTypes:g.selectedRoomTypes},activeTab:g.activeTab,view:"default"},a=s?{...s,transactionDetails:s.transactionDetails?s.transactionDetails.slice(0,100):[],priceBandAnalysis:s.priceBandAnalysis?{...s.priceBandAnalysis,transactionDetails:void 0}:void 0}:null,{data:t,error:l}=await F.N.functions.invoke("create-snapshot",{body:{title:f||`Market Report - ${new Date().toLocaleDateString()}`,config_json:{...e,data:a},duration_hours:24}});if(l)throw console.error("Edge Function Error:",l),Error(l.message||`Status: ${l.context?.response?.status||"Unknown"}`);let i=window.location.origin,n=`${i}/trb/share?id=${t.snapshot_id}`;x(n),p({expiresAt:t.expires_at})}catch(e){console.error(e),alert("Error creating link: "+(e instanceof Error?e.message:JSON.stringify(e)))}finally{c(!1)}};return(0,t.jsxs)(J,{open:a,onOpenChange:e=>!e&&void(x(null),p(null),v(""),i(!1)),children:[(0,t.jsx)(V,{asChild:!0,onClick:()=>i(!0),children:e||(0,t.jsxs)(u.$,{variant:"outline",size:"sm",className:"gap-2 bg-zinc-900/50 border-white/10 hover:bg-zinc-800 text-cyan-400",children:[(0,t.jsx)(P.A,{className:"w-4 h-4"}),(0,t.jsx)("span",{className:"hidden sm:inline",children:"分享報表"})]})}),(0,t.jsxs)(Q,{className:"bg-zinc-950 border-zinc-800 text-white sm:max-w-md",children:[(0,t.jsx)(W,{children:(0,t.jsxs)(K,{className:"text-xl font-bold flex items-center gap-2",children:[(0,t.jsx)(q.A,{className:"w-5 h-5 text-cyan-400"}),n?"生成報表連結中...":"生成報表分享連結"]})}),o?(0,t.jsxs)("div",{className:"space-y-6 py-4 animate-in fade-in zoom-in-95",children:[(0,t.jsxs)("div",{className:"text-center space-y-2",children:[(0,t.jsx)("div",{className:"w-12 h-12 bg-green-500/10 rounded-full flex items-center justify-center mx-auto mb-2 text-green-500",children:(0,t.jsx)(d.A,{className:"w-6 h-6"})}),(0,t.jsx)("h3",{className:"text-lg font-bold text-white",children:"連結建立成功！"}),(0,t.jsxs)("p",{className:"text-xs text-zinc-500",children:["有效期至：",new Date(m?.expiresAt||"").toLocaleString()]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-zinc-900 rounded-lg border border-zinc-700",children:[(0,t.jsx)("code",{className:"flex-1 text-xs text-zinc-300 break-all line-clamp-2",children:o}),(0,t.jsx)(u.$,{size:"icon",variant:"ghost",onClick:()=>{o&&(navigator.clipboard.writeText(o),j(!0),setTimeout(()=>j(!1),2e3))},className:b?"text-green-400":"text-zinc-400 hover:text-white",children:b?(0,t.jsx)(d.A,{className:"w-4 h-4"}):(0,t.jsx)(U.A,{className:"w-4 h-4"})})]}),(0,t.jsx)(u.$,{variant:"secondary",onClick:()=>i(!1),className:"w-full",children:"完成"})]}):(0,t.jsx)("div",{className:"space-y-6 py-4",children:n?(0,t.jsxs)("div",{className:"space-y-4 animate-in fade-in zoom-in-95",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-xs text-zinc-400",children:[(0,t.jsx)("span",{children:"正在加密分析數據..."}),(0,t.jsx)("span",{className:"animate-pulse",children:"請稍候"})]}),(0,t.jsx)("div",{className:"h-2 w-full bg-zinc-800 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-cyan-500 animate-[progress_2s_ease-in-out_infinite] w-[60%] rounded-full shadow-[0_0_10px_rgba(6,182,212,0.5)]"})})]}),(0,t.jsx)("div",{className:"p-4 bg-cyan-500/5 border border-cyan-500/10 rounded-lg",children:(0,t.jsxs)("p",{className:"text-xs text-cyan-300 flex items-center gap-2",children:[(0,t.jsx)(D.A,{className:"w-3.5 h-3.5 animate-spin"}),"系統正在為您建立專屬的快照頁面"]})})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-zinc-400",children:"報告標題 (選填)"}),(0,t.jsx)(h.p,{placeholder:"例如：信義區 Q1 市場分析...",value:f,onChange:e=>v(e.target.value),className:"bg-zinc-900 border-zinc-700 focus:border-cyan-500"})]}),(0,t.jsxs)("div",{className:"bg-blue-500/10 border border-blue-500/20 rounded-lg p-4 space-y-3",children:[(0,t.jsxs)("h4",{className:"text-sm font-semibold text-blue-400 flex items-center gap-2",children:[(0,t.jsx)(I.A,{className:"w-4 h-4"}),"分享規則說明"]}),(0,t.jsxs)("ul",{className:"text-xs text-zinc-400 space-y-1 list-disc list-inside",children:[(0,t.jsx)("li",{children:"此連結將鎖定您目前的「所有篩選條件」。"}),(0,t.jsx)("li",{children:"接收者看到的數據是**即時**的，但**無法修改**篩選條件。"}),(0,t.jsxs)("li",{children:["連結有效期為 ",(0,t.jsx)("strong",{children:"24 小時"}),"，過期自動失效。"]})]})]}),(0,t.jsx)(u.$,{onClick:N,className:"w-full bg-cyan-600 hover:bg-cyan-500 text-white font-semibold",children:"建立分享連結"})]})})]})]})}K.displayName=M.hE.displayName,l.forwardRef(({className:e,...s},a)=>(0,t.jsx)(M.VY,{ref:a,className:(0,c.cn)("text-sm text-muted-foreground",e),...s})).displayName=M.VY.displayName;var X=a(25777);let ee=({children:e,isGuest:s,blur:a=!0})=>{if(!s)return(0,t.jsx)(t.Fragment,{children:e});let l=async()=>{window.location.href="/"};return(0,t.jsxs)("div",{className:"relative w-full h-full min-h-[400px]",children:[(0,t.jsx)("div",{className:`${a?"filter blur-md opacity-30 select-none pointer-events-none overflow-hidden h-[400px]":""}`,children:e}),(0,t.jsx)("div",{className:"absolute inset-0 z-10 flex items-center justify-center p-6",children:(0,t.jsxs)("div",{className:"bg-zinc-900/90 backdrop-blur-xl border border-white/10 p-8 rounded-2xl shadow-2xl max-w-md w-full text-center space-y-6 animate-in fade-in zoom-in duration-500",children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-zinc-800 rounded-full flex items-center justify-center mx-auto mb-4 border border-white/5 shadow-inner",children:(0,t.jsx)(X.A,{className:"w-8 h-8 text-violet-400"})}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h3",{className:"text-xl font-bold text-white",children:"會員專屬權限"}),(0,t.jsxs)("p",{className:"text-zinc-400 text-sm leading-relaxed",children:["您目前處於訪客模式，僅能查看核心指標數據。",(0,t.jsx)("br",{}),"解鎖完整圖表分析，請登入會員。"]})]}),(0,t.jsxs)("div",{className:"pt-2",children:[(0,t.jsx)("button",{onClick:l,className:"w-full py-3 px-4 bg-[#06C755] hover:bg-[#05b34c] text-white rounded-xl shadow-lg shadow-green-900/20 transition-all font-bold flex items-center justify-center gap-2 transform hover:-translate-y-1",children:(0,t.jsx)("span",{className:"font-bold text-lg",children:"LINE 一鍵登入"})}),(0,t.jsxs)("p",{className:"text-xs text-zinc-600 mt-4",children:["登入即刻享有封測期間 ",(0,t.jsx)("span",{className:"text-violet-400",children:"Pro 進階權限"})]})]})]})})]})};function es(){let e=(0,r.P)(),{loading:s,error:a,analysisData:c,handleAnalyze:o}=(0,O.g)(),[d,x]=(0,l.useState)(!1);(0,l.useEffect)(()=>{(async()=>{let{data:{session:e}}=await F.N.auth.getSession();e?x(!1):x(!0)})()},[]);let m=()=>{var s;let a;return(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6 p-4 rounded-xl bg-zinc-900/30 border border-white/5 backdrop-blur-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"text-lg font-bold text-white flex items-center gap-2",children:[(0,t.jsx)("span",{className:"w-1 h-5 bg-violet-500 rounded-full"}),(s=e.activeTab,a=[{value:"ranking",label:"核心指標與排名"},{value:"price-band",label:"總價帶分析"},{value:"unit-price",label:"單價分析"},{value:"heatmap",label:"調價熱力圖"},{value:"timeline",label:"政策時光機"},{value:"velocity",label:"銷售速度與房型"},{value:"parking",label:"車位分析"},{value:"data-list",label:"交易明細列表"}].find(e=>e.value===s),a?.label||"")]}),(0,t.jsx)("p",{className:"text-xs text-zinc-500 mt-1",children:"針對目前篩選條件下的市場數據深度分析"})]}),!d&&(0,t.jsx)(Z,{analysisData:c,trigger:(0,t.jsxs)(u.$,{className:"bg-cyan-600/10 hover:bg-cyan-600/20 text-cyan-400 border border-cyan-500/30 gap-2 shrink-0",children:[(0,t.jsx)(P.A,{className:"w-4 h-4"}),"分享報表"]})})]})};return(0,t.jsxs)(n.e,{children:[(0,t.jsx)("section",{className:"mb-6 relative z-50",children:(0,t.jsx)(y,{onAnalyze:o,isLoading:s,analysisData:c})}),a&&(0,t.jsxs)("div",{className:"bg-red-500/10 border border-red-500/50 text-red-500 p-4 rounded-lg mb-6 flex items-center gap-2",children:[(0,t.jsx)(R.A,{size:20}),a]}),s&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-20",children:[(0,t.jsx)(D.A,{className:"h-10 w-10 animate-spin text-violet-500 mb-4"}),(0,t.jsx)("p",{className:"text-zinc-400",children:"正在分析數據，請稍候..."})]}),!s&&!c&&!a&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 glass-panel border-dashed border-2 border-zinc-800 rounded-xl",children:[(0,t.jsx)("div",{className:"text-zinc-500 mb-2",children:"尚未進行分析"}),(0,t.jsx)("p",{className:"text-zinc-600 text-sm",children:"請選擇篩選條件並點擊「開始分析」"})]}),!s&&c&&(0,t.jsx)("div",{className:"space-y-8 pb-20",children:(0,t.jsxs)(L,{value:e.activeTab,onValueChange:e.setActiveTab,className:"w-full",children:[(0,t.jsx)("div",{className:"overflow-x-auto pb-2 mask-fade-right pr-8",children:(0,t.jsxs)(T,{className:"bg-zinc-900/50 border border-white/5 p-1 mb-6 inline-flex min-w-max",children:[(0,t.jsx)(G,{value:"ranking",className:"whitespace-nowrap",children:"核心指標與排名"}),(0,t.jsx)(G,{value:"price-band",className:"whitespace-nowrap",children:"總價帶分析"}),(0,t.jsx)(G,{value:"unit-price",className:"whitespace-nowrap",children:"單價分析"}),(0,t.jsx)(G,{value:"heatmap",className:"whitespace-nowrap",children:"調價熱力圖"}),(0,t.jsx)(G,{value:"timeline",className:"whitespace-nowrap",children:"政策時光機"}),(0,t.jsx)(G,{value:"velocity",className:"whitespace-nowrap",children:"銷售速度與房型"}),(0,t.jsx)(G,{value:"parking",className:"whitespace-nowrap",children:"車位分析"}),(0,t.jsx)(G,{value:"data-list",className:"whitespace-nowrap",children:"交易明細列表"})]})}),(0,t.jsxs)(B,{value:"ranking",className:"focus-visible:outline-none focus-visible:ring-0",children:[m(),(0,t.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,t.jsx)(w.p,{data:c})})]}),(0,t.jsxs)(B,{value:"price-band",className:"focus-visible:outline-none focus-visible:ring-0",children:[m(),(0,t.jsx)(ee,{isGuest:d,children:(0,t.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,t.jsx)(z.P,{data:c.priceBandAnalysis?{...c.priceBandAnalysis,transactionDetails:c.transactionDetails}:null})})})]}),(0,t.jsxs)(B,{value:"unit-price",className:"focus-visible:outline-none focus-visible:ring-0",children:[m(),(0,t.jsx)(ee,{isGuest:d,children:(0,t.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,t.jsx)(A.U,{data:c})})})]}),(0,t.jsxs)(B,{value:"heatmap",className:"focus-visible:outline-none focus-visible:ring-0",children:[m(),(0,t.jsx)(ee,{isGuest:d,children:(0,t.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,t.jsx)(S.b,{data:c.priceGridAnalysis?c:null})})})]}),(0,t.jsxs)(B,{value:"timeline",className:"focus-visible:outline-none focus-visible:ring-0",children:[m(),(0,t.jsx)(ee,{isGuest:d,children:(0,t.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,t.jsx)(_.A,{data:c.transactionDetails})})})]}),(0,t.jsxs)(B,{value:"velocity",className:"focus-visible:outline-none focus-visible:ring-0",children:[m(),(0,t.jsx)(ee,{isGuest:d,children:(0,t.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,t.jsx)(k.Q,{data:c})})})]}),(0,t.jsxs)(B,{value:"parking",className:"focus-visible:outline-none focus-visible:ring-0",children:[m(),(0,t.jsx)(ee,{isGuest:d,children:(0,t.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,t.jsx)(C.v,{data:c.parkingAnalysis?.parkingRatio?c:null})})})]}),(0,t.jsxs)(B,{value:"data-list",className:"focus-visible:outline-none focus-visible:ring-0",children:[m(),(0,t.jsx)(ee,{isGuest:d,children:(0,t.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,t.jsx)(E.p,{trigger:c.transactionDetails?.length?c:null})})})]})]})})]})}},99687:(e,s,a)=>{Promise.resolve().then(a.bind(a,39488))}},e=>{e.O(0,[4764,5969,3242,6119,5772,310,6609,9163,8434,8500,916,1007,5679,8441,3794,7358],()=>e(e.s=99687)),_N_E=e.O()}]);