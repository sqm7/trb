(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{32666:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>ej});var a=s(95155),n=s(12115),i=s(39430),r=s(58822),l=s(88743),o=s(40980),c=s(33210),d=s(94514);let x=(0,n.forwardRef)(({options:e,value:t,onChange:s,placeholder:i="Select...",maxItems:r,disabled:l=!1,className:x,onSearch:m,loading:h=!1,onFocus:p},u)=>{let[f,g]=(0,n.useState)(""),[b,j]=(0,n.useState)(!1),v=(0,n.useRef)(null),y=(0,n.useRef)(null),N=m?e:e.filter(e=>e.label.toLowerCase().includes(f.toLowerCase()));return t.map(t=>{let s=e.find(e=>e.value===t);return s?s.label:t}),(0,n.useEffect)(()=>{let e=e=>{v.current&&!v.current.contains(e.target)&&j(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,n.useEffect)(()=>{m&&m(f)},[f,m]),(0,a.jsxs)("div",{className:(0,o.cn)("relative w-full",x),ref:v,children:[(0,a.jsxs)("div",{className:(0,o.cn)("flex items-center gap-2 bg-zinc-950/50 border border-input rounded-md px-2 py-1.5 h-[42px] overflow-x-auto custom-scrollbar cursor-text transition-all",b&&"ring-2 ring-ring ring-offset-0 border-ring",l&&"bg-zinc-900/50 cursor-not-allowed opacity-50"),onClick:()=>!l&&y.current?.focus(),children:[t.map(n=>{let i=e.find(e=>e.value===n),r=i?i.label:n;return(0,a.jsxs)("span",{className:"bg-violet-500/20 text-violet-200 border border-violet-500/30 text-xs rounded-full px-2 py-0.5 flex items-center gap-1 animate-in fade-in zoom-in-95 duration-100 whitespace-nowrap shrink-0",children:[r,!l&&(0,a.jsx)(c.A,{size:12,className:"cursor-pointer hover:text-white transition-colors",onClick:e=>{e.stopPropagation(),s(t.filter(e=>e!==n))}})]},n)}),(0,a.jsx)("input",{ref:y,type:"text",value:f,onChange:e=>g(e.target.value),onFocus:()=>{j(!0),p?.()},onKeyDown:e=>{"Backspace"===e.key&&""===f&&t.length>0&&s(t.slice(0,-1))},placeholder:0===t.length?i:"",className:(0,o.cn)("bg-transparent outline-none flex-grow min-w-[60px] text-zinc-100 placeholder:text-zinc-500 text-sm",l&&"cursor-not-allowed"),disabled:l})]}),b&&!l&&(0,a.jsx)("div",{className:"absolute z-[110] w-full mt-1 bg-zinc-900 border border-zinc-700 rounded-md shadow-xl max-h-60 overflow-y-auto custom-scrollbar animate-in fade-in slide-in-from-top-2 duration-100",children:h?(0,a.jsx)("div",{className:"p-2 text-center text-zinc-500 text-sm",children:"Loading..."}):0===N.length?(0,a.jsx)("div",{className:"p-2 text-center text-zinc-500 text-sm",children:"No options found"}):N.map((e,i)=>{if(!e)return null;let l=0===i||e.group!==N[i-1]?.group;return(0,a.jsxs)(n.Fragment,{children:[l&&e.group&&(0,a.jsx)("div",{className:"px-2 py-1 bg-zinc-800/50 text-xs font-semibold text-zinc-400 sticky top-0 backdrop-blur-sm z-10",children:e.group}),(0,a.jsxs)("div",{className:(0,o.cn)("px-3 py-2 cursor-pointer text-sm flex items-start justify-between hover:bg-zinc-800 transition-colors",t.includes(e.value)&&"bg-violet-500/10 text-violet-400"),onClick:()=>(e=>{if(t.includes(e))s(t.filter(t=>t!==e));else{if(r&&t.length>=r)return;s([...t,e])}g("")})(e.value),children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"font-medium",children:e.label}),e.details&&(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-0.5",children:[(e.details.county||e.details.district)&&(0,a.jsxs)("span",{className:"text-xs text-zinc-500 bg-zinc-800/80 px-1.5 rounded border border-zinc-700",children:[e.details.county,e.details.district]}),e.details.date&&(0,a.jsx)("span",{className:"text-xs text-zinc-600 font-mono",children:e.details.date.substring(0,7)})]})]}),t.includes(e.value)&&(0,a.jsx)(d.A,{size:16,className:"mt-1"})]})]},e.value)})})]})});x.displayName="MultiSelect";var m=s(29991),h=s(89239),p=s(60529),u=s(92622),f=s(26179),g=s(80642),b=s(55873),j=s(27529),v=s(98883);let y=[{value:"ranking",label:"核心指標與排名"},{value:"price-band",label:"總價帶分析"},{value:"unit-price",label:"單價分析"},{value:"heatmap",label:"調價熱力圖"},{value:"timeline",label:"政策時光機"},{value:"velocity",label:"銷售速度與房型"},{value:"parking",label:"車位分析"},{value:"data-list",label:"交易明細列表"}];function N({onAnalyze:e,isLoading:t}){let s,{counties:r,districts:d,transactionType:N,buildingType:w,projectNames:z,dateRange:_,startDate:k,endDate:A,excludeCommercial:P,activeTab:S,setCounties:C,setDistricts:M,setTransactionType:I,setBuildingType:F,setProjectNames:$,setDateRange:D,setCustomDate:E,setExcludeCommercial:B,setActiveTab:Z,resetFilters:L,isFilterBarCompact:R,setIsFilterBarCompact:T}=(0,l.P)(),[O,U]=(0,n.useState)(!1),[W,q]=(0,n.useState)([]),[G,Y]=(0,n.useState)(!1),H=Object.keys(b.WG).map(e=>({label:e,value:e})),X=n.useMemo(()=>0===r.length?[]:r.flatMap(e=>(b.Ib[e]||[]).map(t=>({label:t,value:t,group:e}))),[r]),V=(0,n.useRef)(null),[Q,K]=(0,n.useState)(null),J=(0,n.useCallback)(async e=>{if(0===r.length)return void q([]);Y(!0),K(null);try{let t=r.map(async t=>{let s=b.WG[t],a=d.filter(e=>b.Ib[t]?.includes(e));return j.FH.fetchProjectNameSuggestions(s,e,a).then(e=>{let s=[];return Array.isArray(e)?s=e:e&&e.data&&Array.isArray(e.data)?s=e.data:e&&e.names&&Array.isArray(e.names)&&(s=e.names),s.map(e=>{let s="string"==typeof e,a=s?e:e.name||e.建案名稱||String(e);return{label:a,value:a,group:t,details:s?void 0:{county:t,district:e.district||e.行政區,date:e.earliestDate||e.交易日}}})}).catch(e=>(console.error(`Failed to fetch projects for ${t}:`,e),[]))}),s=(await Promise.all(t)).flat(),a=Array.from(new Map(s.map(e=>[e.value,e])).values());q(a),0===a.length&&e.length>=2&&console.log(`No projects found for query "${e}" in counties: ${r.join(", ")}`)}catch(e){console.error("Project search error:",e),K("搜尋失敗，請稍後再試")}finally{Y(!1)}},[r,d]),ee=(0,n.useCallback)(e=>{V.current&&clearTimeout(V.current),V.current=setTimeout(()=>{J(e)},300)},[J]);(0,n.useEffect)(()=>()=>{V.current&&clearTimeout(V.current)},[]);let et=(0,n.useRef)(null),[es,ea]=(0,n.useState)(0);return(0,n.useEffect)(()=>{if(!et.current)return;let e=new ResizeObserver(e=>{for(let t of e)ea(t.contentRect.height)});return e.observe(et.current),()=>e.disconnect()},[R]),(0,n.useEffect)(()=>{let e=()=>{let e=window.scrollY;e>250?R||T(!0):e<120&&R&&T(!1)};return window.addEventListener("scroll",e,{passive:!0}),()=>window.removeEventListener("scroll",e)},[R,T]),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(g.N,{children:R&&(0,a.jsxs)(i.P.div,{initial:{opacity:0,y:-20,x:"-50%",scale:.95},animate:{opacity:1,y:0,x:"-50%",scale:1},exit:{opacity:0,y:-20,x:"-50%",scale:.95},transition:{duration:.2,ease:"easeOut"},className:"fixed top-3 left-1/2 z-[100] p-1 glass-card rounded-full shadow-2xl flex items-center justify-between gap-1 transition-all mx-auto max-w-[95vw] md:max-w-7xl backdrop-blur-2xl border border-white/20 origin-top",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 pl-2 pr-2 py-1.5 hover:bg-white/5 rounded-full transition-colors cursor-pointer shrink-0",onClick:()=>{T(!1),window.scrollTo({top:0,behavior:"smooth"})},children:[(0,a.jsx)("div",{className:"h-7 w-7 rounded-full bg-violet-600/30 text-violet-300 flex items-center justify-center shrink-0 border border-violet-500/30",children:(0,a.jsx)(u.A,{className:"h-3.5 w-3.5"})}),(0,a.jsxs)("div",{className:"flex flex-col leading-none overflow-hidden max-w-[100px] xs:max-w-[140px]",children:[(0,a.jsxs)("span",{className:"text-[10px] text-zinc-400 font-medium truncate",children:[(s=[],r.length>0&&s.push(`${r.length} 縣市`),N&&s.push(N.replace("交易","")),"custom"!==_?s.push({"1q":"近一季","2q":"近兩季","3q":"近三季","1y":"近一年",this_year:"今年",last_2_years:"近兩年"}[_]||_):s.push("自訂期間"),s.join(" • ")||"請選擇篩選條件").split("•")[0],"..."]}),(0,a.jsx)("span",{className:"text-[9px] text-zinc-600 font-mono mt-0.5",children:"點擊展開"})]})]}),(0,a.jsx)("div",{className:"flex-1 min-w-0 flex items-center gap-1 px-1 border-l border-white/10 overflow-x-auto mask-fade-right pb-2 pr-8",children:y.map(e=>(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),Z(e.value)},className:(0,o.cn)("px-2.5 py-1 rounded-full text-[10px] font-bold transition-all whitespace-nowrap active:scale-95 touch-manipulation",S===e.value?"bg-violet-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-500 hover:text-zinc-300 bg-zinc-800/20"),children:e.label.replace("分析","").replace("指標與","").replace("交易","")},e.value))}),(0,a.jsx)("div",{className:"pr-2 pl-1 hidden sm:block",children:(0,a.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-cyan-500/50 animate-pulse",title:"操作中"})})]},"compact-pill")}),(0,a.jsxs)("div",{ref:et,className:`p-4 md:p-6 glass-card rounded-xl shadow-lg transition-opacity duration-200 ${R?"opacity-0 pointer-events-none":"opacity-100"}`,children:[(0,a.jsxs)("div",{className:"flex md:hidden items-center justify-between mb-4",children:[(0,a.jsxs)("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[(0,a.jsx)(u.A,{className:"h-5 w-5 text-violet-500"}),"篩選條件"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(h.$,{variant:"outline",size:"sm",onClick:()=>U(!O),className:"border-zinc-700 text-zinc-300",children:[O?(0,a.jsx)(c.A,{className:"h-4 w-4"}):(0,a.jsx)(u.A,{className:"h-4 w-4"}),O?"收起":"展開"]}),(0,a.jsx)(h.$,{variant:"default",size:"sm",className:"bg-violet-600 text-white",disabled:0===r.length||t,onClick:e,children:t?"...":"分析"})]})]}),(0,a.jsxs)("div",{className:`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-7 gap-4 items-end ${O?"block":"hidden md:grid"}`,children:[(0,a.jsxs)("div",{className:"xl:col-span-1",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-zinc-300",children:"縣市"}),r.length>3&&(0,a.jsxs)("span",{className:"text-xs text-amber-500 font-normal animate-in fade-in",children:["(已選 ",r.length,"/6)"]})]}),r.length>0&&(0,a.jsx)("button",{onClick:()=>C([]),className:"text-xs text-cyan-400 hover:text-cyan-300",children:"清除"})]}),(0,a.jsx)(x,{options:H,value:r,onChange:e=>{e.length>6||C(e)},placeholder:"請選擇縣市...",maxItems:6})]}),(0,a.jsxs)("div",{className:"xl:col-span-1",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-zinc-300",children:"行政區"}),d.length>0&&(0,a.jsx)("button",{onClick:()=>M([]),className:"text-xs text-cyan-400 hover:text-cyan-300",children:"清除"})]}),(0,a.jsx)(x,{options:X,value:d,onChange:e=>{M(e)},placeholder:r.length>0?"請選擇行政區...":"請先選縣市",disabled:0===r.length})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"交易類型"}),(0,a.jsxs)(m.l,{value:N,onChange:e=>I(e.target.value),children:[(0,a.jsx)("option",{value:"預售交易",children:"預售交易"}),(0,a.jsx)("option",{value:"中古交易",disabled:!0,children:"中古交易 (開發中)"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"建物型態"}),(0,a.jsxs)(m.l,{value:w,onChange:e=>F(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"全部"}),(0,a.jsx)("option",{value:"住宅大樓(11層含以上有電梯)",children:"住宅大樓"}),(0,a.jsx)("option",{value:"華廈(10層含以下有電梯)",children:"華廈"}),(0,a.jsx)("option",{value:"公寓(5層含以下無電梯)",children:"公寓"}),(0,a.jsx)("option",{value:"套房(1房(1廳)1衛)",children:"套房"}),(0,a.jsx)("option",{value:"透天厝",children:"透天厝"}),(0,a.jsx)("option",{value:"店面(店鋪)",children:"店面"}),(0,a.jsx)("option",{value:"辦公商業大樓",children:"辦公商業大樓"}),(0,a.jsx)("option",{value:"工廠",children:"工廠/廠辦"}),(0,a.jsx)("option",{value:"其他",children:"其他"})]})]}),(0,a.jsxs)("div",{className:"xl:col-span-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-zinc-300",children:"建案名稱"}),z.length>0&&(0,a.jsx)("button",{onClick:()=>$([]),className:"text-xs text-cyan-400 hover:text-cyan-300",children:"清除"})]}),(0,a.jsx)(x,{options:W,value:z,onChange:$,placeholder:r.length>0?"輸入建案名稱搜尋...":"請先選縣市",disabled:0===r.length,onSearch:ee,loading:G,onFocus:()=>{0===z.length&&0===W.length&&J("")}}),Q&&(0,a.jsx)("span",{className:"text-xs text-red-400 mt-1",children:Q})]}),(0,a.jsxs)("div",{className:"xl:col-span-3 sm:col-span-2 grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"快捷時間"}),(0,a.jsxs)(m.l,{value:_,onChange:e=>{let t=e.target.value;if("custom"===t)D("custom",k,A);else{let{startDate:e,endDate:s}=(0,v.P)(t);e&&s&&D(t,e,s)}},children:[(0,a.jsx)("option",{value:"custom",children:"自訂範圍"}),(0,a.jsx)("option",{value:"1q",children:"近一季 (3個月)"}),(0,a.jsx)("option",{value:"2q",children:"近兩季 (6個月)"}),(0,a.jsx)("option",{value:"3q",children:"近三季 (9個月)"}),(0,a.jsx)("option",{value:"1y",children:"近一年 (12個月)"}),(0,a.jsx)("option",{value:"this_year",children:"今年以來"}),(0,a.jsx)("option",{value:"last_2_years",children:"去年＋今年"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"起始日期"}),(0,a.jsx)(p.p,{type:"date",value:k,onChange:e=>E(e.target.value,A),className:"bg-zinc-950/50 border-input text-zinc-100"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-zinc-300",children:"結束日期"}),(0,a.jsx)("button",{onClick:()=>{E(k,new Date().toISOString().split("T")[0])},className:"text-xs text-cyan-400 hover:text-cyan-300",children:"抓取今日"})]}),(0,a.jsx)(p.p,{type:"date",value:A,onChange:e=>E(k,e.target.value),className:"bg-zinc-950/50 border-input text-zinc-100"})]})]}),(0,a.jsxs)("div",{className:"xl:col-span-4 sm:col-span-2 flex items-end gap-4 justify-end mt-4 md:mt-0",children:[(0,a.jsx)("div",{className:"flex items-center gap-4 mr-auto",children:(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm text-zinc-300 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:P,onChange:e=>B(e.target.checked),className:"rounded border-zinc-600 bg-zinc-800 text-violet-500 focus:ring-violet-500 accent-violet-500"}),(0,a.jsx)("span",{children:"排除商辦/店面"})]})}),(0,a.jsxs)(h.$,{variant:"default",className:"bg-violet-600 hover:bg-violet-500 text-white min-w-[120px] hidden md:flex",disabled:0===r.length||t,onClick:()=>{localStorage.setItem("reportReady","true"),window.dispatchEvent(new Event("reportReady")),e?.()},children:[t?(0,a.jsx)("span",{className:"animate-spin mr-2",children:"⟳"}):(0,a.jsx)(f.A,{className:"mr-2 h-4 w-4"}),t?"分析中...":"分析報表"]})]})]})]})]})}var w=s(55810),z=s(75444),_=s(53812),k=s(68605),A=s(97085);function P({data:e}){let t=(0,n.useMemo)(()=>e?[e.withParking.count,e.withoutParking.count]:[],[e]),s=(0,n.useMemo)(()=>({chart:{type:"donut",background:"transparent",foreColor:"#e5e7eb"},labels:["含車位","無車位"],colors:["#a5b4fc","#4b5563"],plotOptions:{pie:{donut:{labels:{show:!0,total:{show:!0,label:"總交易",color:"#e5e7eb",formatter:e=>e.globals.seriesTotals.reduce((e,t)=>e+t,0).toLocaleString()+" 筆"}}}}},dataLabels:{enabled:!0,formatter:e=>`${e.toFixed(1)}%`},legend:{show:!1},tooltip:{theme:"dark",y:{formatter:e=>`${e} 筆`}},stroke:{show:!1},responsive:[{breakpoint:480,options:{chart:{width:300},legend:{position:"bottom"}}}]}),[]);return e&&(0!==e.withParking.count||0!==e.withoutParking.count)?(0,a.jsx)(A.A,{type:"donut",series:t,options:s,height:350,className:"w-full"}):(0,a.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無車位配比資料"})}function S({data:e,xLabel:t,yLabel:s,xUnit:i="",yUnit:r="",title:l,highlightIds:c=[]}){let[d,x]=(0,n.useState)(null),[m,h]=(0,n.useState)(null),[p,u]=(0,n.useState)({x:0,y:0}),{xMin:f,xMax:g,yMin:b,yMax:j}=(0,n.useMemo)(()=>{if(0===e.length)return{xMin:0,xMax:100,yMin:0,yMax:100};let t=e.map(e=>e.x),s=e.map(e=>e.y),a=Math.min(...t),n=Math.max(...t),i=Math.min(...s),r=Math.max(...s),l=(n-a)*.1||1,o=(r-i)*.1||1;return{xMin:Math.max(0,a-l),xMax:n+l,yMin:Math.max(0,i-o),yMax:r+o}},[e]),v=c.length>0,y=e=>{let t=e.currentTarget.closest(".relative.bg-zinc-900\\/30")?.getBoundingClientRect();t&&u({x:e.clientX-t.left,y:e.clientY-t.top})},N=m||d,w=(0,n.useMemo)(()=>c.length?[...e].sort((e,t)=>!!c.includes(e.id)-!!c.includes(t.id)):e,[e,c]);return(0,a.jsxs)("div",{className:"w-full h-[400px] relative bg-zinc-900/30 rounded-xl border border-white/5 p-4 select-none cursor-crosshair",onClick:()=>{h(null),x(null)},onMouseMove:e=>{!m&&d&&y(e)},children:[l&&(0,a.jsx)("h4",{className:"absolute top-4 left-4 text-sm font-medium text-zinc-400 pointer-events-none",children:l}),(0,a.jsxs)("div",{className:"absolute inset-x-12 inset-y-12 pointer-events-none",children:[(0,a.jsx)("div",{className:"absolute inset-0 flex flex-col justify-between opacity-20",children:[0,.25,.5,.75,1].map(e=>(0,a.jsx)("div",{className:"w-full h-px border-t border-dashed border-zinc-500"},e))}),(0,a.jsx)("div",{className:"absolute inset-0 flex justify-between opacity-20",children:[0,.25,.5,.75,1].map(e=>(0,a.jsx)("div",{className:"h-full w-px border-l border-dashed border-zinc-500"},e))})]}),(0,a.jsx)("div",{className:"absolute inset-x-12 inset-y-12",children:w.map(e=>{var t,s;let n=(t=e.x,s=e.y,{left:`${(t-f)/(g-f)*100}%`,top:`${100-(s-b)/(j-b)*100}%`}),i=d?.id===e.id,r=m?.id===e.id,l=v&&c.includes(e.id),p="bg-cyan-500/60 hover:bg-cyan-400 z-10",u="";return v&&(l?(p="bg-yellow-400 shadow-[0_0_10px_rgba(250,204,21,0.6)] z-20",u="scale-125"):p="bg-zinc-700/30 z-0"),(i||r)&&(p="bg-cyan-400 shadow-[0_0_15px_rgba(34,211,238,0.8)] ring-2 ring-white z-30",u="scale-150",v&&l&&(p="bg-yellow-400 shadow-[0_0_15px_rgba(250,204,21,0.8)] ring-2 ring-white z-30")),(0,a.jsx)("div",{className:(0,o.cn)("absolute w-3 h-3 rounded-full cursor-pointer transition-all duration-300 transform -translate-x-1/2 -translate-y-1/2",p,u),style:{left:n.left,top:n.top},onMouseEnter:t=>{m||(!v||c.includes(e.id))&&(x(e),y(t))},onMouseLeave:()=>!m&&x(null),onClick:t=>{t.stopPropagation(),(!v||c.includes(e.id))&&(m?.id===e.id?(h(null),x(e)):(h(e),x(null),y(t)))}},e.id)})}),(0,a.jsxs)("div",{className:"absolute left-0 top-12 bottom-12 w-10 flex flex-col justify-between text-[10px] text-zinc-500 text-right pr-2 pointer-events-none",children:[(0,a.jsxs)("span",{children:[Math.round(j),r]}),(0,a.jsxs)("span",{children:[Math.round(b),r]})]}),(0,a.jsxs)("div",{className:"absolute left-12 right-12 bottom-4 h-6 flex justify-between text-[10px] text-zinc-500 pt-1 pointer-events-none",children:[(0,a.jsxs)("span",{children:[Math.round(f),i]}),(0,a.jsxs)("span",{children:[Math.round(g),i]})]}),(0,a.jsx)("div",{className:"absolute bottom-1 left-1/2 -translate-x-1/2 text-xs text-zinc-400 font-bold pointer-events-none",children:t}),(0,a.jsx)("div",{className:"absolute left-1 top-1/2 -translate-y-1/2 -rotate-90 text-xs text-zinc-400 font-bold pointer-events-none",children:s}),N&&(0,a.jsx)("div",{className:"absolute z-50 pointer-events-none",style:{left:p.x,top:p.y,transform:"translate(10px, 10px)"},children:(0,a.jsxs)("div",{className:"bg-zinc-950/90 border border-cyan-500/30 rounded-lg p-3 shadow-xl backdrop-blur-md w-48 animate-in zoom-in-95 fade-in duration-200",children:[(0,a.jsx)("div",{className:"text-sm font-bold text-white mb-1",children:N.label}),(0,a.jsxs)("div",{className:"space-y-1 text-xs text-zinc-400",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{children:[t,":"]}),(0,a.jsxs)("span",{className:"text-cyan-400 font-mono",children:[N.x.toLocaleString()," ",i]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("span",{children:[s,":"]}),(0,a.jsxs)("span",{className:"text-cyan-400 font-mono",children:[N.y.toLocaleString()," ",r]})]})]})]})})]})}var C=s(47650);function M({data:e,selectedFloors:t,hoveredFloor:s,onHover:r,onToggle:l,onDetail:c,floorColors:d}){let x=[...e].sort((e,t)=>{let s=e=>"B1"===e?1:"B2"===e?2:"B3"===e?3:"B4"===e?4:e.includes("B5")?5:99;return s(e.floor)-s(t.floor)}),m=x.length>4?Math.max(.7,4/x.length):1,h=n.useRef(null),[p,u]=n.useState(!1);n.useEffect(()=>{u(!0)},[]);let f=x.find(e=>e.floor===s);return(0,a.jsxs)("div",{className:"w-full h-[600px] flex items-start justify-start relative perspective-container overflow-visible pl-12 lg:pl-24 -mt-12",onMouseMove:e=>{if(h.current){let t=e.clientX+12,s=e.clientY+12;h.current.style.transform=`translate3d(${t}px, ${s}px, 0)`}},children:[(0,a.jsx)("div",{className:"relative flex items-center justify-center preserve-3d",style:{width:240,height:240,perspective:"3000px",transformStyle:"preserve-3d",zIndex:10,transform:`scale(${m})`},children:(0,a.jsx)(i.P.div,{className:"relative preserve-3d",initial:{rotateX:60,rotateZ:45},animate:{rotateX:60,rotateZ:45},transition:{duration:.8,ease:"easeOut"},style:{transformStyle:"preserve-3d",width:"100%",height:"100%"},children:(0,a.jsx)(g.N,{children:x.map((e,n)=>{let i=t.includes(e.floor),l=s===e.floor,o=d[e.floor]||"#71717a";return(0,a.jsx)(I,{data:e,color:o,isSelected:i,isHovered:l,active:i,onHover:()=>r(e.floor),onLeave:()=>r(null),onDetail:()=>c(e.floor),zIndex:x.length-n,baseZ:-(110*n),thickness:40},e.floor)})})})}),p&&(0,C.createPortal)((0,a.jsx)("div",{className:"fixed inset-0 pointer-events-none z-[9999]",children:(0,a.jsx)(g.N,{children:f&&(0,a.jsx)("div",{ref:h,className:"absolute top-0 left-0 will-change-transform",style:{transform:"translate3d(-500px, -500px, 0)"},children:(0,a.jsx)(i.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95,transition:{duration:.1}},transition:{type:"spring",stiffness:400,damping:25},className:"flex items-center justify-start",children:(0,a.jsxs)("div",{className:"flex items-center gap-3 whitespace-nowrap",children:[(0,a.jsx)("span",{className:(0,o.cn)("text-6xl font-black text-white drop-shadow-[0_5px_8px_rgba(0,0,0,0.8)] leading-none","font-sans italic tracking-tighter"),style:{textShadow:"0 0 30px rgba(255,255,255,0.4)"},children:f.floor}),(0,a.jsxs)("div",{className:"bg-zinc-950/95 border-l-4 border-cyan-500 backdrop-blur-xl px-4 py-2 rounded-r-lg shadow-[0_20px_50px_rgba(0,0,0,0.5)] flex items-center gap-6 border border-white/10",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-[10px] text-zinc-500 uppercase font-black leading-none mb-1 tracking-widest",children:"均價 (萬)"}),(0,a.jsx)("div",{className:"text-2xl font-mono font-bold text-cyan-400 leading-none",children:Math.round(f.avgPrice).toLocaleString()})]}),(0,a.jsx)("div",{className:"h-8 w-px bg-white/10"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-[10px] text-zinc-500 uppercase font-black leading-none mb-1 tracking-widest",children:"成交量"}),(0,a.jsx)("div",{className:"text-xl font-mono text-zinc-100 leading-none font-medium",children:f.count})]})]})]})},"tooltip")})})}),document.body)]})}function I({data:e,color:t,isSelected:s,isHovered:n,active:r,onHover:l,onLeave:c,onDetail:d,zIndex:x,baseZ:m,thickness:h}){let p=n?t:"#52525b";return(0,a.jsxs)(i.P.div,{className:(0,o.cn)("absolute top-0 left-0 w-full h-full preserve-3d pointer-events-none",!r&&"pointer-events-none"),initial:{scale:.9,opacity:0},animate:{translateZ:m+0,scale:+!!r,opacity:+!!r},transition:{type:"spring",stiffness:600,damping:15},style:{transformStyle:"preserve-3d",zIndex:x},children:[(0,a.jsx)("div",{className:"absolute inset-0 rounded-sm overflow-hidden transition-all duration-75 pointer-events-auto cursor-pointer",style:{backgroundColor:p,backgroundImage:n?"linear-gradient(135deg, rgba(255,255,255,0.6) 0%, rgba(255,255,255,0.1) 50%, rgba(0,0,0,0.2) 100%)":"linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.05) 50%, rgba(0,0,0,0.1) 100%)",filter:n?"none":"brightness(1.1)",boxShadow:n?`inset 0 0 0 1px rgba(255,255,255,0.4), 0 0 30px -5px ${t}`:"inset 0 0 0 1px rgba(255,255,255,0.1)"},onMouseEnter:l,onMouseLeave:c,onClick:e=>{e.stopPropagation(),d()},children:(0,a.jsx)(i.P.div,{initial:{x:"-100%"},animate:n?{x:"200%"}:{x:"-100%"},transition:{duration:1.5,repeat:1/0,repeatDelay:1},className:"absolute top-0 left-0 w-1/2 h-full bg-gradient-to-r from-transparent via-white/20 to-transparent skew-x-12 pointer-events-none"})}),(0,a.jsx)("div",{className:"absolute top-0 origin-top-right transition-all duration-75 pointer-events-auto cursor-pointer",style:{right:0,width:h,height:"100%",backgroundColor:p,filter:n?"brightness(0.6)":"brightness(0.5)",left:"100%",transformOrigin:"left center",transform:"rotateY(90deg)"},onMouseEnter:l,onMouseLeave:c,onClick:e=>{e.stopPropagation(),d()}}),(0,a.jsx)("div",{className:"absolute left-0 origin-bottom-left transition-all duration-75 pointer-events-auto cursor-pointer",style:{bottom:0,width:"100%",height:h,backgroundColor:p,filter:n?"brightness(0.8)":"brightness(0.3)",top:"100%",transformOrigin:"top center",transform:"rotateX(-90deg)"},onMouseEnter:l,onMouseLeave:c,onClick:e=>{e.stopPropagation(),d()}})]})}var F=s(94961),$=s(57420),D=s(61878),E=s(51806),B=s(78795),Z=s(68459);function L({projects:e,className:t,onChange:s,max:i=6,placeholder:r="搜尋並加入比較...",title:l="建案亮點標示"}){let[c,x]=(0,n.useState)(""),[m,h]=(0,n.useState)([]),[p,u]=(0,n.useState)(!1),f=(0,n.useRef)(null),g=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=e=>{f.current&&!f.current.contains(e.target)&&u(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let b=e.filter(e=>!m.includes(e.value)&&e.label.toLowerCase().includes(c.toLowerCase())).slice(0,10);return(0,a.jsxs)("div",{className:(0,o.cn)("space-y-2",t),ref:f,children:[(0,a.jsxs)("div",{className:"flex justify-between items-center bg-zinc-900/50 p-1 rounded-lg border border-white/5",children:[(0,a.jsxs)("h4",{className:"text-sm font-medium text-zinc-400 pl-2 border-l-2 border-yellow-500",children:[l," ",(0,a.jsxs)("span",{className:"text-xs font-normal text-zinc-600",children:["(最多 ",i," 個)"]})]}),m.length>0&&(0,a.jsxs)("button",{onClick:()=>{h([]),s([]),g.current?.focus()},className:"p-1.5 text-zinc-500 hover:text-rose-400 hover:bg-rose-500/10 rounded transition-colors flex items-center gap-1 text-xs",title:"清除所有選擇",children:[(0,a.jsx)(Z.A,{size:14}),"清除"]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 min-h-[32px]",children:[0===m.length&&(0,a.jsx)("span",{className:"text-xs text-zinc-600 italic py-1",children:"尚未選擇建案..."}),m.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-1 bg-yellow-500/10 text-yellow-500 px-2 py-1 rounded text-xs border border-yellow-500/30",children:[(0,a.jsx)("span",{children:e}),(0,a.jsx)("button",{onClick:()=>{let t;h(t=m.filter(t=>t!==e)),s(t)},className:"hover:text-yellow-300",children:(0,a.jsx)(d.A,{size:12,className:"rotate-45"})})]},e))]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(D.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-500"}),(0,a.jsx)("input",{ref:g,type:"text",value:c,onChange:e=>{x(e.target.value),u(!0)},onFocus:()=>u(!0),placeholder:r,className:"w-full bg-zinc-900/50 border border-white/10 rounded-lg pl-9 pr-4 py-2 text-sm text-white placeholder:text-zinc-600 focus:outline-none focus:ring-1 focus:ring-cyan-500/50 transition-all",disabled:m.length>=i}),p&&(0,a.jsx)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-zinc-900 border border-white/10 rounded-lg shadow-xl z-50 max-h-60 overflow-y-auto",children:b.length>0?b.map(e=>(0,a.jsx)("button",{onClick:()=>(e=>{if(m.length>=i)return;let t=[...m,e];h(t),s(t),x(""),g.current?.focus()})(e.value),className:"w-full text-left px-3 py-2 text-sm text-zinc-300 hover:bg-white/5 hover:text-white transition-colors",children:e.label},e.value)):(0,a.jsx)("div",{className:"px-3 py-2 text-sm text-zinc-600",children:"無相關建案"})})]})]})}function R({chartData:e,hasData:t,summaryStats:s}){let[i,r]=(0,n.useState)("scale"),[l,c]=(0,n.useState)(null);n.useRef(null);let[d,x]=(0,n.useState)([]);if(!t)return(0,a.jsx)("p",{className:"text-zinc-500 text-center py-4",children:"無坡道平面車位坪數資料"});let m="scale"===i?e.map(e=>({id:e.id,label:e.id,x:e.count,y:e.avgArea})):e.map(e=>({id:e.id,label:e.id,x:e.avgPrice,y:e.avgArea}));return(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 relative",children:[l&&(0,a.jsxs)("div",{className:"fixed z-50 px-3 py-2 bg-zinc-900 border border-white/10 rounded-lg shadow-xl text-xs text-zinc-300 pointer-events-none transform -translate-x-1/2 -translate-y-full animate-in fade-in zoom-in-95",style:{left:l.x,top:l.y},children:[l.text,(0,a.jsx)("div",{className:"absolute left-1/2 bottom-0 w-2 h-2 bg-zinc-900 border-r border-b border-white/10 text-zinc-900 transform rotate-45 -translate-x-1/2 -mb-1"})]}),(0,a.jsxs)("div",{className:"lg:col-span-1 space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-zinc-400 pl-1 border-l-2 border-cyan-500",children:"總體統計數據"}),(0,a.jsx)("div",{className:"bg-zinc-900/30 rounded-xl border border-white/5 p-4",children:(0,a.jsx)("table",{className:"w-full text-sm",children:(0,a.jsxs)("tbody",{className:"divide-y divide-white/5",children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"py-3 text-zinc-500",children:"數據範圍"}),(0,a.jsxs)("td",{className:"py-3 text-right font-mono text-white",children:[(0,a.jsx)("span",{className:"text-cyan-400",children:e.length})," 建案",(0,a.jsx)("span",{className:"mx-1 text-zinc-600",children:"/"}),(0,a.jsx)("span",{className:"text-zinc-300",children:s.count.toLocaleString()})," 車位"]})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"py-3 text-zinc-500",children:"平均坪數"}),(0,a.jsxs)("td",{className:"py-3 text-right font-mono text-cyan-400 text-lg font-bold",children:[s.avgArea.toFixed(2)," ",(0,a.jsx)("span",{className:"text-xs font-normal text-zinc-500",children:"坪"})]})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"py-3 text-zinc-500",children:"坪數中位數"}),(0,a.jsxs)("td",{className:"py-3 text-right font-mono text-zinc-300 text-lg font-bold",children:[s.medianArea.toFixed(2)," ",(0,a.jsx)("span",{className:"text-xs font-normal text-zinc-500",children:"坪"})]})]})]})})})]}),(0,a.jsx)(L,{projects:e.map(e=>({value:e.id,label:e.id})),className:"w-full",onChange:e=>x(e),max:6})]}),(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-zinc-400 pl-1 border-l-2 border-violet-500",children:"分佈散佈圖"}),(0,a.jsx)("div",{className:"mt-1 text-xs text-zinc-500 font-mono",children:"scale"===i?(0,a.jsxs)("span",{children:[(0,a.jsx)("span",{className:"text-cyan-400",children:"X軸"}),": 建案車位總數 ",(0,a.jsx)("span",{className:"text-zinc-600",children:"|"})," ",(0,a.jsx)("span",{className:"text-cyan-400",children:"Y軸"}),": 平均車位坪數"]}):(0,a.jsxs)("span",{children:[(0,a.jsx)("span",{className:"text-cyan-400",children:"X軸"}),": 平均車位價格 ",(0,a.jsx)("span",{className:"text-zinc-600",children:"|"})," ",(0,a.jsx)("span",{className:"text-cyan-400",children:"Y軸"}),": 平均車位坪數"]})})]}),(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsxs)("div",{className:"relative group",children:[(0,a.jsx)("button",{className:"p-1.5 text-zinc-500 hover:text-cyan-400 transition-colors",children:(0,a.jsx)(F.A,{size:14})}),(0,a.jsx)("div",{className:"absolute right-0 top-full mt-2 w-64 p-3 bg-zinc-900 border border-white/10 rounded-lg shadow-xl z-50 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:(0,a.jsx)("div",{className:"text-xs text-zinc-300 leading-relaxed",children:"scale"===i?"分析各建案「規劃車位總數」與「平均車位坪數」的關係。可觀察大社區是否傾向規劃較大或較小的車位。":"分析各建案「平均車位價格」與「平均車位坪數」的關係。可觀察車位價格是否隨著坪數增加而顯著提升。"})})]}),(0,a.jsx)("div",{className:"w-px h-4 bg-white/10 mx-1"}),(0,a.jsx)("button",{onClick:()=>r("scale"),className:(0,o.cn)("px-3 py-1.5 text-xs font-medium rounded-md border transition-all duration-200","scale"===i?"bg-cyan-500/10 text-cyan-400 border-cyan-500/50 shadow-[0_0_10px_rgba(34,211,238,0.1)]":"bg-zinc-900/50 border-white/10 text-zinc-500 hover:text-zinc-300 hover:bg-white/5"),children:"規模分析"}),(0,a.jsx)("button",{onClick:()=>r("value"),className:(0,o.cn)("px-3 py-1.5 text-xs font-medium rounded-md border transition-all duration-200","value"===i?"bg-cyan-500/10 text-cyan-400 border-cyan-500/50 shadow-[0_0_10px_rgba(34,211,238,0.1)]":"bg-zinc-900/50 border-white/10 text-zinc-500 hover:text-zinc-300 hover:bg-white/5"),children:"價值分析"})]})]}),(0,a.jsx)(S,{data:m,xLabel:"scale"===i?"建案車位總數":"平均車位價格",yLabel:"平均車位坪數",xUnit:"scale"===i?"位":"萬",yUnit:"坪",title:"scale"===i?"建案規模 vs 車位坪數分佈":"車位價值 vs 坪數分佈",highlightIds:d})]})]})}function T({data:e}){let[t,s]=(0,n.useState)(["B1","B2","B3","B4"]),[i,r]=(0,n.useState)(null),[l,c]=(0,n.useState)(!1),[x,m]=(0,n.useState)(null),[h,p]=(0,n.useState)([]),[u,f]=(0,n.useState)(!1),[g,b]=(0,n.useState)(0),j=t=>{m(t),f(!1);let s=N?.find(e=>e.floor===t),a=s?.rawRecords;if(a&&a.length>0){let e=a.map(e=>({...e,_isMatch:!0}));e.sort((e,t)=>{let s=e["交易年月日"]||0;return(t["交易年月日"]||0)-s}),p(e),b(e.length)}else{let s=e?.transactionDetails||[],a=[t];"B1"===t&&a.push("地下一層","B1","b1"),"B2"===t&&a.push("地下二層","B2","b2"),"B3"===t&&a.push("地下三層","B3","b3"),"B4"===t&&a.push("地下四層","B4","b4"),"B5_below"===t&&a.push("地下五層","B5","b5");let n=s.filter(e=>(e["車位類別"]||"").includes("坡道平面")),i=n.filter(e=>{let t=e["車位所在樓層"]||"",s=e["備註"]||"";return a.some(e=>t&&t.includes(e)||s&&s.includes(e))});b(i.length);let r=n.map(e=>{let t=e["車位所在樓層"]||"",s=e["備註"]||"",n=a.some(e=>t&&t.includes(e)||s&&s.includes(e));return{...e,_isMatch:n}});r.sort((e,t)=>{if(e._isMatch&&!t._isMatch)return -1;if(!e._isMatch&&t._isMatch)return 1;let s=e["交易年月日"]||0;return(t["交易年月日"]||0)-s}),p(r),0===i.length&&f(!0)}c(!0)};if(!e?.parkingAnalysis)return null;let{parkingRatio:v,avgPriceByType:y,rampPlanePriceByFloor:N}=e.parkingAnalysis,w=["B1","B2","B3","B4","B5_below","Unknown"],z=N?.filter(e=>w.includes(e.floor)&&e.count>0)||[],_=(0,n.useMemo)(()=>(function(e,t){let s=[];if(e.forEach(e=>{t.includes(e.floor)&&e.rawRecords&&e.rawRecords.forEach(e=>{"number"!=typeof e.parkingPrice||isNaN(e.parkingPrice)||s.push(e.parkingPrice)})}),0===s.length)return{avgPrice:0,medianPrice:0,q3Price:0,count:0};s.sort((e,t)=>e-t);let a=s.reduce((e,t)=>e+t,0)/s.length,n=s[Math.floor(s.length/2)],i=Math.floor(.75*s.length),r=s[i]||n;return{avgPrice:a,medianPrice:n,q3Price:r,count:s.length}})(z,t),[z,t]),A=(0,n.useCallback)(e=>{s(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),S=(0,n.useCallback)(()=>{t.length===w.length?s([]):s([...w])},[t.length]),C={B1:"#06b6d4",B2:"#3b82f6",B3:"#6366f1",B4:"#8b5cf6",B5_below:"#a855f7",Unknown:"#71717a"},{parkingChartData:I,parkingChartStats:F,hasParkingData:Z}=(0,n.useMemo)(()=>{let e=new Map,t=!1;z.forEach(s=>{s.rawRecords&&s.rawRecords.forEach(s=>{let a=s["建案名稱"],n=s.parkingArea||s["車位面積(坪)"]||.3025*(s["車位移轉總面積平方公尺"]||0),i=s.parkingPrice||s["車位價格(萬)"]||0;if(a&&n>0){e.has(a)||e.set(a,{count:0,totalArea:0,totalPrice:0});let s=e.get(a);s.count+=1,s.totalArea+=n,s.totalPrice+=i,t=!0}})});let s=Array.from(e.entries()).map(([e,t])=>({id:e,label:e,avgArea:parseFloat((t.totalArea/t.count).toFixed(2)),count:t.count,avgPrice:parseFloat((t.totalPrice/t.count).toFixed(2))})),a=0,n=[];s.forEach(e=>{a+=e.count,n.push(e.avgArea)}),n.sort((e,t)=>e-t);let i=n.length>0?n.reduce((e,t)=>e+t,0)/n.length:0,r=n.length>0?n[Math.floor(n.length/2)]:0;return{parkingChartData:s,parkingChartStats:{count:a,avgArea:i,medianArea:r},hasParkingData:t}},[z]);return(0,a.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500 text-white",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsx)(k.c,{title:"房車配比分析",description:"建案有購置車位的比例",headerAction:(0,a.jsx)(B.N,{data:[{type:"有車位",...v?.withParking},{type:"無車位",...v?.withoutParking},{ratio:v?.avgRatio}],filename:"parking_ratio_data",label:"匯出",columns:{type:"類別",count:"數量",percentage:"百分比",ratio:"比率"},chartType:"parking-pie",snapshotData:[{type:"有車位",...v?.withParking},{type:"無車位",...v?.withoutParking},{ratio:v?.avgRatio}]}),children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row items-start gap-6",children:[(0,a.jsx)("div",{className:"w-full md:w-1/2",children:(0,a.jsx)(P,{data:v})}),(0,a.jsx)("div",{className:"w-full md:w-1/2 flex flex-col gap-4",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-zinc-900/50 text-zinc-500",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-2 text-left",children:"類型"}),(0,a.jsx)("th",{className:"p-2 text-right",children:"筆數"}),(0,a.jsx)("th",{className:"p-2 text-right",children:"佔比"})]})}),(0,a.jsxs)("tbody",{className:"divide-y divide-white/5",children:[(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{className:"p-2 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"w-3 h-3 rounded-full bg-indigo-300"}),"有搭車位"]}),(0,a.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:v?.withParking?.count.toLocaleString()}),(0,a.jsxs)("td",{className:"p-2 text-right font-mono text-cyan-400",children:[v?.withParking?.percentage.toFixed(2),"%"]})]}),(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{className:"p-2 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"w-3 h-3 rounded-full bg-gray-600"}),"無車位"]}),(0,a.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:v?.withoutParking?.count.toLocaleString()}),(0,a.jsxs)("td",{className:"p-2 text-right font-mono text-zinc-500",children:[v?.withoutParking?.percentage.toFixed(2),"%"]})]})]})]})})]})}),(0,a.jsx)(k.c,{title:"車位類型均價",description:"各類車位成交行情",headerAction:(0,a.jsx)(B.N,{data:y||[],filename:"parking_price_by_type",label:"匯出",columns:{type:"車位類型",avgPrice:"平均價格",medianPrice:"中位數",count:"數量"},chartType:"parking-price",snapshotData:y||[]}),children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-zinc-900/50 text-zinc-500",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-2 text-left",children:"類型"}),(0,a.jsx)("th",{className:"p-2 text-right",children:"均價(萬)"}),(0,a.jsx)("th",{className:"p-2 text-right",children:"中位數"}),(0,a.jsx)("th",{className:"p-2 text-right",children:"總數"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-white/5",children:y?.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-zinc-800/50",children:[(0,a.jsx)("td",{className:"p-2 font-medium",children:e.type}),(0,a.jsx)("td",{className:"p-2 text-right font-mono text-cyan-400",children:Math.round(e.avgPrice).toLocaleString()}),(0,a.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:Math.round(e.medianPrice).toLocaleString()}),(0,a.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:e.count.toLocaleString()})]},e.type))})]})})]}),(0,a.jsx)(k.c,{title:"坡道平面車位坪數散佈分析",description:"建案車位數與坪數分佈",className:"relative z-20",headerAction:(0,a.jsx)(B.N,{data:I||[],filename:"parking_area_scatter_data",label:"匯出",columns:{id:"建案名稱",label:"標籤",avgArea:"平均坪數",count:"車位數",avgPrice:"平均價格"},chartType:"parking-scatter",snapshotData:I||[]}),children:(0,a.jsx)(R,{chartData:I,hasData:Z,summaryStats:F})}),(0,a.jsx)(k.c,{title:"坡道平面車位 - 樓層價差分析",description:"勾選樓層以動態更新統計數據",headerAction:(0,a.jsx)(B.N,{data:z||[],filename:"parking_floor_analysis",label:"匯出",columns:{floor:"樓層",count:"數量",avgPrice:"平均價格",medianPrice:"中位數",maxPrice:"最高價",minPrice:"最低價",q3Price:"第三四分位數"},chartType:"parking-floor",snapshotData:z||[]}),children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 bg-zinc-900/10 rounded-xl relative overflow-visible min-h-[450px]",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-b from-zinc-900/0 via-zinc-900/20 to-zinc-900/0 pointer-events-none"}),(0,a.jsx)(M,{data:z,selectedFloors:t,hoveredFloor:i,onHover:r,onToggle:A,onDetail:j,floorColors:C}),(0,a.jsx)("div",{className:"absolute bottom-4 left-0 w-full text-center text-zinc-600 text-xs pointer-events-none",children:"點擊方塊選取 • 懸停查看詳情"})]}),(0,a.jsxs)(E.a,{isOpen:l,onClose:()=>c(!1),title:`${x} 車位交易明細`,maxWidth:"max-w-5xl",children:[(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-zinc-800/50 p-1 rounded-lg border border-white/10",children:[(0,a.jsxs)("button",{onClick:()=>f(!1),className:(0,o.cn)("px-3 py-1.5 rounded text-xs transition-colors font-medium flex items-center gap-1.5",u?"text-zinc-500 hover:text-zinc-300 hover:bg-white/5":"bg-cyan-500/20 text-cyan-400 border border-cyan-500/30 shadow-[0_0_10px_rgba(34,211,238,0.1)]"),children:[(0,a.jsx)(d.A,{size:12}),"精確匹配 (",g,")"]}),(0,a.jsxs)("button",{onClick:()=>f(!0),className:(0,o.cn)("px-3 py-1.5 rounded text-xs transition-colors font-medium",u?"bg-rose-500/20 text-rose-400 border border-rose-500/30 shadow-[0_0_10px_rgba(244,63,94,0.1)]":"text-zinc-500 hover:text-zinc-300 hover:bg-white/5"),children:["未匹配 (",h.length-g,")"]}),(0,a.jsx)("div",{className:"ml-auto",children:(0,a.jsx)(B.N,{data:h.filter(e=>u?!e._isMatch:e._isMatch),filename:`parking_details_${x}_${u?"all":"match"}`,label:"匯出明細"})})]})}),(0,a.jsx)("div",{className:"overflow-x-auto rounded-lg border border-white/10 max-h-[60vh] custom-scrollbar",children:(0,a.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,a.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 whitespace-nowrap sticky top-0 z-10 backdrop-blur-md",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-3",children:"建案名稱"}),(0,a.jsx)("th",{className:"p-3",children:"交易日期"}),(0,a.jsx)("th",{className:"p-3 text-right",children:"車位總價"}),(0,a.jsx)("th",{className:"p-3 text-right",children:"車位面積"}),(0,a.jsx)("th",{className:"p-3",children:"車位樓層"}),(0,a.jsx)("th",{className:"p-3",children:"備註"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-white/5",children:h.length>0?h.filter(e=>u?!e._isMatch:e._isMatch).map((e,t)=>(0,a.jsxs)("tr",{className:(0,o.cn)("hover:bg-zinc-800/50 transition-colors",e._isMatch?"bg-cyan-500/5":"opacity-60"),children:[(0,a.jsxs)("td",{className:"p-3 font-medium text-white",children:[(0,a.jsx)("div",{children:e["建案名稱"]}),(0,a.jsxs)("div",{className:"text-[10px] text-zinc-600 font-mono mt-0.5",children:["#",e.transactionId||e["編號"]]})]}),(0,a.jsxs)("td",{className:"p-3 text-zinc-400 flex items-center gap-1",children:[(0,a.jsx)($.A,{size:12,className:"text-zinc-600"}),e["交易日"]]}),(0,a.jsxs)("td",{className:"p-3 text-right font-mono text-cyan-400",children:[e["車位總價元"]?(e["車位總價元"]/1e4).toLocaleString():"-"," 萬"]}),(0,a.jsxs)("td",{className:"p-3 text-right font-mono text-zinc-300",children:[e["車位移轉總面積平方公尺"]?(.3025*e["車位移轉總面積平方公尺"]).toFixed(2):"-"," 坪"]}),(0,a.jsx)("td",{className:"p-3 text-zinc-300",children:e["車位所在樓層"]||"-"}),(0,a.jsx)("td",{className:"p-3 text-zinc-500 text-xs max-w-[200px] truncate",title:e["備註"],children:e["備註"]})]},t)):(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"p-8 text-center text-zinc-500",children:"查無相關交易資料。"})})})]})})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"p-4 bg-gradient-to-r from-cyan-500/10 to-violet-500/10 border border-cyan-500/30 rounded-lg",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-cyan-400 mb-3",children:"已選樓層統計"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:"車位數"}),(0,a.jsx)("div",{className:"text-lg font-bold text-white",children:_.count.toLocaleString()})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:"平均單價"}),(0,a.jsxs)("div",{className:"text-lg font-bold text-cyan-400",children:[Math.round(_.avgPrice).toLocaleString()," 萬"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:"中位數"}),(0,a.jsxs)("div",{className:"text-lg font-bold text-zinc-300",children:[Math.round(_.medianPrice).toLocaleString()," 萬"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:"3/4位數"}),(0,a.jsxs)("div",{className:"text-lg font-bold text-zinc-300",children:[Math.round(_.q3Price).toLocaleString()," 萬"]})]})]})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-zinc-900/50 text-zinc-500",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-2 text-left",children:(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:t.length===w.length,onChange:S,className:"form-checkbox rounded bg-zinc-800 border-zinc-600 text-cyan-500"}),(0,a.jsx)("span",{children:"全選"})]})}),(0,a.jsx)("th",{className:"p-2 text-left",children:"樓層"}),(0,a.jsx)("th",{className:"p-2 text-right",children:"均價(萬)"}),(0,a.jsx)("th",{className:"p-2 text-right",children:"中位數"}),(0,a.jsx)("th",{className:"p-2 text-right",children:"最高"}),(0,a.jsx)("th",{className:"p-2 text-right",children:"最低"}),(0,a.jsx)("th",{className:"p-2 text-right",children:"車位數"}),(0,a.jsx)("th",{className:"p-2 text-center",children:"操作"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-white/5",children:z.map(e=>{let s=t.includes(e.floor),n=i===e.floor;return(0,a.jsxs)("tr",{onMouseEnter:()=>r(e.floor),onMouseLeave:()=>r(null),className:(0,o.cn)("transition-colors cursor-pointer",n?"bg-zinc-800":"hover:bg-zinc-800/50",!s&&"opacity-50"),onClick:()=>A(e.floor),children:[(0,a.jsx)("td",{className:"p-2",children:(0,a.jsx)("input",{type:"checkbox",checked:s,onChange:()=>A(e.floor),className:"form-checkbox rounded bg-zinc-800 border-zinc-600 text-cyan-500",onClick:e=>e.stopPropagation()})}),(0,a.jsx)("td",{className:"p-2 font-medium",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:C[e.floor]}}),e.floor]})}),(0,a.jsx)("td",{className:"p-2 text-right font-mono text-cyan-400",children:Math.round(e.avgPrice).toLocaleString()}),(0,a.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:Math.round(e.medianPrice).toLocaleString()}),(0,a.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:Math.round(e.maxPrice).toLocaleString()}),(0,a.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:Math.round(e.minPrice).toLocaleString()}),(0,a.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:e.count.toLocaleString()}),(0,a.jsx)("td",{className:"p-2 text-center",children:(0,a.jsx)("button",{onClick:t=>{t.stopPropagation(),j(e.floor)},className:"p-1.5 rounded-full hover:bg-cyan-500/20 text-zinc-400 hover:text-cyan-400 transition-colors",title:"查看明細",children:(0,a.jsx)(D.A,{size:14})})})]},e.floor)})})]})})]})]})})]})}var O=s(83632),U=s(93398),W=s(34220);class q{constructor(){this.knownPatterns=new Map,this.patternFrequency=new Map,this.initializeBasePatterns()}initializeBasePatterns(){[{id:"unit_slash_floorF_format",name:"戶號斜線樓層F格式",regex:/^([A-Z]\d+)\/(\d+)F[號号]?$/i,extract:(e,t)=>{let s=e[1],a=e[2];return t?.floor&&parseInt(a,10)===parseInt(t.floor,10)?s:s+a},confidence:100,priority:.01},{id:"building_unit_floor_combined",name:"棟別戶號樓層合併格式",regex:/^([A-Z])棟(\d+)-(\d+)[號号]?$/i,extract:(e,t)=>{let s=e[1],a=e[2],n=e[3];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?s+a:s+a+n},confidence:100,priority:.02},{id:"building_unit_floorF_format_v2",name:"棟別戶號樓層F格式v2",regex:/^([A-Z])棟(\d+)-(\d+)F[號号]?$/i,extract:(e,t)=>{let s=e[1],a=e[2],n=e[3];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?s+a:s+a+n},confidence:100,priority:.03},{id:"unit_building_zero_format",name:"戶號棟別0號格式",regex:/^([A-Z]\d+)棟0[號号]?$/i,extract:e=>e[1],confidence:100,priority:.04},{id:"single_letter_unit",name:"單字母戶號格式",regex:/^([A-Z])[號号]$/i,extract:e=>e[1],confidence:95,priority:.045},{id:"building_floor_unit_letter_format",name:"棟別樓層數字戶型字母格式",regex:/^([A-Z])棟(\d+)([A-Z])[號号]?$/i,extract:(e,t)=>{let s=e[1],a=parseInt(e[2],10),n=e[3];return t?.floor&&a===parseInt(t.floor,10)?n:`${s}${a}${n}`},confidence:99,priority:.05},{id:"building_floor_unit_format",name:"棟別樓層戶號格式",regex:/^([A-Z])棟(\d{1,2})F-(\d+)[號号]?$/,extract:(e,t)=>{let s=e[1],a=e[2],n=e[3];return t?.floor&&parseInt(a,10)===parseInt(t.floor,10)?s+n:s+a+n},confidence:99,priority:.1},{id:"letter_number_floor_format",name:"字母數字-樓層F格式",regex:/^([A-Z])0*(\d+)-(\d{1,2})F[號号]?$/,extract:(e,t)=>{let s=e[1],a=e[2],n=e[3];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?s+a:s+a+n},confidence:99,priority:.15},{id:"identifier_building_floor_redundant",name:"識別碼棟與F樓層格式(贅余樓層)",regex:/^([A-Z]\d+)棟F(\d+)[號号]?$/i,extract:(e,t)=>{let s=e[1],a=e[2],n=s.match(/^[A-Z]+/)?.[0]||"",i=parseInt(s.match(/\d+/)?.[0]||"0",10),r=`${n}${i}`;return t?.floor&&parseInt(a,10)===parseInt(t.floor,10)?r:r+"F"+a},confidence:98,priority:.18},{id:"identifier_building_floorF_format",name:"識別碼棟與樓層F格式(贅余樓層)",regex:/^([A-Z]\d+)棟(\d{1,2})F[號号]?$/i,extract:(e,t)=>{let s=e[1],a=e[2];return t?.floor&&parseInt(a,10)===parseInt(t.floor,10)?s:s+a},confidence:98,priority:.19},{id:"unit_building_floor_format",name:"戶棟樓層格式",regex:/^([A-Z]\d+)戶棟(\d+)F[號号]?$/,extract:(e,t)=>{let s=e[1],a=e[2];return t?.floor&&parseInt(a,10)===parseInt(t.floor,10)?s:s+a},confidence:99,priority:.2},{id:"building_sub_unit_floor_format",name:"棟別子戶號樓層格式",regex:/^([A-Z])棟(\d+)-(\d+)F[號号]?$/,extract:(e,t)=>{let s=e[1],a=e[2],n=e[3];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?s+a:s+a+n},confidence:99,priority:.3},{id:"building_unit_floor_format",name:"棟別戶別樓層格式",regex:/^([A-Z])棟([A-Z])-(\d{1,2})F[號号]?$/,extract:(e,t)=>{let s=e[2],a=e[3];return t?.floor&&parseInt(a,10)===parseInt(t.floor,10)?s:s+a},confidence:99,priority:.4},{id:"building_self_unit_floor_format",name:"棟別自身戶號樓層格式",regex:/^([A-Z])棟\1-(\d+)[號号]?$/,extract:(e,t)=>{let s=e[1],a=e[2];return t?.floor&&parseInt(a,10)===parseInt(t.floor,10)?s:s+a},confidence:98,priority:.45},{id:"building_unit_letter_floor_number",name:"棟別戶號字母樓層數字格式",regex:/^([A-Z])棟([A-Z])(\d{1,2})[號号]?$/,extract:(e,t)=>{let s=e[2],a=e[3];return t?.floor&&parseInt(a,10)===parseInt(t.floor,10)?s:s+a},confidence:98,priority:.46},{id:"redundant_building_format",name:"重複棟別格式",regex:/^([A-Z])棟\1-(\d{1,2})F[號号]?$/,extract:(e,t)=>{let s=e[1],a=e[2];return t?.floor&&parseInt(a,10)===parseInt(t.floor,10)?s:s+a},confidence:98,priority:.5},{id:"building_floor_letter_unit",name:"棟別樓層字母戶號格式",regex:/^[A-Z]棟(\d{1,2})F-([A-Z])[號号]?$/,extract:(e,t)=>{let s=e[1],a=e[2];return t?.floor&&parseInt(s,10)===parseInt(t.floor,10)?a:a+s},confidence:98,priority:.6},{id:"letter_leading_zero_unit",name:"字母與0開頭數字戶號",regex:/^([A-Z])0+(\d+)[號号]?$/,extract:e=>e[1]+e[2],confidence:97,priority:.7},{id:"floor_prefix_format",name:"樓層前綴格式",regex:/^(\d{1,2})([A-Z])[號号]?$/,extract:(e,t)=>{let s=e[1],a=e[2];return t?.floor&&parseInt(s,10)===parseInt(t.floor,10)?a:s+a},confidence:96,priority:.8},{id:"floorF_building_unit_format",name:"樓層F棟戶號格式",regex:/^(\d{1,2})F棟([A-Z])[號号]?$/,extract:(e,t)=>{let s=e[1],a=e[2];return t?.floor&&parseInt(s,10)===parseInt(t.floor,10)?a:s+a},confidence:98,priority:.85},{id:"numericBuilding_floor_unit_format",name:"數字棟別樓層戶號格式",regex:/^(\d+)棟(\d{1,2})([A-Z])[號号]?$/,extract:(e,t)=>{let s=e[2],a=e[3];return t?.floor&&parseInt(s,10)===parseInt(t.floor,10)?a:s+a},confidence:98,priority:.86},{id:"floor_first_detailed",name:"樓層優先詳細格式",regex:/(\d{1,2})F-([A-Z])(\d{2})/,extract:e=>e[2]+e[3],confidence:95,priority:1},{id:"floor_prefix_complex_unit",name:"樓層前綴複合戶號",regex:/^(\d{1,2})F-([A-Z]\d+)[號号]?$/,extract:(e,t)=>{let s=e[1],a=e[2];return t?.floor&&parseInt(s,10)===parseInt(t.floor,10)?a:s+a},confidence:94,priority:1.2},{id:"floor_first_simple_letter",name:"樓層優先簡單字母格式",regex:/^(\d{1,2})F-([A-Z])[號号]?$/,extract:(e,t)=>{let s=e[1],a=e[2];return t?.floor&&parseInt(s,10)===parseInt(t.floor,10)?a:s+a},confidence:90,priority:1.5},{id:"building_with_unit",name:"棟別完整戶號",regex:/([A-Z])棟([A-Z])(\d{1,2})(?:-(\d{1,2})F?[號号])?/,extract:e=>e[2]+e[3],confidence:90,priority:2,conditions:[{type:"building_match",validator:e=>{let t=e.rawUnit.match(/([A-Z])棟([A-Z])/);return!!t&&t[1]===t[2]}}]},{id:"building_simple_letter_unit",name:"棟別字母戶號格式",regex:/^[A-Z]棟([A-Z])[號号]?$/,extract:e=>e[1],confidence:92,priority:2.5},{id:"unit_floor_suffix",name:"戶號樓層後綴",regex:/([A-Z]\d{1,2})-(\d{1,2})F?[號号]?/,extract:e=>e[1],confidence:85,priority:3},{id:"building_floor_format",name:"棟別樓層格式",regex:/^([A-Z]\d{1,2})棟(\d{1,2})(?:F|樓)[號号]?$/,extract:(e,t)=>{let s=e[1],a=e[2];return t?.floor&&parseInt(a,10)===parseInt(t.floor,10)?s:s+a},confidence:88,priority:3.5},{id:"building_complex_number",name:"複合棟別編號",regex:/^([A-Z]\d+)棟(\d+)[號号]$/,extract:(e,t)=>{let s=e[1],a=e[2];return t?.floor&&parseInt(a,10)===parseInt(t.floor,10)?s:s+a},confidence:86,priority:3.8},{id:"building_floor_F_format",name:"棟別樓層F格式",regex:/^([A-Z])棟(\d{1,2})F[號号]?$/,extract:(e,t)=>{let s=e[1],a=e[2];return t?.floor&&parseInt(a,10)===parseInt(t.floor,10)?s:s+a},confidence:87,priority:3.9},{id:"building_zero_placeholder_unit",name:"棟別0號佔位符格式",regex:/^([A-Z])棟0[號号]?$/,extract:e=>e[1],confidence:95,priority:3.95},{id:"building_simple_number",name:"棟別簡單編號",regex:/([A-Z])棟(\d{1,2})[號号]/,extract:(e,t)=>{let s=e[1],a=e[2];return t?.floor&&parseInt(a,10)===parseInt(t.floor,10)?s:s+a},confidence:85,priority:4},{id:"unit_floor_concatenated",name:"複合戶號樓層格式",regex:/^([A-Z])(\d+)F[號号]?$/,extract:(e,t)=>{let s=e[1],a=e[2],n=t?.floor;if(n){let e=parseInt(n,10);if(!isNaN(e)){if(e<10){let e="0"+n;if(a.endsWith(e))return s+a.substring(0,a.length-2)}if(a.endsWith(n))return s+a.substring(0,a.length-n.length)}}return s+a},confidence:80,priority:4.5},{id:"letter_floor",name:"字母樓層格式",regex:/^([A-Z])-(\d{1,2})F?[號号]?$/,extract:(e,t)=>{let s=e[2];return t?.floor&&parseInt(s,10)===parseInt(t.floor,10)?e[1]:e[1]+s},confidence:70,priority:5}].forEach(e=>{this.knownPatterns.set(e.id,e)})}detectPattern(e,t){let s=this.normalizeText(e),a=null;for(let e of Array.from(this.knownPatterns.values()).sort((e,t)=>e.priority-t.priority)){let n=s.match(e.regex);if(n){if(e.conditions&&t&&!e.conditions.every(e=>e.validator(t)))continue;a={rule:e,match:n};break}}return a&&this.patternFrequency.set(a.rule.id,(this.patternFrequency.get(a.rule.id)||0)+1),a}normalizeText(e){return e?e.toUpperCase().replace(/[\uff01-\uff5e]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248)).replace(/\s+/g,""):""}}class G{analyzeProject(e,t){let s={projectName:e,patterns:new Map,unitMappings:new Map,namingStyle:"unknown"},a=new q;for(let n of t){let t=n["戶別"],i=n["樓層"];if(!t)continue;let r={rawUnit:t,floor:i?String(i):void 0,projectName:e},l=a.detectPattern(t,r);if(l){let e=l.rule;s.patterns.has(e.id)||s.patterns.set(e.id,{patternId:e.id,count:0,examples:[],confidence:e.confidence});let a=s.patterns.get(e.id);a.count++,a.examples.length<10&&a.examples.push(t)}s.unitMappings.has(t)||s.unitMappings.set(t,{floors:new Set,rawVariations:new Set([t])});let o=s.unitMappings.get(t);i&&o.floors.add(String(i))}return this.determineNamingStyle(s),this.projectProfiles.set(e,s),s}determineNamingStyle(e){let t=e.patterns.size,s=Array.from(e.patterns.values()).reduce((e,t)=>e+t.count,0);if(0===t){e.namingStyle="unknown";return}let a=null,n=0;for(let t of e.patterns.values())t.count>n&&(n=t.count,a=t);a&&(e.dominantPattern=a.patternId,a.count/s>.8?e.namingStyle="consistent":e.namingStyle="mixed")}getProjectProfile(e){return this.projectProfiles.get(e)}isAmbiguousUnit(e,t){let s=this.projectProfiles.get(e);if(!s)return!1;let a=s.unitMappings.get(t);return!!a&&a.floors.size>1}constructor(){this.projectProfiles=new Map}}class Y{constructor(e){this.customRules=new Map,this.detector=e,this.initializeCustomRules()}initializeCustomRules(){}applyRules(e){for(let[t,s]of this.customRules){let t=s(e);if(t)return t}let t=this.detector.detectPattern(e.rawUnit,e);if(t){let{rule:s,match:a}=t;return{identifier:s.extract(a,e),confidence:s.confidence,method:`pattern:${s.id}`}}return{identifier:this.simpleFallback(e.rawUnit),confidence:50,method:"fallback"}}simpleFallback(e){return e?e.toUpperCase().replace(/[\uff01-\uff5e]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248)).replace(/\s+/g,"").replace(/[棟樓F室號\-]/g,""):""}}class H{constructor(e){this.resolveCache=new Map,console.log("[AdaptiveUnitResolver] 初始化，處理",e.length,"筆資料"),this.detector=new q,this.analyzer=new G,this.ruleEngine=new Y(this.detector),this.buildKnowledgeBase(e)}buildKnowledgeBase(e){let t=new Map;for(let s of e){let e=s["建案名稱"];e&&(t.has(e)||t.set(e,[]),t.get(e).push(s))}for(let[e,s]of(console.log("[AdaptiveUnitResolver] 分析",t.size,"個建案"),t))this.analyzer.analyzeProject(e,s)}resolve(e){return this.resolveWithContext(e).identifier}resolveWithContext(e){let t=e["戶別"];t&&"string"==typeof t&&(t=t.trim());let s=e["樓層"],a=e["建案名稱"];if(!t)return{identifier:"",confidence:0,method:"no_input"};let n=`${a}|${t}|${s||""}`;if(this.resolveCache.has(n))return this.resolveCache.get(n);let i={rawUnit:t,floor:s?String(s):void 0,projectName:a},r=this.ruleEngine.applyRules(i);if(r)return this.resolveCache.set(n,r),r;let l={identifier:t,confidence:0,method:"fallback_null"};return this.resolveCache.set(n,l),l}}function X({transactions:e,project:t}){let[s,i]=(0,n.useState)(""),[r,l]=(0,n.useState)(""),[o,c]=(0,n.useState)(null);return(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row flex-wrap items-start sm:items-center gap-3 sm:gap-4 bg-zinc-900/30 p-4 rounded-lg border border-white/5",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 w-full sm:w-auto",children:[(0,a.jsx)("span",{className:"text-sm text-zinc-400 font-semibold whitespace-nowrap",children:"區間均價試算:"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.p,{type:"number",placeholder:"起樓",className:"w-20 h-8 bg-zinc-950/50",value:s,onChange:e=>i(e.target.value)}),(0,a.jsx)("span",{className:"text-zinc-500",children:"~"}),(0,a.jsx)(p.p,{type:"number",placeholder:"迄樓",className:"w-20 h-8 bg-zinc-950/50",value:r,onChange:e=>l(e.target.value)})]}),(0,a.jsx)(h.$,{size:"sm",variant:"secondary",onClick:()=>{if(!t||!e)return;let a=parseInt(s),n=parseInt(r);if(isNaN(a)||isNaN(n)||a>n)return void c(null);let i=e.filter(e=>{if(e["建案名稱"]!==t)return!1;let s=parseInt(String(e["樓層"]));return!isNaN(s)&&s>=a&&s<=n});if(0===i.length)return void c({avg:0,count:0});let l=i.reduce((e,t)=>e+(t["房屋總價(萬)"]||0),0),o=i.reduce((e,t)=>e+(t["房屋面積(坪)"]||0),0);c({avg:o>0?l/o:0,count:i.length})},className:"h-8 ml-2",children:"計算"})]}),o&&(0,a.jsxs)("div",{className:"flex items-center gap-4 ml-4 animate-in fade-in",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-xs text-zinc-500",children:"平均單價 (加權)"}),(0,a.jsxs)("span",{className:"text-lg font-bold text-violet-400",children:[o.avg.toFixed(2)," 萬/坪"]})]}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-xs text-zinc-500",children:"參考筆數"}),(0,a.jsxs)("span",{className:"text-sm text-zinc-300",children:[o.count," 筆"]})]})]})]})}function V({data:e}){let[t,s]=(0,n.useState)(""),[i,r]=(0,n.useState)(.3),[o,c]=(0,n.useState)(14);if((0,n.useEffect)(()=>{e?.priceGridAnalysis?.projectNames?.length&&!t&&s(e.priceGridAnalysis.projectNames[0])},[e,t]),!e?.priceGridAnalysis)return null;let{projectNames:d,byProject:x}=e.priceGridAnalysis,u=n.useMemo(()=>{if(!t||!e.transactionDetails)return null;let s=e.transactionDetails.filter(e=>e["建案名稱"]===t),{excludeCommercial:a}=l.P.getState();return a&&(s=s.filter(e=>{let t=e["主要用途"]||"",s=e["建物型態"]||"",a=e["備註"]||"";return!(t.includes("商業")||s.includes("店")||a.includes("店")||t.includes("辦公")||s.includes("辦公")||s.includes("事務所"))})),s},[t,e.transactionDetails]),f=n.useMemo(()=>{if(!t)return null;if(u&&u.length>0)try{return function(e,t=.3,s=14){let a={},n=new Set,i=new Set,r=new H(e);if(e.forEach(e=>{let t=e["樓層"]||e.floor||e.layer;if(null==t)return;"number"==typeof t&&(t=String(t)),"number"==typeof t&&(t=String(t));let s=r.resolve(e);n.add(t),i.add(s),a[t]||(a[t]={}),a[t][s]||(a[t][s]=[]);let l=parseFloat(e["房屋單價(萬)"]||e.unitPrice||0),o=parseFloat(e["交易總價(萬)"]||e.totalPrice||0),c=parseFloat(e["房屋總價(萬)"]||e.housePrice||0),d=parseFloat(e["車位總價(萬)"]||e.parkingPrice||0),x=parseFloat(e["房屋面積(坪)"]||e.houseArea||0),m=e["房數"]||e.rooms,h=e["車位類別"]||e.parkingType||"";"string"==typeof h&&h.includes("車位");let p=e["主要用途"]||e.mainPurpose||"",u=e["建物型態"]||e.buildingType||"",f=p.includes("商業")||u.includes("店")||p.includes("店"),g=p.includes("辦公")||u.includes("辦公")||u.includes("事務所"),b=e["交易日"]||e["交易年月日"]||e.transactionDate||"",j=b;if(b&&/^\d{6,7}$/.test(String(b))){let e=String(b),t=6===e.length?2:3;j=`${e.substring(0,t)}/${e.substring(t,t+2)}/${e.substring(t+2)}`}a[t][s].push({...e,unitPrice:l,floor:t,unit:s,transactionDate:j,isStorefront:f,isOffice:g,hasParking:d>0,tooltipInfo:{totalPrice:o,housePrice:c,parkingPrice:d,houseArea:x,rooms:m}})}),0===n.size)return{horizontalGrid:{},sortedFloors:[],sortedUnits:[],unitColorMap:{},summary:{totalBaselineHousePrice:0,totalPricePremiumValue:0,totalSoldArea:0,transactionCount:0},horizontalComparison:[]};let l=Array.from(n).sort((e,t)=>{let s=e=>e?e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e)||0:0;return s(t)-s(e)}),o=Array.from(i).sort(),c={},d=e=>{if(!e)return null;let t=e.replace(/\//g,"");if(t.length<6)return null;let s=6===t.length?2:3,a=parseInt(t.substring(0,s)),n=parseInt(t.substring(s,s+2));return new Date(1911+a,n-1,parseInt(t.substring(s+2)))},x={};e.forEach(e=>{let t=r.resolve(e),s=e["主要用途"]||e.mainPurpose||"",a=e["建物型態"]||e.buildingType||"",n=e["備註"]||e.note||"",i=s.includes("商業")||a.includes("店")||s.includes("辦公")||a.includes("辦公")||a.includes("事務所")||n.includes("特殊")||n.includes("親友")||n.includes("員工")||n.includes("關係人")||n.includes("毛胚"),l=parseFloat(e["房屋單價(萬)"]||e.unitPrice||0);!i&&l>0&&(x[t]||(x[t]=[]),x[t].push(e))}),Object.keys(x).forEach(e=>{let a=x[e];if(a.sort((e,t)=>(d(e["交易年月日"]||e.transactionDate)?.getTime()||0x9184e729fff)-(d(t["交易年月日"]||t.transactionDate)?.getTime()||0x9184e729fff)),0===a.length)return;let n=d(a[0]["交易年月日"]||a[0].transactionDate);if(!n){c[e]=a.reduce((e,t)=>parseFloat(t["房屋單價(萬)"])<parseFloat(e["房屋單價(萬)"])?t:e,a[0]);return}let i=new Date(n);i.setDate(i.getDate()+s);let r=a.filter(e=>{let t=d(e["交易年月日"]||e.transactionDate);return t&&t<=i}),l=r[0],o=1/0;r.forEach(e=>{let s,a=parseFloat(e["房屋單價(萬)"]||0)-((s=String(e["樓層"]))?s.startsWith("B")?-parseInt(s.substring(1)):parseInt(s):0)*t;a<o&&(o=a,l=e)}),c[e]=l});let m=0,h=0,p=0,u=0;Object.keys(a).forEach(e=>{Object.keys(a[e]).forEach(s=>{a[e][s].forEach((n,i)=>{let r=null,l=c[s];if(l){let e=e=>e?e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e):0,s=String(l["樓層"]),a=String(n.floor),i=e(s),o=e(a),c=parseFloat(l["房屋單價(萬)"]||l.unitPrice||0)+(o-i)*t;if(c>0&&(r=(n["房屋單價(萬)"]-c)/c*100,(n===l||.1>Math.abs(n["房屋單價(萬)"]-c))&&(r=0)),n.tooltipInfo.housePrice&&n.tooltipInfo.houseArea){let e=c*n.tooltipInfo.houseArea;m+=e,h+=n.tooltipInfo.housePrice-e,p+=n.tooltipInfo.houseArea,u++}}a[e][s][i].premium=r})})});let f={},g=["#f87171","#fb923c","#fbbf24","#a3e635","#34d399","#22d3ee","#818cf8","#c084fc","#f472b6"];o.forEach((e,t)=>{f[e]=g[t%g.length]});let b={};o.forEach(e=>{b[e]={totalPremium:0,totalSoldArea:0,count:0,anchorPrice:null,anchorFloor:null};let t=c[e];t&&(b[e].anchorPrice=parseFloat(t["房屋單價(萬)"]||0),b[e].anchorFloor=String(t["樓層"]))}),Object.keys(a).forEach(e=>{Object.keys(a[e]).forEach(s=>{a[e][s].forEach(e=>{let a=c[s];if(null!==e.premium&&e.tooltipInfo.housePrice&&e.tooltipInfo.houseArea&&a){let n=e=>e?e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e):0,i=n(String(a["樓層"])),r=n(e.floor),l=parseFloat(a["房屋單價(萬)"]||a.unitPrice||0)+(r-i)*t;if(l>0){let t=l*e.tooltipInfo.houseArea,a=e.tooltipInfo.housePrice-t;b[s]&&(b[s].totalPremium+=a,b[s].totalSoldArea+=e.tooltipInfo.houseArea,b[s].count++)}}})})});let j=Object.keys(b).map(e=>{let t=b[e];return 0===t.count?null:{unitType:e,anchorInfo:t.anchorPrice?`${t.anchorFloor}F / ${t.anchorPrice}萬`:"N/A",horizontalPriceDiff:t.totalSoldArea>0?t.totalPremium/t.totalSoldArea:0,unitsSold:t.count,timePremiumContribution:t.totalPremium,contributionPercentage:h>0?t.totalPremium/h*100:0,baselineHousePrice:m,avgPriceAdjustment:t.totalSoldArea>0?t.totalPremium/t.totalSoldArea:0}}).filter(Boolean);return{horizontalGrid:a,sortedFloors:l,sortedUnits:o,unitColorMap:f,summary:{totalBaselineHousePrice:m,totalPricePremiumValue:h,totalSoldArea:p,transactionCount:u},horizontalComparison:j}}(u,i,o)}catch(e){console.error("Heatmap generation error:",e)}return x[t]&&x[t].horizontalGrid?x[t]:null},[t,u,x,i,o]);return(0,a.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row flex-wrap items-start lg:items-center gap-4 bg-zinc-900/30 p-4 rounded-lg border border-white/5",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 w-full lg:w-auto",children:[(0,a.jsx)("span",{className:"text-sm text-zinc-400 whitespace-nowrap",children:"選擇建案:"}),(0,a.jsx)(m.l,{value:t,onChange:e=>s(e.target.value),className:"w-full sm:w-[280px] bg-zinc-950/50",children:d.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3 w-full lg:w-auto",children:[(0,a.jsx)("span",{className:"text-sm text-zinc-400 whitespace-nowrap",children:"樓層價差:"}),(0,a.jsxs)("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[(0,a.jsx)("input",{type:"range",min:0,max:10,step:.05,value:i,onChange:e=>r(Number(e.target.value)),className:"flex-1 sm:w-32 h-2 accent-violet-500 cursor-pointer",style:{minHeight:"24px"}}),(0,a.jsx)(p.p,{type:"number",min:0,max:10,step:.01,value:i,onChange:e=>r(Math.max(0,Number(e.target.value))),className:"w-20 h-8 bg-zinc-950/50 text-right pr-2"}),(0,a.jsx)("span",{className:"text-sm font-mono text-violet-400 whitespace-nowrap",children:"萬/坪"}),(0,a.jsx)(h.$,{variant:"ghost",size:"icon",onClick:()=>{if(!e.transactionDetails||!t)return;let s=function(e){if(!e||0===e.length)return .3;let t=new H(e),s={};e.forEach(e=>{let a=t.resolve(e),n=e["主要用途"]||e.mainPurpose||"",i=e["建物型態"]||e.buildingType||"",r=e["備註"]||e.note||"";!(n.includes("商業")||i.includes("店")||n.includes("辦公")||i.includes("辦公")||i.includes("事務所")||r.includes("特殊")||r.includes("親友")||r.includes("員工")||r.includes("關係人")||r.includes("毛胚"))&&parseFloat(e["房屋單價(萬)"])>0&&(s[a]||(s[a]=[]),s[a].push(e))});let a=[];if(Object.values(s).forEach(e=>{let t=e=>e?e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e):0;e.sort((e,s)=>t(String(e["樓層"]))-t(String(s["樓層"])));for(let s=0;s<e.length-1;s++){let n=e[s],i=e[s+1],r=t(String(n["樓層"])),l=t(String(i["樓層"]))-r,o=parseFloat(i["房屋單價(萬)"])-parseFloat(n["房屋單價(萬)"]);if(l>0&&l<=3){let e=o/l;e>-2&&e<10&&a.push(e)}}}),0===a.length)return .5;a.sort((e,t)=>e-t);let n=Math.floor(a.length/2);return Math.max(0,Math.round(100*(a.length%2!=0?a[n]:(a[n-1]+a[n])/2))/100)}(e.transactionDetails.filter(e=>e["建案名稱"]===t));r(s),console.log("Auto suggested premium:",s)},className:"h-8 w-8 text-yellow-400 hover:text-yellow-300 hover:bg-yellow-400/10 ml-1",title:"自動試算建議價差",children:(0,a.jsx)(W.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-zinc-400",children:"基準天數:"}),(0,a.jsx)(p.p,{type:"number",min:"1",max:"365",value:o,onChange:e=>c(Number(e.target.value)||14),className:"w-16 h-8 bg-zinc-950/50 text-right pr-2"}),(0,a.jsx)("span",{className:"text-sm font-mono text-violet-400 whitespace-nowrap",children:"天"})]})]})]}),t&&e.transactionDetails&&(0,a.jsx)(X,{transactions:e.transactionDetails,project:t}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-4 p-4 bg-zinc-900/20 rounded-lg border border-white/5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs text-zinc-500",children:"溢價圖例:"}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"w-4 h-4 rounded bg-red-500/80"}),(0,a.jsx)("span",{className:"text-xs text-zinc-400",children:"> 5%"})]}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"w-4 h-4 rounded bg-orange-500/80"}),(0,a.jsx)("span",{className:"text-xs text-zinc-400",children:"2-5%"})]}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"w-4 h-4 rounded bg-yellow-500/80"}),(0,a.jsx)("span",{className:"text-xs text-zinc-400",children:"0-2%"})]}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"w-4 h-4 rounded bg-green-500/80"}),(0,a.jsx)("span",{className:"text-xs text-zinc-400",children:"< 0%"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 ml-auto",children:[(0,a.jsx)("span",{className:"text-xs text-zinc-500",children:"特殊交易:"}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"w-4 h-4 rounded bg-amber-600"}),(0,a.jsx)("span",{className:"text-xs text-zinc-400",children:"店舖"})]}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"w-4 h-4 rounded bg-blue-600"}),(0,a.jsx)("span",{className:"text-xs text-zinc-400",children:"辦公室"})]}),(0,a.jsxs)("span",{className:"flex items-center gap-1",children:[(0,a.jsx)("span",{className:"w-4 h-4 rounded bg-purple-600"}),(0,a.jsx)("span",{className:"text-xs text-zinc-400",children:"廠辦"})]})]})]}),(0,a.jsx)(k.c,{title:"建案銷控表與調價熱力圖",description:"可視化建案各戶別的銷售狀況與價格調整幅度",headerAction:(0,a.jsx)(B.N,{data:u||[],filename:`heatmap_grid_${t}`,label:"匯出",chartType:"heatmap-grid",snapshotData:{projectData:f,floorPremium:i,selectedProject:t}}),children:f?(0,a.jsx)(U.t,{data:f,floorPremium:i,showSummary:!1,showComparison:!1}):(0,a.jsx)("div",{className:"text-zinc-500 text-center p-12",children:"請選擇建案以查看銷控表"})}),f?.summary&&(0,a.jsx)(k.c,{title:"調價幅度統計摘要 (排除店舖/辦公室)",headerAction:(0,a.jsx)(B.N,{data:[f.summary],filename:`heatmap_stats_${t}`,label:"匯出",chartType:"heatmap-stats",snapshotData:{summary:f.summary,selectedProject:t}}),children:(0,a.jsx)(U.t,{data:f,showGrid:!1,showSummary:!0,showComparison:!1})}),f?.horizontalComparison&&f.horizontalComparison.length>0&&(0,a.jsx)(k.c,{title:"戶型水平價差與溢價貢獻",headerAction:(0,a.jsx)(B.N,{data:f.horizontalComparison,filename:`heatmap_comparison_${t}`,label:"匯出",chartType:"heatmap-comparison",snapshotData:{horizontalComparison:f.horizontalComparison,selectedProject:t}}),children:(0,a.jsx)(U.t,{data:f,showGrid:!1,showSummary:!1,showComparison:!0})})]})}var Q=s(31840),K=s(81477);let J=(0,s(18460).F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function ee({className:e,variant:t,...s}){return(0,a.jsx)("div",{className:(0,o.cn)(J({variant:t}),e),...s})}let et=[{id:"p-2012-08-01",date:"2012-08-01",title:"實價登錄 1.0 上路",category:"policy",impact:"high",description:"交易後30日內申報，區段化揭露(30號區間)，預售屋採代銷結案後整批申報。",change_content:"交易資訊不透明 -> 區段化揭露",affected_scope:"房仲業者、買賣雙方、預售屋投機客",background:"低利環境延續：國內房貸利率處於低檔 (約1.8%-1.9%)。",impact_analysis:"[受益] 買方獲得參考依據。[適應] 房仲失去資訊壟斷優勢。[無感] 預售屋投機客因資訊未即時揭露，仍可操作紅單。",details:["申報義務人：地政士、經紀業或權利人。","申報時機：買賣案件於辦竣所有權移轉登記後30日內申報。","揭露方式：以區段化、去識別化方式提供查詢 (例如：中正路1-30號)。","預售屋規定：委託代銷者，於委託代銷契約屆滿或終止30日內「整批」申報 (資訊落後嚴重)。"]},{id:"p-2014-06-04",date:"2014-06-04",title:"囤房稅 1.0",category:"policy",impact:"medium",description:"非自住住家用稅率由1.2%-2%調高為1.5%-3.6%，授權地方政府自訂差別稅率。",change_content:"非自住稅率 1.2% -> 1.5%~3.6%",affected_scope:"多屋族、台北市置產客",background:"美國聯準會結束QE：預期升息心理浮現，全球資金派對暫歇。",impact_analysis:"[微痛] 持有成本上升，但因多數縣市未採最高稅率，且稅基(房屋評定現值)偏低，實質痛感有限。",details:["自住房屋稅率：維持 1.2% (需本人、配偶或直系親屬實際居住，且全國合計3戶以內)。","非自住房屋稅率：由 1.2%~2% 調升至 1.5%~3.6%。","地方權限：各地方政府可視地方發展需要，在範圍內自訂差別稅率。","持有認定：以個人(自然人)或法人(公司)為單位個別計算。"]},{id:"p-2016-01-01",date:"2016-01-01",title:"房地合一稅 1.0",category:"policy",impact:"high",description:"獲利課稅取代舊制。持有<1年45%，1-2年35%，自用滿6年獲利400萬免稅。奢侈稅同步停徵。",change_content:"按售價課稅(奢侈稅) -> 按獲利課稅(45%~15%)",affected_scope:"短線炒作客、自住客",background:"奢侈稅同步停徵：象徵房市進入「實價課稅」新紀元。",impact_analysis:"[毀滅] 短進短出獲利被腰斬，投資客大量退場。[受益] 房價盤整，自住客獲得較佳議價空間。",details:["課稅基礎：房地交易所得 = 交易成交價額 - 原始取得成本 - 相關費用 - 土地漲價總數額。","持有1年以內：稅率 45%。","持有1-2年：稅率 35%。","持有2-10年：稅率 20%。","持有超過10年：稅率 15%。","自用住宅優惠：獲利400萬元以下免稅，超過部分10%。(需連續設籍滿6年)","日出條款：2016年1月1日以後取得之房地適用新制。"]},{id:"f-2016-03-24",date:"2016-03-24",title:"央行大幅鬆綁信用管制",category:"finance",impact:"high",description:"刪除特定地區管制與自然人第3戶以上限制，僅保留豪宅管制(6成)。",change_content:"刪除多數管制，僅保留豪宅限貸",affected_scope:"換屋族、一般投資客",background:"經濟成長疲弱：為提振內需經濟，央行解除長達6年的房市管制。",impact_analysis:"[受益] 貸款成數恢復，換屋與置產門檻降低，市場交易量逐漸回溫。",details:["解除管制區域：台北市及新北市特定地區。","解除限制對象：自然人第3戶以上購屋貸款、公司法人購屋貸款。","保留限制：高價住宅(豪宅)貸款最高成數仍維持6成。"]},{id:"p-2018-06-27",date:"2018-06-27",title:"租賃住宅市場發展及管理條例",category:"policy",impact:"low",description:"建立包租代管機制，鼓勵房東釋出空屋，給予稅賦優惠(所得稅減免)。",change_content:"包租代管稅賦優惠",affected_scope:"房東、租屋族",background:"美中貿易戰開打：全球供應鏈重組，資金開始撤離中國。",impact_analysis:"[受益] 房東享有所得稅減免；租屋族獲得專業代管服務，租賃關係較有保障。",details:["租稅優惠：個人房東委託包租代管，月租金6000元以下免稅；6000-20000元必要費用率53%。","專業證照：建立租賃住宅管理人員證照制度。","糾紛處理：建立租賃糾紛免費調處機制。"]},{id:"f-2019-08-15",date:"2019-08-15",title:"境外資金匯回專法",category:"finance",impact:"medium",description:"鼓勵台商資金回流享優惠稅率，禁止直接投資房地產，但產生外溢效應帶動豪宅與工業地產。",change_content:"資金專法回流 (禁入房市但有外溢)",affected_scope:"工業地產主、豪宅建商",background:"台商回流潮：史上最大規模資金回台，雖禁入房市，但產生外溢效應。",impact_analysis:"[暴富] 工業用地與廠房價格飆漲。[受益] 企業主獲利與分紅轉入豪宅市場，帶動高總價產品去化。",details:["優惠稅率：第一年匯回稅率8%，第二年10%。(實質投資可退稅一半)","投資限制：禁止資金直接投資房地產(避免炒房)。","資金控管：資金需存入專戶，控管5-7年才能分批提取。","外溢效應：雖然不能直接買房，但增加市場資金總量，且企業獲利後的分紅仍可自由運用。"]},{id:"f-2020-03-19",date:"2020-03-19",title:"央行降息 1 碼",category:"finance",impact:"high",description:"重貼現率降至1.125%，房貸利率跌破1.4%歷史新低，無限QE背景下引發資產通膨。",change_content:"重貼現率 1.375% -> 1.125%",affected_scope:"全體購屋族、股市投資人",background:"COVID-19 疫情爆發：美國聯準會無限QE，全球熱錢氾濫。",impact_analysis:"[刺激] 持有成本極低，「租不如買」與「買房抗通膨」心理大爆發，股房雙漲。",details:["降息幅度：調降重貼現率 0.25個百分點。","房貸利率：五大銀行新承做房貸利率跌破 1.4%，創歷史新低。","配套補貼：針對受疫情影響產業及自用住宅貸款提供額外補貼。"]},{id:"f-2020-12-08",date:"2020-12-08",title:"央行信用管制 (第一波)",category:"finance",impact:"medium",description:"法人購屋限貸6成，自然人第3戶限貸6成，建商餘屋限貸5成。",change_content:"法人/第3戶/餘屋 限貸 5-6成",affected_scope:"公司法人、多屋族(3戶+)",background:"房市過熱跡象：紅單炒作猖獗，排隊買房現象頻傳。",impact_analysis:"[警示] 宣示政府打炒房決心，但因低利環境，實質殺傷力有限。",details:["公司法人：第一戶貸款成數最高 6成，無寬限期。","自然人第3戶(含)以上：貸款成數最高 6成，無寬限期。","購地貸款：限貸 6.5成，需保留 1成動工款。","餘屋貸款：限貸 5成。"]},{id:"f-2021-03-19",date:"2021-03-19",title:"央行信用管制 (第二波)",category:"finance",impact:"medium",description:"法人購屋成數降至4成，豪宅降至5.5成。",change_content:"法人限貸 4成；豪宅限貸 5.5成",affected_scope:"公司法人、豪宅客",background:"投機風氣未減",impact_analysis:"[打擊] 封鎖利用公司名義高槓桿炒房的途徑。",details:["公司法人：貸款成數調降至 4成。","自然人高價住宅：第1戶限貸 5.5成，第3戶以上限貸 4成。","工業區閒置土地：貸款最高 5.5成。"]},{id:"p-2021-07-01",date:"2021-07-01",title:"實價登錄 2.0 & 房地合一 2.0",category:"policy",impact:"high",description:"門牌完整揭露，預售屋即時申報(30日)，禁止紅單轉售；重稅期延長(45%改2年, 35%改5年)，預售屋納稅。",change_content:"預售屋納管、重稅閉鎖期延長、禁紅單",affected_scope:"預售屋買方/投機客、建商、換屋族",background:"房市多頭確立；疫情三級警戒(內需停滯但房市創高)",impact_analysis:"[雙面刃] 資訊全透明反成定錨工具。[閉鎖] 投機客無法短進短出，成屋惜售供給減少，價格難跌。",details:["實價登錄2.0：門牌號碼完整揭露 (不再區段化)。","預售屋納管：銷售前需備查，簽約後30日內申報實價登錄。","紅單禁止：禁止預售屋紅單轉售。","房地合一2.0：預售屋獲利納入房地合一稅課徵。","延長重稅期：持有2年內45%，2-5年35% (原為1-2年)。","法人比照：法人交易比照自然人稅率 (防堵公司名義短期炒作)。"]},{id:"f-2021-09-24",date:"2021-09-24",title:"央行信用管制 (第三波)",category:"finance",impact:"medium",description:"特定地區 (六都+新竹) 第2戶取消寬限期。",change_content:"特定地區第2戶 取消寬限期",affected_scope:"投資客、換屋族",background:"房價持續攀升",impact_analysis:"[壓力] 買第2間房必須立刻還本金，增加現金流壓力，迫使部分槓桿過大者退場。",details:["管制區域：新增特定地區 (六都 + 新竹縣市)。","自然人第2戶：取消寬限期 (需本息攤還)。","購地貸款：調降至 6成。","工業區閒置土地：調降至 5成。"]},{id:"f-2021-12-17",date:"2021-12-17",title:"央行信用管制 (第四波)",category:"finance",impact:"medium",description:"豪宅貸款降至4成，第3戶降至4成，餘屋貸款降至4成。",change_content:"豪宅/第3戶/餘屋 限貸 4成",affected_scope:"建商、豪宅客",background:"營建成本飆漲：缺工缺料議題發酵。",impact_analysis:"[緊縮] 建商資金鏈趨緊，中小型建商生存困難，市場走向大者恆大。",details:["自然人高價住宅：貸款成數一律降至 4成 (無寬限期)。","自然人第3戶(含)以上：貸款成數一律降至 4成。","購地貸款：降至 5成。","餘屋貸款：降至 4成。"]},{id:"f-2022-03-17",date:"2022-03-17",title:"央行升息循環啟動",category:"finance",impact:"medium",description:"央行跟進Fed升息(全年共2.5碼)，房貸利率重回2%以上。",change_content:"升息 2.5碼 (利率重回 2% table+)",affected_scope:"房貸族",background:"全球通膨危機：美國暴力升息，全球股市修正。",impact_analysis:"[負擔增加] 每千萬房貸每年利息支出增加約3-4萬元，稍微冷卻追價意願。",details:["2022-03：升息 1碼 (0.25%)。","2022-06：升息 半碼 (0.125%)。","2022-09：升息 半碼 (0.125%)。","2022-12：升息 半碼 (0.125%)。","存款準備率：同步調升，緊縮市場游資。"]},{id:"f-2023-06-16",date:"2023-06-16",title:"央行信用管制 (第五波)",category:"finance",impact:"medium",description:"特定地區第2戶限貸成數上限 7成。",change_content:"特定地區第2戶 限貸 7成",affected_scope:"換屋族、投資客",background:"房市量縮價穩：市場觀望平均地權條例上路。",impact_analysis:"[微痛] 需多準備1成自備款，影響尚可控。",details:["管制區域：特定地區 (六都 + 新竹縣市)。","自然人第2戶：新增貸款成數上限 7成 (此前僅無寬限期)。"]},{id:"p-2023-07-01",date:"2023-07-01",title:"平均地權條例修正",category:"policy",impact:"high",description:"預售屋禁止換約轉售，建立檢舉獎金，私法人購屋許可制。",change_content:"預售屋禁換約、私法人許可制",affected_scope:"預售屋黃牛、豪宅法人",background:"投機客的大限",impact_analysis:"[滅絕] 純粹賺價差的紅單與換約客徹底消失。豪宅市場因法人需經許可，交易量急凍。",details:["限制換約轉售：預售屋與新建成屋簽約後，除配偶、直系或二親等旁系外，不得讓與或轉售 (禁止黃牛)。","重罰炒作：嚴懲散播不實資訊影響房價，最高罰5000萬元。","檢舉獎金：建立檢舉實名制，獎金為罰鍰 30%。","私法人購屋許可制：私法人購買住宅用房屋需經內政部許可 (限制豪宅私法人節稅管道)。"]},{id:"p-2023-08-01",date:"2023-08-01",title:"新青安貸款專案",category:"policy",impact:"high",description:"額度1000萬，年限40年，寬限期5年，利率補貼(1.775%起)。",change_content:"40年期/5年寬限/降息補貼",affected_scope:"首購族、投機客(人頭)、低總價屋主",background:"總統大選前夕：政府釋出利多，試圖減輕年輕人負擔。",impact_analysis:"[狂熱] 創造「租不如買」與「5年免還本」的套利空間。低總價成屋被掃貨，房價逆勢暴漲。",details:["貸款額度：提高至 1000萬元。","利息補貼：政府補貼 1.5碼 (0.375%) + 公股銀行減半碼 = 利率 1.775% 起。","貸款年限：延長至 40年。","寬限期：延長至 5年 (只繳息不還本)。","資格：本人、配偶及未成年子女名下均無自有住宅。"]},{id:"f-2024-06-14",date:"2024-06-14",title:"央行信用管制 (第六波)",category:"finance",impact:"medium",description:"特定地區第2戶限貸成數降至 6成。",change_content:"特定地區第2戶 限貸 6成",affected_scope:"換屋族、置產客",background:"台股站上2萬點：AI熱潮帶動股市財富效應，資金外溢至房市。",impact_analysis:"[無效] 股市獲利豐厚，6成限貸無法阻擋資金湧入房市。",details:["管制區域：特定地區 (六都 + 新竹縣市)。","自然人第2戶：貸款成數上限由 7成調降為 6成。","調升存款準備率：調升 0.25個百分點 (收回市場資金)。"]},{id:"p-2024-07-01",date:"2024-07-01",title:"囤房稅 2.0 實施",category:"policy",impact:"medium",description:"全國歸戶，非自用稅率調高至 2.0%-4.8%，建商餘屋依持有年限課稅。",change_content:"全國歸戶；稅率 2.0%~4.8%",affected_scope:"多屋族、租屋族、建商",background:"租金指數創高",impact_analysis:"[轉嫁] 多屋族將稅負轉嫁至租金，導致租金上漲。建商面臨餘屋去化壓力，傾向預售完銷。",details:["全國歸戶：由縣市歸戶改為全國歸戶計算戶數。","稅率調升：非自住住家用稅率調升為 2%~4.8% (原1.5%~3.6%)。","單一自住優惠：全國單一自住(本人配偶子女僅一戶)且房屋現值在一定金額以下，稅率降至 1%。","建商餘屋：持有2年以內稅率 2%~3.6%；超過2年稅率 2%~4.8% (鼓勵釋出餘屋)。"]},{id:"f-2024-08-01",date:"2024-08-01",title:"銀行限貸令 (72-2水位)",category:"finance",impact:"high",description:"銀行法72-2條逼近30%上限，自主限貸、排隊撥款，市場流動性急凍。",change_content:"銀行自主限貸、排隊撥款",affected_scope:"即將交屋族、賣屋換屋族",background:"新青安效應發酵：過多成屋交易與新青安撥款，耗盡銀行額度。",impact_analysis:"[恐慌] 買了房卻貸不到款，面臨違約風險。市場流動性瞬間急凍。",details:["銀行法72-2條：商業銀行辦理住宅建築及企業建築放款總額，不得超過存款總餘額及金融債券發售額之 30%。","現象：多家銀行房貸水位接近滿載。","影響：銀行暫停收件、排隊撥款(需等數月)、利率大幅調升(2.6%-3%以上)。"]},{id:"f-2024-09-20",date:"2024-09-20",title:"央行信用管制 (第七波)",category:"finance",impact:"high",description:"有房者第1戶無寬限期；全國第2戶限貸5成；法人/豪宅/第3戶限貸3成。",change_content:"有房者第1戶無寬限；第2戶全國限貸5成",affected_scope:"換屋族、繼承族、交屋族",background:"金龍海嘯：央行判定房市過熱，認為新青安助長投機，決心斷絕金流。",impact_analysis:"[重傷/錯殺] 史上最嚴厲管制。1. 換屋族需5成自備。2. 繼承祖產失寬限。3. 預售交屋斷頭風險大增。",details:["自然人第1戶：名下有房屋者(含繼承、持分)，第1戶購屋貸款「無寬限期」。","自然人第2戶：貸款成數上限降至 5成，且擴及「全國」。","自然人第3戶以上：貸款成數上限降至 3成。","公司法人：購屋貸款成數降至 3成。","豪宅(高價住宅)：貸款成數降至 3成。","餘屋貸款：降至 3成。","存款準備率：再調升 0.25個百分點。"]}];var es=s(30122),ea=s(85753),en=s(68822),ei=s(69220),er=s(22651),el=s(44071),eo=s(9921),ec=s(66088);function ed({data:e}){let t=(0,n.useMemo)(()=>{if(!e)return[];let t=new Set;return e.forEach(e=>{e["建案名稱"]&&t.add(e["建案名稱"])}),Array.from(t).map(e=>({value:e,label:e}))},[e]),[s,i]=(0,n.useState)([]),[r,l]=(0,n.useState)(null),[c,d]=(0,n.useState)(1),[x,m]=(0,n.useState)(!1),h=(0,n.useMemo)(()=>{if(0===s.length||!e||0===e.length)return[];let t={};return e.forEach(e=>{let a=e["建案名稱"];if(!a||!s.includes(a))return;let n=new Date(e["交易日"]).getTime();isNaN(n)||(t[a]||(t[a]=[]),t[a].push(n))}),Object.entries(t).map(([e,t])=>{let s=Math.min(...t),a=Math.max(...t);return{name:e,start:new Date(s),end:new Date(a),startStr:new Date(s).toISOString().slice(0,10),endStr:new Date(a).toISOString().slice(0,10),count:t.length}}).sort((e,t)=>e.start.getTime()-t.start.getTime()).slice(0,10)},[e,s]),p=(0,n.useMemo)(()=>{let e=new Date().getFullYear()+1;return h.length>0&&(e=Math.max(e,Math.max(...h.map(e=>e.end.getFullYear()))+1)),{start:new Date("2012-01-01"),end:new Date(`${e}-12-31`),totalMonths:(e-2012+1)*12}},[h]),u=Math.max(350,100+40*h.length+80),f=e=>{let t=new Date(e),s=p.start.getTime(),a=p.end.getTime(),n=t.getTime();return n<s?0:n>a?100:(n-s)/(a-s)*100},g=(0,n.useMemo)(()=>et.filter(e=>{let t=new Date(e.date);return t>=p.start&&t<=p.end}),[p]),b=(0,n.useMemo)(()=>g.slice().reverse().map(e=>({日期:e.date,標題:e.title,類別:"finance"===e.category?"金融":"政策",影響:e.impact,變革內容:e.change_content,影響對象:e.affected_scope})),[g]);return(0,a.jsxs)(K.Zp,{className:"w-full bg-black/40 border-zinc-800 backdrop-blur-xl",children:[(0,a.jsxs)(K.aR,{children:[(0,a.jsxs)(K.ZB,{className:"flex items-center gap-2 text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400",children:[(0,a.jsx)($.A,{className:"w-6 h-6 text-cyan-500"}),"房市政策時光機"]}),(0,a.jsx)(K.BT,{className:"text-zinc-400",children:"建案銷售期間與重大政策/金融事件的交叉比對"})]}),(0,a.jsxs)(K.Wu,{children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row items-start md:items-end justify-between mb-6 px-2 gap-4",children:[(0,a.jsx)("div",{className:"w-full md:w-1/2 lg:w-1/3",children:(0,a.jsx)(L,{projects:t,onChange:i,title:"選擇建案 (顯示銷售區間)",placeholder:"搜尋建案以顯示在時間軸...",max:6})}),(0,a.jsxs)("div",{className:"flex items-center justify-between w-full md:w-auto gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 bg-black/20 rounded-lg p-1 border border-white/5",children:[(0,a.jsx)("button",{onClick:()=>d(e=>Math.max(.5,e-.25)),className:"p-1.5 hover:bg-white/10 rounded-md text-zinc-400 hover:text-white transition-colors",children:(0,a.jsx)(ei.A,{className:"w-4 h-4"})}),(0,a.jsxs)("span",{className:"text-xs font-mono text-zinc-500 w-12 text-center",children:[(100*c).toFixed(0),"%"]}),(0,a.jsx)("button",{onClick:()=>d(e=>Math.min(3,e+.25)),className:"p-1.5 hover:bg-white/10 rounded-md text-zinc-400 hover:text-white transition-colors",children:(0,a.jsx)(er.A,{className:"w-4 h-4"})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 text-xs text-zinc-500",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-emerald-500"})," 金融事件"]}),(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full bg-rose-500"})," 房市政策"]})]})]})]}),(0,a.jsx)("div",{className:"relative w-full overflow-x-auto pb-12 pt-8 hide-scrollbar",children:(0,a.jsxs)("div",{className:"relative pr-20 ml-24 border-b border-zinc-800 transition-all duration-300 ease-out",style:{minWidth:`${1200*c}px`,height:`${u}px`},children:[(0,a.jsx)("div",{className:"absolute top-0 w-full h-full pointer-events-none",children:Array.from({length:p.end.getFullYear()-p.start.getFullYear()+1}).map((e,t)=>{let s=p.start.getFullYear()+t,n=f(`${s}-01-01`);return(0,a.jsx)("div",{className:"absolute h-full border-l border-dashed border-zinc-800/50",style:{left:`${n}%`},children:(0,a.jsx)("span",{className:"absolute -top-6 -left-3 text-xs font-mono text-zinc-500",children:s})},s)})}),h.map((e,t)=>{let s=["from-cyan-500/20 to-blue-500/20 border-cyan-500/30 text-cyan-400","from-violet-500/20 to-purple-500/20 border-violet-500/30 text-violet-400","from-amber-500/20 to-orange-500/20 border-amber-500/30 text-amber-400","from-emerald-500/20 to-teal-500/20 border-emerald-500/30 text-emerald-400","from-pink-500/20 to-rose-500/20 border-pink-500/30 text-pink-400"],n=s[t%s.length];return(0,a.jsxs)("div",{className:(0,o.cn)("absolute h-8 border-y backdrop-blur-sm z-10 flex items-center justify-center group transition-all hover:bg-white/5",`bg-gradient-to-r ${n}`),style:{left:`${f(e.startStr)}%`,width:`${Math.max(.5,f(e.endStr)-f(e.startStr))}%`,top:`${100+40*t}px`},children:[(0,a.jsx)("div",{className:"absolute right-full mr-2 flex items-center h-full top-0",children:(0,a.jsx)("span",{className:"text-[10px] font-bold text-zinc-400 whitespace-nowrap bg-black/40 px-1.5 py-0.5 rounded border border-white/5",children:e.name})}),(0,a.jsxs)("div",{className:"absolute -top-8 text-[10px] whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity bg-black/90 px-2 py-1 rounded border border-zinc-700 z-20 pointer-events-none",children:[e.startStr," ~ ",e.endStr," (",e.count,"筆)"]})]},e.name)}),g.map((e,t)=>{let s=f(e.date),n="high"===e.impact,i=t%2==0?"8%":"85%",c=!1;if(h.length>0){let t=new Date(e.date);c=h.some(e=>t>=e.start&&t<=e.end)}return(0,a.jsxs)("div",{className:(0,o.cn)("absolute transform -translate-x-1/2 flex flex-col items-center group cursor-pointer transition-all duration-300 z-20",c?"opacity-100 scale-110":"opacity-60 hover:opacity-100 hover:scale-110",r?.id===e.id&&"scale-125 opacity-100 z-30"),style:{left:`${s}%`,top:i},onClick:()=>l(e),children:[(0,a.jsx)("div",{className:(0,o.cn)("h-8 w-px absolute","8%"===i?"top-full bg-gradient-to-b":"bottom-full bg-gradient-to-t","from-transparent to-zinc-700")}),(0,a.jsx)("div",{className:(0,o.cn)("w-8 h-8 rounded-full flex items-center justify-center border shadow-[0_0_15px_rgba(0,0,0,0.5)] transition-all","finance"===e.category?"bg-emerald-950/80 border-emerald-500/50 text-emerald-400 group-hover:shadow-emerald-500/20":"bg-rose-950/80 border-rose-500/50 text-rose-400 group-hover:shadow-rose-500/20",n&&"ring-2 ring-offset-2 ring-offset-black/50 ring-opacity-50","finance"===e.category&&n?"ring-emerald-500":"ring-rose-500",r?.id===e.id&&"ring-2 ring-white ring-offset-2 ring-offset-black"),children:(e=>{switch(e){case"finance":return(0,a.jsx)(es.A,{className:"w-3 h-3 text-emerald-400"});case"policy":return(0,a.jsx)(ea.A,{className:"w-3 h-3 text-rose-400"});default:return(0,a.jsx)(en.A,{className:"w-3 h-3 text-blue-400"})}})(e.category)}),(0,a.jsx)("div",{className:(0,o.cn)("absolute whitespace-nowrap text-[10px] px-2 py-0.5 mt-2 rounded bg-black/80 border border-zinc-700 backdrop-blur-md transition-all font-medium","8%"===i?"-top-8":"-bottom-8",c?"text-white border-yellow-500/50":"text-zinc-400 group-hover:text-white",r?.id===e.id&&"text-white border-white/50 bg-zinc-800"),children:e.title}),(0,a.jsx)("div",{className:(0,o.cn)("absolute text-[9px] font-mono text-zinc-600","8%"===i?"top-10":"bottom-10"),children:e.date})]},e.id)})]})}),r&&(0,a.jsx)("div",{className:"mt-6 mb-8 border border-zinc-700/50 bg-zinc-900/80 p-6 rounded-xl animate-in fade-in slide-in-from-top-4 shadow-2xl shadow-black/50",children:(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between border-b border-white/5 pb-4",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(ee,{variant:"outline",className:(0,o.cn)("text-sm px-3 py-1","finance"===r.category?"bg-emerald-500/10 text-emerald-400 border-emerald-500/30":"bg-rose-500/10 text-rose-400 border-rose-500/30"),children:"finance"===r.category?"金融事件":"房市政策"}),(0,a.jsx)("span",{className:"text-zinc-400 font-mono text-sm",children:r.date})]}),(0,a.jsx)("h3",{className:"text-2xl font-bold text-white tracking-tight",children:r.title})]}),(0,a.jsxs)("div",{className:(0,o.cn)("px-3 py-1 rounded-full text-xs font-medium border","high"===r.impact?"bg-red-500/10 text-red-400 border-red-500/30":"bg-yellow-500/10 text-yellow-400 border-yellow-500/30"),children:["影響程度: ","high"===r.impact?"高":"medium"===r.impact?"中":"低"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-sm font-bold text-zinc-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[(0,a.jsx)(en.A,{className:"w-4 h-4"})," 政策/事件內容"]}),(0,a.jsx)("p",{className:"text-zinc-200 text-base leading-relaxed bg-zinc-950/50 p-4 rounded-lg border border-white/5",children:r.description})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-sm font-bold text-zinc-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[(0,a.jsx)(ea.A,{className:"w-4 h-4"})," 具體規範變革"]}),(0,a.jsx)("div",{className:"bg-zinc-950/50 p-4 rounded-lg border border-white/5 text-cyan-400 font-medium",children:r.change_content||"無具體規範變更"})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-sm font-bold text-zinc-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[(0,a.jsx)(es.A,{className:"w-4 h-4"})," 時代背景與金融環境"]}),(0,a.jsx)("p",{className:"text-zinc-300 text-sm leading-relaxed bg-zinc-950/30 p-4 rounded-lg border border-white/5",children:r.background||"尚無背景資料"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-sm font-bold text-zinc-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[(0,a.jsx)(el.A,{className:"w-4 h-4"})," 受眾影響分析"]}),(0,a.jsxs)("div",{className:"relative overflow-hidden rounded-lg border border-white/10 bg-gradient-to-br from-indigo-500/10 to-purple-500/10 p-4",children:[(0,a.jsx)("div",{className:"absolute top-0 right-0 p-2 opacity-10",children:(0,a.jsx)(el.A,{className:"w-24 h-24"})}),(0,a.jsxs)("div",{className:"relative z-10",children:[(0,a.jsxs)("p",{className:"text-indigo-300 font-medium mb-2 text-xs uppercase",children:["影響對象: ",r.affected_scope]}),(0,a.jsx)("p",{className:"text-white text-sm leading-relaxed",children:r.impact_analysis||"尚無詳細分析"})]})]})]})]})]}),r.details&&r.details.length>0&&(0,a.jsxs)("div",{className:"border-t border-white/5 pt-4",children:[(0,a.jsx)("button",{onClick:()=>m(!x),className:"flex items-center gap-2 text-sm text-zinc-400 hover:text-white transition-colors w-full justify-center py-2",children:x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eo.A,{className:"w-4 h-4"})," 收起完整規範細節"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ec.A,{className:"w-4 h-4"})," 展開完整規範細節 (",r.details.length," 項)"]})}),x&&(0,a.jsx)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 animate-in fade-in slide-in-from-top-2",children:r.details.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-start gap-3 bg-black/40 p-3 rounded border border-zinc-800 text-sm text-zinc-300",children:[(0,a.jsx)("span",{className:"flex items-center justify-center w-5 h-5 rounded-full bg-zinc-800 text-zinc-500 text-xs shrink-0 mt-0.5",children:t+1}),(0,a.jsx)("span",{children:e})]},t))})]})]})}),(0,a.jsxs)("div",{className:"mt-8 border-t border-zinc-800 pt-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(el.A,{className:"w-5 h-5 text-purple-400"}),(0,a.jsx)("h3",{className:"text-lg font-bold text-zinc-200",children:"政策影響比較表"})]}),(0,a.jsx)(B.N,{data:b,filename:"policy_comparison",label:"匯出政策表"})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-white/10 overflow-hidden bg-black/20",children:[(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-4 p-4 bg-zinc-900/50 border-b border-white/5 text-xs font-bold text-zinc-400 uppercase tracking-wider",children:[(0,a.jsx)("div",{className:"col-span-2",children:"實施日期"}),(0,a.jsx)("div",{className:"col-span-3",children:"政策/事件名稱"}),(0,a.jsx)("div",{className:"col-span-4",children:"變革內容 (Before vs After)"}),(0,a.jsx)("div",{className:"col-span-3",children:"影響對象與範圍"})]}),(0,a.jsx)("div",{className:"divide-y divide-white/5 max-h-[400px] overflow-y-auto custom-scrollbar",children:g.slice().reverse().map(e=>(0,a.jsxs)("div",{className:(0,o.cn)("grid grid-cols-12 gap-4 p-4 text-sm transition-colors hover:bg-white/5 cursor-pointer",r?.id===e.id?"bg-white/10":""),onClick:()=>l(e),children:[(0,a.jsx)("div",{className:"col-span-2 font-mono text-zinc-500",children:e.date}),(0,a.jsxs)("div",{className:"col-span-3 flex items-start gap-2",children:[(0,a.jsx)(ee,{variant:"outline",className:(0,o.cn)("shrink-0 mt-0.5","finance"===e.category?"text-emerald-400 border-emerald-500/30":"text-rose-400 border-rose-500/30"),children:"finance"===e.category?"金融":"政策"}),(0,a.jsx)("span",{className:(0,o.cn)("font-medium","high"===e.impact?"text-white":"text-zinc-400"),children:e.title})]}),(0,a.jsx)("div",{className:"col-span-4 text-zinc-300",children:e.change_content?(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-cyan-500 shrink-0"}),e.change_content]}):(0,a.jsx)("span",{className:"text-zinc-600 italic",children:"--"})}),(0,a.jsx)("div",{className:"col-span-3 text-zinc-400",children:e.affected_scope||(0,a.jsx)("span",{className:"text-zinc-600 italic",children:"--"})})]},e.id))})]})]})]})]})}var ex=s(13545),em=s(6296),eh=s(57518);let ep=eh.bL,eu=n.forwardRef(({className:e,...t},s)=>(0,a.jsx)(eh.B8,{ref:s,className:(0,o.cn)("inline-flex h-10 items-center justify-center rounded-md bg-zinc-800 p-1 text-zinc-400",e),...t}));eu.displayName=eh.B8.displayName;let ef=n.forwardRef(({className:e,...t},s)=>(0,a.jsx)(eh.l9,{ref:s,className:(0,o.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-zinc-950 data-[state=active]:text-white data-[state=active]:shadow-sm",e),...t}));ef.displayName=eh.l9.displayName;let eg=n.forwardRef(({className:e,...t},s)=>(0,a.jsx)(eh.UC,{ref:s,className:(0,o.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));eg.displayName=eh.UC.displayName;var eb=s(39734);function ej(){let e=(0,l.P)(),{loading:t,error:s,analysisData:o,handleAnalyze:c}=(0,eb.g)();return(0,n.useEffect)(()=>{},[]),(0,a.jsxs)(r.e,{children:[(0,a.jsx)("section",{className:"mb-6 relative z-50",children:(0,a.jsx)(N,{onAnalyze:c,isLoading:t})}),s&&(0,a.jsxs)("div",{className:"bg-red-500/10 border border-red-500/50 text-red-500 p-4 rounded-lg mb-6 flex items-center gap-2",children:[(0,a.jsx)(ex.A,{size:20}),s]}),t&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-20",children:[(0,a.jsx)(em.A,{className:"h-10 w-10 animate-spin text-violet-500 mb-4"}),(0,a.jsx)("p",{className:"text-zinc-400",children:"正在分析數據，請稍候..."})]}),!t&&!o&&!s&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 glass-panel border-dashed border-2 border-zinc-800 rounded-xl",children:[(0,a.jsx)("div",{className:"text-zinc-500 mb-2",children:"尚未進行分析"}),(0,a.jsx)("p",{className:"text-zinc-600 text-sm",children:"請選擇篩選條件並點擊「開始分析」"})]}),!t&&o&&(0,a.jsx)("div",{className:"space-y-8 pb-20",children:(0,a.jsxs)(ep,{value:e.activeTab,onValueChange:e.setActiveTab,className:"w-full",children:[(0,a.jsx)("div",{className:"overflow-x-auto pb-2 mask-fade-right pr-8",children:(0,a.jsxs)(eu,{className:"bg-zinc-900/50 border border-white/5 p-1 mb-6 inline-flex min-w-max",children:[(0,a.jsx)(ef,{value:"ranking",className:"whitespace-nowrap",children:"核心指標與排名"}),(0,a.jsx)(ef,{value:"price-band",className:"whitespace-nowrap",children:"總價帶分析"}),(0,a.jsx)(ef,{value:"unit-price",className:"whitespace-nowrap",children:"單價分析"}),(0,a.jsx)(ef,{value:"heatmap",className:"whitespace-nowrap",children:"調價熱力圖"}),(0,a.jsx)(ef,{value:"timeline",className:"whitespace-nowrap",children:"政策時光機"}),(0,a.jsx)(ef,{value:"velocity",className:"whitespace-nowrap",children:"銷售速度與房型"}),(0,a.jsx)(ef,{value:"parking",className:"whitespace-nowrap",children:"車位分析"}),(0,a.jsx)(ef,{value:"data-list",className:"whitespace-nowrap",children:"交易明細列表"})]})}),(0,a.jsx)(eg,{value:"ranking",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,a.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,a.jsx)(w.p,{data:o})})}),(0,a.jsx)(eg,{value:"price-band",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,a.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,a.jsx)(z.P,{data:o.priceBandAnalysis?{...o.priceBandAnalysis,transactionDetails:o.transactionDetails}:null})})}),(0,a.jsx)(eg,{value:"unit-price",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,a.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,a.jsx)(O.U,{data:o})})}),(0,a.jsx)(eg,{value:"heatmap",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,a.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,a.jsx)(V,{data:o.priceGridAnalysis?o:null})})}),(0,a.jsx)(eg,{value:"timeline",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,a.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,a.jsx)(ed,{data:o.transactionDetails})})}),(0,a.jsx)(eg,{value:"velocity",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,a.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,a.jsx)(_.Q,{data:o})})}),(0,a.jsx)(eg,{value:"parking",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,a.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,a.jsx)(T,{data:o.parkingAnalysis?.parkingRatio?o:null})})}),(0,a.jsx)(eg,{value:"data-list",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,a.jsx)(i.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,a.jsx)(Q.p,{trigger:o.transactionDetails?.length?o:null})})})]})})]})}},49224:(e,t,s)=>{Promise.resolve().then(s.bind(s,32666))}},e=>{e.O(0,[4764,3242,6119,1819,2867,7550,6609,3252,7202,8500,2251,7714,9108,8441,3794,7358],()=>e(e.s=49224)),_N_E=e.O()}]);