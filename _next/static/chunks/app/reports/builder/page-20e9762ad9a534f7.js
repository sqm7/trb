(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3806],{22927:(e,t,s)=>{Promise.resolve().then(s.bind(s,84307))},84307:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eh});var a,i=s(95155),r=s(12115),l=s(98500),n=s.n(l),c=s(95542),o=s(41780),d=s(73321),h=s(16385),x=s(85864),m=s(89239),p=s(33024),u=s(91663),g=s(68459),b=s(41641),j=s(21362),v=s(51914),f=s(40980),N=s(96066);function w({width:e,height:t,children:s,items:a,onClickBackground:l,onMarqueeSelect:n}){let c=(0,r.useRef)(null),o=(0,r.useRef)(null),d=(0,N.Q)(e=>e.zoomLevel),h=(0,N.Q)(e=>e.setZoomLevel),[x,m]=(0,r.useState)(!1),[p,u]=(0,r.useState)(null),g=d/100,b=(0,r.useRef)(!1);r.useEffect(()=>{if(c.current){let s=c.current.parentElement;if(s){let a=Math.min((s.clientWidth-100)/e,(s.clientHeight-100)/t);b.current||(h(Math.floor(100*a)),b.current=!0)}}},[e,t,h]);let j=(0,r.useCallback)(e=>{(e.ctrlKey||e.metaKey)&&(e.preventDefault(),h(d+(e.deltaY>0?-5:5)))},[d,h]),v=(0,r.useCallback)(e=>{let t=e.target,s=o.current?.querySelector(".report-canvas-content"),a=t.closest(".react-draggable")||t.closest("[data-chart-item]"),i=e.target===e.currentTarget||t===s||t.classList.contains("report-canvas-content")||t.style.backgroundImage?.includes("linear-gradient");if(a||!i&&!t.closest(".report-canvas-content"))return;let r=e.currentTarget.getBoundingClientRect(),l=(e.clientX-r.left)/g,n=(e.clientY-r.top)/g;m(!0),u({startX:l,startY:n,endX:l,endY:n,isShiftPressed:e.shiftKey})},[g]),w=(0,r.useCallback)(s=>{if(!x||!p)return;let a=s.currentTarget.getBoundingClientRect(),i=Math.max(0,Math.min(e,(s.clientX-a.left)/g)),r=Math.max(0,Math.min(t,(s.clientY-a.top)/g));u(e=>e?{...e,endX:i,endY:r,isShiftPressed:s.shiftKey}:null)},[x,p,g,e,t]),y=(0,r.useCallback)(e=>{if(x&&p){let t,s,i,r,c=(t=Math.min(p.startX,p.endX),s=Math.max(p.startX,p.endX),i=Math.min(p.startY,p.endY),r=Math.max(p.startY,p.endY),a.filter(e=>{let a=e.x+e.width,l=e.y+e.height;return!(e.x>s||a<t||e.y>r||l<i)}).map(e=>e.id)),o=Math.abs(p.endX-p.startX),d=Math.abs(p.endY-p.startY);o<5&&d<5?l?.():c.length>0?n?.(c,e.shiftKey||p.isShiftPressed):l?.()}m(!1),u(null)},[x,p,a,l,n]),z=p?{left:Math.min(p.startX,p.endX),top:Math.min(p.startY,p.endY),width:Math.abs(p.endX-p.startX),height:Math.abs(p.endY-p.startY)}:null;return(0,i.jsx)("div",{ref:c,className:"relative",style:{width:e*g,height:t*g},children:(0,i.jsxs)("div",{ref:o,className:(0,f.cn)("absolute origin-top-left bg-zinc-900 border border-white/10 rounded-lg shadow-2xl overflow-hidden","transition-transform duration-200",x&&"cursor-crosshair"),style:{width:e,height:t,transform:`scale(${g})`},onMouseDown:v,onMouseMove:w,onMouseUp:y,onMouseLeave:y,onWheel:j,children:[(0,i.jsx)("div",{className:"absolute inset-0 opacity-30 pointer-events-none",style:{backgroundImage:`
                            linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
                            linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px)
                        `,backgroundSize:"20px 20px"}}),(0,i.jsx)("div",{className:"relative w-full h-full report-canvas-content",children:s}),x&&z&&(0,i.jsx)("div",{className:"absolute border-2 border-violet-500 bg-violet-500/20 pointer-events-none z-50",style:z}),(0,i.jsxs)("div",{className:"absolute bottom-2 right-2 text-[10px] text-zinc-600 font-mono bg-zinc-950/80 px-2 py-1 rounded",children:[e," \xd7 ",t]})]})})}var y=s(37288),z=s(14403),k=s(93219),A=s(19835),C=s(69690),S=s(826),P=s(88042),M=s(3083);let $=(0,s(37206).default)(()=>Promise.all([s.e(7776),s.e(2441)]).then(s.bind(s,44822)),{loadableGenerated:{webpack:()=>[null]},ssr:!1}),Q=e=>(0,i.jsx)($,{...e});var I=s(98563),R=s(93398),D=s(4439);let L={"ranking-metrics":"核心數據指標","unit-price-stats":"各用途單價統計","ranking-chart":"建案排名","ranking-table":"建案排行列表","price-band-chart":"總價帶分佈","price-band-table":"總價帶詳細數據","price-band-location-table":"區域房型成交分佈","price-band-location-chart":"區域成交佔比","unit-price-bubble":"單價泡泡圖","type-comparison-table":"產品類型單價比較","sales-velocity-chart":"銷售速度","sales-velocity-table":"銷售速度明細","parking-pie":"車位配比","parking-price":"車位類型均價","parking-scatter":"車位坪數分析","parking-floor":"車位樓層分析",heatmap:"銷控熱力圖","heatmap-grid":"建案銷控熱力圖","heatmap-stats":"調價幅度摘要","heatmap-comparison":"戶型溢價貢獻","sales-heatmap":"房型面積熱力圖","sales-heatmap-detail":"熱力詳細交易表","data-list":"交易明細表"};function E({item:e,isSelected:t,onSelect:s,onUpdate:a,onRemove:l,onMoveToPage:n,analysisData:c}){let o=(0,N.Q)(e=>e.selectedIds),d=(0,N.Q)(e=>e.batchUpdateItems),h=(0,N.Q)(e=>e.pages),x=(0,N.Q)(e=>e.currentPageIndex),m=(0,N.Q)(e=>e.setDragging),u=h[x]?.items||[],b=r.useRef({}),j=r.useRef(!1),v=r.useRef(!1),[w,$]=r.useState(!1),[E,T]=r.useState({x:0,y:0}),Y=e=>{w&&(e.stopPropagation(),$(!1))};r.useEffect(()=>{"fit"===e.scaleMode&&a({contentScale:Math.min(e.width/400,e.height/300)})},[e.width,e.height,e.scaleMode]);let F=(0,N.Q)(e=>e.zoomLevel);return(0,i.jsxs)(y.p,{scale:F/100,size:{width:e.width,height:e.height},position:{x:e.x,y:e.y},onDragStart:e=>{if(v.current=!1,t){j.current=!0,m(!0,o.length);let e={};o.forEach(t=>{let s=u.find(e=>e.id===t);s&&(e[t]={x:s.x,y:s.y})}),b.current=e,console.log("Group drag start:",e)}else j.current=!1,m(!0,1)},onDrag:(t,s)=>{v.current=!0;let a=t.clientX||t.touches?.[0]?.clientX,i=t.clientY||t.touches?.[0]?.clientY;if(void 0!==a&&void 0!==i){let e=document.elementsFromPoint(a,i).find(e=>"true"===e.getAttribute("data-page-drop-target")||"true"===e.getAttribute("data-page-drop-zone")),t=e?.getAttribute("data-page-index"),s=null!=t?parseInt(t,10):null;N.Q.getState().setHoveredPageIndex(s)}if(j.current&&o.length>1){let t=s.x-(b.current[e.id]?.x||e.x),a=s.y-(b.current[e.id]?.y||e.y),i={};o.forEach(s=>{s!==e.id&&b.current[s]&&(i[s]={x:b.current[s].x+t,y:b.current[s].y+a})}),Object.keys(i).length>0&&d(i)}},onDragStop:(s,i)=>{let r=s.clientX||s.changedTouches?.[0]?.clientX,l=s.clientY||s.changedTouches?.[0]?.clientY;if(void 0!==r&&void 0!==l){let e=document.elementsFromPoint(r,l).find(e=>"true"===e.getAttribute("data-page-drop-target")||"true"===e.getAttribute("data-page-drop-zone"));if(e){let s=parseInt(e.getAttribute("data-page-index")||"-1",10);if(s>=0&&s!==N.Q.getState().currentPageIndex){t?N.Q.getState().moveSelectedItemsToPage(s):n&&n(s),N.Q.getState().setCurrentPage(s),j.current=!1,b.current={},m(!1),N.Q.getState().setHoveredPageIndex(null);return}}}if(j.current&&o.length>1){let t=i.x-(b.current[e.id]?.x||e.x),s=i.y-(b.current[e.id]?.y||e.y),a={};o.forEach(r=>{let l=b.current[r];l&&(a[r]={x:r===e.id?i.x:l.x+t,y:r===e.id?i.y:l.y+s})}),d(a)}else a({x:i.x,y:i.y});j.current=!1,b.current={},m(!1),N.Q.getState().setHoveredPageIndex(null)},onResizeStop:(e,t,s,i,r)=>{a({width:parseInt(s.style.width,10),height:parseInt(s.style.height,10),x:r.x,y:r.y})},minWidth:150,minHeight:100,bounds:void 0,onClick:e=>{e.stopPropagation(),v.current||s(e),v.current=!1},className:(0,f.cn)("bg-zinc-800/80 backdrop-blur-sm rounded-lg border-2 transition-colors overflow-hidden",t?"border-violet-500 shadow-lg shadow-violet-500/20":"border-transparent hover:border-zinc-600"),enableResizing:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},resizeHandleStyles:{topRight:{cursor:"ne-resize",width:20,height:20,right:-10,top:-10},bottomRight:{cursor:"se-resize",width:20,height:20,right:-10,bottom:-10},bottomLeft:{cursor:"sw-resize",width:20,height:20,left:-10,bottom:-10},topLeft:{cursor:"nw-resize",width:20,height:20,left:-10,top:-10},top:{cursor:"n-resize",height:20,top:-10},bottom:{cursor:"s-resize",height:20,bottom:-10},left:{cursor:"w-resize",width:20,left:-10},right:{cursor:"e-resize",width:20,right:-10}},children:[(0,i.jsxs)("div",{className:"h-7 bg-zinc-900/90 flex items-center justify-between px-2 cursor-move border-b border-white/5 select-none group/header",children:[(0,i.jsxs)("div",{className:"flex items-center gap-1.5 overflow-hidden",children:[(0,i.jsx)(A.A,{className:"h-3 w-3 text-zinc-500 group-hover/header:text-violet-400"}),(0,i.jsx)("span",{className:"text-[10px] text-zinc-400 font-medium truncate",children:L[e.type]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)("span",{className:"text-[9px] text-zinc-600 font-mono hidden sm:inline",children:[e.width,"\xd7",e.height]}),(0,i.jsx)("button",{onClick:e=>{e.stopPropagation(),l()},className:"p-1 rounded hover:bg-red-500/20 text-zinc-600 hover:text-red-400 transition-colors",children:(0,i.jsx)(g.A,{className:"h-3 w-3"})})]})]}),(0,i.jsxs)("div",{className:(0,f.cn)("p-2 relative group/content","crop"===e.scaleMode&&"overflow-hidden","pan"===e.scaleMode&&"overflow-hidden cursor-grab active:cursor-grabbing","fit"===e.scaleMode&&"overflow-hidden"),style:{height:"calc(100% - 28px)"},onMouseDown:t=>{"pan"===e.scaleMode&&(t.stopPropagation(),$(!0),T({x:t.clientX,y:t.clientY}))},onMouseMove:t=>{if(!w||"pan"!==e.scaleMode)return;t.stopPropagation();let s=t.clientX-E.x,i=t.clientY-E.y;a({panOffset:{x:(e.panOffset?.x||0)+s,y:(e.panOffset?.y||0)+i}}),T({x:t.clientX,y:t.clientY})},onMouseUp:Y,onMouseLeave:Y,children:[(0,i.jsx)("div",{style:{transform:"pan"===e.scaleMode?`translate(${e.panOffset?.x||0}px, ${e.panOffset?.y||0}px)`:"fit"===e.scaleMode?`scale(${e.contentScale||1})`:void 0,transformOrigin:"top left",width:"fit"===e.scaleMode?400:"100%",height:"fit"===e.scaleMode?300:"100%"},children:(()=>{if(!c)return(0,i.jsx)("div",{className:"flex items-center justify-center h-full text-zinc-500 text-sm",children:"無數據"});switch(e.type){case"sales-heatmap":{let t=e.data?.distribution||c.areaDistributionAnalysis;if(!t)return(0,i.jsx)("div",{className:"p-4 text-zinc-500",children:"無熱力圖數據"});return(0,i.jsx)("div",{className:"h-full overflow-hidden p-1",children:(0,i.jsx)(D.m,{data:t,selectedRooms:e.data?.selectedRooms||["2房","3房"],minArea:e.data?.min||15,maxArea:e.data?.max||65,interval:e.data?.interval||5})})}case"sales-heatmap-detail":{let t=r.useMemo(()=>{if(e.data&&Array.isArray(e.data)&&e.data.length>0)return e.data;if(!c.transactionDetails)return[];let t={};return c.transactionDetails.forEach(e=>{let s=e["建案名稱"]||e.projectName||"未知";t[s]||(t[s]=[]),t[s].push(e)}),Object.entries(t).map(([e,t])=>{let s=t.map(e=>e["產權總價"]||e["交易總價(萬)"]||e.totalPrice||0).filter(e=>e>0).sort((e,t)=>e-t),a=t.map(e=>e["房屋單價"]||e["房屋單價(萬)"]||e.unitPrice||0).filter(e=>e>0),i=0;if(s.length>0){let e=Math.floor(s.length/2);i=s.length%2!=0?s[e]:(s[e-1]+s[e])/2}return{projectName:e,count:t.length,priceRange:{median:i},unitPriceRange:{min:a.length?Math.min(...a):0,max:a.length?Math.max(...a):0}}}).sort((e,t)=>t.unitPriceRange.max-e.unitPriceRange.max)},[e.data,c.transactionDetails]);if(0===t.length)return(0,i.jsx)("div",{className:"p-4 text-zinc-500 text-xs text-center",children:"無數據"});return(0,i.jsx)("div",{className:"h-full overflow-auto custom-scrollbar p-1",children:(0,i.jsxs)("table",{className:"w-full text-xs border-collapse",children:[(0,i.jsx)("thead",{className:"bg-zinc-800 text-zinc-300 sticky top-0",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"p-2 text-left",children:"建案名稱"}),(0,i.jsx)("th",{className:"p-2 text-center",children:"單價範圍(萬/坪)"}),(0,i.jsx)("th",{className:"p-2 text-center",children:"總價中位數(萬)"}),(0,i.jsx)("th",{className:"p-2 text-center",children:"交易筆數"})]})}),(0,i.jsx)("tbody",{className:"divide-y divide-white/5",children:t.map((e,t)=>(0,i.jsxs)("tr",{className:"hover:bg-zinc-800/30",children:[(0,i.jsx)("td",{className:"p-2 text-white font-medium",children:e.projectName}),(0,i.jsxs)("td",{className:"p-2 text-center text-cyan-400",children:[e.unitPriceRange?.min?.toFixed(1)," ~ ",e.unitPriceRange?.max?.toFixed(1)]}),(0,i.jsx)("td",{className:"p-2 text-center text-violet-400",children:Math.round(e.priceRange?.median||0).toLocaleString()}),(0,i.jsx)("td",{className:"p-2 text-center text-zinc-300",children:e.count})]},t))})]})})}case"heatmap":case"heatmap-grid":{let t=e.data?.projectData||(c.priceGridAnalysis?.byProject?c.priceGridAnalysis.byProject[Object.keys(c.priceGridAnalysis.byProject)[0]]:null),s=e.data?.floorPremium||.3;return(0,i.jsx)("div",{className:"h-full overflow-auto custom-scrollbar p-1",children:t?(0,i.jsx)(R.t,{data:t,floorPremium:s,showGrid:!0,showSummary:!1,showComparison:!1}):(0,i.jsx)("div",{className:"text-zinc-500 text-sm p-4 text-center",children:"無熱力圖數據 (請先載入建案資料)"})})}case"heatmap-stats":{let t=e.data?.summary?{summary:e.data.summary}:c.priceGridAnalysis?.byProject?c.priceGridAnalysis.byProject[Object.keys(c.priceGridAnalysis.byProject)[0]]:null;return(0,i.jsx)("div",{className:"h-full overflow-auto custom-scrollbar p-1",children:t?.summary?(0,i.jsx)(R.t,{data:t,showGrid:!1,showSummary:!0,showComparison:!1}):(0,i.jsx)("div",{className:"text-zinc-500 text-sm p-4 text-center",children:"無統計摘要數據"})})}case"heatmap-comparison":{let t=e.data?.horizontalComparison?{horizontalComparison:e.data.horizontalComparison}:c.priceGridAnalysis?.byProject?c.priceGridAnalysis.byProject[Object.keys(c.priceGridAnalysis.byProject)[0]]:null;return(0,i.jsx)("div",{className:"h-full overflow-auto custom-scrollbar p-1",children:t?.horizontalComparison?(0,i.jsx)(R.t,{data:t,showGrid:!1,showSummary:!1,showComparison:!0}):(0,i.jsx)("div",{className:"text-zinc-500 text-sm p-4 text-center",children:"無溢價貢獻數據"})})}case"unit-price-stats":{let t=e.data||{residentialStats:c.unitPriceAnalysis?.residentialStats,officeStats:c.unitPriceAnalysis?.officeStats,storeStats:c.unitPriceAnalysis?.storeStats,averageType:"weighted"};return(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 h-full p-2 overflow-y-auto custom-scrollbar",children:[(0,i.jsx)(I.E,{title:"住宅統計",stats:t.residentialStats,noDataMessage:"無數據",className:"bg-zinc-900/40 border-violet-500/20 scale-[0.9] origin-top",averageType:t.averageType||"weighted"}),(0,i.jsx)(I.E,{title:"辦公統計",stats:t.officeStats,noDataMessage:"無數據",className:"bg-zinc-900/40 border-cyan-500/20 scale-[0.9] origin-top",averageType:t.averageType||"weighted"}),(0,i.jsx)(I.E,{title:"店舖統計",stats:t.storeStats,noDataMessage:"無數據",className:"bg-zinc-900/40 border-amber-500/20 lg:col-span-2 scale-[0.9] origin-top",averageType:t.averageType||"weighted"})]})}case"ranking-metrics":{let t=c.rankingAnalysis?.projectRanking||c.projectRanking||[],{coreMetrics:s,derivedMetrics:a}=e.data||{coreMetrics:c.rankingAnalysis?.coreMetrics||c.coreMetrics,derivedMetrics:{min:Math.min(...t.map(e=>e.minPrice).filter(e=>e>0)||[0]),max:Math.max(...t.map(e=>e.maxPrice)||[0]),median:t.length?t.reduce((e,t)=>e+(t.medianPrice||0),0)/t.length:0,parking:t.length?t.reduce((e,t)=>e+(t.avgParkingPrice||0),0)/t.length:0}};if(!s)return(0,i.jsx)("div",{className:"p-4 text-zinc-500 text-xs text-center flex items-center justify-center h-full",children:"無指標數據"});let r=[{title:"市場去化總銷售金額",value:s.totalSaleAmount?.toLocaleString(),unit:"萬"},{title:"總銷去化房屋坪數",value:s.totalHouseArea?.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"坪"},{title:"總平均單價",value:s.overallAveragePrice?.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"萬/坪"},{title:"總交易筆數",value:s.transactionCount?.toLocaleString(),unit:"筆"},{title:"最低成交單價",value:a.min?.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"萬/坪"},{title:"最高成交單價",value:a.max?.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"萬/坪"},{title:"平均中位數單價",value:a.median?.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"萬/坪"},{title:"平均車位價格",value:a.parking?.toLocaleString(void 0,{maximumFractionDigits:0}),unit:"萬"}];return(0,i.jsx)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 h-full p-1 overflow-y-auto custom-scrollbar",children:r.map((e,t)=>(0,i.jsxs)("div",{className:"bg-zinc-800/40 rounded border border-white/5 p-2 flex flex-col items-center justify-center text-center",children:[(0,i.jsx)("div",{className:"text-zinc-500 text-[10px] mb-1 truncate w-full",children:e.title}),(0,i.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,i.jsx)("span",{className:"text-sm font-bold text-white",children:e.value}),(0,i.jsx)("span",{className:"text-[8px] text-zinc-600",children:e.unit})]})]},t))})}case"ranking-chart":let t=e.data||c.rankingAnalysis?.projectRanking||c.projectRanking||[];return(0,i.jsx)(C.l,{data:t.slice(0,10),sortKey:"saleAmountSum",limit:10,chartType:"bar",height:"100%"});case"price-band-chart":let s=c.priceBandAnalysis?.details||[];return(0,i.jsx)(S.B,{data:e.data||s});case"price-band-table":let a=void 0!==e.data?e.data:c.priceBandAnalysis?.details||[];return(0,i.jsx)("div",{className:"h-full overflow-auto custom-scrollbar",children:(0,i.jsxs)("table",{className:"w-full text-[10px] text-left",children:[(0,i.jsx)("thead",{className:"bg-zinc-900 sticky top-0 text-zinc-500",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"p-1",children:"房型"}),(0,i.jsx)("th",{className:"p-1",children:"衛浴人"}),(0,i.jsx)("th",{className:"p-1 text-right",children:"平均總價"}),(0,i.jsx)("th",{className:"p-1 text-right",children:"中位數"}),(0,i.jsx)("th",{className:"p-1 text-right",children:"筆數"})]})}),(0,i.jsx)("tbody",{className:"divide-y divide-white/5",children:a.map((e,t)=>(0,i.jsxs)("tr",{className:"text-zinc-300",children:[(0,i.jsx)("td",{className:"p-1",children:e.roomType}),(0,i.jsx)("td",{className:"p-1 text-zinc-500",children:e.bathrooms??"-"}),(0,i.jsx)("td",{className:"p-1 text-right text-zinc-300",children:Math.round(e.avgPrice||0).toLocaleString()}),(0,i.jsx)("td",{className:"p-1 text-right text-violet-400",children:Math.round(e.medianPrice||0).toLocaleString()}),(0,i.jsx)("td",{className:"p-1 text-right text-zinc-500",children:e.count})]},t))})]})});case"price-band-location-table":let l=e.data;if(!l)return(0,i.jsx)("div",{className:"flex items-center justify-center h-full text-zinc-500 text-sm",children:"無區域數據"});let n=l.locations&&l.rows,o=n?l.locations:Object.keys(l[0]||{}).filter(e=>"房型"!==e&&"總計"!==e),d=n?l.rows:l;if(!d||0===d.length)return(0,i.jsx)("div",{className:"flex items-center justify-center h-full text-zinc-500 text-sm",children:"無區域數據"});return(0,i.jsx)("div",{className:"h-full overflow-auto custom-scrollbar",children:(0,i.jsxs)("table",{className:"w-full text-[10px] text-left border-collapse",children:[(0,i.jsx)("thead",{className:"bg-zinc-900 sticky top-0 text-zinc-500",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"p-1 sticky left-0 bg-zinc-900 z-10 border-r border-white/5",children:"房型"}),o.map(e=>(0,i.jsx)("th",{className:"p-1 text-center min-w-[40px]",children:e},e)),(0,i.jsx)("th",{className:"p-1 text-center font-bold text-white border-l border-white/5",children:"總計"})]})}),(0,i.jsx)("tbody",{className:"divide-y divide-white/5",children:d.map((e,t)=>(0,i.jsxs)("tr",{className:"text-zinc-300 hover:bg-zinc-800/30",children:[(0,i.jsx)("td",{className:"p-1 sticky left-0 bg-zinc-950/90 border-r border-white/5",children:e.roomType||e["房型"]}),o.map((t,s)=>{let a=n?e.cells[s]:e[t],r="number"==typeof a&&a>0?Math.min(a/10,1):0;return(0,i.jsx)("td",{className:"p-1 text-center text-zinc-400",style:a>0?{backgroundColor:`rgba(6, 182, 212, ${.3*r})`}:{},children:a>0?a:"-"},t)}),(0,i.jsx)("td",{className:"p-1 text-center text-cyan-400 border-l border-white/5 font-bold",children:e.rowTotal||e["總計"]})]},t))})]})});case"price-band-location-chart":let h=e.data;if(!h)return(0,i.jsx)("div",{className:"flex items-center justify-center h-full text-zinc-500 text-sm",children:"無數據"});let x=h.locations&&h.rows,m=x?h.locations:Object.keys(h[0]||{}).filter(e=>"房型"!==e&&"總計"!==e),u=x?h.rows.map(e=>e.roomType):h.map(e=>e["房型"]);if(0===u.length)return(0,i.jsx)("div",{className:"flex items-center justify-center h-full text-zinc-500 text-sm",children:"無數據"});let g=m.map((e,t)=>({name:e,data:x?h.rows.map(e=>e.cells[t]||0):h.map(t=>t[e]||0)}));return(0,i.jsx)(Q,{options:{chart:{type:"bar",stacked:!0,background:"transparent",toolbar:{show:!1}},plotOptions:{bar:{horizontal:!1,borderRadius:2}},dataLabels:{enabled:!1},xaxis:{categories:u,labels:{style:{colors:"#71717a"}}},yaxis:{labels:{style:{colors:"#71717a"}}},grid:{borderColor:"#27272a"},legend:{position:"bottom",labels:{colors:"#a1a1aa"}},theme:{mode:"dark"},colors:["#06b6d4","#8b5cf6","#f59e0b","#10b981","#ef4444","#ec4899"]},series:g,type:"bar",height:"100%"});case"unit-price-bubble":let b=c.transactionDetails||[];return(0,i.jsx)(P.$,{data:b,minPrice:30,maxPrice:150,interval:5,sizeMetric:"count",onMinPriceChange:()=>{},onMaxPriceChange:()=>{},onIntervalChange:()=>{},onSizeMetricChange:()=>{}});case"sales-velocity-chart":let j=c.salesVelocityAnalysis;if(!j?.weekly)return(0,i.jsx)("div",{className:"flex items-center justify-center h-full text-zinc-500 text-sm",children:"無銷售速度數據"});return(0,i.jsx)(M.M,{data:j.weekly,selectedRooms:["1房","2房","3房"],metric:"count"});case"ranking-table":let v=e.data||c.rankingAnalysis?.projectRanking||c.projectRanking||[];return(0,i.jsx)("div",{className:"h-full overflow-auto custom-scrollbar",children:(0,i.jsxs)("table",{className:"w-full text-[10px] text-left",children:[(0,i.jsx)("thead",{className:"bg-zinc-900 sticky top-0 text-zinc-500",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"p-1",children:"建案"}),(0,i.jsx)("th",{className:"p-1 text-right",children:"交易總價"}),(0,i.jsx)("th",{className:"p-1 text-right",children:"單價"}),(0,i.jsx)("th",{className:"p-1 text-right",children:"筆數"})]})}),(0,i.jsx)("tbody",{className:"divide-y divide-white/5",children:v.slice(0,50).map((e,t)=>(0,i.jsxs)("tr",{className:"text-zinc-300",children:[(0,i.jsx)("td",{className:"p-1 truncate max-w-[80px]",title:e.projectName,children:e.projectName}),(0,i.jsxs)("td",{className:"p-1 text-right font-mono text-zinc-400",children:[(e.saleAmountSum/1e4).toFixed(0),"億"]}),(0,i.jsx)("td",{className:"p-1 text-right font-mono text-cyan-400",children:e.averagePrice?.toFixed(1)}),(0,i.jsx)("td",{className:"p-1 text-right font-mono text-zinc-500",children:e.transactionCount})]},t))})]})});case"sales-velocity-table":let N=e.data||[];if(!N||0===N.length)return(0,i.jsx)("div",{className:"flex items-center justify-center h-full text-zinc-500 text-sm",children:"無數據"});return(0,i.jsx)("div",{className:"h-full overflow-auto custom-scrollbar",children:(0,i.jsxs)("table",{className:"w-full text-[10px] text-left",children:[(0,i.jsx)("thead",{className:"bg-zinc-900 sticky top-0 text-zinc-500",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"p-1",children:"區間"}),(0,i.jsx)("th",{className:"p-1 text-right",children:"筆數"}),(0,i.jsx)("th",{className:"p-1 text-right",children:"總銷(億)"}),(0,i.jsx)("th",{className:"p-1 text-right",children:"坪數"})]})}),(0,i.jsx)("tbody",{className:"divide-y divide-white/5",children:N.map((e,t)=>(0,i.jsxs)("tr",{className:"text-zinc-300",children:[(0,i.jsx)("td",{className:"p-1 text-zinc-400",children:e.period}),(0,i.jsx)("td",{className:"p-1 text-right font-mono text-white",children:e.total?.count||0}),(0,i.jsx)("td",{className:"p-1 text-right font-mono text-cyan-400",children:((e.total?.priceSum||0)/1e4).toFixed(1)}),(0,i.jsx)("td",{className:"p-1 text-right font-mono text-zinc-500",children:Math.round(e.total?.areaSum||0)})]},t))})]})});case"type-comparison-table":let w=e.data||c.unitPriceAnalysis?.typeComparison||[];return(0,i.jsx)("div",{className:"h-full overflow-auto custom-scrollbar",children:(0,i.jsxs)("table",{className:"w-full text-[10px] text-left",children:[(0,i.jsx)("thead",{className:"bg-zinc-900 sticky top-0 text-zinc-500",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"p-1",children:"建案"}),(0,i.jsx)("th",{className:"p-1 text-right",children:"住宅"}),(0,i.jsx)("th",{className:"p-1 text-right",children:"店面"}),(0,i.jsx)("th",{className:"p-1 text-right",children:"辦公"})]})}),(0,i.jsx)("tbody",{className:"divide-y divide-white/5",children:w.map((e,t)=>(0,i.jsxs)("tr",{className:"text-zinc-300",children:[(0,i.jsx)("td",{className:"p-1 truncate max-w-[80px]",children:e.projectName}),(0,i.jsx)("td",{className:"p-1 text-right font-mono text-cyan-400",children:e.residentialAvg?e.residentialAvg.toFixed(1):"-"}),(0,i.jsx)("td",{className:"p-1 text-right font-mono text-amber-400",children:e.storeAvg?e.storeAvg.toFixed(1):"-"}),(0,i.jsx)("td",{className:"p-1 text-right font-mono text-violet-400",children:e.officeAvg?e.officeAvg.toFixed(1):"-"})]},t))})]})});case"parking-pie":let y=c.parkingAnalysis?.parkingRatio,A=[{name:"有車位",value:y?.withParking?.count||0},{name:"無車位",value:y?.withoutParking?.count||0}],$={chart:{type:"donut",background:"transparent"},labels:A.map(e=>e.name),colors:["#8b5cf6","#3f3f46"],stroke:{show:!1},dataLabels:{enabled:!1},legend:{show:!0,position:"bottom",labels:{colors:"#a1a1aa"}},theme:{mode:"dark"}};return(0,i.jsx)(Q,{options:$,series:A.map(e=>e.value),type:"donut",height:"100%"});case"parking-price":let L=c.parkingAnalysis?.avgPriceByType||[];return(0,i.jsx)("div",{className:"h-full overflow-auto custom-scrollbar",children:(0,i.jsxs)("table",{className:"w-full text-[10px] text-left",children:[(0,i.jsx)("thead",{className:"bg-zinc-900 sticky top-0 text-zinc-500",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"p-1",children:"類型"}),(0,i.jsx)("th",{className:"p-1 text-right",children:"均價"}),(0,i.jsx)("th",{className:"p-1 text-right",children:"總數"})]})}),(0,i.jsx)("tbody",{className:"divide-y divide-white/5",children:L.map(e=>(0,i.jsxs)("tr",{className:"text-zinc-300",children:[(0,i.jsx)("td",{className:"p-1",children:e.type}),(0,i.jsx)("td",{className:"p-1 text-right text-cyan-400",children:Math.round(e.avgPrice).toLocaleString()}),(0,i.jsx)("td",{className:"p-1 text-right text-zinc-500",children:e.count})]},e.type))})]})});case"heatmap":return(0,i.jsxs)("div",{className:"h-full flex flex-col items-center justify-center p-4 text-center",children:[(0,i.jsx)("div",{className:"w-16 h-16 rounded-lg bg-violet-500/10 flex items-center justify-center mb-2",children:(0,i.jsx)(z.A,{className:"h-8 w-8 text-violet-500"})}),(0,i.jsx)("p",{className:"text-xs text-zinc-400",children:"由於熱力圖需要專案選擇，此元件將在匯出時呈現專案銷控狀態。"}),(0,i.jsx)("div",{className:"mt-2 grid grid-cols-4 gap-1 w-full max-w-[200px]",children:Array.from({length:12}).map((e,t)=>(0,i.jsx)("div",{className:(0,f.cn)("h-3 rounded-sm",t%3==0?"bg-red-500/50":"bg-zinc-700/50")},t))})]});case"data-list":let E=c.transactionDetails||[];return(0,i.jsx)("div",{className:"h-full overflow-auto custom-scrollbar",children:(0,i.jsxs)("table",{className:"w-full text-[9px] text-left",children:[(0,i.jsx)("thead",{className:"bg-zinc-900 sticky top-0 text-zinc-500",children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"p-1",children:"建案名稱"}),(0,i.jsx)("th",{className:"p-1",children:"日期"}),(0,i.jsx)("th",{className:"p-1 text-right",children:"單價"})]})}),(0,i.jsx)("tbody",{className:"divide-y divide-white/5",children:E.slice(0,50).map((e,t)=>(0,i.jsxs)("tr",{className:"text-zinc-300",children:[(0,i.jsx)("td",{className:"p-1 truncate max-w-[80px]",children:e["建案名稱"]}),(0,i.jsx)("td",{className:"p-1 text-zinc-500",children:e["交易日"]}),(0,i.jsx)("td",{className:"p-1 text-right text-violet-400",children:e["房屋單價(萬)"]||"-"})]},t))})]})});case"parking-scatter":return(0,i.jsxs)("div",{className:"h-full flex flex-col items-center justify-center p-4 text-center",children:[(0,i.jsx)("div",{className:"w-12 h-12 rounded-full bg-cyan-500/10 flex items-center justify-center mb-2",children:(0,i.jsx)(k.A,{className:"h-6 w-6 text-cyan-500"})}),(0,i.jsx)("p",{className:"text-[10px] text-zinc-400",children:"車位坪數散佈分析"}),(0,i.jsx)("div",{className:"mt-2 w-full h-24 bg-zinc-900/50 rounded flex items-end justify-around p-2 gap-1",children:Array.from({length:15}).map((e,t)=>(0,i.jsx)("div",{className:"w-1 bg-cyan-500/40 rounded-full",style:{height:`${20+60*Math.random()}%`}},t))})]});case"parking-floor":return(0,i.jsxs)("div",{className:"h-full flex flex-col items-center justify-center p-4 text-center border border-dashed border-white/5 rounded",children:[(0,i.jsx)("div",{className:"w-12 h-12 rounded bg-violet-500/10 flex items-center justify-center mb-2",children:(0,i.jsx)(p.A,{className:"h-6 w-6 text-violet-500"})}),(0,i.jsx)("p",{className:"text-[10px] text-zinc-400",children:"樓層價差分析數據"}),(0,i.jsx)("div",{className:"mt-2 space-y-1 w-full",children:["B1","B2","B3"].map(e=>(0,i.jsxs)("div",{className:"flex justify-between text-[8px] bg-zinc-900/50 p-1 rounded",children:[(0,i.jsxs)("span",{className:"text-zinc-500",children:[e,"層"]}),(0,i.jsx)("span",{className:"text-cyan-400",children:"漲幅 +2.4%"})]},e))})]});default:return(0,i.jsx)("div",{className:"flex items-center justify-center h-full text-zinc-500 text-sm",children:"未知圖表類型"})}})()}),!t&&!w&&(0,i.jsx)("div",{className:"absolute inset-0 z-10 cursor-pointer",onClick:e=>{e.stopPropagation(),s(e)}})]})]})}var T=s(89123),Y=s(19965),F=s(44071),X=s(18837);let O=[{id:"ranking",title:"核心指標與排名",items:[{type:"ranking-metrics",label:"核心數據指標",icon:(0,i.jsx)(k.A,{className:"h-4 w-4"}),description:"8 項關鍵成交指標卡片"},{type:"ranking-chart",label:"建案排名圖表",icon:(0,i.jsx)(T.A,{className:"h-4 w-4"}),description:"總銷與各項指標排名"},{type:"ranking-table",label:"建案排名列表",icon:(0,i.jsx)(T.A,{className:"h-4 w-4"}),description:"詳細數據列表"}]},{id:"price-band",title:"總價帶分析",items:[{type:"price-band-chart",label:"總價帶分佈",icon:(0,i.jsx)(z.A,{className:"h-4 w-4"}),description:"價格區間箱型圖"},{type:"price-band-table",label:"總價帶詳情",icon:(0,i.jsx)(z.A,{className:"h-4 w-4"}),description:"各房型衛浴統計"},{type:"price-band-location-chart",label:"區域成交佔比",icon:(0,i.jsx)(Y.A,{className:"h-4 w-4"}),description:"各區房型分佈"},{type:"price-band-location-table",label:"區域房型分佈",icon:(0,i.jsx)(z.A,{className:"h-4 w-4"}),description:"區域交叉分析表"}]},{id:"unit-price",title:"單價分析",items:[{type:"unit-price-stats",label:"各用途單價統計",icon:(0,i.jsx)(k.A,{className:"h-4 w-4"}),description:"住宅/辦公/店面指標卡"},{type:"unit-price-bubble",label:"單價泡泡圖",icon:(0,i.jsx)(k.A,{className:"h-4 w-4"}),description:"成交單價熱度分佈"},{type:"type-comparison-table",label:"產品類型比較",icon:(0,i.jsx)(z.A,{className:"h-4 w-4"}),description:"住宅/店面/辦公均價"}]},{id:"heatmap",title:"調價熱力圖",items:[{type:"heatmap-grid",label:"銷控熱力圖",icon:(0,i.jsx)(z.A,{className:"h-4 w-4"}),description:"樓層戶別價差分析"},{type:"heatmap-stats",label:"調價幅度摘要",icon:(0,i.jsx)(z.A,{className:"h-4 w-4"}),description:"總溢價與平均調價"},{type:"heatmap-comparison",label:"戶型溢價貢獻",icon:(0,i.jsx)(z.A,{className:"h-4 w-4"}),description:"各戶型水平價差比較"}]},{id:"velocity",title:"銷售速度與房型",items:[{type:"sales-velocity-chart",label:"銷售速度趨勢",icon:(0,i.jsx)(F.A,{className:"h-4 w-4"}),description:"去化速度與量能"},{type:"sales-velocity-table",label:"銷售速度明細",icon:(0,i.jsx)(z.A,{className:"h-4 w-4"}),description:"詳細銷售數據"},{type:"sales-heatmap",label:"房型面積熱力圖",icon:(0,i.jsx)(z.A,{className:"h-4 w-4"}),description:"坪數去化分佈"},{type:"sales-heatmap-detail",label:"熱力詳細交易表",icon:(0,i.jsx)(X.A,{className:"h-4 w-4"}),description:"熱力圖點擊詳細分析"}]},{id:"parking",title:"車位分析",items:[{type:"parking-pie",label:"房車配比",icon:(0,i.jsx)(Y.A,{className:"h-4 w-4"}),description:"有/無車位比例"},{type:"parking-price",label:"車位均價",icon:(0,i.jsx)(T.A,{className:"h-4 w-4"}),description:"各類車位行情"},{type:"parking-scatter",label:"車位坪數散佈",icon:(0,i.jsx)(k.A,{className:"h-4 w-4"}),description:"規模與價值分析"},{type:"parking-floor",label:"樓層價差",icon:(0,i.jsx)(F.A,{className:"h-4 w-4"}),description:"地下室樓層價差"}]},{id:"others",title:"其他",items:[{type:"data-list",label:"交易明細列表",icon:(0,i.jsx)(T.A,{className:"h-4 w-4"}),description:"原始交易數據"}]}];function G({onAddItem:e,hasData:t}){return(0,i.jsxs)("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[(0,i.jsx)("div",{className:"p-3 space-y-6",children:O.map(s=>(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("h3",{className:"text-xs font-bold text-zinc-500 uppercase tracking-wider pl-1",children:s.title}),(0,i.jsx)("div",{className:"grid grid-cols-2 gap-2",children:s.items.map(s=>(0,i.jsxs)("button",{onClick:()=>e(s.type),disabled:!t,className:(0,f.cn)("w-full p-2 rounded-lg border text-left transition-all group relative overflow-hidden flex flex-col items-center text-center gap-1.5 h-full",t?"bg-zinc-800/40 border-white/5 hover:bg-zinc-700/60 hover:border-violet-500/30 cursor-pointer":"bg-zinc-900/30 border-white/5 opacity-50 cursor-not-allowed"),children:[(0,i.jsx)("div",{className:(0,f.cn)("p-2 rounded-md transition-colors",t?"bg-zinc-700/50 group-hover:bg-violet-500/20 text-zinc-400 group-hover:text-violet-300":"bg-zinc-800 text-zinc-600"),children:s.icon}),(0,i.jsx)("div",{className:"w-full min-w-0",children:(0,i.jsx)("div",{className:"text-[11px] font-medium text-zinc-200 group-hover:text-white truncate w-full",children:s.label})}),t&&(0,i.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent via-transparent to-white/5 opacity-0 group-hover:opacity-100 transition-opacity"})]},s.type))})]},s.id))}),!t&&(0,i.jsx)("div",{className:"text-center py-8 text-xs text-zinc-500 px-4",children:"請先從左側載入儀表板數據，才能使用組建功能。"})]})}var B=s(87256),_=s(39768),K=s(59883),W=s(33210),H=s(44923);function Z({id:e,name:t,index:s,isActive:a,canDelete:r,onClick:l,onDelete:n}){let{attributes:c,listeners:o,setNodeRef:d,transform:h,transition:x,isDragging:m}=(0,B.gl)({id:e}),{isOver:p,setNodeRef:u}=(0,H.zM)({id:`page-tab-drop-${s}`,data:{type:"page-tab",pageIndex:s}}),g=(0,N.Q)(e=>e.hoveredPageIndex)===s,b={transform:_.Ks.Transform.toString(h),transition:x};return(0,i.jsxs)("div",{ref:e=>{d(e),u(e)},style:b,...c,...o,className:(0,f.cn)("px-3 h-8 rounded-lg text-xs font-semibold flex items-center gap-2 transition-all whitespace-nowrap group cursor-grab active:cursor-grabbing select-none border border-transparent shadow-sm",a?"bg-violet-600 text-white border-violet-400/30 shadow-violet-500/20":"bg-zinc-900/50 text-zinc-400 border-white/5 hover:bg-zinc-800 hover:text-zinc-100 hover:border-white/10",m&&"opacity-50 shadow-2xl z-50 scale-105",(p||g)&&!a&&"ring-2 ring-violet-500 bg-violet-600 text-white shadow-lg scale-110 z-50 origin-bottom"),onClick:e=>{m||l()},"data-page-drop-target":"true","data-page-index":s,children:[(0,i.jsx)(K.A,{className:"h-3 w-3 text-zinc-600 group-hover:text-zinc-400 transition-colors flex-shrink-0"}),(0,i.jsx)("span",{className:"truncate max-w-[100px]",children:t}),r&&(0,i.jsx)("button",{onPointerDown:e=>{e.stopPropagation()},onClick:e=>{e.stopPropagation(),n()},className:(0,f.cn)("ml-auto p-1 rounded-md hover:bg-red-500/30 text-zinc-500 hover:text-red-400 transition-all focus:outline-none",a?"opacity-70":"opacity-0 group-hover:opacity-100"),children:(0,i.jsx)(W.A,{className:"h-3 w-3"})})]})}function U({pageIndex:e,isActive:t,children:s,onClick:a,onFocus:r}){let{setNodeRef:l,isOver:n}=(0,H.zM)({id:`page-drop-${e}`,data:{pageIndex:e}});return(0,i.jsxs)("div",{ref:l,className:(0,f.cn)("relative group outline-none transition-transform duration-200",n&&"scale-[1.02]",t?"z-10":"z-0"),"data-page-drop-zone":"true","data-page-index":e,tabIndex:0,onFocus:r,onClick:a,children:[n&&(0,i.jsx)("div",{className:"absolute inset-0 bg-violet-500/10 border-2 border-violet-500/50 rounded-lg z-50 pointer-events-none animate-pulse"}),s]})}var q=s(82482),V=s(9199);function J(){let e=(0,N.Q)(e=>e.zoomLevel),t=(0,N.Q)(e=>e.setZoomLevel),s=(0,N.Q)(e=>e.resetZoom);return(0,i.jsxs)("div",{className:"flex items-center gap-1 bg-zinc-900/90 backdrop-blur-md border border-white/10 rounded-lg p-1 shadow-xl",children:[(0,i.jsx)(m.$,{size:"icon",variant:"ghost",className:"h-7 w-7 text-zinc-400 hover:text-white hover:bg-white/10",onClick:()=>t(e-10),title:"縮小 (Cmd + 滾輪)",children:(0,i.jsx)(q.A,{className:"h-4 w-4"})}),(0,i.jsx)("div",{className:"px-2 min-w-[3.5rem] text-center",children:(0,i.jsxs)("span",{className:"text-xs font-mono text-zinc-300 font-medium",children:[e,"%"]})}),(0,i.jsx)(m.$,{size:"icon",variant:"ghost",className:"h-7 w-7 text-zinc-400 hover:text-white hover:bg-white/10",onClick:()=>t(e+10),title:"放大 (Cmd + 滾輪)",children:(0,i.jsx)(v.A,{className:"h-4 w-4"})}),(0,i.jsx)("div",{className:"w-px h-4 bg-white/10 mx-1"}),(0,i.jsx)(m.$,{size:"icon",variant:"ghost",className:"h-7 w-7 text-zinc-400 hover:text-white hover:bg-white/10",onClick:s,title:"重置縮放 (100%)",children:(0,i.jsx)(V.A,{className:"h-3.5 w-3.5"})})]})}var ee=s(51806),et=s(60529),es=s(17243),ea=s(484);function ei({isOpen:e,onClose:t,onExport:s,format:a}){let l=(0,N.Q)(e=>e.pages),n=(0,N.Q)(e=>e.currentPageIndex),[c,o]=(0,r.useState)("all"),[d,h]=(0,r.useState)({start:1,end:l.length});return(0,i.jsx)(ee.a,{isOpen:e,onClose:t,title:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)("div",{className:"p-2 rounded-lg bg-emerald-500/10 text-emerald-400",children:(0,i.jsx)(es.A,{className:"h-5 w-5"})}),(0,i.jsxs)("span",{className:"text-xl",children:["匯出 ",a.toUpperCase()," 圖片"]})]}),maxWidth:"max-w-md",children:(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,i.jsxs)("button",{onClick:()=>o("all"),className:`flex items-center gap-4 p-4 rounded-xl border transition-all text-left ${"all"===c?"bg-emerald-500/10 border-emerald-500/50 ring-1 ring-emerald-500/50":"bg-zinc-900/50 border-white/5 hover:border-white/10"}`,children:[(0,i.jsx)("div",{className:`p-2 rounded-lg ${"all"===c?"bg-emerald-500/20 text-emerald-400":"bg-zinc-800 text-zinc-400"}`,children:(0,i.jsx)(p.A,{className:"h-5 w-5"})}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"font-medium text-white",children:["全部頁面 (",l.length," 頁)"]}),(0,i.jsx)("div",{className:"text-xs text-zinc-500",children:"匯出所有報告頁面"})]})]}),(0,i.jsxs)("button",{onClick:()=>o("current"),className:`flex items-center gap-4 p-4 rounded-xl border transition-all text-left ${"current"===c?"bg-emerald-500/10 border-emerald-500/50 ring-1 ring-emerald-500/50":"bg-zinc-900/50 border-white/5 hover:border-white/10"}`,children:[(0,i.jsx)("div",{className:`p-2 rounded-lg ${"current"===c?"bg-emerald-500/20 text-emerald-400":"bg-zinc-800 text-zinc-400"}`,children:(0,i.jsx)(es.A,{className:"h-5 w-5"})}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"font-medium text-white",children:["僅限目前頁面 (第 ",n+1," 頁)"]}),(0,i.jsx)("div",{className:"text-xs text-zinc-500",children:"僅匯出當前正編輯的頁面"})]})]}),(0,i.jsxs)("button",{onClick:()=>o("range"),className:`flex items-center gap-4 p-4 rounded-xl border transition-all text-left ${"range"===c?"bg-emerald-500/10 border-emerald-500/50 ring-1 ring-emerald-500/50":"bg-zinc-900/50 border-white/5 hover:border-white/10"}`,children:[(0,i.jsx)("div",{className:`p-2 rounded-lg ${"range"===c?"bg-emerald-500/20 text-emerald-400":"bg-zinc-800 text-zinc-400"}`,children:(0,i.jsx)(ea.A,{className:"h-5 w-5"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium text-white",children:"指定範圍"}),(0,i.jsx)("div",{className:"text-xs text-zinc-500",children:"自定義要匯出的頁碼範圍"})]})]})]}),"range"===c&&(0,i.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-zinc-950/50 rounded-xl border border-white/5 animate-in fade-in slide-in-from-top-2 duration-200",children:[(0,i.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,i.jsx)("label",{className:"text-[10px] uppercase tracking-wider text-zinc-500 font-bold ml-1",children:"起始頁碼"}),(0,i.jsx)(et.p,{type:"number",min:1,max:l.length,value:d.start,onChange:e=>h(t=>({...t,start:parseInt(e.target.value)||1})),className:"bg-zinc-900 border-white/5 h-10"})]}),(0,i.jsx)("div",{className:"text-zinc-700 mt-5",children:"至"}),(0,i.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,i.jsx)("label",{className:"text-[10px] uppercase tracking-wider text-zinc-500 font-bold ml-1",children:"結束頁碼"}),(0,i.jsx)(et.p,{type:"number",min:1,max:l.length,value:d.end,onChange:e=>h(t=>({...t,end:parseInt(e.target.value)||1})),className:"bg-zinc-900 border-white/5 h-10"})]})]}),(0,i.jsxs)("div",{className:"pt-2 flex gap-3",children:[(0,i.jsx)(m.$,{variant:"outline",onClick:t,className:"flex-1 bg-zinc-900 border-white/5",children:"取消"}),(0,i.jsx)(m.$,{onClick:()=>{let e=[];if("all"===c)e=l.map((e,t)=>t);else if("current"===c)e=[n];else if("range"===c){let t=Math.max(0,d.start-1),s=Math.min(l.length-1,d.end-1);for(let a=t;a<=s;a++)e.push(a)}s(e)},className:"flex-1 bg-emerald-600 hover:bg-emerald-500 text-white border-none shadow-lg shadow-emerald-900/20",children:"開始匯出"})]})]})})}var er=s(50858),el=s(96524),en=s(55161),ec=s(24371),eo=s(70872);function ed({selectedIds:e,onScaleModeChange:t,onDelete:s}){let a=(0,N.Q)(e=>e.pages),r=(0,N.Q)(e=>e.currentPageIndex);if(0===e.length)return null;let l=a[r]?.items.find(t=>t.id===e[0]),n=l?.scaleMode||"select";return(0,i.jsx)("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 z-50",children:(0,i.jsxs)("div",{className:"bg-zinc-900/90 backdrop-blur-xl border border-white/10 rounded-full p-2 shadow-2xl flex items-center gap-2 ring-1 ring-black/50",children:[(0,i.jsxs)("div",{className:"text-[10px] text-zinc-500 font-medium px-3 border-r border-white/10 select-none",children:[e.length," 選取"]}),(0,i.jsx)(eo.Bc,{delayDuration:0,children:(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsxs)(eo.m_,{children:[(0,i.jsx)(eo.k$,{asChild:!0,children:(0,i.jsxs)(m.$,{size:"sm",variant:"ghost",onClick:()=>t("select"),className:(0,f.cn)("h-8 px-3 rounded-full transition-all duration-200","select"===n?"bg-white/20 text-white hover:bg-white/30 ring-1 ring-white/50":"text-zinc-400 hover:text-white hover:bg-white/5"),children:[(0,i.jsx)(er.A,{className:"h-3.5 w-3.5 mr-1.5"}),(0,i.jsx)("span",{className:"text-xs font-medium",children:"選取"})]})}),(0,i.jsx)(eo.ZI,{side:"top",className:"text-xs bg-zinc-900 border-white/10",children:"僅選取不進行編輯"})]}),(0,i.jsx)("div",{className:"w-px h-4 bg-white/10 mx-1"}),(0,i.jsxs)(eo.m_,{children:[(0,i.jsx)(eo.k$,{asChild:!0,children:(0,i.jsxs)(m.$,{size:"sm",variant:"ghost",onClick:()=>t("crop"),className:(0,f.cn)("h-8 px-3 rounded-full transition-all duration-200","crop"===n?"bg-violet-600/20 text-violet-300 hover:bg-violet-600/30 ring-1 ring-violet-500/50":"text-zinc-400 hover:text-white hover:bg-white/5"),children:[(0,i.jsx)(el.A,{className:"h-3.5 w-3.5 mr-1.5"}),(0,i.jsx)("span",{className:"text-xs font-medium",children:"剪裁"})]})}),(0,i.jsx)(eo.ZI,{side:"top",className:"text-xs bg-zinc-900 border-white/10",children:"內容溢出時自動裁剪"})]}),(0,i.jsxs)(eo.m_,{children:[(0,i.jsx)(eo.k$,{asChild:!0,children:(0,i.jsxs)(m.$,{size:"sm",variant:"ghost",onClick:()=>t("pan"),className:(0,f.cn)("h-8 px-3 rounded-full transition-all duration-200","pan"===n?"bg-cyan-600/20 text-cyan-300 hover:bg-cyan-600/30 ring-1 ring-cyan-500/50":"text-zinc-400 hover:text-white hover:bg-white/5"),children:[(0,i.jsx)(en.A,{className:"h-3.5 w-3.5 mr-1.5"}),(0,i.jsx)("span",{className:"text-xs font-medium",children:"平移"})]})}),(0,i.jsx)(eo.ZI,{side:"top",className:"text-xs bg-zinc-900 border-white/10",children:"拖動內容以調整位置"})]}),(0,i.jsxs)(eo.m_,{children:[(0,i.jsx)(eo.k$,{asChild:!0,children:(0,i.jsxs)(m.$,{size:"sm",variant:"ghost",onClick:()=>t("fit"),className:(0,f.cn)("h-8 px-3 rounded-full transition-all duration-200","fit"===n?"bg-emerald-600/20 text-emerald-300 hover:bg-emerald-600/30 ring-1 ring-emerald-500/50":"text-zinc-400 hover:text-white hover:bg-white/5"),children:[(0,i.jsx)(ec.A,{className:"h-3.5 w-3.5 mr-1.5"}),(0,i.jsx)("span",{className:"text-xs font-medium",children:"縮放"})]})}),(0,i.jsx)(eo.ZI,{side:"top",className:"text-xs bg-zinc-900 border-white/10",children:"自動縮放以填滿容器"})]}),(0,i.jsx)("div",{className:"w-px h-4 bg-white/10 mx-1"}),(0,i.jsxs)(eo.m_,{children:[(0,i.jsx)(eo.k$,{asChild:!0,children:(0,i.jsx)(m.$,{size:"sm",variant:"ghost",onClick:s,className:"h-8 px-3 rounded-full text-zinc-400 hover:text-red-400 hover:bg-red-500/10 transition-all duration-200",children:(0,i.jsx)(g.A,{className:"h-3.5 w-3.5"})})}),(0,i.jsx)(eo.ZI,{side:"top",className:"text-xs bg-zinc-900 border-white/10 text-red-400",children:"刪除選中元件"})]})]})})]})})}let eh=(a=function(){let{loading:e,analysisData:t}=(0,o.g)(),a=(0,N.Q)(e=>e.pages),l=(0,N.Q)(e=>e.currentPageIndex),d=(0,N.Q)(e=>e.canvasRatio),h=(0,N.Q)(e=>e.viewMode),x=(0,N.Q)(e=>e.setViewMode),y=(0,N.Q)(e=>e.selectedIds),z=(0,N.Q)(e=>e.addItem),k=(0,N.Q)(e=>e.updateItem),A=(0,N.Q)(e=>e.removeItem),C=(0,N.Q)(e=>e.clearCanvas),S=(0,N.Q)(e=>e.setCanvasRatio),P=(0,N.Q)(e=>e.setSelectedIds),M=(0,N.Q)(e=>e.toggleSelection),$=(0,N.Q)(e=>e.addToSelection),Q=(0,N.Q)(e=>e.clearSelection),I=(0,N.Q)(e=>e.removeSelectedItems);(0,N.Q)(e=>e.moveSelectedItemsToPage);let R=(0,N.Q)(e=>e.addPage),D=(0,N.Q)(e=>e.deletePage),L=(0,N.Q)(e=>e.setCurrentPage),T=(0,N.Q)(e=>e.reorderPages),Y=(0,N.Q)(e=>e.moveItemToPage),F=(0,N.Q)(e=>e.batchUpdateItems),[X,O]=(0,r.useState)(null),_=(0,N.Q)(e=>e.isDragging),K=(0,N.Q)(e=>e.draggedItemCount),W=(0,N.Q)(e=>e.hoveredPageIndex),[q,V]=(0,r.useState)({x:0,y:0}),[ee,et]=(0,r.useState)(!0),[es,ea]=(0,r.useState)(!1),[er,el]=(0,r.useState)("png"),[en,ec]=(0,r.useState)(!1),[eo,eh]=(0,r.useState)({current:0,total:0});r.useEffect(()=>{let e=e=>{_&&V({x:e.clientX,y:e.clientY})},t=e=>{!(document.activeElement?.tagName==="INPUT"||document.activeElement?.tagName==="TEXTAREA"||document.activeElement?.isContentEditable)&&("Delete"===e.key||"Backspace"===e.key)&&y.length>0&&(e.preventDefault(),I())};return window.addEventListener("mousemove",e),window.addEventListener("keydown",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("keydown",t)}},[_,y,I]);let ex=(0,r.useCallback)(e=>{let t={};y.forEach(s=>{t[s]={scaleMode:e}}),F(t)},[y,F]),em=(0,H.FR)((0,H.MS)(H.AN,{activationConstraint:{distance:5}})),ep=a[l],eu=ep?.items||[],eg="16:9"===d?{width:960,height:540}:"A4"===d?{width:595,height:842}:"1:1"===d?{width:900,height:900}:"9:16"===d?{width:540,height:960}:{width:720,height:900},eb=(0,r.useCallback)(e=>{z(e)},[z]),ej=(0,r.useCallback)((e,t)=>{k(e,t)},[k]),ev=(0,r.useCallback)(e=>{A(e)},[A]),ef=(0,r.useCallback)(()=>{R()},[R]),eN=(0,r.useCallback)(e=>{!(a.length<=1)&&confirm("確定要刪除此頁面嗎？")&&D(e)},[D,a.length]),ew=(0,r.useCallback)(e=>{String(e.active.id).startsWith("item-")&&O(String(e.active.id))},[]),ey=(0,r.useCallback)(e=>{let{active:t,over:s}=e;if(O(null),!s)return;if(String(t.id).startsWith("page-")&&String(s.id).startsWith("page-")){let e=a.findIndex(e=>e.id===t.id),i=a.findIndex(e=>e.id===s.id);-1!==e&&-1!==i&&e!==i&&T(e,i)}let i=String(s.id);if(String(t.id).startsWith("item-")){let e=-1;i.startsWith("page-drop-")?e=parseInt(i.replace("page-drop-",""),10):i.startsWith("page-tab-drop-")&&(e=parseInt(i.replace("page-tab-drop-",""),10)),-1===e||isNaN(e)||(Y(String(t.id),e),L(e))}},[a,T,Y,L]),ez=(0,r.useCallback)(()=>{let e=document.querySelector(".report-canvas-content");if(!e)return;let t=window.open("","_blank");if(!t)return;let s=Array.from(document.styleSheets).map(e=>{try{return Array.from(e.cssRules).map(e=>e.cssText).join("")}catch(e){return""}}).join(""),a="16:9"===d?{width:960,height:540}:{width:842,height:595};t.document.write(`
            <html>
                <head>
                    <title>SQM Report - ${new Date().toLocaleDateString()}</title>
                    <style>
                        ${s}
                        @media print {
                            @page {
                                size: ${"A4"===d?"A4 landscape":"960px 540px"};
                                margin: 0;
                            }
                            body { margin: 0; padding: 0; background: #09090b !important; -webkit-print-color-adjust: exact; }
                            .print-canvas {
                                width: ${a.width}px;
                                height: ${a.height}px;
                                position: relative;
                                background: #09090b;
                                overflow: hidden;
                            }
                            .rnd-resizer, .no-print { display: none !important; }
                        }
                    </style>
                </head>
                <body>
                    <div class="print-canvas">
                        ${e.innerHTML}
                    </div>
                    <script>
                        window.onload = () => {
                            setTimeout(() => {
                                window.print();
                            }, 1000);
                        };
                    </script>
                </body>
            </html>
        `),t.document.close()},[d]),ek=(0,r.useCallback)(e=>{el(e),ea(!0)},[]),eA=(0,r.useCallback)(async e=>{ea(!1),ec(!0),eh({current:0,total:e.length});let t=N.Q.getState().currentPageIndex,a=N.Q.getState().viewMode;try{let{domToPng:t,domToJpeg:a}=await s.e(8028).then(s.bind(s,98028));for(let s=0;s<e.length;s++){let i,r=e[s];eh({current:s+1,total:e.length}),N.Q.getState().setCurrentPage(r),await new Promise(e=>setTimeout(e,500));let l=document.querySelector(".report-canvas-content");if(!l){console.error(`Canvas element not found for page ${r}`);continue}let n=eg.width,c=eg.height,o={scale:2,backgroundColor:"#09090b",width:n,height:c,style:{transform:"none",width:`${n}px`,height:`${c}px`}};i="png"===er?await t(l,o):await a(l,{...o,quality:.95});let d=document.createElement("a");d.download=`SQM-Report-P${r+1}-${new Date().getTime()}.${er}`,d.href=i,d.click()}}catch(e){console.error("Batch export failed:",e),alert("批次匯出失敗，部分頁面可能未完成。")}finally{N.Q.getState().setCurrentPage(t),N.Q.getState().setViewMode(a),ec(!1)}},[eg,er]),eC=(0,r.useCallback)(()=>{confirm("確定要清空當前頁面的所有元件嗎？")&&C()},[C]);return(0,i.jsxs)(c.e,{children:[(0,i.jsx)(ed,{selectedIds:y,onScaleModeChange:ex,onDelete:I}),(0,i.jsxs)(H.Mp,{sensors:em,collisionDetection:H.fp,onDragStart:ew,onDragEnd:ey,children:[(0,i.jsxs)("div",{className:"flex h-[calc(100vh-theme(spacing.20))] gap-4",children:[(0,i.jsxs)("aside",{className:"w-80 flex-shrink-0 bg-zinc-900/50 border border-white/5 rounded-xl overflow-hidden flex flex-col",children:[(0,i.jsxs)("div",{className:"p-4 border-b border-white/5 bg-zinc-900",children:[(0,i.jsxs)("h2",{className:"font-semibold text-white flex items-center gap-2",children:[(0,i.jsx)(p.A,{className:"h-5 w-5 text-violet-400"}),"元件面板"]}),(0,i.jsx)("p",{className:"text-xs text-zinc-500 mt-1",children:"點擊或拖曳新增到畫布"})]}),(0,i.jsx)(G,{onAddItem:eb,hasData:!!t}),(0,i.jsxs)("div",{className:"p-4 border-t border-white/5 bg-zinc-900 space-y-3",children:[(0,i.jsx)("div",{className:"text-xs text-zinc-400 font-medium",children:"畫布比例"}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsxs)(m.$,{size:"sm",variant:"16:9"===d?"default":"outline",onClick:()=>S("16:9"),className:(0,f.cn)("flex-1 h-12 flex-col gap-1","16:9"===d?"bg-violet-600":"border-zinc-700"),title:"16:9 (簡報/影片)",children:[(0,i.jsx)("div",{className:(0,f.cn)("w-8 h-[18px] border-2","16:9"===d?"border-white":"border-zinc-500")}),(0,i.jsx)("span",{className:"text-[10px]",children:"16:9"})]}),(0,i.jsxs)(m.$,{size:"sm",variant:"A4"===d?"default":"outline",onClick:()=>S("A4"),className:(0,f.cn)("flex-1 h-12 flex-col gap-1","A4"===d?"bg-violet-600":"border-zinc-700"),title:"A4 (直式列印)",children:[(0,i.jsx)("div",{className:(0,f.cn)("w-[14px] h-5 border-2","A4"===d?"border-white":"border-zinc-500")}),(0,i.jsx)("span",{className:"text-[10px]",children:"A4"})]})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsxs)(m.$,{size:"sm",variant:"1:1"===d?"default":"outline",onClick:()=>S("1:1"),className:(0,f.cn)("flex-1 h-12 flex-col gap-1","1:1"===d?"bg-violet-600":"border-zinc-700"),title:"1:1 (IG/FB方圖)",children:[(0,i.jsx)("div",{className:(0,f.cn)("w-4 h-4 border-2","1:1"===d?"border-white":"border-zinc-500")}),(0,i.jsx)("span",{className:"text-[10px]",children:"1:1"})]}),(0,i.jsxs)(m.$,{size:"sm",variant:"9:16"===d?"default":"outline",onClick:()=>S("9:16"),className:(0,f.cn)("flex-1 h-12 flex-col gap-1","9:16"===d?"bg-violet-600":"border-zinc-700"),title:"9:16 (IG限動)",children:[(0,i.jsx)("div",{className:(0,f.cn)("w-[11px] h-5 border-2","9:16"===d?"border-white":"border-zinc-500")}),(0,i.jsx)("span",{className:"text-[10px]",children:"9:16"})]}),(0,i.jsxs)(m.$,{size:"sm",variant:"4:5"===d?"default":"outline",onClick:()=>S("4:5"),className:(0,f.cn)("flex-1 h-12 flex-col gap-1","4:5"===d?"bg-violet-600":"border-zinc-700"),title:"4:5 (FB/IG直式)",children:[(0,i.jsx)("div",{className:(0,f.cn)("w-4 h-5 border-2","4:5"===d?"border-white":"border-zinc-500")}),(0,i.jsx)("span",{className:"text-[10px]",children:"4:5"})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)(m.$,{className:"w-full bg-emerald-600 hover:bg-emerald-700 h-10",disabled:0===eu.length,onClick:ez,children:[(0,i.jsx)(u.A,{className:"h-4 w-4 mr-2"}),"匯出 PDF"]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(m.$,{size:"sm",variant:"outline",className:"flex-1 border-emerald-900/50 text-emerald-400 hover:bg-emerald-500/10 h-8 text-[10px]",disabled:0===eu.length,onClick:()=>ek("png"),children:"PNG 圖片"}),(0,i.jsx)(m.$,{size:"sm",variant:"outline",className:"flex-1 border-emerald-900/50 text-emerald-400 hover:bg-emerald-500/10 h-8 text-[10px]",disabled:0===eu.length,onClick:()=>ek("jpg"),children:"JPG 圖片"})]})]}),(0,i.jsxs)(m.$,{variant:"outline",className:"w-full border-zinc-800 text-zinc-500 hover:text-red-400 hover:border-red-500/30 h-9 text-xs",disabled:0===eu.length,onClick:eC,children:[(0,i.jsx)(g.A,{className:"h-3.5 w-3.5 mr-2"}),"清空畫布"]})]})]}),(0,i.jsxs)("main",{className:"flex-1 bg-zinc-950 rounded-xl overflow-hidden flex flex-col relative",children:[(0,i.jsxs)("div",{className:"h-12 border-b border-white/5 flex items-center justify-between px-4 bg-zinc-900/80",children:[(0,i.jsxs)("span",{className:"text-sm font-medium text-zinc-400",children:["報表編輯器 • ",d," • 第 ",l+1,"/trb/",a.length," 頁 • ",eu.length," 個元件"]}),(0,i.jsx)("div",{className:"h-6 w-px bg-white/10 mx-2"}),(0,i.jsxs)("div",{className:"bg-zinc-900 border border-white/10 rounded-lg p-0.5 flex",children:[(0,i.jsx)(m.$,{size:"icon",variant:"ghost",onClick:()=>x("single"),className:(0,f.cn)("h-6 w-6 rounded-md","single"===h?"bg-white/20 text-white":"text-zinc-500 hover:text-white"),title:"單頁模式",children:(0,i.jsx)("div",{className:"w-3 h-4 border border-current rounded-[1px]"})}),(0,i.jsx)(m.$,{size:"icon",variant:"ghost",onClick:()=>x("continuous"),className:(0,f.cn)("h-6 w-6 rounded-md","continuous"===h?"bg-white/20 text-white":"text-zinc-500 hover:text-white"),title:"多頁模式",children:(0,i.jsxs)("div",{className:"flex flex-col gap-[1px]",children:[(0,i.jsx)("div",{className:"w-3 h-2 border border-current rounded-[1px]"}),(0,i.jsx)("div",{className:"w-3 h-2 border border-current rounded-[1px]"})]})})]}),(0,i.jsx)(J,{})]}),(0,i.jsxs)("div",{className:"h-10 border-b border-white/5 flex items-center px-2 bg-zinc-900/50 gap-1 overflow-x-auto",children:[(0,i.jsx)(m.$,{size:"icon",variant:"ghost",className:"h-7 w-7 flex-shrink-0",onClick:()=>L(l-1),disabled:0===l,children:(0,i.jsx)(b.A,{className:"h-4 w-4"})}),(0,i.jsx)(B.gB,{items:a.map(e=>e.id),strategy:B.m$,children:a.map((e,t)=>(0,i.jsx)(Z,{id:e.id,name:e.name,index:t,isActive:t===l,canDelete:a.length>1,onClick:()=>L(t),onDelete:()=>eN(e.id)},e.id))}),(0,i.jsx)(m.$,{size:"icon",variant:"ghost",className:"h-7 w-7 flex-shrink-0",onClick:()=>L(l+1),disabled:l===a.length-1,children:(0,i.jsx)(j.A,{className:"h-4 w-4"})}),(0,i.jsxs)(m.$,{size:"sm",variant:"ghost",className:"h-7 px-2 text-violet-400 hover:text-violet-300 hover:bg-violet-500/10 flex-shrink-0",onClick:ef,children:[(0,i.jsx)(v.A,{className:"h-4 w-4 mr-1"}),"新增頁面"]})]}),(0,i.jsx)("div",{className:"flex-1 p-8 flex flex-col items-center bg-zinc-950/50 overflow-auto scroll-smooth",onWheel:e=>{if(e.ctrlKey||e.metaKey){e.preventDefault();let t=e.deltaY>0?-10:10,s=Math.min(Math.max(N.Q.getState().zoomLevel+t,10),200);N.Q.getState().setZoomLevel(s)}},children:t||e?(0,i.jsx)("div",{className:"space-y-8 pb-20",children:"single"===h?a[l]&&(0,i.jsxs)(U,{pageIndex:l,isActive:!0,onFocus:()=>{},onClick:()=>{},children:[(0,i.jsxs)("div",{className:"absolute -top-6 left-0 text-[10px] font-medium text-violet-300 bg-violet-500/10 border-t border-x border-violet-500/20 px-2 py-0.5 rounded-t-md",children:["Page ",l+1," - ",a[l].name]}),(0,i.jsx)("div",{className:"ring-2 ring-violet-500/30 shadow-2xl shadow-violet-900/10 transition-shadow duration-200",children:(0,i.jsx)(w,{width:eg.width,height:eg.height,items:a[l].items,onClickBackground:()=>Q(),onMarqueeSelect:(e,t)=>{t?e.forEach(e=>$(e)):P(e)},children:a[l].items.map(e=>(0,i.jsx)(E,{item:e,isSelected:y.includes(e.id),onSelect:t=>{t?.ctrlKey||t?.metaKey?M(e.id):P([e.id])},onUpdate:t=>ej(e.id,t),onRemove:()=>ev(e.id),onMoveToPage:t=>Y(e.id,t),analysisData:t},e.id))})})]},"single-page-view"):a.map((e,s)=>(0,i.jsxs)(U,{pageIndex:s,isActive:s===l,onFocus:()=>L(s),onClick:()=>L(s),children:[(0,i.jsxs)("div",{className:(0,f.cn)("absolute -top-6 left-0 text-[10px] font-medium transition-colors px-2 py-0.5 rounded-t-md",s===l?"text-violet-300 bg-violet-500/10 border-t border-x border-violet-500/20":"text-zinc-500"),children:["Page ",s+1," - ",e.name]}),(0,i.jsx)("div",{className:(0,f.cn)("transition-shadow duration-200",s===l?"ring-2 ring-violet-500/30 shadow-2xl shadow-violet-900/10":"opacity-90 hover:opacity-100"),children:(0,i.jsx)(w,{width:eg.width,height:eg.height,items:e.items,onClickBackground:()=>{Q(),L(s)},onMarqueeSelect:(e,t)=>{L(s),t?e.forEach(e=>$(e)):P(e)},children:e.items.map(e=>(0,i.jsx)(E,{item:e,isSelected:y.includes(e.id),onSelect:t=>{L(s),t?.ctrlKey||t?.metaKey?M(e.id):P([e.id])},onUpdate:t=>ej(e.id,t),onRemove:()=>ev(e.id),onMoveToPage:t=>Y(e.id,t),analysisData:t},e.id))})})]},e.id))}):(0,i.jsxs)("div",{className:"text-center space-y-4 mt-20",children:[(0,i.jsx)("div",{className:"p-6 rounded-full bg-zinc-900 border border-white/5 inline-block",children:(0,i.jsx)(p.A,{className:"h-10 w-10 text-zinc-600"})}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-medium text-white",children:"尚未載入數據"}),(0,i.jsxs)("p",{className:"text-zinc-500 text-sm mt-1",children:["請先至 ",(0,i.jsx)(n(),{href:"/trb/dashboard",className:"text-violet-400 hover:underline",children:"儀表板"})," 進行分析"]})]})]})})]})]}),(0,i.jsx)(H.Hd,{dropAnimation:null,children:X?(0,i.jsxs)("div",{className:"px-4 py-3 bg-violet-600/80 backdrop-blur-sm text-white rounded-lg shadow-2xl border border-violet-400/50 flex items-center gap-2 pointer-events-none",children:[(0,i.jsx)("div",{className:"w-6 h-6 border-2 border-white/80 rounded flex items-center justify-center",children:(0,i.jsx)(v.A,{className:"w-4 h-4"})}),(0,i.jsxs)("span",{className:"text-sm font-medium",children:["多選拖移中... ",y.length>1?`(${y.length} 個元件)`:""]})]}):null}),_&&!X&&(!ee||null!==W&&W!==l)&&(0,i.jsxs)("div",{className:(0,f.cn)("fixed z-[9999] pointer-events-none px-3 py-1.5 bg-violet-600 text-white rounded-full shadow-xl border-2 border-white/20 flex items-center gap-2 transform -translate-x-1/2 -translate-y-[150%] transition-transform",null!==W&&W!==l?"scale-110 bg-violet-500":""),style:{left:q.x,top:q.y},children:[(0,i.jsx)(v.A,{className:"w-4 h-4"}),(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsx)("span",{className:"text-xs font-bold leading-none",children:null!==W&&W!==l?`移動至第 ${W+1} 頁`:"跨頁移動"}),K>1&&(0,i.jsxs)("span",{className:"text-[9px] opacity-80 leading-none mt-0.5",children:["選取 ",K," 個元件"]})]})]})]}),(0,i.jsx)(ei,{isOpen:es,onClose:()=>ea(!1),onExport:eA,format:er}),en&&(0,i.jsx)("div",{className:"fixed inset-0 z-[10000] flex items-center justify-center bg-black/80 backdrop-blur-md animate-in fade-in duration-300",children:(0,i.jsxs)("div",{className:"text-center space-y-6 max-w-sm w-full px-6",children:[(0,i.jsxs)("div",{className:"relative mx-auto w-24 h-24",children:[(0,i.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-emerald-500/20"}),(0,i.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-emerald-500 border-t-transparent animate-spin",style:{animationDuration:"1.5s"}}),(0,i.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,i.jsx)(u.A,{className:"h-8 w-8 text-emerald-400"})})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("h3",{className:"text-xl font-bold text-white",children:"正在處理匯出..."}),(0,i.jsxs)("p",{className:"text-emerald-400 font-mono text-sm tracking-widest",children:["PAGE ",eo.current," OF ",eo.total]})]}),(0,i.jsx)("div",{className:"h-2 w-full bg-zinc-800 rounded-full overflow-hidden",children:(0,i.jsx)("div",{className:"h-full bg-emerald-500 transition-all duration-300 ease-out shadow-[0_0_10px_rgba(16,185,129,0.5)]",style:{width:`${eo.current/eo.total*100}%`}})}),(0,i.jsx)("p",{className:"text-zinc-500 text-xs italic",children:"請勿關閉視窗，正在準備下載內容"})]})})]})},function(e){let{user:t,hasAccess:s,isLoading:l}=function(){let[e,t]=(0,r.useState)({user:null,hasAccess:!1,isLoading:!0,error:null});return(0,r.useEffect)(()=>{let e=async()=>{try{let{data:{session:e},error:s}=await h.N.auth.getSession();if(s)throw s;if(!e?.user)return void t({user:null,hasAccess:!1,isLoading:!1,error:null});let{data:a,error:i}=await h.N.from("profiles").select("role").eq("id",e.user.id).single();if(i){console.warn("Profile fetch error:",i),t({user:e.user,hasAccess:!1,isLoading:!1,error:null});return}let r=["pro","pro_max","admin","super_admin"].includes(a?.role||"");t({user:e.user,hasAccess:r,isLoading:!1,error:null})}catch(e){console.error("Reports auth check error:",e),t({user:null,hasAccess:!1,isLoading:!1,error:e.message})}};e();let{data:{subscription:s}}=h.N.auth.onAuthStateChange(()=>{e()});return()=>s.unsubscribe()},[]),e}(),n=(0,d.useRouter)();return((0,r.useEffect)(()=>{},[l,s,n]),l)?(0,i.jsx)("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center space-y-4",children:[(0,i.jsx)("div",{className:"h-8 w-8 border-2 border-violet-500/30 border-t-violet-500 rounded-full animate-spin mx-auto"}),(0,i.jsx)("p",{className:"text-zinc-500 text-sm",children:"驗證會員權限..."})]})}):t?s?(0,i.jsx)(a,{...e}):(0,i.jsx)("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center",children:(0,i.jsx)(x.O,{type:"upgrade"})}):(0,i.jsx)("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center",children:(0,i.jsx)(x.O,{type:"login"})})})}},e=>{e.O(0,[4764,3242,5969,6119,5772,5538,9501,8500,5864,5979,5945,8441,3794,7358],()=>e(e.s=22927)),_N_E=e.O()}]);