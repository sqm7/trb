(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3806],{64977:(e,t,a)=>{Promise.resolve().then(a.bind(a,80743))},80743:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eS});var r=a(95155),s=a(12115),i=a(98500),n=a.n(i),l=a(95542),o=a(39734),c=a(86120),d=a(89239),u=a(33024),h=a(60241),x=a(24371),m=a(91663),p=a(68459),g=a(41641),b=a(21362),f=a(51914),v=a(48368),j=a(40980),w=a(96066);let N=new Set;function y({width:e,height:t,children:a,items:i,fullBleed:n=!1,isActive:l=!1,onClickBackground:o,onMarqueeSelect:c,autoFit:d=!0,zoomOverride:u,enableWheelZoom:h=!0}){let x=(0,s.useRef)(null),m=(0,s.useRef)(null),p=(0,w.Q)(e=>e.zoomLevel),g=(0,w.Q)(e=>e.setZoomLevel),[b,f]=(0,s.useState)(!1),[v,y]=(0,s.useState)(null),z=(u??p)/100;s.useEffect(()=>{d&&void 0===u&&(()=>{if(x.current){let a=x.current.parentElement;if(a){let r=Math.min((a.clientWidth-100)/e,(a.clientHeight-100)/t),s=`${e}x${t}`;N.has(s)||(g(Math.floor(100*r)),N.add(s))}}})()},[e,t,g,d,u]);let k=(0,s.useCallback)(e=>{h&&void 0===u&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),g(p+(e.deltaY>0?-5:5)))},[p,g,h,u]),S=(0,s.useCallback)(e=>{let t=e.target,a=m.current?.querySelector(".report-canvas-content"),r=t.closest(".react-draggable")||t.closest("[data-chart-item]"),s=e.target===e.currentTarget||t===a||t.classList.contains("report-canvas-content")||t.style.backgroundImage?.includes("linear-gradient");if(r||!s&&!t.closest(".report-canvas-content"))return;let i=e.currentTarget.getBoundingClientRect(),n=(e.clientX-i.left)/z,l=(e.clientY-i.top)/z;f(!0),y({startX:n,startY:l,endX:n,endY:l,isShiftPressed:e.shiftKey})},[z]),C=(0,s.useCallback)(a=>{if(!b||!v)return;let r=a.currentTarget.getBoundingClientRect(),s=Math.max(0,Math.min(e,(a.clientX-r.left)/z)),i=Math.max(0,Math.min(t,(a.clientY-r.top)/z));y(e=>e?{...e,endX:s,endY:i,isShiftPressed:a.shiftKey}:null)},[b,v,z,e,t]),A=(0,s.useCallback)(e=>{if(b&&v){let t,a,r,s,n=(t=Math.min(v.startX,v.endX),a=Math.max(v.startX,v.endX),r=Math.min(v.startY,v.endY),s=Math.max(v.startY,v.endY),i.filter(e=>{let i=e.x+e.width,n=e.y+e.height;return!(e.x>a||i<t||e.y>s||n<r)}).map(e=>e.id)),l=Math.abs(v.endX-v.startX),d=Math.abs(v.endY-v.startY);l<5&&d<5?o?.():n.length>0?c?.(n,e.shiftKey||v.isShiftPressed):o?.()}f(!1),y(null)},[b,v,i,o,c]),D=v?{left:Math.min(v.startX,v.endX),top:Math.min(v.startY,v.endY),width:Math.abs(v.endX-v.startX),height:Math.abs(v.endY-v.startY)}:null;return(0,r.jsx)("div",{ref:x,className:"relative","data-active-canvas":l?"true":void 0,style:{width:e*z,height:t*z},children:(0,r.jsxs)("div",{ref:m,className:(0,j.cn)("absolute origin-top-left bg-zinc-900 overflow-hidden",n?"border-0 rounded-none shadow-none":"border border-white/10 rounded-lg shadow-2xl","transition-transform duration-200",b&&"cursor-crosshair"),style:{width:e,height:t,transform:`scale(${z})`,transformOrigin:"top left"},onMouseDown:S,onMouseMove:C,onMouseUp:A,onMouseLeave:A,onWheel:k,children:[!n&&(0,r.jsx)("div",{className:"absolute inset-0 opacity-30 pointer-events-none",style:{backgroundImage:`
                                linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
                                linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px)
                            `,backgroundSize:"20px 20px"}}),(0,r.jsxs)("div",{className:"absolute inset-0 pointer-events-none opacity-30",children:[(0,r.jsx)("div",{className:"absolute left-1/2 top-0 bottom-0 border-l border-dashed border-white/20"}),(0,r.jsx)("div",{className:"absolute top-1/2 left-0 right-0 border-t border-dashed border-white/20"})]}),(0,r.jsxs)("div",{className:"relative w-full h-full report-canvas-content",children:[a,0===i.length&&(0,r.jsx)("div",{className:"absolute bottom-3 right-3 text-[10px] text-zinc-500/80",children:"\xa9 平米內參 All Rights Reserved"})]}),b&&D&&(0,r.jsx)("div",{className:"absolute border-2 border-violet-500 bg-violet-500/20 pointer-events-none z-50",style:D}),!n&&(0,r.jsxs)("div",{className:"absolute bottom-2 right-2 text-[10px] text-zinc-600 font-mono bg-zinc-950/80 px-2 py-1 rounded",children:[e," \xd7 ",t]})]})})}var z=a(37288),k=a(19835),S=a(25777),C=a(88743);let A={"1m":"近 1 個月","3m":"近 3 個月","6m":"近 6 個月","1y":"近 1 年","2y":"近 2 年","1q":"近 1 季","2q":"近 2 季","3q":"近 3 季",this_year:"今年",last_2_years:"近 2 年",all:"全部時間"};function D(e){let t=[];return e.counties.length>0?e.districts.length>0?t.push(`區域：${e.counties.join("、")} / ${e.districts.join("、")}`):t.push(`區域：${e.counties.join("、")}`):t.push("區域：全部縣市"),e.startDate&&e.endDate?t.push(`期間：${e.startDate} ~ ${e.endDate}`):e.dateRange&&t.push(`期間：${A[e.dateRange]||e.dateRange}`),e.transactionType&&t.push(`交易類型：${e.transactionType}`),e.buildingType&&t.push(`建物類型：${e.buildingType}`),1===e.projectNames.length?t.push(`建案：${e.projectNames[0]}`):e.projectNames.length>1&&e.projectNames.length<=3?t.push(`建案：${e.projectNames.join("、")}`):e.projectNames.length>3&&t.push(`建案：共 ${e.projectNames.length} 個`),e.excludeCommercial&&t.push("條件：排除商業/辦公"),t}var M=a(68305),$=a(77837),Q=a(20871),R=a(78269),P=a(85623),E=a(37847),I=a(31840),L=a(64148);let T={"cover-template":"報告封面","ranking-metrics":"核心數據指標","unit-price-stats":"各用途單價統計","ranking-chart":"建案排名","ranking-table":"建案排行列表","price-band-chart":"總價帶分佈","price-band-table":"總價帶詳細數據","price-band-location-table":"區域房型成交分佈","price-band-location-chart":"區域成交佔比","unit-price-bubble":"單價泡泡圖","type-comparison-table":"產品類型單價比較","sales-velocity-chart":"銷售速度","sales-velocity-table":"銷售速度明細","parking-pie":"車位配比","parking-price":"車位類型均價","parking-scatter":"車位坪數分析","parking-floor":"車位樓層分析","parking-floor-detail":"車位樓層明細","policy-timeline":"政策時間軸",heatmap:"銷控熱力圖","heatmap-grid":"建案銷控熱力圖","heatmap-stats":"調價幅度摘要","heatmap-comparison":"戶型溢價貢獻","sales-heatmap":"房型面積熱力圖","sales-heatmap-detail":"熱力詳細交易表","data-list":"交易明細表","text-box":"文字方塊"};function F({item:e,onUpdate:t,isSelected:a,isCompact:i}){let n=(0,w.Q)(e=>e.setSelectedIds),l=e.data||{},o=s.useRef(null),[c,d]=s.useState(!1),[u,h]=s.useState(!1),x=s.useRef(!1),m=s.useCallback(e=>{let t=window.getSelection();if(!t)return;let a=document.createRange();a.selectNodeContents(e),a.collapse(!1),t.removeAllRanges(),t.addRange(a)},[]),p="string"==typeof l.html?l.html:"string"==typeof l.text?l.text:"",g=l.align||"left",b=l.verticalAlign||"top",f=Number(l.fontSize??l.size??18),v=Number(l.maxFontSize??l.fontSize??l.size??18),j=l.fontFamily||'"Noto Sans TC", "PingFang TC", "Microsoft JhengHei", system-ui, sans-serif',N=Number(l.fontWeight??l.weight??500),y=!!l.italic,z=!!l.underline,k=l.color||"#e4e4e7",S=!0===l.autoFit,C=!1!==l.autoGrow,A=Number(l.rotation||0),D=s.useCallback(e=>{t({data:{...l,...e}})},[t,l]),M=s.useCallback(()=>{if(!S)return;let e=o.current;if(!e)return;let t=t=>(e.style.fontSize=`${t}px`,e.scrollHeight<=e.clientHeight&&e.scrollWidth<=e.clientWidth),a=8,r=Math.max(8,v||f||18),s=8;for(;a<=r;){let e=Math.floor((a+r)/2);t(e)?(s=e,a=e+1):r=e-1}s!==f&&D({fontSize:s})},[S,f,v,D]);return s.useEffect(()=>{o.current&&(c||o.current.innerHTML===p||(o.current.innerHTML=p||""))},[p,c]),s.useEffect(()=>{!a&&u&&h(!1)},[a,u]),s.useEffect(()=>{if(!u)return;let e=requestAnimationFrame(()=>{let e=o.current;e&&(e.focus(),x.current&&(m(e),x.current=!1))});return()=>cancelAnimationFrame(e)},[u,m]),s.useEffect(()=>{S&&requestAnimationFrame(M)},[S,M,e.width,e.height,p,f]),s.useLayoutEffect(()=>{if(!C||S||!o.current)return;let a=Math.max(28,Math.ceil(o.current.scrollHeight+20));Math.abs(a-e.height)>=1&&t({height:a})},[C,S,p,f,N,j,y,z,e.width,e.height,t]),(0,r.jsx)("div",{className:"h-full w-full flex flex-col",style:{justifyContent:"middle"===b?"center":"bottom"===b?"flex-end":"flex-start",padding:"10px 14px"},onMouseDown:t=>{let r=t.target;!o.current?.contains(r)&&(u&&(h(!1),o.current?.blur()),a||n([e.id]))},children:(0,r.jsx)("div",{ref:o,className:"w-full outline-none whitespace-pre-wrap leading-snug",style:{textAlign:g,fontSize:`${f}px`,fontWeight:N,fontStyle:y?"italic":"normal",textDecoration:z?"underline":"none",fontFamily:j,color:k,lineHeight:1.2,transform:`rotate(${A}deg)`,transformOrigin:"center"},contentEditable:!0,suppressContentEditableWarning:!0,"data-text-box-id":e.id,"data-no-drag":"true","data-report-control":"allow",onDoubleClick:()=>{x.current=!0,h(!0)},onKeyDown:e=>{"Escape"===e.key&&(e.preventDefault(),h(!1),e.currentTarget.blur())},onFocus:()=>{d(!0),h(!0),a||n([e.id])},onBlur:()=>{d(!1),h(!1),o.current&&D({html:o.current.innerHTML})},onInput:()=>{o.current&&(D({html:o.current.innerHTML}),S&&requestAnimationFrame(M))}})})}function q({item:e,isSelected:t,onSelect:a,onUpdate:i,onRemove:n,onMoveToPage:l,analysisData:o,canvasWidth:c,canvasHeight:d}){let u=(0,w.Q)(e=>e.selectedIds),h=(0,w.Q)(e=>e.batchUpdateItems),x=(0,w.Q)(e=>e.pages),m=(0,w.Q)(e=>e.currentPageIndex),g=(0,w.Q)(e=>e.setDragging),b=x[m]?.items||[],f=s.useRef({}),v=s.useRef(!1),N=s.useRef(!1),y=()=>{};s.useEffect(()=>{"select"!==e.scaleMode&&i({scaleMode:"select",panOffset:{x:0,y:0}})},[e.scaleMode,i]);let A=(0,w.Q)(e=>e.zoomLevel),q="cover-template"===e.type,B="text-box"===e.type,[_,H]=s.useState(!1),X=!!e.headerLocked,Y=!q&&!B&&(X||_),W=e.contentScale||1,O=!!e.showControls,K={width:"100%",height:"100%",transformOrigin:"center center"};1!==W&&(K.zoom=W);let Z=q?"report-builder-item report-builder-item-cover bg-transparent border-0 rounded-none shadow-none relative":(0,j.cn)("report-builder-item group/item rounded-lg border-2 transition-colors relative",B?"bg-transparent backdrop-blur-none":"bg-zinc-800/80 backdrop-blur-sm",t?"border-violet-500 shadow-lg shadow-violet-500/20":"border-transparent hover:border-zinc-600");return(0,r.jsxs)(z.p,{scale:A/100,size:{width:q?c:e.width,height:q?d:e.height},position:{x:q?0:e.x,y:q?0:e.y},disableDragging:q,dragHandleClassName:q||B?void 0:"chart-drag-handle",onMouseEnter:()=>H(!0),onMouseLeave:()=>H(!1),onDragStart:e=>{if(N.current=!1,t){v.current=!0,g(!0,u.length);let e={};u.forEach(t=>{let a=b.find(e=>e.id===t);a&&(e[t]={x:a.x,y:a.y})}),f.current=e,console.log("Group drag start:",e)}else v.current=!1,g(!0,1)},onDrag:(t,a)=>{N.current=!0;let r=t.clientX||t.touches?.[0]?.clientX,s=t.clientY||t.touches?.[0]?.clientY;if(void 0!==r&&void 0!==s){let e=document.elementsFromPoint(r,s).find(e=>"true"===e.getAttribute("data-page-drop-target")||"true"===e.getAttribute("data-page-drop-zone")),t=e?.getAttribute("data-page-index"),a=null!=t?parseInt(t,10):null;w.Q.getState().setHoveredPageIndex(a)}if(v.current&&u.length>1){let t=a.x-(f.current[e.id]?.x||e.x),r=a.y-(f.current[e.id]?.y||e.y),s={};u.forEach(a=>{a!==e.id&&f.current[a]&&(s[a]={x:f.current[a].x+t,y:f.current[a].y+r})}),Object.keys(s).length>0&&h(s)}},onDragStop:(a,r)=>{let s=a.clientX||a.changedTouches?.[0]?.clientX,n=a.clientY||a.changedTouches?.[0]?.clientY;if(void 0!==s&&void 0!==n){let e=document.elementsFromPoint(s,n).find(e=>"true"===e.getAttribute("data-page-drop-target")||"true"===e.getAttribute("data-page-drop-zone"));if(e){let a=parseInt(e.getAttribute("data-page-index")||"-1",10);if(a>=0&&a!==w.Q.getState().currentPageIndex){t?w.Q.getState().moveSelectedItemsToPage(a):l&&l(a),w.Q.getState().setCurrentPage(a),v.current=!1,f.current={},g(!1),w.Q.getState().setHoveredPageIndex(null);return}}}if(v.current&&u.length>1){let t=r.x-(f.current[e.id]?.x||e.x),a=r.y-(f.current[e.id]?.y||e.y),s={};u.forEach(i=>{let n=f.current[i];n&&(s[i]={x:i===e.id?r.x:n.x+t,y:i===e.id?r.y:n.y+a})}),h(s)}else i({x:r.x,y:r.y});v.current=!1,f.current={},g(!1),w.Q.getState().setHoveredPageIndex(null)},onResizeStop:(e,t,a,r,s)=>{i({width:parseInt(a.style.width,10),height:parseInt(a.style.height,10),x:s.x,y:s.y})},minWidth:B?60:150,minHeight:B?28:100,bounds:void 0,onClick:e=>{e.stopPropagation(),N.current||a(e),N.current=!1},className:Z,enableResizing:q?{top:!1,right:!1,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1}:B?{top:!1,right:!1,bottom:!1,left:!1,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0}:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},cancel:"input,textarea,select,button,option,.cover-edit-field,[data-no-drag='true']",resizeHandleStyles:{topRight:{cursor:"ne-resize",width:B?14:20,height:B?14:20,right:B?-7:-10,top:B?-7:-10},bottomRight:{cursor:"se-resize",width:B?14:20,height:B?14:20,right:B?-7:-10,bottom:B?-7:-10},bottomLeft:{cursor:"sw-resize",width:B?14:20,height:B?14:20,left:B?-7:-10,bottom:B?-7:-10},topLeft:{cursor:"nw-resize",width:B?14:20,height:B?14:20,left:B?-7:-10,top:B?-7:-10},top:B?{display:"none"}:{cursor:"n-resize",height:20,top:-10},bottom:B?{display:"none"}:{cursor:"s-resize",height:20,bottom:-10},left:B?{display:"none"}:{cursor:"w-resize",width:20,left:-10},right:B?{display:"none"}:{cursor:"e-resize",width:20,right:-10}},children:[!q&&!B&&(0,r.jsxs)("div",{className:(0,j.cn)("report-builder-item-header chart-drag-handle no-print h-7 bg-zinc-900/90 flex items-center justify-between px-2 cursor-move border-b border-white/5 select-none group/header transition-opacity duration-200 absolute top-0 left-0 right-0 z-20",Y?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"),children:[(0,r.jsxs)("div",{className:"flex items-center gap-1.5 overflow-hidden",children:[(0,r.jsx)(k.A,{className:"h-3 w-3 text-zinc-500 group-hover/header:text-violet-400"}),(0,r.jsx)("span",{className:"text-[10px] text-zinc-400 font-medium truncate",children:T[e.type]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),i({showControls:!O})},className:(0,j.cn)("px-2 py-1 rounded text-[9px] font-medium transition-colors opacity-0 group-hover/header:opacity-100",O?"text-violet-300 bg-violet-500/15 hover:bg-violet-500/25":"text-zinc-500 hover:text-zinc-300 hover:bg-white/5"),title:O?"隱藏元件控制項":"完整顯示元件",children:"完整顯示元件"}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),i({headerLocked:!X})},className:(0,j.cn)("p-1 rounded transition-colors opacity-0 group-hover/header:opacity-100",X?"text-emerald-400 hover:text-emerald-300":"text-zinc-600 hover:text-zinc-300 hover:bg-white/5"),title:X?"取消鎖定標題":"鎖定標題",children:(0,r.jsx)(S.A,{className:"h-3 w-3"})}),(0,r.jsxs)("span",{className:"text-[9px] text-zinc-600 font-mono hidden sm:inline",children:[e.width,"\xd7",e.height]}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),n()},className:"p-1 rounded hover:bg-red-500/20 text-zinc-600 hover:text-red-400 transition-colors opacity-0 group-hover/header:opacity-100",children:(0,r.jsx)(p.A,{className:"h-3 w-3"})})]})]}),(0,r.jsxs)("div",{className:(0,j.cn)("report-builder-item-content relative group/content",q||B?"p-0":"p-2",!q&&(B?"pt-0":Y?"pt-7":"pt-2"),!O&&!q&&"report-builder-compact"),style:{height:"100%"},onMouseDown:()=>{},onMouseMove:()=>{},onMouseUp:y,onMouseLeave:y,children:[(0,r.jsx)("div",{style:{width:"100%",height:"100%"},children:(0,r.jsx)("div",{style:K,children:(()=>{if("cover-template"===e.type){let t=C.P.getState(),a=D({counties:t.counties,districts:t.districts,transactionType:t.transactionType,buildingType:t.buildingType,projectNames:t.projectNames,dateRange:t.dateRange,startDate:t.startDate,endDate:t.endDate,excludeCommercial:t.excludeCommercial}),s={logoText:"平米內參",title:"市場分析報告",subtitle:"價格帶與銷售動能評估",projectName:"請填寫建案名稱",period:"2026 Q1",preparedBy:"平米內參",reportDate:new Date().toISOString().split("T")[0],searchConditions:a,...e.data||{}},n=(e,t)=>{i({data:{...s,[e]:t}})},l=Array.isArray(s.searchConditions)?s.searchConditions.filter(e=>"string"==typeof e&&e.trim().length>0):[],o="/trb",u=c/d,h=.05>Math.abs(u-16/9),x=.05>Math.abs(u-595/842),m=.05>Math.abs(u-1),p=.05>Math.abs(u-.8),g=.05>Math.abs(u-.5625),b="cover-edit-field w-full bg-transparent border-b border-white/10 text-white focus:outline-none focus:border-cyan-400 transition-colors",f=(e,t,a,s,i,l)=>(0,r.jsxs)("div",{className:(0,j.cn)("space-y-1",l),children:[(0,r.jsx)("p",{className:"text-zinc-500 uppercase tracking-[0.15em] font-medium",style:{fontSize:i},children:e}),(0,r.jsx)("input",{value:a,onChange:e=>n(t,e.target.value),className:(0,j.cn)(b,"px-1 py-0.5"),style:{fontSize:s}})]}),v=e=>(0,r.jsx)("div",{className:"flex flex-wrap gap-1.5",children:l.map((t,a)=>(0,r.jsx)("span",{className:"inline-block bg-white/5 border border-white/10 rounded-full text-zinc-300 whitespace-nowrap",style:{fontSize:e,padding:`${Math.round(.2*e)}px ${Math.round(.7*e)}px`},children:t},a))});return h?(0,r.jsxs)("div",{className:"h-full w-full overflow-hidden bg-gradient-to-br from-zinc-950 via-zinc-900 to-slate-950 relative",children:[(0,r.jsx)("div",{className:"absolute -top-20 -right-20 w-72 h-72 rounded-full bg-cyan-500/8 blur-[80px]"}),(0,r.jsx)("div",{className:"absolute -bottom-16 left-[30%] w-56 h-56 rounded-full bg-violet-500/8 blur-[60px]"}),(0,r.jsx)("div",{className:"absolute top-0 left-0 w-1 h-full bg-gradient-to-b from-cyan-400/60 via-cyan-400/20 to-transparent"}),(0,r.jsxs)("div",{className:"relative z-10 h-full grid grid-cols-[1fr_280px]",children:[(0,r.jsxs)("div",{className:"flex flex-col justify-between p-8 pr-6",children:[(0,r.jsx)("div",{}),(0,r.jsxs)("div",{className:"flex items-start gap-4 -mt-4",children:[(0,r.jsx)("img",{src:`${o}/logo-type-a.jpg`,alt:"Logo",className:"rounded-lg object-cover border border-white/10 flex-shrink-0 mt-1",style:{width:56,height:56},draggable:!1}),(0,r.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,r.jsx)("input",{value:s.title,onChange:e=>n("title",e.target.value),className:(0,j.cn)(b,"font-bold text-white tracking-tight py-0.5"),style:{fontSize:32}}),(0,r.jsx)("input",{value:s.subtitle,onChange:e=>n("subtitle",e.target.value),className:(0,j.cn)(b,"text-zinc-400 py-0.5"),style:{fontSize:15}})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"grid grid-cols-4 gap-4 mb-2",children:[f("建案","projectName",s.projectName,12,9),f("期間","period",s.period,12,9),f("製作","preparedBy",s.preparedBy,12,9),f("日期","reportDate",s.reportDate,12,9)]}),(0,r.jsx)("p",{className:"text-zinc-600",style:{fontSize:8},children:"\xa9 平米內參 All Rights Reserved"})]})]}),(0,r.jsxs)("div",{className:"flex flex-col justify-end p-6 pl-0 border-l border-white/5",children:[(0,r.jsxs)("div",{className:"flex-1 flex items-center justify-center relative",children:[(0,r.jsx)("div",{className:"w-32 h-32 rounded-2xl border border-cyan-500/15 rotate-12 absolute"}),(0,r.jsx)("div",{className:"w-24 h-24 rounded-xl border border-violet-500/15 -rotate-6 absolute"}),(0,r.jsx)("div",{className:"w-10 h-10 rounded-lg bg-cyan-500/10 absolute"})]}),(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)("p",{className:"text-zinc-500 uppercase tracking-[0.15em] font-medium",style:{fontSize:9},children:"搜尋條件"}),v(10)]})]})]})]}):x?(0,r.jsxs)("div",{className:"h-full w-full overflow-hidden bg-gradient-to-b from-zinc-950 via-zinc-900 to-zinc-950 relative",children:[(0,r.jsx)("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-cyan-500/40 to-transparent"}),(0,r.jsx)("div",{className:"absolute top-10 right-10 w-40 h-40 rounded-full bg-cyan-500/5 blur-[50px]"}),(0,r.jsx)("div",{className:"absolute bottom-20 left-10 w-32 h-32 rounded-full bg-violet-500/5 blur-[40px]"}),(0,r.jsxs)("div",{className:"relative z-10 h-full flex flex-col px-10 py-10 overflow-hidden",children:[(0,r.jsx)("div",{className:"w-full h-px bg-gradient-to-r from-cyan-500/30 via-white/10 to-transparent flex-shrink-0"}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center",children:[(0,r.jsxs)("div",{className:"flex items-start gap-4",children:[(0,r.jsx)("img",{src:`${o}/logo-type-a.jpg`,alt:"Logo",className:"rounded-lg object-cover border border-white/10 flex-shrink-0 mt-1",style:{width:52,height:52},draggable:!1}),(0,r.jsxs)("div",{className:"flex-1 text-left space-y-1",children:[(0,r.jsx)("input",{value:s.title,onChange:e=>n("title",e.target.value),className:(0,j.cn)(b,"font-bold text-white tracking-tight py-0.5 pl-0 -ml-0.5"),style:{fontSize:28}}),(0,r.jsx)("input",{value:s.subtitle,onChange:e=>n("subtitle",e.target.value),className:(0,j.cn)(b,"text-zinc-400 py-0.5 pl-0"),style:{fontSize:13}})]})]}),(0,r.jsx)("div",{className:"w-16 h-px bg-cyan-500/30 mx-auto mt-6"})]}),(0,r.jsxs)("div",{className:"flex-shrink-0 space-y-3",children:[(0,r.jsx)("div",{className:"w-full h-px bg-white/5"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-x-8 gap-y-3",children:[f("建案名稱","projectName",s.projectName,12,9),f("分析期間","period",s.period,12,9),f("製作單位","preparedBy",s.preparedBy,12,9),f("報告日期","reportDate",s.reportDate,12,9)]}),(0,r.jsxs)("div",{className:"space-y-1.5 mt-2",children:[(0,r.jsx)("p",{className:"text-zinc-500 uppercase tracking-[0.15em] font-medium",style:{fontSize:9},children:"搜尋條件"}),v(10)]}),(0,r.jsx)("div",{className:"w-full h-px bg-white/5 mt-2"}),(0,r.jsx)("p",{className:"text-zinc-600 text-center",style:{fontSize:8},children:"\xa9 平米內參 All Rights Reserved"})]})]})]}):m?(0,r.jsxs)("div",{className:"h-full w-full overflow-hidden bg-gradient-to-br from-zinc-950 via-zinc-900 to-slate-900 relative",children:[(0,r.jsx)("div",{className:"absolute -top-16 -left-16 w-48 h-48 rounded-full bg-cyan-500/10 blur-[60px]"}),(0,r.jsx)("div",{className:"absolute -top-16 -right-16 w-40 h-40 rounded-full bg-violet-500/8 blur-[50px]"}),(0,r.jsx)("div",{className:"absolute -bottom-16 -left-16 w-40 h-40 rounded-full bg-violet-500/8 blur-[50px]"}),(0,r.jsx)("div",{className:"absolute -bottom-16 -right-16 w-48 h-48 rounded-full bg-cyan-500/6 blur-[60px]"}),(0,r.jsx)("div",{className:"absolute inset-4 border border-white/5 rounded-2xl pointer-events-none"}),(0,r.jsxs)("div",{className:"relative z-10 h-full flex flex-col items-center justify-center px-14 py-12 text-center",children:[(0,r.jsxs)("div",{className:"flex items-start gap-10 w-full max-w-[800px]",children:[(0,r.jsx)("img",{src:`${o}/logo-type-a.jpg`,alt:"Logo",className:"rounded-xl object-cover border-2 border-white/15 flex-shrink-0 mt-3",style:{width:110,height:110},draggable:!1}),(0,r.jsxs)("div",{className:"flex-1 text-left space-y-4",children:[(0,r.jsx)("input",{value:s.title,onChange:e=>n("title",e.target.value),className:(0,j.cn)(b,"font-bold text-white tracking-tight py-0.5 pl-0 -ml-0.5"),style:{fontSize:80}}),(0,r.jsx)("input",{value:s.subtitle,onChange:e=>n("subtitle",e.target.value),className:(0,j.cn)(b,"text-zinc-400 py-0.5 pl-0"),style:{fontSize:40}})]})]}),(0,r.jsx)("div",{className:"w-16 h-0.5 bg-gradient-to-r from-transparent via-cyan-500/40 to-transparent my-10"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-x-12 gap-y-5 w-full max-w-[640px] text-left",children:[f("建案","projectName",s.projectName,22,14),f("期間","period",s.period,22,14),f("製作","preparedBy",s.preparedBy,22,14),f("日期","reportDate",s.reportDate,22,14)]}),(0,r.jsxs)("div",{className:"mt-8 w-full max-w-[640px]",children:[(0,r.jsx)("p",{className:"text-zinc-500 uppercase tracking-[0.15em] font-medium text-left mb-2",style:{fontSize:13},children:"搜尋條件"}),v(16)]}),(0,r.jsx)("p",{className:"text-zinc-600 mt-6",style:{fontSize:12},children:"\xa9 平米內參 All Rights Reserved"})]})]}):p?(0,r.jsxs)("div",{className:"h-full w-full overflow-hidden bg-gradient-to-b from-zinc-950 via-zinc-900 to-slate-950 relative",children:[(0,r.jsx)("div",{className:"absolute -top-20 left-1/2 -translate-x-1/2 w-64 h-64 rounded-full bg-cyan-500/8 blur-[80px]"}),(0,r.jsx)("div",{className:"absolute -bottom-20 left-1/4 w-48 h-48 rounded-full bg-violet-500/8 blur-[60px]"}),(0,r.jsx)("div",{className:"absolute inset-5 border border-white/[0.04] rounded-2xl pointer-events-none"}),(0,r.jsxs)("div",{className:"relative z-10 h-full flex flex-col items-center px-10 py-10 text-center",children:[(0,r.jsxs)("div",{className:"flex items-start gap-4 mt-24 w-full max-w-[580px]",children:[(0,r.jsx)("img",{src:`${o}/logo-type-a.jpg`,alt:"Logo",className:"rounded-xl object-cover border-2 border-white/15 flex-shrink-0 mt-1",style:{width:80,height:80},draggable:!1}),(0,r.jsxs)("div",{className:"flex-1 text-left space-y-1",children:[(0,r.jsx)("input",{value:s.title,onChange:e=>n("title",e.target.value),className:(0,j.cn)(b,"font-bold text-white tracking-tight py-0.5 pl-0 -ml-0.5"),style:{fontSize:42}}),(0,r.jsx)("input",{value:s.subtitle,onChange:e=>n("subtitle",e.target.value),className:(0,j.cn)(b,"text-zinc-400 py-0.5 pl-0"),style:{fontSize:22}})]})]}),(0,r.jsx)("div",{className:"flex-1 flex items-center",children:(0,r.jsx)("div",{className:"w-12 h-0.5 bg-gradient-to-r from-transparent via-cyan-500/40 to-transparent"})}),(0,r.jsxs)("div",{className:"w-full max-w-[580px] space-y-3 text-left mb-4",children:[f("建案名稱","projectName",s.projectName,20,13),f("分析期間","period",s.period,20,13),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[f("製作單位","preparedBy",s.preparedBy,20,13),f("報告日期","reportDate",s.reportDate,20,13)]})]}),(0,r.jsxs)("div",{className:"w-full max-w-[580px] text-left mt-auto mb-3",children:[(0,r.jsx)("p",{className:"text-zinc-500 uppercase tracking-[0.15em] font-medium mb-2",style:{fontSize:13},children:"搜尋條件"}),v(15)]}),(0,r.jsx)("p",{className:"text-zinc-600",style:{fontSize:11},children:"\xa9 平米內參 All Rights Reserved"})]})]}):g?(0,r.jsxs)("div",{className:"h-full w-full overflow-hidden bg-gradient-to-b from-zinc-950 via-slate-900 to-zinc-950 relative",children:[(0,r.jsx)("div",{className:"absolute -top-24 left-1/2 -translate-x-1/2 w-72 h-72 rounded-full bg-cyan-500/10 blur-[90px]"}),(0,r.jsx)("div",{className:"absolute -bottom-24 left-1/2 -translate-x-1/2 w-64 h-64 rounded-full bg-violet-500/10 blur-[80px]"}),(0,r.jsx)("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-px h-20 bg-gradient-to-b from-cyan-500/40 to-transparent"}),(0,r.jsx)("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-px h-20 bg-gradient-to-t from-violet-500/30 to-transparent"}),(0,r.jsxs)("div",{className:"relative z-10 h-full flex flex-col items-center px-8 py-10 text-center",children:[(0,r.jsxs)("div",{className:"flex items-start gap-4 mt-40 w-full",children:[(0,r.jsx)("img",{src:`${o}/logo-type-a.jpg`,alt:"Logo",className:"rounded-xl object-cover border-2 border-white/15 flex-shrink-0 mt-1",style:{width:76,height:76},draggable:!1}),(0,r.jsxs)("div",{className:"flex-1 text-left space-y-2",children:[(0,r.jsx)("input",{value:s.title,onChange:e=>n("title",e.target.value),className:(0,j.cn)(b,"font-bold text-white tracking-tight py-0.5 pl-0 -ml-0.5"),style:{fontSize:40}}),(0,r.jsx)("input",{value:s.subtitle,onChange:e=>n("subtitle",e.target.value),className:(0,j.cn)(b,"text-zinc-400 py-0.5 pl-0"),style:{fontSize:24}})]})]}),(0,r.jsx)("div",{className:"flex-1 flex flex-col items-center justify-center w-full",children:(0,r.jsx)("div",{className:"w-10 h-0.5 bg-gradient-to-r from-transparent via-cyan-500/50 to-transparent my-6"})}),(0,r.jsxs)("div",{className:"w-full space-y-3 text-left mb-4",children:[f("建案名稱","projectName",s.projectName,22,13),f("分析期間","period",s.period,22,13),f("製作單位","preparedBy",s.preparedBy,22,13),f("報告日期","reportDate",s.reportDate,22,13)]}),(0,r.jsxs)("div",{className:"w-full text-left mb-4",children:[(0,r.jsx)("p",{className:"text-zinc-500 uppercase tracking-[0.15em] font-medium mb-2",style:{fontSize:13},children:"搜尋條件"}),v(16)]}),(0,r.jsx)("p",{className:"text-zinc-600 mb-2",style:{fontSize:12},children:"\xa9 平米內參 All Rights Reserved"})]})]}):(0,r.jsx)("div",{className:"h-full w-full overflow-hidden bg-gradient-to-br from-zinc-950 via-zinc-900 to-slate-900 relative flex items-center justify-center",children:(0,r.jsx)("p",{className:"text-zinc-500 text-sm",children:"不支持的尺寸"})})}if(!o&&"text-box"!==e.type&&"policy-timeline"!==e.type)return(0,r.jsx)("div",{className:"flex items-center justify-center h-full text-zinc-500 text-sm",children:"無數據"});let a=o?{coreMetrics:o.coreMetrics,projectRanking:o.rankingAnalysis?.projectRanking||o.projectRanking||[]}:null,s=o?.priceBandAnalysis?{...o.priceBandAnalysis,transactionDetails:o.transactionDetails}:null,n=e=>(0,r.jsx)("div",{className:"h-full overflow-auto custom-scrollbar p-1",children:e});switch(e.type){case"ranking-metrics":return n((0,r.jsx)(M.p,{data:a,visibleSections:["metrics"],className:"h-full [&>div]:h-full"}));case"ranking-chart":return n((0,r.jsx)(M.p,{data:a,visibleSections:["chart"],className:"h-full [&>div]:h-full"}));case"ranking-table":return n((0,r.jsx)(M.p,{data:a,visibleSections:["table"],className:"h-full [&>div]:h-full"}));case"price-band-chart":return n((0,r.jsx)($.P,{data:s,visibleSections:["chart"]}));case"price-band-table":return n((0,r.jsx)($.P,{data:s,visibleSections:["table"]}));case"price-band-location-table":return n((0,r.jsx)($.P,{data:s,visibleSections:["location-table"]}));case"price-band-location-chart":return n((0,r.jsx)($.P,{data:s,visibleSections:["location-chart"]}));case"unit-price-stats":return n((0,r.jsx)(Q.U,{data:o||null,visibleSections:["stats"]}));case"type-comparison-table":return n((0,r.jsx)(Q.U,{data:o||null,visibleSections:["comparison"],comparisonExpandAll:!0}));case"unit-price-bubble":return n((0,r.jsx)(Q.U,{data:o||null,visibleSections:["chart"]}));case"sales-velocity-chart":return n((0,r.jsx)(P.Q,{data:o||null,visibleSections:["chart"]}));case"sales-velocity-table":return n((0,r.jsx)(P.Q,{data:o||null,visibleSections:["table"]}));case"sales-heatmap":return n((0,r.jsx)(P.Q,{data:o||null,visibleSections:["heatmap"]}));case"sales-heatmap-detail":return n((0,r.jsx)(P.Q,{data:o||null,visibleSections:["heatmap-detail"]}));case"parking-pie":return n((0,r.jsx)(E.v,{data:o||null,visibleSections:["ratio"]}));case"parking-price":return n((0,r.jsx)(E.v,{data:o||null,visibleSections:["price"]}));case"parking-scatter":return n((0,r.jsx)(E.v,{data:o||null,visibleSections:["scatter"]}));case"parking-floor":return n((0,r.jsx)(E.v,{data:o||null,visibleSections:["floor"]}));case"parking-floor-detail":return n((0,r.jsx)(E.v,{data:o||null,visibleSections:["floor-detail"]}));case"heatmap":case"heatmap-grid":return n((0,r.jsx)(R.b,{data:o||null,visibleSections:["grid"]}));case"heatmap-stats":return n((0,r.jsx)(R.b,{data:o||null,visibleSections:["stats"]}));case"heatmap-comparison":return n((0,r.jsx)(R.b,{data:o||null,visibleSections:["comparison"]}));case"data-list":return n((0,r.jsx)(I.p,{trigger:o?.transactionDetails?.length?o:null}));case"policy-timeline":return n((0,r.jsx)(L.A,{data:o?.transactionDetails||[]}));case"text-box":return(0,r.jsx)(F,{item:e,onUpdate:i,isSelected:t,isCompact:!O});default:return(0,r.jsx)("div",{className:"flex items-center justify-center h-full text-zinc-500 text-sm",children:"未知圖表類型"})}})()})}),!q&&!t&&!B&&(0,r.jsx)("div",{className:"absolute inset-0 z-10 cursor-pointer",onClick:e=>{e.stopPropagation(),a(e)}})]})]})}var B=a(24338),_=a(93219),H=a(89123),X=a(14403),Y=a(19965),W=a(28063),O=a(44071);let K=[{id:"cover",title:"編輯元件",items:[{type:"cover-template",label:"報告封面",icon:(0,r.jsx)(v.A,{className:"h-4 w-4"}),description:"可編輯標題與日期",requiresData:!1},{type:"text-box",label:"文字方塊",icon:(0,r.jsx)(B.A,{className:"h-4 w-4"}),description:"可輸入文字與數字",requiresData:!1}]},{id:"ranking",title:"核心指標與排名",items:[{type:"ranking-metrics",label:"核心數據指標",icon:(0,r.jsx)(_.A,{className:"h-4 w-4"}),description:"8 項關鍵成交指標卡片",requiresData:!0},{type:"ranking-chart",label:"建案排名圖表",icon:(0,r.jsx)(H.A,{className:"h-4 w-4"}),description:"總銷與各項指標排名",requiresData:!0},{type:"ranking-table",label:"建案排名列表",icon:(0,r.jsx)(H.A,{className:"h-4 w-4"}),description:"詳細數據列表",requiresData:!0}]},{id:"price-band",title:"總價帶分析",items:[{type:"price-band-chart",label:"總價帶分佈",icon:(0,r.jsx)(X.A,{className:"h-4 w-4"}),description:"價格區間箱型圖",requiresData:!0},{type:"price-band-table",label:"總價帶詳情",icon:(0,r.jsx)(X.A,{className:"h-4 w-4"}),description:"各房型衛浴統計",requiresData:!0},{type:"price-band-location-chart",label:"區域成交佔比",icon:(0,r.jsx)(Y.A,{className:"h-4 w-4"}),description:"各區房型分佈",requiresData:!0},{type:"price-band-location-table",label:"區域房型分佈",icon:(0,r.jsx)(X.A,{className:"h-4 w-4"}),description:"區域交叉分析表",requiresData:!0}]},{id:"unit-price",title:"單價分析",items:[{type:"unit-price-stats",label:"各用途單價統計",icon:(0,r.jsx)(_.A,{className:"h-4 w-4"}),description:"住宅/辦公/店面指標卡",requiresData:!0},{type:"unit-price-bubble",label:"單價泡泡圖",icon:(0,r.jsx)(_.A,{className:"h-4 w-4"}),description:"成交單價熱度分佈",requiresData:!0},{type:"type-comparison-table",label:"產品類型比較",icon:(0,r.jsx)(X.A,{className:"h-4 w-4"}),description:"住宅/店面/辦公均價",requiresData:!0}]},{id:"heatmap",title:"調價熱力圖",items:[{type:"heatmap-grid",label:"銷控熱力圖",icon:(0,r.jsx)(X.A,{className:"h-4 w-4"}),description:"樓層戶別價差分析",requiresData:!0},{type:"heatmap-stats",label:"調價幅度摘要",icon:(0,r.jsx)(X.A,{className:"h-4 w-4"}),description:"總溢價與平均調價",requiresData:!0},{type:"heatmap-comparison",label:"戶型溢價貢獻",icon:(0,r.jsx)(X.A,{className:"h-4 w-4"}),description:"各戶型水平價差比較",requiresData:!0}]},{id:"timeline",title:"政策時光機",items:[{type:"policy-timeline",label:"政策時間軸",icon:(0,r.jsx)(W.A,{className:"h-4 w-4"}),description:"政策/金融事件整理",requiresData:!0}]},{id:"velocity",title:"銷售速度與房型",items:[{type:"sales-velocity-chart",label:"銷售速度趨勢",icon:(0,r.jsx)(O.A,{className:"h-4 w-4"}),description:"去化速度與量能",requiresData:!0},{type:"sales-velocity-table",label:"銷售速度明細",icon:(0,r.jsx)(X.A,{className:"h-4 w-4"}),description:"詳細銷售數據",requiresData:!0},{type:"sales-heatmap",label:"房型面積熱力圖",icon:(0,r.jsx)(X.A,{className:"h-4 w-4"}),description:"坪數去化分佈",requiresData:!0}]},{id:"parking",title:"車位分析",items:[{type:"parking-pie",label:"房車配比",icon:(0,r.jsx)(Y.A,{className:"h-4 w-4"}),description:"有/無車位比例",requiresData:!0},{type:"parking-price",label:"車位均價",icon:(0,r.jsx)(H.A,{className:"h-4 w-4"}),description:"各類車位行情",requiresData:!0},{type:"parking-scatter",label:"車位坪數散佈",icon:(0,r.jsx)(_.A,{className:"h-4 w-4"}),description:"規模與價值分析",requiresData:!0},{type:"parking-floor",label:"樓層價差",icon:(0,r.jsx)(O.A,{className:"h-4 w-4"}),description:"地下室樓層價差",requiresData:!0}]},{id:"others",title:"其他",items:[{type:"data-list",label:"交易明細列表",icon:(0,r.jsx)(H.A,{className:"h-4 w-4"}),description:"原始交易數據",requiresData:!0}]}];function Z({onAddItem:e,hasData:t}){return(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[(0,r.jsx)("div",{className:"p-3 space-y-6",children:K.map(a=>(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"text-xs font-bold text-zinc-500 uppercase tracking-wider pl-1",children:a.title}),(0,r.jsx)("div",{className:"grid grid-cols-1 gap-1",children:a.items.map(a=>{let i=!1!==a.requiresData&&!t;return(0,r.jsxs)("button",{onClick:()=>e(a.type),disabled:i,className:(0,j.cn)("w-full p-1.5 rounded-md border text-left transition-all group relative overflow-hidden flex flex-row items-center gap-2.5",i?"bg-zinc-900/30 border-white/5 opacity-50 cursor-not-allowed":"bg-zinc-800/40 border-white/5 hover:bg-zinc-700/60 hover:border-violet-500/30 cursor-pointer"),children:[(0,r.jsx)("div",{className:(0,j.cn)("p-1.5 rounded flex-shrink-0 transition-colors",i?"bg-zinc-800 text-zinc-600":"bg-zinc-700/50 group-hover:bg-violet-500/20 text-zinc-400 group-hover:text-violet-300"),children:s.cloneElement(a.icon,{className:"h-3.5 w-3.5"})}),(0,r.jsx)("div",{className:"min-w-0 flex-1",children:(0,r.jsx)("div",{className:"text-[11px] font-medium text-zinc-300 group-hover:text-white truncate leading-tight",children:a.label})}),!i&&(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-transparent to-white/5 opacity-0 group-hover:opacity-100 transition-opacity"})]},a.type)})})]},a.id))}),!t&&(0,r.jsx)("div",{className:"text-center py-8 text-xs text-zinc-500 px-4",children:"已開啟封面規劃；其餘圖表需先載入儀表板數據。"})]})}var U=a(87256),G=a(39768),J=a(59883),V=a(33210),ee=a(44923);function et({id:e,name:t,index:a,isActive:s,canDelete:i,onClick:n,onDelete:l}){let{attributes:o,listeners:c,setNodeRef:d,transform:u,transition:h,isDragging:x}=(0,U.gl)({id:e}),{isOver:m,setNodeRef:p}=(0,ee.zM)({id:`page-tab-drop-${a}`,data:{type:"page-tab",pageIndex:a}}),g=(0,w.Q)(e=>e.hoveredPageIndex)===a,b={transform:G.Ks.Transform.toString(u),transition:h};return(0,r.jsxs)("div",{ref:e=>{d(e),p(e)},style:b,...o,...c,className:(0,j.cn)("px-3 h-8 rounded-lg text-xs font-semibold flex items-center gap-2 transition-all whitespace-nowrap group cursor-grab active:cursor-grabbing select-none border border-transparent shadow-sm",s?"bg-violet-600 text-white border-violet-400/30 shadow-violet-500/20":"bg-zinc-900/50 text-zinc-400 border-white/5 hover:bg-zinc-800 hover:text-zinc-100 hover:border-white/10",x&&"opacity-50 shadow-2xl z-50 scale-105",(m||g)&&!s&&"ring-2 ring-violet-500 bg-violet-600 text-white shadow-lg scale-110 z-50 origin-bottom"),onClick:e=>{x||n()},"data-page-drop-target":"true","data-page-index":a,children:[(0,r.jsx)(J.A,{className:"h-3 w-3 text-zinc-600 group-hover:text-zinc-400 transition-colors flex-shrink-0"}),(0,r.jsx)("span",{className:"truncate max-w-[100px]",children:t}),i&&(0,r.jsx)("button",{onPointerDown:e=>{e.stopPropagation()},onClick:e=>{e.stopPropagation(),l()},className:(0,j.cn)("ml-auto p-1 rounded-md hover:bg-red-500/30 text-zinc-500 hover:text-red-400 transition-all focus:outline-none",s?"opacity-70":"opacity-0 group-hover:opacity-100"),children:(0,r.jsx)(V.A,{className:"h-3 w-3"})})]})}function ea({pageIndex:e,isActive:t,children:a,onClick:s,onFocus:i}){let{setNodeRef:n,isOver:l}=(0,ee.zM)({id:`page-drop-${e}`,data:{pageIndex:e}});return(0,r.jsxs)("div",{ref:n,className:(0,j.cn)("relative group outline-none transition-transform duration-200",l&&"scale-[1.02]",t?"z-10":"z-0"),"data-page-drop-zone":"true","data-page-index":e,tabIndex:0,onFocus:i,onClick:s,children:[l&&(0,r.jsx)("div",{className:"absolute inset-0 bg-violet-500/10 border-2 border-violet-500/50 rounded-lg z-50 pointer-events-none animate-pulse"}),a]})}var er=a(82482),es=a(9199);function ei(){let e=(0,w.Q)(e=>e.zoomLevel),t=(0,w.Q)(e=>e.setZoomLevel),a=(0,w.Q)(e=>e.resetZoom),[i,n]=s.useState(String(e));s.useEffect(()=>{n(String(e))},[e]);let l=s.useCallback(()=>{let a=parseInt(i,10);Number.isFinite(a)?t(a):n(String(e))},[i,t,e]);return(0,r.jsxs)("div",{className:"flex items-center gap-1 bg-zinc-900/90 backdrop-blur-md border border-white/10 rounded-lg p-1 shadow-xl",children:[(0,r.jsx)(d.$,{size:"icon",variant:"ghost",className:"h-7 w-7 text-zinc-400 hover:text-white hover:bg-white/10",onClick:()=>t(e-10),title:"縮小 (Cmd + 滾輪)",children:(0,r.jsx)(er.A,{className:"h-4 w-4"})}),(0,r.jsx)("div",{className:"px-1 min-w-[4.5rem]",children:(0,r.jsxs)("div",{className:"flex items-center gap-1 rounded-md border border-white/10 bg-black/20 px-1.5 py-0.5",children:[(0,r.jsx)("input",{className:"w-10 bg-transparent text-center text-xs font-mono text-zinc-200 focus:outline-none",value:i,inputMode:"numeric",pattern:"[0-9]*",onChange:e=>{n(e.target.value.replace(/[^0-9]/g,""))},onBlur:l,onKeyDown:t=>{"Enter"===t.key&&t.currentTarget.blur(),"Escape"===t.key&&(n(String(e)),t.currentTarget.blur())},"aria-label":"縮放比例"}),(0,r.jsx)("span",{className:"text-[10px] text-zinc-400",children:"%"})]})}),(0,r.jsx)(d.$,{size:"icon",variant:"ghost",className:"h-7 w-7 text-zinc-400 hover:text-white hover:bg-white/10",onClick:()=>t(e+10),title:"放大 (Cmd + 滾輪)",children:(0,r.jsx)(f.A,{className:"h-4 w-4"})}),(0,r.jsx)("div",{className:"w-px h-4 bg-white/10 mx-1"}),(0,r.jsx)(d.$,{size:"icon",variant:"ghost",className:"h-7 w-7 text-zinc-400 hover:text-white hover:bg-white/10",onClick:a,title:"重置縮放 (100%)",children:(0,r.jsx)(es.A,{className:"h-3.5 w-3.5"})})]})}var en=a(51806),el=a(60529),eo=a(17243),ec=a(484);function ed({isOpen:e,onClose:t,onExport:a,format:i}){let n=(0,w.Q)(e=>e.pages),l=(0,w.Q)(e=>e.currentPageIndex),[o,c]=(0,s.useState)("all"),[h,x]=(0,s.useState)({start:1,end:n.length});return(0,r.jsx)(en.a,{isOpen:e,onClose:t,title:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"p-2 rounded-lg bg-emerald-500/10 text-emerald-400",children:(0,r.jsx)(eo.A,{className:"h-5 w-5"})}),(0,r.jsxs)("span",{className:"text-xl",children:["匯出 ",i.toUpperCase()," 圖片"]})]}),maxWidth:"max-w-md",children:(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,r.jsxs)("button",{onClick:()=>c("all"),className:`flex items-center gap-4 p-4 rounded-xl border transition-all text-left ${"all"===o?"bg-emerald-500/10 border-emerald-500/50 ring-1 ring-emerald-500/50":"bg-zinc-900/50 border-white/5 hover:border-white/10"}`,children:[(0,r.jsx)("div",{className:`p-2 rounded-lg ${"all"===o?"bg-emerald-500/20 text-emerald-400":"bg-zinc-800 text-zinc-400"}`,children:(0,r.jsx)(u.A,{className:"h-5 w-5"})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"font-medium text-white",children:["全部頁面 (",n.length," 頁)"]}),(0,r.jsx)("div",{className:"text-xs text-zinc-500",children:"匯出所有報告頁面"})]})]}),(0,r.jsxs)("button",{onClick:()=>c("current"),className:`flex items-center gap-4 p-4 rounded-xl border transition-all text-left ${"current"===o?"bg-emerald-500/10 border-emerald-500/50 ring-1 ring-emerald-500/50":"bg-zinc-900/50 border-white/5 hover:border-white/10"}`,children:[(0,r.jsx)("div",{className:`p-2 rounded-lg ${"current"===o?"bg-emerald-500/20 text-emerald-400":"bg-zinc-800 text-zinc-400"}`,children:(0,r.jsx)(eo.A,{className:"h-5 w-5"})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"font-medium text-white",children:["僅限目前頁面 (第 ",l+1," 頁)"]}),(0,r.jsx)("div",{className:"text-xs text-zinc-500",children:"僅匯出當前正編輯的頁面"})]})]}),(0,r.jsxs)("button",{onClick:()=>c("range"),className:`flex items-center gap-4 p-4 rounded-xl border transition-all text-left ${"range"===o?"bg-emerald-500/10 border-emerald-500/50 ring-1 ring-emerald-500/50":"bg-zinc-900/50 border-white/5 hover:border-white/10"}`,children:[(0,r.jsx)("div",{className:`p-2 rounded-lg ${"range"===o?"bg-emerald-500/20 text-emerald-400":"bg-zinc-800 text-zinc-400"}`,children:(0,r.jsx)(ec.A,{className:"h-5 w-5"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-medium text-white",children:"指定範圍"}),(0,r.jsx)("div",{className:"text-xs text-zinc-500",children:"自定義要匯出的頁碼範圍"})]})]})]}),"range"===o&&(0,r.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-zinc-950/50 rounded-xl border border-white/5 animate-in fade-in slide-in-from-top-2 duration-200",children:[(0,r.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,r.jsx)("label",{className:"text-[10px] uppercase tracking-wider text-zinc-500 font-bold ml-1",children:"起始頁碼"}),(0,r.jsx)(el.p,{type:"number",min:1,max:n.length,value:h.start,onChange:e=>x(t=>({...t,start:parseInt(e.target.value)||1})),className:"bg-zinc-900 border-white/5 h-10"})]}),(0,r.jsx)("div",{className:"text-zinc-700 mt-5",children:"至"}),(0,r.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,r.jsx)("label",{className:"text-[10px] uppercase tracking-wider text-zinc-500 font-bold ml-1",children:"結束頁碼"}),(0,r.jsx)(el.p,{type:"number",min:1,max:n.length,value:h.end,onChange:e=>x(t=>({...t,end:parseInt(e.target.value)||1})),className:"bg-zinc-900 border-white/5 h-10"})]})]}),(0,r.jsxs)("div",{className:"pt-2 flex gap-3",children:[(0,r.jsx)(d.$,{variant:"outline",onClick:t,className:"flex-1 bg-zinc-900 border-white/5",children:"取消"}),(0,r.jsx)(d.$,{onClick:()=>{let e=[];if("all"===o)e=n.map((e,t)=>t);else if("current"===o)e=[l];else if("range"===o){let t=Math.max(0,h.start-1),a=Math.min(n.length-1,h.end-1);for(let r=t;r<=a;r++)e.push(r)}a(e)},className:"flex-1 bg-emerald-600 hover:bg-emerald-500 text-white border-none shadow-lg shadow-emerald-900/20",children:"開始匯出"})]})]})})}var eu=a(70872);function eh({selectedIds:e,onScaleAdjust:t,onScaleReset:a,onScaleSet:i,onDelete:n}){let l=(0,w.Q)(e=>e.pages),o=(0,w.Q)(e=>e.currentPageIndex),[c,u]=s.useState(""),h=e.length>0,x=h?l[o]?.items.find(t=>t.id===e[0]):void 0,m=x?.contentScale??1,g=!!h&&e.some(e=>{let t=l[o]?.items.find(t=>t.id===e);return t&&(t.contentScale??1)!==m});s.useEffect(()=>{h?g?u(""):u(String(Math.round(100*m))):u("")},[m,g,h,e.join(",")]);let b=()=>{let e=Number(c);Number.isFinite(e)?i(e):u(g?"":String(Math.round(100*m)))};return h?(0,r.jsx)("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 z-50",children:(0,r.jsxs)("div",{className:"bg-zinc-900/90 backdrop-blur-xl border border-white/10 rounded-full p-2 shadow-2xl flex items-center gap-2 ring-1 ring-black/50",children:[(0,r.jsxs)("div",{className:"text-[10px] text-zinc-500 font-medium px-3 border-r border-white/10 select-none",children:[e.length," 選取"]}),(0,r.jsx)(eu.Bc,{delayDuration:0,children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1 bg-zinc-950/50 border border-white/10 rounded-full px-2 py-1",children:[(0,r.jsx)("span",{className:"text-[10px] text-zinc-500 font-medium px-1",children:"內容縮放"}),(0,r.jsx)(d.$,{size:"icon",variant:"ghost",onClick:()=>t(-.1),className:"h-7 w-7 rounded-full text-zinc-300 hover:text-white hover:bg-white/10",title:"縮小內容",children:(0,r.jsx)(er.A,{className:"h-3.5 w-3.5"})}),(0,r.jsxs)("div",{className:"flex items-center gap-1 px-3 py-1.5 bg-zinc-900/80 border border-white/15 rounded-full shadow-inner",title:"輸入縮放百分比",children:[(0,r.jsx)("input",{type:"number",inputMode:"decimal",value:c,onChange:e=>u(e.target.value),onBlur:b,onFocus:e=>e.currentTarget.select(),onKeyDown:e=>{"Enter"===e.key&&(b(),e.target.blur())},placeholder:g?"多值":void 0,className:"w-20 bg-transparent text-right text-sm text-zinc-100 outline-none"}),(0,r.jsx)("span",{className:"text-xs text-zinc-400",children:"%"})]}),(0,r.jsx)(d.$,{size:"icon",variant:"ghost",onClick:()=>t(.1),className:"h-7 w-7 rounded-full text-zinc-300 hover:text-white hover:bg-white/10",title:"放大內容",children:(0,r.jsx)(f.A,{className:"h-3.5 w-3.5"})})]}),(0,r.jsxs)(eu.m_,{children:[(0,r.jsx)(eu.k$,{asChild:!0,children:(0,r.jsx)(d.$,{size:"sm",variant:"ghost",onClick:n,className:"h-8 px-3 rounded-full text-zinc-400 hover:text-red-400 hover:bg-red-500/10 transition-all duration-200",children:(0,r.jsx)(p.A,{className:"h-3.5 w-3.5"})})}),(0,r.jsx)(eu.ZI,{side:"top",className:"text-xs bg-zinc-900 border-white/10 text-red-400",children:"刪除選中元件"})]})]})})]})}):null}var ex=a(92669),em=a(23770),ep=a(61742),eg=a(45916),eb=a(16869),ef=a(41933),ev=a(38194),ej=a(77314),ew=a(20986);let eN=null,ey=!1;function ez({selectedIds:e}){let t=(0,w.Q)(e=>e.pages),a=(0,w.Q)(e=>e.currentPageIndex),s=(t[a]?.items||[]).filter(t=>e.includes(t.id)&&"text-box"===t.type);return 1!==s.length?null:(0,r.jsx)(ek,{item:s[0]})}function ek({item:e}){let t=(0,w.Q)(e=>e.updateItem),a=(0,w.Q)(e=>e.zoomLevel),i=e.data||{},n=i.fontFamily||'"Noto Sans TC", "PingFang TC", "Microsoft JhengHei", system-ui, sans-serif',l=Number(i.fontSize??i.size??18),o=Number(i.maxFontSize??i.fontSize??i.size??18),c=Number(i.fontWeight??i.weight??500),d=!!i.italic,u=!!i.underline,h=i.color||"#e4e4e7",x=i.align||"left",m=i.verticalAlign||"top",p=!0===i.autoFit,g=!1!==i.autoGrow,b=Number(i.rotation||0),f=s.useRef(null),[v,N]=s.useState(()=>eN??{x:0,y:0}),[y,S]=s.useState(ey),C=s.useCallback(e=>{let t=f.current;if(!t)return e;let a=t.getBoundingClientRect(),r=window.innerWidth-a.width-8,s=window.innerHeight-a.height-8;return{x:Math.max(8,Math.min(e.x,r)),y:Math.max(8,Math.min(e.y,s))}},[]),A=s.useCallback(()=>{let e=document.querySelector('[data-active-canvas="true"]'),t=f.current;if(!e||!t)return null;let a=e.getBoundingClientRect(),r=t.getBoundingClientRect();return C({x:a.right-r.width-8,y:a.top+(a.height-r.height)/2})},[C]);s.useLayoutEffect(()=>{if(y)return;let e=requestAnimationFrame(()=>{let e=A();e&&(N(e),eN=e)});return()=>cancelAnimationFrame(e)},[A,y,a]),s.useEffect(()=>{let e=()=>{N(e=>C(e))};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[C]);let D=a=>{t(e.id,{data:{...i,...a}})},M=t=>{let a=Array.from(document.querySelectorAll('[contenteditable="true"][data-text-box-id]')).find(t=>t.getAttribute("data-text-box-id")===e.id);a&&(a.focus(),document.execCommand("ul"===t?"insertUnorderedList":"insertOrderedList"),D({html:a.innerHTML}))};return(0,r.jsx)(z.p,{position:v,enableResizing:!1,bounds:"window",dragHandleClassName:"text-box-toolbar-handle",style:{position:"fixed"},onDragStop:(e,t)=>{let a=C({x:t.x,y:t.y});N(a),eN=a,ey=!0,S(!0)},className:"z-50",children:(0,r.jsxs)("div",{ref:f,"data-report-control":"hide",className:"w-48 flex flex-col rounded-xl border border-white/10 bg-zinc-900/95 backdrop-blur-md shadow-2xl shadow-black/50",children:[(0,r.jsxs)("div",{className:"text-box-toolbar-handle flex items-center gap-2 px-3 py-2 border-b border-white/10 text-[11px] text-zinc-300 cursor-move select-none",children:[(0,r.jsx)(k.A,{className:"h-3.5 w-3.5"}),"文字工具"]}),(0,r.jsxs)("div",{className:"px-3 py-3 flex flex-col gap-3",children:[(0,r.jsx)("div",{className:"text-[10px] text-zinc-400",children:"字體"}),(0,r.jsxs)("select",{value:n,onChange:e=>D({fontFamily:e.target.value}),className:"w-full bg-zinc-950/70 border border-white/10 rounded px-2 py-1.5 text-xs text-zinc-200",children:[(0,r.jsx)("option",{value:'"Noto Sans TC", "PingFang TC", "Microsoft JhengHei", system-ui, sans-serif',children:"思源黑體"}),(0,r.jsx)("option",{value:'"Noto Serif TC", "Songti TC", serif',children:"宋體"}),(0,r.jsx)("option",{value:'"Inter", system-ui, sans-serif',children:"Inter"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between text-[10px] text-zinc-400",children:[(0,r.jsx)("span",{children:"字級"}),(0,r.jsx)("input",{type:"number",value:l,onChange:e=>((e,t=!0)=>{let a=Math.max(8,Math.min(200,e));D({fontSize:a,maxFontSize:t?a:o})})(Number(e.target.value)),className:"w-20 bg-zinc-950/70 border border-white/10 rounded px-2 py-1 text-xs text-zinc-200 text-right",title:"字級"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-1",children:[(0,r.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>D({fontWeight:c>=700?500:700}),className:(0,j.cn)("h-8 rounded border text-xs",c>=700?"border-cyan-400 text-cyan-300":"border-white/10 text-zinc-400"),title:"粗體",children:(0,r.jsx)(ex.A,{className:"w-4 h-4 mx-auto"})}),(0,r.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>D({italic:!d}),className:(0,j.cn)("h-8 rounded border text-xs",d?"border-cyan-400 text-cyan-300":"border-white/10 text-zinc-400"),title:"斜體",children:(0,r.jsx)(em.A,{className:"w-4 h-4 mx-auto"})}),(0,r.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>D({underline:!u}),className:(0,j.cn)("h-8 rounded border text-xs",u?"border-cyan-400 text-cyan-300":"border-white/10 text-zinc-400"),title:"底線",children:(0,r.jsx)(ep.A,{className:"w-4 h-4 mx-auto"})})]}),(0,r.jsx)("div",{className:"text-[10px] text-zinc-400",children:"顏色"}),(0,r.jsx)("input",{type:"color",value:h,onChange:e=>D({color:e.target.value}),className:"h-8 w-full bg-transparent border border-white/10 rounded",title:"文字顏色"}),(0,r.jsx)("div",{className:"text-[10px] text-zinc-400",children:"對齊"}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-1",children:[(0,r.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>D({align:"left"}),className:(0,j.cn)("h-8 rounded border","left"===x?"border-cyan-400 text-cyan-300":"border-white/10 text-zinc-400"),title:"靠左",children:(0,r.jsx)(eg.A,{className:"w-4 h-4 mx-auto"})}),(0,r.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>D({align:"center"}),className:(0,j.cn)("h-8 rounded border","center"===x?"border-cyan-400 text-cyan-300":"border-white/10 text-zinc-400"),title:"置中",children:(0,r.jsx)(eb.A,{className:"w-4 h-4 mx-auto"})}),(0,r.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>D({align:"right"}),className:(0,j.cn)("h-8 rounded border","right"===x?"border-cyan-400 text-cyan-300":"border-white/10 text-zinc-400"),title:"靠右",children:(0,r.jsx)(ef.A,{className:"w-4 h-4 mx-auto"})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-1",children:[(0,r.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>M("ul"),className:"h-8 rounded border border-white/10 text-zinc-400",title:"項目符號",children:(0,r.jsx)(ev.A,{className:"w-4 h-4 mx-auto"})}),(0,r.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>M("ol"),className:"h-8 rounded border border-white/10 text-zinc-400",title:"編號",children:(0,r.jsx)(ej.A,{className:"w-4 h-4 mx-auto"})})]}),(0,r.jsxs)("select",{value:m,onChange:e=>D({verticalAlign:e.target.value}),className:"w-full bg-zinc-950/70 border border-white/10 rounded px-2 py-1.5 text-xs text-zinc-200",title:"垂直對齊",children:[(0,r.jsx)("option",{value:"top",children:"靠上"}),(0,r.jsx)("option",{value:"middle",children:"置中"}),(0,r.jsx)("option",{value:"bottom",children:"靠下"})]}),(0,r.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>{let e=!p;D({autoFit:e,autoGrow:!e,fontSize:e?l:o})},className:(0,j.cn)("w-full px-2 py-1.5 rounded border text-xs",p?"border-cyan-400 text-cyan-300":"border-white/10 text-zinc-400"),title:p?"自動縮放（文字溢出時縮小）":g?"自動放大（內容變多時放大方塊）":"自動縮放",children:p?"Auto-Fit":"Auto-Grow"}),(0,r.jsx)("div",{className:"text-[10px] text-zinc-400",children:"旋轉"}),(0,r.jsxs)("div",{className:"grid grid-cols-[1fr,2fr,1fr] gap-1",children:[(0,r.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>D({rotation:b-15}),className:"h-8 rounded border border-white/10 text-zinc-400",title:"逆時針旋轉",children:(0,r.jsx)(es.A,{className:"w-4 h-4 mx-auto"})}),(0,r.jsx)("input",{type:"number",value:b,onChange:e=>D({rotation:Number(e.target.value)||0}),className:"h-8 bg-zinc-950/70 border border-white/10 rounded px-2 py-1 text-xs text-zinc-200 text-center",title:"旋轉角度"}),(0,r.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>D({rotation:b+15}),className:"h-8 rounded border border-white/10 text-zinc-400",title:"順時針旋轉",children:(0,r.jsx)(ew.A,{className:"w-4 h-4 mx-auto"})})]})]})]})})}let eS=(0,c.i)(function(){let{loading:e,analysisData:t}=(0,o.g)(),i=(0,w.Q)(e=>e.pages),c=(0,w.Q)(e=>e.currentPageIndex),N=(0,w.Q)(e=>e.canvasRatio),z=(0,w.Q)(e=>e.viewMode),k=(0,w.Q)(e=>e.setViewMode),S=(0,w.Q)(e=>e.selectedIds),A=(0,w.Q)(e=>e.addItem),M=(0,w.Q)(e=>e.addItems),$=(0,w.Q)(e=>e.updateItem),Q=(0,w.Q)(e=>e.removeItem),R=(0,w.Q)(e=>e.clearCanvas),P=(0,w.Q)(e=>e.setCanvasRatio),E=(0,w.Q)(e=>e.setSelectedIds),I=(0,w.Q)(e=>e.toggleSelection),L=(0,w.Q)(e=>e.addToSelection),T=(0,w.Q)(e=>e.clearSelection),F=(0,w.Q)(e=>e.removeSelectedItems);(0,w.Q)(e=>e.moveSelectedItemsToPage);let B=(0,w.Q)(e=>e.addPage),_=(0,w.Q)(e=>e.deletePage),H=(0,w.Q)(e=>e.renamePage),X=(0,w.Q)(e=>e.setCurrentPage),Y=(0,w.Q)(e=>e.reorderPages),W=(0,w.Q)(e=>e.moveItemToPage),O=(0,w.Q)(e=>e.batchUpdateItems),K=s.useRef([]),G=s.useRef(0),[J,V]=(0,s.useState)(null),er=(0,w.Q)(e=>e.isDragging),es=(0,w.Q)(e=>e.draggedItemCount),en=(0,w.Q)(e=>e.hoveredPageIndex),[el,eo]=(0,s.useState)({x:0,y:0}),[ec,eu]=(0,s.useState)(!0),ex=(0,w.Q)(e=>e.zoomLevel),em=(0,w.Q)(e=>e.setZoomLevel),ep=s.useRef(null),eg=s.useRef(null),[eb,ef]=(0,s.useState)(!1),[ev,ej]=(0,s.useState)(!1),ew=s.useRef(null),eN="continuous"===z||eb,[ey,ek]=(0,s.useState)(!1),[eS,eC]=(0,s.useState)("png"),[eA,eD]=(0,s.useState)(!1),[eM,e$]=(0,s.useState)({current:0,total:0});s.useEffect(()=>{let e=e=>{er&&eo({x:e.clientX,y:e.clientY})},t=e=>{if(document.activeElement?.tagName==="INPUT"||document.activeElement?.tagName==="TEXTAREA"||document.activeElement?.isContentEditable)return;let t=e.metaKey||e.ctrlKey,a=e.key.toLowerCase(),r=(i[c]?.items||[]).filter(e=>S.includes(e.id));if(t&&"c"===a){if(0===r.length)return;e.preventDefault(),K.current=r.map(e=>({...e,data:e.data?JSON.parse(JSON.stringify(e.data)):e.data})),G.current=0;return}if(t&&"x"===a){if(0===r.length)return;e.preventDefault(),K.current=r.map(e=>({...e,data:e.data?JSON.parse(JSON.stringify(e.data)):e.data})),G.current=0,F();return}if(t&&"v"===a){if(0===K.current.length)return;e.preventDefault();let t=20+G.current;G.current+=20,M(K.current.map((e,a)=>{let r=`item-${Date.now()}-${a}`;return{...e,id:r,x:e.x+t,y:e.y+t}}));return}("Delete"===e.key||"Backspace"===e.key)&&S.length>0&&(e.preventDefault(),F())};return window.addEventListener("mousemove",e),window.addEventListener("keydown",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("keydown",t)}},[er,S,F,k,i,c,M]);let eQ=e=>Math.min(10,Math.max(.1,e)),eR=(0,s.useCallback)(e=>{let t={},a=i[c]?.items||[];S.forEach(r=>{let s=a.find(e=>e.id===r);if(!s)return;let i=eQ((s.contentScale||1)+e);t[r]={contentScale:Number(i.toFixed(2))}}),O(t)},[S,O,i,c]),eP=(0,s.useCallback)(()=>{let e={};S.forEach(t=>{e[t]={contentScale:1}}),O(e)},[S,O]),eE=(0,s.useCallback)(e=>{let t={},a=eQ(e/100);S.forEach(e=>{t[e]={contentScale:Number(a.toFixed(2))}}),O(t)},[S,O]),eI=(0,ee.FR)((0,ee.MS)(ee.AN,{activationConstraint:{distance:5}})),eL=i[c],eT=eL?.items||[],eF=e=>e.some(e=>"cover-template"===e.type),eq="16:9"===N?{width:960,height:540}:"A4"===N?{width:595,height:842}:"1:1"===N?{width:900,height:900}:"9:16"===N?{width:540,height:960}:{width:720,height:900},eB=(0,s.useCallback)(e=>{A(e)},[A]),e_=(0,s.useCallback)((e,t)=>{$(e,t)},[$]),eH=(0,s.useCallback)(e=>{Q(e)},[Q]),eX=(0,s.useCallback)(()=>{B()},[B]),eY=(0,s.useCallback)(e=>{!(i.length<=1)&&confirm("確定要刪除此頁面嗎？")&&_(e)},[_,i.length]);s.useEffect(()=>{let e=ep.current;"continuous"===z&&"continuous"!==e&&em(ev?110:60),"single"===z&&"single"!==e&&em(ev?150:100),ep.current=z},[z,ev,ex,em,60,100,110,150]),s.useEffect(()=>{eb||("single"===z?em(ev?150:100):"continuous"===z&&em(ev?110:60))},[ev,z,eb,em,60,100,110,150]),s.useEffect(()=>{"continuous"===z&&(null!==eg.current&&(cancelAnimationFrame(eg.current),eg.current=null),eb&&ef(!1))},[z,eb]),s.useEffect(()=>()=>{null!==eg.current&&cancelAnimationFrame(eg.current)},[]),s.useEffect(()=>{let e=()=>{let e=document;ej(!!(e.fullscreenElement||e.webkitFullscreenElement))};return document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),e(),()=>{document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e)}},[]);let eW=(0,s.useCallback)(async()=>{let e=ew.current;if(!e)return;let t=document,a=!!(t.fullscreenElement||t.webkitFullscreenElement);try{a?t.exitFullscreen?await t.exitFullscreen():t.webkitExitFullscreen&&await t.webkitExitFullscreen():e.requestFullscreen?await e.requestFullscreen():e.webkitRequestFullscreen&&await e.webkitRequestFullscreen()}catch(e){console.error("Fullscreen toggle failed:",e)}},[]),eO=(0,s.useCallback)(()=>{let e=w.Q.getState(),t=C.P.getState(),a=D({counties:t.counties,districts:t.districts,transactionType:t.transactionType,buildingType:t.buildingType,projectNames:t.projectNames,dateRange:t.dateRange,startDate:t.startDate,endDate:t.endDate,excludeCommercial:t.excludeCommercial}),r=e.pages[0];if(!r)return;let s=r.items.some(e=>"cover-template"===e.type),i=r.items.some(e=>"cover-template"!==e.type);if(!s&&i&&!confirm("第一頁已有內容，規劃封面會先清空第一頁。是否繼續？"))return;e.setCurrentPage(0),e.clearSelection(),s||(e.clearCanvas(),e.addItem("cover-template"));let n=w.Q.getState().pages[0],l=n?.items.filter(e=>"cover-template"===e.type).slice(-1)[0];if(l){let t=l.data||{};e.updateItem(l.id,{x:0,y:0,width:eq.width,height:eq.height,data:{...t,logoText:"string"==typeof t.logoText?t.logoText:"平米內參",searchConditions:a}}),e.setSelectedIds([l.id])}H(r.id,"封面")},[eq.height,eq.width,H]),eK=(0,s.useCallback)(e=>{String(e.active.id).startsWith("item-")&&V(String(e.active.id))},[]),eZ=(0,s.useCallback)(e=>{let{active:t,over:a}=e;if(V(null),!a)return;if(String(t.id).startsWith("page-")&&String(a.id).startsWith("page-")){let e=i.findIndex(e=>e.id===t.id),r=i.findIndex(e=>e.id===a.id);-1!==e&&-1!==r&&e!==r&&Y(e,r)}let r=String(a.id);if(String(t.id).startsWith("item-")){let e=-1;r.startsWith("page-drop-")?e=parseInt(r.replace("page-drop-",""),10):r.startsWith("page-tab-drop-")&&(e=parseInt(r.replace("page-tab-drop-",""),10)),-1===e||isNaN(e)||(W(String(t.id),e),X(e))}},[i,Y,W,X]),eU=(0,s.useCallback)(()=>{let e=document.querySelector(".report-canvas-content");if(!e)return;let t=window.open("","_blank");if(!t)return;let a=Array.from(document.styleSheets).map(e=>{try{return Array.from(e.cssRules).map(e=>e.cssText).join("")}catch(e){return""}}).join(""),r="16:9"===N?{width:960,height:540}:{width:842,height:595};t.document.write(`
            <html>
                <head>
                    <title>SQM Report - ${new Date().toLocaleDateString()}</title>
                    <style>
                        ${a}
                        @media print {
                            @page {
                                size: ${"A4"===N?"A4 landscape":"960px 540px"};
                                margin: 0;
                            }
                            body { margin: 0; padding: 0; background: #09090b !important; -webkit-print-color-adjust: exact; }
                            .print-canvas {
                                width: ${r.width}px;
                                height: ${r.height}px;
                                position: relative;
                                background: #09090b;
                                overflow: hidden;
                            }
                            .rnd-resizer, .no-print { display: none !important; }
                            .report-builder-item-header { display: none !important; }
                            .report-builder-item {
                                background: transparent !important;
                                border: 0 !important;
                                box-shadow: none !important;
                                border-radius: 0 !important;
                                backdrop-filter: none !important;
                            }
                            .report-builder-item-content {
                                padding: 0 !important;
                                height: 100% !important;
                            }
                        }
                    </style>
                </head>
                <body>
                    <div class="print-canvas">
                        ${e.innerHTML}
                    </div>
                    <script>
                        window.onload = () => {
                            setTimeout(() => {
                                window.print();
                            }, 1000);
                        };
                    </script>
                </body>
            </html>
        `),t.document.close()},[N]),eG=(0,s.useCallback)(e=>{eC(e),ek(!0)},[]),eJ=(0,s.useCallback)(async e=>{ek(!1),eD(!0),e$({current:0,total:e.length});let t=w.Q.getState().currentPageIndex,r=w.Q.getState().viewMode;try{let{domToPng:t,domToJpeg:r}=await Promise.resolve().then(a.bind(a,98028));for(let a=0;a<e.length;a++){let s,i=e[a];e$({current:a+1,total:e.length}),w.Q.getState().setCurrentPage(i),await new Promise(e=>setTimeout(e,500));let n=document.querySelector(".report-canvas-content");if(!n){console.error(`Canvas element not found for page ${i}`);continue}let l=eq.width,o=eq.height,c={scale:2,backgroundColor:"#09090b",width:l,height:o,style:{transform:"none",width:`${l}px`,height:`${o}px`}};s="png"===eS?await t(n,c):await r(n,{...c,quality:.95});let d=document.createElement("a");d.download=`SQM-Report-P${i+1}-${new Date().getTime()}.${eS}`,d.href=s,d.click()}}catch(e){console.error("Batch export failed:",e),alert("批次匯出失敗，部分頁面可能未完成。")}finally{w.Q.getState().setCurrentPage(t),w.Q.getState().setViewMode(r),eD(!1)}},[eq,eS]),eV=(0,s.useCallback)(()=>{confirm("確定要清空當前頁面的所有元件嗎？")&&R()},[R]),e0=i.some(e=>e.items.some(e=>"cover-template"===e.type));return(0,r.jsxs)(l.e,{children:[(0,r.jsxs)(ee.Mp,{sensors:eI,collisionDetection:ee.fp,onDragStart:eK,onDragEnd:eZ,children:[(0,r.jsxs)("div",{ref:ew,"data-report-builder":"true",className:(0,j.cn)("flex gap-2 overflow-hidden",ev?"h-screen w-screen p-2 bg-zinc-950":"h-[calc(100vh-theme(spacing.14))]"),children:[(0,r.jsx)(eh,{selectedIds:S,onScaleAdjust:eR,onScaleReset:eP,onScaleSet:eE,onDelete:F}),(0,r.jsx)(ez,{selectedIds:S}),(0,r.jsxs)("aside",{className:(0,j.cn)("w-48 flex-shrink-0 bg-zinc-900/50 border border-white/5 overflow-hidden flex flex-col",ev?"rounded-none":"rounded-xl"),children:[(0,r.jsx)("div",{className:"p-3 border-b border-white/5 bg-zinc-900",children:(0,r.jsxs)("h2",{className:"font-semibold text-white flex items-center gap-2 text-sm",children:[(0,r.jsx)(u.A,{className:"h-4 w-4 text-violet-400"}),"元件庫"]})}),(0,r.jsx)(Z,{onAddItem:eB,hasData:!!t})]}),(0,r.jsxs)("main",{className:(0,j.cn)("flex-1 bg-zinc-950 overflow-hidden flex flex-col relative",ev?"rounded-none":"rounded-xl"),children:[(0,r.jsxs)("div",{className:"h-14 border-b border-white/5 flex items-center justify-between px-4 bg-zinc-900/90 gap-4 overflow-x-auto no-scrollbar",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 flex-shrink-0",children:[(0,r.jsxs)("span",{className:"text-sm font-medium text-zinc-400 whitespace-nowrap",children:["報表編輯器 ",(0,r.jsx)("span",{className:"text-zinc-600",children:"|"})," 第 ",c+1,"/",i.length," 頁"]}),(0,r.jsx)("div",{className:"h-4 w-px bg-white/10"}),(0,r.jsx)("div",{className:"flex items-center gap-1 bg-zinc-900 border border-white/10 rounded-lg p-0.5",children:["16:9","A4","1:1","9:16","4:5"].map(e=>(0,r.jsxs)(d.$,{size:"sm",variant:"ghost",onClick:()=>P(e),className:(0,j.cn)("h-7 px-2 text-[10px] gap-1.5 rounded-md",N===e?"bg-violet-600 text-white shadow-sm":"text-zinc-400 hover:text-zinc-200 hover:bg-white/5"),title:e,children:["16:9"===e&&(0,r.jsx)("div",{className:"w-3.5 h-2 border border-current rounded-[1px]"}),"A4"===e&&(0,r.jsx)("div",{className:"w-2.5 h-3.5 border border-current rounded-[1px]"}),"1:1"===e&&(0,r.jsx)("div",{className:"w-3 h-3 border border-current rounded-[1px]"}),"9:16"===e&&(0,r.jsx)("div",{className:"w-2 h-3.5 border border-current rounded-[1px]"}),"4:5"===e&&(0,r.jsx)("div",{className:"w-2.5 h-3 border border-current rounded-[1px]"}),(0,r.jsx)("span",{className:"font-medium",children:e})]},e))})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[(0,r.jsxs)("div",{className:"bg-zinc-900 border border-white/10 rounded-lg p-0.5 flex",children:[(0,r.jsx)(d.$,{size:"icon",variant:"ghost",onClick:()=>k("single"),className:(0,j.cn)("h-7 w-7 rounded-md","single"===z?"bg-white/10 text-white":"text-zinc-500 hover:text-white"),title:"單頁模式",children:(0,r.jsx)("div",{className:"w-3 h-4 border border-current rounded-[1px]"})}),(0,r.jsx)(d.$,{size:"icon",variant:"ghost",onClick:()=>k("continuous"),className:(0,j.cn)("h-7 w-7 rounded-md","continuous"===z?"bg-white/10 text-white":"text-zinc-500 hover:text-white"),title:"多頁模式",children:(0,r.jsxs)("div",{className:"flex flex-col gap-[1px]",children:[(0,r.jsx)("div",{className:"w-3 h-2 border border-current rounded-[1px]"}),(0,r.jsx)("div",{className:"w-3 h-2 border border-current rounded-[1px]"})]})})]}),(0,r.jsx)(d.$,{size:"icon",variant:"ghost",onClick:eW,className:"h-7 w-7 rounded-md text-zinc-500 hover:text-white",title:ev?"離開全螢幕":"全螢幕",children:ev?(0,r.jsx)(h.A,{className:"h-4 w-4"}):(0,r.jsx)(x.A,{className:"h-4 w-4"})}),(0,r.jsx)(ei,{}),(0,r.jsx)("div",{className:"h-4 w-px bg-white/10 mx-1"}),(0,r.jsxs)(d.$,{size:"sm",className:"bg-emerald-600/90 hover:bg-emerald-600 h-8 text-xs gap-1.5 px-3",disabled:0===eT.length,onClick:eU,children:[(0,r.jsx)(m.A,{className:"h-3.5 w-3.5"}),"PDF"]}),(0,r.jsxs)("div",{className:"flex bg-zinc-800/50 rounded-lg border border-white/5 p-0.5",children:[(0,r.jsx)(d.$,{size:"sm",variant:"ghost",className:"h-7 text-[10px] px-2 text-emerald-400 hover:bg-emerald-500/10 hover:text-emerald-300",disabled:0===eT.length,onClick:()=>eG("png"),children:"PNG"}),(0,r.jsx)("div",{className:"w-px bg-white/5 my-1"}),(0,r.jsx)(d.$,{size:"sm",variant:"ghost",className:"h-7 text-[10px] px-2 text-emerald-400 hover:bg-emerald-500/10 hover:text-emerald-300",disabled:0===eT.length,onClick:()=>eG("jpg"),children:"JPG"})]}),(0,r.jsx)(d.$,{variant:"ghost",size:"icon",className:"h-8 w-8 text-zinc-500 hover:text-red-400 hover:bg-red-500/10 rounded-lg ml-1",disabled:0===eT.length,onClick:eV,title:"清空畫布",children:(0,r.jsx)(p.A,{className:"h-4 w-4"})})]})]}),(0,r.jsxs)("div",{className:"h-10 border-b border-white/5 flex items-center px-2 bg-zinc-900/50 gap-1 overflow-x-auto",children:[(0,r.jsx)(d.$,{size:"icon",variant:"ghost",className:"h-7 w-7 flex-shrink-0",onClick:()=>X(c-1),disabled:0===c,children:(0,r.jsx)(g.A,{className:"h-4 w-4"})}),(0,r.jsx)(U.gB,{items:i.map(e=>e.id),strategy:U.m$,children:i.map((e,t)=>(0,r.jsx)(et,{id:e.id,name:e.name,index:t,isActive:t===c,canDelete:i.length>1,onClick:()=>X(t),onDelete:()=>eY(e.id)},e.id))}),(0,r.jsx)(d.$,{size:"icon",variant:"ghost",className:"h-7 w-7 flex-shrink-0",onClick:()=>X(c+1),disabled:c===i.length-1,children:(0,r.jsx)(b.A,{className:"h-4 w-4"})}),(0,r.jsxs)(d.$,{size:"sm",variant:"ghost",className:"h-7 px-2 text-violet-400 hover:text-violet-300 hover:bg-violet-500/10 flex-shrink-0",onClick:eX,children:[(0,r.jsx)(f.A,{className:"h-4 w-4 mr-1"}),"新增頁面"]}),(0,r.jsxs)(d.$,{size:"sm",variant:"ghost",className:"h-7 px-2 text-cyan-400 hover:text-cyan-300 hover:bg-cyan-500/10 flex-shrink-0",onClick:eO,children:[(0,r.jsx)(v.A,{className:"h-4 w-4 mr-1"}),"規劃封面"]})]}),(0,r.jsx)("div",{className:"flex-1 p-4 flex flex-col items-center justify-center bg-zinc-950/50 overflow-hidden relative",onWheel:e=>{if(e.ctrlKey||e.metaKey){e.preventDefault();let t=e.deltaY>0?-10:10,a=Math.min(Math.max(w.Q.getState().zoomLevel+t,10),200);w.Q.getState().setZoomLevel(a)}},children:t||e||e0?(0,r.jsx)("div",{className:"relative w-full h-full flex items-center justify-center",style:{perspective:eN?"1200px":void 0},children:i.map((e,a)=>{let s=a-c;if(!eN&&0!==s||eN&&Math.abs(s)>2)return null;let i=0===s,n=1===Math.abs(s),l=((e,t)=>{if("single"===t)return 0===e?{transform:"translate(-50%, -50%) translateZ(0px) scale(1)",opacity:1,zIndex:5,filter:"none"}:{transform:"translate(-50%, -50%) translateZ(0px) scale(0.92)",opacity:0,zIndex:0,filter:"brightness(0.5)"};switch(e){case -2:return{transform:`translate(-50%, -50%) translateX(${-(.52*eq.width)}px) translateZ(-280px) scale(0.55)`,opacity:.25,zIndex:1,filter:"brightness(0.5)"};case -1:return{transform:`translate(-50%, -50%) translateX(${-(.38*eq.width)}px) translateZ(-120px) scale(0.75)`,opacity:.5,zIndex:2,filter:"brightness(0.65)"};case 0:return{transform:"translate(-50%, -50%) translateZ(0px) scale(1)",opacity:1,zIndex:5,filter:"none"};case 1:return{transform:`translate(-50%, -50%) translateX(${.38*eq.width}px) translateZ(-120px) scale(0.75)`,opacity:.5,zIndex:2,filter:"brightness(0.65)"};case 2:return{transform:`translate(-50%, -50%) translateX(${.52*eq.width}px) translateZ(-280px) scale(0.55)`,opacity:.25,zIndex:1,filter:"brightness(0.5)"};default:return{transform:"translate(-50%, -50%) translateZ(0px) scale(1)",opacity:0,zIndex:0,filter:"brightness(0.5)"}}})(s,eb?"single":"continuous"===z?"continuous":"single");return(0,r.jsx)("div",{className:(0,j.cn)("absolute left-1/2 top-1/2 transition-[transform,opacity,filter] duration-[900ms] ease-out will-change-transform",eN&&"cursor-pointer",n&&"group"),style:{...l,transformOrigin:"center center"},title:!i&&eN?`第 ${a+1} 頁 - ${e.name}`:void 0,onClick:()=>{if(eN)if(i){if("continuous"!==z||eb)return;ef(!0),null!==eg.current&&(cancelAnimationFrame(eg.current),eg.current=null);let e=performance.now();em(60);let t=a=>{let r=Math.min(1,(a-e)/900);em(Math.round(60+40*(r<.5?2*r*r:1-Math.pow(-2*r+2,2)/2))),r<1?eg.current=requestAnimationFrame(t):(eg.current=null,ef(!1),k("single"))};eg.current=requestAnimationFrame(t)}else X(a)},children:(0,r.jsx)(ea,{pageIndex:a,isActive:i,onFocus:()=>{},children:i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"absolute -top-6 left-0 text-[10px] font-medium text-violet-300 bg-violet-500/10 border-t border-x border-violet-500/20 px-2 py-0.5 rounded-t-md",children:["Page ",a+1," - ",e.name]}),(0,r.jsx)("div",{className:(0,j.cn)("transition-shadow duration-300 rounded-lg overflow-hidden",eF(e.items)?"ring-0 shadow-none":"ring-2 ring-violet-500/40 shadow-[0_0_60px_rgba(139,92,246,0.15)]"),children:(0,r.jsx)(y,{width:eq.width,height:eq.height,items:e.items,fullBleed:eF(e.items),isActive:i,autoFit:!1,onClickBackground:()=>T(),onMarqueeSelect:(e,t)=>{t?e.forEach(e=>L(e)):E(e)},children:e.items.map(e=>(0,r.jsx)(q,{item:e,isSelected:S.includes(e.id),onSelect:t=>{t?.ctrlKey||t?.metaKey?I(e.id):E([e.id])},onUpdate:t=>e_(e.id,t),onRemove:()=>eH(e.id),onMoveToPage:t=>W(e.id,t),analysisData:t,canvasWidth:eq.width,canvasHeight:eq.height},e.id))})})]}):(0,r.jsxs)("div",{className:(0,j.cn)("relative rounded-xl overflow-hidden shadow-2xl",n?"shadow-black/50 border border-white/10 group-hover:border-white/20 transition-all duration-300":"border border-white/5"),children:[(0,r.jsx)("div",{className:"pointer-events-none",children:(0,r.jsx)(y,{width:eq.width,height:eq.height,items:e.items,fullBleed:eF(e.items),isActive:!1,autoFit:!1,enableWheelZoom:!1,onClickBackground:()=>{},onMarqueeSelect:()=>{},children:e.items.map(a=>(0,r.jsx)(q,{item:a,isSelected:!1,onSelect:()=>{},onUpdate:()=>{},onRemove:()=>{},onMoveToPage:()=>{},analysisData:t,canvasWidth:eq.width,canvasHeight:eq.height},`thumb-${e.id}-${a.id}`))})}),n&&(0,r.jsxs)("div",{className:(0,j.cn)("absolute top-2 bg-black/60 backdrop-blur-sm text-zinc-300 text-[9px] font-bold px-1.5 py-0.5 rounded",s<0?"left-2":"right-2"),children:["P",a+1]})]})})},e.id)})}):(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)("div",{className:"p-6 rounded-full bg-zinc-900 border border-white/5 inline-block",children:(0,r.jsx)(u.A,{className:"h-10 w-10 text-zinc-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-white",children:"尚未載入數據"}),(0,r.jsxs)("p",{className:"text-zinc-500 text-sm mt-1",children:["請先至 ",(0,r.jsx)(n(),{href:"/dashboard",className:"text-violet-400 hover:underline",children:"儀表板"})," 進行分析"]}),(0,r.jsx)("p",{className:"text-zinc-400 text-xs mt-2",children:"或先點上方「規劃封面」建立封面頁。"})]})]})})]})]}),(0,r.jsx)(ee.Hd,{dropAnimation:null,children:J?(0,r.jsxs)("div",{className:"px-4 py-3 bg-violet-600/80 backdrop-blur-sm text-white rounded-lg shadow-2xl border border-violet-400/50 flex items-center gap-2 pointer-events-none",children:[(0,r.jsx)("div",{className:"w-6 h-6 border-2 border-white/80 rounded flex items-center justify-center",children:(0,r.jsx)(f.A,{className:"w-4 h-4"})}),(0,r.jsxs)("span",{className:"text-sm font-medium",children:["多選拖移中... ",S.length>1?`(${S.length} 個元件)`:""]})]}):null}),er&&!J&&(!ec||null!==en&&en!==c)&&(0,r.jsxs)("div",{className:(0,j.cn)("fixed z-[9999] pointer-events-none px-3 py-1.5 bg-violet-600 text-white rounded-full shadow-xl border-2 border-white/20 flex items-center gap-2 transform -translate-x-1/2 -translate-y-[150%] transition-transform",null!==en&&en!==c?"scale-110 bg-violet-500":""),style:{left:el.x,top:el.y},children:[(0,r.jsx)(f.A,{className:"w-4 h-4"}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{className:"text-xs font-bold leading-none",children:null!==en&&en!==c?`移動至第 ${en+1} 頁`:"跨頁移動"}),es>1&&(0,r.jsxs)("span",{className:"text-[9px] opacity-80 leading-none mt-0.5",children:["選取 ",es," 個元件"]})]})]})]}),(0,r.jsx)(ed,{isOpen:ey,onClose:()=>ek(!1),onExport:eJ,format:eS}),eA&&(0,r.jsx)("div",{className:"fixed inset-0 z-[10000] flex items-center justify-center bg-black/80 backdrop-blur-md animate-in fade-in duration-300",children:(0,r.jsxs)("div",{className:"text-center space-y-6 max-w-sm w-full px-6",children:[(0,r.jsxs)("div",{className:"relative mx-auto w-24 h-24",children:[(0,r.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-emerald-500/20"}),(0,r.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-emerald-500 border-t-transparent animate-spin",style:{animationDuration:"1.5s"}}),(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsx)(m.A,{className:"h-8 w-8 text-emerald-400"})})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-white",children:"正在處理匯出..."}),(0,r.jsxs)("p",{className:"text-emerald-400 font-mono text-sm tracking-widest",children:["PAGE ",eM.current," OF ",eM.total]})]}),(0,r.jsx)("div",{className:"h-2 w-full bg-zinc-800 rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-emerald-500 transition-all duration-300 ease-out shadow-[0_0_10px_rgba(16,185,129,0.5)]",style:{width:`${eM.current/eM.total*100}%`}})}),(0,r.jsx)("p",{className:"text-zinc-500 text-xs italic",children:"請勿關閉視窗，正在準備下載內容"})]})})]})})},86120:(e,t,a)=>{"use strict";a.d(t,{b:()=>h,i:()=>x});var r=a(95155),s=a(12115),i=a(73321),n=a(16385),l=a(39430),o=a(62032),c=a(66614),d=a(80723);function u(){let e=(0,i.useRouter)();return(0,r.jsxs)("div",{className:"min-h-screen bg-black flex items-center justify-center p-4 relative overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-red-600/10 rounded-full blur-[128px] pointer-events-none"}),(0,r.jsx)("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-amber-600/10 rounded-full blur-[128px] pointer-events-none"}),(0,r.jsx)("div",{className:"relative z-10 max-w-md w-full",children:(0,r.jsxs)(l.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5},className:"bg-zinc-900/50 backdrop-blur-xl border border-red-500/20 rounded-3xl p-8 shadow-2xl overflow-hidden",children:[(0,r.jsxs)(l.P.div,{className:"w-20 h-20 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-6 border border-red-500/20 relative",initial:{rotate:-180,opacity:0},animate:{rotate:0,opacity:1},transition:{delay:.2,type:"spring"},children:[(0,r.jsx)(o.A,{className:"w-10 h-10 text-red-500"}),(0,r.jsx)(l.P.div,{className:"absolute inset-0 bg-red-500/20 rounded-full",animate:{scale:[1,1.2,1]},transition:{duration:2,repeat:1/0}})]}),(0,r.jsxs)("div",{className:"text-center space-y-3 mb-8",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-white tracking-tight",children:"Access Denied"}),(0,r.jsxs)("p",{className:"text-zinc-400 text-sm leading-relaxed",children:["權限不足。此區域僅限系統管理員訪問。",(0,r.jsx)("br",{}),"若您認為這是錯誤，請聯繫技術支援。"]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("button",{onClick:()=>e.push("/dashboard"),className:"w-full flex items-center justify-center gap-2 bg-white text-black hover:bg-zinc-200 font-bold py-3.5 px-4 rounded-xl transition-all active:scale-[0.98]",children:[(0,r.jsx)(c.A,{className:"w-4 h-4"}),"返回主控台 (Dashboard)"]}),(0,r.jsxs)("button",{onClick:()=>e.back(),className:"w-full flex items-center justify-center gap-2 bg-transparent hover:bg-white/5 text-zinc-400 hover:text-white font-medium py-3.5 px-4 rounded-xl border border-white/5 hover:border-white/10 transition-all active:scale-[0.98]",children:[(0,r.jsx)(d.A,{className:"w-4 h-4"}),"回上一頁"]})]}),(0,r.jsx)(l.P.div,{className:"mt-8 pt-6 border-t border-white/5 text-center",initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},children:(0,r.jsx)("p",{className:"text-[10px] text-zinc-600 font-mono uppercase tracking-widest",children:"Error: 403_FORBIDDEN"})})]})})]})}function h(){let[e,t]=(0,s.useState)({user:null,isAdmin:!1,permissions:{canPostAnnouncement:!1,accessibleCounties:[],isSuperAdmin:!1},isLoading:!0,error:null});return(0,s.useEffect)(()=>{let e=async()=>{try{let{data:{session:e},error:a}=await n.N.auth.getSession();if(a)throw a;if(!e?.user)return void t({user:null,isAdmin:!1,permissions:{canPostAnnouncement:!1,accessibleCounties:[],isSuperAdmin:!1},isLoading:!1,error:null});let{data:r,error:s}=await n.N.from("profiles").select("role, accessible_counties, can_post_announcement").eq("id",e.user.id).single();if(s){console.warn("Profile fetch error:",s),t({user:e.user,isAdmin:!1,permissions:{canPostAnnouncement:!1,accessibleCounties:[],isSuperAdmin:!1},isLoading:!1,error:null});return}let i=r?.role==="super_admin",l=r?.role==="admin"||i,o=i?null:r?.accessible_counties,c=!!i||r?.can_post_announcement||!1;t({user:e.user,isAdmin:l,permissions:{canPostAnnouncement:c,accessibleCounties:o,isSuperAdmin:i},isLoading:!1,error:null})}catch(e){console.error("Admin auth check error:",e),t({user:null,isAdmin:!1,permissions:{canPostAnnouncement:!1,accessibleCounties:[],isSuperAdmin:!1},isLoading:!1,error:e.message})}};e();let{data:{subscription:a}}=n.N.auth.onAuthStateChange(()=>{e()});return()=>a.unsubscribe()},[]),e}function x(e){return function(t){let{user:a,isAdmin:n,isLoading:l,error:o}=h(),c=(0,i.useRouter)();return((0,s.useEffect)(()=>{l||n||c.replace("/")},[l,n,c]),l)?(0,r.jsx)("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)("div",{className:"h-8 w-8 border-2 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin mx-auto"}),(0,r.jsx)("p",{className:"text-zinc-500 text-sm",children:"驗證管理員權限..."})]})}):a?n?(0,r.jsx)(e,{...t}):(0,r.jsx)(u,{}):(0,r.jsx)("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center space-y-4 p-8",children:[(0,r.jsx)("div",{className:"text-4xl",children:"\uD83D\uDD12"}),(0,r.jsx)("h1",{className:"text-xl font-bold text-white",children:"請先登入"}),(0,r.jsx)("p",{className:"text-zinc-500",children:"此頁面需要登入才能訪問"}),(0,r.jsx)("button",{onClick:()=>c.push("/"),className:"bg-cyan-600 hover:bg-cyan-500 text-white px-6 py-2 rounded-lg transition-colors",children:"前往登入"})]})})}}}},e=>{e.O(0,[4764,5969,3242,6119,5772,319,6609,7061,3403,8500,8875,455,5679,8441,3794,7358],()=>e(e.s=64977)),_N_E=e.O()}]);