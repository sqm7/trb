(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3806],{64977:(e,t,s)=>{Promise.resolve().then(s.bind(s,67048))},67048:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eo});var a=s(95155),i=s(12115),r=s(98500),l=s.n(r),n=s(95542),c=s(39734),o=s(86120),d=s(89239),x=s(33024),h=s(91663),m=s(68459),p=s(41641),u=s(21362),g=s(51914),b=s(48368),j=s(40980),v=s(96066);function f({width:e,height:t,children:s,items:r,onClickBackground:l,onMarqueeSelect:n}){let c=(0,i.useRef)(null),o=(0,i.useRef)(null),d=(0,v.Q)(e=>e.zoomLevel),x=(0,v.Q)(e=>e.setZoomLevel),[h,m]=(0,i.useState)(!1),[p,u]=(0,i.useState)(null),g=d/100,b=(0,i.useRef)(!1);i.useEffect(()=>{if(c.current){let s=c.current.parentElement;if(s){let a=Math.min((s.clientWidth-100)/e,(s.clientHeight-100)/t);b.current||(x(Math.floor(100*a)),b.current=!0)}}},[e,t,x]);let f=(0,i.useCallback)(e=>{(e.ctrlKey||e.metaKey)&&(e.preventDefault(),x(d+(e.deltaY>0?-5:5)))},[d,x]),N=(0,i.useCallback)(e=>{let t=e.target,s=o.current?.querySelector(".report-canvas-content"),a=t.closest(".react-draggable")||t.closest("[data-chart-item]"),i=e.target===e.currentTarget||t===s||t.classList.contains("report-canvas-content")||t.style.backgroundImage?.includes("linear-gradient");if(a||!i&&!t.closest(".report-canvas-content"))return;let r=e.currentTarget.getBoundingClientRect(),l=(e.clientX-r.left)/g,n=(e.clientY-r.top)/g;m(!0),u({startX:l,startY:n,endX:l,endY:n,isShiftPressed:e.shiftKey})},[g]),w=(0,i.useCallback)(s=>{if(!h||!p)return;let a=s.currentTarget.getBoundingClientRect(),i=Math.max(0,Math.min(e,(s.clientX-a.left)/g)),r=Math.max(0,Math.min(t,(s.clientY-a.top)/g));u(e=>e?{...e,endX:i,endY:r,isShiftPressed:s.shiftKey}:null)},[h,p,g,e,t]),y=(0,i.useCallback)(e=>{if(h&&p){let t,s,a,i,c=(t=Math.min(p.startX,p.endX),s=Math.max(p.startX,p.endX),a=Math.min(p.startY,p.endY),i=Math.max(p.startY,p.endY),r.filter(e=>{let r=e.x+e.width,l=e.y+e.height;return!(e.x>s||r<t||e.y>i||l<a)}).map(e=>e.id)),o=Math.abs(p.endX-p.startX),d=Math.abs(p.endY-p.startY);o<5&&d<5?l?.():c.length>0?n?.(c,e.shiftKey||p.isShiftPressed):l?.()}m(!1),u(null)},[h,p,r,l,n]),z=p?{left:Math.min(p.startX,p.endX),top:Math.min(p.startY,p.endY),width:Math.abs(p.endX-p.startX),height:Math.abs(p.endY-p.startY)}:null;return(0,a.jsx)("div",{ref:c,className:"relative",style:{width:e*g,height:t*g},children:(0,a.jsxs)("div",{ref:o,className:(0,j.cn)("absolute origin-top-left bg-zinc-900 border border-white/10 rounded-lg shadow-2xl overflow-hidden","transition-transform duration-200",h&&"cursor-crosshair"),style:{width:e,height:t,transform:`scale(${g})`},onMouseDown:N,onMouseMove:w,onMouseUp:y,onMouseLeave:y,onWheel:f,children:[(0,a.jsx)("div",{className:"absolute inset-0 opacity-30 pointer-events-none",style:{backgroundImage:`
                            linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
                            linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px)
                        `,backgroundSize:"20px 20px"}}),(0,a.jsx)("div",{className:"relative w-full h-full report-canvas-content",children:s}),h&&z&&(0,a.jsx)("div",{className:"absolute border-2 border-violet-500 bg-violet-500/20 pointer-events-none z-50",style:z}),(0,a.jsxs)("div",{className:"absolute bottom-2 right-2 text-[10px] text-zinc-600 font-mono bg-zinc-950/80 px-2 py-1 rounded",children:[e," \xd7 ",t]})]})})}var N=s(37288),w=s(14403),y=s(93219),z=s(19835),k=s(69690),A=s(826),C=s(88042),S=s(3083);let P=(0,s(37206).default)(()=>Promise.all([s.e(7776),s.e(2441)]).then(s.bind(s,44822)),{loadableGenerated:{webpack:()=>[null]},ssr:!1}),M=e=>(0,a.jsx)(P,{...e});var D=s(98563),$=s(93398),Q=s(4439);let I={"cover-template":"報告封面","ranking-metrics":"核心數據指標","unit-price-stats":"各用途單價統計","ranking-chart":"建案排名","ranking-table":"建案排行列表","price-band-chart":"總價帶分佈","price-band-table":"總價帶詳細數據","price-band-location-table":"區域房型成交分佈","price-band-location-chart":"區域成交佔比","unit-price-bubble":"單價泡泡圖","type-comparison-table":"產品類型單價比較","sales-velocity-chart":"銷售速度","sales-velocity-table":"銷售速度明細","parking-pie":"車位配比","parking-price":"車位類型均價","parking-scatter":"車位坪數分析","parking-floor":"車位樓層分析",heatmap:"銷控熱力圖","heatmap-grid":"建案銷控熱力圖","heatmap-stats":"調價幅度摘要","heatmap-comparison":"戶型溢價貢獻","sales-heatmap":"房型面積熱力圖","sales-heatmap-detail":"熱力詳細交易表","data-list":"交易明細表"};function R({item:e,isSelected:t,onSelect:s,onUpdate:r,onRemove:l,onMoveToPage:n,analysisData:c}){let o=(0,v.Q)(e=>e.selectedIds),d=(0,v.Q)(e=>e.batchUpdateItems),h=(0,v.Q)(e=>e.pages),p=(0,v.Q)(e=>e.currentPageIndex),u=(0,v.Q)(e=>e.setDragging),g=h[p]?.items||[],b=i.useRef({}),f=i.useRef(!1),P=i.useRef(!1),[R,L]=i.useState(!1),[E,T]=i.useState({x:0,y:0}),q=e=>{R&&(e.stopPropagation(),L(!1))};i.useEffect(()=>{"fit"===e.scaleMode&&r({contentScale:Math.min(e.width/400,e.height/300)})},[e.width,e.height,e.scaleMode]);let F=(0,v.Q)(e=>e.zoomLevel);return(0,a.jsxs)(N.p,{scale:F/100,size:{width:e.width,height:e.height},position:{x:e.x,y:e.y},onDragStart:e=>{if(P.current=!1,t){f.current=!0,u(!0,o.length);let e={};o.forEach(t=>{let s=g.find(e=>e.id===t);s&&(e[t]={x:s.x,y:s.y})}),b.current=e,console.log("Group drag start:",e)}else f.current=!1,u(!0,1)},onDrag:(t,s)=>{P.current=!0;let a=t.clientX||t.touches?.[0]?.clientX,i=t.clientY||t.touches?.[0]?.clientY;if(void 0!==a&&void 0!==i){let e=document.elementsFromPoint(a,i).find(e=>"true"===e.getAttribute("data-page-drop-target")||"true"===e.getAttribute("data-page-drop-zone")),t=e?.getAttribute("data-page-index"),s=null!=t?parseInt(t,10):null;v.Q.getState().setHoveredPageIndex(s)}if(f.current&&o.length>1){let t=s.x-(b.current[e.id]?.x||e.x),a=s.y-(b.current[e.id]?.y||e.y),i={};o.forEach(s=>{s!==e.id&&b.current[s]&&(i[s]={x:b.current[s].x+t,y:b.current[s].y+a})}),Object.keys(i).length>0&&d(i)}},onDragStop:(s,a)=>{let i=s.clientX||s.changedTouches?.[0]?.clientX,l=s.clientY||s.changedTouches?.[0]?.clientY;if(void 0!==i&&void 0!==l){let e=document.elementsFromPoint(i,l).find(e=>"true"===e.getAttribute("data-page-drop-target")||"true"===e.getAttribute("data-page-drop-zone"));if(e){let s=parseInt(e.getAttribute("data-page-index")||"-1",10);if(s>=0&&s!==v.Q.getState().currentPageIndex){t?v.Q.getState().moveSelectedItemsToPage(s):n&&n(s),v.Q.getState().setCurrentPage(s),f.current=!1,b.current={},u(!1),v.Q.getState().setHoveredPageIndex(null);return}}}if(f.current&&o.length>1){let t=a.x-(b.current[e.id]?.x||e.x),s=a.y-(b.current[e.id]?.y||e.y),i={};o.forEach(r=>{let l=b.current[r];l&&(i[r]={x:r===e.id?a.x:l.x+t,y:r===e.id?a.y:l.y+s})}),d(i)}else r({x:a.x,y:a.y});f.current=!1,b.current={},u(!1),v.Q.getState().setHoveredPageIndex(null)},onResizeStop:(e,t,s,a,i)=>{r({width:parseInt(s.style.width,10),height:parseInt(s.style.height,10),x:i.x,y:i.y})},minWidth:150,minHeight:100,bounds:void 0,onClick:e=>{e.stopPropagation(),P.current||s(e),P.current=!1},className:(0,j.cn)("bg-zinc-800/80 backdrop-blur-sm rounded-lg border-2 transition-colors overflow-hidden",t?"border-violet-500 shadow-lg shadow-violet-500/20":"border-transparent hover:border-zinc-600"),enableResizing:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},resizeHandleStyles:{topRight:{cursor:"ne-resize",width:20,height:20,right:-10,top:-10},bottomRight:{cursor:"se-resize",width:20,height:20,right:-10,bottom:-10},bottomLeft:{cursor:"sw-resize",width:20,height:20,left:-10,bottom:-10},topLeft:{cursor:"nw-resize",width:20,height:20,left:-10,top:-10},top:{cursor:"n-resize",height:20,top:-10},bottom:{cursor:"s-resize",height:20,bottom:-10},left:{cursor:"w-resize",width:20,left:-10},right:{cursor:"e-resize",width:20,right:-10}},children:[(0,a.jsxs)("div",{className:"h-7 bg-zinc-900/90 flex items-center justify-between px-2 cursor-move border-b border-white/5 select-none group/header",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1.5 overflow-hidden",children:[(0,a.jsx)(z.A,{className:"h-3 w-3 text-zinc-500 group-hover/header:text-violet-400"}),(0,a.jsx)("span",{className:"text-[10px] text-zinc-400 font-medium truncate",children:I[e.type]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-[9px] text-zinc-600 font-mono hidden sm:inline",children:[e.width,"\xd7",e.height]}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),l()},className:"p-1 rounded hover:bg-red-500/20 text-zinc-600 hover:text-red-400 transition-colors",children:(0,a.jsx)(m.A,{className:"h-3 w-3"})})]})]}),(0,a.jsxs)("div",{className:(0,j.cn)("p-2 relative group/content","crop"===e.scaleMode&&"overflow-hidden","pan"===e.scaleMode&&"overflow-hidden cursor-grab active:cursor-grabbing","fit"===e.scaleMode&&"overflow-hidden"),style:{height:"calc(100% - 28px)"},onMouseDown:t=>{"pan"===e.scaleMode&&(t.stopPropagation(),L(!0),T({x:t.clientX,y:t.clientY}))},onMouseMove:t=>{if(!R||"pan"!==e.scaleMode)return;t.stopPropagation();let s=t.clientX-E.x,a=t.clientY-E.y;r({panOffset:{x:(e.panOffset?.x||0)+s,y:(e.panOffset?.y||0)+a}}),T({x:t.clientX,y:t.clientY})},onMouseUp:q,onMouseLeave:q,children:[(0,a.jsx)("div",{style:{transform:"pan"===e.scaleMode?`translate(${e.panOffset?.x||0}px, ${e.panOffset?.y||0}px)`:"fit"===e.scaleMode?`scale(${e.contentScale||1})`:void 0,transformOrigin:"top left",width:"fit"===e.scaleMode?400:"100%",height:"fit"===e.scaleMode?300:"100%"},children:(()=>{if("cover-template"===e.type){let s={title:"市場分析報告",subtitle:"價格帶與銷售動能評估",projectName:"請填寫建案名稱",period:"2026 Q1",preparedBy:"平米內參",reportDate:new Date().toISOString().split("T")[0],...e.data||{}},i=(e,t)=>{r({data:{...s,[e]:t}})},l="w-full bg-transparent border-b border-white/10 text-white focus:outline-none focus:border-cyan-400 px-1 py-0.5";return(0,a.jsxs)("div",{className:"h-full rounded-md overflow-hidden border border-white/5 bg-gradient-to-br from-zinc-950 via-zinc-900 to-slate-900 relative",children:[(0,a.jsx)("div",{className:"absolute -top-24 -left-20 w-56 h-56 rounded-full bg-cyan-500/10 blur-3xl"}),(0,a.jsx)("div",{className:"absolute -bottom-20 -right-20 w-64 h-64 rounded-full bg-violet-500/10 blur-3xl"}),(0,a.jsxs)("div",{className:"relative z-10 h-full flex flex-col justify-between p-6 md:p-8",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"inline-flex items-center px-2 py-1 text-[10px] rounded-full border border-cyan-400/30 text-cyan-300 bg-cyan-500/10 tracking-wider",children:"SQM INSIGHT REPORT"}),(0,a.jsx)("div",{className:"space-y-2",children:t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{value:s.title,onChange:e=>i("title",e.target.value),className:`${l} text-2xl md:text-3xl font-bold`}),(0,a.jsx)("input",{value:s.subtitle,onChange:e=>i("subtitle",e.target.value),className:`${l} text-sm text-zinc-300`})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h1",{className:"text-2xl md:text-4xl font-bold tracking-tight text-white leading-tight",children:s.title}),(0,a.jsx)("p",{className:"text-zinc-300 text-sm md:text-base",children:s.subtitle})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-xs md:text-sm",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-zinc-500 uppercase tracking-wider text-[10px]",children:"建案"}),t?(0,a.jsx)("input",{value:s.projectName,onChange:e=>i("projectName",e.target.value),className:l}):(0,a.jsx)("p",{className:"text-zinc-100",children:s.projectName})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-zinc-500 uppercase tracking-wider text-[10px]",children:"期間"}),t?(0,a.jsx)("input",{value:s.period,onChange:e=>i("period",e.target.value),className:l}):(0,a.jsx)("p",{className:"text-zinc-100",children:s.period})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-zinc-500 uppercase tracking-wider text-[10px]",children:"製作單位"}),t?(0,a.jsx)("input",{value:s.preparedBy,onChange:e=>i("preparedBy",e.target.value),className:l}):(0,a.jsx)("p",{className:"text-zinc-100",children:s.preparedBy})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-zinc-500 uppercase tracking-wider text-[10px]",children:"日期"}),t?(0,a.jsx)("input",{value:s.reportDate,onChange:e=>i("reportDate",e.target.value),className:l}):(0,a.jsx)("p",{className:"text-zinc-100",children:s.reportDate})]})]})]})]})}if(!c)return(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-zinc-500 text-sm",children:"無數據"});switch(e.type){case"sales-heatmap":{let t=e.data?.distribution||c.areaDistributionAnalysis;if(!t)return(0,a.jsx)("div",{className:"p-4 text-zinc-500",children:"無熱力圖數據"});return(0,a.jsx)("div",{className:"h-full overflow-hidden p-1",children:(0,a.jsx)(Q.m,{data:t,selectedRooms:e.data?.selectedRooms||["2房","3房"],minArea:e.data?.min||15,maxArea:e.data?.max||65,interval:e.data?.interval||5})})}case"sales-heatmap-detail":{let t=i.useMemo(()=>{if(e.data&&Array.isArray(e.data)&&e.data.length>0)return e.data;if(!c.transactionDetails)return[];let t={};return c.transactionDetails.forEach(e=>{let s=e["建案名稱"]||e.projectName||"未知";t[s]||(t[s]=[]),t[s].push(e)}),Object.entries(t).map(([e,t])=>{let s=t.map(e=>e["產權總價"]||e["交易總價(萬)"]||e.totalPrice||0).filter(e=>e>0).sort((e,t)=>e-t),a=t.map(e=>e["房屋單價"]||e["房屋單價(萬)"]||e.unitPrice||0).filter(e=>e>0),i=0;if(s.length>0){let e=Math.floor(s.length/2);i=s.length%2!=0?s[e]:(s[e-1]+s[e])/2}return{projectName:e,count:t.length,priceRange:{median:i},unitPriceRange:{min:a.length?Math.min(...a):0,max:a.length?Math.max(...a):0}}}).sort((e,t)=>t.unitPriceRange.max-e.unitPriceRange.max)},[e.data,c.transactionDetails]);if(0===t.length)return(0,a.jsx)("div",{className:"p-4 text-zinc-500 text-xs text-center",children:"無數據"});return(0,a.jsx)("div",{className:"h-full overflow-auto custom-scrollbar p-1",children:(0,a.jsxs)("table",{className:"w-full text-xs border-collapse",children:[(0,a.jsx)("thead",{className:"bg-zinc-800 text-zinc-300 sticky top-0",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-2 text-left",children:"建案名稱"}),(0,a.jsx)("th",{className:"p-2 text-center",children:"單價範圍(萬/坪)"}),(0,a.jsx)("th",{className:"p-2 text-center",children:"總價中位數(萬)"}),(0,a.jsx)("th",{className:"p-2 text-center",children:"交易筆數"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-white/5",children:t.map((e,t)=>(0,a.jsxs)("tr",{className:"hover:bg-zinc-800/30",children:[(0,a.jsx)("td",{className:"p-2 text-white font-medium",children:e.projectName}),(0,a.jsxs)("td",{className:"p-2 text-center text-cyan-400",children:[e.unitPriceRange?.min?.toFixed(1)," ~ ",e.unitPriceRange?.max?.toFixed(1)]}),(0,a.jsx)("td",{className:"p-2 text-center text-violet-400",children:Math.round(e.priceRange?.median||0).toLocaleString()}),(0,a.jsx)("td",{className:"p-2 text-center text-zinc-300",children:e.count})]},t))})]})})}case"heatmap":case"heatmap-grid":{let t=e.data?.projectData||(c.priceGridAnalysis?.byProject?c.priceGridAnalysis.byProject[Object.keys(c.priceGridAnalysis.byProject)[0]]:null),s=e.data?.floorPremium||.3;return(0,a.jsx)("div",{className:"h-full overflow-auto custom-scrollbar p-1",children:t?(0,a.jsx)($.t,{data:t,floorPremium:s,showGrid:!0,showSummary:!1,showComparison:!1}):(0,a.jsx)("div",{className:"text-zinc-500 text-sm p-4 text-center",children:"無熱力圖數據 (請先載入建案資料)"})})}case"heatmap-stats":{let t=e.data?.summary?{summary:e.data.summary}:c.priceGridAnalysis?.byProject?c.priceGridAnalysis.byProject[Object.keys(c.priceGridAnalysis.byProject)[0]]:null;return(0,a.jsx)("div",{className:"h-full overflow-auto custom-scrollbar p-1",children:t?.summary?(0,a.jsx)($.t,{data:t,showGrid:!1,showSummary:!0,showComparison:!1}):(0,a.jsx)("div",{className:"text-zinc-500 text-sm p-4 text-center",children:"無統計摘要數據"})})}case"heatmap-comparison":{let t=e.data?.horizontalComparison?{horizontalComparison:e.data.horizontalComparison}:c.priceGridAnalysis?.byProject?c.priceGridAnalysis.byProject[Object.keys(c.priceGridAnalysis.byProject)[0]]:null;return(0,a.jsx)("div",{className:"h-full overflow-auto custom-scrollbar p-1",children:t?.horizontalComparison?(0,a.jsx)($.t,{data:t,showGrid:!1,showSummary:!1,showComparison:!0}):(0,a.jsx)("div",{className:"text-zinc-500 text-sm p-4 text-center",children:"無溢價貢獻數據"})})}case"unit-price-stats":{let t=e.data||{residentialStats:c.unitPriceAnalysis?.residentialStats,officeStats:c.unitPriceAnalysis?.officeStats,storeStats:c.unitPriceAnalysis?.storeStats,averageType:"weighted"};return(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 h-full p-2 overflow-y-auto custom-scrollbar",children:[(0,a.jsx)(D.E,{title:"住宅統計",stats:t.residentialStats,noDataMessage:"無數據",className:"bg-zinc-900/40 border-violet-500/20 scale-[0.9] origin-top",averageType:t.averageType||"weighted"}),(0,a.jsx)(D.E,{title:"辦公統計",stats:t.officeStats,noDataMessage:"無數據",className:"bg-zinc-900/40 border-cyan-500/20 scale-[0.9] origin-top",averageType:t.averageType||"weighted"}),(0,a.jsx)(D.E,{title:"店舖統計",stats:t.storeStats,noDataMessage:"無數據",className:"bg-zinc-900/40 border-amber-500/20 lg:col-span-2 scale-[0.9] origin-top",averageType:t.averageType||"weighted"})]})}case"ranking-metrics":{let t=c.rankingAnalysis?.projectRanking||c.projectRanking||[],{coreMetrics:s,derivedMetrics:i}=e.data||{coreMetrics:c.rankingAnalysis?.coreMetrics||c.coreMetrics,derivedMetrics:{min:Math.min(...t.map(e=>e.minPrice).filter(e=>e>0)||[0]),max:Math.max(...t.map(e=>e.maxPrice)||[0]),median:t.length?t.reduce((e,t)=>e+(t.medianPrice||0),0)/t.length:0,parking:t.length?t.reduce((e,t)=>e+(t.avgParkingPrice||0),0)/t.length:0}};if(!s)return(0,a.jsx)("div",{className:"p-4 text-zinc-500 text-xs text-center flex items-center justify-center h-full",children:"無指標數據"});let r=[{title:"市場去化總銷售金額",value:s.totalSaleAmount?.toLocaleString(),unit:"萬"},{title:"總銷去化房屋坪數",value:s.totalHouseArea?.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"坪"},{title:"總平均單價",value:s.overallAveragePrice?.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"萬/坪"},{title:"總交易筆數",value:s.transactionCount?.toLocaleString(),unit:"筆"},{title:"最低成交單價",value:i.min?.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"萬/坪"},{title:"最高成交單價",value:i.max?.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"萬/坪"},{title:"平均中位數單價",value:i.median?.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"萬/坪"},{title:"平均車位價格",value:i.parking?.toLocaleString(void 0,{maximumFractionDigits:0}),unit:"萬"}];return(0,a.jsx)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-2 h-full p-1 overflow-y-auto custom-scrollbar",children:r.map((e,t)=>(0,a.jsxs)("div",{className:"bg-zinc-800/40 rounded border border-white/5 p-2 flex flex-col items-center justify-center text-center",children:[(0,a.jsx)("div",{className:"text-zinc-500 text-[10px] mb-1 truncate w-full",children:e.title}),(0,a.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,a.jsx)("span",{className:"text-sm font-bold text-white",children:e.value}),(0,a.jsx)("span",{className:"text-[8px] text-zinc-600",children:e.unit})]})]},t))})}case"ranking-chart":let s=e.data||c.rankingAnalysis?.projectRanking||c.projectRanking||[];return(0,a.jsx)(k.l,{data:s.slice(0,10),sortKey:"saleAmountSum",limit:10,chartType:"bar",height:"100%"});case"price-band-chart":let l=c.priceBandAnalysis?.details||[];return(0,a.jsx)(A.B,{data:e.data||l});case"price-band-table":let n=void 0!==e.data?e.data:c.priceBandAnalysis?.details||[];return(0,a.jsx)("div",{className:"h-full overflow-auto custom-scrollbar",children:(0,a.jsxs)("table",{className:"w-full text-[10px] text-left",children:[(0,a.jsx)("thead",{className:"bg-zinc-900 sticky top-0 text-zinc-500",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-1",children:"房型"}),(0,a.jsx)("th",{className:"p-1",children:"衛浴人"}),(0,a.jsx)("th",{className:"p-1 text-right",children:"平均總價"}),(0,a.jsx)("th",{className:"p-1 text-right",children:"中位數"}),(0,a.jsx)("th",{className:"p-1 text-right",children:"筆數"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-white/5",children:n.map((e,t)=>(0,a.jsxs)("tr",{className:"text-zinc-300",children:[(0,a.jsx)("td",{className:"p-1",children:e.roomType}),(0,a.jsx)("td",{className:"p-1 text-zinc-500",children:e.bathrooms??"-"}),(0,a.jsx)("td",{className:"p-1 text-right text-zinc-300",children:Math.round(e.avgPrice||0).toLocaleString()}),(0,a.jsx)("td",{className:"p-1 text-right text-violet-400",children:Math.round(e.medianPrice||0).toLocaleString()}),(0,a.jsx)("td",{className:"p-1 text-right text-zinc-500",children:e.count})]},t))})]})});case"price-band-location-table":let o=e.data;if(!o)return(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-zinc-500 text-sm",children:"無區域數據"});let d=o.locations&&o.rows,h=d?o.locations:Object.keys(o[0]||{}).filter(e=>"房型"!==e&&"總計"!==e),m=d?o.rows:o;if(!m||0===m.length)return(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-zinc-500 text-sm",children:"無區域數據"});return(0,a.jsx)("div",{className:"h-full overflow-auto custom-scrollbar",children:(0,a.jsxs)("table",{className:"w-full text-[10px] text-left border-collapse",children:[(0,a.jsx)("thead",{className:"bg-zinc-900 sticky top-0 text-zinc-500",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-1 sticky left-0 bg-zinc-900 z-10 border-r border-white/5",children:"房型"}),h.map(e=>(0,a.jsx)("th",{className:"p-1 text-center min-w-[40px]",children:e},e)),(0,a.jsx)("th",{className:"p-1 text-center font-bold text-white border-l border-white/5",children:"總計"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-white/5",children:m.map((e,t)=>(0,a.jsxs)("tr",{className:"text-zinc-300 hover:bg-zinc-800/30",children:[(0,a.jsx)("td",{className:"p-1 sticky left-0 bg-zinc-950/90 border-r border-white/5",children:e.roomType||e["房型"]}),h.map((t,s)=>{let i=d?e.cells[s]:e[t],r="number"==typeof i&&i>0?Math.min(i/10,1):0;return(0,a.jsx)("td",{className:"p-1 text-center text-zinc-400",style:i>0?{backgroundColor:`rgba(6, 182, 212, ${.3*r})`}:{},children:i>0?i:"-"},t)}),(0,a.jsx)("td",{className:"p-1 text-center text-cyan-400 border-l border-white/5 font-bold",children:e.rowTotal||e["總計"]})]},t))})]})});case"price-band-location-chart":let p=e.data;if(!p)return(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-zinc-500 text-sm",children:"無數據"});let u=p.locations&&p.rows,g=u?p.locations:Object.keys(p[0]||{}).filter(e=>"房型"!==e&&"總計"!==e),b=u?p.rows.map(e=>e.roomType):p.map(e=>e["房型"]);if(0===b.length)return(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-zinc-500 text-sm",children:"無數據"});let v=g.map((e,t)=>({name:e,data:u?p.rows.map(e=>e.cells[t]||0):p.map(t=>t[e]||0)}));return(0,a.jsx)(M,{options:{chart:{type:"bar",stacked:!0,background:"transparent",toolbar:{show:!1}},plotOptions:{bar:{horizontal:!1,borderRadius:2}},dataLabels:{enabled:!1},xaxis:{categories:b,labels:{style:{colors:"#71717a"}}},yaxis:{labels:{style:{colors:"#71717a"}}},grid:{borderColor:"#27272a"},legend:{position:"bottom",labels:{colors:"#a1a1aa"}},theme:{mode:"dark"},colors:["#06b6d4","#8b5cf6","#f59e0b","#10b981","#ef4444","#ec4899"]},series:v,type:"bar",height:"100%"});case"unit-price-bubble":let f=c.transactionDetails||[];return(0,a.jsx)(C.$,{data:f,minPrice:30,maxPrice:150,interval:5,sizeMetric:"count",onMinPriceChange:()=>{},onMaxPriceChange:()=>{},onIntervalChange:()=>{},onSizeMetricChange:()=>{}});case"sales-velocity-chart":let N=c.salesVelocityAnalysis;if(!N?.weekly)return(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-zinc-500 text-sm",children:"無銷售速度數據"});return(0,a.jsx)(S.M,{data:N.weekly,selectedRooms:["1房","2房","3房"],metric:"count"});case"ranking-table":let z=e.data||c.rankingAnalysis?.projectRanking||c.projectRanking||[];return(0,a.jsx)("div",{className:"h-full overflow-auto custom-scrollbar",children:(0,a.jsxs)("table",{className:"w-full text-[10px] text-left",children:[(0,a.jsx)("thead",{className:"bg-zinc-900 sticky top-0 text-zinc-500",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-1",children:"建案"}),(0,a.jsx)("th",{className:"p-1 text-right",children:"交易總價"}),(0,a.jsx)("th",{className:"p-1 text-right",children:"單價"}),(0,a.jsx)("th",{className:"p-1 text-right",children:"筆數"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-white/5",children:z.slice(0,50).map((e,t)=>(0,a.jsxs)("tr",{className:"text-zinc-300",children:[(0,a.jsx)("td",{className:"p-1 truncate max-w-[80px]",title:e.projectName,children:e.projectName}),(0,a.jsxs)("td",{className:"p-1 text-right font-mono text-zinc-400",children:[(e.saleAmountSum/1e4).toFixed(0),"億"]}),(0,a.jsx)("td",{className:"p-1 text-right font-mono text-cyan-400",children:e.averagePrice?.toFixed(1)}),(0,a.jsx)("td",{className:"p-1 text-right font-mono text-zinc-500",children:e.transactionCount})]},t))})]})});case"sales-velocity-table":let P=e.data||[];if(!P||0===P.length)return(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-zinc-500 text-sm",children:"無數據"});return(0,a.jsx)("div",{className:"h-full overflow-auto custom-scrollbar",children:(0,a.jsxs)("table",{className:"w-full text-[10px] text-left",children:[(0,a.jsx)("thead",{className:"bg-zinc-900 sticky top-0 text-zinc-500",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-1",children:"區間"}),(0,a.jsx)("th",{className:"p-1 text-right",children:"筆數"}),(0,a.jsx)("th",{className:"p-1 text-right",children:"總銷(億)"}),(0,a.jsx)("th",{className:"p-1 text-right",children:"坪數"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-white/5",children:P.map((e,t)=>(0,a.jsxs)("tr",{className:"text-zinc-300",children:[(0,a.jsx)("td",{className:"p-1 text-zinc-400",children:e.period}),(0,a.jsx)("td",{className:"p-1 text-right font-mono text-white",children:e.total?.count||0}),(0,a.jsx)("td",{className:"p-1 text-right font-mono text-cyan-400",children:((e.total?.priceSum||0)/1e4).toFixed(1)}),(0,a.jsx)("td",{className:"p-1 text-right font-mono text-zinc-500",children:Math.round(e.total?.areaSum||0)})]},t))})]})});case"type-comparison-table":let I=e.data||c.unitPriceAnalysis?.typeComparison||[];return(0,a.jsx)("div",{className:"h-full overflow-auto custom-scrollbar",children:(0,a.jsxs)("table",{className:"w-full text-[10px] text-left",children:[(0,a.jsx)("thead",{className:"bg-zinc-900 sticky top-0 text-zinc-500",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-1",children:"建案"}),(0,a.jsx)("th",{className:"p-1 text-right",children:"住宅"}),(0,a.jsx)("th",{className:"p-1 text-right",children:"店面"}),(0,a.jsx)("th",{className:"p-1 text-right",children:"辦公"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-white/5",children:I.map((e,t)=>(0,a.jsxs)("tr",{className:"text-zinc-300",children:[(0,a.jsx)("td",{className:"p-1 truncate max-w-[80px]",children:e.projectName}),(0,a.jsx)("td",{className:"p-1 text-right font-mono text-cyan-400",children:e.residentialAvg?e.residentialAvg.toFixed(1):"-"}),(0,a.jsx)("td",{className:"p-1 text-right font-mono text-amber-400",children:e.storeAvg?e.storeAvg.toFixed(1):"-"}),(0,a.jsx)("td",{className:"p-1 text-right font-mono text-violet-400",children:e.officeAvg?e.officeAvg.toFixed(1):"-"})]},t))})]})});case"parking-pie":let R=c.parkingAnalysis?.parkingRatio,L=[{name:"有車位",value:R?.withParking?.count||0},{name:"無車位",value:R?.withoutParking?.count||0}],E={chart:{type:"donut",background:"transparent"},labels:L.map(e=>e.name),colors:["#8b5cf6","#3f3f46"],stroke:{show:!1},dataLabels:{enabled:!1},legend:{show:!0,position:"bottom",labels:{colors:"#a1a1aa"}},theme:{mode:"dark"}};return(0,a.jsx)(M,{options:E,series:L.map(e=>e.value),type:"donut",height:"100%"});case"parking-price":let T=c.parkingAnalysis?.avgPriceByType||[];return(0,a.jsx)("div",{className:"h-full overflow-auto custom-scrollbar",children:(0,a.jsxs)("table",{className:"w-full text-[10px] text-left",children:[(0,a.jsx)("thead",{className:"bg-zinc-900 sticky top-0 text-zinc-500",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-1",children:"類型"}),(0,a.jsx)("th",{className:"p-1 text-right",children:"均價"}),(0,a.jsx)("th",{className:"p-1 text-right",children:"總數"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-white/5",children:T.map(e=>(0,a.jsxs)("tr",{className:"text-zinc-300",children:[(0,a.jsx)("td",{className:"p-1",children:e.type}),(0,a.jsx)("td",{className:"p-1 text-right text-cyan-400",children:Math.round(e.avgPrice).toLocaleString()}),(0,a.jsx)("td",{className:"p-1 text-right text-zinc-500",children:e.count})]},e.type))})]})});case"heatmap":return(0,a.jsxs)("div",{className:"h-full flex flex-col items-center justify-center p-4 text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 rounded-lg bg-violet-500/10 flex items-center justify-center mb-2",children:(0,a.jsx)(w.A,{className:"h-8 w-8 text-violet-500"})}),(0,a.jsx)("p",{className:"text-xs text-zinc-400",children:"由於熱力圖需要專案選擇，此元件將在匯出時呈現專案銷控狀態。"}),(0,a.jsx)("div",{className:"mt-2 grid grid-cols-4 gap-1 w-full max-w-[200px]",children:Array.from({length:12}).map((e,t)=>(0,a.jsx)("div",{className:(0,j.cn)("h-3 rounded-sm",t%3==0?"bg-red-500/50":"bg-zinc-700/50")},t))})]});case"data-list":let q=c.transactionDetails||[];return(0,a.jsx)("div",{className:"h-full overflow-auto custom-scrollbar",children:(0,a.jsxs)("table",{className:"w-full text-[9px] text-left",children:[(0,a.jsx)("thead",{className:"bg-zinc-900 sticky top-0 text-zinc-500",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"p-1",children:"建案名稱"}),(0,a.jsx)("th",{className:"p-1",children:"日期"}),(0,a.jsx)("th",{className:"p-1 text-right",children:"單價"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-white/5",children:q.slice(0,50).map((e,t)=>(0,a.jsxs)("tr",{className:"text-zinc-300",children:[(0,a.jsx)("td",{className:"p-1 truncate max-w-[80px]",children:e["建案名稱"]}),(0,a.jsx)("td",{className:"p-1 text-zinc-500",children:e["交易日"]}),(0,a.jsx)("td",{className:"p-1 text-right text-violet-400",children:e["房屋單價(萬)"]||"-"})]},t))})]})});case"parking-scatter":return(0,a.jsxs)("div",{className:"h-full flex flex-col items-center justify-center p-4 text-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded-full bg-cyan-500/10 flex items-center justify-center mb-2",children:(0,a.jsx)(y.A,{className:"h-6 w-6 text-cyan-500"})}),(0,a.jsx)("p",{className:"text-[10px] text-zinc-400",children:"車位坪數散佈分析"}),(0,a.jsx)("div",{className:"mt-2 w-full h-24 bg-zinc-900/50 rounded flex items-end justify-around p-2 gap-1",children:Array.from({length:15}).map((e,t)=>(0,a.jsx)("div",{className:"w-1 bg-cyan-500/40 rounded-full",style:{height:`${20+60*Math.random()}%`}},t))})]});case"parking-floor":return(0,a.jsxs)("div",{className:"h-full flex flex-col items-center justify-center p-4 text-center border border-dashed border-white/5 rounded",children:[(0,a.jsx)("div",{className:"w-12 h-12 rounded bg-violet-500/10 flex items-center justify-center mb-2",children:(0,a.jsx)(x.A,{className:"h-6 w-6 text-violet-500"})}),(0,a.jsx)("p",{className:"text-[10px] text-zinc-400",children:"樓層價差分析數據"}),(0,a.jsx)("div",{className:"mt-2 space-y-1 w-full",children:["B1","B2","B3"].map(e=>(0,a.jsxs)("div",{className:"flex justify-between text-[8px] bg-zinc-900/50 p-1 rounded",children:[(0,a.jsxs)("span",{className:"text-zinc-500",children:[e,"層"]}),(0,a.jsx)("span",{className:"text-cyan-400",children:"漲幅 +2.4%"})]},e))})]});default:return(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-zinc-500 text-sm",children:"未知圖表類型"})}})()}),!t&&!R&&(0,a.jsx)("div",{className:"absolute inset-0 z-10 cursor-pointer",onClick:e=>{e.stopPropagation(),s(e)}})]})]})}var L=s(89123),E=s(19965),T=s(44071),q=s(18837);let F=[{id:"cover",title:"封面規劃",items:[{type:"cover-template",label:"報告封面",icon:(0,a.jsx)(b.A,{className:"h-4 w-4"}),description:"可編輯標題與日期",requiresData:!1}]},{id:"ranking",title:"核心指標與排名",items:[{type:"ranking-metrics",label:"核心數據指標",icon:(0,a.jsx)(y.A,{className:"h-4 w-4"}),description:"8 項關鍵成交指標卡片",requiresData:!0},{type:"ranking-chart",label:"建案排名圖表",icon:(0,a.jsx)(L.A,{className:"h-4 w-4"}),description:"總銷與各項指標排名",requiresData:!0},{type:"ranking-table",label:"建案排名列表",icon:(0,a.jsx)(L.A,{className:"h-4 w-4"}),description:"詳細數據列表",requiresData:!0}]},{id:"price-band",title:"總價帶分析",items:[{type:"price-band-chart",label:"總價帶分佈",icon:(0,a.jsx)(w.A,{className:"h-4 w-4"}),description:"價格區間箱型圖",requiresData:!0},{type:"price-band-table",label:"總價帶詳情",icon:(0,a.jsx)(w.A,{className:"h-4 w-4"}),description:"各房型衛浴統計",requiresData:!0},{type:"price-band-location-chart",label:"區域成交佔比",icon:(0,a.jsx)(E.A,{className:"h-4 w-4"}),description:"各區房型分佈",requiresData:!0},{type:"price-band-location-table",label:"區域房型分佈",icon:(0,a.jsx)(w.A,{className:"h-4 w-4"}),description:"區域交叉分析表",requiresData:!0}]},{id:"unit-price",title:"單價分析",items:[{type:"unit-price-stats",label:"各用途單價統計",icon:(0,a.jsx)(y.A,{className:"h-4 w-4"}),description:"住宅/辦公/店面指標卡",requiresData:!0},{type:"unit-price-bubble",label:"單價泡泡圖",icon:(0,a.jsx)(y.A,{className:"h-4 w-4"}),description:"成交單價熱度分佈",requiresData:!0},{type:"type-comparison-table",label:"產品類型比較",icon:(0,a.jsx)(w.A,{className:"h-4 w-4"}),description:"住宅/店面/辦公均價",requiresData:!0}]},{id:"heatmap",title:"調價熱力圖",items:[{type:"heatmap-grid",label:"銷控熱力圖",icon:(0,a.jsx)(w.A,{className:"h-4 w-4"}),description:"樓層戶別價差分析",requiresData:!0},{type:"heatmap-stats",label:"調價幅度摘要",icon:(0,a.jsx)(w.A,{className:"h-4 w-4"}),description:"總溢價與平均調價",requiresData:!0},{type:"heatmap-comparison",label:"戶型溢價貢獻",icon:(0,a.jsx)(w.A,{className:"h-4 w-4"}),description:"各戶型水平價差比較",requiresData:!0}]},{id:"velocity",title:"銷售速度與房型",items:[{type:"sales-velocity-chart",label:"銷售速度趨勢",icon:(0,a.jsx)(T.A,{className:"h-4 w-4"}),description:"去化速度與量能",requiresData:!0},{type:"sales-velocity-table",label:"銷售速度明細",icon:(0,a.jsx)(w.A,{className:"h-4 w-4"}),description:"詳細銷售數據",requiresData:!0},{type:"sales-heatmap",label:"房型面積熱力圖",icon:(0,a.jsx)(w.A,{className:"h-4 w-4"}),description:"坪數去化分佈",requiresData:!0},{type:"sales-heatmap-detail",label:"熱力詳細交易表",icon:(0,a.jsx)(q.A,{className:"h-4 w-4"}),description:"熱力圖點擊詳細分析",requiresData:!0}]},{id:"parking",title:"車位分析",items:[{type:"parking-pie",label:"房車配比",icon:(0,a.jsx)(E.A,{className:"h-4 w-4"}),description:"有/無車位比例",requiresData:!0},{type:"parking-price",label:"車位均價",icon:(0,a.jsx)(L.A,{className:"h-4 w-4"}),description:"各類車位行情",requiresData:!0},{type:"parking-scatter",label:"車位坪數散佈",icon:(0,a.jsx)(y.A,{className:"h-4 w-4"}),description:"規模與價值分析",requiresData:!0},{type:"parking-floor",label:"樓層價差",icon:(0,a.jsx)(T.A,{className:"h-4 w-4"}),description:"地下室樓層價差",requiresData:!0}]},{id:"others",title:"其他",items:[{type:"data-list",label:"交易明細列表",icon:(0,a.jsx)(L.A,{className:"h-4 w-4"}),description:"原始交易數據",requiresData:!0}]}];function Y({onAddItem:e,hasData:t}){return(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[(0,a.jsx)("div",{className:"p-3 space-y-6",children:F.map(s=>(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-xs font-bold text-zinc-500 uppercase tracking-wider pl-1",children:s.title}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-2",children:s.items.map(s=>{let i=!1!==s.requiresData&&!t;return(0,a.jsxs)("button",{onClick:()=>e(s.type),disabled:i,className:(0,j.cn)("w-full p-2 rounded-lg border text-left transition-all group relative overflow-hidden flex flex-col items-center text-center gap-1.5 h-full",i?"bg-zinc-900/30 border-white/5 opacity-50 cursor-not-allowed":"bg-zinc-800/40 border-white/5 hover:bg-zinc-700/60 hover:border-violet-500/30 cursor-pointer"),children:[(0,a.jsx)("div",{className:(0,j.cn)("p-2 rounded-md transition-colors",i?"bg-zinc-800 text-zinc-600":"bg-zinc-700/50 group-hover:bg-violet-500/20 text-zinc-400 group-hover:text-violet-300"),children:s.icon}),(0,a.jsx)("div",{className:"w-full min-w-0",children:(0,a.jsx)("div",{className:"text-[11px] font-medium text-zinc-200 group-hover:text-white truncate w-full",children:s.label})}),!i&&(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent via-transparent to-white/5 opacity-0 group-hover:opacity-100 transition-opacity"})]},s.type)})})]},s.id))}),!t&&(0,a.jsx)("div",{className:"text-center py-8 text-xs text-zinc-500 px-4",children:"已開啟封面規劃；其餘圖表需先載入儀表板數據。"})]})}var X=s(87256),_=s(39768),B=s(59883),O=s(33210),G=s(44923);function K({id:e,name:t,index:s,isActive:i,canDelete:r,onClick:l,onDelete:n}){let{attributes:c,listeners:o,setNodeRef:d,transform:x,transition:h,isDragging:m}=(0,X.gl)({id:e}),{isOver:p,setNodeRef:u}=(0,G.zM)({id:`page-tab-drop-${s}`,data:{type:"page-tab",pageIndex:s}}),g=(0,v.Q)(e=>e.hoveredPageIndex)===s,b={transform:_.Ks.Transform.toString(x),transition:h};return(0,a.jsxs)("div",{ref:e=>{d(e),u(e)},style:b,...c,...o,className:(0,j.cn)("px-3 h-8 rounded-lg text-xs font-semibold flex items-center gap-2 transition-all whitespace-nowrap group cursor-grab active:cursor-grabbing select-none border border-transparent shadow-sm",i?"bg-violet-600 text-white border-violet-400/30 shadow-violet-500/20":"bg-zinc-900/50 text-zinc-400 border-white/5 hover:bg-zinc-800 hover:text-zinc-100 hover:border-white/10",m&&"opacity-50 shadow-2xl z-50 scale-105",(p||g)&&!i&&"ring-2 ring-violet-500 bg-violet-600 text-white shadow-lg scale-110 z-50 origin-bottom"),onClick:e=>{m||l()},"data-page-drop-target":"true","data-page-index":s,children:[(0,a.jsx)(B.A,{className:"h-3 w-3 text-zinc-600 group-hover:text-zinc-400 transition-colors flex-shrink-0"}),(0,a.jsx)("span",{className:"truncate max-w-[100px]",children:t}),r&&(0,a.jsx)("button",{onPointerDown:e=>{e.stopPropagation()},onClick:e=>{e.stopPropagation(),n()},className:(0,j.cn)("ml-auto p-1 rounded-md hover:bg-red-500/30 text-zinc-500 hover:text-red-400 transition-all focus:outline-none",i?"opacity-70":"opacity-0 group-hover:opacity-100"),children:(0,a.jsx)(O.A,{className:"h-3 w-3"})})]})}function W({pageIndex:e,isActive:t,children:s,onClick:i,onFocus:r}){let{setNodeRef:l,isOver:n}=(0,G.zM)({id:`page-drop-${e}`,data:{pageIndex:e}});return(0,a.jsxs)("div",{ref:l,className:(0,j.cn)("relative group outline-none transition-transform duration-200",n&&"scale-[1.02]",t?"z-10":"z-0"),"data-page-drop-zone":"true","data-page-index":e,tabIndex:0,onFocus:r,onClick:i,children:[n&&(0,a.jsx)("div",{className:"absolute inset-0 bg-violet-500/10 border-2 border-violet-500/50 rounded-lg z-50 pointer-events-none animate-pulse"}),s]})}var H=s(82482),Z=s(9199);function U(){let e=(0,v.Q)(e=>e.zoomLevel),t=(0,v.Q)(e=>e.setZoomLevel),s=(0,v.Q)(e=>e.resetZoom);return(0,a.jsxs)("div",{className:"flex items-center gap-1 bg-zinc-900/90 backdrop-blur-md border border-white/10 rounded-lg p-1 shadow-xl",children:[(0,a.jsx)(d.$,{size:"icon",variant:"ghost",className:"h-7 w-7 text-zinc-400 hover:text-white hover:bg-white/10",onClick:()=>t(e-10),title:"縮小 (Cmd + 滾輪)",children:(0,a.jsx)(H.A,{className:"h-4 w-4"})}),(0,a.jsx)("div",{className:"px-2 min-w-[3.5rem] text-center",children:(0,a.jsxs)("span",{className:"text-xs font-mono text-zinc-300 font-medium",children:[e,"%"]})}),(0,a.jsx)(d.$,{size:"icon",variant:"ghost",className:"h-7 w-7 text-zinc-400 hover:text-white hover:bg-white/10",onClick:()=>t(e+10),title:"放大 (Cmd + 滾輪)",children:(0,a.jsx)(g.A,{className:"h-4 w-4"})}),(0,a.jsx)("div",{className:"w-px h-4 bg-white/10 mx-1"}),(0,a.jsx)(d.$,{size:"icon",variant:"ghost",className:"h-7 w-7 text-zinc-400 hover:text-white hover:bg-white/10",onClick:s,title:"重置縮放 (100%)",children:(0,a.jsx)(Z.A,{className:"h-3.5 w-3.5"})})]})}var V=s(51806),J=s(60529),ee=s(17243),et=s(484);function es({isOpen:e,onClose:t,onExport:s,format:r}){let l=(0,v.Q)(e=>e.pages),n=(0,v.Q)(e=>e.currentPageIndex),[c,o]=(0,i.useState)("all"),[h,m]=(0,i.useState)({start:1,end:l.length});return(0,a.jsx)(V.a,{isOpen:e,onClose:t,title:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"p-2 rounded-lg bg-emerald-500/10 text-emerald-400",children:(0,a.jsx)(ee.A,{className:"h-5 w-5"})}),(0,a.jsxs)("span",{className:"text-xl",children:["匯出 ",r.toUpperCase()," 圖片"]})]}),maxWidth:"max-w-md",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,a.jsxs)("button",{onClick:()=>o("all"),className:`flex items-center gap-4 p-4 rounded-xl border transition-all text-left ${"all"===c?"bg-emerald-500/10 border-emerald-500/50 ring-1 ring-emerald-500/50":"bg-zinc-900/50 border-white/5 hover:border-white/10"}`,children:[(0,a.jsx)("div",{className:`p-2 rounded-lg ${"all"===c?"bg-emerald-500/20 text-emerald-400":"bg-zinc-800 text-zinc-400"}`,children:(0,a.jsx)(x.A,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-medium text-white",children:["全部頁面 (",l.length," 頁)"]}),(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:"匯出所有報告頁面"})]})]}),(0,a.jsxs)("button",{onClick:()=>o("current"),className:`flex items-center gap-4 p-4 rounded-xl border transition-all text-left ${"current"===c?"bg-emerald-500/10 border-emerald-500/50 ring-1 ring-emerald-500/50":"bg-zinc-900/50 border-white/5 hover:border-white/10"}`,children:[(0,a.jsx)("div",{className:`p-2 rounded-lg ${"current"===c?"bg-emerald-500/20 text-emerald-400":"bg-zinc-800 text-zinc-400"}`,children:(0,a.jsx)(ee.A,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"font-medium text-white",children:["僅限目前頁面 (第 ",n+1," 頁)"]}),(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:"僅匯出當前正編輯的頁面"})]})]}),(0,a.jsxs)("button",{onClick:()=>o("range"),className:`flex items-center gap-4 p-4 rounded-xl border transition-all text-left ${"range"===c?"bg-emerald-500/10 border-emerald-500/50 ring-1 ring-emerald-500/50":"bg-zinc-900/50 border-white/5 hover:border-white/10"}`,children:[(0,a.jsx)("div",{className:`p-2 rounded-lg ${"range"===c?"bg-emerald-500/20 text-emerald-400":"bg-zinc-800 text-zinc-400"}`,children:(0,a.jsx)(et.A,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium text-white",children:"指定範圍"}),(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:"自定義要匯出的頁碼範圍"})]})]})]}),"range"===c&&(0,a.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-zinc-950/50 rounded-xl border border-white/5 animate-in fade-in slide-in-from-top-2 duration-200",children:[(0,a.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,a.jsx)("label",{className:"text-[10px] uppercase tracking-wider text-zinc-500 font-bold ml-1",children:"起始頁碼"}),(0,a.jsx)(J.p,{type:"number",min:1,max:l.length,value:h.start,onChange:e=>m(t=>({...t,start:parseInt(e.target.value)||1})),className:"bg-zinc-900 border-white/5 h-10"})]}),(0,a.jsx)("div",{className:"text-zinc-700 mt-5",children:"至"}),(0,a.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,a.jsx)("label",{className:"text-[10px] uppercase tracking-wider text-zinc-500 font-bold ml-1",children:"結束頁碼"}),(0,a.jsx)(J.p,{type:"number",min:1,max:l.length,value:h.end,onChange:e=>m(t=>({...t,end:parseInt(e.target.value)||1})),className:"bg-zinc-900 border-white/5 h-10"})]})]}),(0,a.jsxs)("div",{className:"pt-2 flex gap-3",children:[(0,a.jsx)(d.$,{variant:"outline",onClick:t,className:"flex-1 bg-zinc-900 border-white/5",children:"取消"}),(0,a.jsx)(d.$,{onClick:()=>{let e=[];if("all"===c)e=l.map((e,t)=>t);else if("current"===c)e=[n];else if("range"===c){let t=Math.max(0,h.start-1),s=Math.min(l.length-1,h.end-1);for(let a=t;a<=s;a++)e.push(a)}s(e)},className:"flex-1 bg-emerald-600 hover:bg-emerald-500 text-white border-none shadow-lg shadow-emerald-900/20",children:"開始匯出"})]})]})})}var ea=s(50858),ei=s(96524),er=s(55161),el=s(24371),en=s(70872);function ec({selectedIds:e,onScaleModeChange:t,onDelete:s}){let i=(0,v.Q)(e=>e.pages),r=(0,v.Q)(e=>e.currentPageIndex);if(0===e.length)return null;let l=i[r]?.items.find(t=>t.id===e[0]),n=l?.scaleMode||"select";return(0,a.jsx)("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 z-50",children:(0,a.jsxs)("div",{className:"bg-zinc-900/90 backdrop-blur-xl border border-white/10 rounded-full p-2 shadow-2xl flex items-center gap-2 ring-1 ring-black/50",children:[(0,a.jsxs)("div",{className:"text-[10px] text-zinc-500 font-medium px-3 border-r border-white/10 select-none",children:[e.length," 選取"]}),(0,a.jsx)(en.Bc,{delayDuration:0,children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsxs)(en.m_,{children:[(0,a.jsx)(en.k$,{asChild:!0,children:(0,a.jsxs)(d.$,{size:"sm",variant:"ghost",onClick:()=>t("select"),className:(0,j.cn)("h-8 px-3 rounded-full transition-all duration-200","select"===n?"bg-white/20 text-white hover:bg-white/30 ring-1 ring-white/50":"text-zinc-400 hover:text-white hover:bg-white/5"),children:[(0,a.jsx)(ea.A,{className:"h-3.5 w-3.5 mr-1.5"}),(0,a.jsx)("span",{className:"text-xs font-medium",children:"選取"})]})}),(0,a.jsx)(en.ZI,{side:"top",className:"text-xs bg-zinc-900 border-white/10",children:"僅選取不進行編輯"})]}),(0,a.jsx)("div",{className:"w-px h-4 bg-white/10 mx-1"}),(0,a.jsxs)(en.m_,{children:[(0,a.jsx)(en.k$,{asChild:!0,children:(0,a.jsxs)(d.$,{size:"sm",variant:"ghost",onClick:()=>t("crop"),className:(0,j.cn)("h-8 px-3 rounded-full transition-all duration-200","crop"===n?"bg-violet-600/20 text-violet-300 hover:bg-violet-600/30 ring-1 ring-violet-500/50":"text-zinc-400 hover:text-white hover:bg-white/5"),children:[(0,a.jsx)(ei.A,{className:"h-3.5 w-3.5 mr-1.5"}),(0,a.jsx)("span",{className:"text-xs font-medium",children:"剪裁"})]})}),(0,a.jsx)(en.ZI,{side:"top",className:"text-xs bg-zinc-900 border-white/10",children:"內容溢出時自動裁剪"})]}),(0,a.jsxs)(en.m_,{children:[(0,a.jsx)(en.k$,{asChild:!0,children:(0,a.jsxs)(d.$,{size:"sm",variant:"ghost",onClick:()=>t("pan"),className:(0,j.cn)("h-8 px-3 rounded-full transition-all duration-200","pan"===n?"bg-cyan-600/20 text-cyan-300 hover:bg-cyan-600/30 ring-1 ring-cyan-500/50":"text-zinc-400 hover:text-white hover:bg-white/5"),children:[(0,a.jsx)(er.A,{className:"h-3.5 w-3.5 mr-1.5"}),(0,a.jsx)("span",{className:"text-xs font-medium",children:"平移"})]})}),(0,a.jsx)(en.ZI,{side:"top",className:"text-xs bg-zinc-900 border-white/10",children:"拖動內容以調整位置"})]}),(0,a.jsxs)(en.m_,{children:[(0,a.jsx)(en.k$,{asChild:!0,children:(0,a.jsxs)(d.$,{size:"sm",variant:"ghost",onClick:()=>t("fit"),className:(0,j.cn)("h-8 px-3 rounded-full transition-all duration-200","fit"===n?"bg-emerald-600/20 text-emerald-300 hover:bg-emerald-600/30 ring-1 ring-emerald-500/50":"text-zinc-400 hover:text-white hover:bg-white/5"),children:[(0,a.jsx)(el.A,{className:"h-3.5 w-3.5 mr-1.5"}),(0,a.jsx)("span",{className:"text-xs font-medium",children:"縮放"})]})}),(0,a.jsx)(en.ZI,{side:"top",className:"text-xs bg-zinc-900 border-white/10",children:"自動縮放以填滿容器"})]}),(0,a.jsx)("div",{className:"w-px h-4 bg-white/10 mx-1"}),(0,a.jsxs)(en.m_,{children:[(0,a.jsx)(en.k$,{asChild:!0,children:(0,a.jsx)(d.$,{size:"sm",variant:"ghost",onClick:s,className:"h-8 px-3 rounded-full text-zinc-400 hover:text-red-400 hover:bg-red-500/10 transition-all duration-200",children:(0,a.jsx)(m.A,{className:"h-3.5 w-3.5"})})}),(0,a.jsx)(en.ZI,{side:"top",className:"text-xs bg-zinc-900 border-white/10 text-red-400",children:"刪除選中元件"})]})]})})]})})}let eo=(0,o.i)(function(){let{loading:e,analysisData:t}=(0,c.g)(),r=(0,v.Q)(e=>e.pages),o=(0,v.Q)(e=>e.currentPageIndex),N=(0,v.Q)(e=>e.canvasRatio),w=(0,v.Q)(e=>e.viewMode),y=(0,v.Q)(e=>e.setViewMode),z=(0,v.Q)(e=>e.selectedIds),k=(0,v.Q)(e=>e.addItem),A=(0,v.Q)(e=>e.updateItem),C=(0,v.Q)(e=>e.removeItem),S=(0,v.Q)(e=>e.clearCanvas),P=(0,v.Q)(e=>e.setCanvasRatio),M=(0,v.Q)(e=>e.setSelectedIds),D=(0,v.Q)(e=>e.toggleSelection),$=(0,v.Q)(e=>e.addToSelection),Q=(0,v.Q)(e=>e.clearSelection),I=(0,v.Q)(e=>e.removeSelectedItems);(0,v.Q)(e=>e.moveSelectedItemsToPage);let L=(0,v.Q)(e=>e.addPage),E=(0,v.Q)(e=>e.deletePage),T=(0,v.Q)(e=>e.renamePage),q=(0,v.Q)(e=>e.setCurrentPage),F=(0,v.Q)(e=>e.reorderPages),_=(0,v.Q)(e=>e.moveItemToPage),B=(0,v.Q)(e=>e.batchUpdateItems),[O,H]=(0,i.useState)(null),Z=(0,v.Q)(e=>e.isDragging),V=(0,v.Q)(e=>e.draggedItemCount),J=(0,v.Q)(e=>e.hoveredPageIndex),[ee,et]=(0,i.useState)({x:0,y:0}),[ea,ei]=(0,i.useState)(!0),[er,el]=(0,i.useState)(!1),[en,eo]=(0,i.useState)("png"),[ed,ex]=(0,i.useState)(!1),[eh,em]=(0,i.useState)({current:0,total:0});i.useEffect(()=>{let e=e=>{Z&&et({x:e.clientX,y:e.clientY})},t=e=>{!(document.activeElement?.tagName==="INPUT"||document.activeElement?.tagName==="TEXTAREA"||document.activeElement?.isContentEditable)&&("Delete"===e.key||"Backspace"===e.key)&&z.length>0&&(e.preventDefault(),I())};return window.addEventListener("mousemove",e),window.addEventListener("keydown",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("keydown",t)}},[Z,z,I]);let ep=(0,i.useCallback)(e=>{let t={};z.forEach(s=>{t[s]={scaleMode:e}}),B(t)},[z,B]),eu=(0,G.FR)((0,G.MS)(G.AN,{activationConstraint:{distance:5}})),eg=r[o],eb=eg?.items||[],ej="16:9"===N?{width:960,height:540}:"A4"===N?{width:595,height:842}:"1:1"===N?{width:900,height:900}:"9:16"===N?{width:540,height:960}:{width:720,height:900},ev=(0,i.useCallback)(e=>{k(e)},[k]),ef=(0,i.useCallback)((e,t)=>{A(e,t)},[A]),eN=(0,i.useCallback)(e=>{C(e)},[C]),ew=(0,i.useCallback)(()=>{L()},[L]),ey=(0,i.useCallback)(e=>{!(r.length<=1)&&confirm("確定要刪除此頁面嗎？")&&E(e)},[E,r.length]),ez=(0,i.useCallback)(()=>{let e=v.Q.getState(),t=e.pages[0];if(!t)return;let s=t.items.some(e=>"cover-template"===e.type),a=t.items.some(e=>"cover-template"!==e.type);if(!s&&a&&!confirm("第一頁已有內容，規劃封面會先清空第一頁。是否繼續？"))return;e.setCurrentPage(0),e.clearSelection(),s||(e.clearCanvas(),e.addItem("cover-template"));let i=v.Q.getState().pages[0],r=i?.items.filter(e=>"cover-template"===e.type).slice(-1)[0];r&&(e.updateItem(r.id,{x:0,y:0,width:ej.width,height:ej.height}),e.setSelectedIds([r.id])),T(t.id,"封面")},[ej.height,ej.width,T]),ek=(0,i.useCallback)(e=>{String(e.active.id).startsWith("item-")&&H(String(e.active.id))},[]),eA=(0,i.useCallback)(e=>{let{active:t,over:s}=e;if(H(null),!s)return;if(String(t.id).startsWith("page-")&&String(s.id).startsWith("page-")){let e=r.findIndex(e=>e.id===t.id),a=r.findIndex(e=>e.id===s.id);-1!==e&&-1!==a&&e!==a&&F(e,a)}let a=String(s.id);if(String(t.id).startsWith("item-")){let e=-1;a.startsWith("page-drop-")?e=parseInt(a.replace("page-drop-",""),10):a.startsWith("page-tab-drop-")&&(e=parseInt(a.replace("page-tab-drop-",""),10)),-1===e||isNaN(e)||(_(String(t.id),e),q(e))}},[r,F,_,q]),eC=(0,i.useCallback)(()=>{let e=document.querySelector(".report-canvas-content");if(!e)return;let t=window.open("","_blank");if(!t)return;let s=Array.from(document.styleSheets).map(e=>{try{return Array.from(e.cssRules).map(e=>e.cssText).join("")}catch(e){return""}}).join(""),a="16:9"===N?{width:960,height:540}:{width:842,height:595};t.document.write(`
            <html>
                <head>
                    <title>SQM Report - ${new Date().toLocaleDateString()}</title>
                    <style>
                        ${s}
                        @media print {
                            @page {
                                size: ${"A4"===N?"A4 landscape":"960px 540px"};
                                margin: 0;
                            }
                            body { margin: 0; padding: 0; background: #09090b !important; -webkit-print-color-adjust: exact; }
                            .print-canvas {
                                width: ${a.width}px;
                                height: ${a.height}px;
                                position: relative;
                                background: #09090b;
                                overflow: hidden;
                            }
                            .rnd-resizer, .no-print { display: none !important; }
                        }
                    </style>
                </head>
                <body>
                    <div class="print-canvas">
                        ${e.innerHTML}
                    </div>
                    <script>
                        window.onload = () => {
                            setTimeout(() => {
                                window.print();
                            }, 1000);
                        };
                    </script>
                </body>
            </html>
        `),t.document.close()},[N]),eS=(0,i.useCallback)(e=>{eo(e),el(!0)},[]),eP=(0,i.useCallback)(async e=>{el(!1),ex(!0),em({current:0,total:e.length});let t=v.Q.getState().currentPageIndex,a=v.Q.getState().viewMode;try{let{domToPng:t,domToJpeg:a}=await s.e(8028).then(s.bind(s,98028));for(let s=0;s<e.length;s++){let i,r=e[s];em({current:s+1,total:e.length}),v.Q.getState().setCurrentPage(r),await new Promise(e=>setTimeout(e,500));let l=document.querySelector(".report-canvas-content");if(!l){console.error(`Canvas element not found for page ${r}`);continue}let n=ej.width,c=ej.height,o={scale:2,backgroundColor:"#09090b",width:n,height:c,style:{transform:"none",width:`${n}px`,height:`${c}px`}};i="png"===en?await t(l,o):await a(l,{...o,quality:.95});let d=document.createElement("a");d.download=`SQM-Report-P${r+1}-${new Date().getTime()}.${en}`,d.href=i,d.click()}}catch(e){console.error("Batch export failed:",e),alert("批次匯出失敗，部分頁面可能未完成。")}finally{v.Q.getState().setCurrentPage(t),v.Q.getState().setViewMode(a),ex(!1)}},[ej,en]),eM=(0,i.useCallback)(()=>{confirm("確定要清空當前頁面的所有元件嗎？")&&S()},[S]),eD=r.some(e=>e.items.some(e=>"cover-template"===e.type));return(0,a.jsxs)(n.e,{children:[(0,a.jsx)(ec,{selectedIds:z,onScaleModeChange:ep,onDelete:I}),(0,a.jsxs)(G.Mp,{sensors:eu,collisionDetection:G.fp,onDragStart:ek,onDragEnd:eA,children:[(0,a.jsxs)("div",{className:"flex h-[calc(100vh-theme(spacing.20))] gap-4",children:[(0,a.jsxs)("aside",{className:"w-80 flex-shrink-0 bg-zinc-900/50 border border-white/5 rounded-xl overflow-hidden flex flex-col",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-white/5 bg-zinc-900",children:[(0,a.jsxs)("h2",{className:"font-semibold text-white flex items-center gap-2",children:[(0,a.jsx)(x.A,{className:"h-5 w-5 text-violet-400"}),"元件面板"]}),(0,a.jsx)("p",{className:"text-xs text-zinc-500 mt-1",children:"點擊或拖曳新增到畫布"})]}),(0,a.jsx)(Y,{onAddItem:ev,hasData:!!t}),(0,a.jsxs)("div",{className:"p-4 border-t border-white/5 bg-zinc-900 space-y-3",children:[(0,a.jsx)("div",{className:"text-xs text-zinc-400 font-medium",children:"畫布比例"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(d.$,{size:"sm",variant:"16:9"===N?"default":"outline",onClick:()=>P("16:9"),className:(0,j.cn)("flex-1 h-12 flex-col gap-1","16:9"===N?"bg-violet-600":"border-zinc-700"),title:"16:9 (簡報/影片)",children:[(0,a.jsx)("div",{className:(0,j.cn)("w-8 h-[18px] border-2","16:9"===N?"border-white":"border-zinc-500")}),(0,a.jsx)("span",{className:"text-[10px]",children:"16:9"})]}),(0,a.jsxs)(d.$,{size:"sm",variant:"A4"===N?"default":"outline",onClick:()=>P("A4"),className:(0,j.cn)("flex-1 h-12 flex-col gap-1","A4"===N?"bg-violet-600":"border-zinc-700"),title:"A4 (直式列印)",children:[(0,a.jsx)("div",{className:(0,j.cn)("w-[14px] h-5 border-2","A4"===N?"border-white":"border-zinc-500")}),(0,a.jsx)("span",{className:"text-[10px]",children:"A4"})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(d.$,{size:"sm",variant:"1:1"===N?"default":"outline",onClick:()=>P("1:1"),className:(0,j.cn)("flex-1 h-12 flex-col gap-1","1:1"===N?"bg-violet-600":"border-zinc-700"),title:"1:1 (IG/FB方圖)",children:[(0,a.jsx)("div",{className:(0,j.cn)("w-4 h-4 border-2","1:1"===N?"border-white":"border-zinc-500")}),(0,a.jsx)("span",{className:"text-[10px]",children:"1:1"})]}),(0,a.jsxs)(d.$,{size:"sm",variant:"9:16"===N?"default":"outline",onClick:()=>P("9:16"),className:(0,j.cn)("flex-1 h-12 flex-col gap-1","9:16"===N?"bg-violet-600":"border-zinc-700"),title:"9:16 (IG限動)",children:[(0,a.jsx)("div",{className:(0,j.cn)("w-[11px] h-5 border-2","9:16"===N?"border-white":"border-zinc-500")}),(0,a.jsx)("span",{className:"text-[10px]",children:"9:16"})]}),(0,a.jsxs)(d.$,{size:"sm",variant:"4:5"===N?"default":"outline",onClick:()=>P("4:5"),className:(0,j.cn)("flex-1 h-12 flex-col gap-1","4:5"===N?"bg-violet-600":"border-zinc-700"),title:"4:5 (FB/IG直式)",children:[(0,a.jsx)("div",{className:(0,j.cn)("w-4 h-5 border-2","4:5"===N?"border-white":"border-zinc-500")}),(0,a.jsx)("span",{className:"text-[10px]",children:"4:5"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(d.$,{className:"w-full bg-emerald-600 hover:bg-emerald-700 h-10",disabled:0===eb.length,onClick:eC,children:[(0,a.jsx)(h.A,{className:"h-4 w-4 mr-2"}),"匯出 PDF"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(d.$,{size:"sm",variant:"outline",className:"flex-1 border-emerald-900/50 text-emerald-400 hover:bg-emerald-500/10 h-8 text-[10px]",disabled:0===eb.length,onClick:()=>eS("png"),children:"PNG 圖片"}),(0,a.jsx)(d.$,{size:"sm",variant:"outline",className:"flex-1 border-emerald-900/50 text-emerald-400 hover:bg-emerald-500/10 h-8 text-[10px]",disabled:0===eb.length,onClick:()=>eS("jpg"),children:"JPG 圖片"})]})]}),(0,a.jsxs)(d.$,{variant:"outline",className:"w-full border-zinc-800 text-zinc-500 hover:text-red-400 hover:border-red-500/30 h-9 text-xs",disabled:0===eb.length,onClick:eM,children:[(0,a.jsx)(m.A,{className:"h-3.5 w-3.5 mr-2"}),"清空畫布"]})]})]}),(0,a.jsxs)("main",{className:"flex-1 bg-zinc-950 rounded-xl overflow-hidden flex flex-col relative",children:[(0,a.jsxs)("div",{className:"h-12 border-b border-white/5 flex items-center justify-between px-4 bg-zinc-900/80",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-zinc-400",children:["報表編輯器 • ",N," • 第 ",o+1,"/",r.length," 頁 • ",eb.length," 個元件"]}),(0,a.jsx)("div",{className:"h-6 w-px bg-white/10 mx-2"}),(0,a.jsxs)("div",{className:"bg-zinc-900 border border-white/10 rounded-lg p-0.5 flex",children:[(0,a.jsx)(d.$,{size:"icon",variant:"ghost",onClick:()=>y("single"),className:(0,j.cn)("h-6 w-6 rounded-md","single"===w?"bg-white/20 text-white":"text-zinc-500 hover:text-white"),title:"單頁模式",children:(0,a.jsx)("div",{className:"w-3 h-4 border border-current rounded-[1px]"})}),(0,a.jsx)(d.$,{size:"icon",variant:"ghost",onClick:()=>y("continuous"),className:(0,j.cn)("h-6 w-6 rounded-md","continuous"===w?"bg-white/20 text-white":"text-zinc-500 hover:text-white"),title:"多頁模式",children:(0,a.jsxs)("div",{className:"flex flex-col gap-[1px]",children:[(0,a.jsx)("div",{className:"w-3 h-2 border border-current rounded-[1px]"}),(0,a.jsx)("div",{className:"w-3 h-2 border border-current rounded-[1px]"})]})})]}),(0,a.jsx)(U,{})]}),(0,a.jsxs)("div",{className:"h-10 border-b border-white/5 flex items-center px-2 bg-zinc-900/50 gap-1 overflow-x-auto",children:[(0,a.jsx)(d.$,{size:"icon",variant:"ghost",className:"h-7 w-7 flex-shrink-0",onClick:()=>q(o-1),disabled:0===o,children:(0,a.jsx)(p.A,{className:"h-4 w-4"})}),(0,a.jsx)(X.gB,{items:r.map(e=>e.id),strategy:X.m$,children:r.map((e,t)=>(0,a.jsx)(K,{id:e.id,name:e.name,index:t,isActive:t===o,canDelete:r.length>1,onClick:()=>q(t),onDelete:()=>ey(e.id)},e.id))}),(0,a.jsx)(d.$,{size:"icon",variant:"ghost",className:"h-7 w-7 flex-shrink-0",onClick:()=>q(o+1),disabled:o===r.length-1,children:(0,a.jsx)(u.A,{className:"h-4 w-4"})}),(0,a.jsxs)(d.$,{size:"sm",variant:"ghost",className:"h-7 px-2 text-violet-400 hover:text-violet-300 hover:bg-violet-500/10 flex-shrink-0",onClick:ew,children:[(0,a.jsx)(g.A,{className:"h-4 w-4 mr-1"}),"新增頁面"]}),(0,a.jsxs)(d.$,{size:"sm",variant:"ghost",className:"h-7 px-2 text-cyan-400 hover:text-cyan-300 hover:bg-cyan-500/10 flex-shrink-0",onClick:ez,children:[(0,a.jsx)(b.A,{className:"h-4 w-4 mr-1"}),"規劃封面"]})]}),(0,a.jsx)("div",{className:"flex-1 p-8 flex flex-col items-center bg-zinc-950/50 overflow-auto scroll-smooth",onWheel:e=>{if(e.ctrlKey||e.metaKey){e.preventDefault();let t=e.deltaY>0?-10:10,s=Math.min(Math.max(v.Q.getState().zoomLevel+t,10),200);v.Q.getState().setZoomLevel(s)}},children:t||e||eD?(0,a.jsx)("div",{className:"space-y-8 pb-20",children:"single"===w?r[o]&&(0,a.jsxs)(W,{pageIndex:o,isActive:!0,onFocus:()=>{},onClick:()=>{},children:[(0,a.jsxs)("div",{className:"absolute -top-6 left-0 text-[10px] font-medium text-violet-300 bg-violet-500/10 border-t border-x border-violet-500/20 px-2 py-0.5 rounded-t-md",children:["Page ",o+1," - ",r[o].name]}),(0,a.jsx)("div",{className:"ring-2 ring-violet-500/30 shadow-2xl shadow-violet-900/10 transition-shadow duration-200",children:(0,a.jsx)(f,{width:ej.width,height:ej.height,items:r[o].items,onClickBackground:()=>Q(),onMarqueeSelect:(e,t)=>{t?e.forEach(e=>$(e)):M(e)},children:r[o].items.map(e=>(0,a.jsx)(R,{item:e,isSelected:z.includes(e.id),onSelect:t=>{t?.ctrlKey||t?.metaKey?D(e.id):M([e.id])},onUpdate:t=>ef(e.id,t),onRemove:()=>eN(e.id),onMoveToPage:t=>_(e.id,t),analysisData:t},e.id))})})]},"single-page-view"):r.map((e,s)=>(0,a.jsxs)(W,{pageIndex:s,isActive:s===o,onFocus:()=>q(s),onClick:()=>q(s),children:[(0,a.jsxs)("div",{className:(0,j.cn)("absolute -top-6 left-0 text-[10px] font-medium transition-colors px-2 py-0.5 rounded-t-md",s===o?"text-violet-300 bg-violet-500/10 border-t border-x border-violet-500/20":"text-zinc-500"),children:["Page ",s+1," - ",e.name]}),(0,a.jsx)("div",{className:(0,j.cn)("transition-shadow duration-200",s===o?"ring-2 ring-violet-500/30 shadow-2xl shadow-violet-900/10":"opacity-90 hover:opacity-100"),children:(0,a.jsx)(f,{width:ej.width,height:ej.height,items:e.items,onClickBackground:()=>{Q(),q(s)},onMarqueeSelect:(e,t)=>{q(s),t?e.forEach(e=>$(e)):M(e)},children:e.items.map(e=>(0,a.jsx)(R,{item:e,isSelected:z.includes(e.id),onSelect:t=>{q(s),t?.ctrlKey||t?.metaKey?D(e.id):M([e.id])},onUpdate:t=>ef(e.id,t),onRemove:()=>eN(e.id),onMoveToPage:t=>_(e.id,t),analysisData:t},e.id))})})]},e.id))}):(0,a.jsxs)("div",{className:"text-center space-y-4 mt-20",children:[(0,a.jsx)("div",{className:"p-6 rounded-full bg-zinc-900 border border-white/5 inline-block",children:(0,a.jsx)(x.A,{className:"h-10 w-10 text-zinc-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-white",children:"尚未載入數據"}),(0,a.jsxs)("p",{className:"text-zinc-500 text-sm mt-1",children:["請先至 ",(0,a.jsx)(l(),{href:"/dashboard",className:"text-violet-400 hover:underline",children:"儀表板"})," 進行分析"]}),(0,a.jsx)("p",{className:"text-zinc-400 text-xs mt-2",children:"或先點上方「規劃封面」建立封面頁。"})]})]})})]})]}),(0,a.jsx)(G.Hd,{dropAnimation:null,children:O?(0,a.jsxs)("div",{className:"px-4 py-3 bg-violet-600/80 backdrop-blur-sm text-white rounded-lg shadow-2xl border border-violet-400/50 flex items-center gap-2 pointer-events-none",children:[(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-white/80 rounded flex items-center justify-center",children:(0,a.jsx)(g.A,{className:"w-4 h-4"})}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:["多選拖移中... ",z.length>1?`(${z.length} 個元件)`:""]})]}):null}),Z&&!O&&(!ea||null!==J&&J!==o)&&(0,a.jsxs)("div",{className:(0,j.cn)("fixed z-[9999] pointer-events-none px-3 py-1.5 bg-violet-600 text-white rounded-full shadow-xl border-2 border-white/20 flex items-center gap-2 transform -translate-x-1/2 -translate-y-[150%] transition-transform",null!==J&&J!==o?"scale-110 bg-violet-500":""),style:{left:ee.x,top:ee.y},children:[(0,a.jsx)(g.A,{className:"w-4 h-4"}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{className:"text-xs font-bold leading-none",children:null!==J&&J!==o?`移動至第 ${J+1} 頁`:"跨頁移動"}),V>1&&(0,a.jsxs)("span",{className:"text-[9px] opacity-80 leading-none mt-0.5",children:["選取 ",V," 個元件"]})]})]})]}),(0,a.jsx)(es,{isOpen:er,onClose:()=>el(!1),onExport:eP,format:en}),ed&&(0,a.jsx)("div",{className:"fixed inset-0 z-[10000] flex items-center justify-center bg-black/80 backdrop-blur-md animate-in fade-in duration-300",children:(0,a.jsxs)("div",{className:"text-center space-y-6 max-w-sm w-full px-6",children:[(0,a.jsxs)("div",{className:"relative mx-auto w-24 h-24",children:[(0,a.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-emerald-500/20"}),(0,a.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-emerald-500 border-t-transparent animate-spin",style:{animationDuration:"1.5s"}}),(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsx)(h.A,{className:"h-8 w-8 text-emerald-400"})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-white",children:"正在處理匯出..."}),(0,a.jsxs)("p",{className:"text-emerald-400 font-mono text-sm tracking-widest",children:["PAGE ",eh.current," OF ",eh.total]})]}),(0,a.jsx)("div",{className:"h-2 w-full bg-zinc-800 rounded-full overflow-hidden",children:(0,a.jsx)("div",{className:"h-full bg-emerald-500 transition-all duration-300 ease-out shadow-[0_0_10px_rgba(16,185,129,0.5)]",style:{width:`${eh.current/eh.total*100}%`}})}),(0,a.jsx)("p",{className:"text-zinc-500 text-xs italic",children:"請勿關閉視窗，正在準備下載內容"})]})})]})})},86120:(e,t,s)=>{"use strict";s.d(t,{b:()=>h,i:()=>m});var a=s(95155),i=s(12115),r=s(73321),l=s(16385),n=s(39430),c=s(62032),o=s(66614),d=s(80723);function x(){let e=(0,r.useRouter)();return(0,a.jsxs)("div",{className:"min-h-screen bg-black flex items-center justify-center p-4 relative overflow-hidden",children:[(0,a.jsx)("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-red-600/10 rounded-full blur-[128px] pointer-events-none"}),(0,a.jsx)("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-amber-600/10 rounded-full blur-[128px] pointer-events-none"}),(0,a.jsx)("div",{className:"relative z-10 max-w-md w-full",children:(0,a.jsxs)(n.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5},className:"bg-zinc-900/50 backdrop-blur-xl border border-red-500/20 rounded-3xl p-8 shadow-2xl overflow-hidden",children:[(0,a.jsxs)(n.P.div,{className:"w-20 h-20 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-6 border border-red-500/20 relative",initial:{rotate:-180,opacity:0},animate:{rotate:0,opacity:1},transition:{delay:.2,type:"spring"},children:[(0,a.jsx)(c.A,{className:"w-10 h-10 text-red-500"}),(0,a.jsx)(n.P.div,{className:"absolute inset-0 bg-red-500/20 rounded-full",animate:{scale:[1,1.2,1]},transition:{duration:2,repeat:1/0}})]}),(0,a.jsxs)("div",{className:"text-center space-y-3 mb-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-white tracking-tight",children:"Access Denied"}),(0,a.jsxs)("p",{className:"text-zinc-400 text-sm leading-relaxed",children:["權限不足。此區域僅限系統管理員訪問。",(0,a.jsx)("br",{}),"若您認為這是錯誤，請聯繫技術支援。"]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("button",{onClick:()=>e.push("/dashboard"),className:"w-full flex items-center justify-center gap-2 bg-white text-black hover:bg-zinc-200 font-bold py-3.5 px-4 rounded-xl transition-all active:scale-[0.98]",children:[(0,a.jsx)(o.A,{className:"w-4 h-4"}),"返回主控台 (Dashboard)"]}),(0,a.jsxs)("button",{onClick:()=>e.back(),className:"w-full flex items-center justify-center gap-2 bg-transparent hover:bg-white/5 text-zinc-400 hover:text-white font-medium py-3.5 px-4 rounded-xl border border-white/5 hover:border-white/10 transition-all active:scale-[0.98]",children:[(0,a.jsx)(d.A,{className:"w-4 h-4"}),"回上一頁"]})]}),(0,a.jsx)(n.P.div,{className:"mt-8 pt-6 border-t border-white/5 text-center",initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},children:(0,a.jsx)("p",{className:"text-[10px] text-zinc-600 font-mono uppercase tracking-widest",children:"Error: 403_FORBIDDEN"})})]})})]})}function h(){let[e,t]=(0,i.useState)({user:null,isAdmin:!1,permissions:{canPostAnnouncement:!1,accessibleCounties:[],isSuperAdmin:!1},isLoading:!0,error:null});return(0,i.useEffect)(()=>{let e=async()=>{try{let{data:{session:e},error:s}=await l.N.auth.getSession();if(s)throw s;if(!e?.user)return void t({user:null,isAdmin:!1,permissions:{canPostAnnouncement:!1,accessibleCounties:[],isSuperAdmin:!1},isLoading:!1,error:null});let{data:a,error:i}=await l.N.from("profiles").select("role, accessible_counties, can_post_announcement").eq("id",e.user.id).single();if(i){console.warn("Profile fetch error:",i),t({user:e.user,isAdmin:!1,permissions:{canPostAnnouncement:!1,accessibleCounties:[],isSuperAdmin:!1},isLoading:!1,error:null});return}let r=a?.role==="super_admin",n=a?.role==="admin"||r,c=r?null:a?.accessible_counties,o=!!r||a?.can_post_announcement||!1;t({user:e.user,isAdmin:n,permissions:{canPostAnnouncement:o,accessibleCounties:c,isSuperAdmin:r},isLoading:!1,error:null})}catch(e){console.error("Admin auth check error:",e),t({user:null,isAdmin:!1,permissions:{canPostAnnouncement:!1,accessibleCounties:[],isSuperAdmin:!1},isLoading:!1,error:e.message})}};e();let{data:{subscription:s}}=l.N.auth.onAuthStateChange(()=>{e()});return()=>s.unsubscribe()},[]),e}function m(e){return function(t){let{user:s,isAdmin:l,isLoading:n,error:c}=h(),o=(0,r.useRouter)();return((0,i.useEffect)(()=>{n||l||o.replace("/")},[n,l,o]),n)?(0,a.jsx)("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)("div",{className:"h-8 w-8 border-2 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin mx-auto"}),(0,a.jsx)("p",{className:"text-zinc-500 text-sm",children:"驗證管理員權限..."})]})}):s?l?(0,a.jsx)(e,{...t}):(0,a.jsx)(x,{}):(0,a.jsx)("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center space-y-4 p-8",children:[(0,a.jsx)("div",{className:"text-4xl",children:"\uD83D\uDD12"}),(0,a.jsx)("h1",{className:"text-xl font-bold text-white",children:"請先登入"}),(0,a.jsx)("p",{className:"text-zinc-500",children:"此頁面需要登入才能訪問"}),(0,a.jsx)("button",{onClick:()=>o.push("/"),className:"bg-cyan-600 hover:bg-cyan-500 text-white px-6 py-2 rounded-lg transition-colors",children:"前往登入"})]})})}}}},e=>{e.O(0,[4764,5969,3242,6119,5772,8630,7239,8112,8500,8875,916,5679,8441,3794,7358],()=>e(e.s=64977)),_N_E=e.O()}]);