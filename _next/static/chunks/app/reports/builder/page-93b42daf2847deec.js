(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3806],{64977:(e,t,a)=>{Promise.resolve().then(a.bind(a,67899))},67899:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eN});var s=a(95155),r=a(12115),i=a(98500),n=a.n(i),l=a(95542),o=a(39734),c=a(86120),d=a(89239),h=a(33024),u=a(60241),x=a(24371),m=a(91663),p=a(68459),g=a(41641),b=a(21362),f=a(51914),v=a(48368),j=a(40980),w=a(96066);let N=new Set;function y({width:e,height:t,children:a,items:i,fullBleed:n=!1,onClickBackground:l,onMarqueeSelect:o,autoFit:c=!0,zoomOverride:d,enableWheelZoom:h=!0}){let u=(0,r.useRef)(null),x=(0,r.useRef)(null),m=(0,w.Q)(e=>e.zoomLevel),p=(0,w.Q)(e=>e.setZoomLevel),[g,b]=(0,r.useState)(!1),[f,v]=(0,r.useState)(null),y=(d??m)/100;r.useEffect(()=>{c&&void 0===d&&(()=>{if(u.current){let a=u.current.parentElement;if(a){let s=Math.min((a.clientWidth-100)/e,(a.clientHeight-100)/t),r=`${e}x${t}`;N.has(r)||(p(Math.floor(100*s)),N.add(r))}}})()},[e,t,p,c,d]);let z=(0,r.useCallback)(e=>{h&&void 0===d&&(e.ctrlKey||e.metaKey)&&(e.preventDefault(),p(m+(e.deltaY>0?-5:5)))},[m,p,h,d]),k=(0,r.useCallback)(e=>{let t=e.target,a=x.current?.querySelector(".report-canvas-content"),s=t.closest(".react-draggable")||t.closest("[data-chart-item]"),r=e.target===e.currentTarget||t===a||t.classList.contains("report-canvas-content")||t.style.backgroundImage?.includes("linear-gradient");if(s||!r&&!t.closest(".report-canvas-content"))return;let i=e.currentTarget.getBoundingClientRect(),n=(e.clientX-i.left)/y,l=(e.clientY-i.top)/y;b(!0),v({startX:n,startY:l,endX:n,endY:l,isShiftPressed:e.shiftKey})},[y]),S=(0,r.useCallback)(a=>{if(!g||!f)return;let s=a.currentTarget.getBoundingClientRect(),r=Math.max(0,Math.min(e,(a.clientX-s.left)/y)),i=Math.max(0,Math.min(t,(a.clientY-s.top)/y));v(e=>e?{...e,endX:r,endY:i,isShiftPressed:a.shiftKey}:null)},[g,f,y,e,t]),C=(0,r.useCallback)(e=>{if(g&&f){let t,a,s,r,n=(t=Math.min(f.startX,f.endX),a=Math.max(f.startX,f.endX),s=Math.min(f.startY,f.endY),r=Math.max(f.startY,f.endY),i.filter(e=>{let i=e.x+e.width,n=e.y+e.height;return!(e.x>a||i<t||e.y>r||n<s)}).map(e=>e.id)),c=Math.abs(f.endX-f.startX),d=Math.abs(f.endY-f.startY);c<5&&d<5?l?.():n.length>0?o?.(n,e.shiftKey||f.isShiftPressed):l?.()}b(!1),v(null)},[g,f,i,l,o]),A=f?{left:Math.min(f.startX,f.endX),top:Math.min(f.startY,f.endY),width:Math.abs(f.endX-f.startX),height:Math.abs(f.endY-f.startY)}:null;return(0,s.jsx)("div",{ref:u,className:"relative",style:{width:e*y,height:t*y},children:(0,s.jsxs)("div",{ref:x,className:(0,j.cn)("absolute origin-top-left bg-zinc-900 overflow-hidden",n?"border-0 rounded-none shadow-none":"border border-white/10 rounded-lg shadow-2xl","transition-transform duration-200",g&&"cursor-crosshair"),style:{width:e,height:t,transform:`scale(${y})`,transformOrigin:"top left"},onMouseDown:k,onMouseMove:S,onMouseUp:C,onMouseLeave:C,onWheel:z,children:[!n&&(0,s.jsx)("div",{className:"absolute inset-0 opacity-30 pointer-events-none",style:{backgroundImage:`
                                linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
                                linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px)
                            `,backgroundSize:"20px 20px"}}),(0,s.jsxs)("div",{className:"absolute inset-0 pointer-events-none opacity-30",children:[(0,s.jsx)("div",{className:"absolute left-1/2 top-0 bottom-0 border-l border-dashed border-white/20"}),(0,s.jsx)("div",{className:"absolute top-1/2 left-0 right-0 border-t border-dashed border-white/20"})]}),(0,s.jsxs)("div",{className:"relative w-full h-full report-canvas-content",children:[a,0===i.length&&(0,s.jsx)("div",{className:"absolute bottom-3 right-3 text-[10px] text-zinc-500/80",children:"\xa9 平米內參 All Rights Reserved"})]}),g&&A&&(0,s.jsx)("div",{className:"absolute border-2 border-violet-500 bg-violet-500/20 pointer-events-none z-50",style:A}),!n&&(0,s.jsxs)("div",{className:"absolute bottom-2 right-2 text-[10px] text-zinc-600 font-mono bg-zinc-950/80 px-2 py-1 rounded",children:[e," \xd7 ",t]})]})})}var z=a(37288),k=a(92669),S=a(23770),C=a(61742),A=a(45916),D=a(16869),M=a(41933),$=a(38194),Q=a(77314),P=a(9199),I=a(20986),E=a(19835),R=a(25777),T=a(88743);let L={"1m":"近 1 個月","3m":"近 3 個月","6m":"近 6 個月","1y":"近 1 年","2y":"近 2 年","1q":"近 1 季","2q":"近 2 季","3q":"近 3 季",this_year:"今年",last_2_years:"近 2 年",all:"全部時間"};function F(e){let t=[];return e.counties.length>0?e.districts.length>0?t.push(`區域：${e.counties.join("、")} / ${e.districts.join("、")}`):t.push(`區域：${e.counties.join("、")}`):t.push("區域：全部縣市"),e.startDate&&e.endDate?t.push(`期間：${e.startDate} ~ ${e.endDate}`):e.dateRange&&t.push(`期間：${L[e.dateRange]||e.dateRange}`),e.transactionType&&t.push(`交易類型：${e.transactionType}`),e.buildingType&&t.push(`建物類型：${e.buildingType}`),1===e.projectNames.length?t.push(`建案：${e.projectNames[0]}`):e.projectNames.length>1&&e.projectNames.length<=3?t.push(`建案：${e.projectNames.join("、")}`):e.projectNames.length>3&&t.push(`建案：共 ${e.projectNames.length} 個`),e.excludeCommercial&&t.push("條件：排除商業/辦公"),t}var q=a(68305),B=a(77837),_=a(20871),X=a(78269),Y=a(85623),H=a(37847),W=a(31840),O=a(64148);let Z={"cover-template":"報告封面","ranking-metrics":"核心數據指標","unit-price-stats":"各用途單價統計","ranking-chart":"建案排名","ranking-table":"建案排行列表","price-band-chart":"總價帶分佈","price-band-table":"總價帶詳細數據","price-band-location-table":"區域房型成交分佈","price-band-location-chart":"區域成交佔比","unit-price-bubble":"單價泡泡圖","type-comparison-table":"產品類型單價比較","sales-velocity-chart":"銷售速度","sales-velocity-table":"銷售速度明細","parking-pie":"車位配比","parking-price":"車位類型均價","parking-scatter":"車位坪數分析","parking-floor":"車位樓層分析","parking-floor-detail":"車位樓層明細","policy-timeline":"政策時間軸",heatmap:"銷控熱力圖","heatmap-grid":"建案銷控熱力圖","heatmap-stats":"調價幅度摘要","heatmap-comparison":"戶型溢價貢獻","sales-heatmap":"房型面積熱力圖","sales-heatmap-detail":"熱力詳細交易表","data-list":"交易明細表","text-box":"文字方塊"};function K({item:e,onUpdate:t,isSelected:a,isCompact:i}){let n=e.data||{},l=r.useRef(null),[o,c]=r.useState(!1),d="string"==typeof n.html?n.html:"string"==typeof n.text?n.text:"",h=n.align||"left",u=n.verticalAlign||"top",x=Number(n.fontSize??n.size??18),m=Number(n.maxFontSize??n.fontSize??n.size??18),p=n.fontFamily||'"Noto Sans TC", "PingFang TC", "Microsoft JhengHei", system-ui, sans-serif',g=Number(n.fontWeight??n.weight??500),b=!!n.italic,f=!!n.underline,v=n.color||"#e4e4e7",w=!1!==n.autoFit,N=Number(n.rotation||0),y=r.useCallback(e=>{t({data:{...n,...e}})},[t,n]),z=r.useCallback((e,t=!0)=>{let a=Math.max(8,Math.min(200,e));y({fontSize:a,maxFontSize:t?a:m})},[m,y]),E=r.useCallback(()=>{if(!w)return;let e=l.current;if(!e)return;let t=t=>(e.style.fontSize=`${t}px`,e.scrollHeight<=e.clientHeight&&e.scrollWidth<=e.clientWidth),a=8,s=Math.max(8,m||x||18),r=8;for(;a<=s;){let e=Math.floor((a+s)/2);t(e)?(r=e,a=e+1):s=e-1}r!==x&&y({fontSize:r})},[w,x,m,y]);r.useEffect(()=>{l.current&&(o||l.current.innerHTML===d||(l.current.innerHTML=d||""))},[d,o]),r.useEffect(()=>{w&&requestAnimationFrame(E)},[w,E,e.width,e.height,d,x]);let R=e=>{let t=l.current;t&&(t.focus(),document.execCommand("ul"===e?"insertUnorderedList":"insertOrderedList"),y({html:t.innerHTML}),w&&requestAnimationFrame(E))};return(0,s.jsxs)("div",{className:"h-full w-full flex flex-col",children:[a&&(0,s.jsxs)("div",{className:(0,j.cn)("flex flex-wrap gap-2 items-center mb-2 px-2 py-1.5 rounded-lg border border-white/10 bg-zinc-900/60",i&&"hidden"),"data-report-control":"hide","data-no-drag":"true",children:[(0,s.jsxs)("select",{value:p,onChange:e=>y({fontFamily:e.target.value}),className:"bg-zinc-950/70 border border-white/10 rounded px-2 py-1 text-xs text-zinc-200",children:[(0,s.jsx)("option",{value:'"Noto Sans TC", "PingFang TC", "Microsoft JhengHei", system-ui, sans-serif',children:"思源黑體"}),(0,s.jsx)("option",{value:'"Noto Serif TC", "Songti TC", serif',children:"宋體"}),(0,s.jsx)("option",{value:'"Inter", system-ui, sans-serif',children:"Inter"})]}),(0,s.jsx)("input",{type:"number",value:x,onChange:e=>z(Number(e.target.value)),className:"w-16 bg-zinc-950/70 border border-white/10 rounded px-2 py-1 text-xs text-zinc-200",title:"字級"}),(0,s.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>y({fontWeight:g>=700?500:700}),className:(0,j.cn)("p-1 rounded border text-xs",g>=700?"border-cyan-400 text-cyan-300":"border-white/10 text-zinc-400"),title:"粗體",children:(0,s.jsx)(k.A,{className:"w-3.5 h-3.5"})}),(0,s.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>y({italic:!b}),className:(0,j.cn)("p-1 rounded border text-xs",b?"border-cyan-400 text-cyan-300":"border-white/10 text-zinc-400"),title:"斜體",children:(0,s.jsx)(S.A,{className:"w-3.5 h-3.5"})}),(0,s.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>y({underline:!f}),className:(0,j.cn)("p-1 rounded border text-xs",f?"border-cyan-400 text-cyan-300":"border-white/10 text-zinc-400"),title:"底線",children:(0,s.jsx)(C.A,{className:"w-3.5 h-3.5"})}),(0,s.jsx)("input",{type:"color",value:v,onChange:e=>y({color:e.target.value}),className:"h-7 w-8 bg-transparent border border-white/10 rounded",title:"文字顏色"}),(0,s.jsxs)("div",{className:"flex items-center gap-1 ml-1",children:[(0,s.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>y({align:"left"}),className:(0,j.cn)("p-1 rounded border","left"===h?"border-cyan-400 text-cyan-300":"border-white/10 text-zinc-400"),title:"靠左",children:(0,s.jsx)(A.A,{className:"w-3.5 h-3.5"})}),(0,s.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>y({align:"center"}),className:(0,j.cn)("p-1 rounded border","center"===h?"border-cyan-400 text-cyan-300":"border-white/10 text-zinc-400"),title:"置中",children:(0,s.jsx)(D.A,{className:"w-3.5 h-3.5"})}),(0,s.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>y({align:"right"}),className:(0,j.cn)("p-1 rounded border","right"===h?"border-cyan-400 text-cyan-300":"border-white/10 text-zinc-400"),title:"靠右",children:(0,s.jsx)(M.A,{className:"w-3.5 h-3.5"})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1 ml-1",children:[(0,s.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>R("ul"),className:"p-1 rounded border border-white/10 text-zinc-400",title:"項目符號",children:(0,s.jsx)($.A,{className:"w-3.5 h-3.5"})}),(0,s.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>R("ol"),className:"p-1 rounded border border-white/10 text-zinc-400",title:"編號",children:(0,s.jsx)(Q.A,{className:"w-3.5 h-3.5"})})]}),(0,s.jsxs)("select",{value:u,onChange:e=>y({verticalAlign:e.target.value}),className:"bg-zinc-950/70 border border-white/10 rounded px-2 py-1 text-xs text-zinc-200",title:"垂直對齊",children:[(0,s.jsx)("option",{value:"top",children:"靠上"}),(0,s.jsx)("option",{value:"middle",children:"置中"}),(0,s.jsx)("option",{value:"bottom",children:"靠下"})]}),(0,s.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>{let e=!w;y({autoFit:e,fontSize:e?x:m})},className:(0,j.cn)("px-2 py-1 rounded border text-xs",w?"border-cyan-400 text-cyan-300":"border-white/10 text-zinc-400"),title:"自動縮放",children:"Auto-Fit"}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>y({rotation:N-15}),className:"p-1 rounded border border-white/10 text-zinc-400",title:"逆時針旋轉",children:(0,s.jsx)(P.A,{className:"w-3.5 h-3.5"})}),(0,s.jsx)("input",{type:"number",value:N,onChange:e=>y({rotation:Number(e.target.value)||0}),className:"w-16 bg-zinc-950/70 border border-white/10 rounded px-2 py-1 text-xs text-zinc-200",title:"旋轉角度"}),(0,s.jsx)("button",{onMouseDown:e=>e.preventDefault(),onClick:()=>y({rotation:N+15}),className:"p-1 rounded border border-white/10 text-zinc-400",title:"順時針旋轉",children:(0,s.jsx)(I.A,{className:"w-3.5 h-3.5"})})]})]}),(0,s.jsx)("div",{className:"flex-1 flex",style:{justifyContent:"middle"===u?"center":"bottom"===u?"flex-end":"flex-start"},children:(0,s.jsx)("div",{ref:l,className:"w-full outline-none p-2 whitespace-pre-wrap",style:{textAlign:h,fontSize:`${x}px`,fontWeight:g,fontStyle:b?"italic":"normal",textDecoration:f?"underline":"none",fontFamily:p,color:v,lineHeight:1.4,transform:`rotate(${N}deg)`,transformOrigin:"center"},contentEditable:!0,suppressContentEditableWarning:!0,"data-no-drag":"true","data-report-control":"allow",onFocus:()=>c(!0),onBlur:()=>{c(!1),l.current&&y({html:l.current.innerHTML})},onInput:()=>{l.current&&(y({html:l.current.innerHTML}),w&&requestAnimationFrame(E))}})})]})}function U({item:e,isSelected:t,onSelect:a,onUpdate:i,onRemove:n,onMoveToPage:l,analysisData:o,canvasWidth:c,canvasHeight:d}){let h=(0,w.Q)(e=>e.selectedIds),u=(0,w.Q)(e=>e.batchUpdateItems),x=(0,w.Q)(e=>e.pages),m=(0,w.Q)(e=>e.currentPageIndex),g=(0,w.Q)(e=>e.setDragging),b=x[m]?.items||[],f=r.useRef({}),v=r.useRef(!1),N=r.useRef(!1),y=()=>{};r.useEffect(()=>{"select"!==e.scaleMode&&i({scaleMode:"select",panOffset:{x:0,y:0}})},[e.scaleMode,i]);let k=(0,w.Q)(e=>e.zoomLevel),S="cover-template"===e.type,[C,A]=r.useState(!1),D=!!e.headerLocked,M=!S&&(D||C),$=e.contentScale||1,Q=!!e.showControls,P={width:"100%",height:"100%",transformOrigin:"center center"};1!==$&&(P.zoom=$);let I=S?"report-builder-item report-builder-item-cover bg-transparent border-0 rounded-none shadow-none relative":(0,j.cn)("report-builder-item group/item bg-zinc-800/80 backdrop-blur-sm rounded-lg border-2 transition-colors relative",t?"border-violet-500 shadow-lg shadow-violet-500/20":"border-transparent hover:border-zinc-600");return(0,s.jsxs)(z.p,{scale:k/100,size:{width:S?c:e.width,height:S?d:e.height},position:{x:S?0:e.x,y:S?0:e.y},disableDragging:S,dragHandleClassName:S?void 0:"chart-drag-handle",onMouseEnter:()=>A(!0),onMouseLeave:()=>A(!1),onDragStart:e=>{if(N.current=!1,t){v.current=!0,g(!0,h.length);let e={};h.forEach(t=>{let a=b.find(e=>e.id===t);a&&(e[t]={x:a.x,y:a.y})}),f.current=e,console.log("Group drag start:",e)}else v.current=!1,g(!0,1)},onDrag:(t,a)=>{N.current=!0;let s=t.clientX||t.touches?.[0]?.clientX,r=t.clientY||t.touches?.[0]?.clientY;if(void 0!==s&&void 0!==r){let e=document.elementsFromPoint(s,r).find(e=>"true"===e.getAttribute("data-page-drop-target")||"true"===e.getAttribute("data-page-drop-zone")),t=e?.getAttribute("data-page-index"),a=null!=t?parseInt(t,10):null;w.Q.getState().setHoveredPageIndex(a)}if(v.current&&h.length>1){let t=a.x-(f.current[e.id]?.x||e.x),s=a.y-(f.current[e.id]?.y||e.y),r={};h.forEach(a=>{a!==e.id&&f.current[a]&&(r[a]={x:f.current[a].x+t,y:f.current[a].y+s})}),Object.keys(r).length>0&&u(r)}},onDragStop:(a,s)=>{let r=a.clientX||a.changedTouches?.[0]?.clientX,n=a.clientY||a.changedTouches?.[0]?.clientY;if(void 0!==r&&void 0!==n){let e=document.elementsFromPoint(r,n).find(e=>"true"===e.getAttribute("data-page-drop-target")||"true"===e.getAttribute("data-page-drop-zone"));if(e){let a=parseInt(e.getAttribute("data-page-index")||"-1",10);if(a>=0&&a!==w.Q.getState().currentPageIndex){t?w.Q.getState().moveSelectedItemsToPage(a):l&&l(a),w.Q.getState().setCurrentPage(a),v.current=!1,f.current={},g(!1),w.Q.getState().setHoveredPageIndex(null);return}}}if(v.current&&h.length>1){let t=s.x-(f.current[e.id]?.x||e.x),a=s.y-(f.current[e.id]?.y||e.y),r={};h.forEach(i=>{let n=f.current[i];n&&(r[i]={x:i===e.id?s.x:n.x+t,y:i===e.id?s.y:n.y+a})}),u(r)}else i({x:s.x,y:s.y});v.current=!1,f.current={},g(!1),w.Q.getState().setHoveredPageIndex(null)},onResizeStop:(e,t,a,s,r)=>{i({width:parseInt(a.style.width,10),height:parseInt(a.style.height,10),x:r.x,y:r.y})},minWidth:150,minHeight:100,bounds:void 0,onClick:e=>{e.stopPropagation(),N.current||a(e),N.current=!1},className:I,enableResizing:S?{top:!1,right:!1,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1}:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},cancel:"input,textarea,select,button,option,.cover-edit-field,[data-no-drag='true']",resizeHandleStyles:{topRight:{cursor:"ne-resize",width:20,height:20,right:-10,top:-10},bottomRight:{cursor:"se-resize",width:20,height:20,right:-10,bottom:-10},bottomLeft:{cursor:"sw-resize",width:20,height:20,left:-10,bottom:-10},topLeft:{cursor:"nw-resize",width:20,height:20,left:-10,top:-10},top:{cursor:"n-resize",height:20,top:-10},bottom:{cursor:"s-resize",height:20,bottom:-10},left:{cursor:"w-resize",width:20,left:-10},right:{cursor:"e-resize",width:20,right:-10}},children:[!S&&(0,s.jsxs)("div",{className:(0,j.cn)("report-builder-item-header chart-drag-handle no-print h-7 bg-zinc-900/90 flex items-center justify-between px-2 cursor-move border-b border-white/5 select-none group/header transition-opacity duration-200 absolute top-0 left-0 right-0 z-20",M?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-1.5 overflow-hidden",children:[(0,s.jsx)(E.A,{className:"h-3 w-3 text-zinc-500 group-hover/header:text-violet-400"}),(0,s.jsx)("span",{className:"text-[10px] text-zinc-400 font-medium truncate",children:Z[e.type]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),i({showControls:!Q})},className:(0,j.cn)("px-2 py-1 rounded text-[9px] font-medium transition-colors opacity-0 group-hover/header:opacity-100",Q?"text-violet-300 bg-violet-500/15 hover:bg-violet-500/25":"text-zinc-500 hover:text-zinc-300 hover:bg-white/5"),title:Q?"隱藏元件控制項":"完整顯示元件",children:"完整顯示元件"}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),i({headerLocked:!D})},className:(0,j.cn)("p-1 rounded transition-colors opacity-0 group-hover/header:opacity-100",D?"text-emerald-400 hover:text-emerald-300":"text-zinc-600 hover:text-zinc-300 hover:bg-white/5"),title:D?"取消鎖定標題":"鎖定標題",children:(0,s.jsx)(R.A,{className:"h-3 w-3"})}),(0,s.jsxs)("span",{className:"text-[9px] text-zinc-600 font-mono hidden sm:inline",children:[e.width,"\xd7",e.height]}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),n()},className:"p-1 rounded hover:bg-red-500/20 text-zinc-600 hover:text-red-400 transition-colors opacity-0 group-hover/header:opacity-100",children:(0,s.jsx)(p.A,{className:"h-3 w-3"})})]})]}),(0,s.jsxs)("div",{className:(0,j.cn)("report-builder-item-content relative group/content",S?"p-0":"p-2",!S&&(M?"pt-7":"pt-2"),!Q&&!S&&"report-builder-compact"),style:{height:"100%"},onMouseDown:()=>{},onMouseMove:()=>{},onMouseUp:y,onMouseLeave:y,children:[(0,s.jsx)("div",{style:{width:"100%",height:"100%"},children:(0,s.jsx)("div",{style:P,children:(()=>{if("cover-template"===e.type){let t=T.P.getState(),a=F({counties:t.counties,districts:t.districts,transactionType:t.transactionType,buildingType:t.buildingType,projectNames:t.projectNames,dateRange:t.dateRange,startDate:t.startDate,endDate:t.endDate,excludeCommercial:t.excludeCommercial}),r={logoText:"平米內參",title:"市場分析報告",subtitle:"價格帶與銷售動能評估",projectName:"請填寫建案名稱",period:"2026 Q1",preparedBy:"平米內參",reportDate:new Date().toISOString().split("T")[0],searchConditions:a,...e.data||{}},n=(e,t)=>{i({data:{...r,[e]:t}})},l=Array.isArray(r.searchConditions)?r.searchConditions.filter(e=>"string"==typeof e&&e.trim().length>0):[],o="/trb",h=c/d,u=.05>Math.abs(h-16/9),x=.05>Math.abs(h-595/842),m=.05>Math.abs(h-1),p=.05>Math.abs(h-.8),g=.05>Math.abs(h-.5625),b="cover-edit-field w-full bg-transparent border-b border-white/10 text-white focus:outline-none focus:border-cyan-400 transition-colors",f=(e,t,a,r,i,l)=>(0,s.jsxs)("div",{className:(0,j.cn)("space-y-1",l),children:[(0,s.jsx)("p",{className:"text-zinc-500 uppercase tracking-[0.15em] font-medium",style:{fontSize:i},children:e}),(0,s.jsx)("input",{value:a,onChange:e=>n(t,e.target.value),className:(0,j.cn)(b,"px-1 py-0.5"),style:{fontSize:r}})]}),v=e=>(0,s.jsx)("div",{className:"flex flex-wrap gap-1.5",children:l.map((t,a)=>(0,s.jsx)("span",{className:"inline-block bg-white/5 border border-white/10 rounded-full text-zinc-300 whitespace-nowrap",style:{fontSize:e,padding:`${Math.round(.2*e)}px ${Math.round(.7*e)}px`},children:t},a))});return u?(0,s.jsxs)("div",{className:"h-full w-full overflow-hidden bg-gradient-to-br from-zinc-950 via-zinc-900 to-slate-950 relative",children:[(0,s.jsx)("div",{className:"absolute -top-20 -right-20 w-72 h-72 rounded-full bg-cyan-500/8 blur-[80px]"}),(0,s.jsx)("div",{className:"absolute -bottom-16 left-[30%] w-56 h-56 rounded-full bg-violet-500/8 blur-[60px]"}),(0,s.jsx)("div",{className:"absolute top-0 left-0 w-1 h-full bg-gradient-to-b from-cyan-400/60 via-cyan-400/20 to-transparent"}),(0,s.jsxs)("div",{className:"relative z-10 h-full grid grid-cols-[1fr_280px]",children:[(0,s.jsxs)("div",{className:"flex flex-col justify-between p-8 pr-6",children:[(0,s.jsx)("div",{}),(0,s.jsxs)("div",{className:"flex items-start gap-4 -mt-4",children:[(0,s.jsx)("img",{src:`${o}/logo-type-a.jpg`,alt:"Logo",className:"rounded-lg object-cover border border-white/10 flex-shrink-0 mt-1",style:{width:56,height:56},draggable:!1}),(0,s.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,s.jsx)("input",{value:r.title,onChange:e=>n("title",e.target.value),className:(0,j.cn)(b,"font-bold text-white tracking-tight py-0.5"),style:{fontSize:32}}),(0,s.jsx)("input",{value:r.subtitle,onChange:e=>n("subtitle",e.target.value),className:(0,j.cn)(b,"text-zinc-400 py-0.5"),style:{fontSize:15}})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-4 mb-2",children:[f("建案","projectName",r.projectName,12,9),f("期間","period",r.period,12,9),f("製作","preparedBy",r.preparedBy,12,9),f("日期","reportDate",r.reportDate,12,9)]}),(0,s.jsx)("p",{className:"text-zinc-600",style:{fontSize:8},children:"\xa9 平米內參 All Rights Reserved"})]})]}),(0,s.jsxs)("div",{className:"flex flex-col justify-end p-6 pl-0 border-l border-white/5",children:[(0,s.jsxs)("div",{className:"flex-1 flex items-center justify-center relative",children:[(0,s.jsx)("div",{className:"w-32 h-32 rounded-2xl border border-cyan-500/15 rotate-12 absolute"}),(0,s.jsx)("div",{className:"w-24 h-24 rounded-xl border border-violet-500/15 -rotate-6 absolute"}),(0,s.jsx)("div",{className:"w-10 h-10 rounded-lg bg-cyan-500/10 absolute"})]}),(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsx)("p",{className:"text-zinc-500 uppercase tracking-[0.15em] font-medium",style:{fontSize:9},children:"搜尋條件"}),v(10)]})]})]})]}):x?(0,s.jsxs)("div",{className:"h-full w-full overflow-hidden bg-gradient-to-b from-zinc-950 via-zinc-900 to-zinc-950 relative",children:[(0,s.jsx)("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-cyan-500/40 to-transparent"}),(0,s.jsx)("div",{className:"absolute top-10 right-10 w-40 h-40 rounded-full bg-cyan-500/5 blur-[50px]"}),(0,s.jsx)("div",{className:"absolute bottom-20 left-10 w-32 h-32 rounded-full bg-violet-500/5 blur-[40px]"}),(0,s.jsxs)("div",{className:"relative z-10 h-full flex flex-col px-10 py-10 overflow-hidden",children:[(0,s.jsx)("div",{className:"w-full h-px bg-gradient-to-r from-cyan-500/30 via-white/10 to-transparent flex-shrink-0"}),(0,s.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center",children:[(0,s.jsxs)("div",{className:"flex items-start gap-4",children:[(0,s.jsx)("img",{src:`${o}/logo-type-a.jpg`,alt:"Logo",className:"rounded-lg object-cover border border-white/10 flex-shrink-0 mt-1",style:{width:52,height:52},draggable:!1}),(0,s.jsxs)("div",{className:"flex-1 text-left space-y-1",children:[(0,s.jsx)("input",{value:r.title,onChange:e=>n("title",e.target.value),className:(0,j.cn)(b,"font-bold text-white tracking-tight py-0.5 pl-0 -ml-0.5"),style:{fontSize:28}}),(0,s.jsx)("input",{value:r.subtitle,onChange:e=>n("subtitle",e.target.value),className:(0,j.cn)(b,"text-zinc-400 py-0.5 pl-0"),style:{fontSize:13}})]})]}),(0,s.jsx)("div",{className:"w-16 h-px bg-cyan-500/30 mx-auto mt-6"})]}),(0,s.jsxs)("div",{className:"flex-shrink-0 space-y-3",children:[(0,s.jsx)("div",{className:"w-full h-px bg-white/5"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-x-8 gap-y-3",children:[f("建案名稱","projectName",r.projectName,12,9),f("分析期間","period",r.period,12,9),f("製作單位","preparedBy",r.preparedBy,12,9),f("報告日期","reportDate",r.reportDate,12,9)]}),(0,s.jsxs)("div",{className:"space-y-1.5 mt-2",children:[(0,s.jsx)("p",{className:"text-zinc-500 uppercase tracking-[0.15em] font-medium",style:{fontSize:9},children:"搜尋條件"}),v(10)]}),(0,s.jsx)("div",{className:"w-full h-px bg-white/5 mt-2"}),(0,s.jsx)("p",{className:"text-zinc-600 text-center",style:{fontSize:8},children:"\xa9 平米內參 All Rights Reserved"})]})]})]}):m?(0,s.jsxs)("div",{className:"h-full w-full overflow-hidden bg-gradient-to-br from-zinc-950 via-zinc-900 to-slate-900 relative",children:[(0,s.jsx)("div",{className:"absolute -top-16 -left-16 w-48 h-48 rounded-full bg-cyan-500/10 blur-[60px]"}),(0,s.jsx)("div",{className:"absolute -top-16 -right-16 w-40 h-40 rounded-full bg-violet-500/8 blur-[50px]"}),(0,s.jsx)("div",{className:"absolute -bottom-16 -left-16 w-40 h-40 rounded-full bg-violet-500/8 blur-[50px]"}),(0,s.jsx)("div",{className:"absolute -bottom-16 -right-16 w-48 h-48 rounded-full bg-cyan-500/6 blur-[60px]"}),(0,s.jsx)("div",{className:"absolute inset-4 border border-white/5 rounded-2xl pointer-events-none"}),(0,s.jsxs)("div",{className:"relative z-10 h-full flex flex-col items-center justify-center px-14 py-12 text-center",children:[(0,s.jsxs)("div",{className:"flex items-start gap-10 w-full max-w-[800px]",children:[(0,s.jsx)("img",{src:`${o}/logo-type-a.jpg`,alt:"Logo",className:"rounded-xl object-cover border-2 border-white/15 flex-shrink-0 mt-3",style:{width:110,height:110},draggable:!1}),(0,s.jsxs)("div",{className:"flex-1 text-left space-y-4",children:[(0,s.jsx)("input",{value:r.title,onChange:e=>n("title",e.target.value),className:(0,j.cn)(b,"font-bold text-white tracking-tight py-0.5 pl-0 -ml-0.5"),style:{fontSize:80}}),(0,s.jsx)("input",{value:r.subtitle,onChange:e=>n("subtitle",e.target.value),className:(0,j.cn)(b,"text-zinc-400 py-0.5 pl-0"),style:{fontSize:40}})]})]}),(0,s.jsx)("div",{className:"w-16 h-0.5 bg-gradient-to-r from-transparent via-cyan-500/40 to-transparent my-10"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-x-12 gap-y-5 w-full max-w-[640px] text-left",children:[f("建案","projectName",r.projectName,22,14),f("期間","period",r.period,22,14),f("製作","preparedBy",r.preparedBy,22,14),f("日期","reportDate",r.reportDate,22,14)]}),(0,s.jsxs)("div",{className:"mt-8 w-full max-w-[640px]",children:[(0,s.jsx)("p",{className:"text-zinc-500 uppercase tracking-[0.15em] font-medium text-left mb-2",style:{fontSize:13},children:"搜尋條件"}),v(16)]}),(0,s.jsx)("p",{className:"text-zinc-600 mt-6",style:{fontSize:12},children:"\xa9 平米內參 All Rights Reserved"})]})]}):p?(0,s.jsxs)("div",{className:"h-full w-full overflow-hidden bg-gradient-to-b from-zinc-950 via-zinc-900 to-slate-950 relative",children:[(0,s.jsx)("div",{className:"absolute -top-20 left-1/2 -translate-x-1/2 w-64 h-64 rounded-full bg-cyan-500/8 blur-[80px]"}),(0,s.jsx)("div",{className:"absolute -bottom-20 left-1/4 w-48 h-48 rounded-full bg-violet-500/8 blur-[60px]"}),(0,s.jsx)("div",{className:"absolute inset-5 border border-white/[0.04] rounded-2xl pointer-events-none"}),(0,s.jsxs)("div",{className:"relative z-10 h-full flex flex-col items-center px-10 py-10 text-center",children:[(0,s.jsxs)("div",{className:"flex items-start gap-4 mt-24 w-full max-w-[580px]",children:[(0,s.jsx)("img",{src:`${o}/logo-type-a.jpg`,alt:"Logo",className:"rounded-xl object-cover border-2 border-white/15 flex-shrink-0 mt-1",style:{width:80,height:80},draggable:!1}),(0,s.jsxs)("div",{className:"flex-1 text-left space-y-1",children:[(0,s.jsx)("input",{value:r.title,onChange:e=>n("title",e.target.value),className:(0,j.cn)(b,"font-bold text-white tracking-tight py-0.5 pl-0 -ml-0.5"),style:{fontSize:42}}),(0,s.jsx)("input",{value:r.subtitle,onChange:e=>n("subtitle",e.target.value),className:(0,j.cn)(b,"text-zinc-400 py-0.5 pl-0"),style:{fontSize:22}})]})]}),(0,s.jsx)("div",{className:"flex-1 flex items-center",children:(0,s.jsx)("div",{className:"w-12 h-0.5 bg-gradient-to-r from-transparent via-cyan-500/40 to-transparent"})}),(0,s.jsxs)("div",{className:"w-full max-w-[580px] space-y-3 text-left mb-4",children:[f("建案名稱","projectName",r.projectName,20,13),f("分析期間","period",r.period,20,13),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[f("製作單位","preparedBy",r.preparedBy,20,13),f("報告日期","reportDate",r.reportDate,20,13)]})]}),(0,s.jsxs)("div",{className:"w-full max-w-[580px] text-left mt-auto mb-3",children:[(0,s.jsx)("p",{className:"text-zinc-500 uppercase tracking-[0.15em] font-medium mb-2",style:{fontSize:13},children:"搜尋條件"}),v(15)]}),(0,s.jsx)("p",{className:"text-zinc-600",style:{fontSize:11},children:"\xa9 平米內參 All Rights Reserved"})]})]}):g?(0,s.jsxs)("div",{className:"h-full w-full overflow-hidden bg-gradient-to-b from-zinc-950 via-slate-900 to-zinc-950 relative",children:[(0,s.jsx)("div",{className:"absolute -top-24 left-1/2 -translate-x-1/2 w-72 h-72 rounded-full bg-cyan-500/10 blur-[90px]"}),(0,s.jsx)("div",{className:"absolute -bottom-24 left-1/2 -translate-x-1/2 w-64 h-64 rounded-full bg-violet-500/10 blur-[80px]"}),(0,s.jsx)("div",{className:"absolute top-0 left-1/2 -translate-x-1/2 w-px h-20 bg-gradient-to-b from-cyan-500/40 to-transparent"}),(0,s.jsx)("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-px h-20 bg-gradient-to-t from-violet-500/30 to-transparent"}),(0,s.jsxs)("div",{className:"relative z-10 h-full flex flex-col items-center px-8 py-10 text-center",children:[(0,s.jsxs)("div",{className:"flex items-start gap-4 mt-40 w-full",children:[(0,s.jsx)("img",{src:`${o}/logo-type-a.jpg`,alt:"Logo",className:"rounded-xl object-cover border-2 border-white/15 flex-shrink-0 mt-1",style:{width:76,height:76},draggable:!1}),(0,s.jsxs)("div",{className:"flex-1 text-left space-y-2",children:[(0,s.jsx)("input",{value:r.title,onChange:e=>n("title",e.target.value),className:(0,j.cn)(b,"font-bold text-white tracking-tight py-0.5 pl-0 -ml-0.5"),style:{fontSize:40}}),(0,s.jsx)("input",{value:r.subtitle,onChange:e=>n("subtitle",e.target.value),className:(0,j.cn)(b,"text-zinc-400 py-0.5 pl-0"),style:{fontSize:24}})]})]}),(0,s.jsx)("div",{className:"flex-1 flex flex-col items-center justify-center w-full",children:(0,s.jsx)("div",{className:"w-10 h-0.5 bg-gradient-to-r from-transparent via-cyan-500/50 to-transparent my-6"})}),(0,s.jsxs)("div",{className:"w-full space-y-3 text-left mb-4",children:[f("建案名稱","projectName",r.projectName,22,13),f("分析期間","period",r.period,22,13),f("製作單位","preparedBy",r.preparedBy,22,13),f("報告日期","reportDate",r.reportDate,22,13)]}),(0,s.jsxs)("div",{className:"w-full text-left mb-4",children:[(0,s.jsx)("p",{className:"text-zinc-500 uppercase tracking-[0.15em] font-medium mb-2",style:{fontSize:13},children:"搜尋條件"}),v(16)]}),(0,s.jsx)("p",{className:"text-zinc-600 mb-2",style:{fontSize:12},children:"\xa9 平米內參 All Rights Reserved"})]})]}):(0,s.jsx)("div",{className:"h-full w-full overflow-hidden bg-gradient-to-br from-zinc-950 via-zinc-900 to-slate-900 relative flex items-center justify-center",children:(0,s.jsx)("p",{className:"text-zinc-500 text-sm",children:"不支持的尺寸"})})}if(!o&&"text-box"!==e.type&&"policy-timeline"!==e.type)return(0,s.jsx)("div",{className:"flex items-center justify-center h-full text-zinc-500 text-sm",children:"無數據"});let a=o?{coreMetrics:o.coreMetrics,projectRanking:o.rankingAnalysis?.projectRanking||o.projectRanking||[]}:null,r=o?.priceBandAnalysis?{...o.priceBandAnalysis,transactionDetails:o.transactionDetails}:null,n=e=>(0,s.jsx)("div",{className:"h-full overflow-auto custom-scrollbar p-1",children:e});switch(e.type){case"ranking-metrics":return n((0,s.jsx)(q.p,{data:a,visibleSections:["metrics"],className:"h-full [&>div]:h-full"}));case"ranking-chart":return n((0,s.jsx)(q.p,{data:a,visibleSections:["chart"],className:"h-full [&>div]:h-full"}));case"ranking-table":return n((0,s.jsx)(q.p,{data:a,visibleSections:["table"],className:"h-full [&>div]:h-full"}));case"price-band-chart":return n((0,s.jsx)(B.P,{data:r,visibleSections:["chart"]}));case"price-band-table":return n((0,s.jsx)(B.P,{data:r,visibleSections:["table"]}));case"price-band-location-table":return n((0,s.jsx)(B.P,{data:r,visibleSections:["location-table"]}));case"price-band-location-chart":return n((0,s.jsx)(B.P,{data:r,visibleSections:["location-chart"]}));case"unit-price-stats":return n((0,s.jsx)(_.U,{data:o||null,visibleSections:["stats"]}));case"type-comparison-table":return n((0,s.jsx)(_.U,{data:o||null,visibleSections:["comparison"],comparisonExpandAll:!0}));case"unit-price-bubble":return n((0,s.jsx)(_.U,{data:o||null,visibleSections:["chart"]}));case"sales-velocity-chart":return n((0,s.jsx)(Y.Q,{data:o||null,visibleSections:["chart"]}));case"sales-velocity-table":return n((0,s.jsx)(Y.Q,{data:o||null,visibleSections:["table"]}));case"sales-heatmap":return n((0,s.jsx)(Y.Q,{data:o||null,visibleSections:["heatmap"]}));case"sales-heatmap-detail":return n((0,s.jsx)(Y.Q,{data:o||null,visibleSections:["heatmap-detail"]}));case"parking-pie":return n((0,s.jsx)(H.v,{data:o||null,visibleSections:["ratio"]}));case"parking-price":return n((0,s.jsx)(H.v,{data:o||null,visibleSections:["price"]}));case"parking-scatter":return n((0,s.jsx)(H.v,{data:o||null,visibleSections:["scatter"]}));case"parking-floor":return n((0,s.jsx)(H.v,{data:o||null,visibleSections:["floor"]}));case"parking-floor-detail":return n((0,s.jsx)(H.v,{data:o||null,visibleSections:["floor-detail"]}));case"heatmap":case"heatmap-grid":return n((0,s.jsx)(X.b,{data:o||null,visibleSections:["grid"]}));case"heatmap-stats":return n((0,s.jsx)(X.b,{data:o||null,visibleSections:["stats"]}));case"heatmap-comparison":return n((0,s.jsx)(X.b,{data:o||null,visibleSections:["comparison"]}));case"data-list":return n((0,s.jsx)(W.p,{trigger:o?.transactionDetails?.length?o:null}));case"policy-timeline":return n((0,s.jsx)(O.A,{data:o?.transactionDetails||[]}));case"text-box":return(0,s.jsx)(K,{item:e,onUpdate:i,isSelected:t,isCompact:!Q});default:return(0,s.jsx)("div",{className:"flex items-center justify-center h-full text-zinc-500 text-sm",children:"未知圖表類型"})}})()})}),!S&&!t&&(0,s.jsx)("div",{className:"absolute inset-0 z-10 cursor-pointer",onClick:e=>{e.stopPropagation(),a(e)}})]})]})}var J=a(24338),G=a(93219),V=a(89123),ee=a(14403),et=a(19965),ea=a(28063),es=a(44071);let er=[{id:"cover",title:"編輯元件",items:[{type:"cover-template",label:"報告封面",icon:(0,s.jsx)(v.A,{className:"h-4 w-4"}),description:"可編輯標題與日期",requiresData:!1},{type:"text-box",label:"文字方塊",icon:(0,s.jsx)(J.A,{className:"h-4 w-4"}),description:"可輸入文字與數字",requiresData:!1}]},{id:"ranking",title:"核心指標與排名",items:[{type:"ranking-metrics",label:"核心數據指標",icon:(0,s.jsx)(G.A,{className:"h-4 w-4"}),description:"8 項關鍵成交指標卡片",requiresData:!0},{type:"ranking-chart",label:"建案排名圖表",icon:(0,s.jsx)(V.A,{className:"h-4 w-4"}),description:"總銷與各項指標排名",requiresData:!0},{type:"ranking-table",label:"建案排名列表",icon:(0,s.jsx)(V.A,{className:"h-4 w-4"}),description:"詳細數據列表",requiresData:!0}]},{id:"price-band",title:"總價帶分析",items:[{type:"price-band-chart",label:"總價帶分佈",icon:(0,s.jsx)(ee.A,{className:"h-4 w-4"}),description:"價格區間箱型圖",requiresData:!0},{type:"price-band-table",label:"總價帶詳情",icon:(0,s.jsx)(ee.A,{className:"h-4 w-4"}),description:"各房型衛浴統計",requiresData:!0},{type:"price-band-location-chart",label:"區域成交佔比",icon:(0,s.jsx)(et.A,{className:"h-4 w-4"}),description:"各區房型分佈",requiresData:!0},{type:"price-band-location-table",label:"區域房型分佈",icon:(0,s.jsx)(ee.A,{className:"h-4 w-4"}),description:"區域交叉分析表",requiresData:!0}]},{id:"unit-price",title:"單價分析",items:[{type:"unit-price-stats",label:"各用途單價統計",icon:(0,s.jsx)(G.A,{className:"h-4 w-4"}),description:"住宅/辦公/店面指標卡",requiresData:!0},{type:"unit-price-bubble",label:"單價泡泡圖",icon:(0,s.jsx)(G.A,{className:"h-4 w-4"}),description:"成交單價熱度分佈",requiresData:!0},{type:"type-comparison-table",label:"產品類型比較",icon:(0,s.jsx)(ee.A,{className:"h-4 w-4"}),description:"住宅/店面/辦公均價",requiresData:!0}]},{id:"heatmap",title:"調價熱力圖",items:[{type:"heatmap-grid",label:"銷控熱力圖",icon:(0,s.jsx)(ee.A,{className:"h-4 w-4"}),description:"樓層戶別價差分析",requiresData:!0},{type:"heatmap-stats",label:"調價幅度摘要",icon:(0,s.jsx)(ee.A,{className:"h-4 w-4"}),description:"總溢價與平均調價",requiresData:!0},{type:"heatmap-comparison",label:"戶型溢價貢獻",icon:(0,s.jsx)(ee.A,{className:"h-4 w-4"}),description:"各戶型水平價差比較",requiresData:!0}]},{id:"timeline",title:"政策時光機",items:[{type:"policy-timeline",label:"政策時間軸",icon:(0,s.jsx)(ea.A,{className:"h-4 w-4"}),description:"政策/金融事件整理",requiresData:!0}]},{id:"velocity",title:"銷售速度與房型",items:[{type:"sales-velocity-chart",label:"銷售速度趨勢",icon:(0,s.jsx)(es.A,{className:"h-4 w-4"}),description:"去化速度與量能",requiresData:!0},{type:"sales-velocity-table",label:"銷售速度明細",icon:(0,s.jsx)(ee.A,{className:"h-4 w-4"}),description:"詳細銷售數據",requiresData:!0},{type:"sales-heatmap",label:"房型面積熱力圖",icon:(0,s.jsx)(ee.A,{className:"h-4 w-4"}),description:"坪數去化分佈",requiresData:!0}]},{id:"parking",title:"車位分析",items:[{type:"parking-pie",label:"房車配比",icon:(0,s.jsx)(et.A,{className:"h-4 w-4"}),description:"有/無車位比例",requiresData:!0},{type:"parking-price",label:"車位均價",icon:(0,s.jsx)(V.A,{className:"h-4 w-4"}),description:"各類車位行情",requiresData:!0},{type:"parking-scatter",label:"車位坪數散佈",icon:(0,s.jsx)(G.A,{className:"h-4 w-4"}),description:"規模與價值分析",requiresData:!0},{type:"parking-floor",label:"樓層價差",icon:(0,s.jsx)(es.A,{className:"h-4 w-4"}),description:"地下室樓層價差",requiresData:!0}]},{id:"others",title:"其他",items:[{type:"data-list",label:"交易明細列表",icon:(0,s.jsx)(V.A,{className:"h-4 w-4"}),description:"原始交易數據",requiresData:!0}]}];function ei({onAddItem:e,hasData:t}){return(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto custom-scrollbar",children:[(0,s.jsx)("div",{className:"p-3 space-y-6",children:er.map(a=>(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h3",{className:"text-xs font-bold text-zinc-500 uppercase tracking-wider pl-1",children:a.title}),(0,s.jsx)("div",{className:"grid grid-cols-1 gap-1",children:a.items.map(a=>{let i=!1!==a.requiresData&&!t;return(0,s.jsxs)("button",{onClick:()=>e(a.type),disabled:i,className:(0,j.cn)("w-full p-1.5 rounded-md border text-left transition-all group relative overflow-hidden flex flex-row items-center gap-2.5",i?"bg-zinc-900/30 border-white/5 opacity-50 cursor-not-allowed":"bg-zinc-800/40 border-white/5 hover:bg-zinc-700/60 hover:border-violet-500/30 cursor-pointer"),children:[(0,s.jsx)("div",{className:(0,j.cn)("p-1.5 rounded flex-shrink-0 transition-colors",i?"bg-zinc-800 text-zinc-600":"bg-zinc-700/50 group-hover:bg-violet-500/20 text-zinc-400 group-hover:text-violet-300"),children:r.cloneElement(a.icon,{className:"h-3.5 w-3.5"})}),(0,s.jsx)("div",{className:"min-w-0 flex-1",children:(0,s.jsx)("div",{className:"text-[11px] font-medium text-zinc-300 group-hover:text-white truncate leading-tight",children:a.label})}),!i&&(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-transparent to-white/5 opacity-0 group-hover:opacity-100 transition-opacity"})]},a.type)})})]},a.id))}),!t&&(0,s.jsx)("div",{className:"text-center py-8 text-xs text-zinc-500 px-4",children:"已開啟封面規劃；其餘圖表需先載入儀表板數據。"})]})}var en=a(87256),el=a(39768),eo=a(59883),ec=a(33210),ed=a(44923);function eh({id:e,name:t,index:a,isActive:r,canDelete:i,onClick:n,onDelete:l}){let{attributes:o,listeners:c,setNodeRef:d,transform:h,transition:u,isDragging:x}=(0,en.gl)({id:e}),{isOver:m,setNodeRef:p}=(0,ed.zM)({id:`page-tab-drop-${a}`,data:{type:"page-tab",pageIndex:a}}),g=(0,w.Q)(e=>e.hoveredPageIndex)===a,b={transform:el.Ks.Transform.toString(h),transition:u};return(0,s.jsxs)("div",{ref:e=>{d(e),p(e)},style:b,...o,...c,className:(0,j.cn)("px-3 h-8 rounded-lg text-xs font-semibold flex items-center gap-2 transition-all whitespace-nowrap group cursor-grab active:cursor-grabbing select-none border border-transparent shadow-sm",r?"bg-violet-600 text-white border-violet-400/30 shadow-violet-500/20":"bg-zinc-900/50 text-zinc-400 border-white/5 hover:bg-zinc-800 hover:text-zinc-100 hover:border-white/10",x&&"opacity-50 shadow-2xl z-50 scale-105",(m||g)&&!r&&"ring-2 ring-violet-500 bg-violet-600 text-white shadow-lg scale-110 z-50 origin-bottom"),onClick:e=>{x||n()},"data-page-drop-target":"true","data-page-index":a,children:[(0,s.jsx)(eo.A,{className:"h-3 w-3 text-zinc-600 group-hover:text-zinc-400 transition-colors flex-shrink-0"}),(0,s.jsx)("span",{className:"truncate max-w-[100px]",children:t}),i&&(0,s.jsx)("button",{onPointerDown:e=>{e.stopPropagation()},onClick:e=>{e.stopPropagation(),l()},className:(0,j.cn)("ml-auto p-1 rounded-md hover:bg-red-500/30 text-zinc-500 hover:text-red-400 transition-all focus:outline-none",r?"opacity-70":"opacity-0 group-hover:opacity-100"),children:(0,s.jsx)(ec.A,{className:"h-3 w-3"})})]})}function eu({pageIndex:e,isActive:t,children:a,onClick:r,onFocus:i}){let{setNodeRef:n,isOver:l}=(0,ed.zM)({id:`page-drop-${e}`,data:{pageIndex:e}});return(0,s.jsxs)("div",{ref:n,className:(0,j.cn)("relative group outline-none transition-transform duration-200",l&&"scale-[1.02]",t?"z-10":"z-0"),"data-page-drop-zone":"true","data-page-index":e,tabIndex:0,onFocus:i,onClick:r,children:[l&&(0,s.jsx)("div",{className:"absolute inset-0 bg-violet-500/10 border-2 border-violet-500/50 rounded-lg z-50 pointer-events-none animate-pulse"}),a]})}var ex=a(82482);function em(){let e=(0,w.Q)(e=>e.zoomLevel),t=(0,w.Q)(e=>e.setZoomLevel),a=(0,w.Q)(e=>e.resetZoom),[i,n]=r.useState(String(e));r.useEffect(()=>{n(String(e))},[e]);let l=r.useCallback(()=>{let a=parseInt(i,10);Number.isFinite(a)?t(a):n(String(e))},[i,t,e]);return(0,s.jsxs)("div",{className:"flex items-center gap-1 bg-zinc-900/90 backdrop-blur-md border border-white/10 rounded-lg p-1 shadow-xl",children:[(0,s.jsx)(d.$,{size:"icon",variant:"ghost",className:"h-7 w-7 text-zinc-400 hover:text-white hover:bg-white/10",onClick:()=>t(e-10),title:"縮小 (Cmd + 滾輪)",children:(0,s.jsx)(ex.A,{className:"h-4 w-4"})}),(0,s.jsx)("div",{className:"px-1 min-w-[4.5rem]",children:(0,s.jsxs)("div",{className:"flex items-center gap-1 rounded-md border border-white/10 bg-black/20 px-1.5 py-0.5",children:[(0,s.jsx)("input",{className:"w-10 bg-transparent text-center text-xs font-mono text-zinc-200 focus:outline-none",value:i,inputMode:"numeric",pattern:"[0-9]*",onChange:e=>{n(e.target.value.replace(/[^0-9]/g,""))},onBlur:l,onKeyDown:t=>{"Enter"===t.key&&t.currentTarget.blur(),"Escape"===t.key&&(n(String(e)),t.currentTarget.blur())},"aria-label":"縮放比例"}),(0,s.jsx)("span",{className:"text-[10px] text-zinc-400",children:"%"})]})}),(0,s.jsx)(d.$,{size:"icon",variant:"ghost",className:"h-7 w-7 text-zinc-400 hover:text-white hover:bg-white/10",onClick:()=>t(e+10),title:"放大 (Cmd + 滾輪)",children:(0,s.jsx)(f.A,{className:"h-4 w-4"})}),(0,s.jsx)("div",{className:"w-px h-4 bg-white/10 mx-1"}),(0,s.jsx)(d.$,{size:"icon",variant:"ghost",className:"h-7 w-7 text-zinc-400 hover:text-white hover:bg-white/10",onClick:a,title:"重置縮放 (100%)",children:(0,s.jsx)(P.A,{className:"h-3.5 w-3.5"})})]})}var ep=a(51806),eg=a(60529),eb=a(17243),ef=a(484);function ev({isOpen:e,onClose:t,onExport:a,format:i}){let n=(0,w.Q)(e=>e.pages),l=(0,w.Q)(e=>e.currentPageIndex),[o,c]=(0,r.useState)("all"),[u,x]=(0,r.useState)({start:1,end:n.length});return(0,s.jsx)(ep.a,{isOpen:e,onClose:t,title:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"p-2 rounded-lg bg-emerald-500/10 text-emerald-400",children:(0,s.jsx)(eb.A,{className:"h-5 w-5"})}),(0,s.jsxs)("span",{className:"text-xl",children:["匯出 ",i.toUpperCase()," 圖片"]})]}),maxWidth:"max-w-md",children:(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,s.jsxs)("button",{onClick:()=>c("all"),className:`flex items-center gap-4 p-4 rounded-xl border transition-all text-left ${"all"===o?"bg-emerald-500/10 border-emerald-500/50 ring-1 ring-emerald-500/50":"bg-zinc-900/50 border-white/5 hover:border-white/10"}`,children:[(0,s.jsx)("div",{className:`p-2 rounded-lg ${"all"===o?"bg-emerald-500/20 text-emerald-400":"bg-zinc-800 text-zinc-400"}`,children:(0,s.jsx)(h.A,{className:"h-5 w-5"})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"font-medium text-white",children:["全部頁面 (",n.length," 頁)"]}),(0,s.jsx)("div",{className:"text-xs text-zinc-500",children:"匯出所有報告頁面"})]})]}),(0,s.jsxs)("button",{onClick:()=>c("current"),className:`flex items-center gap-4 p-4 rounded-xl border transition-all text-left ${"current"===o?"bg-emerald-500/10 border-emerald-500/50 ring-1 ring-emerald-500/50":"bg-zinc-900/50 border-white/5 hover:border-white/10"}`,children:[(0,s.jsx)("div",{className:`p-2 rounded-lg ${"current"===o?"bg-emerald-500/20 text-emerald-400":"bg-zinc-800 text-zinc-400"}`,children:(0,s.jsx)(eb.A,{className:"h-5 w-5"})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"font-medium text-white",children:["僅限目前頁面 (第 ",l+1," 頁)"]}),(0,s.jsx)("div",{className:"text-xs text-zinc-500",children:"僅匯出當前正編輯的頁面"})]})]}),(0,s.jsxs)("button",{onClick:()=>c("range"),className:`flex items-center gap-4 p-4 rounded-xl border transition-all text-left ${"range"===o?"bg-emerald-500/10 border-emerald-500/50 ring-1 ring-emerald-500/50":"bg-zinc-900/50 border-white/5 hover:border-white/10"}`,children:[(0,s.jsx)("div",{className:`p-2 rounded-lg ${"range"===o?"bg-emerald-500/20 text-emerald-400":"bg-zinc-800 text-zinc-400"}`,children:(0,s.jsx)(ef.A,{className:"h-5 w-5"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium text-white",children:"指定範圍"}),(0,s.jsx)("div",{className:"text-xs text-zinc-500",children:"自定義要匯出的頁碼範圍"})]})]})]}),"range"===o&&(0,s.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-zinc-950/50 rounded-xl border border-white/5 animate-in fade-in slide-in-from-top-2 duration-200",children:[(0,s.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,s.jsx)("label",{className:"text-[10px] uppercase tracking-wider text-zinc-500 font-bold ml-1",children:"起始頁碼"}),(0,s.jsx)(eg.p,{type:"number",min:1,max:n.length,value:u.start,onChange:e=>x(t=>({...t,start:parseInt(e.target.value)||1})),className:"bg-zinc-900 border-white/5 h-10"})]}),(0,s.jsx)("div",{className:"text-zinc-700 mt-5",children:"至"}),(0,s.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,s.jsx)("label",{className:"text-[10px] uppercase tracking-wider text-zinc-500 font-bold ml-1",children:"結束頁碼"}),(0,s.jsx)(eg.p,{type:"number",min:1,max:n.length,value:u.end,onChange:e=>x(t=>({...t,end:parseInt(e.target.value)||1})),className:"bg-zinc-900 border-white/5 h-10"})]})]}),(0,s.jsxs)("div",{className:"pt-2 flex gap-3",children:[(0,s.jsx)(d.$,{variant:"outline",onClick:t,className:"flex-1 bg-zinc-900 border-white/5",children:"取消"}),(0,s.jsx)(d.$,{onClick:()=>{let e=[];if("all"===o)e=n.map((e,t)=>t);else if("current"===o)e=[l];else if("range"===o){let t=Math.max(0,u.start-1),a=Math.min(n.length-1,u.end-1);for(let s=t;s<=a;s++)e.push(s)}a(e)},className:"flex-1 bg-emerald-600 hover:bg-emerald-500 text-white border-none shadow-lg shadow-emerald-900/20",children:"開始匯出"})]})]})})}var ej=a(70872);function ew({selectedIds:e,onScaleAdjust:t,onScaleReset:a,onScaleSet:i,onDelete:n}){let l=(0,w.Q)(e=>e.pages),o=(0,w.Q)(e=>e.currentPageIndex),[c,h]=r.useState(""),u=e.length>0,x=u?l[o]?.items.find(t=>t.id===e[0]):void 0,m=x?.contentScale??1,g=!!u&&e.some(e=>{let t=l[o]?.items.find(t=>t.id===e);return t&&(t.contentScale??1)!==m});r.useEffect(()=>{u?g?h(""):h(String(Math.round(100*m))):h("")},[m,g,u,e.join(",")]);let b=()=>{let e=Number(c);Number.isFinite(e)?i(e):h(g?"":String(Math.round(100*m)))};return u?(0,s.jsx)("div",{className:"fixed bottom-8 left-1/2 -translate-x-1/2 z-50",children:(0,s.jsxs)("div",{className:"bg-zinc-900/90 backdrop-blur-xl border border-white/10 rounded-full p-2 shadow-2xl flex items-center gap-2 ring-1 ring-black/50",children:[(0,s.jsxs)("div",{className:"text-[10px] text-zinc-500 font-medium px-3 border-r border-white/10 select-none",children:[e.length," 選取"]}),(0,s.jsx)(ej.Bc,{delayDuration:0,children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 bg-zinc-950/50 border border-white/10 rounded-full px-2 py-1",children:[(0,s.jsx)("span",{className:"text-[10px] text-zinc-500 font-medium px-1",children:"內容縮放"}),(0,s.jsx)(d.$,{size:"icon",variant:"ghost",onClick:()=>t(-.1),className:"h-7 w-7 rounded-full text-zinc-300 hover:text-white hover:bg-white/10",title:"縮小內容",children:(0,s.jsx)(ex.A,{className:"h-3.5 w-3.5"})}),(0,s.jsxs)("div",{className:"flex items-center gap-1 px-3 py-1.5 bg-zinc-900/80 border border-white/15 rounded-full shadow-inner",title:"輸入縮放百分比",children:[(0,s.jsx)("input",{type:"number",inputMode:"decimal",value:c,onChange:e=>h(e.target.value),onBlur:b,onFocus:e=>e.currentTarget.select(),onKeyDown:e=>{"Enter"===e.key&&(b(),e.target.blur())},placeholder:g?"多值":void 0,className:"w-20 bg-transparent text-right text-sm text-zinc-100 outline-none"}),(0,s.jsx)("span",{className:"text-xs text-zinc-400",children:"%"})]}),(0,s.jsx)(d.$,{size:"icon",variant:"ghost",onClick:()=>t(.1),className:"h-7 w-7 rounded-full text-zinc-300 hover:text-white hover:bg-white/10",title:"放大內容",children:(0,s.jsx)(f.A,{className:"h-3.5 w-3.5"})})]}),(0,s.jsxs)(ej.m_,{children:[(0,s.jsx)(ej.k$,{asChild:!0,children:(0,s.jsx)(d.$,{size:"sm",variant:"ghost",onClick:n,className:"h-8 px-3 rounded-full text-zinc-400 hover:text-red-400 hover:bg-red-500/10 transition-all duration-200",children:(0,s.jsx)(p.A,{className:"h-3.5 w-3.5"})})}),(0,s.jsx)(ej.ZI,{side:"top",className:"text-xs bg-zinc-900 border-white/10 text-red-400",children:"刪除選中元件"})]})]})})]})}):null}let eN=(0,c.i)(function(){let{loading:e,analysisData:t}=(0,o.g)(),i=(0,w.Q)(e=>e.pages),c=(0,w.Q)(e=>e.currentPageIndex),N=(0,w.Q)(e=>e.canvasRatio),z=(0,w.Q)(e=>e.viewMode),k=(0,w.Q)(e=>e.setViewMode),S=(0,w.Q)(e=>e.selectedIds),C=(0,w.Q)(e=>e.addItem),A=(0,w.Q)(e=>e.addItems),D=(0,w.Q)(e=>e.updateItem),M=(0,w.Q)(e=>e.removeItem),$=(0,w.Q)(e=>e.clearCanvas),Q=(0,w.Q)(e=>e.setCanvasRatio),P=(0,w.Q)(e=>e.setSelectedIds),I=(0,w.Q)(e=>e.toggleSelection),E=(0,w.Q)(e=>e.addToSelection),R=(0,w.Q)(e=>e.clearSelection),L=(0,w.Q)(e=>e.removeSelectedItems);(0,w.Q)(e=>e.moveSelectedItemsToPage);let q=(0,w.Q)(e=>e.addPage),B=(0,w.Q)(e=>e.deletePage),_=(0,w.Q)(e=>e.renamePage),X=(0,w.Q)(e=>e.setCurrentPage),Y=(0,w.Q)(e=>e.reorderPages),H=(0,w.Q)(e=>e.moveItemToPage),W=(0,w.Q)(e=>e.batchUpdateItems),O=r.useRef([]),Z=r.useRef(0),[K,J]=(0,r.useState)(null),G=(0,w.Q)(e=>e.isDragging),V=(0,w.Q)(e=>e.draggedItemCount),ee=(0,w.Q)(e=>e.hoveredPageIndex),[et,ea]=(0,r.useState)({x:0,y:0}),[es,er]=(0,r.useState)(!0),el=(0,w.Q)(e=>e.zoomLevel),eo=(0,w.Q)(e=>e.setZoomLevel),ec=r.useRef(null),ex=r.useRef(null),[ep,eg]=(0,r.useState)(!1),[eb,ef]=(0,r.useState)(!1),ej=r.useRef(null),eN="continuous"===z||ep,[ey,ez]=(0,r.useState)(!1),[ek,eS]=(0,r.useState)("png"),[eC,eA]=(0,r.useState)(!1),[eD,eM]=(0,r.useState)({current:0,total:0});r.useEffect(()=>{let e=e=>{G&&ea({x:e.clientX,y:e.clientY})},t=e=>{if(document.activeElement?.tagName==="INPUT"||document.activeElement?.tagName==="TEXTAREA"||document.activeElement?.isContentEditable)return;let t=e.metaKey||e.ctrlKey,a=e.key.toLowerCase(),s=(i[c]?.items||[]).filter(e=>S.includes(e.id));if(t&&"c"===a){if(0===s.length)return;e.preventDefault(),O.current=s.map(e=>({...e,data:e.data?JSON.parse(JSON.stringify(e.data)):e.data})),Z.current=0;return}if(t&&"x"===a){if(0===s.length)return;e.preventDefault(),O.current=s.map(e=>({...e,data:e.data?JSON.parse(JSON.stringify(e.data)):e.data})),Z.current=0,L();return}if(t&&"v"===a){if(0===O.current.length)return;e.preventDefault();let t=20+Z.current;Z.current+=20,A(O.current.map((e,a)=>{let s=`item-${Date.now()}-${a}`;return{...e,id:s,x:e.x+t,y:e.y+t}}));return}("Delete"===e.key||"Backspace"===e.key)&&S.length>0&&(e.preventDefault(),L())};return window.addEventListener("mousemove",e),window.addEventListener("keydown",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("keydown",t)}},[G,S,L,k,i,c,A]);let e$=e=>Math.min(10,Math.max(.1,e)),eQ=(0,r.useCallback)(e=>{let t={},a=i[c]?.items||[];S.forEach(s=>{let r=a.find(e=>e.id===s);if(!r)return;let i=e$((r.contentScale||1)+e);t[s]={contentScale:Number(i.toFixed(2))}}),W(t)},[S,W,i,c]),eP=(0,r.useCallback)(()=>{let e={};S.forEach(t=>{e[t]={contentScale:1}}),W(e)},[S,W]),eI=(0,r.useCallback)(e=>{let t={},a=e$(e/100);S.forEach(e=>{t[e]={contentScale:Number(a.toFixed(2))}}),W(t)},[S,W]),eE=(0,ed.FR)((0,ed.MS)(ed.AN,{activationConstraint:{distance:5}})),eR=i[c],eT=eR?.items||[],eL=e=>e.some(e=>"cover-template"===e.type),eF="16:9"===N?{width:960,height:540}:"A4"===N?{width:595,height:842}:"1:1"===N?{width:900,height:900}:"9:16"===N?{width:540,height:960}:{width:720,height:900},eq=(0,r.useCallback)(e=>{C(e)},[C]),eB=(0,r.useCallback)((e,t)=>{D(e,t)},[D]),e_=(0,r.useCallback)(e=>{M(e)},[M]),eX=(0,r.useCallback)(()=>{q()},[q]),eY=(0,r.useCallback)(e=>{!(i.length<=1)&&confirm("確定要刪除此頁面嗎？")&&B(e)},[B,i.length]);r.useEffect(()=>{let e=ec.current;"continuous"===z&&"continuous"!==e&&eo(eb?110:60),"single"===z&&"single"!==e&&eo(eb?150:100),ec.current=z},[z,eb,el,eo,60,100,110,150]),r.useEffect(()=>{ep||("single"===z?eo(eb?150:100):"continuous"===z&&eo(eb?110:60))},[eb,z,ep,eo,60,100,110,150]),r.useEffect(()=>{"continuous"===z&&(null!==ex.current&&(cancelAnimationFrame(ex.current),ex.current=null),ep&&eg(!1))},[z,ep]),r.useEffect(()=>()=>{null!==ex.current&&cancelAnimationFrame(ex.current)},[]),r.useEffect(()=>{let e=()=>{let e=document;ef(!!(e.fullscreenElement||e.webkitFullscreenElement))};return document.addEventListener("fullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),e(),()=>{document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e)}},[]);let eH=(0,r.useCallback)(async()=>{let e=ej.current;if(!e)return;let t=document,a=!!(t.fullscreenElement||t.webkitFullscreenElement);try{a?t.exitFullscreen?await t.exitFullscreen():t.webkitExitFullscreen&&await t.webkitExitFullscreen():e.requestFullscreen?await e.requestFullscreen():e.webkitRequestFullscreen&&await e.webkitRequestFullscreen()}catch(e){console.error("Fullscreen toggle failed:",e)}},[]),eW=(0,r.useCallback)(()=>{let e=w.Q.getState(),t=T.P.getState(),a=F({counties:t.counties,districts:t.districts,transactionType:t.transactionType,buildingType:t.buildingType,projectNames:t.projectNames,dateRange:t.dateRange,startDate:t.startDate,endDate:t.endDate,excludeCommercial:t.excludeCommercial}),s=e.pages[0];if(!s)return;let r=s.items.some(e=>"cover-template"===e.type),i=s.items.some(e=>"cover-template"!==e.type);if(!r&&i&&!confirm("第一頁已有內容，規劃封面會先清空第一頁。是否繼續？"))return;e.setCurrentPage(0),e.clearSelection(),r||(e.clearCanvas(),e.addItem("cover-template"));let n=w.Q.getState().pages[0],l=n?.items.filter(e=>"cover-template"===e.type).slice(-1)[0];if(l){let t=l.data||{};e.updateItem(l.id,{x:0,y:0,width:eF.width,height:eF.height,data:{...t,logoText:"string"==typeof t.logoText?t.logoText:"平米內參",searchConditions:a}}),e.setSelectedIds([l.id])}_(s.id,"封面")},[eF.height,eF.width,_]),eO=(0,r.useCallback)(e=>{String(e.active.id).startsWith("item-")&&J(String(e.active.id))},[]),eZ=(0,r.useCallback)(e=>{let{active:t,over:a}=e;if(J(null),!a)return;if(String(t.id).startsWith("page-")&&String(a.id).startsWith("page-")){let e=i.findIndex(e=>e.id===t.id),s=i.findIndex(e=>e.id===a.id);-1!==e&&-1!==s&&e!==s&&Y(e,s)}let s=String(a.id);if(String(t.id).startsWith("item-")){let e=-1;s.startsWith("page-drop-")?e=parseInt(s.replace("page-drop-",""),10):s.startsWith("page-tab-drop-")&&(e=parseInt(s.replace("page-tab-drop-",""),10)),-1===e||isNaN(e)||(H(String(t.id),e),X(e))}},[i,Y,H,X]),eK=(0,r.useCallback)(()=>{let e=document.querySelector(".report-canvas-content");if(!e)return;let t=window.open("","_blank");if(!t)return;let a=Array.from(document.styleSheets).map(e=>{try{return Array.from(e.cssRules).map(e=>e.cssText).join("")}catch(e){return""}}).join(""),s="16:9"===N?{width:960,height:540}:{width:842,height:595};t.document.write(`
            <html>
                <head>
                    <title>SQM Report - ${new Date().toLocaleDateString()}</title>
                    <style>
                        ${a}
                        @media print {
                            @page {
                                size: ${"A4"===N?"A4 landscape":"960px 540px"};
                                margin: 0;
                            }
                            body { margin: 0; padding: 0; background: #09090b !important; -webkit-print-color-adjust: exact; }
                            .print-canvas {
                                width: ${s.width}px;
                                height: ${s.height}px;
                                position: relative;
                                background: #09090b;
                                overflow: hidden;
                            }
                            .rnd-resizer, .no-print { display: none !important; }
                            .report-builder-item-header { display: none !important; }
                            .report-builder-item {
                                background: transparent !important;
                                border: 0 !important;
                                box-shadow: none !important;
                                border-radius: 0 !important;
                                backdrop-filter: none !important;
                            }
                            .report-builder-item-content {
                                padding: 0 !important;
                                height: 100% !important;
                            }
                        }
                    </style>
                </head>
                <body>
                    <div class="print-canvas">
                        ${e.innerHTML}
                    </div>
                    <script>
                        window.onload = () => {
                            setTimeout(() => {
                                window.print();
                            }, 1000);
                        };
                    </script>
                </body>
            </html>
        `),t.document.close()},[N]),eU=(0,r.useCallback)(e=>{eS(e),ez(!0)},[]),eJ=(0,r.useCallback)(async e=>{ez(!1),eA(!0),eM({current:0,total:e.length});let t=w.Q.getState().currentPageIndex,s=w.Q.getState().viewMode;try{let{domToPng:t,domToJpeg:s}=await Promise.resolve().then(a.bind(a,98028));for(let a=0;a<e.length;a++){let r,i=e[a];eM({current:a+1,total:e.length}),w.Q.getState().setCurrentPage(i),await new Promise(e=>setTimeout(e,500));let n=document.querySelector(".report-canvas-content");if(!n){console.error(`Canvas element not found for page ${i}`);continue}let l=eF.width,o=eF.height,c={scale:2,backgroundColor:"#09090b",width:l,height:o,style:{transform:"none",width:`${l}px`,height:`${o}px`}};r="png"===ek?await t(n,c):await s(n,{...c,quality:.95});let d=document.createElement("a");d.download=`SQM-Report-P${i+1}-${new Date().getTime()}.${ek}`,d.href=r,d.click()}}catch(e){console.error("Batch export failed:",e),alert("批次匯出失敗，部分頁面可能未完成。")}finally{w.Q.getState().setCurrentPage(t),w.Q.getState().setViewMode(s),eA(!1)}},[eF,ek]),eG=(0,r.useCallback)(()=>{confirm("確定要清空當前頁面的所有元件嗎？")&&$()},[$]),eV=i.some(e=>e.items.some(e=>"cover-template"===e.type));return(0,s.jsxs)(l.e,{children:[(0,s.jsxs)(ed.Mp,{sensors:eE,collisionDetection:ed.fp,onDragStart:eO,onDragEnd:eZ,children:[(0,s.jsxs)("div",{ref:ej,"data-report-builder":"true",className:(0,j.cn)("flex gap-2 overflow-hidden",eb?"h-screen w-screen p-2 bg-zinc-950":"h-[calc(100vh-theme(spacing.14))]"),children:[(0,s.jsx)(ew,{selectedIds:S,onScaleAdjust:eQ,onScaleReset:eP,onScaleSet:eI,onDelete:L}),(0,s.jsxs)("aside",{className:(0,j.cn)("w-48 flex-shrink-0 bg-zinc-900/50 border border-white/5 overflow-hidden flex flex-col",eb?"rounded-none":"rounded-xl"),children:[(0,s.jsx)("div",{className:"p-3 border-b border-white/5 bg-zinc-900",children:(0,s.jsxs)("h2",{className:"font-semibold text-white flex items-center gap-2 text-sm",children:[(0,s.jsx)(h.A,{className:"h-4 w-4 text-violet-400"}),"元件庫"]})}),(0,s.jsx)(ei,{onAddItem:eq,hasData:!!t})]}),(0,s.jsxs)("main",{className:(0,j.cn)("flex-1 bg-zinc-950 overflow-hidden flex flex-col relative",eb?"rounded-none":"rounded-xl"),children:[(0,s.jsxs)("div",{className:"h-14 border-b border-white/5 flex items-center justify-between px-4 bg-zinc-900/90 gap-4 overflow-x-auto no-scrollbar",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 flex-shrink-0",children:[(0,s.jsxs)("span",{className:"text-sm font-medium text-zinc-400 whitespace-nowrap",children:["報表編輯器 ",(0,s.jsx)("span",{className:"text-zinc-600",children:"|"})," 第 ",c+1,"/",i.length," 頁"]}),(0,s.jsx)("div",{className:"h-4 w-px bg-white/10"}),(0,s.jsx)("div",{className:"flex items-center gap-1 bg-zinc-900 border border-white/10 rounded-lg p-0.5",children:["16:9","A4","1:1","9:16","4:5"].map(e=>(0,s.jsxs)(d.$,{size:"sm",variant:"ghost",onClick:()=>Q(e),className:(0,j.cn)("h-7 px-2 text-[10px] gap-1.5 rounded-md",N===e?"bg-violet-600 text-white shadow-sm":"text-zinc-400 hover:text-zinc-200 hover:bg-white/5"),title:e,children:["16:9"===e&&(0,s.jsx)("div",{className:"w-3.5 h-2 border border-current rounded-[1px]"}),"A4"===e&&(0,s.jsx)("div",{className:"w-2.5 h-3.5 border border-current rounded-[1px]"}),"1:1"===e&&(0,s.jsx)("div",{className:"w-3 h-3 border border-current rounded-[1px]"}),"9:16"===e&&(0,s.jsx)("div",{className:"w-2 h-3.5 border border-current rounded-[1px]"}),"4:5"===e&&(0,s.jsx)("div",{className:"w-2.5 h-3 border border-current rounded-[1px]"}),(0,s.jsx)("span",{className:"font-medium",children:e})]},e))})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[(0,s.jsxs)("div",{className:"bg-zinc-900 border border-white/10 rounded-lg p-0.5 flex",children:[(0,s.jsx)(d.$,{size:"icon",variant:"ghost",onClick:()=>k("single"),className:(0,j.cn)("h-7 w-7 rounded-md","single"===z?"bg-white/10 text-white":"text-zinc-500 hover:text-white"),title:"單頁模式",children:(0,s.jsx)("div",{className:"w-3 h-4 border border-current rounded-[1px]"})}),(0,s.jsx)(d.$,{size:"icon",variant:"ghost",onClick:()=>k("continuous"),className:(0,j.cn)("h-7 w-7 rounded-md","continuous"===z?"bg-white/10 text-white":"text-zinc-500 hover:text-white"),title:"多頁模式",children:(0,s.jsxs)("div",{className:"flex flex-col gap-[1px]",children:[(0,s.jsx)("div",{className:"w-3 h-2 border border-current rounded-[1px]"}),(0,s.jsx)("div",{className:"w-3 h-2 border border-current rounded-[1px]"})]})})]}),(0,s.jsx)(d.$,{size:"icon",variant:"ghost",onClick:eH,className:"h-7 w-7 rounded-md text-zinc-500 hover:text-white",title:eb?"離開全螢幕":"全螢幕",children:eb?(0,s.jsx)(u.A,{className:"h-4 w-4"}):(0,s.jsx)(x.A,{className:"h-4 w-4"})}),(0,s.jsx)(em,{}),(0,s.jsx)("div",{className:"h-4 w-px bg-white/10 mx-1"}),(0,s.jsxs)(d.$,{size:"sm",className:"bg-emerald-600/90 hover:bg-emerald-600 h-8 text-xs gap-1.5 px-3",disabled:0===eT.length,onClick:eK,children:[(0,s.jsx)(m.A,{className:"h-3.5 w-3.5"}),"PDF"]}),(0,s.jsxs)("div",{className:"flex bg-zinc-800/50 rounded-lg border border-white/5 p-0.5",children:[(0,s.jsx)(d.$,{size:"sm",variant:"ghost",className:"h-7 text-[10px] px-2 text-emerald-400 hover:bg-emerald-500/10 hover:text-emerald-300",disabled:0===eT.length,onClick:()=>eU("png"),children:"PNG"}),(0,s.jsx)("div",{className:"w-px bg-white/5 my-1"}),(0,s.jsx)(d.$,{size:"sm",variant:"ghost",className:"h-7 text-[10px] px-2 text-emerald-400 hover:bg-emerald-500/10 hover:text-emerald-300",disabled:0===eT.length,onClick:()=>eU("jpg"),children:"JPG"})]}),(0,s.jsx)(d.$,{variant:"ghost",size:"icon",className:"h-8 w-8 text-zinc-500 hover:text-red-400 hover:bg-red-500/10 rounded-lg ml-1",disabled:0===eT.length,onClick:eG,title:"清空畫布",children:(0,s.jsx)(p.A,{className:"h-4 w-4"})})]})]}),(0,s.jsxs)("div",{className:"h-10 border-b border-white/5 flex items-center px-2 bg-zinc-900/50 gap-1 overflow-x-auto",children:[(0,s.jsx)(d.$,{size:"icon",variant:"ghost",className:"h-7 w-7 flex-shrink-0",onClick:()=>X(c-1),disabled:0===c,children:(0,s.jsx)(g.A,{className:"h-4 w-4"})}),(0,s.jsx)(en.gB,{items:i.map(e=>e.id),strategy:en.m$,children:i.map((e,t)=>(0,s.jsx)(eh,{id:e.id,name:e.name,index:t,isActive:t===c,canDelete:i.length>1,onClick:()=>X(t),onDelete:()=>eY(e.id)},e.id))}),(0,s.jsx)(d.$,{size:"icon",variant:"ghost",className:"h-7 w-7 flex-shrink-0",onClick:()=>X(c+1),disabled:c===i.length-1,children:(0,s.jsx)(b.A,{className:"h-4 w-4"})}),(0,s.jsxs)(d.$,{size:"sm",variant:"ghost",className:"h-7 px-2 text-violet-400 hover:text-violet-300 hover:bg-violet-500/10 flex-shrink-0",onClick:eX,children:[(0,s.jsx)(f.A,{className:"h-4 w-4 mr-1"}),"新增頁面"]}),(0,s.jsxs)(d.$,{size:"sm",variant:"ghost",className:"h-7 px-2 text-cyan-400 hover:text-cyan-300 hover:bg-cyan-500/10 flex-shrink-0",onClick:eW,children:[(0,s.jsx)(v.A,{className:"h-4 w-4 mr-1"}),"規劃封面"]})]}),(0,s.jsx)("div",{className:"flex-1 p-4 flex flex-col items-center justify-center bg-zinc-950/50 overflow-hidden relative",onWheel:e=>{if(e.ctrlKey||e.metaKey){e.preventDefault();let t=e.deltaY>0?-10:10,a=Math.min(Math.max(w.Q.getState().zoomLevel+t,10),200);w.Q.getState().setZoomLevel(a)}},children:t||e||eV?(0,s.jsx)("div",{className:"relative w-full h-full flex items-center justify-center",style:{perspective:eN?"1200px":void 0},children:i.map((e,a)=>{let r=a-c;if(!eN&&0!==r||eN&&Math.abs(r)>2)return null;let i=0===r,n=1===Math.abs(r),l=((e,t)=>{if("single"===t)return 0===e?{transform:"translate(-50%, -50%) translateZ(0px) scale(1)",opacity:1,zIndex:5,filter:"none"}:{transform:"translate(-50%, -50%) translateZ(0px) scale(0.92)",opacity:0,zIndex:0,filter:"brightness(0.5)"};switch(e){case -2:return{transform:`translate(-50%, -50%) translateX(${-(.52*eF.width)}px) translateZ(-280px) scale(0.55)`,opacity:.25,zIndex:1,filter:"brightness(0.5)"};case -1:return{transform:`translate(-50%, -50%) translateX(${-(.38*eF.width)}px) translateZ(-120px) scale(0.75)`,opacity:.5,zIndex:2,filter:"brightness(0.65)"};case 0:return{transform:"translate(-50%, -50%) translateZ(0px) scale(1)",opacity:1,zIndex:5,filter:"none"};case 1:return{transform:`translate(-50%, -50%) translateX(${.38*eF.width}px) translateZ(-120px) scale(0.75)`,opacity:.5,zIndex:2,filter:"brightness(0.65)"};case 2:return{transform:`translate(-50%, -50%) translateX(${.52*eF.width}px) translateZ(-280px) scale(0.55)`,opacity:.25,zIndex:1,filter:"brightness(0.5)"};default:return{transform:"translate(-50%, -50%) translateZ(0px) scale(1)",opacity:0,zIndex:0,filter:"brightness(0.5)"}}})(r,ep?"single":"continuous"===z?"continuous":"single");return(0,s.jsx)("div",{className:(0,j.cn)("absolute left-1/2 top-1/2 transition-[transform,opacity,filter] duration-[900ms] ease-out will-change-transform",eN&&"cursor-pointer",n&&"group"),style:{...l,transformOrigin:"center center"},title:!i&&eN?`第 ${a+1} 頁 - ${e.name}`:void 0,onClick:()=>{if(eN)if(i){if("continuous"!==z||ep)return;eg(!0),null!==ex.current&&(cancelAnimationFrame(ex.current),ex.current=null);let e=performance.now();eo(60);let t=a=>{let s=Math.min(1,(a-e)/900);eo(Math.round(60+40*(s<.5?2*s*s:1-Math.pow(-2*s+2,2)/2))),s<1?ex.current=requestAnimationFrame(t):(ex.current=null,eg(!1),k("single"))};ex.current=requestAnimationFrame(t)}else X(a)},children:(0,s.jsx)(eu,{pageIndex:a,isActive:i,onFocus:()=>{},children:i?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"absolute -top-6 left-0 text-[10px] font-medium text-violet-300 bg-violet-500/10 border-t border-x border-violet-500/20 px-2 py-0.5 rounded-t-md",children:["Page ",a+1," - ",e.name]}),(0,s.jsx)("div",{className:(0,j.cn)("transition-shadow duration-300 rounded-lg overflow-hidden",eL(e.items)?"ring-0 shadow-none":"ring-2 ring-violet-500/40 shadow-[0_0_60px_rgba(139,92,246,0.15)]"),children:(0,s.jsx)(y,{width:eF.width,height:eF.height,items:e.items,fullBleed:eL(e.items),autoFit:!1,onClickBackground:()=>R(),onMarqueeSelect:(e,t)=>{t?e.forEach(e=>E(e)):P(e)},children:e.items.map(e=>(0,s.jsx)(U,{item:e,isSelected:S.includes(e.id),onSelect:t=>{t?.ctrlKey||t?.metaKey?I(e.id):P([e.id])},onUpdate:t=>eB(e.id,t),onRemove:()=>e_(e.id),onMoveToPage:t=>H(e.id,t),analysisData:t,canvasWidth:eF.width,canvasHeight:eF.height},e.id))})})]}):(0,s.jsxs)("div",{className:(0,j.cn)("relative rounded-xl overflow-hidden shadow-2xl",n?"shadow-black/50 border border-white/10 group-hover:border-white/20 transition-all duration-300":"border border-white/5"),children:[(0,s.jsx)("div",{className:"pointer-events-none",children:(0,s.jsx)(y,{width:eF.width,height:eF.height,items:e.items,fullBleed:eL(e.items),autoFit:!1,enableWheelZoom:!1,onClickBackground:()=>{},onMarqueeSelect:()=>{},children:e.items.map(a=>(0,s.jsx)(U,{item:a,isSelected:!1,onSelect:()=>{},onUpdate:()=>{},onRemove:()=>{},onMoveToPage:()=>{},analysisData:t,canvasWidth:eF.width,canvasHeight:eF.height},`thumb-${e.id}-${a.id}`))})}),n&&(0,s.jsxs)("div",{className:(0,j.cn)("absolute top-2 bg-black/60 backdrop-blur-sm text-zinc-300 text-[9px] font-bold px-1.5 py-0.5 rounded",r<0?"left-2":"right-2"),children:["P",a+1]})]})})},e.id)})}):(0,s.jsxs)("div",{className:"text-center space-y-4",children:[(0,s.jsx)("div",{className:"p-6 rounded-full bg-zinc-900 border border-white/5 inline-block",children:(0,s.jsx)(h.A,{className:"h-10 w-10 text-zinc-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-white",children:"尚未載入數據"}),(0,s.jsxs)("p",{className:"text-zinc-500 text-sm mt-1",children:["請先至 ",(0,s.jsx)(n(),{href:"/dashboard",className:"text-violet-400 hover:underline",children:"儀表板"})," 進行分析"]}),(0,s.jsx)("p",{className:"text-zinc-400 text-xs mt-2",children:"或先點上方「規劃封面」建立封面頁。"})]})]})})]})]}),(0,s.jsx)(ed.Hd,{dropAnimation:null,children:K?(0,s.jsxs)("div",{className:"px-4 py-3 bg-violet-600/80 backdrop-blur-sm text-white rounded-lg shadow-2xl border border-violet-400/50 flex items-center gap-2 pointer-events-none",children:[(0,s.jsx)("div",{className:"w-6 h-6 border-2 border-white/80 rounded flex items-center justify-center",children:(0,s.jsx)(f.A,{className:"w-4 h-4"})}),(0,s.jsxs)("span",{className:"text-sm font-medium",children:["多選拖移中... ",S.length>1?`(${S.length} 個元件)`:""]})]}):null}),G&&!K&&(!es||null!==ee&&ee!==c)&&(0,s.jsxs)("div",{className:(0,j.cn)("fixed z-[9999] pointer-events-none px-3 py-1.5 bg-violet-600 text-white rounded-full shadow-xl border-2 border-white/20 flex items-center gap-2 transform -translate-x-1/2 -translate-y-[150%] transition-transform",null!==ee&&ee!==c?"scale-110 bg-violet-500":""),style:{left:et.x,top:et.y},children:[(0,s.jsx)(f.A,{className:"w-4 h-4"}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"text-xs font-bold leading-none",children:null!==ee&&ee!==c?`移動至第 ${ee+1} 頁`:"跨頁移動"}),V>1&&(0,s.jsxs)("span",{className:"text-[9px] opacity-80 leading-none mt-0.5",children:["選取 ",V," 個元件"]})]})]})]}),(0,s.jsx)(ev,{isOpen:ey,onClose:()=>ez(!1),onExport:eJ,format:ek}),eC&&(0,s.jsx)("div",{className:"fixed inset-0 z-[10000] flex items-center justify-center bg-black/80 backdrop-blur-md animate-in fade-in duration-300",children:(0,s.jsxs)("div",{className:"text-center space-y-6 max-w-sm w-full px-6",children:[(0,s.jsxs)("div",{className:"relative mx-auto w-24 h-24",children:[(0,s.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-emerald-500/20"}),(0,s.jsx)("div",{className:"absolute inset-0 rounded-full border-4 border-emerald-500 border-t-transparent animate-spin",style:{animationDuration:"1.5s"}}),(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsx)(m.A,{className:"h-8 w-8 text-emerald-400"})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h3",{className:"text-xl font-bold text-white",children:"正在處理匯出..."}),(0,s.jsxs)("p",{className:"text-emerald-400 font-mono text-sm tracking-widest",children:["PAGE ",eD.current," OF ",eD.total]})]}),(0,s.jsx)("div",{className:"h-2 w-full bg-zinc-800 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full bg-emerald-500 transition-all duration-300 ease-out shadow-[0_0_10px_rgba(16,185,129,0.5)]",style:{width:`${eD.current/eD.total*100}%`}})}),(0,s.jsx)("p",{className:"text-zinc-500 text-xs italic",children:"請勿關閉視窗，正在準備下載內容"})]})})]})})},86120:(e,t,a)=>{"use strict";a.d(t,{b:()=>u,i:()=>x});var s=a(95155),r=a(12115),i=a(73321),n=a(16385),l=a(39430),o=a(62032),c=a(66614),d=a(80723);function h(){let e=(0,i.useRouter)();return(0,s.jsxs)("div",{className:"min-h-screen bg-black flex items-center justify-center p-4 relative overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-red-600/10 rounded-full blur-[128px] pointer-events-none"}),(0,s.jsx)("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-amber-600/10 rounded-full blur-[128px] pointer-events-none"}),(0,s.jsx)("div",{className:"relative z-10 max-w-md w-full",children:(0,s.jsxs)(l.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5},className:"bg-zinc-900/50 backdrop-blur-xl border border-red-500/20 rounded-3xl p-8 shadow-2xl overflow-hidden",children:[(0,s.jsxs)(l.P.div,{className:"w-20 h-20 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-6 border border-red-500/20 relative",initial:{rotate:-180,opacity:0},animate:{rotate:0,opacity:1},transition:{delay:.2,type:"spring"},children:[(0,s.jsx)(o.A,{className:"w-10 h-10 text-red-500"}),(0,s.jsx)(l.P.div,{className:"absolute inset-0 bg-red-500/20 rounded-full",animate:{scale:[1,1.2,1]},transition:{duration:2,repeat:1/0}})]}),(0,s.jsxs)("div",{className:"text-center space-y-3 mb-8",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-white tracking-tight",children:"Access Denied"}),(0,s.jsxs)("p",{className:"text-zinc-400 text-sm leading-relaxed",children:["權限不足。此區域僅限系統管理員訪問。",(0,s.jsx)("br",{}),"若您認為這是錯誤，請聯繫技術支援。"]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("button",{onClick:()=>e.push("/dashboard"),className:"w-full flex items-center justify-center gap-2 bg-white text-black hover:bg-zinc-200 font-bold py-3.5 px-4 rounded-xl transition-all active:scale-[0.98]",children:[(0,s.jsx)(c.A,{className:"w-4 h-4"}),"返回主控台 (Dashboard)"]}),(0,s.jsxs)("button",{onClick:()=>e.back(),className:"w-full flex items-center justify-center gap-2 bg-transparent hover:bg-white/5 text-zinc-400 hover:text-white font-medium py-3.5 px-4 rounded-xl border border-white/5 hover:border-white/10 transition-all active:scale-[0.98]",children:[(0,s.jsx)(d.A,{className:"w-4 h-4"}),"回上一頁"]})]}),(0,s.jsx)(l.P.div,{className:"mt-8 pt-6 border-t border-white/5 text-center",initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},children:(0,s.jsx)("p",{className:"text-[10px] text-zinc-600 font-mono uppercase tracking-widest",children:"Error: 403_FORBIDDEN"})})]})})]})}function u(){let[e,t]=(0,r.useState)({user:null,isAdmin:!1,permissions:{canPostAnnouncement:!1,accessibleCounties:[],isSuperAdmin:!1},isLoading:!0,error:null});return(0,r.useEffect)(()=>{let e=async()=>{try{let{data:{session:e},error:a}=await n.N.auth.getSession();if(a)throw a;if(!e?.user)return void t({user:null,isAdmin:!1,permissions:{canPostAnnouncement:!1,accessibleCounties:[],isSuperAdmin:!1},isLoading:!1,error:null});let{data:s,error:r}=await n.N.from("profiles").select("role, accessible_counties, can_post_announcement").eq("id",e.user.id).single();if(r){console.warn("Profile fetch error:",r),t({user:e.user,isAdmin:!1,permissions:{canPostAnnouncement:!1,accessibleCounties:[],isSuperAdmin:!1},isLoading:!1,error:null});return}let i=s?.role==="super_admin",l=s?.role==="admin"||i,o=i?null:s?.accessible_counties,c=!!i||s?.can_post_announcement||!1;t({user:e.user,isAdmin:l,permissions:{canPostAnnouncement:c,accessibleCounties:o,isSuperAdmin:i},isLoading:!1,error:null})}catch(e){console.error("Admin auth check error:",e),t({user:null,isAdmin:!1,permissions:{canPostAnnouncement:!1,accessibleCounties:[],isSuperAdmin:!1},isLoading:!1,error:e.message})}};e();let{data:{subscription:a}}=n.N.auth.onAuthStateChange(()=>{e()});return()=>a.unsubscribe()},[]),e}function x(e){return function(t){let{user:a,isAdmin:n,isLoading:l,error:o}=u(),c=(0,i.useRouter)();return((0,r.useEffect)(()=>{l||n||c.replace("/")},[l,n,c]),l)?(0,s.jsx)("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center space-y-4",children:[(0,s.jsx)("div",{className:"h-8 w-8 border-2 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin mx-auto"}),(0,s.jsx)("p",{className:"text-zinc-500 text-sm",children:"驗證管理員權限..."})]})}):a?n?(0,s.jsx)(e,{...t}):(0,s.jsx)(h,{}):(0,s.jsx)("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center space-y-4 p-8",children:[(0,s.jsx)("div",{className:"text-4xl",children:"\uD83D\uDD12"}),(0,s.jsx)("h1",{className:"text-xl font-bold text-white",children:"請先登入"}),(0,s.jsx)("p",{className:"text-zinc-500",children:"此頁面需要登入才能訪問"}),(0,s.jsx)("button",{onClick:()=>c.push("/"),className:"bg-cyan-600 hover:bg-cyan-500 text-white px-6 py-2 rounded-lg transition-colors",children:"前往登入"})]})})}}}},e=>{e.O(0,[4764,5969,3242,6119,5772,319,6609,7061,3403,8500,8875,455,5679,8441,3794,7358],()=>e(e.s=64977)),_N_E=e.O()}]);