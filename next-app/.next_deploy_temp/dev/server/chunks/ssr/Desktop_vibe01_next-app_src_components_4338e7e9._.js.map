{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/layout/Sidebar.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport Link from \"next/link\";\nimport { usePathname, useRouter } from \"next/navigation\";\nimport { supabase } from \"@/lib/supabase\";\nimport { cn } from \"@/lib/utils\";\nimport {\n    LayoutDashboard,\n    PieChart,\n    Map,\n    Settings,\n    FileText,\n    LogOut,\n    Building,\n    BookOpen,\n    AtSign,\n    Ruler,\n    User\n} from \"lucide-react\";\n\nexport const NAV_ITEMS = [\n    { label: \"會員登入\", href: \"/\", icon: User },\n    { label: \"總覽儀表板\", href: \"/dashboard\", icon: LayoutDashboard },\n    { label: \"地圖模式\", href: \"/map\", icon: Map },\n    { label: \"平面圖測量\", href: \"/tools/floor-plan\", icon: Ruler },\n    { label: \"分析報告\", href: \"/reports\", icon: FileText },\n    { label: \"開發者日誌\", href: \"https://medium.com/@sqmtalk7\", icon: BookOpen, isExternal: true },\n    { label: \"Threads\", href: \"https://www.threads.net/@sqm.talk\", icon: AtSign, isExternal: true },\n];\n\nexport function Sidebar() {\n    const pathname = usePathname();\n    const [user, setUser] = React.useState<any>(null);\n    const router = useRouter();\n\n    React.useEffect(() => {\n        // Get initial session\n        supabase.auth.getSession().then(({ data: { session } }) => {\n            setUser(session?.user ?? null);\n        });\n\n        // Listen for changes\n        const {\n            data: { subscription },\n        } = supabase.auth.onAuthStateChange((_event, session) => {\n            setUser(session?.user ?? null);\n        });\n\n        return () => subscription.unsubscribe();\n    }, []);\n\n    const handleLogout = async () => {\n        await supabase.auth.signOut();\n        router.push('/');\n    };\n\n    return (\n        <aside className=\"hidden lg:flex fixed left-0 top-0 z-50 h-screen w-20 flex-col border-r border-white/5 bg-zinc-950 transition-all duration-300 ease-in-out hover:w-64 group shadow-2xl shadow-black/50 overflow-hidden\">\n            {/* Brand */}\n            <div className=\"flex h-16 items-center px-6 border-b border-white/5 overflow-hidden whitespace-nowrap\">\n                <div className=\"flex items-center gap-3 font-bold text-xl tracking-tight text-white\">\n                    <div className=\"flex-shrink-0 flex h-8 w-8 items-center justify-center rounded-lg bg-violet-600 text-white shadow-lg shadow-violet-500/30\">\n                        <Building className=\"h-5 w-5\" />\n                    </div>\n                    <span className=\"opacity-0 group-hover:opacity-100 transition-opacity duration-300 delay-100\">\n                        平米內參\n                    </span>\n                </div>\n            </div>\n\n            {/* Nav */}\n            <div className=\"flex-1 overflow-y-auto overflow-x-hidden py-6 px-3 scrollbar-none\">\n                <nav className=\"flex flex-col gap-1 space-y-1\">\n                    {NAV_ITEMS.map((item) => {\n                        // Hide \"Login\" if user is logged in\n                        if (user && item.label === \"會員登入\") return null;\n\n                        const isActive = pathname === item.href;\n                        // @ts-ignore\n                        const isExternal = item.isExternal;\n\n                        return (\n                            <Link\n                                key={item.href}\n                                href={item.href}\n                                target={isExternal ? \"_blank\" : undefined}\n                                rel={isExternal ? \"noopener noreferrer\" : undefined}\n                                className={cn(\n                                    \"flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-all duration-200 min-h-[40px]\", // height fixed\n                                    isActive\n                                        ? \"bg-violet-500/10 text-violet-400 font-semibold\"\n                                        : \"text-zinc-400 hover:bg-zinc-900 hover:text-zinc-100\"\n                                )}\n                            >\n                                <item.icon className={cn(\"h-5 w-5 flex-shrink-0\", isActive ? \"text-violet-400\" : \"text-zinc-500\")} />\n                                <span className=\"opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap translate-x-[-10px] group-hover:translate-x-0\">\n                                    {item.label}\n                                </span>\n                            </Link>\n                        );\n                    })}\n                </nav>\n\n                {/* Separator */}\n                <div className=\"my-6 border-t border-white/5 mx-3\" />\n\n                <nav className=\"flex flex-col gap-1 space-y-1\">\n                    <Link\n                        href=\"/settings\"\n                        className=\"flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium text-zinc-400 hover:bg-zinc-900 hover:text-zinc-100 transition-colors min-h-[40px]\"\n                    >\n                        <Settings className=\"h-5 w-5 flex-shrink-0 text-zinc-500\" />\n                        <span className=\"opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap\">\n                            系統設定\n                        </span>\n                    </Link>\n                </nav>\n            </div>\n\n            {/* User Footer - Only show if logged in */}\n            {user && (\n                <div className=\"border-t border-white/5 p-4 bg-zinc-950\">\n                    <div className=\"flex items-center gap-3 rounded-lg bg-zinc-900/50 p-3 hover:bg-zinc-900 transition-colors cursor-pointer border border-transparent hover:border-white/5 overflow-hidden\">\n                        <div className=\"h-9 w-9 flex-shrink-0 rounded-full bg-gradient-to-br from-violet-500 to-indigo-600 flex items-center justify-center text-xs font-bold text-white ring-2 ring-zinc-950\">\n                            {user.email?.[0].toUpperCase() ?? 'U'}\n                        </div>\n                        <div className=\"flex-1 overflow-hidden opacity-0 group-hover:opacity-100 transition-opacity duration-300 min-w-[120px]\">\n                            <p className=\"truncate text-sm font-medium text-zinc-200\">User</p>\n                            <p className=\"truncate text-xs text-zinc-500\">{user.email}</p>\n                        </div>\n                        <button onClick={handleLogout} className=\"p-1 hover:bg-red-500/20 rounded-full transition-colors opacity-0 group-hover:opacity-100\">\n                            <LogOut className=\"h-4 w-4 text-zinc-500 hover:text-red-400\" />\n                        </button>\n                    </div>\n                </div>\n            )}\n        </aside>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 297, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/ui/button.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { type VariantProps, cva } from \"class-variance-authority\"\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n    \"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\",\n    {\n        variants: {\n            variant: {\n                default: \"bg-primary text-primary-foreground hover:bg-primary/90 shadow-lg shadow-violet-500/20\",\n                destructive: \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n                outline: \"border border-input bg-zinc-900/50 hover:bg-zinc-800 hover:text-accent-foreground\",\n                secondary: \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n                ghost: \"hover:bg-accent hover:text-accent-foreground\",\n                link: \"text-primary underline-offset-4 hover:underline\",\n                glass: \"bg-white/5 backdrop-blur-sm border border-white/10 hover:bg-white/10 text-zinc-100\",\n            },\n            size: {\n                default: \"h-10 px-4 py-2\",\n                sm: \"h-9 rounded-md px-3\",\n                lg: \"h-11 rounded-md px-8\",\n                icon: \"h-10 w-10\",\n            },\n        },\n        defaultVariants: {\n            variant: \"default\",\n            size: \"default\",\n        },\n    }\n)\n\nexport interface ButtonProps\n    extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n    asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n    ({ className, variant, size, asChild = false, ...props }, ref) => {\n        const Comp = asChild ? Slot : \"button\"\n        return (\n            <Comp\n                className={cn(buttonVariants({ variant, size, className }))}\n                ref={ref}\n                {...props}\n            />\n        )\n    }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;;;;;;AAEA,MAAM,iBAAiB,IAAA,2MAAG,EACtB,0RACA;IACI,UAAU;QACN,SAAS;YACL,SAAS;YACT,aAAa;YACb,SAAS;YACT,WAAW;YACX,OAAO;YACP,MAAM;YACN,OAAO;QACX;QACA,MAAM;YACF,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;QACV;IACJ;IACA,iBAAiB;QACb,SAAS;QACT,MAAM;IACV;AACJ;AASJ,MAAM,uBAAS,uPAAgB,CAC3B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,KAAK,EAAE,GAAG,OAAO,EAAE;IACtD,MAAM,OAAO,UAAU,4MAAI,GAAG;IAC9B,qBACI,kRAAC;QACG,WAAW,IAAA,6JAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACxD,KAAK;QACJ,GAAG,KAAK;;;;;;AAGrB;AAEJ,OAAO,WAAW,GAAG"}},
    {"offset": {"line": 358, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/ui/input.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nexport interface InputProps\n    extends React.InputHTMLAttributes<HTMLInputElement> { }\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n    ({ className, type, ...props }, ref) => {\n        return (\n            <input\n                type={type}\n                className={cn(\n                    \"flex h-10 w-full rounded-md border border-input bg-zinc-950/50 px-3 py-2 text-sm text-zinc-100 ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n                    className\n                )}\n                ref={ref}\n                {...props}\n            />\n        )\n    }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAKA,MAAM,sBAAQ,uPAAgB,CAC1B,CAAC,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAO,EAAE;IAC5B,qBACI,kRAAC;QACG,MAAM;QACN,WAAW,IAAA,6JAAE,EACT,uWACA;QAEJ,KAAK;QACJ,GAAG,KAAK;;;;;;AAGrB;AAEJ,MAAM,WAAW,GAAG"}},
    {"offset": {"line": 386, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/layout/Header.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport { Search, Bell, Menu } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport Link from \"next/link\";\nimport { NAV_ITEMS } from \"./Sidebar\";\nimport { cn } from \"@/lib/utils\";\n\nexport function Header() {\n    const [isMenuOpen, setIsMenuOpen] = React.useState(false);\n\n    return (\n        <header className=\"sticky top-0 z-40 flex h-16 w-full items-center border-b border-white/5 bg-zinc-950/80 backdrop-blur-md px-6 shadow-sm\">\n            <div className=\"flex items-center gap-4 lg:hidden\">\n                <Button variant=\"ghost\" size=\"icon\" className=\"-ml-2\" onClick={() => setIsMenuOpen(!isMenuOpen)}>\n                    <Menu className=\"h-5 w-5\" />\n                </Button>\n            </div>\n\n            <div className=\"flex flex-1 items-center justify-between gap-4\">\n                {/* Left: Global Search or Breadcrumb */}\n                <div className=\"hidden lg:flex max-w-sm flex-1 items-center gap-2\">\n                    <div className=\"relative w-full\">\n                        <Search className=\"absolute left-2.5 top-2.5 h-4 w-4 text-zinc-500\" />\n                        <Input\n                            placeholder=\"全站搜尋...\"\n                            className=\"w-full bg-zinc-900/50 pl-9 border-zinc-800 focus:border-violet-500/50\"\n                        />\n                    </div>\n                </div>\n\n                {/* Right: Actions */}\n                <div className=\"flex items-center gap-2\">\n\n                    <Link\n                        href=\"/admin/uploader\"\n                        className=\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-9 px-3 text-zinc-400 hover:text-white\"\n                    >\n                        Uploader\n                    </Link>\n                    <div className=\"h-4 w-[1px] bg-zinc-800 mx-2\" />\n                    <Button variant=\"ghost\" size=\"icon\" className=\"relative text-zinc-400 hover:text-white hover:bg-zinc-800\">\n                        <Bell className=\"h-5 w-5\" />\n                        <span className=\"absolute top-2 right-2 h-2 w-2 rounded-full bg-violet-500 ring-2 ring-zinc-950 block\" />\n                    </Button>\n                </div>\n            </div>\n\n            {/* Mobile Menu Overlay */}\n            {isMenuOpen && (\n                <div className=\"absolute top-16 left-0 w-full bg-zinc-950 border-b border-zinc-800 p-4 shadow-xl lg:hidden animate-in slide-in-from-top-2\">\n                    <nav className=\"flex flex-col gap-2\">\n                        {NAV_ITEMS.map((item) => {\n                            // @ts-ignore\n                            const isExternal = item.isExternal;\n                            return (\n                                <Link\n                                    key={item.href}\n                                    href={item.href}\n                                    target={isExternal ? \"_blank\" : undefined}\n                                    rel={isExternal ? \"noopener noreferrer\" : undefined}\n                                    onClick={() => setIsMenuOpen(false)}\n                                    className=\"flex items-center gap-3 rounded-md px-3 py-3 text-sm font-medium text-zinc-400 hover:bg-zinc-900 hover:text-zinc-100 transition-colors\"\n                                >\n                                    <item.icon className=\"h-5 w-5 text-zinc-500\" />\n                                    {item.label}\n                                </Link>\n                            );\n                        })}\n                    </nav>\n                </div>\n            )}\n        </header>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAPA;;;;;;;;AAUO,SAAS;IACZ,MAAM,CAAC,YAAY,cAAc,GAAG,oPAAK,CAAC,QAAQ,CAAC;IAEnD,qBACI,kRAAC;QAAO,WAAU;;0BACd,kRAAC;gBAAI,WAAU;0BACX,cAAA,kRAAC,gLAAM;oBAAC,SAAQ;oBAAQ,MAAK;oBAAO,WAAU;oBAAQ,SAAS,IAAM,cAAc,CAAC;8BAChF,cAAA,kRAAC,8OAAI;wBAAC,WAAU;;;;;;;;;;;;;;;;0BAIxB,kRAAC;gBAAI,WAAU;;kCAEX,kRAAC;wBAAI,WAAU;kCACX,cAAA,kRAAC;4BAAI,WAAU;;8CACX,kRAAC,oPAAM;oCAAC,WAAU;;;;;;8CAClB,kRAAC,8KAAK;oCACF,aAAY;oCACZ,WAAU;;;;;;;;;;;;;;;;;kCAMtB,kRAAC;wBAAI,WAAU;;0CAEX,kRAAC,2MAAI;gCACD,MAAK;gCACL,WAAU;0CACb;;;;;;0CAGD,kRAAC;gCAAI,WAAU;;;;;;0CACf,kRAAC,gLAAM;gCAAC,SAAQ;gCAAQ,MAAK;gCAAO,WAAU;;kDAC1C,kRAAC,8OAAI;wCAAC,WAAU;;;;;;kDAChB,kRAAC;wCAAK,WAAU;;;;;;;;;;;;;;;;;;;;;;;;YAM3B,4BACG,kRAAC;gBAAI,WAAU;0BACX,cAAA,kRAAC;oBAAI,WAAU;8BACV,wLAAS,CAAC,GAAG,CAAC,CAAC;wBACZ,aAAa;wBACb,MAAM,aAAa,KAAK,UAAU;wBAClC,qBACI,kRAAC,2MAAI;4BAED,MAAM,KAAK,IAAI;4BACf,QAAQ,aAAa,WAAW;4BAChC,KAAK,aAAa,wBAAwB;4BAC1C,SAAS,IAAM,cAAc;4BAC7B,WAAU;;8CAEV,kRAAC,KAAK,IAAI;oCAAC,WAAU;;;;;;gCACpB,KAAK,KAAK;;2BARN,KAAK,IAAI;;;;;oBAW1B;;;;;;;;;;;;;;;;;AAMxB"}},
    {"offset": {"line": 576, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/layout/AppLayout.tsx"],"sourcesContent":["import React from \"react\";\nimport { Sidebar } from \"./Sidebar\";\nimport { Header } from \"./Header\";\n\ninterface AppLayoutProps {\n    children: React.ReactNode;\n}\n\nexport function AppLayout({ children }: AppLayoutProps) {\n    return (\n        <div className=\"min-h-screen bg-zinc-950 text-zinc-100 flex\">\n            {/* Sidebar - Fixed Left */}\n            <Sidebar />\n\n            {/* Main Content Area */}\n            <div className=\"flex-1 flex flex-col lg:pl-20 min-w-0 transition-all duration-300\">\n                <Header />\n\n                <main className=\"flex-1 p-4 md:p-6 lg:p-8 overflow-y-auto\">\n                    <div className=\"container-custom py-6 space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n                        {children}\n                    </div>\n                </main>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AACA;AACA;;;;AAMO,SAAS,UAAU,EAAE,QAAQ,EAAkB;IAClD,qBACI,kRAAC;QAAI,WAAU;;0BAEX,kRAAC,sLAAO;;;;;0BAGR,kRAAC;gBAAI,WAAU;;kCACX,kRAAC,oLAAM;;;;;kCAEP,kRAAC;wBAAK,WAAU;kCACZ,cAAA,kRAAC;4BAAI,WAAU;sCACV;;;;;;;;;;;;;;;;;;;;;;;AAMzB"}},
    {"offset": {"line": 635, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/ui/MultiSelect.tsx"],"sourcesContent":["import React, { useState, useRef, useEffect, forwardRef } from 'react';\nimport { cn } from \"@/lib/utils\";\nimport { X, Check } from \"lucide-react\";\n\nexport interface MultiSelectOption {\n    label: string;\n    value: string;\n    group?: string;\n    details?: {\n        county?: string;\n        district?: string;\n        date?: string;\n    }\n}\n\ninterface MultiSelectProps {\n    options: MultiSelectOption[];\n    value: string[];\n    onChange: (value: string[]) => void;\n    placeholder?: string;\n    maxItems?: number;\n    disabled?: boolean;\n    className?: string;\n    onSearch?: (query: string) => void;\n    loading?: boolean;\n}\n\nconst MultiSelect = forwardRef<HTMLDivElement, MultiSelectProps>(({\n    options,\n    value,\n    onChange,\n    placeholder = \"Select...\",\n    maxItems,\n    disabled = false,\n    className,\n    onSearch,\n    loading = false\n}, ref) => {\n    const [inputValue, setInputValue] = useState(\"\");\n    const [isOpen, setIsOpen] = useState(false);\n    const containerRef = useRef<HTMLDivElement>(null);\n    const inputRef = useRef<HTMLInputElement>(null);\n\n    // Filter options based on input if onSearch is not provided (client-side filtering)\n    const filteredOptions = onSearch\n        ? options\n        : options.filter(option =>\n            option.label.toLowerCase().includes(inputValue.toLowerCase())\n        );\n\n    const handleSelect = (optionValue: string) => {\n        if (value.includes(optionValue)) {\n            onChange(value.filter(v => v !== optionValue));\n        } else {\n            if (maxItems && value.length >= maxItems) return;\n            onChange([...value, optionValue]);\n        }\n        setInputValue(\"\");\n    };\n\n    const handleRemove = (optionValue: string, e: React.MouseEvent) => {\n        e.stopPropagation();\n        onChange(value.filter(v => v !== optionValue));\n    };\n\n    const handleKeyDown = (e: React.KeyboardEvent) => {\n        if (e.key === 'Backspace' && inputValue === '' && value.length > 0) {\n            onChange(value.slice(0, -1));\n        }\n    };\n\n    const selectedLabels = value.map(v => {\n        // Try to find label in options, or fallback to value if not found (e.g. initial load)\n        const option = options.find(o => o.value === v);\n        return option ? option.label : v;\n    });\n\n    useEffect(() => {\n        const handleClickOutside = (event: MouseEvent) => {\n            if (containerRef.current && !containerRef.current.contains(event.target as Node)) {\n                setIsOpen(false);\n            }\n        };\n        document.addEventListener(\"mousedown\", handleClickOutside);\n        return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n    }, []);\n\n    useEffect(() => {\n        if (onSearch) {\n            onSearch(inputValue);\n        }\n    }, [inputValue, onSearch]);\n\n    return (\n        <div className={cn(\"relative w-full\", className)} ref={containerRef}>\n            <div\n                className={cn(\n                    \"flex items-center gap-2 bg-zinc-950/50 border border-input rounded-md px-2 py-1.5 h-[42px] overflow-x-auto custom-scrollbar cursor-text transition-all\",\n                    isOpen && \"ring-2 ring-ring ring-offset-0 border-ring\",\n                    disabled && \"bg-zinc-900/50 cursor-not-allowed opacity-50\"\n                )}\n                onClick={() => !disabled && inputRef.current?.focus()}\n            >\n                {value.map((v) => {\n\n                    // Find label logic again for render\n                    const option = options.find(o => o.value === v);\n                    const label = option ? option.label : v;\n\n                    return (\n                        <span key={v} className=\"bg-violet-500/20 text-violet-200 border border-violet-500/30 text-xs rounded-full px-2 py-0.5 flex items-center gap-1 animate-in fade-in zoom-in-95 duration-100 whitespace-nowrap shrink-0\">\n                            {label}\n                            {!disabled && (\n                                <X\n                                    size={12}\n                                    className=\"cursor-pointer hover:text-white transition-colors\"\n                                    onClick={(e) => handleRemove(v, e)}\n                                />\n                            )}\n                        </span>\n                    );\n                })}\n\n                <input\n                    ref={inputRef}\n                    type=\"text\"\n                    value={inputValue}\n                    onChange={(e) => setInputValue(e.target.value)}\n                    onFocus={() => setIsOpen(true)}\n                    onKeyDown={handleKeyDown}\n                    placeholder={value.length === 0 ? placeholder : \"\"}\n                    className={cn(\n                        \"bg-transparent outline-none flex-grow min-w-[60px] text-zinc-100 placeholder:text-zinc-500 text-sm\",\n                        disabled && \"cursor-not-allowed\"\n                    )}\n                    disabled={disabled}\n                />\n            </div>\n\n            {\n                isOpen && !disabled && (\n                    <div className=\"absolute z-50 w-full mt-1 bg-zinc-900 border border-zinc-700 rounded-md shadow-xl max-h-60 overflow-y-auto custom-scrollbar animate-in fade-in slide-in-from-top-2 duration-100\">\n                        {loading ? (\n                            <div className=\"p-2 text-center text-zinc-500 text-sm\">Loading...</div>\n                        ) : filteredOptions.length === 0 ? (\n                            <div className=\"p-2 text-center text-zinc-500 text-sm\">No options found</div>\n                        ) : (\n                            filteredOptions.map((option, index) => {\n                                if (!option) return null;\n                                const showHeader = index === 0 || option.group !== filteredOptions[index - 1]?.group;\n                                return (\n                                    <React.Fragment key={option.value}>\n                                        {showHeader && option.group && (\n                                            <div className=\"px-2 py-1 bg-zinc-800/50 text-xs font-semibold text-zinc-400 sticky top-0 backdrop-blur-sm z-10\">\n                                                {option.group}\n                                            </div>\n                                        )}\n                                        <div\n                                            className={cn(\n                                                \"px-3 py-2 cursor-pointer text-sm flex items-start justify-between hover:bg-zinc-800 transition-colors\",\n                                                value.includes(option.value) && \"bg-violet-500/10 text-violet-400\"\n                                            )}\n                                            onClick={() => handleSelect(option.value)}\n                                        >\n                                            <div className=\"flex flex-col\">\n                                                <span className=\"font-medium\">{option.label}</span>\n                                                {option.details && (\n                                                    <div className=\"flex items-center gap-2 mt-0.5\">\n                                                        {(option.details.county || option.details.district) && (\n                                                            <span className=\"text-xs text-zinc-500 bg-zinc-800/80 px-1.5 rounded border border-zinc-700\">\n                                                                {option.details.county}{option.details.district}\n                                                            </span>\n                                                        )}\n                                                        {option.details.date && (\n                                                            <span className=\"text-xs text-zinc-600 font-mono\">\n                                                                {option.details.date.substring(0, 7)}\n                                                            </span>\n                                                        )}\n                                                    </div>\n                                                )}\n                                            </div>\n                                            {value.includes(option.value) && <Check size={16} className=\"mt-1\" />}\n                                        </div>\n                                    </React.Fragment>\n                                );\n                            })\n                        )}\n                    </div>\n                )\n            }\n        </div >\n    );\n});\n\nMultiSelect.displayName = \"MultiSelect\";\nexport { MultiSelect };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 868, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/ui/select.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\nimport { ChevronDown } from \"lucide-react\"\n\nexport interface SelectProps\n    extends React.SelectHTMLAttributes<HTMLSelectElement> { }\n\nconst Select = React.forwardRef<HTMLSelectElement, SelectProps>(\n    ({ className, children, ...props }, ref) => {\n        return (\n            <div className=\"relative\">\n                <select\n                    className={cn(\n                        \"flex h-10 w-full appearance-none rounded-md border border-input bg-zinc-950/50 px-3 py-2 text-sm text-zinc-100 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 pr-8\",\n                        className\n                    )}\n                    ref={ref}\n                    {...props}\n                >\n                    {children}\n                </select>\n                <ChevronDown className=\"absolute right-3 top-2.5 h-4 w-4 opacity-50 pointer-events-none\" />\n            </div>\n        )\n    }\n)\nSelect.displayName = \"Select\"\n\nexport { Select }\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;AAKA,MAAM,uBAAS,uPAAgB,CAC3B,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,OAAO,EAAE;IAChC,qBACI,kRAAC;QAAI,WAAU;;0BACX,kRAAC;gBACG,WAAW,IAAA,6JAAE,EACT,kSACA;gBAEJ,KAAK;gBACJ,GAAG,KAAK;0BAER;;;;;;0BAEL,kRAAC,uQAAW;gBAAC,WAAU;;;;;;;;;;;;AAGnC;AAEJ,OAAO,WAAW,GAAG"}},
    {"offset": {"line": 914, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/features/FilterBar.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect, useCallback, useRef } from \"react\";\nimport { useFilterStore } from \"@/store/useFilterStore\";\nimport { MultiSelect, MultiSelectOption } from \"@/components/ui/MultiSelect\";\nimport { Select } from \"@/components/ui/select\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { RotateCcw, Search, LineChart, FileDown, Filter, X } from \"lucide-react\";\nimport { DISTRICT_DATA, COUNTY_CODE_MAP } from \"@/lib/config\";\nimport { api } from \"@/lib/api\";\nimport { getDateRangeDates } from \"@/lib/date-utils\";\n\ninterface FilterBarProps {\n    onAnalyze?: () => void;\n    isLoading?: boolean;\n}\n\nexport function FilterBar({ onAnalyze, isLoading }: FilterBarProps) {\n    // Store\n    const {\n        counties,\n        districts,\n        transactionType,\n        buildingType,\n        projectNames,\n        dateRange,\n        startDate,\n        endDate,\n        excludeCommercial,\n        setCounties,\n        setDistricts,\n        setTransactionType,\n        setBuildingType,\n        setProjectNames,\n        setDateRange,\n        setCustomDate,\n        setExcludeCommercial,\n        resetFilters\n    } = useFilterStore();\n\n    const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\n\n    // Local State for Project Suggestions\n    const [projectOptions, setProjectOptions] = useState<MultiSelectOption[]>([]);\n    const [isSearchingProjects, setIsSearchingProjects] = useState(false);\n\n    // Options Data\n    const countyOptions: MultiSelectOption[] = Object.keys(COUNTY_CODE_MAP).map(key => ({\n        label: key,\n        value: key\n    }));\n\n    const districtOptions: MultiSelectOption[] = React.useMemo(() => {\n        if (counties.length === 0) return [];\n        return counties.flatMap(county => {\n            const dists = DISTRICT_DATA[county] || [];\n            return dists.map(d => ({\n                label: d,\n                value: d,\n                group: county\n            }));\n        });\n    }, [counties]);\n\n    // Handlers\n    const handleCountyChange = (newCounties: string[]) => {\n        if (newCounties.length > 6) return; // Limit 6\n        setCounties(newCounties);\n    };\n\n    const handleDistrictChange = (newDistricts: string[]) => {\n        setDistricts(newDistricts);\n    };\n\n    const handleDateRangeChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\n        const val = e.target.value;\n        if (val === 'custom') {\n            setDateRange('custom', startDate, endDate);\n        } else {\n            // Calculate dates logic using shared utility\n            const { startDate: start, endDate: end } = getDateRangeDates(val);\n            if (start && end) {\n                setDateRange(val, start, end);\n            }\n        }\n    };\n\n    // Project Search with debounce\n    const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n    const [searchError, setSearchError] = useState<string | null>(null);\n\n    const fetchProjects = useCallback(async (query: string) => {\n        if (!query || query.length < 1 || counties.length === 0) {\n            setProjectOptions([]);\n            return;\n        }\n        setIsSearchingProjects(true);\n        setSearchError(null);\n        try {\n            const promises = counties.map(async c => {\n                const code = COUNTY_CODE_MAP[c];\n                const relevantDistricts = districts.filter(d => DISTRICT_DATA[c]?.includes(d));\n                return api.fetchProjectNameSuggestions(code, query, relevantDistricts)\n                    .then(res => {\n                        // Handle different response formats\n                        let list: any[] = [];\n                        if (Array.isArray(res)) {\n                            list = res;\n                        } else if (res && res.data && Array.isArray(res.data)) {\n                            list = res.data;\n                        } else if (res && res.names && Array.isArray(res.names)) {\n                            list = res.names;\n                        }\n                        return list.map((item: any) => {\n                            const isString = typeof item === 'string';\n                            const name = isString ? item : (item.name || item.建案名稱 || String(item));\n                            return {\n                                label: name,\n                                value: name,\n                                group: c,\n                                details: isString ? undefined : {\n                                    county: c,\n                                    district: item.district || item.行政區,\n                                    date: item.earliestDate || item.交易日\n                                }\n                            };\n                        });\n                    })\n                    .catch(err => {\n                        console.error(`Failed to fetch projects for ${c}:`, err);\n                        return [];\n                    });\n            });\n\n            const results = await Promise.all(promises);\n            const aggregated = results.flat();\n\n            const unique = Array.from(new Map(aggregated.map(item => [item.value, item])).values());\n            setProjectOptions(unique);\n\n            if (unique.length === 0 && query.length >= 2) {\n                console.log(`No projects found for query \"${query}\" in counties: ${counties.join(', ')}`);\n            }\n\n        } catch (err) {\n            console.error('Project search error:', err);\n            setSearchError('搜尋失敗，請稍後再試');\n        } finally {\n            setIsSearchingProjects(false);\n        }\n    }, [counties, districts]);\n\n    // Debounced search handler\n    const handleProjectSearch = useCallback((query: string) => {\n        if (searchTimeoutRef.current) {\n            clearTimeout(searchTimeoutRef.current);\n        }\n        searchTimeoutRef.current = setTimeout(() => {\n            fetchProjects(query);\n        }, 300); // 300ms debounce\n    }, [fetchProjects]);\n\n    // Cleanup timeout on unmount\n    useEffect(() => {\n        return () => {\n            if (searchTimeoutRef.current) {\n                clearTimeout(searchTimeoutRef.current);\n            }\n        };\n    }, []);\n\n    return (\n        <div className=\"p-4 md:p-6 glass-card rounded-xl shadow-lg animate-in fade-in slide-in-from-top-4 duration-500\">\n            {/* Mobile Header & Toggle */}\n            <div className=\"flex md:hidden items-center justify-between mb-4\">\n                <h2 className=\"text-lg font-bold text-white flex items-center gap-2\">\n                    <Filter className=\"h-5 w-5 text-violet-500\" />\n                    篩選條件\n                </h2>\n                <div className=\"flex gap-2\">\n                    <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}\n                        className=\"border-zinc-700 text-zinc-300\"\n                    >\n                        {isMobileMenuOpen ? <X className=\"h-4 w-4\" /> : <Filter className=\"h-4 w-4\" />}\n                        {isMobileMenuOpen ? '收起' : '展開'}\n                    </Button>\n                    <Button\n                        variant=\"default\"\n                        size=\"sm\"\n                        className=\"bg-violet-600 text-white\"\n                        disabled={counties.length === 0 || isLoading}\n                        onClick={onAnalyze}\n                    >\n                        {isLoading ? '...' : '分析'}\n                    </Button>\n                </div>\n            </div>\n\n            <div className={`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-7 gap-4 items-end ${isMobileMenuOpen ? 'block' : 'hidden md:grid'}`}>\n\n                {/* County */}\n                <div className=\"xl:col-span-1\">\n                    <div className=\"flex justify-between items-center mb-1\">\n                        <div className=\"flex items-center gap-2\">\n                            <label className=\"text-sm font-medium text-zinc-300\">縣市</label>\n                            {counties.length > 3 && (\n                                <span className=\"text-xs text-amber-500 font-normal animate-in fade-in\">\n                                    (已選 {counties.length}/6)\n                                </span>\n                            )}\n                        </div>\n                        {counties.length > 0 && (\n                            <button onClick={() => setCounties([])} className=\"text-xs text-cyan-400 hover:text-cyan-300\">清除</button>\n                        )}\n                    </div>\n                    <MultiSelect\n                        options={countyOptions}\n                        value={counties}\n                        onChange={handleCountyChange}\n                        placeholder=\"請選擇縣市...\"\n                        maxItems={6}\n                    />\n                </div>\n\n                {/* District */}\n                <div className=\"xl:col-span-1\">\n                    <div className=\"flex justify-between items-center mb-1\">\n                        <label className=\"text-sm font-medium text-zinc-300\">行政區</label>\n                        {districts.length > 0 && (\n                            <button onClick={() => setDistricts([])} className=\"text-xs text-cyan-400 hover:text-cyan-300\">清除</button>\n                        )}\n                    </div>\n                    <MultiSelect\n                        options={districtOptions}\n                        value={districts}\n                        onChange={handleDistrictChange}\n                        placeholder={counties.length > 0 ? \"請選擇行政區...\" : \"請先選縣市\"}\n                        disabled={counties.length === 0}\n                    />\n                </div>\n\n                {/* Transaction Type */}\n                <div>\n                    <label className=\"block text-sm font-medium text-zinc-300 mb-1\">交易類型</label>\n                    <Select value={transactionType} onChange={(e) => setTransactionType(e.target.value)}>\n                        <option value=\"預售交易\">預售交易</option>\n                        <option value=\"中古交易\" disabled>中古交易 (開發中)</option>\n                    </Select>\n                </div>\n\n                {/* Building Type */}\n                <div>\n                    <label className=\"block text-sm font-medium text-zinc-300 mb-1\">建物型態</label>\n                    <Select value={buildingType} onChange={(e) => setBuildingType(e.target.value)}>\n                        <option value=\"\">全部</option>\n                        <option value=\"住宅大樓(11層含以上有電梯)\">住宅大樓</option>\n                        <option value=\"華廈(10層含以下有電梯)\">華廈</option>\n                        <option value=\"公寓(5層含以下無電梯)\">公寓</option>\n                        <option value=\"套房(1房(1廳)1衛)\">套房</option>\n                        <option value=\"透天厝\">透天厝</option>\n                        <option value=\"店面(店鋪)\">店面</option>\n                        <option value=\"辦公商業大樓\">辦公商業大樓</option>\n                        <option value=\"工廠\">工廠/廠辦</option>\n                        <option value=\"其他\">其他</option>\n                    </Select>\n                </div>\n\n                {/* Project Name */}\n                <div className=\"xl:col-span-3\">\n                    <div className=\"flex justify-between items-center mb-1\">\n                        <label className=\"text-sm font-medium text-zinc-300\">建案名稱</label>\n                        {projectNames.length > 0 && (\n                            <button onClick={() => setProjectNames([])} className=\"text-xs text-cyan-400 hover:text-cyan-300\">清除</button>\n                        )}\n                    </div>\n                    <MultiSelect\n                        options={projectOptions}\n                        value={projectNames}\n                        onChange={setProjectNames}\n                        placeholder={counties.length > 0 ? \"輸入建案名稱搜尋...\" : \"請先選縣市\"}\n                        disabled={counties.length === 0}\n                        onSearch={handleProjectSearch}\n                        loading={isSearchingProjects}\n                    />\n                    {searchError && <span className=\"text-xs text-red-400 mt-1\">{searchError}</span>}\n                </div>\n\n                {/* Date Range Group */}\n                <div className=\"xl:col-span-3 sm:col-span-2 grid grid-cols-1 sm:grid-cols-3 gap-4\">\n                    <div>\n                        <label className=\"block text-sm font-medium text-zinc-300 mb-1\">快捷時間</label>\n                        <Select value={dateRange} onChange={handleDateRangeChange}>\n                            <option value=\"custom\">自訂範圍</option>\n                            <option value=\"1q\">近一季 (3個月)</option>\n                            <option value=\"2q\">近兩季 (6個月)</option>\n                            <option value=\"3q\">近三季 (9個月)</option>\n                            <option value=\"1y\">近一年 (12個月)</option>\n                            <option value=\"this_year\">今年以來</option>\n                            <option value=\"last_2_years\">去年＋今年</option>\n                        </Select>\n                    </div>\n                    <div>\n                        <label className=\"block text-sm font-medium text-zinc-300 mb-1\">起始日期</label>\n                        <Input\n                            type=\"date\"\n                            value={startDate}\n                            onChange={(e) => setCustomDate(e.target.value, endDate)}\n                            className=\"bg-zinc-950/50 border-input text-zinc-100\"\n                        />\n                    </div>\n                    <div>\n                        <div className=\"flex justify-between items-center mb-1\">\n                            <label className=\"block text-sm font-medium text-zinc-300\">結束日期</label>\n                            <button\n                                onClick={() => {\n                                    const today = new Date().toISOString().split('T')[0];\n                                    setCustomDate(startDate, today);\n                                }}\n                                className=\"text-xs text-cyan-400 hover:text-cyan-300\"\n                            >\n                                抓取今日\n                            </button>\n                        </div>\n                        <Input\n                            type=\"date\"\n                            value={endDate}\n                            onChange={(e) => setCustomDate(startDate, e.target.value)}\n                            className=\"bg-zinc-950/50 border-input text-zinc-100\"\n                        />\n                    </div>\n                </div>\n\n                {/* Buttons */}\n                <div className=\"xl:col-span-4 sm:col-span-2 flex items-end gap-4 justify-end mt-4 md:mt-0\">\n                    <div className=\"flex items-center gap-4 mr-auto\">\n                        <label className=\"flex items-center gap-2 text-sm text-zinc-300 cursor-pointer\">\n                            <input\n                                type=\"checkbox\"\n                                checked={excludeCommercial}\n                                onChange={(e) => setExcludeCommercial(e.target.checked)}\n                                className=\"rounded border-zinc-600 bg-zinc-800 text-violet-500 focus:ring-violet-500 accent-violet-500\"\n                            />\n                            <span>排除商辦/店面</span>\n                        </label>\n                    </div>\n\n                    <Button variant=\"outline\" className=\"hidden xl:flex bg-green-900/20 border-green-500/30 text-green-400 hover:bg-green-900/40 hover:text-green-300\">\n                        <FileDown className=\"mr-2 h-4 w-4\" />\n                        輸出報表\n                    </Button>\n\n                    <Button\n                        variant=\"default\"\n                        className=\"bg-violet-600 hover:bg-violet-500 text-white min-w-[120px] hidden md:flex\"\n                        disabled={counties.length === 0 || isLoading}\n                        onClick={onAnalyze}\n                    >\n                        {isLoading ? <span className=\"animate-spin mr-2\">⟳</span> : <LineChart className=\"mr-2 h-4 w-4\" />}\n                        {isLoading ? '分析中...' : '分析報表'}\n                    </Button>\n\n\n                </div>\n\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1736, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n    HTMLDivElement,\n    React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n    <div\n        ref={ref}\n        className={cn(\n            \"glass-panel rounded-xl text-card-foreground\",\n            className\n        )}\n        {...props}\n    />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n    HTMLDivElement,\n    React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n    <div\n        ref={ref}\n        className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n        {...props}\n    />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n    HTMLParagraphElement,\n    React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n    <h3\n        ref={ref}\n        className={cn(\n            \"text-lg font-semibold leading-none tracking-tight text-white\",\n            className\n        )}\n        {...props}\n    />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n    HTMLParagraphElement,\n    React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n    <p\n        ref={ref}\n        className={cn(\"text-sm text-zinc-400\", className)}\n        {...props}\n    />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n    HTMLDivElement,\n    React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n    <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n    HTMLDivElement,\n    React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n    <div\n        ref={ref}\n        className={cn(\"flex items-center p-6 pt-0\", className)}\n        {...props}\n    />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA;AACA;;;;AAEA,MAAM,qBAAO,uPAAgB,CAG3B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBACxB,kRAAC;QACG,KAAK;QACL,WAAW,IAAA,6JAAE,EACT,+CACA;QAEH,GAAG,KAAK;;;;;;AAGjB,KAAK,WAAW,GAAG;AAEnB,MAAM,2BAAa,uPAAgB,CAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBACxB,kRAAC;QACG,KAAK;QACL,WAAW,IAAA,6JAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGjB,WAAW,WAAW,GAAG;AAEzB,MAAM,0BAAY,uPAAgB,CAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBACxB,kRAAC;QACG,KAAK;QACL,WAAW,IAAA,6JAAE,EACT,gEACA;QAEH,GAAG,KAAK;;;;;;AAGjB,UAAU,WAAW,GAAG;AAExB,MAAM,gCAAkB,uPAAgB,CAGtC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBACxB,kRAAC;QACG,KAAK;QACL,WAAW,IAAA,6JAAE,EAAC,yBAAyB;QACtC,GAAG,KAAK;;;;;;AAGjB,gBAAgB,WAAW,GAAG;AAE9B,MAAM,4BAAc,uPAAgB,CAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBACxB,kRAAC;QAAI,KAAK;QAAK,WAAW,IAAA,6JAAE,EAAC,YAAY;QAAa,GAAG,KAAK;;;;;;AAElE,YAAY,WAAW,GAAG;AAE1B,MAAM,2BAAa,uPAAgB,CAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBACxB,kRAAC;QACG,KAAK;QACL,WAAW,IAAA,6JAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGjB,WAAW,WAAW,GAAG"}},
    {"offset": {"line": 1821, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/reports/ReportWrapper.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport { Card } from \"@/components/ui/card\";\nimport { cn } from \"@/lib/utils\";\n\ninterface ReportWrapperProps {\n    title: string;\n    description?: string;\n    children: React.ReactNode;\n    action?: React.ReactNode;\n    className?: string;\n}\n\nexport function ReportWrapper({ title, description, children, action, className }: ReportWrapperProps) {\n    return (\n        <Card className={cn(\"bg-zinc-900/50 border-white/5 overflow-hidden\", className)}>\n            <div className=\"p-6 border-b border-white/5 flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n                <div className=\"space-y-1\">\n                    <h2 className=\"text-xl font-semibold text-white tracking-tight\">{title}</h2>\n                    {description && <p className=\"text-sm text-zinc-400\">{description}</p>}\n                </div>\n                {action && <div className=\"flex items-center gap-2\">{action}</div>}\n            </div>\n            <div className=\"p-6\">\n                {children}\n            </div>\n        </Card>\n    );\n}\n"],"names":[],"mappings":";;;;;AAGA;AACA;AAJA;;;;AAcO,SAAS,cAAc,EAAE,KAAK,EAAE,WAAW,EAAE,QAAQ,EAAE,MAAM,EAAE,SAAS,EAAsB;IACjG,qBACI,kRAAC,4KAAI;QAAC,WAAW,IAAA,6JAAE,EAAC,iDAAiD;;0BACjE,kRAAC;gBAAI,WAAU;;kCACX,kRAAC;wBAAI,WAAU;;0CACX,kRAAC;gCAAG,WAAU;0CAAmD;;;;;;4BAChE,6BAAe,kRAAC;gCAAE,WAAU;0CAAyB;;;;;;;;;;;;oBAEzD,wBAAU,kRAAC;wBAAI,WAAU;kCAA2B;;;;;;;;;;;;0BAEzD,kRAAC;gBAAI,WAAU;0BACV;;;;;;;;;;;;AAIjB"}},
    {"offset": {"line": 1897, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/charts/ChartWrapper.tsx"],"sourcesContent":["'use client';\n\nimport dynamic from 'next/dynamic';\nimport { Card } from '@/components/ui/card';\nimport { ApexOptions } from 'apexcharts';\n\n// Dynamically import ReactApexChart to avoid SSR issues\nconst Chart = dynamic(() => import('react-apexcharts'), { ssr: false });\n\ninterface ChartWrapperProps {\n    type: 'line' | 'area' | 'bar' | 'pie' | 'donut' | 'radar' | 'scatter' | 'bubble' | 'heatmap' | 'candlestick' | 'boxPlot' | 'treemap' | 'polarArea' | 'rangeBar' | 'rangeArea' | 'radialBar';\n    series: ApexAxisChartSeries | ApexNonAxisChartSeries;\n    options: ApexOptions;\n    height?: number | string;\n    title?: string;\n    description?: string;\n    className?: string;\n    loading?: boolean;\n}\n\nexport default function ChartWrapper({ type, series, options, height = 350, title, description, className, loading }: ChartWrapperProps) {\n\n    // Default Dark Theme Options\n    const defaultOptions: ApexOptions = {\n        chart: {\n            background: 'transparent',\n            toolbar: {\n                show: false\n            }\n        },\n        theme: {\n            mode: 'dark',\n            palette: 'palette1'\n        },\n        dataLabels: {\n            enabled: false\n        },\n        grid: {\n            borderColor: '#374151', // border-default\n            strokeDashArray: 4,\n        },\n        xaxis: {\n            labels: {\n                style: {\n                    colors: '#9ca3af' // text-dark\n                }\n            },\n            axisBorder: {\n                color: '#4b5563'\n            },\n            axisTicks: {\n                color: '#4b5563'\n            }\n        },\n        yaxis: {\n            labels: {\n                style: {\n                    colors: '#9ca3af'\n                }\n            }\n        },\n        tooltip: {\n            theme: 'dark',\n            style: {\n                fontSize: '12px'\n            },\n            x: {\n                show: true\n            }\n        }\n    };\n\n    // Deep merge logic would be better, but basic spread is fine for now\n    const mergedOptions = {\n        ...defaultOptions,\n        ...options,\n        chart: {\n            ...defaultOptions.chart,\n            ...options.chart\n        }\n    };\n\n    return (\n        <Card className={`p-4 ${className}`}>\n            {(title || description) && (\n                <div className=\"mb-4\">\n                    {title && <h3 className=\"text-lg font-bold text-white mb-1\">{title}</h3>}\n                    {description && <p className=\"text-sm text-gray-400\">{description}</p>}\n                </div>\n            )}\n\n            {loading ? (\n                <div className=\"flex items-center justify-center\" style={{ height }}>\n                    <div className=\"loader\"></div>\n                    {/* Need global css loader or use svg */}\n                </div>\n            ) : (\n                <Chart options={mergedOptions} series={series} type={type} height={height} width=\"100%\" />\n            )}\n        </Card>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;;AAHA;;;;AAMA,wDAAwD;AACxD,MAAM,QAAQ,IAAA,8MAAO;;;;;;IAAqC,KAAK;;AAahD,SAAS,aAAa,EAAE,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,SAAS,GAAG,EAAE,KAAK,EAAE,WAAW,EAAE,SAAS,EAAE,OAAO,EAAqB;IAEnI,6BAA6B;IAC7B,MAAM,iBAA8B;QAChC,OAAO;YACH,YAAY;YACZ,SAAS;gBACL,MAAM;YACV;QACJ;QACA,OAAO;YACH,MAAM;YACN,SAAS;QACb;QACA,YAAY;YACR,SAAS;QACb;QACA,MAAM;YACF,aAAa;YACb,iBAAiB;QACrB;QACA,OAAO;YACH,QAAQ;gBACJ,OAAO;oBACH,QAAQ,UAAU,YAAY;gBAClC;YACJ;YACA,YAAY;gBACR,OAAO;YACX;YACA,WAAW;gBACP,OAAO;YACX;QACJ;QACA,OAAO;YACH,QAAQ;gBACJ,OAAO;oBACH,QAAQ;gBACZ;YACJ;QACJ;QACA,SAAS;YACL,OAAO;YACP,OAAO;gBACH,UAAU;YACd;YACA,GAAG;gBACC,MAAM;YACV;QACJ;IACJ;IAEA,qEAAqE;IACrE,MAAM,gBAAgB;QAClB,GAAG,cAAc;QACjB,GAAG,OAAO;QACV,OAAO;YACH,GAAG,eAAe,KAAK;YACvB,GAAG,QAAQ,KAAK;QACpB;IACJ;IAEA,qBACI,kRAAC,4KAAI;QAAC,WAAW,CAAC,IAAI,EAAE,WAAW;;YAC9B,CAAC,SAAS,WAAW,mBAClB,kRAAC;gBAAI,WAAU;;oBACV,uBAAS,kRAAC;wBAAG,WAAU;kCAAqC;;;;;;oBAC5D,6BAAe,kRAAC;wBAAE,WAAU;kCAAyB;;;;;;;;;;;;YAI7D,wBACG,kRAAC;gBAAI,WAAU;gBAAmC,OAAO;oBAAE;gBAAO;0BAC9D,cAAA,kRAAC;oBAAI,WAAU;;;;;;;;;;qCAInB,kRAAC;gBAAM,SAAS;gBAAe,QAAQ;gBAAQ,MAAM;gBAAM,QAAQ;gBAAQ,OAAM;;;;;;;;;;;;AAIjG"}},
    {"offset": {"line": 2043, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/charts/RankingChart.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useMemo } from \"react\";\nimport ChartWrapper from \"./ChartWrapper\";\nimport { ApexOptions } from \"apexcharts\";\n\ninterface ProjectRankingItem {\n    projectName: string;\n    [key: string]: any;\n}\n\ninterface RankingChartProps {\n    data: ProjectRankingItem[];\n    sortKey: string;\n}\n\nexport function RankingChart({ data, sortKey }: RankingChartProps) {\n    const chartType = useMemo(() => {\n        const barChartKeys = [\n            \"averagePrice\",\n            \"minPrice\",\n            \"maxPrice\",\n            \"medianPrice\",\n            \"avgParkingPrice\",\n        ];\n        return barChartKeys.includes(sortKey) ? \"bar\" : \"treemap\";\n    }, [sortKey]);\n\n    const chartConfig = useMemo(() => {\n        const keyDetails: Record<string, { title: string; unit: string; yLabel?: string }> = {\n            averagePrice: { title: \"建案平均單價排行\", unit: \"萬/坪\" },\n            minPrice: { title: \"建案最低單價排行\", unit: \"萬/坪\" },\n            maxPrice: { title: \"建案最高單價排行\", unit: \"萬/坪\" },\n            medianPrice: { title: \"建案單價中位數排行\", unit: \"萬/坪\" },\n            avgParkingPrice: { title: \"車位平均單價排行\", unit: \"萬\" },\n            saleAmountSum: { title: \"建案銷售總額佔比\", unit: \"萬\", yLabel: \"銷售總額\" },\n            houseAreaSum: { title: \"建案房屋面積佔比\", unit: \"坪\", yLabel: \"房屋面積\" },\n            transactionCount: { title: \"建案交易筆數佔比\", unit: \"筆\", yLabel: \"資料筆數\" },\n        };\n        return (\n            keyDetails[sortKey] || {\n                title: \"建案分析圖表\",\n                unit: \"\",\n                yLabel: \"數值\",\n            }\n        );\n    }, [sortKey]);\n\n    const series = useMemo(() => {\n        if (!data || data.length === 0) return [];\n\n        if (chartType === \"bar\") {\n            // Filter and sort for Bar Chart\n            const sortedData = [...data]\n                .filter(p => p[sortKey] > 0)\n                .sort((a, b) => a[sortKey] - b[sortKey])\n                .slice(-30);\n\n            return [{\n                name: chartConfig.unit,\n                data: sortedData.map(p => ({\n                    x: p.projectName,\n                    y: parseFloat((p[sortKey] || 0).toFixed(2))\n                }))\n            }];\n        } else {\n            // Treemap\n            const totalValue = data.reduce((sum, p) => sum + (p[sortKey] || 0), 0);\n            return [{\n                name: chartConfig.yLabel || chartConfig.unit,\n                data: data.map(p => ({\n                    x: p.projectName,\n                    y: parseFloat((p[sortKey] || 0).toFixed(2))\n                }))\n            }];\n        }\n    }, [data, sortKey, chartType, chartConfig]);\n\n    const options: ApexOptions = useMemo(() => {\n        const baseOptions: ApexOptions = {\n            title: {\n                text: chartConfig.title,\n                align: \"center\",\n                style: { fontSize: \"16px\", fontWeight: 600, color: \"#e5e7eb\" },\n            },\n            tooltip: {\n                theme: \"dark\",\n                y: {\n                    formatter: (val: number) => `${val.toLocaleString()} ${chartConfig.unit}`\n                }\n            }\n        };\n\n        if (chartType === \"bar\") {\n            const dataLength = series[0]?.data.length || 0;\n            const calculatedHeight = Math.max(400, dataLength * 32);\n\n            return {\n                ...baseOptions,\n                chart: {\n                    type: 'bar',\n                    height: calculatedHeight,\n                    toolbar: { show: true },\n                    animations: { enabled: false }\n                },\n                plotOptions: {\n                    bar: {\n                        horizontal: true,\n                        barHeight: \"70%\",\n                        borderRadius: 6,\n                        distributed: true,\n                    },\n                },\n                dataLabels: {\n                    enabled: true,\n                    textAnchor: \"start\",\n                    offsetX: 0,\n                    formatter: (val: number) => val.toLocaleString(),\n                    style: { colors: [\"#fff\"] }\n                },\n                xaxis: {\n                    // categories handles by x in series data\n                    labels: { style: { colors: \"#9ca3af\" } }\n                },\n                yaxis: {\n                    labels: {\n                        maxWidth: 200,\n                        style: { colors: \"#e5e7eb\", fontSize: \"12px\", fontWeight: 500 }\n                    }\n                },\n                legend: { show: false }\n            };\n        } else {\n            // Treemap options\n            const totalValue = data.reduce((sum, p) => sum + (p[sortKey] || 0), 0);\n\n            return {\n                ...baseOptions,\n                chart: {\n                    type: 'treemap',\n                    height: 450,\n                    toolbar: { show: true }\n                },\n                plotOptions: {\n                    treemap: {\n                        distributed: true,\n                        enableShades: false,\n                        colorScale: {\n                            ranges: [\n                                { from: 0, to: totalValue * 0.1, color: '#06b6d4' }, // cyan\n                                { from: totalValue * 0.1, to: totalValue * 0.3, color: '#3b82f6' }, // blue\n                                { from: totalValue * 0.3, to: totalValue * 0.6, color: '#8b5cf6' }, // violet\n                                { from: totalValue * 0.6, to: Infinity, color: '#d946ef' } // fuchsia\n                            ]\n                        }\n                    }\n                },\n                dataLabels: {\n                    enabled: true,\n                    style: {\n                        fontSize: '11px',\n                        fontWeight: 500,\n                        colors: ['#fff']\n                    },\n                    formatter: function (text: string, op: any) {\n                        // Show project name in each treemap cell\n                        return text;\n                    },\n                    offsetY: -2\n                },\n                tooltip: {\n                    ...baseOptions.tooltip,\n                    y: {\n                        formatter: (value: number) => {\n                            const percentage = totalValue > 0 ? ((value / totalValue) * 100).toFixed(2) : 0;\n                            return `${value.toLocaleString()} ${chartConfig.unit} (${percentage}%)`;\n                        }\n                    }\n                }\n            };\n        }\n    }, [chartType, series, chartConfig, data, sortKey]);\n\n    if (!data || data.length === 0) {\n        return <div className=\"text-zinc-500 text-center p-8\">無排名資料可顯示</div>;\n    }\n\n    return (\n        <ChartWrapper\n            type={chartType === 'bar' ? 'bar' : 'treemap'}\n            series={series}\n            options={options}\n            height={chartType === 'bar' ? (options.chart?.height || 400) : 450}\n            className=\"w-full\"\n        />\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAgBO,SAAS,aAAa,EAAE,IAAI,EAAE,OAAO,EAAqB;IAC7D,MAAM,YAAY,IAAA,oPAAO,EAAC;QACtB,MAAM,eAAe;YACjB;YACA;YACA;YACA;YACA;SACH;QACD,OAAO,aAAa,QAAQ,CAAC,WAAW,QAAQ;IACpD,GAAG;QAAC;KAAQ;IAEZ,MAAM,cAAc,IAAA,oPAAO,EAAC;QACxB,MAAM,aAA+E;YACjF,cAAc;gBAAE,OAAO;gBAAY,MAAM;YAAM;YAC/C,UAAU;gBAAE,OAAO;gBAAY,MAAM;YAAM;YAC3C,UAAU;gBAAE,OAAO;gBAAY,MAAM;YAAM;YAC3C,aAAa;gBAAE,OAAO;gBAAa,MAAM;YAAM;YAC/C,iBAAiB;gBAAE,OAAO;gBAAY,MAAM;YAAI;YAChD,eAAe;gBAAE,OAAO;gBAAY,MAAM;gBAAK,QAAQ;YAAO;YAC9D,cAAc;gBAAE,OAAO;gBAAY,MAAM;gBAAK,QAAQ;YAAO;YAC7D,kBAAkB;gBAAE,OAAO;gBAAY,MAAM;gBAAK,QAAQ;YAAO;QACrE;QACA,OACI,UAAU,CAAC,QAAQ,IAAI;YACnB,OAAO;YACP,MAAM;YACN,QAAQ;QACZ;IAER,GAAG;QAAC;KAAQ;IAEZ,MAAM,SAAS,IAAA,oPAAO,EAAC;QACnB,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,GAAG,OAAO,EAAE;QAEzC,IAAI,cAAc,OAAO;YACrB,gCAAgC;YAChC,MAAM,aAAa;mBAAI;aAAK,CACvB,MAAM,CAAC,CAAA,IAAK,CAAC,CAAC,QAAQ,GAAG,GACzB,IAAI,CAAC,CAAC,GAAG,IAAM,CAAC,CAAC,QAAQ,GAAG,CAAC,CAAC,QAAQ,EACtC,KAAK,CAAC,CAAC;YAEZ,OAAO;gBAAC;oBACJ,MAAM,YAAY,IAAI;oBACtB,MAAM,WAAW,GAAG,CAAC,CAAA,IAAK,CAAC;4BACvB,GAAG,EAAE,WAAW;4BAChB,GAAG,WAAW,CAAC,CAAC,CAAC,QAAQ,IAAI,CAAC,EAAE,OAAO,CAAC;wBAC5C,CAAC;gBACL;aAAE;QACN,OAAO;YACH,UAAU;YACV,MAAM,aAAa,KAAK,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,CAAC,CAAC,CAAC,QAAQ,IAAI,CAAC,GAAG;YACpE,OAAO;gBAAC;oBACJ,MAAM,YAAY,MAAM,IAAI,YAAY,IAAI;oBAC5C,MAAM,KAAK,GAAG,CAAC,CAAA,IAAK,CAAC;4BACjB,GAAG,EAAE,WAAW;4BAChB,GAAG,WAAW,CAAC,CAAC,CAAC,QAAQ,IAAI,CAAC,EAAE,OAAO,CAAC;wBAC5C,CAAC;gBACL;aAAE;QACN;IACJ,GAAG;QAAC;QAAM;QAAS;QAAW;KAAY;IAE1C,MAAM,UAAuB,IAAA,oPAAO,EAAC;QACjC,MAAM,cAA2B;YAC7B,OAAO;gBACH,MAAM,YAAY,KAAK;gBACvB,OAAO;gBACP,OAAO;oBAAE,UAAU;oBAAQ,YAAY;oBAAK,OAAO;gBAAU;YACjE;YACA,SAAS;gBACL,OAAO;gBACP,GAAG;oBACC,WAAW,CAAC,MAAgB,GAAG,IAAI,cAAc,GAAG,CAAC,EAAE,YAAY,IAAI,EAAE;gBAC7E;YACJ;QACJ;QAEA,IAAI,cAAc,OAAO;YACrB,MAAM,aAAa,MAAM,CAAC,EAAE,EAAE,KAAK,UAAU;YAC7C,MAAM,mBAAmB,KAAK,GAAG,CAAC,KAAK,aAAa;YAEpD,OAAO;gBACH,GAAG,WAAW;gBACd,OAAO;oBACH,MAAM;oBACN,QAAQ;oBACR,SAAS;wBAAE,MAAM;oBAAK;oBACtB,YAAY;wBAAE,SAAS;oBAAM;gBACjC;gBACA,aAAa;oBACT,KAAK;wBACD,YAAY;wBACZ,WAAW;wBACX,cAAc;wBACd,aAAa;oBACjB;gBACJ;gBACA,YAAY;oBACR,SAAS;oBACT,YAAY;oBACZ,SAAS;oBACT,WAAW,CAAC,MAAgB,IAAI,cAAc;oBAC9C,OAAO;wBAAE,QAAQ;4BAAC;yBAAO;oBAAC;gBAC9B;gBACA,OAAO;oBACH,yCAAyC;oBACzC,QAAQ;wBAAE,OAAO;4BAAE,QAAQ;wBAAU;oBAAE;gBAC3C;gBACA,OAAO;oBACH,QAAQ;wBACJ,UAAU;wBACV,OAAO;4BAAE,QAAQ;4BAAW,UAAU;4BAAQ,YAAY;wBAAI;oBAClE;gBACJ;gBACA,QAAQ;oBAAE,MAAM;gBAAM;YAC1B;QACJ,OAAO;YACH,kBAAkB;YAClB,MAAM,aAAa,KAAK,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,CAAC,CAAC,CAAC,QAAQ,IAAI,CAAC,GAAG;YAEpE,OAAO;gBACH,GAAG,WAAW;gBACd,OAAO;oBACH,MAAM;oBACN,QAAQ;oBACR,SAAS;wBAAE,MAAM;oBAAK;gBAC1B;gBACA,aAAa;oBACT,SAAS;wBACL,aAAa;wBACb,cAAc;wBACd,YAAY;4BACR,QAAQ;gCACJ;oCAAE,MAAM;oCAAG,IAAI,aAAa;oCAAK,OAAO;gCAAU;gCAClD;oCAAE,MAAM,aAAa;oCAAK,IAAI,aAAa;oCAAK,OAAO;gCAAU;gCACjE;oCAAE,MAAM,aAAa;oCAAK,IAAI,aAAa;oCAAK,OAAO;gCAAU;gCACjE;oCAAE,MAAM,aAAa;oCAAK,IAAI;oCAAU,OAAO;gCAAU,EAAE,UAAU;6BACxE;wBACL;oBACJ;gBACJ;gBACA,YAAY;oBACR,SAAS;oBACT,OAAO;wBACH,UAAU;wBACV,YAAY;wBACZ,QAAQ;4BAAC;yBAAO;oBACpB;oBACA,WAAW,SAAU,IAAY,EAAE,EAAO;wBACtC,yCAAyC;wBACzC,OAAO;oBACX;oBACA,SAAS,CAAC;gBACd;gBACA,SAAS;oBACL,GAAG,YAAY,OAAO;oBACtB,GAAG;wBACC,WAAW,CAAC;4BACR,MAAM,aAAa,aAAa,IAAI,CAAC,AAAC,QAAQ,aAAc,GAAG,EAAE,OAAO,CAAC,KAAK;4BAC9E,OAAO,GAAG,MAAM,cAAc,GAAG,CAAC,EAAE,YAAY,IAAI,CAAC,EAAE,EAAE,WAAW,EAAE,CAAC;wBAC3E;oBACJ;gBACJ;YACJ;QACJ;IACJ,GAAG;QAAC;QAAW;QAAQ;QAAa;QAAM;KAAQ;IAElD,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,GAAG;QAC5B,qBAAO,kRAAC;YAAI,WAAU;sBAAgC;;;;;;IAC1D;IAEA,qBACI,kRAAC,2LAAY;QACT,MAAM,cAAc,QAAQ,QAAQ;QACpC,QAAQ;QACR,SAAS;QACT,QAAQ,cAAc,QAAS,QAAQ,KAAK,EAAE,UAAU,MAAO;QAC/D,WAAU;;;;;;AAGtB"}},
    {"offset": {"line": 2323, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/reports/RankingReport.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useMemo } from \"react\";\nimport { ReportWrapper } from \"./ReportWrapper\";\nimport { RankingChart } from \"@/components/charts/RankingChart\";\nimport { useFilterStore } from \"@/store/useFilterStore\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select } from \"@/components/ui/select\";\nimport { ChevronLeft, ChevronRight, ArrowUpDown, ArrowUp, ArrowDown } from \"lucide-react\";\n\ninterface ProjectRankingItem {\n    projectName: string;\n    county: string;\n    district: string;\n    saleAmountSum: number;\n    houseAreaSum: number;\n    transactionCount: number;\n    marketShare: number;\n    averagePrice: number;\n    minPrice: number;\n    maxPrice: number;\n    medianPrice: number;\n    avgParkingPrice: number;\n    [key: string]: any;\n}\n\ninterface CoreMetrics {\n    totalSaleAmount: number;\n    totalHouseArea: number;\n    overallAveragePrice: number;\n    transactionCount: number;\n}\n\ninterface RankingReportProps {\n    data: {\n        coreMetrics: CoreMetrics;\n        projectRanking: ProjectRankingItem[];\n    } | null;\n    visibleSections?: string[];\n}\n\nexport function RankingReport({ data, visibleSections = ['metrics', 'chart', 'table'] }: RankingReportProps) {\n    const {\n        rankingCurrentPage,\n        rankingPageSize,\n        setRankingCurrentPage,\n        setRankingPageSize\n    } = useFilterStore(); // Assuming these are in store, or we manage locally? \n    // Legacy managed in state.js. Let's use local state for pagination/sorting to keep component clean or use store if global.\n    // Implementation Plan: \"Connect to Zustand store\". The legacy `state.rankingCurrentPage` was global. \n    // For now, let's use local state for sort, and maybe local for pagination unless other components need it.\n    // But wait, \"Analysis\" button triggers data fetch and resets pages.\n    // Let's stick to local state for now for simplicity, can lift up if needed.\n\n    const [localPage, setLocalPage] = useState(1); // Use local for now\n    const [pageSize, setPageSize] = useState(10);\n    const [sortConfig, setSortConfig] = useState<{ key: string; order: 'asc' | 'desc' }>({ key: 'saleAmountSum', order: 'desc' });\n\n    if (!data) return null;\n\n    const { coreMetrics, projectRanking } = data;\n\n    // Sorting\n    const sortedData = useMemo(() => {\n        if (!projectRanking) return [];\n        return [...projectRanking].sort((a, b) => {\n            const valA = a[sortConfig.key] || 0;\n            const valB = b[sortConfig.key] || 0;\n            return sortConfig.order === 'desc' ? valB - valA : valA - valB;\n        });\n    }, [projectRanking, sortConfig]);\n\n    // Pagination\n    const totalPages = Math.ceil(sortedData.length / pageSize);\n    const pagedData = sortedData.slice((localPage - 1) * pageSize, localPage * pageSize);\n\n    const handleSort = (key: string) => {\n        setSortConfig(current => ({\n            key,\n            order: current.key === key && current.order === 'desc' ? 'asc' : 'desc'\n        }));\n    };\n\n    const MetricCard = ({ title, value, unit }: { title: string, value: string, unit: string }) => (\n        <div className=\"bg-zinc-800/50 rounded-lg p-4 border border-white/5 flex flex-col items-center justify-center text-center\">\n            <div className=\"text-zinc-400 text-sm mb-1\">{title}</div>\n            <div className=\"flex items-baseline gap-1\">\n                <span className=\"text-2xl font-bold text-white\">{value}</span>\n                <span className=\"text-xs text-zinc-500\">{unit}</span>\n            </div>\n        </div>\n    );\n\n    return (\n        <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n\n            {/* 1. Core Metrics */}\n            {visibleSections.includes('metrics') && (\n                <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                    <MetricCard\n                        title=\"市場去化總銷售金額\"\n                        value={coreMetrics.totalSaleAmount.toLocaleString()}\n                        unit=\"萬\"\n                    />\n                    <MetricCard\n                        title=\"總銷去化房屋坪數\"\n                        value={coreMetrics.totalHouseArea.toLocaleString(undefined, { maximumFractionDigits: 2 })}\n                        unit=\"坪\"\n                    />\n                    <MetricCard\n                        title=\"總平均單價\"\n                        value={coreMetrics.overallAveragePrice.toLocaleString(undefined, { maximumFractionDigits: 2 })}\n                        unit=\"萬/坪\"\n                    />\n                    <MetricCard\n                        title=\"總交易筆數\"\n                        value={coreMetrics.transactionCount.toLocaleString()}\n                        unit=\"筆\"\n                    />\n                </div>\n            )}\n\n\n            {/* 2. Chart */}\n            {visibleSections.includes('chart') && (\n                <ReportWrapper title=\"建案分析圖表\" description=\"根據排序指標顯示前30名建案\">\n                    <RankingChart data={sortedData} sortKey={sortConfig.key} />\n                </ReportWrapper>\n            )}\n\n\n            {/* 3. Table */}\n            {visibleSections.includes('table') && (\n                <ReportWrapper title=\"區域建案排行列表\" description=\"點擊表頭可進行排序\">\n                    <div className=\"overflow-x-auto\">\n                        <table className=\"w-full text-sm text-left\">\n                            <thead className=\"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold\">\n                                <tr>\n                                    <th className=\"px-4 py-3 cursor-default\">排名</th>\n                                    <th className=\"px-4 py-3 cursor-default\">建案名稱</th>\n                                    {[\n                                        { key: 'saleAmountSum', label: <>交易<br />總價(萬)</> },\n                                        { key: 'houseAreaSum', label: <>房屋<br />面積(坪)</> },\n                                        { key: 'transactionCount', label: <>資料<br />筆數</> },\n                                        { key: 'marketShare', label: <>市場<br />佔比(%)</> },\n                                        { key: 'averagePrice', label: <>平均<br />單價</> },\n                                        { key: 'minPrice', label: <>最低<br />單價</> },\n                                        { key: 'maxPrice', label: <>最高<br />單價</> },\n                                        { key: 'medianPrice', label: <>中位數<br />單價</> },\n                                        { key: 'avgParkingPrice', label: <>車位<br />均價</> },\n                                    ].map(head => (\n                                        <th\n                                            key={head.key}\n                                            className=\"px-3 py-3 cursor-pointer hover:text-white transition-colors text-center whitespace-nowrap\"\n                                            onClick={() => handleSort(head.key)}\n                                        >\n                                            <div className=\"flex flex-col items-center gap-0.5\">\n                                                <span className=\"leading-tight\">{head.label}</span>\n                                                {sortConfig.key === head.key ? (\n                                                    sortConfig.order === 'desc' ? <ArrowDown size={12} className=\"text-violet-500\" /> : <ArrowUp size={12} className=\"text-violet-500\" />\n                                                ) : (\n                                                    <ArrowUpDown size={12} className=\"opacity-30\" />\n                                                )}\n                                            </div>\n                                        </th>\n                                    ))}\n                                </tr>\n                            </thead>\n                            <tbody className=\"divide-y divide-white/5\">\n                                {pagedData.map((proj, idx) => (\n                                    <tr key={idx} className=\"hover:bg-zinc-800/50 transition-colors\">\n                                        <td className=\"px-4 py-3 text-zinc-500 font-mono\">{(localPage - 1) * pageSize + idx + 1}</td>\n                                        <td className=\"px-4 py-3\">\n                                            <div className=\"flex flex-col\">\n                                                <span className=\"font-medium text-white\">{proj.projectName}</span>\n                                                <div className=\"flex gap-1 mt-1\">\n                                                    {proj.county && <span className=\"text-[10px] bg-zinc-800 text-zinc-400 px-1 py-0.5 rounded\">{proj.county}</span>}\n                                                    {proj.district && <span className=\"text-[10px] bg-zinc-800 text-zinc-400 px-1 py-0.5 rounded\">{proj.district}</span>}\n                                                </div>\n                                            </div>\n                                        </td>\n                                        <td className=\"px-4 py-3 font-mono text-zinc-300\">{proj.saleAmountSum.toLocaleString()}</td>\n                                        <td className=\"px-4 py-3 font-mono text-zinc-300\">{proj.houseAreaSum.toLocaleString()}</td>\n                                        <td className=\"px-4 py-3 font-mono text-zinc-300\">{proj.transactionCount.toLocaleString()}</td>\n                                        <td className=\"px-4 py-3 font-mono text-zinc-300\">{proj.marketShare.toFixed(2)}%</td>\n                                        <td className=\"px-4 py-3 font-mono text-cyan-400\">{proj.averagePrice.toFixed(1)}</td>\n                                        <td className=\"px-4 py-3 font-mono text-zinc-500\">{proj.minPrice.toFixed(1)}</td>\n                                        <td className=\"px-4 py-3 font-mono text-zinc-500\">{proj.maxPrice.toFixed(1)}</td>\n                                        <td className=\"px-4 py-3 font-mono text-zinc-400\">{proj.medianPrice.toFixed(1)}</td>\n                                        <td className=\"px-4 py-3 font-mono text-zinc-400\">{proj.avgParkingPrice > 0 ? proj.avgParkingPrice.toLocaleString() : '-'}</td>\n                                    </tr>\n                                ))}\n                            </tbody>\n                            <tfoot className=\"bg-zinc-900/80 font-bold border-t-2 border-zinc-700\">\n                                <tr>\n                                    <td colSpan={2} className=\"px-4 py-3 text-center text-zinc-300\">總計</td>\n                                    <td className=\"px-4 py-3 text-zinc-300\">{coreMetrics.totalSaleAmount.toLocaleString()}</td>\n                                    <td className=\"px-4 py-3 text-zinc-300\">{coreMetrics.totalHouseArea.toLocaleString()}</td>\n                                    <td className=\"px-4 py-3 text-zinc-300\">{coreMetrics.transactionCount.toLocaleString()}</td>\n                                    <td colSpan={6}></td>\n                                </tr>\n                            </tfoot>\n                        </table>\n                    </div>\n\n                    {/* Pagination */}\n                    <div className=\"flex items-center justify-between mt-4 border-t border-white/5 pt-4\">\n                        <div className=\"text-sm text-zinc-500\">\n                            顯示 {(localPage - 1) * pageSize + 1} 到 {Math.min(localPage * pageSize, sortedData.length)} 筆，共 {sortedData.length} 筆\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                            <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => setLocalPage(p => Math.max(1, p - 1))}\n                                disabled={localPage === 1}\n                            >\n                                <ChevronLeft size={16} />\n                            </Button>\n                            <span className=\"text-sm text-zinc-300\">Page {localPage} of {totalPages}</span>\n                            <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => setLocalPage(p => Math.min(totalPages, p + 1))}\n                                disabled={localPage === totalPages}\n                            >\n                                <ChevronRight size={16} />\n                            </Button>\n                        </div>\n                    </div>\n                </ReportWrapper>\n            )}\n\n\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3024, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/charts/PriceBandChart.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useMemo } from \"react\";\nimport ChartWrapper from \"./ChartWrapper\";\nimport { ApexOptions } from \"apexcharts\";\n\ninterface PriceBandItem {\n    roomType: string;\n    bathrooms: number | null;\n    minPrice: number;\n    q1Price: number;\n    medianPrice: number;\n    q3Price: number;\n    maxPrice: number;\n    count: number;\n}\n\ninterface PriceBandChartProps {\n    data: PriceBandItem[];\n}\n\nexport function PriceBandChart({ data }: PriceBandChartProps) {\n\n    const series = useMemo(() => {\n        if (!data || data.length === 0) return [];\n\n        const seriesData = data.map(item => {\n            const values = [item.minPrice, item.q1Price, item.medianPrice, item.q3Price, item.maxPrice];\n            // Ensure values are numbers\n            if (values.some(v => typeof v !== 'number' || isNaN(v))) return null;\n\n            return {\n                x: item.bathrooms !== null ? `${item.roomType}-${item.bathrooms}衛` : item.roomType,\n                y: values.map(v => Math.round(v))\n            };\n        }).filter(Boolean) as { x: string; y: number[] }[];\n\n        return [{\n            name: '總價分佈',\n            type: 'boxPlot',\n            data: seriesData\n        }];\n    }, [data]);\n\n    const options: ApexOptions = useMemo(() => {\n        if (series.length === 0 || series[0].data.length === 0) return {};\n\n        const allPrices = series[0].data.flatMap((d: any) => d.y);\n        const overallMin = Math.min(...allPrices);\n        const overallMax = Math.max(...allPrices);\n        const range = overallMax - overallMin;\n        const padding = range === 0 ? Math.max(overallMin * 0.1, 100) : range * 0.1;\n\n        return {\n            chart: {\n                type: 'boxPlot',\n                height: 450,\n                background: 'transparent',\n                toolbar: { show: true },\n                foreColor: '#e5e7eb'\n            },\n            title: {\n                text: '各房型總價帶分佈箱型圖',\n                align: 'center',\n                style: { fontSize: '16px', color: '#e5e7eb' }\n            },\n            plotOptions: {\n                boxPlot: {\n                    colors: {\n                        upper: '#06b6d4', // cyan-500\n                        lower: '#8b5cf6'  // violet-500\n                    },\n                    stroke: {\n                        colors: ['#e5e7eb'] // light gray for contrast\n                    }\n                }\n            },\n            xaxis: {\n                type: 'category',\n                labels: {\n                    style: { colors: '#9ca3af' },\n                    rotate: -45,\n                    offsetY: 5\n                }\n            },\n            yaxis: {\n                min: Math.max(0, overallMin - padding),\n                max: overallMax + padding,\n                title: { text: '房屋總價 (萬)', style: { color: '#9ca3af' } },\n                labels: {\n                    formatter: (val: number) => `${Math.round(val).toLocaleString()} 萬`,\n                    style: { colors: '#9ca3af' }\n                }\n            },\n            tooltip: {\n                custom: function ({ seriesIndex, dataPointIndex, w }) {\n                    const yData = w.globals.initialSeries[seriesIndex].data[dataPointIndex].y;\n                    if (Array.isArray(yData) && yData.length === 5) {\n                        const [min, q1, median, q3, max] = yData;\n                        return `\n                    <div class=\"apexcharts-tooltip-box\" style=\"background: #18181b; border: 1px solid #27272a; padding: 8px 12px; border-radius: 8px; color: #fff;\">\n                        <div><strong>最高總價:</strong> ${max.toLocaleString()} 萬</div>\n                        <div><strong>3/4位總價:</strong> ${q3.toLocaleString()} 萬</div>\n                        <div><strong>中位數總價:</strong> ${median.toLocaleString()} 萬</div>\n                        <div><strong>1/4位總價:</strong> ${q1.toLocaleString()} 萬</div>\n                        <div><strong>最低總價:</strong> ${min.toLocaleString()} 萬</div>\n                    </div>\n                `;\n                    }\n                    return '';\n                }\n            }\n        };\n    }, [series]);\n\n    if (!data || data.length === 0 || series.length === 0) {\n        return <div className=\"text-zinc-500 text-center p-8\">無總價帶資料可顯示</div>;\n    }\n\n    return (\n        <ChartWrapper\n            type=\"boxPlot\"\n            series={series}\n            options={options}\n            height={450}\n            className=\"w-full\"\n        />\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAqBO,SAAS,eAAe,EAAE,IAAI,EAAuB;IAExD,MAAM,SAAS,IAAA,oPAAO,EAAC;QACnB,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,GAAG,OAAO,EAAE;QAEzC,MAAM,aAAa,KAAK,GAAG,CAAC,CAAA;YACxB,MAAM,SAAS;gBAAC,KAAK,QAAQ;gBAAE,KAAK,OAAO;gBAAE,KAAK,WAAW;gBAAE,KAAK,OAAO;gBAAE,KAAK,QAAQ;aAAC;YAC3F,4BAA4B;YAC5B,IAAI,OAAO,IAAI,CAAC,CAAA,IAAK,OAAO,MAAM,YAAY,MAAM,KAAK,OAAO;YAEhE,OAAO;gBACH,GAAG,KAAK,SAAS,KAAK,OAAO,GAAG,KAAK,QAAQ,CAAC,CAAC,EAAE,KAAK,SAAS,CAAC,CAAC,CAAC,GAAG,KAAK,QAAQ;gBAClF,GAAG,OAAO,GAAG,CAAC,CAAA,IAAK,KAAK,KAAK,CAAC;YAClC;QACJ,GAAG,MAAM,CAAC;QAEV,OAAO;YAAC;gBACJ,MAAM;gBACN,MAAM;gBACN,MAAM;YACV;SAAE;IACN,GAAG;QAAC;KAAK;IAET,MAAM,UAAuB,IAAA,oPAAO,EAAC;QACjC,IAAI,OAAO,MAAM,KAAK,KAAK,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,KAAK,GAAG,OAAO,CAAC;QAEhE,MAAM,YAAY,MAAM,CAAC,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,IAAW,EAAE,CAAC;QACxD,MAAM,aAAa,KAAK,GAAG,IAAI;QAC/B,MAAM,aAAa,KAAK,GAAG,IAAI;QAC/B,MAAM,QAAQ,aAAa;QAC3B,MAAM,UAAU,UAAU,IAAI,KAAK,GAAG,CAAC,aAAa,KAAK,OAAO,QAAQ;QAExE,OAAO;YACH,OAAO;gBACH,MAAM;gBACN,QAAQ;gBACR,YAAY;gBACZ,SAAS;oBAAE,MAAM;gBAAK;gBACtB,WAAW;YACf;YACA,OAAO;gBACH,MAAM;gBACN,OAAO;gBACP,OAAO;oBAAE,UAAU;oBAAQ,OAAO;gBAAU;YAChD;YACA,aAAa;gBACT,SAAS;oBACL,QAAQ;wBACJ,OAAO;wBACP,OAAO,UAAW,aAAa;oBACnC;oBACA,QAAQ;wBACJ,QAAQ;4BAAC;yBAAU,CAAC,0BAA0B;oBAClD;gBACJ;YACJ;YACA,OAAO;gBACH,MAAM;gBACN,QAAQ;oBACJ,OAAO;wBAAE,QAAQ;oBAAU;oBAC3B,QAAQ,CAAC;oBACT,SAAS;gBACb;YACJ;YACA,OAAO;gBACH,KAAK,KAAK,GAAG,CAAC,GAAG,aAAa;gBAC9B,KAAK,aAAa;gBAClB,OAAO;oBAAE,MAAM;oBAAY,OAAO;wBAAE,OAAO;oBAAU;gBAAE;gBACvD,QAAQ;oBACJ,WAAW,CAAC,MAAgB,GAAG,KAAK,KAAK,CAAC,KAAK,cAAc,GAAG,EAAE,CAAC;oBACnE,OAAO;wBAAE,QAAQ;oBAAU;gBAC/B;YACJ;YACA,SAAS;gBACL,QAAQ,SAAU,EAAE,WAAW,EAAE,cAAc,EAAE,CAAC,EAAE;oBAChD,MAAM,QAAQ,EAAE,OAAO,CAAC,aAAa,CAAC,YAAY,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;oBACzE,IAAI,MAAM,OAAO,CAAC,UAAU,MAAM,MAAM,KAAK,GAAG;wBAC5C,MAAM,CAAC,KAAK,IAAI,QAAQ,IAAI,IAAI,GAAG;wBACnC,OAAO,CAAC;;oDAEoB,EAAE,IAAI,cAAc,GAAG;sDACrB,EAAE,GAAG,cAAc,GAAG;qDACvB,EAAE,OAAO,cAAc,GAAG;sDACzB,EAAE,GAAG,cAAc,GAAG;oDACxB,EAAE,IAAI,cAAc,GAAG;;gBAE3D,CAAC;oBACG;oBACA,OAAO;gBACX;YACJ;QACJ;IACJ,GAAG;QAAC;KAAO;IAEX,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,KAAK,OAAO,MAAM,KAAK,GAAG;QACnD,qBAAO,kRAAC;YAAI,WAAU;sBAAgC;;;;;;IAC1D;IAEA,qBACI,kRAAC,2LAAY;QACT,MAAK;QACL,QAAQ;QACR,SAAS;QACT,QAAQ;QACR,WAAU;;;;;;AAGtB"}},
    {"offset": {"line": 3175, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/charts/PriceBandLocationChart.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useMemo } from \"react\";\nimport ChartWrapper from \"./ChartWrapper\";\nimport { ApexOptions } from \"apexcharts\";\nimport { cn } from \"@/lib/utils\";\n\ninterface PriceBandLocationChartProps {\n    roomTypes: string[];\n    locations: string[];\n    crossTable: Record<string, Record<string, number>>;\n    dimension: 'district' | 'county';\n}\n\nexport function PriceBandLocationChart({ roomTypes, locations, crossTable, dimension }: PriceBandLocationChartProps) {\n\n    const series = useMemo(() => {\n        if (!roomTypes || !locations || !crossTable) return [];\n\n        return roomTypes.map(roomType => {\n            const data = locations.map(loc => (crossTable[roomType] && crossTable[roomType][loc]) || 0);\n            return {\n                name: roomType,\n                data: data\n            };\n        });\n    }, [roomTypes, locations, crossTable]);\n\n    const options: ApexOptions = useMemo(() => {\n        const dimensionLabel = dimension === 'county' ? '縣市' : '行政區';\n        const height = Math.max(350, locations.length * 35);\n\n        return {\n            chart: {\n                type: 'bar',\n                height: height,\n                stacked: true,\n                background: 'transparent',\n                toolbar: { show: true },\n                foreColor: '#e5e7eb',\n            },\n            plotOptions: {\n                bar: {\n                    horizontal: true,\n                    barHeight: '70%',\n                    borderRadius: 4,\n                    dataLabels: {\n                        total: {\n                            enabled: true,\n                            offsetX: 5,\n                            style: {\n                                fontSize: '11px',\n                                fontWeight: 600,\n                                color: '#e5e7eb'\n                            },\n                            formatter: function (val: any, opts: any) {\n                                // Calculate absolute total for this bar\n                                const seriesData = opts.w.config.series;\n                                const dataPointIndex = opts.dataPointIndex;\n                                let total = 0;\n                                seriesData.forEach((s: any) => {\n                                    total += s.data[dataPointIndex] || 0;\n                                });\n                                return total > 0 ? total.toString() : '';\n                            }\n                        }\n                    }\n                }\n            },\n            // Consistent colors with other charts\n            colors: ['#06b6d4', '#8b5cf6', '#10b981', '#f59e0b', '#ef4444', '#3b82f6', '#ec4899', '#84cc16', '#6366f1', '#14b8a6'],\n            dataLabels: {\n                enabled: false\n            },\n            xaxis: {\n                categories: locations,\n                title: {\n                    text: '成交筆數',\n                    style: { color: '#9ca3af' }\n                },\n                labels: {\n                    style: { colors: '#9ca3af' }\n                }\n            },\n            yaxis: {\n                title: {\n                    text: dimensionLabel,\n                    style: { color: '#9ca3af' }\n                },\n                labels: {\n                    style: { colors: '#e5e7eb' },\n                    maxWidth: 150\n                }\n            },\n            legend: {\n                position: 'top',\n                horizontalAlign: 'center',\n                labels: {\n                    colors: '#e5e7eb'\n                }\n            },\n            tooltip: {\n                theme: 'dark',\n                y: {\n                    formatter: function (val) {\n                        return val + ' 筆';\n                    }\n                }\n            },\n            grid: {\n                borderColor: '#374151'\n            },\n            title: {\n                text: `各${dimensionLabel}房型成交筆數分佈`,\n                align: 'center',\n                style: { fontSize: '16px', color: '#e5e7eb' }\n            }\n        };\n    }, [locations, dimension]);\n\n    if (!series || series.length === 0) {\n        return <div className=\"text-zinc-500 text-center p-8\">無區域分佈資料</div>;\n    }\n\n    return (\n        <ChartWrapper\n            type=\"bar\"\n            series={series}\n            options={options}\n            height={options.chart?.height || 350}\n            className=\"w-full\"\n        />\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAcO,SAAS,uBAAuB,EAAE,SAAS,EAAE,SAAS,EAAE,UAAU,EAAE,SAAS,EAA+B;IAE/G,MAAM,SAAS,IAAA,oPAAO,EAAC;QACnB,IAAI,CAAC,aAAa,CAAC,aAAa,CAAC,YAAY,OAAO,EAAE;QAEtD,OAAO,UAAU,GAAG,CAAC,CAAA;YACjB,MAAM,OAAO,UAAU,GAAG,CAAC,CAAA,MAAO,AAAC,UAAU,CAAC,SAAS,IAAI,UAAU,CAAC,SAAS,CAAC,IAAI,IAAK;YACzF,OAAO;gBACH,MAAM;gBACN,MAAM;YACV;QACJ;IACJ,GAAG;QAAC;QAAW;QAAW;KAAW;IAErC,MAAM,UAAuB,IAAA,oPAAO,EAAC;QACjC,MAAM,iBAAiB,cAAc,WAAW,OAAO;QACvD,MAAM,SAAS,KAAK,GAAG,CAAC,KAAK,UAAU,MAAM,GAAG;QAEhD,OAAO;YACH,OAAO;gBACH,MAAM;gBACN,QAAQ;gBACR,SAAS;gBACT,YAAY;gBACZ,SAAS;oBAAE,MAAM;gBAAK;gBACtB,WAAW;YACf;YACA,aAAa;gBACT,KAAK;oBACD,YAAY;oBACZ,WAAW;oBACX,cAAc;oBACd,YAAY;wBACR,OAAO;4BACH,SAAS;4BACT,SAAS;4BACT,OAAO;gCACH,UAAU;gCACV,YAAY;gCACZ,OAAO;4BACX;4BACA,WAAW,SAAU,GAAQ,EAAE,IAAS;gCACpC,wCAAwC;gCACxC,MAAM,aAAa,KAAK,CAAC,CAAC,MAAM,CAAC,MAAM;gCACvC,MAAM,iBAAiB,KAAK,cAAc;gCAC1C,IAAI,QAAQ;gCACZ,WAAW,OAAO,CAAC,CAAC;oCAChB,SAAS,EAAE,IAAI,CAAC,eAAe,IAAI;gCACvC;gCACA,OAAO,QAAQ,IAAI,MAAM,QAAQ,KAAK;4BAC1C;wBACJ;oBACJ;gBACJ;YACJ;YACA,sCAAsC;YACtC,QAAQ;gBAAC;gBAAW;gBAAW;gBAAW;gBAAW;gBAAW;gBAAW;gBAAW;gBAAW;gBAAW;aAAU;YACtH,YAAY;gBACR,SAAS;YACb;YACA,OAAO;gBACH,YAAY;gBACZ,OAAO;oBACH,MAAM;oBACN,OAAO;wBAAE,OAAO;oBAAU;gBAC9B;gBACA,QAAQ;oBACJ,OAAO;wBAAE,QAAQ;oBAAU;gBAC/B;YACJ;YACA,OAAO;gBACH,OAAO;oBACH,MAAM;oBACN,OAAO;wBAAE,OAAO;oBAAU;gBAC9B;gBACA,QAAQ;oBACJ,OAAO;wBAAE,QAAQ;oBAAU;oBAC3B,UAAU;gBACd;YACJ;YACA,QAAQ;gBACJ,UAAU;gBACV,iBAAiB;gBACjB,QAAQ;oBACJ,QAAQ;gBACZ;YACJ;YACA,SAAS;gBACL,OAAO;gBACP,GAAG;oBACC,WAAW,SAAU,GAAG;wBACpB,OAAO,MAAM;oBACjB;gBACJ;YACJ;YACA,MAAM;gBACF,aAAa;YACjB;YACA,OAAO;gBACH,MAAM,CAAC,CAAC,EAAE,eAAe,QAAQ,CAAC;gBAClC,OAAO;gBACP,OAAO;oBAAE,UAAU;oBAAQ,OAAO;gBAAU;YAChD;QACJ;IACJ,GAAG;QAAC;QAAW;KAAU;IAEzB,IAAI,CAAC,UAAU,OAAO,MAAM,KAAK,GAAG;QAChC,qBAAO,kRAAC;YAAI,WAAU;sBAAgC;;;;;;IAC1D;IAEA,qBACI,kRAAC,2LAAY;QACT,MAAK;QACL,QAAQ;QACR,SAAS;QACT,QAAQ,QAAQ,KAAK,EAAE,UAAU;QACjC,WAAU;;;;;;AAGtB"}},
    {"offset": {"line": 3344, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/ui/ProjectListModal.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useRef } from \"react\";\nimport { X } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface ProjectListModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    title: string;\n    projects: string[];\n}\n\nexport function ProjectListModal({ isOpen, onClose, title, projects }: ProjectListModalProps) {\n    const modalRef = useRef<HTMLDivElement>(null);\n\n    // Close modal on Escape key\n    useEffect(() => {\n        const handleKeyDown = (e: KeyboardEvent) => {\n            if (e.key === \"Escape\") onClose();\n        };\n        if (isOpen) {\n            document.addEventListener(\"keydown\", handleKeyDown);\n            document.body.style.overflow = \"hidden\";\n        }\n        return () => {\n            document.removeEventListener(\"keydown\", handleKeyDown);\n            document.body.style.overflow = \"\";\n        };\n    }, [isOpen, onClose]);\n\n    // Close modal on click outside\n    const handleBackdropClick = (e: React.MouseEvent) => {\n        if (modalRef.current && !modalRef.current.contains(e.target as Node)) {\n            onClose();\n        }\n    };\n\n    if (!isOpen) return null;\n\n    return (\n        <div\n            className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-200\"\n            onClick={handleBackdropClick}\n        >\n            <div\n                ref={modalRef}\n                className=\"bg-zinc-900 border border-white/10 rounded-xl shadow-2xl max-w-md w-full mx-4 animate-in zoom-in-95 duration-200\"\n            >\n                {/* Header */}\n                <div className=\"flex items-center justify-between px-5 py-4 border-b border-white/5\">\n                    <h3 className=\"text-lg font-semibold text-white\">{title}</h3>\n                    <button\n                        onClick={onClose}\n                        className=\"p-1 rounded hover:bg-white/10 text-zinc-400 hover:text-white transition-colors\"\n                    >\n                        <X size={20} />\n                    </button>\n                </div>\n\n                {/* Body */}\n                <div className=\"px-5 py-4 max-h-[50vh] overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-700\">\n                    {projects.length === 0 ? (\n                        <p className=\"text-zinc-500 text-center py-4\">無建案資料</p>\n                    ) : (\n                        <ul className=\"space-y-2\">\n                            {projects.map((project, idx) => (\n                                <li\n                                    key={idx}\n                                    className={cn(\n                                        \"px-3 py-2 rounded-lg text-zinc-200 text-sm\",\n                                        \"bg-zinc-800/50 hover:bg-zinc-800 transition-colors\",\n                                        \"border border-white/5\"\n                                    )}\n                                >\n                                    {project}\n                                </li>\n                            ))}\n                        </ul>\n                    )}\n                </div>\n\n                {/* Footer */}\n                <div className=\"px-5 py-3 border-t border-white/5 flex justify-between items-center\">\n                    <span className=\"text-xs text-zinc-500\">共 {projects.length} 個建案</span>\n                    <button\n                        onClick={onClose}\n                        className=\"px-4 py-1.5 text-sm rounded-lg bg-zinc-800 text-zinc-300 hover:bg-zinc-700 transition-colors\"\n                    >\n                        關閉\n                    </button>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAaO,SAAS,iBAAiB,EAAE,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,QAAQ,EAAyB;IACxF,MAAM,WAAW,IAAA,mPAAM,EAAiB;IAExC,4BAA4B;IAC5B,IAAA,sPAAS,EAAC;QACN,MAAM,gBAAgB,CAAC;YACnB,IAAI,EAAE,GAAG,KAAK,UAAU;QAC5B;QACA,IAAI,QAAQ;YACR,SAAS,gBAAgB,CAAC,WAAW;YACrC,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;QACnC;QACA,OAAO;YACH,SAAS,mBAAmB,CAAC,WAAW;YACxC,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;QACnC;IACJ,GAAG;QAAC;QAAQ;KAAQ;IAEpB,+BAA+B;IAC/B,MAAM,sBAAsB,CAAC;QACzB,IAAI,SAAS,OAAO,IAAI,CAAC,SAAS,OAAO,CAAC,QAAQ,CAAC,EAAE,MAAM,GAAW;YAClE;QACJ;IACJ;IAEA,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACI,kRAAC;QACG,WAAU;QACV,SAAS;kBAET,cAAA,kRAAC;YACG,KAAK;YACL,WAAU;;8BAGV,kRAAC;oBAAI,WAAU;;sCACX,kRAAC;4BAAG,WAAU;sCAAoC;;;;;;sCAClD,kRAAC;4BACG,SAAS;4BACT,WAAU;sCAEV,cAAA,kRAAC,qOAAC;gCAAC,MAAM;;;;;;;;;;;;;;;;;8BAKjB,kRAAC;oBAAI,WAAU;8BACV,SAAS,MAAM,KAAK,kBACjB,kRAAC;wBAAE,WAAU;kCAAiC;;;;;6CAE9C,kRAAC;wBAAG,WAAU;kCACT,SAAS,GAAG,CAAC,CAAC,SAAS,oBACpB,kRAAC;gCAEG,WAAW,IAAA,6JAAE,EACT,8CACA,sDACA;0CAGH;+BAPI;;;;;;;;;;;;;;;8BAezB,kRAAC;oBAAI,WAAU;;sCACX,kRAAC;4BAAK,WAAU;;gCAAwB;gCAAG,SAAS,MAAM;gCAAC;;;;;;;sCAC3D,kRAAC;4BACG,SAAS;4BACT,WAAU;sCACb;;;;;;;;;;;;;;;;;;;;;;;AAOrB"}},
    {"offset": {"line": 3497, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/reports/PriceBandReport.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useMemo } from \"react\";\nimport { ReportWrapper } from \"./ReportWrapper\";\nimport { PriceBandChart } from \"@/components/charts/PriceBandChart\";\nimport { PriceBandLocationChart } from \"@/components/charts/PriceBandLocationChart\";\nimport { ProjectListModal } from \"@/components/ui/ProjectListModal\";\nimport { cn } from \"@/lib/utils\";\nimport { Select } from \"@/components/ui/select\";\nimport { Tabs, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\n\ninterface PriceBandItem {\n    roomType: string;\n    bathrooms: number | null;\n    minPrice: number;\n    q1Price: number;\n    medianPrice: number;\n    q3Price: number;\n    maxPrice: number;\n    avgPrice: number;\n    count: number;\n    projectNames?: string[];\n    [key: string]: any;\n}\n\ninterface PriceBandReportProps {\n    data: {\n        details: PriceBandItem[];\n        locationCrossTable?: Record<string, Record<string, number>>;\n        allDistricts?: string[];\n        allRoomTypes?: string[];\n        transactionDetails?: any[];\n    } | null;\n    visibleSections?: string[];\n}\n\nexport function PriceBandReport({ data, visibleSections = ['chart', 'table', 'location-table', 'location-chart'] }: PriceBandReportProps) {\n    // Local filter for room types visibility in this report\n    const defaultTypes = ['套房', '1房', '2房', '3房', '4房', '毛胚'];\n    const [selectedRoomTypes, setSelectedRoomTypes] = useState<string[]>(defaultTypes);\n    const [locationDimension, setLocationDimension] = useState<'district' | 'county'>('district');\n    // Modal state for project list\n    const [modalOpen, setModalOpen] = useState(false);\n    const [modalTitle, setModalTitle] = useState('');\n    const [modalProjects, setModalProjects] = useState<string[]>([]);\n\n    // Multi-city handling\n    const [activeViewCounty, setActiveViewCounty] = useState<string | null>(null);\n\n    // Dervive distinct counties present in the data\n    const participatingCounties = useMemo(() => {\n        if (!data?.transactionDetails) return [];\n        const set = new Set<string>();\n        data.transactionDetails.forEach(tx => {\n            if (tx['縣市']) set.add(tx['縣市']);\n        });\n        return Array.from(set).sort();\n    }, [data?.transactionDetails]);\n\n    // Initialize active view county to the first one if not set\n    // Initialize active view county to the first one if not set\n    React.useEffect(() => {\n        if (!activeViewCounty && participatingCounties.length > 0) {\n            setActiveViewCounty(participatingCounties[0]);\n        }\n    }, [participatingCounties, activeViewCounty]);\n\n    const openProjectModal = (roomType: string, bathrooms: number | null, projects: string[]) => {\n        setModalTitle(`${roomType}${bathrooms !== null ? ` / ${bathrooms}衛` : ''} 建案組成`);\n        setModalProjects(projects);\n        setModalOpen(true);\n    };\n\n    if (!data || !data.details) return null;\n\n    const { details, locationCrossTable, allDistricts, transactionDetails } = data;\n\n    // All available room types in data (for filters)\n    const allAvailableTypes = useMemo(() => Array.from(new Set(details.map(d => d.roomType))), [details]);\n\n    // Filter main table data for Chart (keep independent or synced?)\n    // Chart usually renders what is visible. If we merge bathrooms, Chart might want merged data too?\n    // Let's keep filteredData as BASE for now, and tableData for Table.\n    const filteredData = useMemo(() => {\n        return details.filter(d => selectedRoomTypes.includes(d.roomType));\n    }, [details, selectedRoomTypes]);\n\n    const [mergeBathrooms, setMergeBathrooms] = useState(true);\n\n    const toggleRoomType = (type: string) => {\n        setSelectedRoomTypes(prev =>\n            prev.includes(type) ? prev.filter(t => t !== type) : [...prev, type]\n        );\n    };\n\n    // Calculate detailed table data, optionally merging bathrooms\n    const tableData = useMemo(() => {\n        const baseData = details.filter(d => selectedRoomTypes.includes(d.roomType));\n\n        if (!mergeBathrooms) {\n            return baseData;\n        }\n\n        // Group by roomType\n        const grouped = new Map<string, PriceBandItem>();\n\n        baseData.forEach(item => {\n            const key = item.roomType;\n            if (!grouped.has(key)) {\n                // Clone basic structure, but reset specific stats\n                grouped.set(key, {\n                    ...item,\n                    bathrooms: null, // Indicate merged\n                    projectNames: item.projectNames ? [...item.projectNames] : [],\n                    count: 0,\n                    avgPrice: 0 // Will recalculate\n                });\n            }\n\n            const group = grouped.get(key)!;\n            const currentTotalVal = group.avgPrice * group.count;\n            const itemTotalVal = item.avgPrice * item.count;\n\n            const newCount = group.count + item.count;\n            const newTotalVal = currentTotalVal + itemTotalVal;\n\n            group.count = newCount;\n            group.avgPrice = newCount > 0 ? newTotalVal / newCount : 0;\n            group.minPrice = Math.min(group.minPrice, item.minPrice);\n            group.maxPrice = Math.max(group.maxPrice, item.maxPrice);\n\n            // Weighted Average of Medians/Quartiles (Approximate)\n            // This is a trade-off for client-side aggregation without raw data\n            const weightA = group.count - item.count;\n            const weightB = item.count;\n            group.medianPrice = (group.medianPrice * weightA + item.medianPrice * weightB) / newCount;\n            group.q1Price = (group.q1Price * weightA + item.q1Price * weightB) / newCount;\n            group.q3Price = (group.q3Price * weightA + item.q3Price * weightB) / newCount;\n\n            if (item.projectNames) {\n                const newSet = new Set([...(group.projectNames || []), ...item.projectNames]);\n                group.projectNames = Array.from(newSet);\n            }\n        });\n\n        return Array.from(grouped.values()).sort((a, b) => {\n            return defaultTypes.indexOf(a.roomType) - defaultTypes.indexOf(b.roomType);\n        });\n\n    }, [details, selectedRoomTypes, mergeBathrooms, defaultTypes]);\n\n    // Prepare data for Location Cross Table & Chart\n    const crossTableData = useMemo(() => {\n        // If we switched to 'county' and have raw transaction details, we aggregate on the fly\n        if (locationDimension === 'county' && transactionDetails) {\n            const tempTable: Record<string, Record<string, number>> = {};\n            const counties = new Set<string>();\n\n            transactionDetails.forEach((tx) => {\n                let rawRoom = tx['房型'] || tx.roomType || tx['戶型'];\n\n                // If direct room type is missing, try to derive from '房數'\n                if (!rawRoom || rawRoom === '其他') {\n                    const roomCount = tx['房數'];\n                    const countVal = Number(roomCount);\n                    if (!isNaN(countVal) && countVal > 0) {\n                        rawRoom = `${countVal}房`;\n                    } else {\n                        rawRoom = '其他';\n                    }\n                }\n\n                let room = typeof rawRoom === 'string' ? rawRoom.replace(/\\s+/g, '') : rawRoom;\n                // Normalize number-only room types (e.g. \"3\" -> \"3房\")\n                if (typeof room === 'number' || (typeof room === 'string' && /^\\d+$/.test(room))) {\n                    room = `${room}房`;\n                }\n                const county = tx['縣市'] || '未知';\n\n                if (!tempTable[room]) tempTable[room] = {};\n                tempTable[room][county] = (tempTable[room][county] || 0) + 1;\n                counties.add(county);\n            });\n\n            const sortedCounties = Array.from(counties).sort();\n\n            // Calculate totals\n            const locationTotals: Record<string, number> = {};\n            let grandTotal = 0;\n            sortedCounties.forEach(c => locationTotals[c] = 0);\n\n            const rows = selectedRoomTypes.map(roomType => {\n                const locData = tempTable[roomType] || {};\n                let rowTotal = 0;\n                const cells = sortedCounties.map(c => {\n                    const val = locData[c] || 0;\n                    rowTotal += val;\n                    locationTotals[c] += val;\n                    return val;\n                });\n                grandTotal += rowTotal;\n                return { roomType, cells, rowTotal };\n            });\n\n            return { locations: sortedCounties, rows, locationTotals, grandTotal };\n        }\n\n        // Default or Fallback: District Mode\n        if (locationDimension === 'district') {\n            const tempTable: Record<string, Record<string, number>> = {};\n            const districts = new Set<string>();\n\n            // If we have raw transaction details, we can aggregate accurately\n            if (transactionDetails) {\n                transactionDetails.forEach((tx) => {\n                    let rawRoom = tx['房型'] || tx.roomType || tx['戶型'];\n\n                    // If direct room type is missing, try to derive from '房數'\n                    if (!rawRoom || rawRoom === '其他') {\n                        const roomCount = tx['房數'];\n                        const countVal = Number(roomCount);\n                        if (!isNaN(countVal) && countVal > 0) {\n                            rawRoom = `${countVal}房`;\n                        } else {\n                            rawRoom = '其他';\n                        }\n                    }\n\n                    let room = typeof rawRoom === 'string' ? rawRoom.replace(/\\s+/g, '') : rawRoom;\n                    if (typeof room === 'number' || (typeof room === 'string' && /^\\d+$/.test(room))) {\n                        room = `${room}房`;\n                    }\n                    const district = tx['行政區'] || '未知';\n                    const county = tx['縣市'] || '未知';\n\n                    // If a specific county is selected for viewing (in multi-county mode), filter others out\n                    if (activeViewCounty && county !== activeViewCounty) return;\n\n                    if (!tempTable[room]) tempTable[room] = {};\n                    tempTable[room][district] = (tempTable[room][district] || 0) + 1;\n                    districts.add(district);\n                });\n            } else if (locationCrossTable) {\n                // Legacy / fallback if no raw details\n                const relevantLocations = new Set<string>();\n                selectedRoomTypes.forEach(roomType => {\n                    const locs = locationCrossTable[roomType];\n                    if (locs) {\n                        Object.keys(locs).forEach(l => relevantLocations.add(l));\n                    }\n                });\n                relevantLocations.forEach(l => districts.add(l));\n\n                // Re-map to tempTable structure\n                selectedRoomTypes.forEach(roomType => {\n                    const locs = locationCrossTable[roomType];\n                    if (locs) {\n                        tempTable[roomType] = locs;\n                    }\n                });\n            }\n\n            const sortedDistricts = Array.from(districts).sort();\n\n            // Calculate totals\n            const locationTotals: Record<string, number> = {};\n            let grandTotal = 0;\n            sortedDistricts.forEach(d => locationTotals[d] = 0);\n\n            const rows = selectedRoomTypes.map(roomType => {\n                const locData = tempTable[roomType] || {};\n                let rowTotal = 0;\n                const cells = sortedDistricts.map(d => {\n                    const val = locData[d] || 0;\n                    rowTotal += val;\n                    locationTotals[d] += val;\n                    return val;\n                });\n                grandTotal += rowTotal;\n                return { roomType, cells, rowTotal };\n            });\n\n            return { locations: sortedDistricts, rows, locationTotals, grandTotal };\n        }\n\n        return null; // No data available\n    }, [locationCrossTable, transactionDetails, selectedRoomTypes, locationDimension, activeViewCounty]);\n\n    const [expandedRoomTypes, setExpandedRoomTypes] = useState<Set<string>>(new Set());\n\n    const toggleExpand = (roomType: string) => {\n        setExpandedRoomTypes(prev => {\n            const next = new Set(prev);\n            if (next.has(roomType)) {\n                next.delete(roomType);\n            } else {\n                next.add(roomType);\n            }\n            return next;\n        });\n    };\n\n    // Helper to get sub-items for a merged row\n    const getSubItems = (roomType: string) => {\n        return details.filter(d => d.roomType === roomType).sort((a, b) => {\n            // Sort by bathrooms amount?\n            const bathsA = Number(a.bathrooms) || 0;\n            const bathsB = Number(b.bathrooms) || 0;\n            return bathsA - bathsB;\n        });\n    };\n\n    return (\n        <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n\n            {/* 1. Filter Toggles */}\n            <div className=\"flex flex-wrap items-center justify-between gap-4\">\n                <div className=\"flex flex-wrap gap-2\">\n                    {allAvailableTypes.map(type => (\n                        <button\n                            key={type}\n                            onClick={() => toggleRoomType(type)}\n                            className={cn(\n                                \"px-3 py-1 rounded-full text-xs font-medium transition-colors border\",\n                                selectedRoomTypes.includes(type)\n                                    ? \"bg-violet-500/20 border-violet-500 text-violet-200\"\n                                    : \"bg-zinc-800/50 border-zinc-700 text-zinc-500 hover:bg-zinc-800\"\n                            )}\n                        >\n                            {type}\n                        </button>\n                    ))}\n                </div>\n\n                <div className=\"flex items-center gap-2 bg-zinc-800/50 p-1 rounded-lg border border-white/5\">\n                    <span className=\"text-xs text-zinc-400 pl-2\">表格顯示:</span>\n                    <button\n                        onClick={() => setMergeBathrooms(!mergeBathrooms)}\n                        className={cn(\n                            \"px-3 py-1 text-xs font-medium rounded-md transition-all\",\n                            mergeBathrooms\n                                ? \"bg-violet-500 text-white shadow-sm\"\n                                : \"text-zinc-400 hover:text-white hover:bg-zinc-700\"\n                        )}\n                    >\n                        {mergeBathrooms ? \"依房型合併\" : \"顯示衛浴細節\"}\n                    </button>\n                </div>\n            </div>\n\n            {/* 2. Chart */}\n            {visibleSections.includes('chart') && (\n                <ReportWrapper title=\"各房型總價帶分佈箱型圖\" description=\"顯示各房型總價的中位數與四分位距\">\n                    <PriceBandChart data={tableData} />\n                </ReportWrapper>\n            )}\n\n\n            {/* 3. Detailed Table */}\n            {visibleSections.includes('table') && (\n                <ReportWrapper title=\"總價帶詳細數據\" description={mergeBathrooms ? \"各房型合併統計 (點擊「全部」可展開細節)\" : \"各房型詳細價格統計\"}>\n                    <div className=\"overflow-x-auto\">\n                        <table className=\"w-full text-sm text-left\">\n                            <thead className=\"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold\">\n                                <tr>\n                                    <th className=\"px-4 py-3\">房型</th>\n                                    <th className=\"px-4 py-3\">衛浴</th>\n                                    <th className=\"px-4 py-3\">建案數</th>\n                                    <th className=\"px-4 py-3\">筆數</th>\n                                    <th className=\"px-4 py-3\">平均總價</th>\n                                    <th className=\"px-4 py-3\">最低總價</th>\n                                    <th className=\"px-4 py-3\">1/4位總價</th>\n                                    <th className=\"px-4 py-3 text-violet-400\">中位數總價</th>\n                                    <th className=\"px-4 py-3\">3/4位總價</th>\n                                    <th className=\"px-4 py-3\">最高總價</th>\n                                </tr>\n                            </thead>\n                            <tbody className=\"divide-y divide-white/5\">\n                                {tableData.map((item, idx) => {\n                                    const isMergedRow = mergeBathrooms && item.bathrooms === null;\n                                    const isExpanded = expandedRoomTypes.has(item.roomType);\n                                    const subItems = (isMergedRow && isExpanded) ? getSubItems(item.roomType) : [];\n\n                                    return (\n                                        <React.Fragment key={idx}>\n                                            <tr className={cn(\"hover:bg-zinc-800/50 transition-colors\", isExpanded && \"bg-zinc-800/30\")}>\n                                                <td className=\"px-4 py-3 font-medium text-white\">{item.roomType}</td>\n                                                <td className=\"px-4 py-3 text-zinc-400\">\n                                                    {isMergedRow ? (\n                                                        <button\n                                                            onClick={() => toggleExpand(item.roomType)}\n                                                            className=\"flex items-center gap-1 text-xs px-2 py-0.5 rounded bg-zinc-700/50 hover:bg-zinc-600 hover:text-white transition-colors cursor-pointer\"\n                                                        >\n                                                            <span>全部</span>\n                                                            <span className={cn(\"transform transition-transform text-[10px]\", isExpanded ? \"rotate-180\" : \"\")}>\n                                                                ▼\n                                                            </span>\n                                                        </button>\n                                                    ) : (\n                                                        item.bathrooms ?? '-'\n                                                    )}\n                                                </td>\n                                                <td className=\"px-4 py-3\">\n                                                    {item.projectNames && item.projectNames.length > 0 ? (\n                                                        <button\n                                                            onClick={() => openProjectModal(item.roomType, item.bathrooms, item.projectNames || [])}\n                                                            className=\"px-2 py-1 text-xs font-medium rounded-full bg-violet-500/20 border border-violet-500/50 text-violet-300 hover:bg-violet-500/30 transition-colors cursor-pointer\"\n                                                        >\n                                                            {item.projectNames.length} 個建案\n                                                        </button>\n                                                    ) : (\n                                                        <span className=\"text-zinc-500\">-</span>\n                                                    )}\n                                                </td>\n                                                <td className=\"px-4 py-3 text-zinc-300\">{item.count.toLocaleString()}</td>\n                                                <td className=\"px-4 py-3 font-mono text-zinc-300\">{item.avgPrice.toLocaleString(undefined, { maximumFractionDigits: 0 })}</td>\n                                                <td className=\"px-4 py-3 font-mono text-zinc-500\">{item.minPrice.toLocaleString()}</td>\n                                                <td className=\"px-4 py-3 font-mono text-zinc-500\">{item.q1Price.toLocaleString()}</td>\n                                                <td className=\"px-4 py-3 font-mono text-violet-400 font-bold\">{item.medianPrice.toLocaleString()}</td>\n                                                <td className=\"px-4 py-3 font-mono text-zinc-500\">{item.q3Price.toLocaleString()}</td>\n                                                <td className=\"px-4 py-3 font-mono text-zinc-500\">{item.maxPrice.toLocaleString()}</td>\n                                            </tr>\n                                            {/* Render Sub-rows if expanded */}\n                                            {subItems.map((sub, sIdx) => (\n                                                <tr key={`${idx}-sub-${sIdx}`} className=\"bg-zinc-900/50 hover:bg-zinc-900 border-l-2 border-l-violet-500/30\">\n                                                    <td className=\"px-4 py-2 font-medium text-zinc-500 text-xs pl-8\">↳ {sub.roomType}</td>\n                                                    <td className=\"px-4 py-2 text-zinc-400 text-xs\">{sub.bathrooms} 衛</td>\n                                                    <td className=\"px-4 py-2\">\n                                                        {sub.projectNames && sub.projectNames.length > 0 ? (\n                                                            <button\n                                                                onClick={() => openProjectModal(sub.roomType, sub.bathrooms, sub.projectNames || [])}\n                                                                className=\"text-xs text-zinc-500 hover:text-zinc-300 underline decoration-zinc-700\"\n                                                            >\n                                                                {sub.projectNames.length} 建案\n                                                            </button>\n                                                        ) : '-'}\n                                                    </td>\n                                                    <td className=\"px-4 py-2 text-zinc-500 text-xs\">{sub.count.toLocaleString()}</td>\n                                                    <td className=\"px-4 py-2 font-mono text-zinc-500 text-xs\">{sub.avgPrice.toLocaleString(undefined, { maximumFractionDigits: 0 })}</td>\n                                                    <td className=\"px-4 py-2 font-mono text-zinc-600 text-xs\">{sub.minPrice.toLocaleString()}</td>\n                                                    <td className=\"px-4 py-2 font-mono text-zinc-600 text-xs\">{sub.q1Price.toLocaleString()}</td>\n                                                    <td className=\"px-4 py-2 font-mono text-zinc-500 text-xs font-medium\">{sub.medianPrice.toLocaleString()}</td>\n                                                    <td className=\"px-4 py-2 font-mono text-zinc-600 text-xs\">{sub.q3Price.toLocaleString()}</td>\n                                                    <td className=\"px-4 py-2 font-mono text-zinc-600 text-xs\">{sub.maxPrice.toLocaleString()}</td>\n                                                </tr>\n                                            ))}\n                                        </React.Fragment>\n                                    );\n                                })}\n                                {filteredData.length === 0 && (\n                                    <tr><td colSpan={10} className=\"p-8 text-center text-zinc-500\">請選擇房型顯示數據</td></tr>\n                                )}\n                            </tbody>\n                        </table>\n                    </div>\n                </ReportWrapper>\n            )}\n\n\n            {/* 4. Location Analysis Section */}\n            {(crossTableData || transactionDetails) && (\n                <div className=\"space-y-6 pt-4 border-t border-white/5\">\n                    <div className=\"flex items-center justify-between\">\n                        <h3 className=\"text-lg font-semibold text-white\">區域分組交叉分析</h3>\n                        <div className=\"flex bg-zinc-800 rounded-md p-0.5\">\n                            <button\n                                onClick={() => setLocationDimension('district')}\n                                className={cn(\n                                    \"px-2 py-1 text-xs rounded transition-colors\",\n                                    locationDimension === 'district' ? \"bg-zinc-700 text-white\" : \"text-zinc-400 hover:text-white\"\n                                )}\n                            >\n                                行政區\n                            </button>\n                            <button\n                                onClick={() => setLocationDimension('county')}\n                                className={cn(\n                                    \"px-2 py-1 text-xs rounded transition-colors\",\n                                    locationDimension === 'county' ? \"bg-zinc-700 text-white\" : \"text-zinc-400 hover:text-white\"\n                                )}\n                            >\n                                縣市\n                            </button>\n                        </div>\n                    </div>\n\n                    {/* Multi-County Switcher (Only visible in District Mode with multiple counties) */}\n                    {locationDimension === 'district' && participatingCounties.length > 1 && (\n                        <div className=\"flex items-center gap-2 pb-2\">\n                            <span className=\"text-sm text-zinc-500\">顯示縣市:</span>\n                            <div className=\"flex gap-1 bg-zinc-900 p-1 rounded-lg\">\n                                {participatingCounties.map(c => (\n                                    <button\n                                        key={c}\n                                        onClick={() => setActiveViewCounty(c)}\n                                        className={cn(\n                                            \"px-3 py-1 text-xs font-medium rounded-md transition-all\",\n                                            activeViewCounty === c\n                                                ? \"bg-violet-500/20 text-violet-300 shadow-sm border border-violet-500/50\"\n                                                : \"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800\"\n                                        )}\n                                    >\n                                        {c}\n                                    </button>\n                                ))}\n                            </div>\n                        </div>\n                    )}\n\n                    {visibleSections.includes('location-table') && (\n                        <ReportWrapper title=\"區域房型成交分佈\" description=\"各區域不同房型的成交數量熱力分佈\">\n                            <div className=\"overflow-x-auto\">\n                                {crossTableData ? (\n                                    <table className=\"w-full text-sm text-left border-collapse\">\n                                        <thead className=\"bg-zinc-900/80 text-zinc-400 font-semibold\">\n                                            <tr>\n                                                <th className=\"px-3 py-2 sticky left-0 bg-zinc-900 z-10 border-r border-white/5\">房型</th>\n                                                {crossTableData.locations.map(loc => (\n                                                    <th key={loc} className=\"px-3 py-2 text-center min-w-[80px]\">{loc}</th>\n                                                ))}\n                                                <th className=\"px-3 py-2 text-center border-l border-white/5 bg-zinc-900 font-bold text-white\">總計</th>\n                                            </tr>\n                                        </thead>\n                                        <tbody className=\"divide-y divide-white/5\">\n                                            {crossTableData.rows.map((row, rIdx) => (\n                                                <tr key={rIdx} className=\"hover:bg-zinc-800/30\">\n                                                    <td className=\"px-3 py-2 font-medium text-zinc-300 sticky left-0 bg-zinc-950/90 border-r border-white/5\">{row.roomType}</td>\n                                                    {row.cells.map((cellVal, cIdx) => {\n                                                        // Heatmap coloring logic\n                                                        const intensity = cellVal > 0 ? Math.min(cellVal / 20, 1) : 0;\n                                                        const bgStyle = cellVal > 0 ? { backgroundColor: `rgba(6, 182, 212, ${intensity * 0.3})` } : {};\n                                                        return (\n                                                            <td key={cIdx} className=\"px-3 py-2 text-center text-zinc-400\" style={bgStyle}>\n                                                                {cellVal > 0 ? cellVal : '-'}\n                                                            </td>\n                                                        );\n                                                    })}\n                                                    <td className=\"px-3 py-2 text-center font-bold text-white border-l border-white/5 bg-zinc-900/50\">\n                                                        {row.rowTotal}\n                                                    </td>\n                                                </tr>\n                                            ))}\n                                        </tbody>\n                                        <tfoot className=\"bg-zinc-900 font-bold border-t-2 border-zinc-700\">\n                                            <tr>\n                                                <td className=\"px-3 py-2 sticky left-0 bg-zinc-900 border-r border-white/5 text-white\">總計</td>\n                                                {crossTableData.locations.map(loc => (\n                                                    <td key={loc} className=\"px-3 py-2 text-center text-white\">\n                                                        {crossTableData.locationTotals[loc]}\n                                                    </td>\n                                                ))}\n                                                <td className=\"px-3 py-2 text-center text-cyan-400 border-l border-white/5 bg-zinc-900\">\n                                                    {crossTableData.grandTotal}\n                                                </td>\n                                            </tr>\n                                        </tfoot>\n                                    </table>\n                                ) : (\n                                    <div className=\"p-8 text-center text-zinc-500\">無區域分佈數據</div>\n                                )}\n                            </div>\n                        </ReportWrapper>\n                    )}\n\n\n                    {visibleSections.includes('location-chart') && (\n                        <ReportWrapper\n                            title=\"區域成交佔比圖表\"\n                        >\n                            {crossTableData && (\n                                <PriceBandLocationChart\n                                    roomTypes={selectedRoomTypes}\n                                    locations={crossTableData.locations}\n                                    crossTable={crossTableData.rows.reduce((acc, row) => {\n                                        const roomMap: Record<string, number> = {};\n                                        crossTableData.locations.forEach((loc, idx) => {\n                                            roomMap[loc] = row.cells[idx];\n                                        });\n                                        acc[row.roomType] = roomMap;\n                                        return acc;\n                                    }, {} as Record<string, Record<string, number>>)}\n                                    dimension={locationDimension}\n                                />\n                            )}\n                        </ReportWrapper>\n                    )}\n\n                </div>\n            )}\n\n            {/* Project List Modal */}\n            <ProjectListModal\n                isOpen={modalOpen}\n                onClose={() => setModalOpen(false)}\n                title={modalTitle}\n                projects={modalProjects}\n            />\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4557, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/charts/SalesVelocityChart.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useMemo } from \"react\";\nimport ChartWrapper from \"./ChartWrapper\";\nimport { ApexOptions } from \"apexcharts\";\n\ninterface VelocityDataPoint {\n    [timeKey: string]: {\n        [roomType: string]: {\n            count: number;\n            priceSum: number;\n            areaSum: number;\n        }\n    }\n}\n\ninterface SalesVelocityChartProps {\n    data: VelocityDataPoint;\n    selectedRooms: string[];\n    metric: 'count' | 'priceSum' | 'areaSum';\n}\n\nexport function SalesVelocityChart({ data, selectedRooms, metric }: SalesVelocityChartProps) {\n\n    const metricDetails = useMemo(() => ({\n        count: { label: '交易筆數', unit: '筆', decimals: 0 },\n        priceSum: { label: '產權總價', unit: '萬', decimals: 0 },\n        areaSum: { label: '房屋坪數', unit: '坪', decimals: 2 }\n    })[metric], [metric]);\n\n    const series = useMemo(() => {\n        if (!data || selectedRooms.length === 0) return [];\n\n        // Sort time keys\n        const timeKeys = Object.keys(data).sort();\n        if (timeKeys.length === 0) return [];\n\n        return selectedRooms.map(roomType => ({\n            name: roomType,\n            data: timeKeys.map(timeKey => {\n                const val = data[timeKey]?.[roomType]?.[metric] || 0;\n                return val;\n            })\n        }));\n    }, [data, selectedRooms, metric]);\n\n    const options: ApexOptions = useMemo(() => {\n        const timeKeys = data ? Object.keys(data).sort() : [];\n\n        return {\n            chart: {\n                type: 'line',\n                height: 350,\n                background: 'transparent',\n                toolbar: { show: true },\n                zoom: { enabled: false },\n                foreColor: '#e5e7eb'\n            },\n            stroke: {\n                curve: 'smooth',\n                width: 2\n            },\n            dataLabels: { enabled: false },\n            xaxis: {\n                categories: timeKeys,\n                labels: { style: { colors: '#9ca3af' } }\n            },\n            yaxis: {\n                title: {\n                    text: metricDetails.label,\n                    style: { color: '#9ca3af' }\n                },\n                labels: {\n                    style: { colors: '#9ca3af' },\n                    formatter: (val: number) => val.toLocaleString('zh-TW', {\n                        minimumFractionDigits: 0,\n                        maximumFractionDigits: 0\n                    })\n                }\n            },\n            legend: {\n                position: 'top',\n                horizontalAlign: 'right'\n            },\n            tooltip: {\n                theme: 'dark',\n                y: {\n                    formatter: (val: number) => `${val.toLocaleString('zh-TW', {\n                        minimumFractionDigits: metricDetails.decimals,\n                        maximumFractionDigits: metricDetails.decimals\n                    })} ${metricDetails.unit}`\n                }\n            },\n            grid: { borderColor: '#374151' }\n        };\n    }, [data, metricDetails]);\n\n    if (!data || Object.keys(data).length === 0 || selectedRooms.length === 0) {\n        return <div className=\"text-zinc-500 text-center p-8\">請選擇房型以顯示銷售趨勢</div>;\n    }\n\n    return (\n        <ChartWrapper\n            type=\"line\"\n            series={series}\n            options={options}\n            height={350}\n            className=\"w-full\"\n        />\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAsBO,SAAS,mBAAmB,EAAE,IAAI,EAAE,aAAa,EAAE,MAAM,EAA2B;IAEvF,MAAM,gBAAgB,IAAA,oPAAO,EAAC,IAAM,CAAC;YACjC,OAAO;gBAAE,OAAO;gBAAQ,MAAM;gBAAK,UAAU;YAAE;YAC/C,UAAU;gBAAE,OAAO;gBAAQ,MAAM;gBAAK,UAAU;YAAE;YAClD,SAAS;gBAAE,OAAO;gBAAQ,MAAM;gBAAK,UAAU;YAAE;QACrD,CAAC,CAAC,CAAC,OAAO,EAAE;QAAC;KAAO;IAEpB,MAAM,SAAS,IAAA,oPAAO,EAAC;QACnB,IAAI,CAAC,QAAQ,cAAc,MAAM,KAAK,GAAG,OAAO,EAAE;QAElD,iBAAiB;QACjB,MAAM,WAAW,OAAO,IAAI,CAAC,MAAM,IAAI;QACvC,IAAI,SAAS,MAAM,KAAK,GAAG,OAAO,EAAE;QAEpC,OAAO,cAAc,GAAG,CAAC,CAAA,WAAY,CAAC;gBAClC,MAAM;gBACN,MAAM,SAAS,GAAG,CAAC,CAAA;oBACf,MAAM,MAAM,IAAI,CAAC,QAAQ,EAAE,CAAC,SAAS,EAAE,CAAC,OAAO,IAAI;oBACnD,OAAO;gBACX;YACJ,CAAC;IACL,GAAG;QAAC;QAAM;QAAe;KAAO;IAEhC,MAAM,UAAuB,IAAA,oPAAO,EAAC;QACjC,MAAM,WAAW,OAAO,OAAO,IAAI,CAAC,MAAM,IAAI,KAAK,EAAE;QAErD,OAAO;YACH,OAAO;gBACH,MAAM;gBACN,QAAQ;gBACR,YAAY;gBACZ,SAAS;oBAAE,MAAM;gBAAK;gBACtB,MAAM;oBAAE,SAAS;gBAAM;gBACvB,WAAW;YACf;YACA,QAAQ;gBACJ,OAAO;gBACP,OAAO;YACX;YACA,YAAY;gBAAE,SAAS;YAAM;YAC7B,OAAO;gBACH,YAAY;gBACZ,QAAQ;oBAAE,OAAO;wBAAE,QAAQ;oBAAU;gBAAE;YAC3C;YACA,OAAO;gBACH,OAAO;oBACH,MAAM,cAAc,KAAK;oBACzB,OAAO;wBAAE,OAAO;oBAAU;gBAC9B;gBACA,QAAQ;oBACJ,OAAO;wBAAE,QAAQ;oBAAU;oBAC3B,WAAW,CAAC,MAAgB,IAAI,cAAc,CAAC,SAAS;4BACpD,uBAAuB;4BACvB,uBAAuB;wBAC3B;gBACJ;YACJ;YACA,QAAQ;gBACJ,UAAU;gBACV,iBAAiB;YACrB;YACA,SAAS;gBACL,OAAO;gBACP,GAAG;oBACC,WAAW,CAAC,MAAgB,GAAG,IAAI,cAAc,CAAC,SAAS;4BACvD,uBAAuB,cAAc,QAAQ;4BAC7C,uBAAuB,cAAc,QAAQ;wBACjD,GAAG,CAAC,EAAE,cAAc,IAAI,EAAE;gBAC9B;YACJ;YACA,MAAM;gBAAE,aAAa;YAAU;QACnC;IACJ,GAAG;QAAC;QAAM;KAAc;IAExB,IAAI,CAAC,QAAQ,OAAO,IAAI,CAAC,MAAM,MAAM,KAAK,KAAK,cAAc,MAAM,KAAK,GAAG;QACvE,qBAAO,kRAAC;YAAI,WAAU;sBAAgC;;;;;;IAC1D;IAEA,qBACI,kRAAC,2LAAY;QACT,MAAK;QACL,QAAQ;QACR,SAAS;QACT,QAAQ;QACR,WAAU;;;;;;AAGtB"}},
    {"offset": {"line": 4699, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/charts/AreaHeatmapChart.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useMemo } from \"react\";\nimport ChartWrapper from \"./ChartWrapper\";\nimport { ApexOptions } from \"apexcharts\";\n\ninterface AreaHeatmapChartProps {\n    data: Record<string, number[]>; // roomType -> array of areas\n    selectedRooms: string[];\n    minArea: number;\n    maxArea: number;\n    interval: number;\n    onDataPointClick?: (roomType: string, areaRange: string) => void;\n}\n\nexport function AreaHeatmapChart({ data, selectedRooms, minArea, maxArea, interval, onDataPointClick }: AreaHeatmapChartProps) {\n\n    // Helper to generate color ranges\n    const colorRanges = useMemo(() => {\n        // Calculate max value first (need series to know counts) but for color scale we can approximate or do 2-pass\n        // Logic from legacy chart.js\n        const palette = ['#fef9c3', '#fef08a', '#fde047', '#facc15', '#fbbf24', '#f97316', '#ea580c', '#dc2626', '#b91c1c'];\n        // Hardcoded ranges or dynamic? Legacy was dynamic based on maxValue.\n        // For simplicity allow ApexCharts handle heatmap colors natively? \n        // Or re-implement dynamic logic. Let's use simpler ranges for now or copy logic.\n        return [\n            { from: 0, to: 0, color: '#27272a', name: '0 戶' }, // zinc-800 for 0\n            { from: 1, to: 5, color: '#facc15', name: '1-5 戶' },\n            { from: 6, to: 20, color: '#fbbf24', name: '6-20 戶' },\n            { from: 21, to: 50, color: '#f97316', name: '21-50 戶' },\n            { from: 51, to: 10000, color: '#dc2626', name: '> 50 戶' }\n        ];\n    }, []);\n\n    const { series, maxValue } = useMemo(() => {\n        if (!data || selectedRooms.length === 0) return { series: [], maxValue: 0 };\n\n        const yCategories: string[] = [];\n        for (let i = minArea; i < maxArea; i += interval) {\n            yCategories.push(`${i.toFixed(1)}-${(i + interval).toFixed(1)}`);\n        }\n\n        let max = 0;\n        const seriesData = yCategories.map(category => {\n            const [lower, upper] = category.split('-').map(parseFloat);\n            const dataPoints = selectedRooms.map(roomType => {\n                const areas = data[roomType] || [];\n                const count = areas.filter(a => a >= lower && a < upper && a >= minArea && a <= maxArea).length;\n                if (count > max) max = count;\n                return count;\n            });\n            return {\n                name: category,\n                data: dataPoints\n            };\n        });\n\n        return { series: seriesData, maxValue: max };\n    }, [data, selectedRooms, minArea, maxArea, interval]);\n\n    const options: ApexOptions = useMemo(() => {\n        // Dynamic height\n        const height = Math.max(400, series.length * 22);\n\n        return {\n            chart: {\n                type: 'heatmap',\n                height: height,\n                background: 'transparent',\n                toolbar: { show: true },\n                foreColor: '#e5e7eb',\n                events: {\n                    dataPointSelection: (event, chartContext, config) => {\n                        if (onDataPointClick) {\n                            const { seriesIndex, dataPointIndex } = config;\n                            const areaRange = config.w.globals.seriesNames[seriesIndex];\n                            const roomType = selectedRooms[dataPointIndex];\n                            onDataPointClick(roomType, areaRange);\n                        }\n                    }\n                }\n            },\n            plotOptions: {\n                heatmap: {\n                    radius: 0,\n                    useFillColorAsStroke: true,\n                    enableShades: false,\n                    colorScale: {\n                        ranges: colorRanges\n                    }\n                }\n            },\n            dataLabels: {\n                enabled: true,\n                style: {\n                    colors: [({ value }: any) => value === 0 ? 'transparent' : '#e5e7eb']\n                }\n            },\n            xaxis: {\n                type: 'category',\n                categories: selectedRooms,\n            },\n            title: {\n                text: '房型面積分佈熱力圖',\n                align: 'center',\n                style: { color: '#e5e7eb', fontSize: '16px' }\n            },\n            grid: { borderColor: '#374151' },\n            tooltip: {\n                theme: 'dark',\n                y: {\n                    formatter: (val: number) => val === 0 ? '無成交紀錄' : `${val} 戶`\n                }\n            }\n        };\n    }, [series, selectedRooms, colorRanges, onDataPointClick]);\n\n    if (!data || series.length === 0) {\n        return <div className=\"text-zinc-500 text-center p-8\">無面積分佈資料</div>;\n    }\n\n    return (\n        <ChartWrapper\n            type=\"heatmap\"\n            series={series}\n            options={options}\n            height={options.chart?.height || 400}\n            className=\"w-full\"\n        />\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4891, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/tables/VelocityTable.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport { formatNumber } from \"@/lib/utils\";\nimport { cn } from \"@/lib/utils\";\n\ninterface VelocityTableProps {\n    data: any; // Using any for flexibility with complex nested object structure { [time]: { [room]: { count, priceSum, areaSum } } }\n    viewType: 'monthly' | 'quarterly' | 'weekly' | 'yearly';\n    selectedRooms: string[];\n}\n\nexport function VelocityTable({ data, viewType, selectedRooms }: VelocityTableProps) {\n    if (!data || Object.keys(data).length === 0) {\n        return <div className=\"text-zinc-500 text-center p-8\">無銷售速度資料</div>;\n    }\n\n    const timeKeys = Object.keys(data).sort().reverse();\n\n    // Helper to format week dates if needed ( simplified version)\n    const getWeekLabel = (label: string) => {\n        if (viewType === 'weekly' && label.includes('-W')) {\n            return label; // Keep simple for now, can implement date range logic if critical\n        }\n        return label;\n    }\n\n    const subHeaders = ['資料筆數', '產權總價', '房屋坪數'];\n\n    return (\n        <div className=\"overflow-x-auto max-h-[600px] border border-white/5 rounded-lg\">\n            <table className=\"w-full text-sm text-left border-collapse\">\n                <thead className=\"bg-zinc-900 sticky top-0 z-20 shadow-md\">\n                    <tr>\n                        <th rowSpan={2} className=\"px-4 py-3 sticky left-0 z-30 bg-zinc-900 border-r border-white/10 font-medium text-white min-w-[120px]\">\n                            時間\n                        </th>\n                        {selectedRooms.map(room => (\n                            <th key={room} colSpan={3} className=\"px-2 py-2 text-center border-l border-white/5 text-zinc-300 font-medium bg-zinc-900/90\">\n                                {room}\n                            </th>\n                        ))}\n                        <th colSpan={3} className=\"px-2 py-2 text-center border-l-2 border-white/10 text-cyan-400 font-bold bg-zinc-900/90\">\n                            總計\n                        </th>\n                    </tr>\n                    <tr>\n                        {selectedRooms.map((room, i) => (\n                            <React.Fragment key={room}>\n                                <th className={cn(\"px-2 py-2 text-center text-xs text-zinc-500 font-normal bg-zinc-900/90 border-b border-white/10\", i === 0 && \"border-l border-white/5\")}>筆數</th>\n                                <th className=\"px-2 py-2 text-center text-xs text-zinc-500 font-normal bg-zinc-900/90 border-b border-white/10\">總價(萬)</th>\n                                <th className=\"px-2 py-2 text-center text-xs text-zinc-500 font-normal bg-zinc-900/90 border-b border-white/10\">坪數</th>\n                            </React.Fragment>\n                        ))}\n                        <th className=\"px-2 py-2 text-center text-xs text-zinc-400 font-medium bg-zinc-900/90 border-b border-white/10 border-l-2 border-white/10\">筆數</th>\n                        <th className=\"px-2 py-2 text-center text-xs text-zinc-400 font-medium bg-zinc-900/90 border-b border-white/10\">總價(萬)</th>\n                        <th className=\"px-2 py-2 text-center text-xs text-zinc-400 font-medium bg-zinc-900/90 border-b border-white/10\">坪數</th>\n                    </tr>\n                </thead>\n                <tbody className=\"divide-y divide-white/5\">\n                    {timeKeys.map((timeKey) => {\n                        const periodData = data[timeKey] || {};\n                        const rowTotal = { count: 0, priceSum: 0, areaSum: 0 };\n\n                        return (\n                            <tr key={timeKey} className=\"hover:bg-zinc-800/30 transition-colors\">\n                                <td className=\"px-4 py-2 sticky left-0 z-10 bg-zinc-950/90 border-r border-white/10 font-mono text-zinc-400\">\n                                    {getWeekLabel(timeKey)}\n                                </td>\n                                {selectedRooms.map((room, i) => {\n                                    const stats = periodData[room];\n                                    if (stats) {\n                                        rowTotal.count += stats.count;\n                                        rowTotal.priceSum += stats.priceSum;\n                                        rowTotal.areaSum += stats.areaSum;\n                                        return (\n                                            <React.Fragment key={room}>\n                                                <td className={cn(\"px-2 py-2 text-center text-zinc-300\", i === 0 && \"border-l border-white/5\")}>\n                                                    {stats.count > 0 ? stats.count.toLocaleString() : '-'}\n                                                </td>\n                                                <td className=\"px-2 py-2 text-center text-zinc-500 font-mono text-xs\">\n                                                    {stats.count > 0 ? formatNumber(stats.priceSum, 0) : '-'}\n                                                </td>\n                                                <td className=\"px-2 py-2 text-center text-zinc-500 font-mono text-xs\">\n                                                    {stats.count > 0 ? formatNumber(stats.areaSum, 1) : '-'}\n                                                </td>\n                                            </React.Fragment>\n                                        );\n                                    } else {\n                                        return (\n                                            <React.Fragment key={room}>\n                                                <td className={cn(\"px-2 py-2 text-center text-zinc-700\", i === 0 && \"border-l border-white/5\")}>-</td>\n                                                <td className=\"px-2 py-2 text-center text-zinc-700\">-</td>\n                                                <td className=\"px-2 py-2 text-center text-zinc-700\">-</td>\n                                            </React.Fragment>\n                                        );\n                                    }\n                                })}\n                                <td className=\"px-2 py-2 text-center font-bold text-cyan-400 border-l-2 border-white/10\">\n                                    {rowTotal.count.toLocaleString()}\n                                </td>\n                                <td className=\"px-2 py-2 text-center font-bold text-zinc-300 font-mono text-xs\">\n                                    {formatNumber(rowTotal.priceSum, 0)}\n                                </td>\n                                <td className=\"px-2 py-2 text-center font-bold text-zinc-300 font-mono text-xs\">\n                                    {formatNumber(rowTotal.areaSum, 1)}\n                                </td>\n                            </tr>\n                        );\n                    })}\n                </tbody>\n            </table>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5185, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/reports/SalesVelocityReport.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\nimport { ReportWrapper } from \"./ReportWrapper\";\nimport { SalesVelocityChart } from \"@/components/charts/SalesVelocityChart\";\nimport { AreaHeatmapChart } from \"@/components/charts/AreaHeatmapChart\";\nimport { VelocityTable } from \"@/components/tables/VelocityTable\"; // Import the new table component\nimport { Select } from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { cn } from \"@/lib/utils\";\nimport { getRoomType } from \"@/lib/room-utils\";\n\ninterface SalesVelocityReportProps {\n    data: {\n        salesVelocityAnalysis: any;\n        areaDistributionAnalysis: any;\n        transactionDetails?: any[];\n    } | null;\n}\n\nexport function SalesVelocityReport({ data }: SalesVelocityReportProps) {\n    // Local State\n    const [velocityView, setVelocityView] = useState<'monthly' | 'quarterly' | 'weekly' | 'yearly'>('monthly');\n    const [velocityMetric, setVelocityMetric] = useState<'count' | 'priceSum' | 'areaSum'>('count');\n\n    // Heatmap State\n    const [minArea, setMinArea] = useState(15);\n    const [maxArea, setMaxArea] = useState(65);\n    const [interval, setInterval] = useState(5);\n\n    // Aggregated Detail State\n    const [aggregatedDetails, setAggregatedDetails] = useState<{\n        projectName: string;\n        count: number;\n        priceRange: { min: number; max: number }; // Total Price\n        unitPriceRange: { min: number; max: number }; // Unit Price\n        transactions: any[];\n        isExpanded: boolean;\n    }[]>([]);\n\n    const [heatmapModalMeta, setHeatmapModalMeta] = useState<{\n        roomType: string;\n        areaRange: string;\n        totalCount: number;\n    } | null>(null);\n\n    // Common Room Selection\n    const defaultRooms = ['2房', '3房'];\n    const [selectedRooms, setSelectedRooms] = useState<string[]>(defaultRooms);\n\n    if (!data) return null;\n    const { salesVelocityAnalysis, areaDistributionAnalysis } = data;\n\n    const toggleRoom = (r: string) => {\n        setSelectedRooms(prev => prev.includes(r) ? prev.filter(x => x !== r) : [...prev, r]);\n    };\n\n    // Helper for formatting\n    const formatPrice = (val: number) => {\n        return Math.round(val) + \"萬\";\n    };\n\n    // Toggle expand/collapse for a project group\n    const toggleProjectExpand = (index: number) => {\n        setAggregatedDetails(prev => prev.map((item, i) =>\n            i === index ? { ...item, isExpanded: !item.isExpanded } : item\n        ));\n    };\n\n    // Handle heatmap cell click\n    const handleHeatmapClick = (roomType: string, areaRange: string) => {\n        // Parse range using regex to handle \"< 15\", \"> 65\", \"15-20\"\n        let minA = 0;\n        let maxA = Infinity;\n\n        if (areaRange.includes('<')) {\n            maxA = parseFloat(areaRange.replace('<', '').trim());\n        } else if (areaRange.includes('>')) {\n            minA = parseFloat(areaRange.replace('>', '').trim());\n        } else if (areaRange.includes('-')) {\n            const parts = areaRange.split('-');\n            minA = parseFloat(parts[0].trim());\n            maxA = parseFloat(parts[1].trim());\n        }\n\n        const transactionDetails = data.transactionDetails || [];\n\n        // Import the utility function (we need to import it at file level usually, but for this edit we assume it's imported)\n        // Note: I will add the import statement in a separate edit or ensure it's here.\n        // Actually, let's use the helper logic here directly or if I can't add import easily.\n        // Best practice: Use the imported function.\n\n        const filtered = transactionDetails.filter((tx: any) => {\n            // Use our robust room classification logic\n            const txRoom = getRoomType(tx);\n\n            // Ensure we use '房屋面積(坪)' for area, handling multiple possible keys\n            const txArea = parseFloat(\n                tx['房屋面積(坪)'] ||\n                tx.houseArea ||\n                (tx['建物移轉平方公尺'] ? tx['建物移移轉平方公尺'] * 0.3025 : 0)\n            );\n\n            if (!txRoom) return false;\n\n            // Room type match\n            const roomMatch = txRoom === roomType;\n\n            // Area match\n            const areaMatch = txArea >= minA && txArea < maxA;\n\n            return roomMatch && areaMatch;\n        });\n\n        console.log(`[Heatmap Click] Room: ${roomType}, Range: ${minA}-${maxA}, Found: ${filtered.length}`);\n\n        // Aggregate by Project Name\n        const groupedByProject: Record<string, any[]> = {};\n\n        filtered.forEach((tx: any) => {\n            const projectName = tx['建案名稱'] || tx.projectName || '未知建案';\n            if (!groupedByProject[projectName]) {\n                groupedByProject[projectName] = [];\n            }\n            groupedByProject[projectName].push(tx);\n        });\n\n        // Calculate Stats for each project\n        const aggregated = Object.entries(groupedByProject).map(([projectName, txs]) => {\n            const totalPrices = txs.map((t: any) => t['產權總價'] || t['交易總價(萬)'] || t.totalPrice || 0).filter((p: number) => p > 0).sort((a: number, b: number) => a - b);\n            const unitPrices = txs.map((t: any) => t['房屋單價'] || t['房屋單價(萬)'] || t.unitPrice || 0).filter((p: number) => p > 0);\n\n            // Calculate Median Total Price\n            let medianTotalPrice = 0;\n            if (totalPrices.length > 0) {\n                const mid = Math.floor(totalPrices.length / 2);\n                medianTotalPrice = totalPrices.length % 2 !== 0\n                    ? totalPrices[mid]\n                    : (totalPrices[mid - 1] + totalPrices[mid]) / 2;\n            }\n\n            return {\n                projectName,\n                count: txs.length,\n                priceRange: {\n                    min: totalPrices.length > 0 ? totalPrices[0] : 0,\n                    max: totalPrices.length > 0 ? totalPrices[totalPrices.length - 1] : 0,\n                    median: medianTotalPrice\n                },\n                unitPriceRange: {\n                    min: unitPrices.length > 0 ? Math.min(...unitPrices) : 0,\n                    max: unitPrices.length > 0 ? Math.max(...unitPrices) : 0\n                },\n                transactions: txs.sort((a: any, b: any) => {\n                    // Sort by unit price desc by default\n                    const pA = a['房屋單價'] || a['房屋單價(萬)'] || a.unitPrice || 0;\n                    const pB = b['房屋單價'] || b['房屋單價(萬)'] || b.unitPrice || 0;\n                    return pB - pA;\n                }),\n                isExpanded: false\n            };\n        });\n\n        // Sort projects by Unit Price High to Low (using max unit price)\n        aggregated.sort((a, b) => b.unitPriceRange.max - a.unitPriceRange.max);\n\n        setAggregatedDetails(aggregated);\n        setHeatmapModalMeta({\n            roomType,\n            areaRange,\n            totalCount: filtered.length\n        });\n    };\n\n    const availableRooms = ['套房', '1房', '2房', '3房', '4房', '毛胚', '店舖', '辦公/事務所'];\n\n    return (\n        <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n\n            {/* Room Filter Toolbar */}\n            <div className=\"p-4 bg-zinc-900/30 border border-white/5 rounded-lg flex flex-wrap gap-2 items-center sticky top-0 z-40 backdrop-blur-md\">\n                <span className=\"text-zinc-400 text-sm mr-2\">分析房型:</span>\n                {availableRooms.map(r => (\n                    <button\n                        key={r}\n                        onClick={() => toggleRoom(r)}\n                        className={cn(\n                            \"px-3 py-1 text-xs rounded-full border transition-colors\",\n                            selectedRooms.includes(r)\n                                ? \"bg-violet-500/20 border-violet-500 text-violet-200\"\n                                : \"bg-zinc-800 border-zinc-700 text-zinc-500 hover:bg-zinc-700\"\n                        )}\n                    >\n                        {r}\n                    </button>\n                ))}\n            </div>\n\n            {/* 1. Sales Velocity Chart */}\n            <ReportWrapper\n                title=\"房型銷售速度與趨勢分析\"\n                action={\n                    <div className=\"flex gap-2\">\n                        <Select value={velocityView} onChange={(e) => setVelocityView(e.target.value as any)} className=\"w-[100px] h-8 text-xs bg-zinc-950/50\">\n                            <option value=\"weekly\">每週</option>\n                            <option value=\"monthly\">每月</option>\n                            <option value=\"quarterly\">每季</option>\n                            <option value=\"yearly\">每年</option>\n                        </Select>\n                        <Select value={velocityMetric} onChange={(e) => setVelocityMetric(e.target.value as any)} className=\"w-[100px] h-8 text-xs bg-zinc-950/50\">\n                            <option value=\"count\">交易筆數</option>\n                            <option value=\"priceSum\">總銷金額</option>\n                            <option value=\"areaSum\">總銷坪數</option>\n                        </Select>\n                    </div>\n                }\n            >\n                <SalesVelocityChart\n                    data={salesVelocityAnalysis?.[velocityView]}\n                    selectedRooms={selectedRooms}\n                    metric={velocityMetric}\n                />\n            </ReportWrapper>\n\n            {/* 2. Detailed Data Table (Velocity Table) */}\n            <ReportWrapper\n                title=\"銷售速度明細表\"\n                description=\"各時間段詳細銷售數據統計\"\n            >\n                <VelocityTable\n                    data={salesVelocityAnalysis?.[velocityView]}\n                    viewType={velocityView}\n                    selectedRooms={selectedRooms}\n                />\n            </ReportWrapper>\n\n\n            {/* 3. Area Heatmap */}\n            <ReportWrapper\n                title=\"房型面積分佈熱力圖\"\n                description=\"分析不同坪數區間的產品供給與去化分佈\"\n                action={\n                    <div className=\"flex gap-2 items-center text-zinc-400 text-xs\">\n                        <span>範圍:</span>\n                        <Input\n                            type=\"number\"\n                            value={minArea}\n                            onChange={e => setMinArea(Number(e.target.value))}\n                            className=\"w-16 h-8 text-xs bg-zinc-950/50\"\n                        />\n                        <span>-</span>\n                        <Input\n                            type=\"number\"\n                            value={maxArea}\n                            onChange={e => setMaxArea(Number(e.target.value))}\n                            className=\"w-16 h-8 text-xs bg-zinc-950/50\"\n                        />\n                        <span className=\"ml-2\">級距:</span>\n                        <Input\n                            type=\"number\"\n                            value={interval}\n                            onChange={e => setInterval(Number(e.target.value))}\n                            className=\"w-16 h-8 text-xs bg-zinc-950/50\"\n                        />\n                    </div>\n                }\n            >\n                <AreaHeatmapChart\n                    data={areaDistributionAnalysis}\n                    selectedRooms={selectedRooms}\n                    minArea={minArea}\n                    maxArea={maxArea}\n                    interval={interval}\n                    onDataPointClick={handleHeatmapClick}\n                />\n\n                {/* Aggregated Heatmap Detail Modal */}\n                {heatmapModalMeta && (\n                    <div className=\"mt-4 p-4 bg-zinc-900/50 border border-white/10 rounded-lg\">\n                        <div className=\"flex justify-between items-center mb-3\">\n                            <div>\n                                <h4 className=\"text-white font-medium flex items-center gap-2\">\n                                    <span className=\"text-cyan-400\">{heatmapModalMeta.roomType}</span>\n                                    <span className=\"text-zinc-500\">|</span>\n                                    <span>{heatmapModalMeta.areaRange} 坪</span>\n                                </h4>\n                                <p className=\"text-zinc-400 text-xs mt-1\">\n                                    共找到 {aggregatedDetails.length} 個建案，合計 {heatmapModalMeta.totalCount} 筆交易\n                                </p>\n                            </div>\n                            <button\n                                onClick={() => setHeatmapModalMeta(null)}\n                                className=\"text-zinc-400 hover:text-white text-sm bg-zinc-800/50 px-3 py-1 rounded-full hover:bg-zinc-700 transition-colors\"\n                            >\n                                ✕ 關閉\n                            </button>\n                        </div>\n\n                        {aggregatedDetails.length > 0 ? (\n                            <div className=\"max-h-[500px] overflow-y-auto pr-1 custom-scrollbar\">\n                                <table className=\"w-full text-xs border-collapse\">\n                                    <thead className=\"bg-zinc-800 text-zinc-300 sticky top-0 z-10 shadow-sm\">\n                                        <tr>\n                                            <th className=\"p-3 text-left w-[25%]\">建案名稱 (戶數)</th>\n                                            <th className=\"p-3 text-center w-[25%]\">成交單價範圍 (萬/坪)</th>\n                                            <th className=\"p-3 text-center w-[15%]\">總價中位數</th>\n                                            <th className=\"p-3 text-center w-[35%]\">成交總價範圍 (萬)</th>\n                                        </tr>\n                                    </thead>\n                                    <tbody className=\"divide-y divide-white/5\">\n                                        {aggregatedDetails.map((item, idx) => (\n                                            <React.Fragment key={idx}>\n                                                {/* Summary Row */}\n                                                <tr\n                                                    className={cn(\n                                                        \"group transition-colors cursor-pointer select-none\",\n                                                        item.isExpanded ? \"bg-zinc-800/60\" : \"hover:bg-zinc-800/30\"\n                                                    )}\n                                                    onClick={() => toggleProjectExpand(idx)}\n                                                >\n                                                    <td className=\"p-3 font-medium text-white flex items-center gap-2\">\n                                                        <span className={cn(\"text-zinc-500 transition-transform duration-200\", item.isExpanded ? \"rotate-90\" : \"\")}>▶</span>\n                                                        {item.projectName}\n                                                        <span className=\"px-1.5 py-0.5 rounded-full bg-zinc-700 text-zinc-300 text-[10px] min-w-[24px] text-center\">\n                                                            {item.count}\n                                                        </span>\n                                                    </td>\n                                                    <td className=\"p-3 text-center font-mono text-cyan-400\">\n                                                        {item.unitPriceRange.min === item.unitPriceRange.max\n                                                            ? item.unitPriceRange.min.toFixed(1)\n                                                            : `${item.unitPriceRange.min.toFixed(1)} ~ ${item.unitPriceRange.max.toFixed(1)}`\n                                                        }\n                                                    </td>\n                                                    <td className=\"p-3 text-center font-mono text-violet-400\">\n                                                        {formatPrice((item.priceRange as any).median || 0)}\n                                                    </td>\n                                                    <td className=\"p-3 text-center font-mono text-zinc-300\">\n                                                        {item.priceRange.min === item.priceRange.max\n                                                            ? formatPrice(item.priceRange.min)\n                                                            : `${formatPrice(item.priceRange.min)} ~ ${formatPrice(item.priceRange.max)}`\n                                                        }\n                                                    </td>\n                                                </tr>\n\n                                                {/* Expanded Details Row */}\n                                                {item.isExpanded && (\n                                                    <tr>\n                                                        <td colSpan={4} className=\"p-0 bg-zinc-950/30 inset-shadow\">\n                                                            <div className=\"p-2 pl-8 border-l-2 border-zinc-700/50 ml-4 my-1\">\n                                                                <table className=\"w-full text-xs bg-transparent opacity-80\">\n                                                                    <thead className=\"text-zinc-500 border-b border-white/5\">\n                                                                        <tr>\n                                                                            <th className=\"py-1 text-left font-normal pl-2\">樓層</th>\n                                                                            <th className=\"py-1 text-left font-normal\">戶型</th>\n                                                                            <th className=\"py-1 text-right font-normal\">坪數</th>\n                                                                            <th className=\"py-1 text-right font-normal\">單價</th>\n                                                                            <th className=\"py-1 text-right font-normal pr-2\">總價</th>\n                                                                        </tr>\n                                                                    </thead>\n                                                                    <tbody>\n                                                                        {item.transactions.slice(0, (item as any).showAll ? undefined : 10).map((tx: any, ti: number) => (\n                                                                            <tr key={ti} className=\"hover:text-white\">\n                                                                                <td className=\"py-1 pl-2\">{tx['樓層'] || tx.floor || '-'}</td>\n                                                                                <td className=\"py-1 text-left text-zinc-400\">\n                                                                                    {tx['戶型'] || '-'}\n                                                                                </td>\n                                                                                <td className=\"py-1 text-right font-mono\">{(tx['房屋面積(坪)'] || tx.houseArea || 0).toFixed(1)}</td>\n                                                                                <td className=\"py-1 text-right font-mono text-cyan-500\">{(tx['房屋單價(萬)'] || tx.unitPrice || 0).toFixed(1)}</td>\n                                                                                <td className=\"py-1 text-right font-mono pr-2\">{formatPrice(tx['交易總價(萬)'] || tx.totalPrice || 0)}</td>\n                                                                            </tr>\n                                                                        ))}\n                                                                        {item.transactions.length > 10 && !(item as any).showAll && (\n                                                                            <tr>\n                                                                                <td colSpan={5} className=\"py-2 text-center\">\n                                                                                    <button\n                                                                                        onClick={(e) => {\n                                                                                            e.stopPropagation();\n                                                                                            setAggregatedDetails(prev => prev.map((p, i) => i === idx ? { ...p, showAll: true } : p));\n                                                                                        }}\n                                                                                        className=\"text-zinc-500 hover:text-zinc-300 italic text-xs hover:underline\"\n                                                                                    >\n                                                                                        ... 還有 {item.transactions.length - 10} 筆 (點擊展開) ...\n                                                                                    </button>\n                                                                                </td>\n                                                                            </tr>\n                                                                        )}\n                                                                        {item.transactions.length > 10 && (item as any).showAll && (\n                                                                            <tr>\n                                                                                <td colSpan={5} className=\"py-2 text-center\">\n                                                                                    <button\n                                                                                        onClick={(e) => {\n                                                                                            e.stopPropagation();\n                                                                                            setAggregatedDetails(prev => prev.map((p, i) => i === idx ? { ...p, showAll: false } : p));\n                                                                                        }}\n                                                                                        className=\"text-zinc-500 hover:text-zinc-300 italic text-xs hover:underline\"\n                                                                                    >\n                                                                                        ... 收合 ...\n                                                                                    </button>\n                                                                                </td>\n                                                                            </tr>\n                                                                        )}\n                                                                    </tbody>\n                                                                </table>\n                                                            </div>\n                                                        </td>\n                                                    </tr>\n                                                )}\n                                            </React.Fragment>\n                                        ))}\n                                    </tbody>\n                                </table>\n                            </div>\n                        ) : (\n                            <p className=\"text-zinc-500 text-center py-8 bg-zinc-900/30 rounded border border-dashed border-zinc-800\">\n                                無詳細資料\n                            </p>\n                        )}\n                    </div>\n                )}\n            </ReportWrapper>\n\n\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6013, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/charts/ParkingRatioChart.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useMemo } from \"react\";\nimport ChartWrapper from \"./ChartWrapper\";\nimport { ApexOptions } from \"apexcharts\";\n\ninterface ParkingData {\n    withParking: { count: number; percentage: number };\n    withoutParking: { count: number; percentage: number };\n}\n\ninterface ParkingRatioChartProps {\n    data: ParkingData;\n}\n\nexport function ParkingRatioChart({ data }: ParkingRatioChartProps) {\n    const series = useMemo(() => {\n        if (!data) return [];\n        return [data.withParking.count, data.withoutParking.count];\n    }, [data]);\n\n    const options: ApexOptions = useMemo(() => {\n        return {\n            chart: {\n                type: 'donut',\n                background: 'transparent',\n                foreColor: '#e5e7eb'\n            },\n            labels: ['含車位', '無車位'],\n            colors: ['#a5b4fc', '#4b5563'], // indigo-300, gray-600\n            plotOptions: {\n                pie: {\n                    donut: {\n                        labels: {\n                            show: true,\n                            total: {\n                                show: true,\n                                label: '總交易',\n                                color: '#e5e7eb',\n                                formatter: (w) => {\n                                    return w.globals.seriesTotals.reduce((a: number, b: number) => a + b, 0).toLocaleString() + ' 筆';\n                                }\n                            }\n                        }\n                    }\n                }\n            },\n            dataLabels: {\n                enabled: true,\n                formatter: (val: number) => `${val.toFixed(1)}%`\n            },\n            legend: {\n                position: 'bottom'\n            },\n            tooltip: {\n                theme: 'dark',\n                y: {\n                    formatter: (val: number) => `${val} 筆`\n                }\n            },\n            stroke: { show: false }\n        };\n    }, []);\n\n    if (!data || (data.withParking.count === 0 && data.withoutParking.count === 0)) {\n        return <div className=\"text-zinc-500 text-center p-8\">無車位配比資料</div>;\n    }\n\n    return (\n        <ChartWrapper\n            type=\"donut\"\n            series={series}\n            options={options}\n            height={350}\n            className=\"w-full\"\n        />\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAeO,SAAS,kBAAkB,EAAE,IAAI,EAA0B;IAC9D,MAAM,SAAS,IAAA,oPAAO,EAAC;QACnB,IAAI,CAAC,MAAM,OAAO,EAAE;QACpB,OAAO;YAAC,KAAK,WAAW,CAAC,KAAK;YAAE,KAAK,cAAc,CAAC,KAAK;SAAC;IAC9D,GAAG;QAAC;KAAK;IAET,MAAM,UAAuB,IAAA,oPAAO,EAAC;QACjC,OAAO;YACH,OAAO;gBACH,MAAM;gBACN,YAAY;gBACZ,WAAW;YACf;YACA,QAAQ;gBAAC;gBAAO;aAAM;YACtB,QAAQ;gBAAC;gBAAW;aAAU;YAC9B,aAAa;gBACT,KAAK;oBACD,OAAO;wBACH,QAAQ;4BACJ,MAAM;4BACN,OAAO;gCACH,MAAM;gCACN,OAAO;gCACP,OAAO;gCACP,WAAW,CAAC;oCACR,OAAO,EAAE,OAAO,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC,GAAW,IAAc,IAAI,GAAG,GAAG,cAAc,KAAK;gCAChG;4BACJ;wBACJ;oBACJ;gBACJ;YACJ;YACA,YAAY;gBACR,SAAS;gBACT,WAAW,CAAC,MAAgB,GAAG,IAAI,OAAO,CAAC,GAAG,CAAC,CAAC;YACpD;YACA,QAAQ;gBACJ,UAAU;YACd;YACA,SAAS;gBACL,OAAO;gBACP,GAAG;oBACC,WAAW,CAAC,MAAgB,GAAG,IAAI,EAAE,CAAC;gBAC1C;YACJ;YACA,QAAQ;gBAAE,MAAM;YAAM;QAC1B;IACJ,GAAG,EAAE;IAEL,IAAI,CAAC,QAAS,KAAK,WAAW,CAAC,KAAK,KAAK,KAAK,KAAK,cAAc,CAAC,KAAK,KAAK,GAAI;QAC5E,qBAAO,kRAAC;YAAI,WAAU;sBAAgC;;;;;;IAC1D;IAEA,qBACI,kRAAC,2LAAY;QACT,MAAK;QACL,QAAQ;QACR,SAAS;QACT,QAAQ;QACR,WAAU;;;;;;AAGtB"}},
    {"offset": {"line": 6110, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/reports/ParkingAnalysisReport.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useMemo, useCallback } from \"react\";\nimport { ReportWrapper } from \"./ReportWrapper\";\nimport { ParkingRatioChart } from \"@/components/charts/ParkingRatioChart\";\nimport { cn } from \"@/lib/utils\";\nimport { Check } from \"lucide-react\";\n\ninterface FloorData {\n    floor: string;\n    count: number;\n    avgPrice: number;\n    medianPrice: number;\n    q3Price: number;\n    maxPrice: number;\n    minPrice: number;\n    rawRecords?: Array<{ parkingPrice: number; parkingArea?: number }>;\n}\n\ninterface ParkingAnalysisReportProps {\n    data: {\n        parkingAnalysis: {\n            parkingRatio: any;\n            avgPriceByType: any[];\n            rampPlanePriceByFloor: FloorData[];\n        }\n    } | null;\n}\n\n// Calculate statistics from selected floors\nfunction calculateFloorStats(floors: FloorData[], selectedFloors: string[]): { avgPrice: number; medianPrice: number; q3Price: number; count: number } {\n    const allPrices: number[] = [];\n    floors.forEach(f => {\n        if (selectedFloors.includes(f.floor) && f.rawRecords) {\n            f.rawRecords.forEach(r => {\n                if (typeof r.parkingPrice === 'number' && !isNaN(r.parkingPrice)) {\n                    allPrices.push(r.parkingPrice);\n                }\n            });\n        }\n    });\n\n    if (allPrices.length === 0) {\n        return { avgPrice: 0, medianPrice: 0, q3Price: 0, count: 0 };\n    }\n\n    allPrices.sort((a, b) => a - b);\n    const sum = allPrices.reduce((acc, p) => acc + p, 0);\n    const avgPrice = sum / allPrices.length;\n\n    const medianPrice = allPrices[Math.floor(allPrices.length / 2)];\n    const q3Index = Math.floor(allPrices.length * 0.75);\n    const q3Price = allPrices[q3Index] || medianPrice;\n\n    return { avgPrice, medianPrice, q3Price, count: allPrices.length };\n}\n\nexport function ParkingAnalysisReport({ data }: ParkingAnalysisReportProps) {\n    // State: selected floors for dynamic stats\n    const [selectedFloors, setSelectedFloors] = useState<string[]>(['B1', 'B2', 'B3', 'B4']);\n    // State: hovered floor for 3D interaction\n    const [hoveredFloor, setHoveredFloor] = useState<string | null>(null);\n\n    if (!data?.parkingAnalysis) return null;\n\n    const { parkingRatio, avgPriceByType, rampPlanePriceByFloor } = data.parkingAnalysis;\n\n    const validFloors = ['B1', 'B2', 'B3', 'B4', 'B5_below', 'Unknown'];\n    const filteredFloorData = rampPlanePriceByFloor?.filter(f => validFloors.includes(f.floor) && f.count > 0) || [];\n\n    // Compute dynamic stats based on selected floors\n    const dynamicStats = useMemo(() => {\n        return calculateFloorStats(filteredFloorData, selectedFloors);\n    }, [filteredFloorData, selectedFloors]);\n\n    const toggleFloor = useCallback((floor: string) => {\n        setSelectedFloors(prev =>\n            prev.includes(floor)\n                ? prev.filter(f => f !== floor)\n                : [...prev, floor]\n        );\n    }, []);\n\n    const toggleAll = useCallback(() => {\n        if (selectedFloors.length === validFloors.length) {\n            setSelectedFloors([]);\n        } else {\n            setSelectedFloors([...validFloors]);\n        }\n    }, [selectedFloors.length]);\n\n    const floorColors: Record<string, string> = {\n        'B1': '#06b6d4',\n        'B2': '#3b82f6',\n        'B3': '#6366f1',\n        'B4': '#8b5cf6',\n        'B5_below': '#a855f7',\n        'Unknown': '#71717a', // Zinc-500 for neutral/unknown\n    };\n\n    return (\n        <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                {/* 1. Parking Ratio */}\n                <ReportWrapper title=\"房車配比分析\" description=\"建案有購置車位的比例\">\n                    <div className=\"flex flex-col md:flex-row items-center gap-6\">\n                        <div className=\"w-full md:w-1/2\">\n                            <ParkingRatioChart data={parkingRatio} />\n                        </div>\n                        <div className=\"w-full md:w-1/2 space-y-4\">\n                            <table className=\"w-full text-sm\">\n                                <thead className=\"bg-zinc-900/50 text-zinc-500\">\n                                    <tr><th className=\"p-2 text-left\">類型</th><th className=\"p-2 text-right\">筆數</th><th className=\"p-2 text-right\">佔比</th></tr>\n                                </thead>\n                                <tbody className=\"divide-y divide-white/5\">\n                                    <tr>\n                                        <td className=\"p-2\">有搭車位</td>\n                                        <td className=\"p-2 text-right font-mono text-zinc-300\">{parkingRatio?.withParking?.count.toLocaleString()}</td>\n                                        <td className=\"p-2 text-right font-mono text-cyan-400\">{parkingRatio?.withParking?.percentage.toFixed(2)}%</td>\n                                    </tr>\n                                    <tr>\n                                        <td className=\"p-2\">無車位</td>\n                                        <td className=\"p-2 text-right font-mono text-zinc-300\">{parkingRatio?.withoutParking?.count.toLocaleString()}</td>\n                                        <td className=\"p-2 text-right font-mono text-zinc-500\">{parkingRatio?.withoutParking?.percentage.toFixed(2)}%</td>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        </div>\n                    </div>\n                </ReportWrapper>\n\n                {/* 2. Price By Type */}\n                <ReportWrapper title=\"車位類型均價\" description=\"各類車位成交行情\">\n                    <table className=\"w-full text-sm\">\n                        <thead className=\"bg-zinc-900/50 text-zinc-500\">\n                            <tr>\n                                <th className=\"p-2 text-left\">類型</th>\n                                <th className=\"p-2 text-right\">均價(萬)</th>\n                                <th className=\"p-2 text-right\">中位數</th>\n                                <th className=\"p-2 text-right\">總數</th>\n                            </tr>\n                        </thead>\n                        <tbody className=\"divide-y divide-white/5\">\n                            {avgPriceByType?.map((item: any) => (\n                                <tr key={item.type} className=\"hover:bg-zinc-800/50\">\n                                    <td className=\"p-2 font-medium\">{item.type}</td>\n                                    <td className=\"p-2 text-right font-mono text-cyan-400\">{Math.round(item.avgPrice).toLocaleString()}</td>\n                                    <td className=\"p-2 text-right font-mono text-zinc-300\">{Math.round(item.medianPrice).toLocaleString()}</td>\n                                    <td className=\"p-2 text-right font-mono text-zinc-500\">{item.count.toLocaleString()}</td>\n                                </tr>\n                            ))}\n                        </tbody>\n                    </table>\n                </ReportWrapper>\n            </div>\n\n            {/* 3. Ramp Plane Area Stats */}\n            <ReportWrapper title=\"坡道平面車位坪數統計\" description=\"坡道平面車位的面積分佈\">\n                {(() => {\n                    // Calculate area stats from rampPlanePriceByFloor\n                    let allAreas: number[] = [];\n                    filteredFloorData.forEach(floorData => {\n                        if (floorData.rawRecords) {\n                            floorData.rawRecords.forEach((record: any) => {\n                                const area = record.parkingArea || record['車位面積(坪)'];\n                                if (typeof area === 'number' && area > 0) {\n                                    allAreas.push(area);\n                                }\n                            });\n                        }\n                    });\n\n                    if (allAreas.length > 0) {\n                        allAreas.sort((a, b) => a - b);\n                        const avgArea = allAreas.reduce((sum, a) => sum + a, 0) / allAreas.length;\n                        const medianArea = allAreas[Math.floor(allAreas.length / 2)];\n\n                        return (\n                            <table className=\"w-full text-sm\">\n                                <thead className=\"bg-zinc-900/50 text-zinc-500\">\n                                    <tr>\n                                        <th className=\"p-2 text-left\">統計項目</th>\n                                        <th className=\"p-2 text-right\">數值</th>\n                                    </tr>\n                                </thead>\n                                <tbody className=\"divide-y divide-white/5\">\n                                    <tr className=\"hover:bg-zinc-800/50\">\n                                        <td className=\"p-2\">統計車位數</td>\n                                        <td className=\"p-2 text-right font-mono text-zinc-300\">{allAreas.length.toLocaleString()} 位</td>\n                                    </tr>\n                                    <tr className=\"hover:bg-zinc-800/50\">\n                                        <td className=\"p-2\">平均坪數</td>\n                                        <td className=\"p-2 text-right font-mono text-cyan-400\">{avgArea.toFixed(2)} 坪</td>\n                                    </tr>\n                                    <tr className=\"hover:bg-zinc-800/50\">\n                                        <td className=\"p-2\">坪數中位數</td>\n                                        <td className=\"p-2 text-right font-mono text-zinc-300\">{medianArea.toFixed(2)} 坪</td>\n                                    </tr>\n                                </tbody>\n                            </table>\n                        );\n                    } else {\n                        return <p className=\"text-zinc-500 text-center py-4\">無坡道平面車位坪數資料</p>;\n                    }\n                })()}\n            </ReportWrapper>\n\n            {/* 4. Ramp Plane Floor Analysis - Enhanced */}\n            <ReportWrapper title=\"坡道平面車位 - 樓層價差分析\" description=\"勾選樓層以動態更新統計數據\">\n                <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                    {/* 3D Visual Stack */}\n                    <div className=\"flex flex-col-reverse gap-2 items-center justify-center p-8 bg-zinc-900/30 rounded-xl relative\">\n                        {filteredFloorData.map((floor, idx) => {\n                            const isSelected = selectedFloors.includes(floor.floor);\n                            const isHovered = hoveredFloor === floor.floor;\n\n                            return (\n                                <div\n                                    key={floor.floor}\n                                    onMouseEnter={() => setHoveredFloor(floor.floor)}\n                                    onMouseLeave={() => setHoveredFloor(null)}\n                                    className={cn(\n                                        \"w-52 h-14 rounded-lg flex items-center justify-between px-4 shadow-lg transition-all duration-200 cursor-pointer\",\n                                        isHovered && \"ring-2 ring-white scale-105\",\n                                        !isSelected && \"opacity-30\"\n                                    )}\n                                    style={{\n                                        backgroundColor: floorColors[floor.floor] || '#4b5563',\n                                    }}\n                                    onClick={() => toggleFloor(floor.floor)}\n                                >\n                                    <div className=\"flex items-center gap-2\">\n                                        <span className={cn(\n                                            \"w-5 h-5 rounded border-2 flex items-center justify-center\",\n                                            isSelected ? \"bg-white border-white\" : \"border-white/50\"\n                                        )}>\n                                            {isSelected && <Check size={14} className=\"text-zinc-900\" />}\n                                        </span>\n                                        <span className=\"font-bold text-white\">{floor.floor}</span>\n                                    </div>\n                                    <div className=\"text-right\">\n                                        <div className=\"font-mono text-white text-sm\">{Math.round(floor.avgPrice).toLocaleString()} 萬</div>\n                                        <div className=\"text-white/70 text-xs\">{floor.count} 位</div>\n                                    </div>\n                                </div>\n                            )\n                        })}\n                    </div>\n\n                    {/* Table + Dynamic Stats */}\n                    <div className=\"space-y-4\">\n                        {/* Dynamic Stats Summary */}\n                        <div className=\"p-4 bg-gradient-to-r from-cyan-500/10 to-violet-500/10 border border-cyan-500/30 rounded-lg\">\n                            <h4 className=\"text-sm font-medium text-cyan-400 mb-3\">已選樓層統計</h4>\n                            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                                <div>\n                                    <div className=\"text-xs text-zinc-500\">車位數</div>\n                                    <div className=\"text-lg font-bold text-white\">{dynamicStats.count.toLocaleString()}</div>\n                                </div>\n                                <div>\n                                    <div className=\"text-xs text-zinc-500\">平均單價</div>\n                                    <div className=\"text-lg font-bold text-cyan-400\">{Math.round(dynamicStats.avgPrice).toLocaleString()} 萬</div>\n                                </div>\n                                <div>\n                                    <div className=\"text-xs text-zinc-500\">中位數</div>\n                                    <div className=\"text-lg font-bold text-zinc-300\">{Math.round(dynamicStats.medianPrice).toLocaleString()} 萬</div>\n                                </div>\n                                <div>\n                                    <div className=\"text-xs text-zinc-500\">3/4位數</div>\n                                    <div className=\"text-lg font-bold text-zinc-300\">{Math.round(dynamicStats.q3Price).toLocaleString()} 萬</div>\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Floor Table with Checkboxes */}\n                        <div className=\"overflow-x-auto\">\n                            <table className=\"w-full text-sm\">\n                                <thead className=\"bg-zinc-900/50 text-zinc-500\">\n                                    <tr>\n                                        <th className=\"p-2 text-left\">\n                                            <label className=\"flex items-center gap-2 cursor-pointer\">\n                                                <input\n                                                    type=\"checkbox\"\n                                                    checked={selectedFloors.length === validFloors.length}\n                                                    onChange={toggleAll}\n                                                    className=\"form-checkbox rounded bg-zinc-800 border-zinc-600 text-cyan-500\"\n                                                />\n                                                <span>全選</span>\n                                            </label>\n                                        </th>\n                                        <th className=\"p-2 text-left\">樓層</th>\n                                        <th className=\"p-2 text-right\">均價(萬)</th>\n                                        <th className=\"p-2 text-right\">中位數</th>\n                                        <th className=\"p-2 text-right\">最高</th>\n                                        <th className=\"p-2 text-right\">最低</th>\n                                        <th className=\"p-2 text-right\">車位數</th>\n                                    </tr>\n                                </thead>\n                                <tbody className=\"divide-y divide-white/5\">\n                                    {filteredFloorData.map((floor) => {\n                                        const isSelected = selectedFloors.includes(floor.floor);\n                                        const isHovered = hoveredFloor === floor.floor;\n\n                                        return (\n                                            <tr\n                                                key={floor.floor}\n                                                onMouseEnter={() => setHoveredFloor(floor.floor)}\n                                                onMouseLeave={() => setHoveredFloor(null)}\n                                                className={cn(\n                                                    \"transition-colors cursor-pointer\",\n                                                    isHovered ? \"bg-zinc-800\" : \"hover:bg-zinc-800/50\",\n                                                    !isSelected && \"opacity-50\"\n                                                )}\n                                                onClick={() => toggleFloor(floor.floor)}\n                                            >\n                                                <td className=\"p-2\">\n                                                    <input\n                                                        type=\"checkbox\"\n                                                        checked={isSelected}\n                                                        onChange={() => toggleFloor(floor.floor)}\n                                                        className=\"form-checkbox rounded bg-zinc-800 border-zinc-600 text-cyan-500\"\n                                                        onClick={e => e.stopPropagation()}\n                                                    />\n                                                </td>\n                                                <td className=\"p-2 font-medium\">\n                                                    <div className=\"flex items-center gap-2\">\n                                                        <span\n                                                            className=\"w-3 h-3 rounded-full\"\n                                                            style={{ backgroundColor: floorColors[floor.floor] }}\n                                                        />\n                                                        {floor.floor}\n                                                    </div>\n                                                </td>\n                                                <td className=\"p-2 text-right font-mono text-cyan-400\">{Math.round(floor.avgPrice).toLocaleString()}</td>\n                                                <td className=\"p-2 text-right font-mono text-zinc-300\">{Math.round(floor.medianPrice).toLocaleString()}</td>\n                                                <td className=\"p-2 text-right font-mono text-zinc-500\">{Math.round(floor.maxPrice).toLocaleString()}</td>\n                                                <td className=\"p-2 text-right font-mono text-zinc-500\">{Math.round(floor.minPrice).toLocaleString()}</td>\n                                                <td className=\"p-2 text-right font-mono text-zinc-500\">{floor.count.toLocaleString()}</td>\n                                            </tr>\n                                        );\n                                    })}\n                                </tbody>\n                            </table>\n                        </div>\n                    </div>\n                </div>\n            </ReportWrapper>\n\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AANA;;;;;;;AA6BA,4CAA4C;AAC5C,SAAS,oBAAoB,MAAmB,EAAE,cAAwB;IACtE,MAAM,YAAsB,EAAE;IAC9B,OAAO,OAAO,CAAC,CAAA;QACX,IAAI,eAAe,QAAQ,CAAC,EAAE,KAAK,KAAK,EAAE,UAAU,EAAE;YAClD,EAAE,UAAU,CAAC,OAAO,CAAC,CAAA;gBACjB,IAAI,OAAO,EAAE,YAAY,KAAK,YAAY,CAAC,MAAM,EAAE,YAAY,GAAG;oBAC9D,UAAU,IAAI,CAAC,EAAE,YAAY;gBACjC;YACJ;QACJ;IACJ;IAEA,IAAI,UAAU,MAAM,KAAK,GAAG;QACxB,OAAO;YAAE,UAAU;YAAG,aAAa;YAAG,SAAS;YAAG,OAAO;QAAE;IAC/D;IAEA,UAAU,IAAI,CAAC,CAAC,GAAG,IAAM,IAAI;IAC7B,MAAM,MAAM,UAAU,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,GAAG;IAClD,MAAM,WAAW,MAAM,UAAU,MAAM;IAEvC,MAAM,cAAc,SAAS,CAAC,KAAK,KAAK,CAAC,UAAU,MAAM,GAAG,GAAG;IAC/D,MAAM,UAAU,KAAK,KAAK,CAAC,UAAU,MAAM,GAAG;IAC9C,MAAM,UAAU,SAAS,CAAC,QAAQ,IAAI;IAEtC,OAAO;QAAE;QAAU;QAAa;QAAS,OAAO,UAAU,MAAM;IAAC;AACrE;AAEO,SAAS,sBAAsB,EAAE,IAAI,EAA8B;IACtE,2CAA2C;IAC3C,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,qPAAQ,EAAW;QAAC;QAAM;QAAM;QAAM;KAAK;IACvF,0CAA0C;IAC1C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,qPAAQ,EAAgB;IAEhE,IAAI,CAAC,MAAM,iBAAiB,OAAO;IAEnC,MAAM,EAAE,YAAY,EAAE,cAAc,EAAE,qBAAqB,EAAE,GAAG,KAAK,eAAe;IAEpF,MAAM,cAAc;QAAC;QAAM;QAAM;QAAM;QAAM;QAAY;KAAU;IACnE,MAAM,oBAAoB,uBAAuB,OAAO,CAAA,IAAK,YAAY,QAAQ,CAAC,EAAE,KAAK,KAAK,EAAE,KAAK,GAAG,MAAM,EAAE;IAEhH,iDAAiD;IACjD,MAAM,eAAe,IAAA,oPAAO,EAAC;QACzB,OAAO,oBAAoB,mBAAmB;IAClD,GAAG;QAAC;QAAmB;KAAe;IAEtC,MAAM,cAAc,IAAA,wPAAW,EAAC,CAAC;QAC7B,kBAAkB,CAAA,OACd,KAAK,QAAQ,CAAC,SACR,KAAK,MAAM,CAAC,CAAA,IAAK,MAAM,SACvB;mBAAI;gBAAM;aAAM;IAE9B,GAAG,EAAE;IAEL,MAAM,YAAY,IAAA,wPAAW,EAAC;QAC1B,IAAI,eAAe,MAAM,KAAK,YAAY,MAAM,EAAE;YAC9C,kBAAkB,EAAE;QACxB,OAAO;YACH,kBAAkB;mBAAI;aAAY;QACtC;IACJ,GAAG;QAAC,eAAe,MAAM;KAAC;IAE1B,MAAM,cAAsC;QACxC,MAAM;QACN,MAAM;QACN,MAAM;QACN,MAAM;QACN,YAAY;QACZ,WAAW;IACf;IAEA,qBACI,kRAAC;QAAI,WAAU;;0BAEX,kRAAC;gBAAI,WAAU;;kCAEX,kRAAC,mMAAa;wBAAC,OAAM;wBAAS,aAAY;kCACtC,cAAA,kRAAC;4BAAI,WAAU;;8CACX,kRAAC;oCAAI,WAAU;8CACX,cAAA,kRAAC,0MAAiB;wCAAC,MAAM;;;;;;;;;;;8CAE7B,kRAAC;oCAAI,WAAU;8CACX,cAAA,kRAAC;wCAAM,WAAU;;0DACb,kRAAC;gDAAM,WAAU;0DACb,cAAA,kRAAC;;sEAAG,kRAAC;4DAAG,WAAU;sEAAgB;;;;;;sEAAO,kRAAC;4DAAG,WAAU;sEAAiB;;;;;;sEAAO,kRAAC;4DAAG,WAAU;sEAAiB;;;;;;;;;;;;;;;;;0DAElH,kRAAC;gDAAM,WAAU;;kEACb,kRAAC;;0EACG,kRAAC;gEAAG,WAAU;0EAAM;;;;;;0EACpB,kRAAC;gEAAG,WAAU;0EAA0C,cAAc,aAAa,MAAM;;;;;;0EACzF,kRAAC;gEAAG,WAAU;;oEAA0C,cAAc,aAAa,WAAW,QAAQ;oEAAG;;;;;;;;;;;;;kEAE7G,kRAAC;;0EACG,kRAAC;gEAAG,WAAU;0EAAM;;;;;;0EACpB,kRAAC;gEAAG,WAAU;0EAA0C,cAAc,gBAAgB,MAAM;;;;;;0EAC5F,kRAAC;gEAAG,WAAU;;oEAA0C,cAAc,gBAAgB,WAAW,QAAQ;oEAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;kCASpI,kRAAC,mMAAa;wBAAC,OAAM;wBAAS,aAAY;kCACtC,cAAA,kRAAC;4BAAM,WAAU;;8CACb,kRAAC;oCAAM,WAAU;8CACb,cAAA,kRAAC;;0DACG,kRAAC;gDAAG,WAAU;0DAAgB;;;;;;0DAC9B,kRAAC;gDAAG,WAAU;0DAAiB;;;;;;0DAC/B,kRAAC;gDAAG,WAAU;0DAAiB;;;;;;0DAC/B,kRAAC;gDAAG,WAAU;0DAAiB;;;;;;;;;;;;;;;;;8CAGvC,kRAAC;oCAAM,WAAU;8CACZ,gBAAgB,IAAI,CAAC,qBAClB,kRAAC;4CAAmB,WAAU;;8DAC1B,kRAAC;oDAAG,WAAU;8DAAmB,KAAK,IAAI;;;;;;8DAC1C,kRAAC;oDAAG,WAAU;8DAA0C,KAAK,KAAK,CAAC,KAAK,QAAQ,EAAE,cAAc;;;;;;8DAChG,kRAAC;oDAAG,WAAU;8DAA0C,KAAK,KAAK,CAAC,KAAK,WAAW,EAAE,cAAc;;;;;;8DACnG,kRAAC;oDAAG,WAAU;8DAA0C,KAAK,KAAK,CAAC,cAAc;;;;;;;2CAJ5E,KAAK,IAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAatC,kRAAC,mMAAa;gBAAC,OAAM;gBAAa,aAAY;0BACzC,CAAC;oBACE,kDAAkD;oBAClD,IAAI,WAAqB,EAAE;oBAC3B,kBAAkB,OAAO,CAAC,CAAA;wBACtB,IAAI,UAAU,UAAU,EAAE;4BACtB,UAAU,UAAU,CAAC,OAAO,CAAC,CAAC;gCAC1B,MAAM,OAAO,OAAO,WAAW,IAAI,MAAM,CAAC,UAAU;gCACpD,IAAI,OAAO,SAAS,YAAY,OAAO,GAAG;oCACtC,SAAS,IAAI,CAAC;gCAClB;4BACJ;wBACJ;oBACJ;oBAEA,IAAI,SAAS,MAAM,GAAG,GAAG;wBACrB,SAAS,IAAI,CAAC,CAAC,GAAG,IAAM,IAAI;wBAC5B,MAAM,UAAU,SAAS,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,GAAG,KAAK,SAAS,MAAM;wBACzE,MAAM,aAAa,QAAQ,CAAC,KAAK,KAAK,CAAC,SAAS,MAAM,GAAG,GAAG;wBAE5D,qBACI,kRAAC;4BAAM,WAAU;;8CACb,kRAAC;oCAAM,WAAU;8CACb,cAAA,kRAAC;;0DACG,kRAAC;gDAAG,WAAU;0DAAgB;;;;;;0DAC9B,kRAAC;gDAAG,WAAU;0DAAiB;;;;;;;;;;;;;;;;;8CAGvC,kRAAC;oCAAM,WAAU;;sDACb,kRAAC;4CAAG,WAAU;;8DACV,kRAAC;oDAAG,WAAU;8DAAM;;;;;;8DACpB,kRAAC;oDAAG,WAAU;;wDAA0C,SAAS,MAAM,CAAC,cAAc;wDAAG;;;;;;;;;;;;;sDAE7F,kRAAC;4CAAG,WAAU;;8DACV,kRAAC;oDAAG,WAAU;8DAAM;;;;;;8DACpB,kRAAC;oDAAG,WAAU;;wDAA0C,QAAQ,OAAO,CAAC;wDAAG;;;;;;;;;;;;;sDAE/E,kRAAC;4CAAG,WAAU;;8DACV,kRAAC;oDAAG,WAAU;8DAAM;;;;;;8DACpB,kRAAC;oDAAG,WAAU;;wDAA0C,WAAW,OAAO,CAAC;wDAAG;;;;;;;;;;;;;;;;;;;;;;;;;oBAKlG,OAAO;wBACH,qBAAO,kRAAC;4BAAE,WAAU;sCAAiC;;;;;;oBACzD;gBACJ,CAAC;;;;;;0BAIL,kRAAC,mMAAa;gBAAC,OAAM;gBAAkB,aAAY;0BAC/C,cAAA,kRAAC;oBAAI,WAAU;;sCAEX,kRAAC;4BAAI,WAAU;sCACV,kBAAkB,GAAG,CAAC,CAAC,OAAO;gCAC3B,MAAM,aAAa,eAAe,QAAQ,CAAC,MAAM,KAAK;gCACtD,MAAM,YAAY,iBAAiB,MAAM,KAAK;gCAE9C,qBACI,kRAAC;oCAEG,cAAc,IAAM,gBAAgB,MAAM,KAAK;oCAC/C,cAAc,IAAM,gBAAgB;oCACpC,WAAW,IAAA,6JAAE,EACT,oHACA,aAAa,+BACb,CAAC,cAAc;oCAEnB,OAAO;wCACH,iBAAiB,WAAW,CAAC,MAAM,KAAK,CAAC,IAAI;oCACjD;oCACA,SAAS,IAAM,YAAY,MAAM,KAAK;;sDAEtC,kRAAC;4CAAI,WAAU;;8DACX,kRAAC;oDAAK,WAAW,IAAA,6JAAE,EACf,6DACA,aAAa,0BAA0B;8DAEtC,4BAAc,kRAAC,iPAAK;wDAAC,MAAM;wDAAI,WAAU;;;;;;;;;;;8DAE9C,kRAAC;oDAAK,WAAU;8DAAwB,MAAM,KAAK;;;;;;;;;;;;sDAEvD,kRAAC;4CAAI,WAAU;;8DACX,kRAAC;oDAAI,WAAU;;wDAAgC,KAAK,KAAK,CAAC,MAAM,QAAQ,EAAE,cAAc;wDAAG;;;;;;;8DAC3F,kRAAC;oDAAI,WAAU;;wDAAyB,MAAM,KAAK;wDAAC;;;;;;;;;;;;;;mCAxBnD,MAAM,KAAK;;;;;4BA4B5B;;;;;;sCAIJ,kRAAC;4BAAI,WAAU;;8CAEX,kRAAC;oCAAI,WAAU;;sDACX,kRAAC;4CAAG,WAAU;sDAAyC;;;;;;sDACvD,kRAAC;4CAAI,WAAU;;8DACX,kRAAC;;sEACG,kRAAC;4DAAI,WAAU;sEAAwB;;;;;;sEACvC,kRAAC;4DAAI,WAAU;sEAAgC,aAAa,KAAK,CAAC,cAAc;;;;;;;;;;;;8DAEpF,kRAAC;;sEACG,kRAAC;4DAAI,WAAU;sEAAwB;;;;;;sEACvC,kRAAC;4DAAI,WAAU;;gEAAmC,KAAK,KAAK,CAAC,aAAa,QAAQ,EAAE,cAAc;gEAAG;;;;;;;;;;;;;8DAEzG,kRAAC;;sEACG,kRAAC;4DAAI,WAAU;sEAAwB;;;;;;sEACvC,kRAAC;4DAAI,WAAU;;gEAAmC,KAAK,KAAK,CAAC,aAAa,WAAW,EAAE,cAAc;gEAAG;;;;;;;;;;;;;8DAE5G,kRAAC;;sEACG,kRAAC;4DAAI,WAAU;sEAAwB;;;;;;sEACvC,kRAAC;4DAAI,WAAU;;gEAAmC,KAAK,KAAK,CAAC,aAAa,OAAO,EAAE,cAAc;gEAAG;;;;;;;;;;;;;;;;;;;;;;;;;8CAMhH,kRAAC;oCAAI,WAAU;8CACX,cAAA,kRAAC;wCAAM,WAAU;;0DACb,kRAAC;gDAAM,WAAU;0DACb,cAAA,kRAAC;;sEACG,kRAAC;4DAAG,WAAU;sEACV,cAAA,kRAAC;gEAAM,WAAU;;kFACb,kRAAC;wEACG,MAAK;wEACL,SAAS,eAAe,MAAM,KAAK,YAAY,MAAM;wEACrD,UAAU;wEACV,WAAU;;;;;;kFAEd,kRAAC;kFAAK;;;;;;;;;;;;;;;;;sEAGd,kRAAC;4DAAG,WAAU;sEAAgB;;;;;;sEAC9B,kRAAC;4DAAG,WAAU;sEAAiB;;;;;;sEAC/B,kRAAC;4DAAG,WAAU;sEAAiB;;;;;;sEAC/B,kRAAC;4DAAG,WAAU;sEAAiB;;;;;;sEAC/B,kRAAC;4DAAG,WAAU;sEAAiB;;;;;;sEAC/B,kRAAC;4DAAG,WAAU;sEAAiB;;;;;;;;;;;;;;;;;0DAGvC,kRAAC;gDAAM,WAAU;0DACZ,kBAAkB,GAAG,CAAC,CAAC;oDACpB,MAAM,aAAa,eAAe,QAAQ,CAAC,MAAM,KAAK;oDACtD,MAAM,YAAY,iBAAiB,MAAM,KAAK;oDAE9C,qBACI,kRAAC;wDAEG,cAAc,IAAM,gBAAgB,MAAM,KAAK;wDAC/C,cAAc,IAAM,gBAAgB;wDACpC,WAAW,IAAA,6JAAE,EACT,oCACA,YAAY,gBAAgB,wBAC5B,CAAC,cAAc;wDAEnB,SAAS,IAAM,YAAY,MAAM,KAAK;;0EAEtC,kRAAC;gEAAG,WAAU;0EACV,cAAA,kRAAC;oEACG,MAAK;oEACL,SAAS;oEACT,UAAU,IAAM,YAAY,MAAM,KAAK;oEACvC,WAAU;oEACV,SAAS,CAAA,IAAK,EAAE,eAAe;;;;;;;;;;;0EAGvC,kRAAC;gEAAG,WAAU;0EACV,cAAA,kRAAC;oEAAI,WAAU;;sFACX,kRAAC;4EACG,WAAU;4EACV,OAAO;gFAAE,iBAAiB,WAAW,CAAC,MAAM,KAAK,CAAC;4EAAC;;;;;;wEAEtD,MAAM,KAAK;;;;;;;;;;;;0EAGpB,kRAAC;gEAAG,WAAU;0EAA0C,KAAK,KAAK,CAAC,MAAM,QAAQ,EAAE,cAAc;;;;;;0EACjG,kRAAC;gEAAG,WAAU;0EAA0C,KAAK,KAAK,CAAC,MAAM,WAAW,EAAE,cAAc;;;;;;0EACpG,kRAAC;gEAAG,WAAU;0EAA0C,KAAK,KAAK,CAAC,MAAM,QAAQ,EAAE,cAAc;;;;;;0EACjG,kRAAC;gEAAG,WAAU;0EAA0C,KAAK,KAAK,CAAC,MAAM,QAAQ,EAAE,cAAc;;;;;;0EACjG,kRAAC;gEAAG,WAAU;0EAA0C,MAAM,KAAK,CAAC,cAAc;;;;;;;uDAhC7E,MAAM,KAAK;;;;;gDAmC5B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAUpC"}},
    {"offset": {"line": 7148, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/charts/BubbleChart.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useMemo } from \"react\";\nimport ChartWrapper from \"./ChartWrapper\";\nimport { ApexOptions } from \"apexcharts\";\n\ninterface TransactionDetail {\n    \"房屋單價(萬)\": number;\n    \"房屋面積(坪)\": number;\n    [key: string]: any;\n}\n\ninterface BubbleChartProps {\n    data: TransactionDetail[];\n    minPrice: number;\n    maxPrice: number;\n    interval: number;\n    sizeMetric: \"count\" | \"area\";\n}\n\nexport function BubbleChart({ data, minPrice, maxPrice, interval, sizeMetric }: BubbleChartProps) {\n    const { series, chartData } = useMemo(() => {\n        if (!data || data.length === 0) return { series: [], chartData: [] };\n\n        // 1. Initialize Buckets\n        const buckets: any[] = [];\n        for (let i = minPrice; i < maxPrice; i += interval) {\n            buckets.push({\n                min: i,\n                max: Math.min(i + interval, maxPrice),\n                label: `${i}-${Math.min(i + interval, maxPrice)}`,\n                count: 0,\n                totalArea: 0,\n                avgPrice: 0,\n                transactions: []\n            });\n        }\n\n        // 2. Fill Buckets\n        data.forEach(tx => {\n            const unitPrice = tx[\"房屋單價(萬)\"];\n            const area = tx[\"房屋面積(坪)\"] || 0;\n            if (typeof unitPrice !== 'number' || unitPrice < minPrice || unitPrice >= maxPrice) return;\n\n            const bucketIndex = Math.floor((unitPrice - minPrice) / interval);\n            if (bucketIndex >= 0 && bucketIndex < buckets.length) {\n                buckets[bucketIndex].count++;\n                buckets[bucketIndex].totalArea += area;\n                buckets[bucketIndex].transactions.push(tx);\n            }\n        });\n\n        // 3. Filter Empty Buckets and Format for Chart\n        const validBuckets = buckets.filter(b => b.count > 0);\n        const maxCount = Math.max(...validBuckets.map(b => b.count));\n        const maxArea = Math.max(...validBuckets.map(b => b.totalArea));\n\n        const formattedSeries = validBuckets.map(b => {\n            const midPrice = (b.min + b.max) / 2;\n            const sizeValue = sizeMetric === 'count' ? b.count : b.totalArea;\n            const maxSizeValue = sizeMetric === 'count' ? maxCount : maxArea;\n\n            // Normalize bubble size (5-50)\n            const bubbleSize = maxSizeValue > 0 ? 5 + (sizeValue / maxSizeValue) * 45 : 5;\n\n            return {\n                x: b.label,\n                y: midPrice,\n                z: bubbleSize, // z is the bubble size\n                // Custom data for tooltip\n                count: b.count,\n                totalArea: b.totalArea,\n                rangeLabel: b.label\n            };\n        });\n\n        return {\n            series: [{ name: \"單價分佈\", data: formattedSeries }],\n            chartData: validBuckets\n        };\n    }, [data, minPrice, maxPrice, interval, sizeMetric]);\n\n    const options: ApexOptions = useMemo(() => {\n        return {\n            chart: {\n                type: 'bubble',\n                height: 450,\n                toolbar: { show: true },\n                zoom: { enabled: false }\n            },\n            dataLabels: {\n                enabled: true,\n                style: { colors: ['#fff'], fontWeight: 600 },\n                formatter: (_val, { seriesIndex, dataPointIndex, w }) => {\n                    const d = w.config.series[seriesIndex].data[dataPointIndex];\n                    return sizeMetric === 'count' ? d.count : Math.round(d.totalArea);\n                }\n            },\n            fill: {\n                opacity: 0.7,\n                type: 'gradient',\n                gradient: {\n                    shade: 'dark',\n                    type: 'diagonal1',\n                    gradientToColors: ['#8b5cf6'],\n                    inverseColors: false,\n                    opacityFrom: 0.85,\n                    opacityTo: 0.5,\n                }\n            },\n            xaxis: {\n                type: 'category',\n                title: {\n                    text: '單價區間 (萬/坪)',\n                    style: { color: '#9ca3af' }\n                },\n                labels: {\n                    rotate: -45,\n                    style: { colors: '#9ca3af' }\n                }\n            },\n            yaxis: {\n                title: {\n                    text: '平均單價點 (萬/坪)',\n                    style: { color: '#9ca3af' }\n                },\n                labels: {\n                    style: { colors: '#9ca3af' },\n                    formatter: (val) => val.toFixed(0)\n                },\n                min: minPrice - interval,\n                max: maxPrice + interval\n            },\n            tooltip: {\n                theme: 'dark',\n                custom: function ({ seriesIndex, dataPointIndex, w }) {\n                    const data = w.config.series[seriesIndex].data[dataPointIndex];\n                    const metricLabel = sizeMetric === 'count' ? '成交件數' : '總坪數';\n                    const metricValue = sizeMetric === 'count'\n                        ? data.count.toLocaleString() + ' 筆'\n                        : data.totalArea.toFixed(2) + ' 坪';\n\n                    return `\n                        <div style=\"background: #1f2937; border: 1px solid #374151; padding: 10px; border-radius: 8px;\">\n                            <div style=\"font-weight: 600; color: #06b6d4; margin-bottom: 6px;\">單價區間：${data.x} 萬/坪</div>\n                            <div style=\"color: #e5e7eb;\">成交件數：${data.count.toLocaleString()} 筆</div>\n                            <div style=\"color: #e5e7eb;\">總坪數：${data.totalArea.toFixed(2)} 坪</div>\n                            <div style=\"color: #a855f7; margin-top: 4px; font-weight: 500;\">${metricLabel}影響力：${metricValue}</div>\n                        </div>\n                    `;\n                }\n            },\n            theme: {\n                mode: 'dark'\n            },\n            grid: {\n                borderColor: '#374151'\n            }\n        };\n    }, [minPrice, maxPrice, interval, sizeMetric]);\n\n    if (!data || data.length === 0) {\n        return <div className=\"text-zinc-500 text-center p-8\">無交易資料可顯示</div>;\n    }\n\n    return (\n        <ChartWrapper\n            type=\"bubble\"\n            series={series}\n            options={options}\n            height={450}\n            className=\"w-full\"\n        />\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7351, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/reports/UnitPriceStatsBlock.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport { cn, formatNumber } from \"@/lib/utils\";\n\ninterface StatsBlockProps {\n    title: string;\n    stats: {\n        count: number;\n        avgPrice: number;\n        weightedAvgPrice?: number;  // Optional weighted average\n        minPrice: number;\n        q1Price: number;\n        medianPrice: number;\n        q3Price: number;\n        maxPrice: number;\n        minPriceProject?: string;\n        minPriceUnit?: string;\n        minPriceFloor?: string;\n        maxPriceProject?: string;\n        maxPriceUnit?: string;\n        maxPriceFloor?: string;\n    } | null;\n    noDataMessage?: string;\n    className?: string;\n    averageType?: 'arithmetic' | 'weighted';\n}\n\nexport function UnitPriceStatsBlock({\n    title,\n    stats,\n    noDataMessage = \"無資料\",\n    className,\n    averageType = 'weighted'\n}: StatsBlockProps) {\n    if (!stats || stats.count === 0) {\n        return (\n            <div className={cn(\"p-6 border border-white/5 rounded-lg bg-zinc-900/30\", className)}>\n                <h3 className=\"text-zinc-400 font-medium mb-4\">{title}</h3>\n                <p className=\"text-zinc-500 text-center py-4\">{noDataMessage}</p>\n            </div>\n        );\n    }\n\n    // Select appropriate average based on type\n    const displayAvgPrice = averageType === 'weighted' && stats.weightedAvgPrice\n        ? stats.weightedAvgPrice\n        : stats.avgPrice;\n    const avgTypeLabel = averageType === 'weighted' ? '加權平均單價' : '算術平均單價';\n\n    return (\n        <div className={cn(\"p-6 border border-white/5 rounded-lg bg-zinc-900/30\", className)}>\n            <div className=\"flex justify-between items-start mb-6\">\n                <h3 className=\"text-lg font-semibold text-white\">{title}</h3>\n                <span className=\"text-xs text-zinc-500 bg-zinc-800 px-2 py-1 rounded\">樣本數: {stats.count}</span>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n                {/* 1. Main Stats Table */}\n                <div className=\"space-y-1\">\n                    <table className=\"w-full text-sm\">\n                        <tbody className=\"divide-y divide-white/5\">\n                            <tr className=\"group\">\n                                <td className=\"py-2 text-zinc-400\">{avgTypeLabel}</td>\n                                <td className=\"py-2 text-right font-mono text-white group-hover:text-cyan-400 transition-colors\">{formatNumber(displayAvgPrice)} 萬/坪</td>\n                            </tr>\n                            <tr className=\"group\">\n                                <td className=\"py-2 text-zinc-400\">最低單價</td>\n                                <td className=\"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors\">{formatNumber(stats.minPrice)}</td>\n                            </tr>\n                            <tr className=\"group\">\n                                <td className=\"py-2 text-zinc-400\">1/4分位數</td>\n                                <td className=\"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors\">{formatNumber(stats.q1Price)}</td>\n                            </tr>\n                            <tr className=\"group\">\n                                <td className=\"py-2 text-violet-400 font-medium\">中位數單價</td>\n                                <td className=\"py-2 text-right font-mono text-violet-400 font-bold\">{formatNumber(stats.medianPrice)}</td>\n                            </tr>\n                            <tr className=\"group\">\n                                <td className=\"py-2 text-zinc-400\">3/4分位數</td>\n                                <td className=\"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors\">{formatNumber(stats.q3Price)}</td>\n                            </tr>\n                            <tr className=\"group\">\n                                <td className=\"py-2 text-zinc-400\">最高單價</td>\n                                <td className=\"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors\">{formatNumber(stats.maxPrice)}</td>\n                            </tr>\n                        </tbody>\n                    </table>\n                </div>\n\n                {/* 2. Extreme Values Info */}\n                <div className=\"space-y-4 text-sm\">\n                    <div className=\"p-3 bg-zinc-950/50 rounded border border-white/5\">\n                        <div className=\"text-cyan-500 font-medium mb-1 text-xs uppercase tracking-wider\">最高價建案</div>\n                        <div className=\"text-white font-bold text-lg mb-1\">{stats.maxPriceProject || 'N/A'}</div>\n                        <div className=\"flex gap-4 text-zinc-400 text-xs\">\n                            <span>戶型: {stats.maxPriceUnit || '-'}</span>\n                            <span>樓層: {stats.maxPriceFloor || '-'}</span>\n                        </div>\n                    </div>\n\n                    <div className=\"p-3 bg-zinc-950/50 rounded border border-white/5\">\n                        <div className=\"text-green-500 font-medium mb-1 text-xs uppercase tracking-wider\">最低價建案</div>\n                        <div className=\"text-white font-bold text-lg mb-1\">{stats.minPriceProject || 'N/A'}</div>\n                        <div className=\"flex gap-4 text-zinc-400 text-xs\">\n                            <span>戶型: {stats.minPriceUnit || '-'}</span>\n                            <span>樓層: {stats.minPriceFloor || '-'}</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAGA;AAHA;;;AA4BO,SAAS,oBAAoB,EAChC,KAAK,EACL,KAAK,EACL,gBAAgB,KAAK,EACrB,SAAS,EACT,cAAc,UAAU,EACV;IACd,IAAI,CAAC,SAAS,MAAM,KAAK,KAAK,GAAG;QAC7B,qBACI,kRAAC;YAAI,WAAW,IAAA,6JAAE,EAAC,uDAAuD;;8BACtE,kRAAC;oBAAG,WAAU;8BAAkC;;;;;;8BAChD,kRAAC;oBAAE,WAAU;8BAAkC;;;;;;;;;;;;IAG3D;IAEA,2CAA2C;IAC3C,MAAM,kBAAkB,gBAAgB,cAAc,MAAM,gBAAgB,GACtE,MAAM,gBAAgB,GACtB,MAAM,QAAQ;IACpB,MAAM,eAAe,gBAAgB,aAAa,WAAW;IAE7D,qBACI,kRAAC;QAAI,WAAW,IAAA,6JAAE,EAAC,uDAAuD;;0BACtE,kRAAC;gBAAI,WAAU;;kCACX,kRAAC;wBAAG,WAAU;kCAAoC;;;;;;kCAClD,kRAAC;wBAAK,WAAU;;4BAAsD;4BAAM,MAAM,KAAK;;;;;;;;;;;;;0BAG3F,kRAAC;gBAAI,WAAU;;kCAEX,kRAAC;wBAAI,WAAU;kCACX,cAAA,kRAAC;4BAAM,WAAU;sCACb,cAAA,kRAAC;gCAAM,WAAU;;kDACb,kRAAC;wCAAG,WAAU;;0DACV,kRAAC;gDAAG,WAAU;0DAAsB;;;;;;0DACpC,kRAAC;gDAAG,WAAU;;oDAAoF,IAAA,uKAAY,EAAC;oDAAiB;;;;;;;;;;;;;kDAEpI,kRAAC;wCAAG,WAAU;;0DACV,kRAAC;gDAAG,WAAU;0DAAqB;;;;;;0DACnC,kRAAC;gDAAG,WAAU;0DAAoF,IAAA,uKAAY,EAAC,MAAM,QAAQ;;;;;;;;;;;;kDAEjI,kRAAC;wCAAG,WAAU;;0DACV,kRAAC;gDAAG,WAAU;0DAAqB;;;;;;0DACnC,kRAAC;gDAAG,WAAU;0DAAoF,IAAA,uKAAY,EAAC,MAAM,OAAO;;;;;;;;;;;;kDAEhI,kRAAC;wCAAG,WAAU;;0DACV,kRAAC;gDAAG,WAAU;0DAAmC;;;;;;0DACjD,kRAAC;gDAAG,WAAU;0DAAuD,IAAA,uKAAY,EAAC,MAAM,WAAW;;;;;;;;;;;;kDAEvG,kRAAC;wCAAG,WAAU;;0DACV,kRAAC;gDAAG,WAAU;0DAAqB;;;;;;0DACnC,kRAAC;gDAAG,WAAU;0DAAoF,IAAA,uKAAY,EAAC,MAAM,OAAO;;;;;;;;;;;;kDAEhI,kRAAC;wCAAG,WAAU;;0DACV,kRAAC;gDAAG,WAAU;0DAAqB;;;;;;0DACnC,kRAAC;gDAAG,WAAU;0DAAoF,IAAA,uKAAY,EAAC,MAAM,QAAQ;;;;;;;;;;;;;;;;;;;;;;;;;;;;kCAO7I,kRAAC;wBAAI,WAAU;;0CACX,kRAAC;gCAAI,WAAU;;kDACX,kRAAC;wCAAI,WAAU;kDAAkE;;;;;;kDACjF,kRAAC;wCAAI,WAAU;kDAAqC,MAAM,eAAe,IAAI;;;;;;kDAC7E,kRAAC;wCAAI,WAAU;;0DACX,kRAAC;;oDAAK;oDAAK,MAAM,YAAY,IAAI;;;;;;;0DACjC,kRAAC;;oDAAK;oDAAK,MAAM,aAAa,IAAI;;;;;;;;;;;;;;;;;;;0CAI1C,kRAAC;gCAAI,WAAU;;kDACX,kRAAC;wCAAI,WAAU;kDAAmE;;;;;;kDAClF,kRAAC;wCAAI,WAAU;kDAAqC,MAAM,eAAe,IAAI;;;;;;kDAC7E,kRAAC;wCAAI,WAAU;;0DACX,kRAAC;;oDAAK;oDAAK,MAAM,YAAY,IAAI;;;;;;;0DACjC,kRAAC;;oDAAK;oDAAK,MAAM,aAAa,IAAI;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAO9D"}},
    {"offset": {"line": 7735, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/reports/TypeComparisonTable.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport { formatNumber } from \"@/lib/utils\";\n\ninterface TypeComparisonItem {\n    projectName: string;\n    county?: string;\n    district?: string;\n    residentialAvg: number;\n    shopAvg: number;\n    officeAvg: number;\n    shopMultiple: number;\n    officeMultiple: number;\n}\n\ninterface TypeComparisonTableProps {\n    data: TypeComparisonItem[];\n}\n\nexport function TypeComparisonTable({ data }: TypeComparisonTableProps) {\n    if (!data || data.length === 0) {\n        return <div className=\"text-zinc-500 text-center p-8\">無符合條件的建案可進行類型比較</div>;\n    }\n\n    // Calculate max values for progress bars\n    const maxShopMultiple = Math.max(...data.map(d => d.shopMultiple), 1);\n    const maxOfficeMultiple = Math.max(...data.map(d => d.officeMultiple), 1);\n\n    return (\n        <div className=\"overflow-x-auto\">\n            <table className=\"w-full text-sm text-left\">\n                <thead className=\"bg-zinc-900/80 text-zinc-400 font-semibold uppercase text-xs\">\n                    <tr>\n                        <th className=\"px-4 py-3\">建案名稱</th>\n                        <th className=\"px-4 py-3 text-right\">住宅均價</th>\n                        <th className=\"px-4 py-3 text-right\">店舖均價</th>\n                        <th className=\"px-4 py-3 w-[200px]\">店舖倍數</th>\n                        <th className=\"px-4 py-3 text-right\">事務所均價</th>\n                        <th className=\"px-4 py-3 w-[200px]\">事務所倍數</th>\n                    </tr>\n                </thead>\n                <tbody className=\"divide-y divide-white/5\">\n                    {data.map((item, idx) => (\n                        <tr key={idx} className=\"hover:bg-zinc-800/30 transition-colors\">\n                            <td className=\"px-4 py-3\">\n                                <div className=\"font-medium text-white\">{item.projectName}</div>\n                                <div className=\"text-xs text-zinc-500 flex gap-1 mt-0.5\">\n                                    {item.county && <span className=\"bg-zinc-800 px-1 rounded\">{item.county}</span>}\n                                    {item.district && <span className=\"bg-zinc-800 px-1 rounded\">{item.district}</span>}\n                                </div>\n                            </td>\n                            <td className=\"px-4 py-3 text-right font-mono text-zinc-300\">\n                                {item.residentialAvg > 0 ? formatNumber(item.residentialAvg) : '-'}\n                            </td>\n                            <td className=\"px-4 py-3 text-right font-mono text-zinc-300\">\n                                {item.shopAvg > 0 ? formatNumber(item.shopAvg) : '-'}\n                            </td>\n                            <td className=\"px-4 py-3\">\n                                {item.shopMultiple > 0 ? (\n                                    <div className=\"flex flex-col gap-1\">\n                                        <div className=\"flex justify-between text-xs mb-0.5\">\n                                            <span className=\"font-bold text-violet-400\">{item.shopMultiple.toFixed(2)}x</span>\n                                        </div>\n                                        <div className=\"h-1.5 bg-zinc-800 rounded-full overflow-hidden w-full\">\n                                            <div\n                                                className=\"h-full bg-violet-600 rounded-full\"\n                                                style={{ width: `${Math.min((item.shopMultiple / maxShopMultiple) * 100, 100)}%` }}\n                                            />\n                                        </div>\n                                    </div>\n                                ) : (\n                                    <span className=\"text-zinc-600\">-</span>\n                                )}\n                            </td>\n                            <td className=\"px-4 py-3 text-right font-mono text-zinc-300\">\n                                {item.officeAvg > 0 ? formatNumber(item.officeAvg) : '-'}\n                            </td>\n                            <td className=\"px-4 py-3\">\n                                {item.officeMultiple > 0 ? (\n                                    <div className=\"flex flex-col gap-1\">\n                                        <div className=\"flex justify-between text-xs mb-0.5\">\n                                            <span className=\"font-bold text-cyan-400\">{item.officeMultiple.toFixed(2)}x</span>\n                                        </div>\n                                        <div className=\"h-1.5 bg-zinc-800 rounded-full overflow-hidden w-full\">\n                                            <div\n                                                className=\"h-full bg-cyan-600 rounded-full\"\n                                                style={{ width: `${Math.min((item.officeMultiple / maxOfficeMultiple) * 100, 100)}%` }}\n                                            />\n                                        </div>\n                                    </div>\n                                ) : (\n                                    <span className=\"text-zinc-600\">-</span>\n                                )}\n                            </td>\n                        </tr>\n                    ))}\n                </tbody>\n            </table>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAGA;AAHA;;;AAoBO,SAAS,oBAAoB,EAAE,IAAI,EAA4B;IAClE,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,GAAG;QAC5B,qBAAO,kRAAC;YAAI,WAAU;sBAAgC;;;;;;IAC1D;IAEA,yCAAyC;IACzC,MAAM,kBAAkB,KAAK,GAAG,IAAI,KAAK,GAAG,CAAC,CAAA,IAAK,EAAE,YAAY,GAAG;IACnE,MAAM,oBAAoB,KAAK,GAAG,IAAI,KAAK,GAAG,CAAC,CAAA,IAAK,EAAE,cAAc,GAAG;IAEvE,qBACI,kRAAC;QAAI,WAAU;kBACX,cAAA,kRAAC;YAAM,WAAU;;8BACb,kRAAC;oBAAM,WAAU;8BACb,cAAA,kRAAC;;0CACG,kRAAC;gCAAG,WAAU;0CAAY;;;;;;0CAC1B,kRAAC;gCAAG,WAAU;0CAAuB;;;;;;0CACrC,kRAAC;gCAAG,WAAU;0CAAuB;;;;;;0CACrC,kRAAC;gCAAG,WAAU;0CAAsB;;;;;;0CACpC,kRAAC;gCAAG,WAAU;0CAAuB;;;;;;0CACrC,kRAAC;gCAAG,WAAU;0CAAsB;;;;;;;;;;;;;;;;;8BAG5C,kRAAC;oBAAM,WAAU;8BACZ,KAAK,GAAG,CAAC,CAAC,MAAM,oBACb,kRAAC;4BAAa,WAAU;;8CACpB,kRAAC;oCAAG,WAAU;;sDACV,kRAAC;4CAAI,WAAU;sDAA0B,KAAK,WAAW;;;;;;sDACzD,kRAAC;4CAAI,WAAU;;gDACV,KAAK,MAAM,kBAAI,kRAAC;oDAAK,WAAU;8DAA4B,KAAK,MAAM;;;;;;gDACtE,KAAK,QAAQ,kBAAI,kRAAC;oDAAK,WAAU;8DAA4B,KAAK,QAAQ;;;;;;;;;;;;;;;;;;8CAGnF,kRAAC;oCAAG,WAAU;8CACT,KAAK,cAAc,GAAG,IAAI,IAAA,uKAAY,EAAC,KAAK,cAAc,IAAI;;;;;;8CAEnE,kRAAC;oCAAG,WAAU;8CACT,KAAK,OAAO,GAAG,IAAI,IAAA,uKAAY,EAAC,KAAK,OAAO,IAAI;;;;;;8CAErD,kRAAC;oCAAG,WAAU;8CACT,KAAK,YAAY,GAAG,kBACjB,kRAAC;wCAAI,WAAU;;0DACX,kRAAC;gDAAI,WAAU;0DACX,cAAA,kRAAC;oDAAK,WAAU;;wDAA6B,KAAK,YAAY,CAAC,OAAO,CAAC;wDAAG;;;;;;;;;;;;0DAE9E,kRAAC;gDAAI,WAAU;0DACX,cAAA,kRAAC;oDACG,WAAU;oDACV,OAAO;wDAAE,OAAO,GAAG,KAAK,GAAG,CAAC,AAAC,KAAK,YAAY,GAAG,kBAAmB,KAAK,KAAK,CAAC,CAAC;oDAAC;;;;;;;;;;;;;;;;6DAK7F,kRAAC;wCAAK,WAAU;kDAAgB;;;;;;;;;;;8CAGxC,kRAAC;oCAAG,WAAU;8CACT,KAAK,SAAS,GAAG,IAAI,IAAA,uKAAY,EAAC,KAAK,SAAS,IAAI;;;;;;8CAEzD,kRAAC;oCAAG,WAAU;8CACT,KAAK,cAAc,GAAG,kBACnB,kRAAC;wCAAI,WAAU;;0DACX,kRAAC;gDAAI,WAAU;0DACX,cAAA,kRAAC;oDAAK,WAAU;;wDAA2B,KAAK,cAAc,CAAC,OAAO,CAAC;wDAAG;;;;;;;;;;;;0DAE9E,kRAAC;gDAAI,WAAU;0DACX,cAAA,kRAAC;oDACG,WAAU;oDACV,OAAO;wDAAE,OAAO,GAAG,KAAK,GAAG,CAAC,AAAC,KAAK,cAAc,GAAG,oBAAqB,KAAK,KAAK,CAAC,CAAC;oDAAC;;;;;;;;;;;;;;;;6DAKjG,kRAAC;wCAAK,WAAU;kDAAgB;;;;;;;;;;;;2BAhDnC;;;;;;;;;;;;;;;;;;;;;AAyDjC"}},
    {"offset": {"line": 8040, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/reports/UnitPriceAnalysisReport.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\nimport { ReportWrapper } from \"./ReportWrapper\";\nimport { BubbleChart } from \"@/components/charts/BubbleChart\";\nimport { Input } from \"@/components/ui/input\";\nimport { UnitPriceStatsBlock } from \"./UnitPriceStatsBlock\";\nimport { TypeComparisonTable } from \"./TypeComparisonTable\";\nimport { cn } from \"@/lib/utils\";\n\ninterface UnitPriceAnalysisReportProps {\n    data: {\n        transactionDetails?: any[];\n        unitPriceAnalysis?: {\n            residentialStats?: any;\n            officeStats?: any;\n            storeStats?: any;\n            typeComparison?: any[];\n        };\n    } | null;\n    visibleSections?: string[];\n}\n\nexport function UnitPriceAnalysisReport({ data, visibleSections = ['stats', 'comparison', 'chart'] }: UnitPriceAnalysisReportProps) {\n    // Local State for Controls\n    const [averageType, setAverageType] = useState<'arithmetic' | 'weighted'>('weighted');\n    const [minPrice, setMinPrice] = useState(30);\n    const [maxPrice, setMaxPrice] = useState(150);\n    const [interval, setInterval] = useState(5);\n    const [sizeMetric, setSizeMetric] = useState<'count' | 'area'>('count');\n\n    // Extract data from correct paths\n    const transactionDetails = data?.transactionDetails || [];\n    const unitPriceAnalysis = data?.unitPriceAnalysis;\n    const residentialStats = unitPriceAnalysis?.residentialStats;\n    const officeStats = unitPriceAnalysis?.officeStats;\n    const storeStats = unitPriceAnalysis?.storeStats;\n    const typeComparison = unitPriceAnalysis?.typeComparison;\n\n    if (!data || (!transactionDetails.length && !unitPriceAnalysis)) return null;\n\n    return (\n        <div className=\"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n\n            {/* 1. Stats Blocks Section */}\n            {visibleSections.includes('stats') && (\n                <div className=\"space-y-4\">\n                    <div className=\"flex flex-wrap items-center justify-between gap-4\">\n                        <h3 className=\"text-xl font-bold text-white pl-2 border-l-4 border-violet-500\">各用途單價統計</h3>\n\n                        {/* Average Type Toggle */}\n                        <div className=\"flex items-center gap-2\">\n                            <span className=\"text-zinc-400 text-sm\">平均類型:</span>\n                            <div className=\"flex bg-zinc-950/50 rounded-md p-1 border border-white/5\">\n                                <button\n                                    onClick={() => setAverageType('arithmetic')}\n                                    className={cn(\n                                        \"px-3 py-1 text-xs rounded transition-colors\",\n                                        averageType === 'arithmetic' ? \"bg-violet-500 text-white\" : \"text-zinc-400 hover:text-white\"\n                                    )}\n                                >\n                                    算術平均\n                                </button>\n                                <button\n                                    onClick={() => setAverageType('weighted')}\n                                    className={cn(\n                                        \"px-3 py-1 text-xs rounded transition-colors\",\n                                        averageType === 'weighted' ? \"bg-violet-500 text-white\" : \"text-zinc-400 hover:text-white\"\n                                    )}\n                                >\n                                    加權平均\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div className=\"grid grid-cols-1 xl:grid-cols-2 gap-6\">\n                        <UnitPriceStatsBlock\n                            title=\"住宅建案統計\"\n                            stats={residentialStats}\n                            noDataMessage=\"無住宅交易數據\"\n                            className=\"border-violet-500/20\"\n                            averageType={averageType}\n                        />\n                        <UnitPriceStatsBlock\n                            title=\"一般事務所/辦公室統計\"\n                            stats={officeStats}\n                            noDataMessage=\"無事務所/辦公室交易數據\"\n                            className=\"border-cyan-500/20\"\n                            averageType={averageType}\n                        />\n                        <UnitPriceStatsBlock\n                            title=\"店舖統計\"\n                            stats={storeStats}\n                            noDataMessage=\"無店舖交易數據\"\n                            className=\"border-amber-500/20 xl:col-span-2\"\n                            averageType={averageType}\n                        />\n                    </div>\n                </div>\n            )}\n\n\n            {/* 2. Type Comparison Section */}\n            {visibleSections.includes('comparison') && typeComparison && typeComparison.length > 0 && (\n                <ReportWrapper title=\"建案產品類型單價比較\" description=\"同一建案內不同用途（住宅/店面/事務所）的單價與倍數比較\">\n                    <TypeComparisonTable data={typeComparison} />\n                </ReportWrapper>\n            )}\n\n            {/* 3. Bubble Chart Controls & Chart */}\n            {visibleSections.includes('chart') && (\n                <div className=\"space-y-4\">\n                    <h3 className=\"text-xl font-bold text-white pl-2 border-l-4 border-violet-500\">單價分佈分析</h3>\n\n                    {/* Controls Toolbar */}\n                    <div className=\"p-4 bg-zinc-900/30 border border-white/5 rounded-lg flex flex-wrap gap-4 items-center\">\n                        <div className=\"flex items-center gap-2\">\n                            <span className=\"text-zinc-400 text-sm\">單價範圍:</span>\n                            <Input\n                                type=\"number\"\n                                value={minPrice}\n                                onChange={e => setMinPrice(Number(e.target.value))}\n                                className=\"w-20 h-8 text-xs bg-zinc-950/50\"\n                            />\n                            <span className=\"text-zinc-500\">-</span>\n                            <Input\n                                type=\"number\"\n                                value={maxPrice}\n                                onChange={e => setMaxPrice(Number(e.target.value))}\n                                className=\"w-20 h-8 text-xs bg-zinc-950/50\"\n                            />\n                        </div>\n\n                        <div className=\"flex items-center gap-2\">\n                            <span className=\"text-zinc-400 text-sm\">級距:</span>\n                            <Input\n                                type=\"number\"\n                                value={interval}\n                                onChange={e => setInterval(Number(e.target.value))}\n                                className=\"w-16 h-8 text-xs bg-zinc-950/50\"\n                            />\n                        </div>\n\n                        <div className=\"flex items-center gap-2\">\n                            <span className=\"text-zinc-400 text-sm\">氣泡大小依據:</span>\n                            <div className=\"flex bg-zinc-950/50 rounded-md p-1 border border-white/5\">\n                                <button\n                                    onClick={() => setSizeMetric('count')}\n                                    className={cn(\n                                        \"px-3 py-1 text-xs rounded transition-colors\",\n                                        sizeMetric === 'count' ? \"bg-violet-500 text-white\" : \"text-zinc-400 hover:text-white\"\n                                    )}\n                                >\n                                    成交筆數\n                                </button>\n                                <button\n                                    onClick={() => setSizeMetric('area')}\n                                    className={cn(\n                                        \"px-3 py-1 text-xs rounded transition-colors\",\n                                        sizeMetric === 'area' ? \"bg-violet-500 text-white\" : \"text-zinc-400 hover:text-white\"\n                                    )}\n                                >\n                                    總銷坪數\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n\n                    {/* Bubble Chart */}\n                    <ReportWrapper title=\"單價分佈泡泡圖\" description=\"分析各單價區間的成交熱度與分佈密集區\">\n                        <BubbleChart\n                            data={transactionDetails}\n                            minPrice={minPrice}\n                            maxPrice={maxPrice}\n                            interval={interval}\n                            sizeMetric={sizeMetric}\n                        />\n                    </ReportWrapper>\n                </div>\n            )}\n\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8382, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/charts/PricingHeatmap.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { cn } from \"@/lib/utils\";\nimport { Store, Briefcase, Sprout, Users } from \"lucide-react\";\n\ninterface HeatmapGridProps {\n    data: any;\n    floorPremium?: number;\n}\n\n// Helper: Format number\nconst formatNumber = (num: number, decimals: number = 0) => {\n    return num?.toLocaleString(undefined, { maximumFractionDigits: decimals });\n};\n\n// Premium Color Mapping\nconst getHeatmapColor = (premium: number | null, tx: any) => {\n    // Special Types Overrides (Match HeatmapReport Legend)\n    if (tx.isStorefront) return 'rgba(217, 119, 6, 0.4)'; // Amber-600 low opacity\n    if (tx.isOffice) return 'rgba(37, 99, 235, 0.4)'; // Blue-600 low opacity\n\n    if (premium === null) return '#1f2937'; // 灰色\n    if (premium < 0) return 'rgba(139, 92, 246, 0.4)'; // Discount: Violet\n    if (premium === 0) return '#06b6d4'; // Anchor: Cyan (typically border, but use color to highlight)\n    if (premium > 5) return 'rgba(244, 63, 94, 0.5)'; // High: Red\n    if (premium > 2) return 'rgba(234, 179, 8, 0.4)'; // Medium: Yellow\n    return 'rgba(34, 197, 94, 0.3)'; // Low: Green\n};\n\nconst getSpecialIcon = (tx: any) => {\n    if (tx.isStorefront) return { icon: <Store className=\"w-3 h-3\" />, label: \"店舖\" };\n    if (tx.isOffice) return { icon: <Briefcase className=\"w-3 h-3\" />, label: \"辦公\" };\n    if (tx.remark?.includes(\"露台\")) return { icon: <Sprout className=\"w-3 h-3\" />, label: \"露台\" };\n    if (tx.remark?.includes(\"親友\") || tx.remark?.includes(\"員工\")) return { icon: <Users className=\"w-3 h-3\" />, label: \"親友\" };\n    return null;\n};\n\nconst PortalTooltip = ({ children, triggerRect, isTopRow }: { children: React.ReactNode, triggerRect: DOMRect | null, isTopRow: boolean }) => {\n    if (!triggerRect) return null;\n\n    // Calculate position\n    const style: React.CSSProperties = {\n        position: 'fixed',\n        left: triggerRect.left + triggerRect.width / 2,\n        transform: 'translateX(-50%)',\n        zIndex: 9999, // High z-index\n    };\n\n    if (isTopRow) {\n        style.top = triggerRect.bottom + 8;\n    } else {\n        style.bottom = (window.innerHeight - triggerRect.top) + 8;\n    }\n\n    return createPortal(\n        <div style={style} className=\"pointer-events-none\">\n            {children}\n        </div>,\n        document.body\n    );\n};\n\nexport function PricingHeatmap({ data, floorPremium = 0.3 }: HeatmapGridProps) {\n    const { horizontalGrid, sortedFloors, sortedUnits, unitColorMap, summary, horizontalComparison } = data;\n    const [hoverData, setHoverData] = useState<{ rect: DOMRect, data: any, isTopRow: boolean } | null>(null);\n\n    const handleMouseEnter = (e: React.MouseEvent, tx: any, isTopRow: boolean) => {\n        const rect = e.currentTarget.getBoundingClientRect();\n        setHoverData({ rect, data: tx, isTopRow });\n    };\n\n    const handleMouseLeave = () => {\n        setHoverData(null);\n    };\n\n    if (!horizontalGrid || !sortedFloors || !sortedUnits) {\n        return <div className=\"text-zinc-500 text-center p-8\">無有效熱力圖資料</div>;\n    }\n\n    return (\n        <div className=\"space-y-8 overflow-x-auto relative\">\n            {/* Tooltip Portal */}\n            {hoverData && (\n                <PortalTooltip triggerRect={hoverData.rect} isTopRow={hoverData.isTopRow}>\n                    <div className=\"w-48 bg-zinc-900 border border-zinc-700 rounded-lg p-3 shadow-xl animate-in fade-in zoom-in-95 duration-200\">\n                        <div className=\"space-y-1\">\n                            {hoverData.data.premium === 0 && <div className=\"text-cyan-400 font-bold mb-1\">★ 基準戶</div>}\n                            {hoverData.data.premium !== null && (\n                                <div className=\"text-zinc-300\">\n                                    調價: <span className={cn(\n                                        hoverData.data.premium > 0 ? \"text-red-400\" : hoverData.data.premium < 0 ? \"text-violet-400\" : \"text-zinc-400\"\n                                    )}>{hoverData.data.premium > 0 ? '+' : ''}{hoverData.data.premium.toFixed(2)}%</span>\n                                </div>\n                            )}\n                            <div className=\"h-px bg-zinc-700 my-2\" />\n                            <div className=\"grid grid-cols-2 gap-x-2 gap-y-1 text-xs text-zinc-400\">\n                                <span>成交總價:</span> <span className=\"text-white text-right\">{formatNumber(hoverData.data.tooltipInfo.totalPrice)}萬</span>\n                                <span>房屋總價:</span> <span className=\"text-white text-right\">{formatNumber(hoverData.data.tooltipInfo.housePrice)}萬</span>\n                                <span>車位總價:</span> <span className=\"text-white text-right\">{formatNumber(hoverData.data.tooltipInfo.parkingPrice)}萬</span>\n                                <span>房屋面積:</span> <span className=\"text-white text-right\">{formatNumber(hoverData.data.tooltipInfo.houseArea, 2)}坪</span>\n                            </div>\n                        </div>\n                    </div>\n                </PortalTooltip>\n            )}\n\n            {/* 1. Main Heatmap Grid */}\n            <div className=\"min-w-max pb-32\">\n                <table className=\"divide-y divide-zinc-800 border-collapse w-full text-sm\">\n                    <thead>\n                        <tr>\n                            <th className=\"sticky left-0 bg-dark-card z-20 p-2 text-zinc-400 border-r border-zinc-800\">樓層 \\ 戶別</th>\n                            {sortedUnits.map((unit: string) => (\n                                <th\n                                    key={unit}\n                                    className=\"p-2 text-white font-medium border-l border-zinc-800/50\"\n                                    style={{ backgroundColor: `${unitColorMap[unit] || '#4b5563'}80` }}\n                                >\n                                    {unit}\n                                </th>\n                            ))}\n                        </tr>\n                    </thead>\n                    <tbody className=\"divide-y divide-zinc-800/50\">\n                        {sortedFloors.map((floor: string, floorIndex: number) => (\n                            <tr key={floor} className=\"hover:bg-zinc-800/30 transition-colors\">\n                                <td className=\"sticky left-0 bg-dark-card z-10 p-2 font-bold text-zinc-300 border-r border-zinc-800 text-center\">\n                                    {floor}\n                                </td>\n                                {sortedUnits.map((unit: string) => {\n                                    const cellData = horizontalGrid[floor]?.[unit];\n\n                                    if (!cellData || cellData.length === 0) {\n                                        return (\n                                            <td key={`${floor}-${unit}`} className=\"p-2 border-l border-zinc-800/50 bg-zinc-900/20 text-center text-zinc-600\">\n                                                -\n                                            </td>\n                                        );\n                                    }\n\n                                    return (\n                                        <td key={`${floor}-${unit}`} className=\"p-1 border-l border-zinc-800/50 align-top\">\n                                            <div className=\"flex flex-col gap-1\">\n                                                {cellData.map((tx: any, idx: number) => {\n                                                    const bgColor = getHeatmapColor(tx.premium, tx);\n                                                    const special = getSpecialIcon(tx);\n                                                    const isAnchor = tx.premium === 0;\n                                                    const isTopRow = floorIndex < 3; // First 3 rows go down\n\n                                                    return (\n                                                        <div\n                                                            key={idx}\n                                                            className={cn(\n                                                                \"p-1.5 rounded text-xs transition-transform hover:scale-105 cursor-default relative group\",\n                                                                isAnchor && \"ring-1 ring-cyan-500\"\n                                                            )}\n                                                            style={{ backgroundColor: bgColor }}\n                                                            onMouseEnter={(e) => handleMouseEnter(e, tx, isTopRow)}\n                                                            onMouseLeave={handleMouseLeave}\n                                                        >\n                                                            <div className=\"flex items-center justify-between gap-1\">\n                                                                <span className=\"font-semibold text-white flex items-center gap-1\">\n                                                                    {special && <span className=\"text-zinc-200\" title={special.label}>{special.icon}</span>}\n                                                                    {tx.unitPrice.toFixed(1)}萬\n                                                                </span>\n                                                                {tx.hasParking && (\n                                                                    <span className=\"flex items-center justify-center w-3.5 h-3.5 bg-blue-500 text-white text-[9px] font-bold rounded-sm ml-0.5\" title=\"含車位\">\n                                                                        P\n                                                                    </span>\n                                                                )}\n                                                            </div>\n                                                            <div className=\"text-[10px] text-zinc-300/80 mt-0.5\">\n                                                                {tx.transactionDate}\n                                                            </div>\n                                                        </div>\n                                                    );\n                                                })}\n                                            </div>\n                                        </td>\n                                    );\n                                })}\n                            </tr>\n                        ))}\n                    </tbody>\n                </table>\n            </div>\n\n            {/* 2. Summary Table */}\n            {summary && (\n                <div className=\"space-y-2\">\n                    <h3 className=\"text-lg font-semibold text-zinc-200\">調價幅度統計摘要 (排除店舖/辦公室)</h3>\n                    <div className=\"overflow-x-auto rounded-lg border border-zinc-800\">\n                        <table className=\"w-full text-sm text-left text-zinc-300\">\n                            <thead className=\"text-xs text-zinc-400 uppercase bg-zinc-900/50\">\n                                <tr>\n                                    <th className=\"px-6 py-3\">基準房屋總價</th>\n                                    <th className=\"px-6 py-3\">調價幅度總額</th>\n                                    <th className=\"px-6 py-3\">總溢價率</th>\n                                    <th className=\"px-6 py-3\">已售房屋坪數</th>\n                                    <th className=\"px-6 py-3\">平均單價調價</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                <tr className=\"bg-zinc-900/20 border-b border-zinc-800\">\n                                    <td className=\"px-6 py-4\">{formatNumber(summary.totalBaselineHousePrice)} 萬</td>\n                                    <td className={cn(\"px-6 py-4 font-bold\", summary.totalPricePremiumValue > 0 ? \"text-red-400\" : \"text-violet-400\")}>\n                                        {summary.totalPricePremiumValue > 0 ? '+' : ''}{formatNumber(summary.totalPricePremiumValue)} 萬\n                                    </td>\n                                    <td className=\"px-6 py-4\">\n                                        {((summary.totalPricePremiumValue / summary.totalBaselineHousePrice) * 100).toFixed(2)} %\n                                    </td>\n                                    <td className=\"px-6 py-4\">{formatNumber(summary.totalSoldArea)} 坪</td>\n                                    <td className={cn(\"px-6 py-4\", summary.totalPricePremiumValue > 0 ? \"text-red-400\" : \"text-violet-400\")}>\n                                        {(summary.totalPricePremiumValue / summary.totalSoldArea).toFixed(2)} 萬/坪\n                                    </td>\n                                </tr>\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            )}\n\n            {/* 3. Horizontal Comparison Table */}\n            {horizontalComparison && horizontalComparison.length > 0 && (\n                <div className=\"space-y-2\">\n                    <h3 className=\"text-lg font-semibold text-zinc-200\">\n                        戶型水平價差與溢價貢獻 (基準樓層: F{data.refFloorForComparison || 'N/A'})\n                    </h3>\n                    <div className=\"overflow-x-auto rounded-lg border border-zinc-800\">\n                        <table className=\"w-full text-sm text-left text-zinc-300\">\n                            <thead className=\"text-xs text-zinc-400 uppercase bg-zinc-900/50\">\n                                <tr>\n                                    <th className=\"px-4 py-3\">戶型</th>\n                                    <th className=\"px-4 py-3\">基準戶 (樓/價)</th>\n                                    <th className=\"px-4 py-3\">水平價差(萬/坪)</th>\n                                    <th className=\"px-4 py-3\">去化戶數</th>\n                                    <th className=\"px-4 py-3\">溢價貢獻</th>\n                                    <th className=\"px-4 py-3\">貢獻佔比</th>\n                                    <th className=\"px-4 py-3\">基準房屋總價</th>\n                                    <th className=\"px-4 py-3\">平均單價調價</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                {horizontalComparison.map((item: any, idx: number) => (\n                                    <tr key={idx} className=\"bg-zinc-900/20 border-b border-zinc-800 hover:bg-zinc-800/20\">\n                                        <td className=\"px-4 py-3 font-medium text-white\">{item.unitType}</td>\n                                        <td className=\"px-4 py-3\">{item.anchorInfo}</td>\n                                        <td className={cn(\"px-4 py-3\", (item.horizontalPriceDiff || 0) > 0 ? \"text-red-400\" : \"text-zinc-400\")}>\n                                            {typeof item.horizontalPriceDiff === 'number'\n                                                ? `${item.horizontalPriceDiff > 0 ? '+' : ''}${item.horizontalPriceDiff.toFixed(2)} 萬/坪`\n                                                : '-'}\n                                        </td>\n                                        <td className=\"px-4 py-3\">{item.unitsSold} 戶</td>\n                                        <td className={cn(\"px-4 py-3 font-bold\", item.timePremiumContribution > 0 ? \"text-red-400\" : \"text-violet-400\")}>\n                                            {item.timePremiumContribution > 0 ? '+' : ''}{formatNumber(item.timePremiumContribution)} 萬\n                                        </td>\n                                        <td className=\"px-4 py-3\">{typeof item.contributionPercentage === 'number' ? item.contributionPercentage.toFixed(2) : '0.00'}%</td>\n                                        <td className=\"px-4 py-3\">{formatNumber(item.baselineHousePrice)} 萬</td>\n                                        <td className=\"px-4 py-3\">{typeof item.avgPriceAdjustment === 'number' ? item.avgPriceAdjustment.toFixed(2) : '-'} 萬/坪</td>\n                                    </tr>\n                                ))}\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AALA;;;;;;AAYA,wBAAwB;AACxB,MAAM,eAAe,CAAC,KAAa,WAAmB,CAAC;IACnD,OAAO,KAAK,eAAe,WAAW;QAAE,uBAAuB;IAAS;AAC5E;AAEA,wBAAwB;AACxB,MAAM,kBAAkB,CAAC,SAAwB;IAC7C,uDAAuD;IACvD,IAAI,GAAG,YAAY,EAAE,OAAO,0BAA0B,wBAAwB;IAC9E,IAAI,GAAG,QAAQ,EAAE,OAAO,0BAA0B,uBAAuB;IAEzE,IAAI,YAAY,MAAM,OAAO,WAAW,KAAK;IAC7C,IAAI,UAAU,GAAG,OAAO,2BAA2B,mBAAmB;IACtE,IAAI,YAAY,GAAG,OAAO,WAAW,8DAA8D;IACnG,IAAI,UAAU,GAAG,OAAO,0BAA0B,YAAY;IAC9D,IAAI,UAAU,GAAG,OAAO,0BAA0B,iBAAiB;IACnE,OAAO,0BAA0B,aAAa;AAClD;AAEA,MAAM,iBAAiB,CAAC;IACpB,IAAI,GAAG,YAAY,EAAE,OAAO;QAAE,oBAAM,kRAAC,iPAAK;YAAC,WAAU;;;;;;QAAc,OAAO;IAAK;IAC/E,IAAI,GAAG,QAAQ,EAAE,OAAO;QAAE,oBAAM,kRAAC,6PAAS;YAAC,WAAU;;;;;;QAAc,OAAO;IAAK;IAC/E,IAAI,GAAG,MAAM,EAAE,SAAS,OAAO,OAAO;QAAE,oBAAM,kRAAC,oPAAM;YAAC,WAAU;;;;;;QAAc,OAAO;IAAK;IAC1F,IAAI,GAAG,MAAM,EAAE,SAAS,SAAS,GAAG,MAAM,EAAE,SAAS,OAAO,OAAO;QAAE,oBAAM,kRAAC,iPAAK;YAAC,WAAU;;;;;;QAAc,OAAO;IAAK;IACtH,OAAO;AACX;AAEA,MAAM,gBAAgB,CAAC,EAAE,QAAQ,EAAE,WAAW,EAAE,QAAQ,EAAiF;IACrI,IAAI,CAAC,aAAa,OAAO;IAEzB,qBAAqB;IACrB,MAAM,QAA6B;QAC/B,UAAU;QACV,MAAM,YAAY,IAAI,GAAG,YAAY,KAAK,GAAG;QAC7C,WAAW;QACX,QAAQ;IACZ;IAEA,IAAI,UAAU;QACV,MAAM,GAAG,GAAG,YAAY,MAAM,GAAG;IACrC,OAAO;QACH,MAAM,MAAM,GAAG,AAAC,OAAO,WAAW,GAAG,YAAY,GAAG,GAAI;IAC5D;IAEA,qBAAO,IAAA,gQAAY,gBACf,kRAAC;QAAI,OAAO;QAAO,WAAU;kBACxB;;;;;kDAEL,SAAS,IAAI;AAErB;AAEO,SAAS,eAAe,EAAE,IAAI,EAAE,eAAe,GAAG,EAAoB;IACzE,MAAM,EAAE,cAAc,EAAE,YAAY,EAAE,WAAW,EAAE,YAAY,EAAE,OAAO,EAAE,oBAAoB,EAAE,GAAG;IACnG,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,qPAAQ,EAAyD;IAEnG,MAAM,mBAAmB,CAAC,GAAqB,IAAS;QACpD,MAAM,OAAO,EAAE,aAAa,CAAC,qBAAqB;QAClD,aAAa;YAAE;YAAM,MAAM;YAAI;QAAS;IAC5C;IAEA,MAAM,mBAAmB;QACrB,aAAa;IACjB;IAEA,IAAI,CAAC,kBAAkB,CAAC,gBAAgB,CAAC,aAAa;QAClD,qBAAO,kRAAC;YAAI,WAAU;sBAAgC;;;;;;IAC1D;IAEA,qBACI,kRAAC;QAAI,WAAU;;YAEV,2BACG,kRAAC;gBAAc,aAAa,UAAU,IAAI;gBAAE,UAAU,UAAU,QAAQ;0BACpE,cAAA,kRAAC;oBAAI,WAAU;8BACX,cAAA,kRAAC;wBAAI,WAAU;;4BACV,UAAU,IAAI,CAAC,OAAO,KAAK,mBAAK,kRAAC;gCAAI,WAAU;0CAA+B;;;;;;4BAC9E,UAAU,IAAI,CAAC,OAAO,KAAK,sBACxB,kRAAC;gCAAI,WAAU;;oCAAgB;kDACvB,kRAAC;wCAAK,WAAW,IAAA,6JAAE,EACnB,UAAU,IAAI,CAAC,OAAO,GAAG,IAAI,iBAAiB,UAAU,IAAI,CAAC,OAAO,GAAG,IAAI,oBAAoB;;4CAC/F,UAAU,IAAI,CAAC,OAAO,GAAG,IAAI,MAAM;4CAAI,UAAU,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC;4CAAG;;;;;;;;;;;;;0CAGrF,kRAAC;gCAAI,WAAU;;;;;;0CACf,kRAAC;gCAAI,WAAU;;kDACX,kRAAC;kDAAK;;;;;;oCAAY;kDAAC,kRAAC;wCAAK,WAAU;;4CAAyB,aAAa,UAAU,IAAI,CAAC,WAAW,CAAC,UAAU;4CAAE;;;;;;;kDAChH,kRAAC;kDAAK;;;;;;oCAAY;kDAAC,kRAAC;wCAAK,WAAU;;4CAAyB,aAAa,UAAU,IAAI,CAAC,WAAW,CAAC,UAAU;4CAAE;;;;;;;kDAChH,kRAAC;kDAAK;;;;;;oCAAY;kDAAC,kRAAC;wCAAK,WAAU;;4CAAyB,aAAa,UAAU,IAAI,CAAC,WAAW,CAAC,YAAY;4CAAE;;;;;;;kDAClH,kRAAC;kDAAK;;;;;;oCAAY;kDAAC,kRAAC;wCAAK,WAAU;;4CAAyB,aAAa,UAAU,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE;4CAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BAQtI,kRAAC;gBAAI,WAAU;0BACX,cAAA,kRAAC;oBAAM,WAAU;;sCACb,kRAAC;sCACG,cAAA,kRAAC;;kDACG,kRAAC;wCAAG,WAAU;kDAA6E;;;;;;oCAC1F,YAAY,GAAG,CAAC,CAAC,qBACd,kRAAC;4CAEG,WAAU;4CACV,OAAO;gDAAE,iBAAiB,GAAG,YAAY,CAAC,KAAK,IAAI,UAAU,EAAE,CAAC;4CAAC;sDAEhE;2CAJI;;;;;;;;;;;;;;;;sCASrB,kRAAC;4BAAM,WAAU;sCACZ,aAAa,GAAG,CAAC,CAAC,OAAe,2BAC9B,kRAAC;oCAAe,WAAU;;sDACtB,kRAAC;4CAAG,WAAU;sDACT;;;;;;wCAEJ,YAAY,GAAG,CAAC,CAAC;4CACd,MAAM,WAAW,cAAc,CAAC,MAAM,EAAE,CAAC,KAAK;4CAE9C,IAAI,CAAC,YAAY,SAAS,MAAM,KAAK,GAAG;gDACpC,qBACI,kRAAC;oDAA4B,WAAU;8DAA2E;mDAAzG,GAAG,MAAM,CAAC,EAAE,MAAM;;;;;4CAInC;4CAEA,qBACI,kRAAC;gDAA4B,WAAU;0DACnC,cAAA,kRAAC;oDAAI,WAAU;8DACV,SAAS,GAAG,CAAC,CAAC,IAAS;wDACpB,MAAM,UAAU,gBAAgB,GAAG,OAAO,EAAE;wDAC5C,MAAM,UAAU,eAAe;wDAC/B,MAAM,WAAW,GAAG,OAAO,KAAK;wDAChC,MAAM,WAAW,aAAa,GAAG,uBAAuB;wDAExD,qBACI,kRAAC;4DAEG,WAAW,IAAA,6JAAE,EACT,4FACA,YAAY;4DAEhB,OAAO;gEAAE,iBAAiB;4DAAQ;4DAClC,cAAc,CAAC,IAAM,iBAAiB,GAAG,IAAI;4DAC7C,cAAc;;8EAEd,kRAAC;oEAAI,WAAU;;sFACX,kRAAC;4EAAK,WAAU;;gFACX,yBAAW,kRAAC;oFAAK,WAAU;oFAAgB,OAAO,QAAQ,KAAK;8FAAG,QAAQ,IAAI;;;;;;gFAC9E,GAAG,SAAS,CAAC,OAAO,CAAC;gFAAG;;;;;;;wEAE5B,GAAG,UAAU,kBACV,kRAAC;4EAAK,WAAU;4EAA6G,OAAM;sFAAM;;;;;;;;;;;;8EAKjJ,kRAAC;oEAAI,WAAU;8EACV,GAAG,eAAe;;;;;;;2DArBlB;;;;;oDAyBjB;;;;;;+CAnCC,GAAG,MAAM,CAAC,EAAE,MAAM;;;;;wCAuCnC;;mCAvDK;;;;;;;;;;;;;;;;;;;;;YA+DxB,yBACG,kRAAC;gBAAI,WAAU;;kCACX,kRAAC;wBAAG,WAAU;kCAAsC;;;;;;kCACpD,kRAAC;wBAAI,WAAU;kCACX,cAAA,kRAAC;4BAAM,WAAU;;8CACb,kRAAC;oCAAM,WAAU;8CACb,cAAA,kRAAC;;0DACG,kRAAC;gDAAG,WAAU;0DAAY;;;;;;0DAC1B,kRAAC;gDAAG,WAAU;0DAAY;;;;;;0DAC1B,kRAAC;gDAAG,WAAU;0DAAY;;;;;;0DAC1B,kRAAC;gDAAG,WAAU;0DAAY;;;;;;0DAC1B,kRAAC;gDAAG,WAAU;0DAAY;;;;;;;;;;;;;;;;;8CAGlC,kRAAC;8CACG,cAAA,kRAAC;wCAAG,WAAU;;0DACV,kRAAC;gDAAG,WAAU;;oDAAa,aAAa,QAAQ,uBAAuB;oDAAE;;;;;;;0DACzE,kRAAC;gDAAG,WAAW,IAAA,6JAAE,EAAC,uBAAuB,QAAQ,sBAAsB,GAAG,IAAI,iBAAiB;;oDAC1F,QAAQ,sBAAsB,GAAG,IAAI,MAAM;oDAAI,aAAa,QAAQ,sBAAsB;oDAAE;;;;;;;0DAEjG,kRAAC;gDAAG,WAAU;;oDACT,CAAC,AAAC,QAAQ,sBAAsB,GAAG,QAAQ,uBAAuB,GAAI,GAAG,EAAE,OAAO,CAAC;oDAAG;;;;;;;0DAE3F,kRAAC;gDAAG,WAAU;;oDAAa,aAAa,QAAQ,aAAa;oDAAE;;;;;;;0DAC/D,kRAAC;gDAAG,WAAW,IAAA,6JAAE,EAAC,aAAa,QAAQ,sBAAsB,GAAG,IAAI,iBAAiB;;oDAChF,CAAC,QAAQ,sBAAsB,GAAG,QAAQ,aAAa,EAAE,OAAO,CAAC;oDAAG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAUhG,wBAAwB,qBAAqB,MAAM,GAAG,mBACnD,kRAAC;gBAAI,WAAU;;kCACX,kRAAC;wBAAG,WAAU;;4BAAsC;4BAC3B,KAAK,qBAAqB,IAAI;4BAAM;;;;;;;kCAE7D,kRAAC;wBAAI,WAAU;kCACX,cAAA,kRAAC;4BAAM,WAAU;;8CACb,kRAAC;oCAAM,WAAU;8CACb,cAAA,kRAAC;;0DACG,kRAAC;gDAAG,WAAU;0DAAY;;;;;;0DAC1B,kRAAC;gDAAG,WAAU;0DAAY;;;;;;0DAC1B,kRAAC;gDAAG,WAAU;0DAAY;;;;;;0DAC1B,kRAAC;gDAAG,WAAU;0DAAY;;;;;;0DAC1B,kRAAC;gDAAG,WAAU;0DAAY;;;;;;0DAC1B,kRAAC;gDAAG,WAAU;0DAAY;;;;;;0DAC1B,kRAAC;gDAAG,WAAU;0DAAY;;;;;;0DAC1B,kRAAC;gDAAG,WAAU;0DAAY;;;;;;;;;;;;;;;;;8CAGlC,kRAAC;8CACI,qBAAqB,GAAG,CAAC,CAAC,MAAW,oBAClC,kRAAC;4CAAa,WAAU;;8DACpB,kRAAC;oDAAG,WAAU;8DAAoC,KAAK,QAAQ;;;;;;8DAC/D,kRAAC;oDAAG,WAAU;8DAAa,KAAK,UAAU;;;;;;8DAC1C,kRAAC;oDAAG,WAAW,IAAA,6JAAE,EAAC,aAAa,CAAC,KAAK,mBAAmB,IAAI,CAAC,IAAI,IAAI,iBAAiB;8DACjF,OAAO,KAAK,mBAAmB,KAAK,WAC/B,GAAG,KAAK,mBAAmB,GAAG,IAAI,MAAM,KAAK,KAAK,mBAAmB,CAAC,OAAO,CAAC,GAAG,IAAI,CAAC,GACtF;;;;;;8DAEV,kRAAC;oDAAG,WAAU;;wDAAa,KAAK,SAAS;wDAAC;;;;;;;8DAC1C,kRAAC;oDAAG,WAAW,IAAA,6JAAE,EAAC,uBAAuB,KAAK,uBAAuB,GAAG,IAAI,iBAAiB;;wDACxF,KAAK,uBAAuB,GAAG,IAAI,MAAM;wDAAI,aAAa,KAAK,uBAAuB;wDAAE;;;;;;;8DAE7F,kRAAC;oDAAG,WAAU;;wDAAa,OAAO,KAAK,sBAAsB,KAAK,WAAW,KAAK,sBAAsB,CAAC,OAAO,CAAC,KAAK;wDAAO;;;;;;;8DAC7H,kRAAC;oDAAG,WAAU;;wDAAa,aAAa,KAAK,kBAAkB;wDAAE;;;;;;;8DACjE,kRAAC;oDAAG,WAAU;;wDAAa,OAAO,KAAK,kBAAkB,KAAK,WAAW,KAAK,kBAAkB,CAAC,OAAO,CAAC,KAAK;wDAAI;;;;;;;;2CAd7G;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwB7C"}},
    {"offset": {"line": 9205, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/reports/HeatmapReport.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect } from \"react\";\nimport { ReportWrapper } from \"./ReportWrapper\";\nimport { PricingHeatmap } from \"@/components/charts/PricingHeatmap\";\nimport { Select } from \"@/components/ui/select\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { RefreshCcw, Share2, Code } from \"lucide-react\";\n\nimport { generateHeatmapData } from \"@/lib/heatmap-utils\";\nimport { useFilterStore } from \"@/store/useFilterStore\";\n\ninterface HeatmapReportProps {\n    data: {\n        priceGridAnalysis: {\n            projectNames: string[];\n            byProject: Record<string, any>;\n        };\n        transactionDetails?: any[];\n    } | null;\n}\n\n\n\nfunction FloorRangeCalculator({ transactions, project }: { transactions: any[], project: string }) {\n    const [startFloor, setStartFloor] = useState<string>(\"\");\n    const [endFloor, setEndFloor] = useState<string>(\"\");\n    const [result, setResult] = useState<{ avg: number, count: number } | null>(null);\n\n    const handleCalculate = () => {\n        if (!project || !transactions) return;\n\n        const start = parseInt(startFloor);\n        const end = parseInt(endFloor);\n\n        if (isNaN(start) || isNaN(end) || start > end) {\n            setResult(null);\n            return;\n        }\n\n        // Filter transactions for this project and floor range\n        const targetTxs = transactions.filter(tx => {\n            if (tx['建案名稱'] !== project) return false;\n            // Floor parsing logic: '12' -> 12, 'B1' -> -1 (Exclude B floors for range calc usually? Or handle them?)\n            // Assuming user inputs standard floor numbers (e.g. 3 to 10)\n            const floorStr = String(tx['樓層']);\n            // Skip non-numeric start chars so \"10F\" becomes 10. Simple parseInt handles \"10\"\n            const floorVal = parseInt(floorStr);\n            if (isNaN(floorVal)) return false; // Skip basements or weird floors for now\n\n            return floorVal >= start && floorVal <= end;\n        });\n\n        if (targetTxs.length === 0) {\n            setResult({ avg: 0, count: 0 });\n            return;\n        }\n\n        const totalHousePrice = targetTxs.reduce((sum, tx) => sum + (tx['房屋總價(萬)'] || 0), 0);\n        const totalHouseArea = targetTxs.reduce((sum, tx) => sum + (tx['房屋面積(坪)'] || 0), 0);\n\n        const avg = totalHouseArea > 0 ? totalHousePrice / totalHouseArea : 0;\n        setResult({ avg, count: targetTxs.length });\n    };\n\n    return (\n        <div className=\"flex flex-wrap items-center gap-4 bg-zinc-900/30 p-4 rounded-lg border border-white/5\">\n            <div className=\"flex items-center gap-2\">\n                <span className=\"text-sm text-zinc-400 font-semibold\">區間均價試算:</span>\n                <div className=\"flex items-center gap-2\">\n                    <Input\n                        type=\"number\"\n                        placeholder=\"起樓\"\n                        className=\"w-20 h-8 bg-zinc-950/50\"\n                        value={startFloor}\n                        onChange={e => setStartFloor(e.target.value)}\n                    />\n                    <span className=\"text-zinc-500\">~</span>\n                    <Input\n                        type=\"number\"\n                        placeholder=\"迄樓\"\n                        className=\"w-20 h-8 bg-zinc-950/50\"\n                        value={endFloor}\n                        onChange={e => setEndFloor(e.target.value)}\n                    />\n                </div>\n                <Button\n                    size=\"sm\"\n                    variant=\"secondary\"\n                    onClick={handleCalculate}\n                    className=\"h-8 ml-2\"\n                >\n                    計算\n                </Button>\n            </div>\n\n            {result && (\n                <div className=\"flex items-center gap-4 ml-4 animate-in fade-in\">\n                    <div className=\"flex flex-col\">\n                        <span className=\"text-xs text-zinc-500\">平均單價 (加權)</span>\n                        <span className=\"text-lg font-bold text-violet-400\">{result.avg.toFixed(2)} 萬/坪</span>\n                    </div>\n                    <div className=\"flex flex-col\">\n                        <span className=\"text-xs text-zinc-500\">參考筆數</span>\n                        <span className=\"text-sm text-zinc-300\">{result.count} 筆</span>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}\n\nexport function HeatmapReport({ data }: HeatmapReportProps) {\n    const [selectedProject, setSelectedProject] = useState<string>(\"\");\n    const [floorPremium, setFloorPremium] = useState<number>(0.3);\n    const [showShareModal, setShowShareModal] = useState(false);\n\n    // Initialize selection\n    useEffect(() => {\n        if (data?.priceGridAnalysis?.projectNames?.length && !selectedProject) {\n            setSelectedProject(data.priceGridAnalysis.projectNames[0]);\n        }\n    }, [data, selectedProject]);\n\n    if (!data?.priceGridAnalysis) return null;\n\n    const { projectNames, byProject } = data.priceGridAnalysis;\n\n    // Attempt to get pre-calculated data or generate it on the fly\n    const projectData = React.useMemo(() => {\n        if (!selectedProject) return null;\n\n        // 1. Prefer generating on the fly to support dynamic floorPremium\n        if (data.transactionDetails) {\n            const { excludeCommercial } = useFilterStore.getState(); // Access flattened state directly \n            // Better to use hook if we want reactivity, but useMemo dep array handles re-runs if we include it.\n            // Let's add hook usage at top level.\n\n            let projectTx = data.transactionDetails.filter((tx: any) => tx['建案名稱'] === selectedProject);\n\n            if (excludeCommercial) {\n                projectTx = projectTx.filter((tx: any) => {\n                    const mainPurpose = tx['主要用途'] || '';\n                    const buildingType = tx['建物型態'] || '';\n                    const note = tx['備註'] || '';\n                    // Simple exclude logic matching backend/spec\n                    if (mainPurpose.includes('商業') || buildingType.includes('店') || note.includes('店')) return false;\n                    if (mainPurpose.includes('辦公') || buildingType.includes('辦公') || buildingType.includes('事務所')) return false;\n                    return true;\n                });\n            }\n\n            if (projectTx.length > 0) {\n                try {\n                    return generateHeatmapData(projectTx, floorPremium);\n                } catch (err) {\n                    console.error(\"Heatmap generation error:\", err);\n                    // Fallback to pre-calculated if generation fails\n                }\n            }\n        }\n\n        // 2. Fallback: Use existing analysis data (backend static)\n        if (byProject[selectedProject] && byProject[selectedProject].horizontalGrid) {\n            return byProject[selectedProject];\n        }\n\n        return null;\n    }, [selectedProject, byProject, data.transactionDetails, floorPremium]);\n\n    const handleReanalyze = () => {\n        // Since we are using client-side generation now (in memo), changing floorPremium automatically \"re-analyzes\".\n        // We can just log or perhaps trigger a refresh animation.\n        console.log(`Re-analyzing ${selectedProject} with floor premium: ${floorPremium}%`);\n    };\n\n    const handleShare = () => {\n        setShowShareModal(true);\n        // Copy share link logic\n        const shareUrl = `${window.location.origin}?project=${encodeURIComponent(selectedProject)}&floorPremium=${floorPremium}`;\n        navigator.clipboard.writeText(shareUrl).then(() => {\n            setTimeout(() => setShowShareModal(false), 2000);\n        });\n    };\n\n    return (\n        <div className=\"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n            {/* Controls Panel */}\n            <div className=\"flex flex-wrap items-center gap-4 bg-zinc-900/30 p-4 rounded-lg border border-white/5\">\n                {/* Project Selector */}\n                <div className=\"flex items-center gap-2\">\n                    <span className=\"text-sm text-zinc-400\">選擇建案:</span>\n                    <Select\n                        value={selectedProject}\n                        onChange={(e) => setSelectedProject(e.target.value)}\n                        className=\"w-[280px] bg-zinc-950/50\"\n                    >\n                        {projectNames.map(name => (\n                            <option key={name} value={name}>\n                                {name}\n                            </option>\n                        ))}\n                    </Select>\n                </div>\n\n                <div className=\"flex items-center gap-3\">\n                    <span className=\"text-sm text-zinc-400\">樓層價差:</span>\n                    <input\n                        type=\"range\"\n                        min={0}\n                        max={10}\n                        step={0.05}\n                        value={floorPremium}\n                        onChange={(e) => setFloorPremium(Number(e.target.value))}\n                        className=\"w-28 accent-violet-500\"\n                    />\n                    <Input\n                        type=\"number\"\n                        min={0}\n                        max={10}\n                        step={0.01}\n                        value={floorPremium}\n                        onChange={(e) => setFloorPremium(Math.max(0, Number(e.target.value)))}\n                        className=\"w-20 h-8 bg-zinc-950/50 text-right pr-2\"\n                    />\n                    <span className=\"text-sm font-mono text-violet-400 w-12\">萬/坪</span>\n                </div>\n\n                {/* Action Buttons */}\n                <div className=\"flex items-center gap-2 ml-auto\">\n                    <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={handleReanalyze}\n                        className=\"border-violet-500/30 text-violet-400 hover:bg-violet-500/10\"\n                    >\n                        <RefreshCcw className=\"mr-2 h-4 w-4\" />\n                        重新分析\n                    </Button>\n                    <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={handleShare}\n                        className=\"border-cyan-500/30 text-cyan-400 hover:bg-cyan-500/10\"\n                    >\n                        <Share2 className=\"mr-2 h-4 w-4\" />\n                        {showShareModal ? '已複製!' : '分享連結'}\n                    </Button>\n                </div>\n            </div>\n\n            {/* Floor Range Calculator */}\n            {selectedProject && data.transactionDetails && (\n                <FloorRangeCalculator\n                    transactions={data.transactionDetails}\n                    project={selectedProject}\n                />\n            )}\n\n            {/* Legend Section */}\n            <div className=\"flex flex-wrap gap-4 p-4 bg-zinc-900/20 rounded-lg border border-white/5\">\n                <div className=\"flex items-center gap-2\">\n                    <span className=\"text-xs text-zinc-500\">溢價圖例:</span>\n                    <span className=\"flex items-center gap-1\">\n                        <span className=\"w-4 h-4 rounded bg-red-500/80\"></span>\n                        <span className=\"text-xs text-zinc-400\">&gt; 5%</span>\n                    </span>\n                    <span className=\"flex items-center gap-1\">\n                        <span className=\"w-4 h-4 rounded bg-orange-500/80\"></span>\n                        <span className=\"text-xs text-zinc-400\">2-5%</span>\n                    </span>\n                    <span className=\"flex items-center gap-1\">\n                        <span className=\"w-4 h-4 rounded bg-yellow-500/80\"></span>\n                        <span className=\"text-xs text-zinc-400\">0-2%</span>\n                    </span>\n                    <span className=\"flex items-center gap-1\">\n                        <span className=\"w-4 h-4 rounded bg-green-500/80\"></span>\n                        <span className=\"text-xs text-zinc-400\">&lt; 0%</span>\n                    </span>\n                </div>\n                <div className=\"flex items-center gap-2 ml-auto\">\n                    <span className=\"text-xs text-zinc-500\">特殊交易:</span>\n                    <span className=\"flex items-center gap-1\">\n                        <span className=\"w-4 h-4 rounded bg-amber-600\"></span>\n                        <span className=\"text-xs text-zinc-400\">店舖</span>\n                    </span>\n                    <span className=\"flex items-center gap-1\">\n                        <span className=\"w-4 h-4 rounded bg-blue-600\"></span>\n                        <span className=\"text-xs text-zinc-400\">辦公室</span>\n                    </span>\n                    <span className=\"flex items-center gap-1\">\n                        <span className=\"w-4 h-4 rounded bg-purple-600\"></span>\n                        <span className=\"text-xs text-zinc-400\">廠辦</span>\n                    </span>\n                </div>\n            </div>\n\n            {/* Heatmap */}\n            <ReportWrapper title=\"建案銷控表與調價熱力圖\" description=\"可視化建案各戶別的銷售狀況與價格調整幅度\">\n                {projectData ? (\n                    <PricingHeatmap data={projectData} floorPremium={floorPremium} />\n                ) : (\n                    <div className=\"text-zinc-500 text-center p-12\">請選擇建案以查看銷控表</div>\n                )}\n            </ReportWrapper>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9878, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/ui/Modal.tsx"],"sourcesContent":["import * as React from 'react';\nimport { X } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { Card } from './card';\n\ninterface ModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    title?: React.ReactNode;\n    children: React.ReactNode;\n    className?: string;\n    maxWidth?: string;\n}\n\nexport function Modal({ isOpen, onClose, title, children, className, maxWidth = 'max-w-4xl' }: ModalProps) {\n    if (!isOpen) return null;\n\n    return (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm animate-in fade-in duration-200\">\n            <div className=\"absolute inset-0\" onClick={onClose} />\n            <Card\n                className={cn(\n                    \"relative w-full max-h-[90vh] flex flex-col overflow-hidden animate-in zoom-in-95 duration-200\",\n                    maxWidth,\n                    className\n                )}\n                onClick={(e) => e.stopPropagation()}\n            >\n                <div className=\"flex items-center justify-between p-6 border-b border-border-default\">\n                    {title && <h2 className=\"text-2xl font-bold text-white\">{title}</h2>}\n                    <button\n                        onClick={onClose}\n                        className=\"p-1 rounded-full hover:bg-white/10 transition-colors text-gray-400 hover:text-white\"\n                    >\n                        <X size={24} />\n                    </button>\n                </div>\n                <div className=\"p-6 overflow-y-auto custom-scrollbar\">\n                    {children}\n                </div>\n            </Card>\n        </div>\n    );\n}\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;;;;;AAWO,SAAS,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,SAAS,EAAE,WAAW,WAAW,EAAc;IACrG,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACI,kRAAC;QAAI,WAAU;;0BACX,kRAAC;gBAAI,WAAU;gBAAmB,SAAS;;;;;;0BAC3C,kRAAC,4KAAI;gBACD,WAAW,IAAA,6JAAE,EACT,iGACA,UACA;gBAEJ,SAAS,CAAC,IAAM,EAAE,eAAe;;kCAEjC,kRAAC;wBAAI,WAAU;;4BACV,uBAAS,kRAAC;gCAAG,WAAU;0CAAiC;;;;;;0CACzD,kRAAC;gCACG,SAAS;gCACT,WAAU;0CAEV,cAAA,kRAAC,qOAAC;oCAAC,MAAM;;;;;;;;;;;;;;;;;kCAGjB,kRAAC;wBAAI,WAAU;kCACV;;;;;;;;;;;;;;;;;;AAKrB"}},
    {"offset": {"line": 9964, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/reports/DataListReport.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect, useMemo, useCallback } from \"react\";\nimport { ReportWrapper } from \"./ReportWrapper\";\nimport { ChevronLeft, ChevronRight, ChevronDown, ChevronUp, ArrowUpDown, Search, X, Loader2, Table2 } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { useFilterStore } from \"@/store/useFilterStore\";\nimport { api } from \"@/lib/api\";\nimport { COUNTY_CODE_MAP, DISTRICT_DATA } from \"@/lib/config\";\nimport { getDateRangeDates } from \"@/lib/date-utils\";\nimport { Modal } from \"@/components/ui/Modal\";\n\ninterface TransactionRecord {\n    編號?: string;\n    縣市代碼?: string;\n    行政區?: string;\n    建案名稱?: string;\n    交易日?: string;\n    交易筆棟數?: string;\n    主要用途?: string;\n    建物型態?: string;\n    戶型?: string;\n    戶別?: string;\n    樓層?: string | number;\n    總樓層?: string | number;\n    房數?: number;\n    廳數?: number;\n    衛浴數?: number;\n    '房屋面積(坪)'?: number;\n    '房屋單價(萬)'?: number;\n    '房屋總價(萬)'?: number;\n    '車位總價(萬)'?: number;\n    '交易總價(萬)'?: number;\n    地址?: string;\n    備註?: string;\n    解約情形?: string;\n    交易類型?: string;\n    '車位類別'?: string;\n    '車位價格'?: number;\n    '車位面積'?: number;\n    '主建物面積'?: number;\n    '附屬建物面積'?: number;\n    '陽台面積'?: number;\n    [key: string]: any;\n}\n\ninterface DataListReportProps {\n    data?: any; // Kept for compatibility\n    trigger?: any; // Trigger to start fetching (e.g., analysisData)\n}\n\ntype SortDirection = 'asc' | 'desc' | null;\ntype SortConfig = { key: string; direction: SortDirection };\n\nexport function DataListReport({ data: _triggerData, trigger }: DataListReportProps) {\n    const filters = useFilterStore();\n    const [dataList, setDataList] = useState<TransactionRecord[]>([]);\n    const [isLoading, setIsLoading] = useState(false);\n    const [error, setError] = useState<string | null>(null);\n\n    const [currentPage, setCurrentPage] = useState(1);\n    const [expandedRows, setExpandedRows] = useState<Set<number>>(new Set());\n    const [sortConfig, setSortConfig] = useState<SortConfig>({ key: '', direction: null });\n    const [searchQuery, setSearchQuery] = useState('');\n    const [filterField, setFilterField] = useState<string>('建案名稱');\n    const pageSize = 20;\n\n    // Sub-table State\n    const [isSubTableOpen, setIsSubTableOpen] = useState(false);\n    const [subTableData, setSubTableData] = useState<any[]>([]);\n    const [subTableLoading, setSubTableLoading] = useState(false);\n    const [subTableTitle, setSubTableTitle] = useState('');\n\n    // Fetch data logic\n    const fetchByType = useCallback(async () => {\n        setIsLoading(true);\n        setError(null);\n        setDataList([]);\n\n        try {\n            const { counties, districts, transactionType, dateRange, startDate, endDate, projectNames, buildingType } = filters;\n\n            if (counties.length === 0) {\n                setIsLoading(false);\n                return;\n            }\n\n            // Calculate dates if needed\n            let finalStart = startDate;\n            let finalEnd = endDate;\n            if (dateRange !== 'custom') {\n                const dates = getDateRangeDates(dateRange);\n                if (dates.startDate) finalStart = dates.startDate;\n                if (dates.endDate) finalEnd = dates.endDate;\n            }\n\n            // Prepare promises for each county\n            const promises = counties.map(async (countyName) => {\n                const countyCode = COUNTY_CODE_MAP[countyName];\n\n                // Logic to filter districts for this county\n                // Only send districts belonging to this county\n                const countyDistricts = DISTRICT_DATA[countyName] || [];\n                const targetDistricts = districts.filter(d => countyDistricts.includes(d));\n\n                const payload = {\n                    countyCode,\n                    districts: targetDistricts.length > 0 ? targetDistricts : undefined,\n                    type: transactionType,\n                    dateStart: finalStart,\n                    dateEnd: finalEnd,\n                    projectNames,\n                    buildingType\n                };\n\n                try {\n                    // Backend expects 'limit', but PaginationState type has 'pageSize'. \n                    // We cast to any to pass 'limit' correctly.\n                    const pagination = { page: 1, limit: 1000 } as any;\n                    return await api.fetchData(payload, pagination);\n                } catch (e) {\n                    console.warn(`Fetch failed for ${countyName}`, e);\n                    return { data: [], count: 0 };\n                }\n            });\n\n            const results = await Promise.all(promises);\n\n            let merged: TransactionRecord[] = [];\n            results.forEach(res => {\n                if (res && Array.isArray(res.data)) {\n                    merged = [...merged, ...res.data];\n                }\n            });\n\n            // Default sort by Date desc\n            merged.sort((a, b) => {\n                const da = a['交易日'] || '';\n                const db = b['交易日'] || '';\n                return db.localeCompare(da);\n            });\n\n            setDataList(merged);\n\n        } catch (err: any) {\n            console.error(\"Data List fetch failed:\", err);\n            setError(err.message || \"讀取交易資料失敗\");\n        } finally {\n            setIsLoading(false);\n        }\n    }, [filters]);\n\n    // Trigger fetch when trigger prop updates\n    useEffect(() => {\n        if (trigger) {\n            fetchByType();\n        }\n    }, [fetchByType, trigger]);\n\n\n    const handleFetchSubTable = async (record: TransactionRecord) => {\n        if (!record.編號 || !record.縣市代碼) return;\n\n        const type = record['交易類型'] || filters.transactionType;\n\n        setSubTableTitle(`車位/附表明細 - ${record['建案名稱'] || record['編號']}`);\n        setSubTableLoading(true);\n        setIsSubTableOpen(true);\n        setSubTableData([]);\n\n        try {\n            const res = await api.fetchSubData(record.編號, type, record.縣市代碼);\n\n            let combinedResults: any[] = [];\n\n            // 1. Parse Backend Response (supports { park: [], build: [] } structure)\n            if (res.park && Array.isArray(res.park) && res.park.length > 0) {\n                combinedResults = [...combinedResults, ...res.park.map((p: any) => ({ ...p, _category: '車位資料' }))];\n            }\n\n            if (res.build && Array.isArray(res.build) && res.build.length > 0) {\n                combinedResults = [...combinedResults, ...res.build.map((b: any) => ({ ...b, _category: '建物明細' }))];\n            }\n\n            // Also check standard array retrieval just in case (legacy or simple response)\n            if (Array.isArray(res) && combinedResults.length === 0) {\n                combinedResults = [...combinedResults, ...res];\n            } else if (res.data && Array.isArray(res.data) && combinedResults.length === 0) {\n                combinedResults = [...combinedResults, ...res.data];\n            }\n\n            // 2. Fallback: If no sub-table data found, but main record indicates parking, show main record info\n            if (combinedResults.length === 0) {\n                const hasParking = record['車位數'] && Number(record['車位數']) > 0;\n                const hasParkingPrice = record['車位總價'] || record['車位總價(萬)'];\n\n                if (hasParking || hasParkingPrice) {\n                    // Normalize units\n                    const price = record['車位總價']\n                        ? Number(record['車位總價'])\n                        : (record['車位總價(萬)'] ? Number(record['車位總價(萬)']) * 10000 : 0);\n\n                    const area = record['車位總面積']\n                        ? Number(record['車位總面積'])\n                        : (record['車位面積'] ? Number(record['車位面積']) : 0);\n\n                    combinedResults.push({\n                        '車位類別': record['車位類別'] || '無資料',\n                        '車位價格': price,\n                        '車位面積': area,\n                        '車位樓層': '-', // Main record does not have specific parking floor info\n                        '車位價格(萬)': record['車位總價(萬)'] || (price / 10000),\n                        '車位面積(坪)': record['車位面積(坪)'] || (area / 3.30579).toFixed(2),\n                        '編號': record['編號'],\n                        _category: '車位資料(來自交易明細)'\n                    });\n                }\n            }\n\n            setSubTableData(combinedResults);\n\n        } catch (err) {\n            console.error(err);\n\n            // Fallback on error too\n            const hasParking = record['車位數'] && Number(record['車位數']) > 0;\n            if (hasParking) {\n                const price = record['車位總價'] ? Number(record['車位總價']) : (record['車位總價(萬)'] ? Number(record['車位總價(萬)']) * 10000 : 0);\n                setSubTableData([{\n                    '車位類別': record['車位類別'] || '無資料',\n                    '車位價格': price,\n                    '車位面積': record['車位總面積'] || 0,\n                    '編號': record['編號'],\n                    _category: '車位資料(來自交易明細)'\n                }]);\n            } else {\n                setSubTableData([]);\n            }\n        } finally {\n            setSubTableLoading(false);\n        }\n    };\n\n    // Summary fields - first level display (sortable)\n    const summaryFields = [\n        { key: '行政區', label: '行政區', sortable: true },\n        { key: '建案名稱', label: '建案名稱', sortable: true },\n        { key: '交易日', label: '交易日', sortable: true },\n        { key: '交易筆棟數', label: '交易筆棟數', sortable: false },\n        { key: '主要用途', label: '主要用途', sortable: false },\n        { key: '建物型態', label: '建物型態', sortable: false },\n        { key: '戶型', label: '戶型', sortable: true },\n        { key: '樓層', label: '樓層', sortable: true },\n        { key: '房屋面積(坪)', label: '坪數', sortable: true },\n        { key: '房屋單價(萬)', label: '單價', sortable: true },\n    ];\n\n    // Detail fields - second level display\n    const detailFields = [\n        '編號', '地址', '總樓層', '交易總價(萬)',\n        '房屋總價(萬)', '車位總價(萬)',\n        '房數', '廳數', '衛浴數', '備註', '解約情形',\n        '戶別', '主要用途', '建物型態', '車位類別', '車位價格', '車位面積',\n        '主建物面積', '附屬建物面積', '陽台面積'\n    ];\n\n    const toggleRowExpand = (index: number) => {\n        setExpandedRows(prev => {\n            const newSet = new Set(prev);\n            if (newSet.has(index)) {\n                newSet.delete(index);\n            } else {\n                newSet.add(index);\n            }\n            return newSet;\n        });\n    };\n\n    const formatValue = (value: any): string => {\n        if (value === null || value === undefined || value === '') return '-';\n        if (typeof value === 'number') {\n            return Number.isInteger(value) ? value.toLocaleString() : value.toFixed(2);\n        }\n        return String(value);\n    };\n\n    // Sorting logic\n    const handleSort = (key: string) => {\n        setSortConfig(prev => {\n            if (prev.key === key) {\n                // Cycle: asc -> desc -> null\n                if (prev.direction === 'asc') return { key, direction: 'desc' };\n                if (prev.direction === 'desc') return { key: '', direction: null };\n            }\n            return { key, direction: 'asc' };\n        });\n        setCurrentPage(1);\n    };\n\n    // Filter and sort data\n    const processedData = useMemo(() => {\n        let result = [...dataList];\n\n        // Filter by search query\n        if (searchQuery.trim()) {\n            const query = searchQuery.toLowerCase();\n            result = result.filter(record => {\n                const fieldValue = record[filterField];\n                if (fieldValue === null || fieldValue === undefined) return false;\n                return String(fieldValue).toLowerCase().includes(query);\n            });\n        }\n\n        // Sort\n        if (sortConfig.key && sortConfig.direction) {\n            result.sort((a, b) => {\n                const aVal = a[sortConfig.key];\n                const bVal = b[sortConfig.key];\n\n                // Handle nulls\n                if (aVal == null && bVal == null) return 0;\n                if (aVal == null) return 1;\n                if (bVal == null) return -1;\n\n                // Numeric comparison\n                if (typeof aVal === 'number' && typeof bVal === 'number') {\n                    return sortConfig.direction === 'asc' ? aVal - bVal : bVal - aVal;\n                }\n\n                // String comparison\n                const aStr = String(aVal);\n                const bStr = String(bVal);\n                return sortConfig.direction === 'asc'\n                    ? aStr.localeCompare(bStr, 'zh-TW')\n                    : bStr.localeCompare(aStr, 'zh-TW');\n            });\n        }\n\n        return result;\n    }, [dataList, searchQuery, filterField, sortConfig]);\n\n    const totalPages = Math.ceil(processedData.length / pageSize);\n    const startIndex = (currentPage - 1) * pageSize;\n    const endIndex = startIndex + pageSize;\n    const currentRecords = processedData.slice(startIndex, endIndex);\n\n    // Render sort icon\n    const renderSortIcon = (key: string) => {\n        if (sortConfig.key !== key) {\n            return <ArrowUpDown size={12} className=\"opacity-30 group-hover:opacity-70\" />;\n        }\n        if (sortConfig.direction === 'asc') {\n            return <ChevronUp size={12} className=\"text-violet-400\" />;\n        }\n        return <ChevronDown size={12} className=\"text-violet-400\" />;\n    };\n\n    if (isLoading) {\n        return (\n            <div className=\"flex flex-col items-center justify-center py-20\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-violet-500 mb-2\" />\n                <p className=\"text-zinc-500 text-sm\">正在載入交易資料相關明細...</p>\n            </div>\n        );\n    }\n\n    if (error) {\n        return (\n            <div className=\"text-center p-12 text-red-400\">\n                <p>載入失敗: {error}</p>\n                <button onClick={() => fetchByType()} className=\"mt-4 px-4 py-2 bg-zinc-800 rounded hover:bg-zinc-700\">重試</button>\n            </div>\n        );\n    }\n\n    if (!dataList || dataList.length === 0) {\n        return (\n            <div className=\"text-center p-12 text-zinc-500\">\n                無交易資料可顯示\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500\">\n            {/* Search and Filter Bar */}\n            <div className=\"flex flex-wrap gap-3 items-center p-3 bg-zinc-900/50 rounded-lg border border-white/5\">\n                <div className=\"flex items-center gap-2 flex-1 min-w-[200px]\">\n                    <Search size={16} className=\"text-zinc-500\" />\n                    <input\n                        type=\"text\"\n                        value={searchQuery}\n                        onChange={(e) => { setSearchQuery(e.target.value); setCurrentPage(1); }}\n                        placeholder={`搜尋 ${filterField}...`}\n                        className=\"flex-1 bg-transparent border-none outline-none text-white placeholder-zinc-500 text-sm\"\n                    />\n                    {searchQuery && (\n                        <button onClick={() => setSearchQuery('')} className=\"text-zinc-500 hover:text-white\">\n                            <X size={14} />\n                        </button>\n                    )}\n                </div>\n                <select\n                    value={filterField}\n                    onChange={(e) => setFilterField(e.target.value)}\n                    className=\"bg-zinc-800 border border-zinc-700 rounded px-2 py-1 text-sm text-zinc-300\"\n                >\n                    <option value=\"建案名稱\">建案名稱</option>\n                    <option value=\"行政區\">行政區</option>\n                    <option value=\"戶型\">戶型</option>\n                    <option value=\"主要用途\">主要用途</option>\n                </select>\n            </div>\n\n            {/* Summary Bar */}\n            <div className=\"flex justify-between items-center text-sm text-zinc-400\">\n                <span>共 <span className=\"text-white font-semibold\">{processedData.length.toLocaleString()}</span> 筆資料 {searchQuery && <span className=\"text-zinc-500\">(已篩選)</span>}</span>\n                <span>第 {currentPage} / {totalPages || 1} 頁</span>\n            </div>\n\n            {/* Data Table */}\n            <ReportWrapper title=\"交易資料明細\" description=\"點擊表頭可排序，點擊「明細」可展開詳細資訊\">\n                <div className=\"overflow-x-auto\">\n                    <table className=\"w-full text-sm text-left\">\n                        <thead className=\"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold sticky top-0\">\n                            <tr>\n                                <th className=\"px-3 py-3 w-28 text-center\">操作</th>\n                                {summaryFields.map(field => (\n                                    <th\n                                        key={field.key}\n                                        className={cn(\n                                            \"px-3 py-3 whitespace-nowrap\",\n                                            field.sortable && \"cursor-pointer select-none group hover:text-white transition-colors\"\n                                        )}\n                                        onClick={() => field.sortable && handleSort(field.key)}\n                                    >\n                                        <div className=\"flex items-center gap-1\">\n                                            {field.label}\n                                            {field.sortable && renderSortIcon(field.key)}\n                                        </div>\n                                    </th>\n                                ))}\n                            </tr>\n                        </thead>\n                        <tbody className=\"divide-y divide-white/5\">\n                            {currentRecords.map((record, idx) => {\n                                const globalIndex = startIndex + idx;\n                                const isExpanded = expandedRows.has(globalIndex);\n\n                                return (\n                                    <React.Fragment key={globalIndex}>\n                                        {/* Summary Row */}\n                                        <tr className={cn(\n                                            \"hover:bg-zinc-800/50 transition-colors\",\n                                            isExpanded && \"bg-zinc-800/30\"\n                                        )}>\n                                            <td className=\"px-3 py-2\">\n                                                <div className=\"flex items-center gap-2 justify-center\">\n                                                    <button\n                                                        onClick={() => handleFetchSubTable(record)}\n                                                        className=\"px-2 py-1 rounded text-xs font-medium bg-cyan-900/30 text-cyan-400 hover:bg-cyan-900/50 hover:text-cyan-300 transition-colors flex items-center gap-1 border border-cyan-800/50\"\n                                                        title=\"查看車位或其他附表資料\"\n                                                    >\n                                                        <Table2 size={12} />\n                                                        附表\n                                                    </button>\n                                                    <button\n                                                        onClick={() => toggleRowExpand(globalIndex)}\n                                                        className={cn(\n                                                            \"flex items-center gap-1 px-2 py-1 rounded text-xs font-medium transition-colors border\",\n                                                            isExpanded\n                                                                ? \"bg-violet-500/20 text-violet-300 border-violet-500/30\"\n                                                                : \"bg-zinc-800 text-zinc-400 border-zinc-700 hover:bg-zinc-700 hover:text-zinc-200\"\n                                                        )}\n                                                    >\n                                                        {isExpanded ? <ChevronUp size={12} /> : <ChevronDown size={12} />}\n                                                        明細\n                                                    </button>\n                                                </div>\n                                            </td>\n                                            {summaryFields.map(field => (\n                                                <td key={field.key} className=\"px-3 py-2 whitespace-nowrap\">\n                                                    {field.key === '戶型' ? (\n                                                        <span\n                                                            className=\"cursor-help border-b border-dotted border-zinc-600\"\n                                                            title={`原始戶別: ${record['戶別'] || '無資料'}`}\n                                                        >\n                                                            {formatValue(record[field.key])}\n                                                        </span>\n                                                    ) : (\n                                                        <span className={cn(\n                                                            field.key === '房屋單價(萬)' && \"font-mono text-violet-400\",\n                                                            field.key === '建案名稱' && \"font-medium text-white\"\n                                                        )}>\n                                                            {formatValue(record[field.key])}\n                                                        </span>\n                                                    )}\n                                                </td>\n                                            ))}\n                                        </tr>\n\n                                        {/* Detail Row (Expandable) */}\n                                        {isExpanded && (\n                                            <tr className=\"bg-zinc-900/50\">\n                                                <td colSpan={summaryFields.length + 1} className=\"px-4 py-4\">\n                                                    <div className=\"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3\">\n                                                        {detailFields.map(field => {\n                                                            if (!(field in record)) return null;\n                                                            return (\n                                                                <div key={field} className=\"bg-zinc-800/50 rounded p-2\">\n                                                                    <div className=\"text-xs text-zinc-500 mb-1\">{field}</div>\n                                                                    <div className=\"text-sm text-zinc-200 font-mono\">\n                                                                        {formatValue(record[field])}\n                                                                    </div>\n                                                                </div>\n                                                            );\n                                                        })}\n                                                    </div>\n                                                </td>\n                                            </tr>\n                                        )}\n                                    </React.Fragment>\n                                );\n                            })}\n                            {currentRecords.length === 0 && (\n                                <tr>\n                                    <td colSpan={summaryFields.length + 1} className=\"text-center py-8 text-zinc-500\">\n                                        無符合條件的資料\n                                    </td>\n                                </tr>\n                            )}\n                        </tbody>\n                    </table>\n                </div>\n            </ReportWrapper>\n\n            {/* Pagination Controls */}\n            <div className=\"flex justify-between items-center pt-4 border-t border-white/5\">\n                <div className=\"text-sm text-zinc-500\">\n                    顯示第 {processedData.length > 0 ? startIndex + 1 : 0} - {Math.min(endIndex, processedData.length)} 筆\n                </div>\n                <div className=\"flex items-center gap-2\">\n                    <button\n                        onClick={() => setCurrentPage(p => Math.max(1, p - 1))}\n                        disabled={currentPage === 1}\n                        className=\"p-2 rounded bg-zinc-800 text-zinc-300 hover:bg-zinc-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n                    >\n                        <ChevronLeft size={16} />\n                    </button>\n\n                    {/* Page numbers */}\n                    <div className=\"flex gap-1\">\n                        {Array.from({ length: Math.min(5, totalPages || 1) }, (_, i) => {\n                            let pageNum: number;\n                            const pages = totalPages || 1;\n                            if (pages <= 5) {\n                                pageNum = i + 1;\n                            } else if (currentPage <= 3) {\n                                pageNum = i + 1;\n                            } else if (currentPage >= pages - 2) {\n                                pageNum = pages - 4 + i;\n                            } else {\n                                pageNum = currentPage - 2 + i;\n                            }\n\n                            if (pageNum < 1 || pageNum > pages) return null;\n\n                            return (\n                                <button\n                                    key={pageNum}\n                                    onClick={() => setCurrentPage(pageNum)}\n                                    className={cn(\n                                        \"w-8 h-8 rounded text-sm font-medium transition-colors\",\n                                        currentPage === pageNum\n                                            ? \"bg-violet-500 text-white\"\n                                            : \"bg-zinc-800 text-zinc-400 hover:bg-zinc-700\"\n                                    )}\n                                >\n                                    {pageNum}\n                                </button>\n                            );\n                        })}\n                    </div>\n\n                    <button\n                        onClick={() => setCurrentPage(p => Math.min(totalPages || 1, p + 1))}\n                        disabled={currentPage === totalPages || totalPages === 0}\n                        className=\"p-2 rounded bg-zinc-800 text-zinc-300 hover:bg-zinc-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n                    >\n                        <ChevronRight size={16} />\n                    </button>\n                </div>\n            </div>\n\n            {/* Sub Table Modal */}\n            <Modal\n                isOpen={isSubTableOpen}\n                onClose={() => setIsSubTableOpen(false)}\n                className=\"max-w-5xl\"\n                title={\n                    <div className=\"flex items-center gap-2\">\n                        <Table2 className=\"text-cyan-400\" />\n                        <span>{subTableTitle}</span>\n                    </div>\n                }\n            >\n                {subTableLoading ? (\n                    <div className=\"flex flex-col items-center justify-center py-12\">\n                        <Loader2 className=\"h-8 w-8 animate-spin text-cyan-400 mb-3\" />\n                        <p className=\"text-zinc-500 text-sm animate-pulse\">正在讀取附表資料...</p>\n                    </div>\n                ) : subTableData.length > 0 ? (\n                    <div className=\"space-y-4\">\n                        <div className=\"bg-zinc-800/30 rounded-lg overflow-hidden border border-white/5\">\n                            <div className=\"overflow-x-auto\">\n                                <table className=\"w-full text-sm text-left\">\n                                    <thead className=\"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold\">\n                                        <tr>\n                                            <th className=\"px-4 py-3 whitespace-nowrap bg-zinc-900 text-cyan-400\">類別</th>\n                                            {Object.keys(subTableData[0])\n                                                .filter(k =>\n                                                    k !== 'id' &&\n                                                    k !== '編號' &&\n                                                    k !== 'created_at' &&\n                                                    k !== '_category' &&\n                                                    k !== '車位價格' &&\n                                                    k !== '車位面積'\n                                                )\n                                                .map(key => (\n                                                    <th key={key} className=\"px-4 py-3 whitespace-nowrap bg-zinc-900\">{key}</th>\n                                                ))}\n                                        </tr>\n                                    </thead>\n                                    <tbody className=\"divide-y divide-white/5\">\n                                        {subTableData.map((row, idx) => (\n                                            <tr key={idx} className=\"hover:bg-zinc-800/50 transition-colors\">\n                                                <td className=\"px-4 py-3 whitespace-nowrap text-cyan-400 font-medium\">\n                                                    {row['_category'] || '附表'}\n                                                </td>\n                                                {Object.keys(row)\n                                                    .filter(k =>\n                                                        k !== 'id' &&\n                                                        k !== '編號' &&\n                                                        k !== 'created_at' &&\n                                                        k !== '_category' &&\n                                                        k !== '車位價格' &&\n                                                        k !== '車位面積'\n                                                    )\n                                                    .map(key => (\n                                                        <td key={key} className=\"px-4 py-3 whitespace-nowrap text-zinc-300\">\n                                                            {formatValue(row[key])}\n                                                        </td>\n                                                    ))}\n                                            </tr>\n                                        ))}\n                                    </tbody>\n                                </table>\n                            </div>\n                        </div>\n                        <div className=\"flex justify-end\">\n                            <button\n                                onClick={() => setIsSubTableOpen(false)}\n                                className=\"px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-sm text-white rounded transition-colors\"\n                            >\n                                關閉\n                            </button>\n                        </div>\n                    </div>\n                ) : (\n                    <div className=\"flex flex-col items-center justify-center py-12 text-zinc-500\">\n                        <div className=\"bg-zinc-800/50 p-4 rounded-full mb-3\">\n                            <Table2 size={24} className=\"opacity-20\" />\n                        </div>\n                        <p>此筆交易沒有相關附表資料</p>\n                    </div>\n                )}\n            </Modal>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 11137, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/ui/badge.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n    \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n    {\n        variants: {\n            variant: {\n                default:\n                    \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n                secondary:\n                    \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n                destructive:\n                    \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n                outline: \"text-foreground\",\n            },\n        },\n        defaultVariants: {\n            variant: \"default\",\n        },\n    }\n)\n\nexport interface BadgeProps\n    extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> { }\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n    return (\n        <div className={cn(badgeVariants({ variant }), className)} {...props} />\n    )\n}\n\nexport { Badge, badgeVariants }\n"],"names":[],"mappings":";;;;;;;AACA;AAEA;;;;AAEA,MAAM,gBAAgB,IAAA,2MAAG,EACrB,0KACA;IACI,UAAU;QACN,SAAS;YACL,SACI;YACJ,WACI;YACJ,aACI;YACJ,SAAS;QACb;IACJ;IACA,iBAAiB;QACb,SAAS;IACb;AACJ;AAOJ,SAAS,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAmB;IACvD,qBACI,kRAAC;QAAI,WAAW,IAAA,6JAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QAAa,GAAG,KAAK;;;;;;AAE5E"}},
    {"offset": {"line": 11179, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/reports/PolicyTimelineReport.tsx"],"sourcesContent":["'use client';\n\nimport React, { useMemo, useRef, useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { REAL_ESTATE_POLICIES, PolicyEvent } from '@/lib/data/policies';\nimport { cn } from '@/lib/utils';\nimport { Calendar, TrendingUp, Gavel, Landmark, Info, ZoomIn, ZoomOut, ChevronDown, ChevronUp } from 'lucide-react';\n\nimport { useFilterStore } from '@/store/useFilterStore';\n\ninterface Transaction {\n    \"交易日\": string;\n    [key: string]: any;\n}\n\ninterface PolicyTimelineReportProps {\n    data: Transaction[];\n}\n\nexport default function PolicyTimelineReport({ data }: PolicyTimelineReportProps) {\n    const filters = useFilterStore();\n    const [selectedEvent, setSelectedEvent] = useState<PolicyEvent | null>(null);\n    const [zoomLevel, setZoomLevel] = useState(1);\n    const [isDetailsExpanded, setIsDetailsExpanded] = useState(false);\n\n    // 1. Group Data by Project Name and Calculate Periods\n    const projectPeriods = useMemo(() => {\n        // user requirement: only show project tracks if user specifically filtered by project name\n        if (filters.projectNames.length === 0) return [];\n\n        if (!data || data.length === 0) return [];\n\n        const groups: Record<string, number[]> = {};\n\n        data.forEach(d => {\n            const name = d[\"建案名稱\"];\n            // Skip if name is empty\n            if (!name) return;\n\n            const time = new Date(d[\"交易日\"]).getTime();\n            if (!isNaN(time)) {\n                if (!groups[name]) groups[name] = [];\n                groups[name].push(time);\n            }\n        });\n\n        // Convert to array and Sort by Start Date\n        const periods = Object.entries(groups).map(([name, times]) => {\n            const min = Math.min(...times);\n            const max = Math.max(...times);\n            return {\n                name,\n                start: new Date(min),\n                end: new Date(max),\n                startStr: new Date(min).toISOString().slice(0, 10),\n                endStr: new Date(max).toISOString().slice(0, 10),\n                count: times.length\n            };\n        }).sort((a, b) => a.start.getTime() - b.start.getTime());\n\n        // Limit to top 10\n        return periods.slice(0, 10);\n    }, [data]);\n\n    // 2. Date Range for Timeline (Auto-zoom + Padding)\n    const timelineRange = useMemo(() => {\n        const minYear = 2012; // Hard start from 2012 (Real Estate Registration 1.0)\n        let maxYear = new Date().getFullYear() + 1;\n\n        if (projectPeriods.length > 0) {\n            const globalEnd = Math.max(...projectPeriods.map(p => p.end.getFullYear()));\n            maxYear = Math.max(maxYear, globalEnd + 1);\n        }\n\n        return {\n            start: new Date(`${minYear}-01-01`),\n            end: new Date(`${maxYear}-12-31`),\n            totalMonths: (maxYear - minYear + 1) * 12\n        };\n    }, [projectPeriods]);\n\n    const PROJECT_ROW_HEIGHT = 50;\n    const FIRST_ROW_OFFSET = 120; // Leave space for top axis and finance policies\n    const containerHeight = Math.max(450, FIRST_ROW_OFFSET + projectPeriods.length * PROJECT_ROW_HEIGHT + 100);\n\n    // Helper: Position calculation (0% - 100%)\n    const getPosition = (dateStr: string) => {\n        const date = new Date(dateStr);\n        const start = timelineRange.start.getTime();\n        const end = timelineRange.end.getTime();\n        const current = date.getTime();\n\n        // Clamp\n        if (current < start) return 0;\n        if (current > end) return 100;\n\n        return ((current - start) / (end - start)) * 100;\n    };\n\n    // Filter policies within view range\n    const visiblePolicies = useMemo(() => {\n        return REAL_ESTATE_POLICIES.filter(p => {\n            const d = new Date(p.date);\n            return d >= timelineRange.start && d <= timelineRange.end;\n        });\n    }, [timelineRange]);\n\n    const getIcon = (category: string) => {\n        switch (category) {\n            case 'finance': return <Landmark className=\"w-3 h-3 text-emerald-400\" />;\n            case 'policy': return <Gavel className=\"w-3 h-3 text-rose-400\" />;\n            default: return <Info className=\"w-3 h-3 text-blue-400\" />;\n        }\n    };\n\n    return (\n        <Card className=\"w-full bg-black/40 border-zinc-800 backdrop-blur-xl\">\n            <CardHeader>\n                <CardTitle className=\"flex items-center gap-2 text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400\">\n                    <Calendar className=\"w-6 h-6 text-cyan-500\" />\n                    房市政策時光機\n                </CardTitle>\n                <CardDescription className=\"text-zinc-400\">\n                    建案銷售期間與重大政策/金融事件的交叉比對\n                </CardDescription>\n            </CardHeader>\n            <CardContent>\n                {/* Controls & Legend */}\n                <div className=\"flex items-center justify-between mb-4 px-2\">\n                    <div className=\"flex items-center gap-4\">\n                        <div className=\"flex items-center gap-2 bg-black/20 rounded-lg p-1 border border-white/5\">\n                            <button\n                                onClick={() => setZoomLevel(prev => Math.max(0.5, prev - 0.25))}\n                                className=\"p-1.5 hover:bg-white/10 rounded-md text-zinc-400 hover:text-white transition-colors\"\n                            >\n                                <ZoomOut className=\"w-4 h-4\" />\n                            </button>\n                            <span className=\"text-xs font-mono text-zinc-500 w-12 text-center\">{(zoomLevel * 100).toFixed(0)}%</span>\n                            <button\n                                onClick={() => setZoomLevel(prev => Math.min(3, prev + 0.25))}\n                                className=\"p-1.5 hover:bg-white/10 rounded-md text-zinc-400 hover:text-white transition-colors\"\n                            >\n                                <ZoomIn className=\"w-4 h-4\" />\n                            </button>\n                        </div>\n                        <div className=\"flex items-center gap-3 text-xs text-zinc-500\">\n                            <div className=\"flex items-center gap-1.5\">\n                                <div className=\"w-2 h-2 rounded-full bg-emerald-500\" /> 金融事件\n                            </div>\n                            <div className=\"flex items-center gap-1.5\">\n                                <div className=\"w-2 h-2 rounded-full bg-rose-500\" /> 房市政策\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <div className=\"relative w-full overflow-x-auto pb-12 pt-8 hide-scrollbar\">\n                    {/* Timeline Container - Dynamic width based on zoom */}\n                    <div\n                        className=\"relative pr-20 ml-24 border-b border-zinc-800 transition-all duration-300 ease-out\"\n                        style={{\n                            minWidth: `${1200 * zoomLevel}px`,\n                            height: `${containerHeight}px`\n                        }}\n                    >\n\n                        {/* Year Markers */}\n                        <div className=\"absolute top-0 w-full h-full pointer-events-none\">\n                            {Array.from({ length: timelineRange.end.getFullYear() - timelineRange.start.getFullYear() + 1 }).map((_, i) => {\n                                const year = timelineRange.start.getFullYear() + i;\n                                const left = getPosition(`${year}-01-01`);\n                                return (\n                                    <div key={year} className=\"absolute h-full border-l border-dashed border-zinc-800/50\" style={{ left: `${left}%` }}>\n                                        <span className=\"absolute -top-6 -left-3 text-xs font-mono text-zinc-500\">{year}</span>\n                                    </div>\n                                );\n                            })}\n                        </div>\n\n                        {/* Project Duration Tracks */}\n                        {projectPeriods.map((period, index) => {\n                            // Calculate dynamic top position (Pixels)\n                            const topPx = FIRST_ROW_OFFSET + (index * PROJECT_ROW_HEIGHT);\n\n                            // Colors for distinction (cycling)\n                            const colors = [\n                                \"from-cyan-500/20 to-blue-500/20 border-cyan-500/30 text-cyan-400\",\n                                \"from-violet-500/20 to-purple-500/20 border-violet-500/30 text-violet-400\",\n                                \"from-amber-500/20 to-orange-500/20 border-amber-500/30 text-amber-400\",\n                                \"from-emerald-500/20 to-teal-500/20 border-emerald-500/30 text-emerald-400\",\n                                \"from-pink-500/20 to-rose-500/20 border-pink-500/30 text-pink-400\"\n                            ];\n                            const colorClass = colors[index % colors.length];\n\n                            return (\n                                <div\n                                    key={period.name}\n                                    className={cn(\n                                        \"absolute h-8 border-y backdrop-blur-sm z-10 flex items-center justify-center group transition-all hover:bg-white/5\",\n                                        `bg-gradient-to-r ${colorClass}`\n                                    )}\n                                    style={{\n                                        left: `${getPosition(period.startStr)}%`,\n                                        width: `${Math.max(0.5, getPosition(period.endStr) - getPosition(period.startStr))}%`,\n                                        top: `${topPx}px`\n                                    }}\n                                >\n                                    {/* Name on the Left */}\n                                    <div className=\"absolute right-full mr-2 flex items-center h-full top-0\">\n                                        <span className=\"text-[10px] font-bold text-zinc-400 whitespace-nowrap bg-black/40 px-1.5 py-0.5 rounded border border-white/5\">\n                                            {period.name}\n                                        </span>\n                                    </div>\n\n                                    {/* Tooltips */}\n                                    <div className=\"absolute -top-8 text-[10px] whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity bg-black/90 px-2 py-1 rounded border border-zinc-700 z-20 pointer-events-none\">\n                                        {period.startStr} ~ {period.endStr} ({period.count}筆)\n                                    </div>\n                                </div>\n                            );\n                        })}\n\n                        {/* Policy Events */}\n                        {visiblePolicies.map((policy, index) => {\n                            const left = getPosition(policy.date);\n                            const isHighImpact = policy.impact === 'high';\n                            // Move policies to very top and very bottom to leave room for project tracks in the middle\n                            const topPos = index % 2 === 0 ? '8%' : '85%';\n\n                            // Check if this policy falls WITHIN any of the project periods\n                            let isDuringProject = false;\n                            if (projectPeriods.length > 0) {\n                                const pDate = new Date(policy.date);\n                                isDuringProject = projectPeriods.some(period =>\n                                    pDate >= period.start && pDate <= period.end\n                                );\n                            }\n\n                            return (\n                                <div\n                                    key={policy.id}\n                                    className={cn(\n                                        \"absolute transform -translate-x-1/2 flex flex-col items-center group cursor-pointer transition-all duration-300 z-20\",\n                                        isDuringProject ? \"opacity-100 scale-110\" : \"opacity-60 hover:opacity-100 hover:scale-110\",\n                                        selectedEvent?.id === policy.id && \"scale-125 opacity-100 z-30\"\n                                    )}\n                                    style={{ left: `${left}%`, top: topPos }}\n                                    onClick={() => setSelectedEvent(policy)}\n                                >\n                                    {/* Line connector to center */}\n                                    <div className={cn(\"h-8 w-px absolute\", topPos === '8%' ? \"top-full bg-gradient-to-b\" : \"bottom-full bg-gradient-to-t\", \"from-transparent to-zinc-700\")} />\n\n                                    {/* Icon Badge */}\n                                    <div className={cn(\n                                        \"w-8 h-8 rounded-full flex items-center justify-center border shadow-[0_0_15px_rgba(0,0,0,0.5)] transition-all\",\n                                        policy.category === 'finance'\n                                            ? \"bg-emerald-950/80 border-emerald-500/50 text-emerald-400 group-hover:shadow-emerald-500/20\"\n                                            : \"bg-rose-950/80 border-rose-500/50 text-rose-400 group-hover:shadow-rose-500/20\",\n                                        isHighImpact && \"ring-2 ring-offset-2 ring-offset-black/50 ring-opacity-50\",\n                                        policy.category === 'finance' && isHighImpact ? \"ring-emerald-500\" : \"ring-rose-500\",\n                                        selectedEvent?.id === policy.id && \"ring-2 ring-white ring-offset-2 ring-offset-black\"\n                                    )}>\n                                        {getIcon(policy.category)}\n                                    </div>\n\n                                    {/* Title Label */}\n                                    <div className={cn(\n                                        \"absolute whitespace-nowrap text-[10px] px-2 py-0.5 mt-2 rounded bg-black/80 border border-zinc-700 backdrop-blur-md transition-all font-medium\",\n                                        topPos === '8%' ? \"-top-8\" : \"-bottom-8\",\n                                        isDuringProject ? \"text-white border-yellow-500/50\" : \"text-zinc-400 group-hover:text-white\",\n                                        selectedEvent?.id === policy.id && \"text-white border-white/50 bg-zinc-800\"\n                                    )}>\n                                        {policy.title}\n                                    </div>\n\n                                    {/* Date Label (Small) */}\n                                    <div className={cn(\n                                        \"absolute text-[9px] font-mono text-zinc-600\",\n                                        topPos === '8%' ? \"top-10\" : \"bottom-10\"\n                                    )}>\n                                        {policy.date}\n                                    </div>\n                                </div>\n                            );\n                        })}\n\n                    </div>\n                </div>\n\n\n                {/* Selected Event Detail Panel */}\n                {selectedEvent && (\n                    <div className=\"mt-6 mb-8 border border-zinc-700/50 bg-zinc-900/80 p-6 rounded-xl animate-in fade-in slide-in-from-top-4 shadow-2xl shadow-black/50\">\n                        <div className=\"flex flex-col gap-6\">\n                            {/* Header */}\n                            <div className=\"flex items-start justify-between border-b border-white/5 pb-4\">\n                                <div className=\"space-y-1\">\n                                    <div className=\"flex items-center gap-3\">\n                                        <Badge variant=\"outline\" className={cn(\n                                            \"text-sm px-3 py-1\",\n                                            selectedEvent.category === 'finance' ? \"bg-emerald-500/10 text-emerald-400 border-emerald-500/30\" : \"bg-rose-500/10 text-rose-400 border-rose-500/30\"\n                                        )}>\n                                            {selectedEvent.category === 'finance' ? '金融事件' : '房市政策'}\n                                        </Badge>\n                                        <span className=\"text-zinc-400 font-mono text-sm\">{selectedEvent.date}</span>\n                                    </div>\n                                    <h3 className=\"text-2xl font-bold text-white tracking-tight\">{selectedEvent.title}</h3>\n                                </div>\n                                <div className={cn(\n                                    \"px-3 py-1 rounded-full text-xs font-medium border\",\n                                    selectedEvent.impact === 'high' ? \"bg-red-500/10 text-red-400 border-red-500/30\" : \"bg-yellow-500/10 text-yellow-400 border-yellow-500/30\"\n                                )}>\n                                    影響程度: {selectedEvent.impact === 'high' ? '高' : selectedEvent.impact === 'medium' ? '中' : '低'}\n                                </div>\n                            </div>\n\n                            {/* Content Grid */}\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n                                {/* Left Column: Policy Content */}\n                                <div className=\"space-y-6\">\n                                    <div>\n                                        <h4 className=\"text-sm font-bold text-zinc-500 uppercase tracking-wider mb-2 flex items-center gap-2\">\n                                            <Info className=\"w-4 h-4\" /> 政策/事件內容\n                                        </h4>\n                                        <p className=\"text-zinc-200 text-base leading-relaxed bg-zinc-950/50 p-4 rounded-lg border border-white/5\">\n                                            {selectedEvent.description}\n                                        </p>\n                                    </div>\n                                    <div>\n                                        <h4 className=\"text-sm font-bold text-zinc-500 uppercase tracking-wider mb-2 flex items-center gap-2\">\n                                            <Gavel className=\"w-4 h-4\" /> 具體規範變革\n                                        </h4>\n                                        <div className=\"bg-zinc-950/50 p-4 rounded-lg border border-white/5 text-cyan-400 font-medium\">\n                                            {selectedEvent.change_content || \"無具體規範變更\"}\n                                        </div>\n                                    </div>\n                                </div>\n\n                                {/* Right Column: Background & Impact */}\n                                <div className=\"space-y-6\">\n                                    <div>\n                                        <h4 className=\"text-sm font-bold text-zinc-500 uppercase tracking-wider mb-2 flex items-center gap-2\">\n                                            <Landmark className=\"w-4 h-4\" /> 時代背景與金融環境\n                                        </h4>\n                                        <p className=\"text-zinc-300 text-sm leading-relaxed bg-zinc-950/30 p-4 rounded-lg border border-white/5\">\n                                            {selectedEvent.background || \"尚無背景資料\"}\n                                        </p>\n                                    </div>\n                                    <div>\n                                        <h4 className=\"text-sm font-bold text-zinc-500 uppercase tracking-wider mb-2 flex items-center gap-2\">\n                                            <TrendingUp className=\"w-4 h-4\" /> 受眾影響分析\n                                        </h4>\n                                        <div className=\"relative overflow-hidden rounded-lg border border-white/10 bg-gradient-to-br from-indigo-500/10 to-purple-500/10 p-4\">\n                                            <div className=\"absolute top-0 right-0 p-2 opacity-10\">\n                                                <TrendingUp className=\"w-24 h-24\" />\n                                            </div>\n                                            <div className=\"relative z-10\">\n                                                <p className=\"text-indigo-300 font-medium mb-2 text-xs uppercase\">影響對象: {selectedEvent.affected_scope}</p>\n                                                <p className=\"text-white text-sm leading-relaxed\">\n                                                    {selectedEvent.impact_analysis || \"尚無詳細分析\"}\n                                                </p>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            {/* Expandable Detailed Regulations */}\n                            {selectedEvent.details && selectedEvent.details.length > 0 && (\n                                <div className=\"border-t border-white/5 pt-4\">\n                                    <button\n                                        onClick={() => setIsDetailsExpanded(!isDetailsExpanded)}\n                                        className=\"flex items-center gap-2 text-sm text-zinc-400 hover:text-white transition-colors w-full justify-center py-2\"\n                                    >\n                                        {isDetailsExpanded ? (\n                                            <>\n                                                <ChevronUp className=\"w-4 h-4\" /> 收起完整規範細節\n                                            </>\n                                        ) : (\n                                            <>\n                                                <ChevronDown className=\"w-4 h-4\" /> 展開完整規範細節 ({selectedEvent.details.length} 項)\n                                            </>\n                                        )}\n                                    </button>\n\n                                    {isDetailsExpanded && (\n                                        <div className=\"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 animate-in fade-in slide-in-from-top-2\">\n                                            {selectedEvent.details.map((detail, idx) => (\n                                                <div key={idx} className=\"flex items-start gap-3 bg-black/40 p-3 rounded border border-zinc-800 text-sm text-zinc-300\">\n                                                    <span className=\"flex items-center justify-center w-5 h-5 rounded-full bg-zinc-800 text-zinc-500 text-xs shrink-0 mt-0.5\">\n                                                        {idx + 1}\n                                                    </span>\n                                                    <span>{detail}</span>\n                                                </div>\n                                            ))}\n                                        </div>\n                                    )}\n                                </div>\n                            )}\n\n                        </div>\n                    </div>\n                )}\n                <div className=\"mt-8 border-t border-zinc-800 pt-6\">\n                    <div className=\"flex items-center gap-2 mb-4\">\n                        <TrendingUp className=\"w-5 h-5 text-purple-400\" />\n                        <h3 className=\"text-lg font-bold text-zinc-200\">政策影響比較表</h3>\n                    </div>\n\n                    <div className=\"rounded-xl border border-white/10 overflow-hidden bg-black/20\">\n                        <div className=\"grid grid-cols-12 gap-4 p-4 bg-zinc-900/50 border-b border-white/5 text-xs font-bold text-zinc-400 uppercase tracking-wider\">\n                            <div className=\"col-span-2\">實施日期</div>\n                            <div className=\"col-span-3\">政策/事件名稱</div>\n                            <div className=\"col-span-4\">變革內容 (Before vs After)</div>\n                            <div className=\"col-span-3\">影響對象與範圍</div>\n                        </div>\n\n                        <div className=\"divide-y divide-white/5 max-h-[400px] overflow-y-auto custom-scrollbar\">\n                            {visiblePolicies.slice().reverse().map((policy) => { // Reverse to show latest first\n                                return (\n                                    <div\n                                        key={policy.id}\n                                        className={cn(\n                                            \"grid grid-cols-12 gap-4 p-4 text-sm transition-colors hover:bg-white/5 cursor-pointer\",\n                                            selectedEvent?.id === policy.id ? \"bg-white/10\" : \"\"\n                                        )}\n                                        onClick={() => setSelectedEvent(policy)}\n                                    >\n                                        <div className=\"col-span-2 font-mono text-zinc-500\">{policy.date}</div>\n                                        <div className=\"col-span-3 flex items-start gap-2\">\n                                            <Badge variant=\"outline\" className={cn(\n                                                \"shrink-0 mt-0.5\",\n                                                policy.category === 'finance' ? \"text-emerald-400 border-emerald-500/30\" : \"text-rose-400 border-rose-500/30\"\n                                            )}>\n                                                {policy.category === 'finance' ? '金融' : '政策'}\n                                            </Badge>\n                                            <span className={cn(\n                                                \"font-medium\",\n                                                policy.impact === 'high' ? \"text-white\" : \"text-zinc-400\"\n                                            )}>\n                                                {policy.title}\n                                            </span>\n                                        </div>\n                                        <div className=\"col-span-4 text-zinc-300\">\n                                            {policy.change_content ? (\n                                                <div className=\"flex items-center gap-2\">\n                                                    <span className=\"w-1.5 h-1.5 rounded-full bg-cyan-500 shrink-0\" />\n                                                    {policy.change_content}\n                                                </div>\n                                            ) : (\n                                                <span className=\"text-zinc-600 italic\">--</span>\n                                            )}\n                                        </div>\n                                        <div className=\"col-span-3 text-zinc-400\">\n                                            {policy.affected_scope || <span className=\"text-zinc-600 italic\">--</span>}\n                                        </div>\n                                    </div>\n                                );\n                            })}\n                        </div>\n                    </div>\n                </div>\n\n            </CardContent>\n        </Card >\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 12179, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/components/ui/tabs.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n    React.ElementRef<typeof TabsPrimitive.List>,\n    React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n    <TabsPrimitive.List\n        ref={ref}\n        className={cn(\n            \"inline-flex h-10 items-center justify-center rounded-md bg-zinc-800 p-1 text-zinc-400\",\n            className\n        )}\n        {...props}\n    />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n    React.ElementRef<typeof TabsPrimitive.Trigger>,\n    React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n    <TabsPrimitive.Trigger\n        ref={ref}\n        className={cn(\n            \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-zinc-950 data-[state=active]:text-white data-[state=active]:shadow-sm\",\n            className\n        )}\n        {...props}\n    />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n    React.ElementRef<typeof TabsPrimitive.Content>,\n    React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n    <TabsPrimitive.Content\n        ref={ref}\n        className={cn(\n            \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n            className\n        )}\n        {...props}\n    />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n"],"names":[],"mappings":";;;;;;;;;;;AAEA;AACA;AAEA;AALA;;;;;AAOA,MAAM,OAAO,4MAAkB;AAE/B,MAAM,yBAAW,uPAAgB,CAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBACxB,kRAAC,4MAAkB;QACf,KAAK;QACL,WAAW,IAAA,6JAAE,EACT,yFACA;QAEH,GAAG,KAAK;;;;;;AAGjB,SAAS,WAAW,GAAG,4MAAkB,CAAC,WAAW;AAErD,MAAM,4BAAc,uPAAgB,CAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBACxB,kRAAC,+MAAqB;QAClB,KAAK;QACL,WAAW,IAAA,6JAAE,EACT,gYACA;QAEH,GAAG,KAAK;;;;;;AAGjB,YAAY,WAAW,GAAG,+MAAqB,CAAC,WAAW;AAE3D,MAAM,4BAAc,uPAAgB,CAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBACxB,kRAAC,+MAAqB;QAClB,KAAK;QACL,WAAW,IAAA,6JAAE,EACT,mIACA;QAEH,GAAG,KAAK;;;;;;AAGjB,YAAY,WAAW,GAAG,+MAAqB,CAAC,WAAW"}}]
}