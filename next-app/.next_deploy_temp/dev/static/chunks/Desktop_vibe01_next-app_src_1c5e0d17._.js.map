{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/lib/supabase.ts"],"sourcesContent":["\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\n\nif (!supabaseUrl || !supabaseKey) {\n    console.error('Missing Supabase URL or Key');\n}\n\nexport const supabase = createClient(supabaseUrl, supabaseKey);\n"],"names":[],"mappings":";;;;AAGoB;AAFpB;;AAEA,MAAM;AACN,MAAM;AAEN;;AAIO,MAAM,WAAW,IAAA,qOAAY,EAAC,aAAa"}},
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n    return twMerge(clsx(inputs));\n}\n\nexport function formatNumber(value: number | null | undefined, decimals: number = 2): string {\n    if (value === null || value === undefined || isNaN(value)) return '-';\n    return value.toLocaleString(undefined, {\n        minimumFractionDigits: 0,\n        maximumFractionDigits: decimals\n    });\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACtC,OAAO,IAAA,6MAAO,EAAC,IAAA,oLAAI,EAAC;AACxB;AAEO,SAAS,aAAa,KAAgC,EAAE,WAAmB,CAAC;IAC/E,IAAI,UAAU,QAAQ,UAAU,aAAa,MAAM,QAAQ,OAAO;IAClE,OAAO,MAAM,cAAc,CAAC,WAAW;QACnC,uBAAuB;QACvB,uBAAuB;IAC3B;AACJ"}},
    {"offset": {"line": 50, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/lib/config.ts"],"sourcesContent":["\nexport const SUPABASE_URL = process.env.NEXT_PUBLIC_SUPABASE_URL || 'https://zxbmbbfrzbtuueysicoc.supabase.co';\nexport const SUPABASE_ANON_KEY = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || '';\n\n// Theme Colors\nexport const THEME_COLORS = {\n    'dark-bg': '#1a1d29',\n    'dark-card': '#252836',\n    'cyan-accent': '#06b6d4',\n    'purple-accent': '#8b5cf6',\n    'form-bg': '#1f2937',\n    'border-default': '#4b5563',\n    'text-light': '#e5e7eb',\n    'text-dark': '#9ca3af'\n};\n\n// API Endpoints\nconst BASE_URL = 'https://zxbmbbfrzbtuueysicoc.supabase.co/functions/v1';\nexport const API_ENDPOINTS = {\n    QUERY_DATA: `${BASE_URL}/query-data`,\n    SUB_DATA: `${BASE_URL}/query-sub-data`,\n    PROJECT_NAMES: `${BASE_URL}/query-names`,\n    RANKING_ANALYSIS: `${BASE_URL}/analyze-project-ranking`,\n    GENERATE_SHARE_LINK: `${BASE_URL}/generate-share-link`\n};\n\n// District Data\nexport const DISTRICT_DATA: Record<string, string[]> = {\n    \"臺北市\": [\"中正區\", \"大同區\", \"中山區\", \"松山區\", \"大安區\", \"萬華區\", \"信義區\", \"士林區\", \"北投區\", \"內湖區\", \"南港區\", \"文山區\"],\n    \"新北市\": [\"板橋區\", \"三重區\", \"中和區\", \"永和區\", \"新莊區\", \"新店區\", \"樹林區\", \"鶯歌區\", \"三峽區\", \"淡水區\", \"汐止區\", \"瑞芳區\", \"土城區\", \"蘆洲區\", \"五股區\", \"泰山區\", \"林口區\", \"深坑區\", \"石碇區\", \"坪林區\", \"三芝區\", \"石門區\", \"八里區\", \"平溪區\", \"雙溪區\", \"貢寮區\", \"金山區\", \"萬里區\", \"烏來區\"],\n    \"桃園市\": [\"桃園區\", \"中壢區\", \"大溪區\", \"楊梅區\", \"蘆竹區\", \"大園區\", \"龜山區\", \"八德區\", \"龍潭區\", \"平鎮區\", \"新屋區\", \"觀音區\", \"復興區\"],\n    \"臺中市\": [\"中區\", \"東區\", \"南區\", \"西區\", \"北區\", \"北屯區\", \"西屯區\", \"南屯區\", \"太平區\", \"大里區\", \"霧峰區\", \"烏日區\", \"豐原區\", \"后里區\", \"石岡區\", \"東勢區\", \"和平區\", \"新社區\", \"潭子區\", \"大雅區\", \"神岡區\", \"大肚區\", \"沙鹿區\", \"龍井區\", \"梧棲區\", \"清水區\", \"大甲區\", \"外埔區\", \"大安區\"],\n    \"臺南市\": [\"中西區\", \"東區\", \"南區\", \"北區\", \"安平區\", \"安南區\", \"永康區\", \"歸仁區\", \"新化區\", \"左鎮區\", \"玉井區\", \"楠西區\", \"南化區\", \"仁德區\", \"關廟區\", \"龍崎區\", \"官田區\", \"麻豆區\", \"佳里區\", \"西港區\", \"七股區\", \"將軍區\", \"學甲區\", \"北門區\", \"新營區\", \"後壁區\", \"白河區\", \"東山區\", \"六甲區\", \"下營區\", \"柳營區\", \"鹽水區\", \"善化區\", \"大內區\", \"山上區\", \"新市區\", \"安定區\"],\n    \"高雄市\": [\"新興區\", \"前金區\", \"苓雅區\", \"鹽埕區\", \"鼓山區\", \"旗津區\", \"前鎮區\", \"三民區\", \"楠梓區\", \"小港區\", \"左營區\", \"仁武區\", \"大社區\", \"岡山區\", \"路竹區\", \"阿蓮區\", \"田寮區\", \"燕巢區\", \"橋頭區\", \"梓官區\", \"彌陀區\", \"永安區\", \"湖內區\", \"鳳山區\", \"大寮區\", \"林園區\", \"鳥松區\", \"大樹區\", \"旗山區\", \"美濃區\", \"六龜區\", \"內門區\", \"杉林區\", \"甲仙區\", \"桃源區\", \"那瑪夏區\", \"茂林區\", \"茄萣區\"],\n    \"基隆市\": [\"仁愛區\", \"信義區\", \"中正區\", \"中山區\", \"安樂區\", \"暖暖區\", \"七堵區\"],\n    \"新竹市\": [\"東區\", \"北區\", \"香山區\"],\n    \"嘉義市\": [\"東區\", \"西區\"],\n    \"宜蘭縣\": [\"宜蘭市\", \"羅東鎮\", \"蘇澳鎮\", \"頭城鎮\", \"礁溪鄉\", \"壯圍鄉\", \"員山鄉\", \"冬山鄉\", \"五結鄉\", \"三星鄉\", \"大同鄉\", \"南澳鄉\"],\n    \"新竹縣\": [\"竹北市\", \"竹東鎮\", \"新埔鎮\", \"關西鎮\", \"湖口鄉\", \"新豐鄉\", \"芎林鄉\", \"橫山鄉\", \"北埔鄉\", \"寶山鄉\", \"峨眉鄉\", \"尖石鄉\", \"五峰鄉\"],\n    \"苗栗縣\": [\"苗栗市\", \"苑裡鎮\", \"通霄鎮\", \"竹南鎮\", \"頭份鎮\", \"後龍鎮\", \"卓蘭鎮\", \"大湖鄉\", \"公館鄉\", \"銅鑼鄉\", \"南庄鄉\", \"頭屋鄉\", \"三義鄉\", \"西湖鄉\", \"造橋鄉\", \"三灣鄉\", \"獅潭鄉\", \"泰安鄉\"],\n    \"彰化縣\": [\"彰化市\", \"鹿港鎮\", \"和美鎮\", \"線西鄉\", \"伸港鄉\", \"福興鄉\", \"秀水鄉\", \"花壇鄉\", \"芬園鄉\", \"員林鎮\", \"溪湖鎮\", \"田中鎮\", \"大村鄉\", \"埔鹽鄉\", \"埔心鄉\", \"永靖鄉\", \"社頭鄉\", \"二水鄉\", \"北斗鎮\", \"二林鎮\", \"田尾鄉\", \"埤頭鄉\", \"芳苑鄉\", \"大城鄉\", \"竹塘鄉\", \"溪州鄉\"],\n    \"南投縣\": [\"南投市\", \"埔里鎮\", \"草屯鎮\", \"竹山鎮\", \"集集鎮\", \"名間鄉\", \"鹿谷鄉\", \"中寮鄉\", \"魚池鄉\", \"國姓鄉\", \"水里鄉\", \"信義鄉\", \"仁愛鄉\"],\n    \"雲林縣\": [\"斗六市\", \"斗南鎮\", \"虎尾鎮\", \"西螺鎮\", \"土庫鎮\", \"北港鎮\", \"古坑鄉\", \"大埤鄉\", \"莿桐鄉\", \"林內鄉\", \"二崙鄉\", \"崙背鄉\", \"麥寮鄉\", \"東勢鄉\", \"褒忠鄉\", \"台西鄉\", \"元長鄉\", \"四湖鄉\", \"口湖鄉\", \"水林鄉\"],\n    \"嘉義縣\": [\"太保市\", \"朴子市\", \"布袋鎮\", \"大林鎮\", \"民雄鄉\", \"溪口鄉\", \"新港鄉\", \"六腳鄉\", \"東石鄉\", \"義竹鄉\", \"鹿草鄉\", \"水上鄉\", \"中埔鄉\", \"竹崎鄉\", \"梅山鄉\", \"番路鄉\", \"大埔鄉\", \"阿里山鄉\"],\n    \"屏東縣\": [\"屏東市\", \"潮州鎮\", \"東港鎮\", \"恆春鎮\", \"萬丹鄉\", \"長治鄉\", \"麟洛鄉\", \"九如鄉\", \"里港鄉\", \"鹽埔鄉\", \"高樹鄉\", \"萬巒鄉\", \"內埔鄉\", \"竹田鄉\", \"新埤鄉\", \"枋寮鄉\", \"新園鄉\", \"崁頂鄉\", \"林邊鄉\", \"南州鄉\", \"佳冬鄉\", \"琉球鄉\", \"車城鄉\", \"滿州鄉\", \"枋山鄉\", \"霧台鄉\", \"瑪家鄉\", \"泰武鄉\", \"來義鄉\", \"春日鄉\", \"獅子鄉\", \"牡丹鄉\", \"三地門鄉\"],\n    \"花蓮縣\": [\"花蓮市\", \"鳳林鎮\", \"玉里鎮\", \"新城鄉\", \"吉安鄉\", \"壽豐鄉\", \"光復鄉\", \"豐濱鄉\", \"瑞穗鄉\", \"富里鄉\", \"秀林鄉\", \"萬榮鄉\", \"卓溪鄉\"],\n    \"臺東縣\": [\"臺東市\", \"成功鎮\", \"關山鎮\", \"卑南鄉\", \"鹿野鄉\", \"池上鄉\", \"東河鄉\", \"長濱鄉\", \"太麻里鄉\", \"大武鄉\", \"綠島鄉\", \"海端鄉\", \"延平鄉\", \"金峰鄉\", \"達仁鄉\", \"蘭嶼鄉\"],\n    \"澎湖縣\": [\"馬公市\", \"湖西鄉\", \"白沙鄉\", \"西嶼鄉\", \"望安鄉\", \"七美鄉\"],\n    \"金門縣\": [\"金城鎮\", \"金湖鎮\", \"金沙鄉\", \"金寧鄉\", \"烈嶼鄉\", \"烏坵鄉\"],\n    \"連江縣\": [\"南竿鄉\", \"北竿鄉\", \"莒光鄉\", \"東引鄉\"]\n};\n\nexport const COUNTY_CODE_MAP: Record<string, string> = {\n    \"臺北市\": \"A\", \"新北市\": \"F\", \"桃園市\": \"H\", \"臺中市\": \"B\", \"臺南市\": \"D\", \"高雄市\": \"E\", \"基隆市\": \"C\", \"新竹市\": \"O\", \"嘉義市\": \"I\", \"新竹縣\": \"J\", \"苗栗縣\": \"K\", \"彰化縣\": \"N\", \"南投縣\": \"M\", \"雲林縣\": \"P\", \"嘉義縣\": \"Q\", \"屏東縣\": \"T\", \"宜蘭縣\": \"G\", \"花蓮縣\": \"U\", \"臺東縣\": \"V\", \"澎湖縣\": \"X\", \"金門縣\": \"W\", \"連江縣\": \"Z\"\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAC4B;AAArB,MAAM,eAAe,gFAAwC;AAC7D,MAAM,oBAAoB,wPAA6C;AAGvE,MAAM,eAAe;IACxB,WAAW;IACX,aAAa;IACb,eAAe;IACf,iBAAiB;IACjB,WAAW;IACX,kBAAkB;IAClB,cAAc;IACd,aAAa;AACjB;AAEA,gBAAgB;AAChB,MAAM,WAAW;AACV,MAAM,gBAAgB;IACzB,YAAY,GAAG,SAAS,WAAW,CAAC;IACpC,UAAU,GAAG,SAAS,eAAe,CAAC;IACtC,eAAe,GAAG,SAAS,YAAY,CAAC;IACxC,kBAAkB,GAAG,SAAS,wBAAwB,CAAC;IACvD,qBAAqB,GAAG,SAAS,oBAAoB,CAAC;AAC1D;AAGO,MAAM,gBAA0C;IACnD,OAAO;QAAC;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;KAAM;IAC3F,OAAO;QAAC;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;KAAM;IAClN,OAAO;QAAC;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;KAAM;IAClG,OAAO;QAAC;QAAM;QAAM;QAAM;QAAM;QAAM;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;KAAM;IAC7M,OAAO;QAAC;QAAO;QAAM;QAAM;QAAM;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;KAAM;IACvQ,OAAO;QAAC;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAQ;QAAO;KAAM;IAClR,OAAO;QAAC;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;KAAM;IACxD,OAAO;QAAC;QAAM;QAAM;KAAM;IAC1B,OAAO;QAAC;QAAM;KAAK;IACnB,OAAO;QAAC;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;KAAM;IAC3F,OAAO;QAAC;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;KAAM;IAClG,OAAO;QAAC;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;KAAM;IACrI,OAAO;QAAC;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;KAAM;IAC7L,OAAO;QAAC;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;KAAM;IAClG,OAAO;QAAC;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;KAAM;IACnJ,OAAO;QAAC;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;KAAO;IACtI,OAAO;QAAC;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;KAAO;IAC/O,OAAO;QAAC;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;KAAM;IAClG,OAAO;QAAC;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;QAAQ;QAAO;QAAO;QAAO;QAAO;QAAO;QAAO;KAAM;IACxH,OAAO;QAAC;QAAO;QAAO;QAAO;QAAO;QAAO;KAAM;IACjD,OAAO;QAAC;QAAO;QAAO;QAAO;QAAO;QAAO;KAAM;IACjD,OAAO;QAAC;QAAO;QAAO;QAAO;KAAM;AACvC;AAEO,MAAM,kBAA0C;IACnD,OAAO;IAAK,OAAO;IAAK,OAAO;IAAK,OAAO;IAAK,OAAO;IAAK,OAAO;IAAK,OAAO;IAAK,OAAO;IAAK,OAAO;IAAK,OAAO;IAAK,OAAO;IAAK,OAAO;IAAK,OAAO;IAAK,OAAO;IAAK,OAAO;IAAK,OAAO;IAAK,OAAO;IAAK,OAAO;IAAK,OAAO;IAAK,OAAO;IAAK,OAAO;IAAK,OAAO;AACvQ"}},
    {"offset": {"line": 531, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/lib/api.ts"],"sourcesContent":["\nimport { supabase } from './supabase';\nimport { API_ENDPOINTS, SUPABASE_ANON_KEY } from './config';\nimport { FilterState, PaginationState, AnalysisResult } from '@/types';\n\nasync function getAuthHeaders() {\n    const { data: { session } } = await supabase.auth.getSession();\n\n    return {\n        'Content-Type': 'application/json',\n        'apikey': SUPABASE_ANON_KEY,\n        'Authorization': `Bearer ${session?.access_token || SUPABASE_ANON_KEY}`,\n    };\n}\n\nexport async function checkAuth() {\n    const { data: { session } } = await supabase.auth.getSession();\n    if (!session) {\n        console.log('User not logged in, but allowing access.');\n    }\n}\n\nexport async function getUser() {\n    const { data: { user } } = await supabase.auth.getUser();\n    return user;\n}\n\nexport async function signOut() {\n    const { error } = await supabase.auth.signOut();\n    if (error) {\n        console.error('Sign out failed:', error);\n        throw error;\n    }\n}\n\nexport async function fetchData(filters: FilterState, pagination?: PaginationState) {\n    const headers = await getAuthHeaders();\n\n    const response = await fetch(API_ENDPOINTS.QUERY_DATA, {\n        method: 'POST',\n        headers: headers,\n        body: JSON.stringify({ filters, pagination })\n    });\n\n    if (!response.ok) {\n        const err = await response.json().catch(() => ({ error: 'Failed to parse server response' }));\n        throw new Error(err.error || 'Fetch data failed');\n    }\n    return response.json();\n}\n\nexport async function analyzeData(filters: FilterState): Promise<AnalysisResult> {\n    const headers = await getAuthHeaders();\n\n    const response = await fetch(API_ENDPOINTS.RANKING_ANALYSIS, {\n        method: 'POST',\n        headers: headers,\n        body: JSON.stringify({ filters })\n    });\n\n    if (!response.ok) {\n        const err = await response.json().catch(() => ({ error: `Analysis request failed: ${response.status}` }));\n        throw new Error(err.error || 'Analyze data failed');\n    }\n    return response.json();\n}\n\nexport async function fetchSubData(id: string, type: string, county: string) {\n    if (!id || !type || !county) {\n        throw new Error(`Insufficient parameters: ${id}, ${type}, ${county}`);\n    }\n    const headers = await getAuthHeaders();\n\n    const response = await fetch(API_ENDPOINTS.SUB_DATA, {\n        method: 'POST',\n        headers: headers,\n        body: JSON.stringify({ id, type, county })\n    });\n\n    if (!response.ok) {\n        const err = await response.json().catch(() => ({ error: 'Failed to fetch sub data' }));\n        throw new Error(err.error || 'Fetch sub data failed');\n    }\n    return response.json();\n}\n\nexport async function fetchProjectNameSuggestions(countyCode: string, query: string, districts: string[] = []) {\n    const headers = await getAuthHeaders();\n\n    const payload = { countyCode, query, districts, detailed: true };\n    const response = await fetch(API_ENDPOINTS.PROJECT_NAMES, {\n        method: 'POST',\n        headers: headers,\n        body: JSON.stringify(payload)\n    });\n\n    if (!response.ok) throw new Error(`Server error: ${response.status}`);\n    return response.json();\n}\n\nexport async function generateShareLink(payload: any) {\n    const headers = await getAuthHeaders();\n\n    const response = await fetch(API_ENDPOINTS.GENERATE_SHARE_LINK, {\n        method: 'POST',\n        headers: headers,\n        body: JSON.stringify(payload)\n    });\n\n    if (!response.ok) {\n        const err = await response.json().catch(() => ({ error: 'Generate share link failed' }));\n        throw new Error(err.error);\n    }\n    return response.json();\n}\n\nexport const api = {\n    checkAuth,\n    getUser,\n    signOut,\n    fetchData,\n    analyzeData,\n    analyzeProjectRanking: analyzeData, // Alias\n    fetchSubData,\n    fetchProjectNameSuggestions,\n    generateShareLink\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 686, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/lib/date-utils.ts"],"sourcesContent":["\nexport const getDateRangeDates = (rangeType: string) => {\n    const end = new Date();\n    let start = new Date();\n\n    switch (rangeType) {\n        case '1q':\n            start.setMonth(end.getMonth() - 3);\n            break;\n        case '2q':\n            start.setMonth(end.getMonth() - 6);\n            break;\n        case '3q':\n            start.setMonth(end.getMonth() - 9);\n            break;\n        case '1y':\n            start.setFullYear(end.getFullYear() - 1);\n            break;\n        case 'this_year':\n            start = new Date(end.getFullYear(), 0, 1);\n            break;\n        case 'last_2_years':\n            start = new Date(end.getFullYear() - 1, 0, 1);\n            break;\n        case 'last_3_years':\n            start = new Date(end.getFullYear() - 2, 0, 1);\n            break;\n        default:\n            return { startDate: '', endDate: '' };\n    }\n\n    return {\n        startDate: start.toISOString().split('T')[0],\n        endDate: end.toISOString().split('T')[0]\n    };\n};\n"],"names":[],"mappings":";;;;AACO,MAAM,oBAAoB,CAAC;IAC9B,MAAM,MAAM,IAAI;IAChB,IAAI,QAAQ,IAAI;IAEhB,OAAQ;QACJ,KAAK;YACD,MAAM,QAAQ,CAAC,IAAI,QAAQ,KAAK;YAChC;QACJ,KAAK;YACD,MAAM,QAAQ,CAAC,IAAI,QAAQ,KAAK;YAChC;QACJ,KAAK;YACD,MAAM,QAAQ,CAAC,IAAI,QAAQ,KAAK;YAChC;QACJ,KAAK;YACD,MAAM,WAAW,CAAC,IAAI,WAAW,KAAK;YACtC;QACJ,KAAK;YACD,QAAQ,IAAI,KAAK,IAAI,WAAW,IAAI,GAAG;YACvC;QACJ,KAAK;YACD,QAAQ,IAAI,KAAK,IAAI,WAAW,KAAK,GAAG,GAAG;YAC3C;QACJ,KAAK;YACD,QAAQ,IAAI,KAAK,IAAI,WAAW,KAAK,GAAG,GAAG;YAC3C;QACJ;YACI,OAAO;gBAAE,WAAW;gBAAI,SAAS;YAAG;IAC5C;IAEA,OAAO;QACH,WAAW,MAAM,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;QAC5C,SAAS,IAAI,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;IAC5C;AACJ"}},
    {"offset": {"line": 733, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/lib/room-utils.ts"],"sourcesContent":["\n/**\n * src/lib/room-utils.ts\n * 用於前端一致地判斷房型分類的工具函數\n */\n\nexport function getRoomType(record: any): string {\n    // 為了與後端邏輯一致，也進行標準化處理\n    const normalizeString = (str: any) => {\n        if (!str) return '';\n        return String(str).normalize('NFKC').toUpperCase().replace(/\\s+/g, '');\n    };\n\n    // Support both API raw keys (Chinese) and normalized keys (CamelCase)\n    const buildingType = normalizeString(record['建物型態'] || record.buildingType);\n    const mainPurpose = normalizeString(record['主要用途'] || record.mainPurpose);\n    const unitName = normalizeString(record['戶別'] || record.unit);\n\n    const rooms = record['房數'] !== undefined ? record['房數'] : record.rooms;\n    const houseArea = record['房屋面積(坪)'] !== undefined ? parseFloat(record['房屋面積(坪)']) : parseFloat(record.houseArea || 0);\n\n    // 【新增規則】處理住宅大樓內含 'S' 的特殊店舖情況\n    if (buildingType.includes('住宅大樓') && unitName.includes('S')) {\n        return '店舖';\n    }\n\n    // 第零優先級：從「戶別」文字直接判斷 (補全關鍵字)\n    if (unitName.includes('店舖') || unitName.includes('店面') || unitName.includes('店鋪')) return '店舖';\n    if (unitName.includes('事務所') || unitName.includes('辦公')) return '辦公/事務所';\n\n    // 第一優先級：特殊商業用途 (建物型態/主要用途) (補全關鍵字)\n    if (buildingType.includes('店舖') || buildingType.includes('店面') || buildingType.includes('店鋪')) return '店舖';\n    if (buildingType.includes('工廠') || buildingType.includes('倉庫') || buildingType.includes('廠辦')) return '廠辦/工廠';\n    if (mainPurpose.includes('商業') || buildingType.includes('辦公') || buildingType.includes('事務所')) return '辦公/事務所';\n\n    // 第二優先級：特殊住宅格局 (0房)\n    const isResidentialBuilding = buildingType.includes('住宅大樓') || buildingType.includes('華廈');\n    if (isResidentialBuilding && rooms === 0) {\n        if (houseArea > 35) return '毛胚';\n        if (houseArea <= 35) return '套房';\n    }\n\n    // 第三優先級：標準住宅房型\n    if (typeof rooms === 'number' && !isNaN(rooms)) {\n        if (rooms === 1) return '1房';\n        if (rooms === 2) return '2房';\n        if (rooms === 3) return '3房';\n        if (rooms === 4) return '4房';\n        if (rooms >= 5) return '5房以上';\n    }\n\n    return '其他';\n}\n\n/**\n * 從「戶別」欄位中提取簡化的「戶型」代號\n * 例如: \"A2棟14F號\" -> \"A2\", \"B1-5F\" -> \"B1\"\n */\nexport function extractUnitType(unitName: string): string {\n    if (!unitName) return '-';\n\n    // 1. 移除 \"棟\", \"號\", \"樓\", \"F\" 等後綴及其後的內容 (如果有明確分隔)\n    // 常見格式: \"A2棟14F號\", \"A5棟10樓\", \"B1-5F\", \"T1-12F\"\n\n    let processed = unitName.trim();\n\n    // Case 1: \"A2棟...\" -> \"A2\"\n    if (processed.includes('棟')) {\n        processed = processed.split('棟')[0];\n    }\n\n    // Case 2: \"XXX號\" (通常出現在最後，且前面可能是樓層)\n    // 很多時候 \"A2棟14F號\" -> \"A2\" (已經被 Case 1 處理)\n    // 如果沒有棟，例如 \"14F-5號\" -> 可能是透天或公寓，較難處理，暫不強行截斷\n\n    // Case 3: 含有 \"-\" (通常是 戶型-樓層，如 B1-5F)\n    // 但要小心 \"B1-1\" 這種可能是戶型本身\n    // 判斷 \"-\" 後面是否為樓層 (數字+F 或 純數字)\n    if (processed.includes('-')) {\n        const parts = processed.split('-');\n        // 如果 part[1] 看起來像樓層 (5F, 12, 12F)\n        if (/^\\d+F?$/.test(parts[1])) {\n            processed = parts[0];\n        }\n    }\n\n    // Case 4: 含有樓層關鍵字但沒有明確分隔符 (比較危險，需保守)\n    // 例如 \"A1戶10樓\"\n    if (processed.includes('戶')) {\n        processed = processed.split('戶')[0];\n    }\n\n    // Advanced cleaning: 移除可能殘留的 \"F\" 如果它在末尾且前面是數字 (通常被 Case 1/3 處理了，但以防萬一)\n\n    return processed;\n}\n"],"names":[],"mappings":"AACA;;;CAGC;;;;;;AAEM,SAAS,YAAY,MAAW;IACnC,qBAAqB;IACrB,MAAM,kBAAkB,CAAC;QACrB,IAAI,CAAC,KAAK,OAAO;QACjB,OAAO,OAAO,KAAK,SAAS,CAAC,QAAQ,WAAW,GAAG,OAAO,CAAC,QAAQ;IACvE;IAEA,sEAAsE;IACtE,MAAM,eAAe,gBAAgB,MAAM,CAAC,OAAO,IAAI,OAAO,YAAY;IAC1E,MAAM,cAAc,gBAAgB,MAAM,CAAC,OAAO,IAAI,OAAO,WAAW;IACxE,MAAM,WAAW,gBAAgB,MAAM,CAAC,KAAK,IAAI,OAAO,IAAI;IAE5D,MAAM,QAAQ,MAAM,CAAC,KAAK,KAAK,YAAY,MAAM,CAAC,KAAK,GAAG,OAAO,KAAK;IACtE,MAAM,YAAY,MAAM,CAAC,UAAU,KAAK,YAAY,WAAW,MAAM,CAAC,UAAU,IAAI,WAAW,OAAO,SAAS,IAAI;IAEnH,6BAA6B;IAC7B,IAAI,aAAa,QAAQ,CAAC,WAAW,SAAS,QAAQ,CAAC,MAAM;QACzD,OAAO;IACX;IAEA,4BAA4B;IAC5B,IAAI,SAAS,QAAQ,CAAC,SAAS,SAAS,QAAQ,CAAC,SAAS,SAAS,QAAQ,CAAC,OAAO,OAAO;IAC1F,IAAI,SAAS,QAAQ,CAAC,UAAU,SAAS,QAAQ,CAAC,OAAO,OAAO;IAEhE,mCAAmC;IACnC,IAAI,aAAa,QAAQ,CAAC,SAAS,aAAa,QAAQ,CAAC,SAAS,aAAa,QAAQ,CAAC,OAAO,OAAO;IACtG,IAAI,aAAa,QAAQ,CAAC,SAAS,aAAa,QAAQ,CAAC,SAAS,aAAa,QAAQ,CAAC,OAAO,OAAO;IACtG,IAAI,YAAY,QAAQ,CAAC,SAAS,aAAa,QAAQ,CAAC,SAAS,aAAa,QAAQ,CAAC,QAAQ,OAAO;IAEtG,oBAAoB;IACpB,MAAM,wBAAwB,aAAa,QAAQ,CAAC,WAAW,aAAa,QAAQ,CAAC;IACrF,IAAI,yBAAyB,UAAU,GAAG;QACtC,IAAI,YAAY,IAAI,OAAO;QAC3B,IAAI,aAAa,IAAI,OAAO;IAChC;IAEA,eAAe;IACf,IAAI,OAAO,UAAU,YAAY,CAAC,MAAM,QAAQ;QAC5C,IAAI,UAAU,GAAG,OAAO;QACxB,IAAI,UAAU,GAAG,OAAO;QACxB,IAAI,UAAU,GAAG,OAAO;QACxB,IAAI,UAAU,GAAG,OAAO;QACxB,IAAI,SAAS,GAAG,OAAO;IAC3B;IAEA,OAAO;AACX;AAMO,SAAS,gBAAgB,QAAgB;IAC5C,IAAI,CAAC,UAAU,OAAO;IAEtB,+CAA+C;IAC/C,+CAA+C;IAE/C,IAAI,YAAY,SAAS,IAAI;IAE7B,2BAA2B;IAC3B,IAAI,UAAU,QAAQ,CAAC,MAAM;QACzB,YAAY,UAAU,KAAK,CAAC,IAAI,CAAC,EAAE;IACvC;IAEA,oCAAoC;IACpC,yCAAyC;IACzC,4CAA4C;IAE5C,qCAAqC;IACrC,wBAAwB;IACxB,8BAA8B;IAC9B,IAAI,UAAU,QAAQ,CAAC,MAAM;QACzB,MAAM,QAAQ,UAAU,KAAK,CAAC;QAC9B,kCAAkC;QAClC,IAAI,UAAU,IAAI,CAAC,KAAK,CAAC,EAAE,GAAG;YAC1B,YAAY,KAAK,CAAC,EAAE;QACxB;IACJ;IAEA,qCAAqC;IACrC,cAAc;IACd,IAAI,UAAU,QAAQ,CAAC,MAAM;QACzB,YAAY,UAAU,KAAK,CAAC,IAAI,CAAC,EAAE;IACvC;IAEA,uEAAuE;IAEvE,OAAO;AACX"}},
    {"offset": {"line": 818, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/lib/unit-parser.ts"],"sourcesContent":["// 檔案路徑: supabase/functions/_shared/unit-parser.ts\n\n/**\n * @file 自適應戶別解析系統 (Adaptive Unit Parser System) - v12.6 (新增五個使用者定義規則)\n * @description 具備自動學習能力的戶別解析系統，能夠從數據中學習新的命名模式並適應各種建案的獨特規則\n * @final-logic 系統提供初步的、基於單筆上下文的解析，最終的風格一致性校正由主分析函式完成。\n */\n\n// ===== 類型定義 =====\n\ninterface ParseResult {\n    identifier: string;\n    confidence: number;\n    method: string;\n    debug?: string;\n}\n\ninterface PatternRule {\n    id: string;\n    name: string;\n    regex: RegExp;\n    extract: (match: RegExpMatchArray, context?: ParseContext) => string;\n    confidence: number;\n    priority: number;\n    conditions?: RuleCondition[];\n}\n\ninterface RuleCondition {\n    type: 'floor_match' | 'building_match' | 'project_pattern';\n    validator: (context: ParseContext) => boolean;\n}\n\ninterface ParseContext {\n    rawUnit: string;\n    floor?: string;\n    projectName?: string;\n    buildingName?: string;\n}\n\ninterface ProjectProfile {\n    projectName: string;\n    patterns: Map<string, PatternUsage>;\n    unitMappings: Map<string, UnitInfo>;\n    namingStyle: 'consistent' | 'mixed' | 'unknown';\n    dominantPattern?: string;\n}\n\ninterface PatternUsage {\n    patternId: string;\n    count: number;\n    examples: string[];\n    confidence: number;\n}\n\ninterface UnitInfo {\n    floors: Set<string>;\n    rawVariations: Set<string>;\n    resolvedIdentifier?: string;\n}\n\n// ===== 模式偵測器 =====\n\nclass PatternDetector {\n    private knownPatterns: Map<string, PatternRule> = new Map();\n    private patternFrequency: Map<string, number> = new Map();\n\n    constructor() {\n        this.initializeBasePatterns();\n    }\n\n    private initializeBasePatterns(): void {\n        const basePatterns: PatternRule[] = [\n            // ==========================================================\n            //【使用者新增規則】\n            // 案例: A2/9F號, 樓層為 9, 應解析為 \"A2\"\n            {\n                id: 'unit_slash_floorF_format',\n                name: '戶號斜線樓層F格式',\n                regex: /^([A-Z]\\d+)\\/(\\d+)F[號号]?$/i,\n                extract: (m, ctx) => {\n                    const unitIdentifier = m[1]; // A2\n                    const floorInUnit = m[2];   // 9\n                    if (ctx?.floor && parseInt(floorInUnit, 10) === parseInt(ctx.floor, 10)) {\n                        return unitIdentifier;\n                    }\n                    return unitIdentifier + floorInUnit;\n                },\n                confidence: 100,\n                priority: 0.01 // 極高優先級\n            },\n            // 案例: C棟6-9號, 樓層為 9, 應解析為 \"C6\"\n            {\n                id: 'building_unit_floor_combined',\n                name: '棟別戶號樓層合併格式',\n                regex: /^([A-Z])棟(\\d+)-(\\d+)[號号]?$/i,\n                extract: (m, ctx) => {\n                    const buildingLetter = m[1]; // C\n                    const unitPart = m[2];       // 6\n                    const floorPart = m[3];      // 9\n                    if (ctx?.floor && parseInt(floorPart, 10) === parseInt(ctx.floor, 10)) {\n                        return buildingLetter + unitPart;\n                    }\n                    return buildingLetter + unitPart + floorPart;\n                },\n                confidence: 100,\n                priority: 0.02 // 極高優先級\n            },\n            // 案例: B棟3-2F號, 樓層為 2, 應解析為 \"B3\"\n            {\n                id: 'building_unit_floorF_format_v2',\n                name: '棟別戶號樓層F格式v2',\n                regex: /^([A-Z])棟(\\d+)-(\\d+)F[號号]?$/i,\n                extract: (m, ctx) => {\n                    const buildingLetter = m[1]; // B\n                    const unitPart = m[2];       // 3\n                    const floorPart = m[3];      // 2\n                    if (ctx?.floor && parseInt(floorPart, 10) === parseInt(ctx.floor, 10)) {\n                        return buildingLetter + unitPart;\n                    }\n                    return buildingLetter + unitPart + floorPart;\n                },\n                confidence: 100,\n                priority: 0.03 // 極高優先級\n            },\n            // 案例: C2棟0號, 樓層為 9, 應解析為 \"C2\"\n            {\n                id: 'unit_building_zero_format',\n                name: '戶號棟別0號格式',\n                regex: /^([A-Z]\\d+)棟0[號号]?$/i,\n                extract: (m) => m[1], // 直接回傳 C2\n                confidence: 100,\n                priority: 0.04 // 極高優先級\n            },\n            // 案例: A號, 應解析為 \"A\"\n            {\n                id: 'single_letter_unit',\n                name: '單字母戶號格式',\n                regex: /^([A-Z])[號号]$/i,\n                extract: (m) => m[1], // 直接回傳 A\n                confidence: 95,\n                priority: 0.045 // 高優先級，處理最簡單的模式\n            },\n            // ==========================================================\n            {\n                id: 'building_floor_unit_letter_format',\n                name: '棟別樓層數字戶型字母格式',\n                regex: /^([A-Z])棟(\\d+)([A-Z])[號号]?$/i,\n                extract: (m, ctx) => {\n                    const buildingLetter = m[1]; // e.g., 'A'\n                    const floorInUnit = parseInt(m[2], 10); // e.g., 8\n                    const unitLetter = m[3]; // e.g., 'A'\n\n                    // 如果戶別中的樓層與上下文樓層相符，則回傳戶型字母\n                    if (ctx?.floor && floorInUnit === parseInt(ctx.floor, 10)) {\n                        return unitLetter; // 期望結果為 \"A\"\n                    }\n                    // 如果樓層不符或沒有上下文樓層，則回傳組合，以便於除錯或進一步判斷\n                    return `${buildingLetter}${floorInUnit}${unitLetter}`;\n                },\n                confidence: 99,\n                priority: 0.05 // 給予高優先級，以確保此特定模式能被優先匹配\n            },\n            {\n                id: 'building_floor_unit_format',\n                name: '棟別樓層戶號格式',\n                regex: /^([A-Z])棟(\\d{1,2})F-(\\d+)[號号]?$/,\n                extract: (m, ctx) => {\n                    const buildingLetter = m[1];\n                    const floorInUnit = m[2];\n                    const unitNumber = m[3];\n                    if (ctx?.floor && parseInt(floorInUnit, 10) === parseInt(ctx.floor, 10)) {\n                        return buildingLetter + unitNumber;\n                    }\n                    return buildingLetter + floorInUnit + unitNumber;\n                },\n                confidence: 99,\n                priority: 0.1\n            },\n            {\n                id: 'letter_number_floor_format',\n                name: '字母數字-樓層F格式',\n                regex: /^([A-Z])0*(\\d+)-(\\d{1,2})F[號号]?$/,\n                extract: (m, ctx) => {\n                    const buildingLetter = m[1];\n                    const unitNumber = m[2];\n                    const floorInUnit = m[3];\n                    if (ctx?.floor && parseInt(floorInUnit, 10) === parseInt(ctx.floor, 10)) {\n                        return buildingLetter + unitNumber;\n                    }\n                    return buildingLetter + unitNumber + floorInUnit;\n                },\n                confidence: 99,\n                priority: 0.15\n            },\n            {\n                id: 'identifier_building_floor_redundant',\n                name: '識別碼棟與F樓層格式(贅余樓層)',\n                // 案例: \"A01棟F02號\", 樓層為 2, 應解析為 \"A1\"\n                // 【修正】: 將 \"号\" 改為 \"[號号]\" 以匹配兩種寫法\n                regex: /^([A-Z]\\d+)棟F(\\d+)[號号]?$/i,\n                extract: (m, ctx) => {\n                    const identifier = m[1]; // \"A01\"\n                    const floorInUnit = m[2]; // \"02\"\n\n                    // 提取字母和數字部分，並去除數字開頭的0\n                    const letterPart = identifier.match(/^[A-Z]+/)?.[0] || '';\n                    const numberPart = parseInt(identifier.match(/\\d+/)?.[0] || '0', 10);\n\n                    // 組合成標準化ID (\"A\" + 1 -> \"A1\")\n                    const cleanedIdentifier = `${letterPart}${numberPart}`;\n\n                    // 如果戶別中的樓層與上下文樓層相符，則視為贅余資訊，只回傳標準化ID\n                    if (ctx?.floor && parseInt(floorInUnit, 10) === parseInt(ctx.floor, 10)) {\n                        return cleanedIdentifier;\n                    }\n                    // 如果不符，則保留樓層資訊以供除錯\n                    return cleanedIdentifier + 'F' + floorInUnit;\n                },\n                confidence: 98,\n                priority: 0.18 // 優先級高，因為格式非常特定\n            },\n            {\n                id: 'identifier_building_floorF_format',\n                name: '識別碼棟與樓層F格式(贅余樓層)',\n                // 案例: \"A2棟5F號\", 樓層為 5, 應解析為 \"A2\"\n                // 【修正】: 將 \"号\" 改為 \"[號号]\" 以匹配兩種寫法\n                regex: /^([A-Z]\\d+)棟(\\d{1,2})F[號号]?$/i,\n                extract: (m, ctx) => {\n                    const identifier = m[1]; // \"A2\"\n                    const floorInUnit = m[2]; // \"5\"\n\n                    // 如果戶別中的樓層與上下文樓層相符，則只回傳識別碼\n                    if (ctx?.floor && parseInt(floorInUnit, 10) === parseInt(ctx.floor, 10)) {\n                        return identifier;\n                    }\n                    // 如果不符，則保留樓層資訊\n                    return identifier + floorInUnit;\n                },\n                confidence: 98,\n                priority: 0.19 // 優先級高，緊跟上一條規則\n            },\n            {\n                id: 'unit_building_floor_format',\n                name: '戶棟樓層格式',\n                regex: /^([A-Z]\\d+)戶棟(\\d+)F[號号]?$/,\n                extract: (m, ctx) => {\n                    const unitIdentifier = m[1];\n                    const floorInUnit = m[2];\n                    if (ctx?.floor && parseInt(floorInUnit, 10) === parseInt(ctx.floor, 10)) {\n                        return unitIdentifier;\n                    }\n                    return unitIdentifier + floorInUnit;\n                },\n                confidence: 99,\n                priority: 0.2\n            },\n            {\n                id: 'building_sub_unit_floor_format',\n                name: '棟別子戶號樓層格式',\n                regex: /^([A-Z])棟(\\d+)-(\\d+)F[號号]?$/,\n                extract: (m, ctx) => {\n                    const buildingLetter = m[1];\n                    const subUnitNumber = m[2];\n                    const floorInUnit = m[3];\n\n                    if (ctx?.floor && parseInt(floorInUnit, 10) === parseInt(ctx.floor, 10)) {\n                        return buildingLetter + subUnitNumber;\n                    }\n                    return buildingLetter + subUnitNumber + floorInUnit;\n                },\n                confidence: 99,\n                priority: 0.3\n            },\n            {\n                id: 'building_unit_floor_format',\n                name: '棟別戶別樓層格式',\n                regex: /^([A-Z])棟([A-Z])-(\\d{1,2})F[號号]?$/,\n                extract: (m, ctx) => {\n                    const unitLetter = m[2];\n                    const floorInUnit = m[3];\n                    if (ctx?.floor && parseInt(floorInUnit, 10) === parseInt(ctx.floor, 10)) {\n                        return unitLetter;\n                    }\n                    return unitLetter + floorInUnit;\n                },\n                confidence: 99,\n                priority: 0.4\n            },\n            {\n                id: 'building_self_unit_floor_format',\n                name: '棟別自身戶號樓層格式',\n                regex: /^([A-Z])棟\\1-(\\d+)[號号]?$/,\n                extract: (m, ctx) => {\n                    const unitLetter = m[1];\n                    const floorInUnit = m[2];\n                    if (ctx?.floor && parseInt(floorInUnit, 10) === parseInt(ctx.floor, 10)) {\n                        return unitLetter;\n                    }\n                    return unitLetter + floorInUnit;\n                },\n                confidence: 98,\n                priority: 0.45\n            },\n            {\n                id: 'building_unit_letter_floor_number',\n                name: '棟別戶號字母樓層數字格式',\n                regex: /^([A-Z])棟([A-Z])(\\d{1,2})[號号]?$/,\n                extract: (m, ctx) => {\n                    const unitLetter = m[2];\n                    const floorInUnit = m[3];\n                    if (ctx?.floor && parseInt(floorInUnit, 10) === parseInt(ctx.floor, 10)) {\n                        return unitLetter;\n                    }\n                    return unitLetter + floorInUnit;\n                },\n                confidence: 98,\n                priority: 0.46\n            },\n            {\n                id: 'redundant_building_format',\n                name: '重複棟別格式',\n                regex: /^([A-Z])棟\\1-(\\d{1,2})F[號号]?$/,\n                extract: (m, ctx) => {\n                    const buildingLetter = m[1];\n                    const floorInUnit = m[2];\n                    if (ctx?.floor && parseInt(floorInUnit, 10) === parseInt(ctx.floor, 10)) {\n                        return buildingLetter;\n                    }\n                    return buildingLetter + floorInUnit;\n                },\n                confidence: 98,\n                priority: 0.5\n            },\n            {\n                id: 'building_floor_letter_unit',\n                name: '棟別樓層字母戶號格式',\n                regex: /^[A-Z]棟(\\d{1,2})F-([A-Z])[號号]?$/,\n                extract: (m, ctx) => {\n                    const floorInUnit = m[1];\n                    const unitLetter = m[2];\n                    if (ctx?.floor && parseInt(floorInUnit, 10) === parseInt(ctx.floor, 10)) {\n                        return unitLetter;\n                    }\n                    return unitLetter + floorInUnit;\n                },\n                confidence: 98,\n                priority: 0.6\n            },\n            {\n                id: 'letter_leading_zero_unit',\n                name: '字母與0開頭數字戶號',\n                regex: /^([A-Z])0+(\\d+)[號号]?$/,\n                extract: (m) => m[1] + m[2],\n                confidence: 97,\n                priority: 0.7\n            },\n            {\n                id: 'floor_prefix_format',\n                name: '樓層前綴格式',\n                regex: /^(\\d{1,2})([A-Z])[號号]?$/,\n                extract: (m, ctx) => {\n                    const floorInUnit = m[1];\n                    const letterPart = m[2];\n                    if (ctx?.floor && parseInt(floorInUnit, 10) === parseInt(ctx.floor, 10)) {\n                        return letterPart;\n                    }\n                    return floorInUnit + letterPart;\n                },\n                confidence: 96,\n                priority: 0.8\n            },\n            {\n                id: 'floorF_building_unit_format',\n                name: '樓層F棟戶號格式',\n                regex: /^(\\d{1,2})F棟([A-Z])[號号]?$/,\n                extract: (m, ctx) => {\n                    const floorInUnit = m[1];\n                    const unitLetter = m[2];\n                    if (ctx?.floor && parseInt(floorInUnit, 10) === parseInt(ctx.floor, 10)) {\n                        return unitLetter;\n                    }\n                    return floorInUnit + unitLetter;\n                },\n                confidence: 98,\n                priority: 0.85\n            },\n            {\n                id: 'numericBuilding_floor_unit_format',\n                name: '數字棟別樓層戶號格式',\n                regex: /^(\\d+)棟(\\d{1,2})([A-Z])[號号]?$/,\n                extract: (m, ctx) => {\n                    const floorInUnit = m[2];\n                    const unitLetter = m[3];\n                    if (ctx?.floor && parseInt(floorInUnit, 10) === parseInt(ctx.floor, 10)) {\n                        return unitLetter;\n                    }\n                    return floorInUnit + unitLetter;\n                },\n                confidence: 98,\n                priority: 0.86\n            },\n            {\n                id: 'floor_first_detailed',\n                name: '樓層優先詳細格式',\n                regex: /(\\d{1,2})F-([A-Z])(\\d{2})/,\n                extract: (m) => m[2] + m[3],\n                confidence: 95,\n                priority: 1\n            },\n            {\n                id: 'floor_prefix_complex_unit',\n                name: '樓層前綴複合戶號',\n                regex: /^(\\d{1,2})F-([A-Z]\\d+)[號号]?$/,\n                extract: (m, ctx) => {\n                    const floorInUnit = m[1];\n                    const unitIdentifier = m[2];\n                    if (ctx?.floor && parseInt(floorInUnit, 10) === parseInt(ctx.floor, 10)) {\n                        return unitIdentifier;\n                    }\n                    return floorInUnit + unitIdentifier;\n                },\n                confidence: 94,\n                priority: 1.2\n            },\n            {\n                id: 'floor_first_simple_letter',\n                name: '樓層優先簡單字母格式',\n                regex: /^(\\d{1,2})F-([A-Z])[號号]?$/,\n                extract: (match: RegExpMatchArray, context?: ParseContext) => {\n                    const floorInUnit = match[1];\n                    const unitLetter = match[2];\n                    if (context?.floor && parseInt(floorInUnit, 10) === parseInt(context.floor, 10)) {\n                        return unitLetter;\n                    } else {\n                        return floorInUnit + unitLetter;\n                    }\n                },\n                confidence: 90,\n                priority: 1.5\n            },\n            {\n                id: 'building_with_unit',\n                name: '棟別完整戶號',\n                regex: /([A-Z])棟([A-Z])(\\d{1,2})(?:-(\\d{1,2})F?[號号])?/,\n                extract: (m) => m[2] + m[3],\n                confidence: 90,\n                priority: 2,\n                conditions: [{\n                    type: 'building_match',\n                    validator: (ctx) => {\n                        const match = ctx.rawUnit.match(/([A-Z])棟([A-Z])/);\n                        return match ? match[1] === match[2] : false;\n                    }\n                }]\n            },\n            {\n                id: 'building_simple_letter_unit',\n                name: '棟別字母戶號格式',\n                regex: /^[A-Z]棟([A-Z])[號号]?$/,\n                extract: (m) => m[1],\n                confidence: 92,\n                priority: 2.5\n            },\n            {\n                id: 'unit_floor_suffix',\n                name: '戶號樓層後綴',\n                regex: /([A-Z]\\d{1,2})-(\\d{1,2})F?[號号]?/,\n                extract: (m) => m[1],\n                confidence: 85,\n                priority: 3\n            },\n            {\n                id: 'building_floor_format',\n                name: '棟別樓層格式',\n                regex: /^([A-Z]\\d{1,2})棟(\\d{1,2})(?:F|樓)[號号]?$/,\n                extract: (m, ctx) => {\n                    const unitIdentifier = m[1];\n                    const floorInUnit = m[2];\n                    if (ctx?.floor && parseInt(floorInUnit, 10) === parseInt(ctx.floor, 10)) {\n                        return unitIdentifier;\n                    }\n                    return unitIdentifier + floorInUnit;\n                },\n                confidence: 88,\n                priority: 3.5\n            },\n            {\n                id: 'building_complex_number',\n                name: '複合棟別編號',\n                regex: /^([A-Z]\\d+)棟(\\d+)[號号]$/,\n                extract: (m, ctx) => {\n                    const unitIdentifier = m[1];\n                    const floorInUnit = m[2];\n                    if (ctx?.floor && parseInt(floorInUnit, 10) === parseInt(ctx.floor, 10)) {\n                        return unitIdentifier;\n                    }\n                    return unitIdentifier + floorInUnit;\n                },\n                confidence: 86,\n                priority: 3.8\n            },\n            {\n                id: 'building_floor_F_format',\n                name: '棟別樓層F格式',\n                regex: /^([A-Z])棟(\\d{1,2})F[號号]?$/,\n                extract: (m, ctx) => {\n                    const letterPart = m[1];\n                    const floorInUnit = m[2];\n                    if (ctx?.floor && parseInt(floorInUnit, 10) === parseInt(ctx.floor, 10)) {\n                        return letterPart;\n                    }\n                    return letterPart + floorInUnit;\n                },\n                confidence: 87,\n                priority: 3.9\n            },\n            {\n                id: 'building_zero_placeholder_unit',\n                name: '棟別0號佔位符格式',\n                regex: /^([A-Z])棟0[號号]?$/,\n                extract: (m) => m[1],\n                confidence: 95,\n                priority: 3.95\n            },\n            {\n                id: 'building_simple_number',\n                name: '棟別簡單編號',\n                regex: /([A-Z])棟(\\d{1,2})[號号]/,\n                extract: (match: RegExpMatchArray, context?: ParseContext) => {\n                    const buildingLetter = match[1];\n                    const unitNumber = match[2];\n                    if (context?.floor && parseInt(unitNumber, 10) === parseInt(context.floor, 10)) {\n                        return buildingLetter;\n                    } else {\n                        return buildingLetter + unitNumber;\n                    }\n                },\n                confidence: 85,\n                priority: 4\n            },\n            {\n                id: 'unit_floor_concatenated',\n                name: '複合戶號樓層格式',\n                regex: /^([A-Z])(\\d+)F[號号]?$/,\n                extract: (m, ctx) => {\n                    const letterPart = m[1];\n                    const numberPart = m[2];\n                    const floorStr = ctx?.floor;\n\n                    if (floorStr) {\n                        const floorInt = parseInt(floorStr, 10);\n                        if (!isNaN(floorInt)) {\n                            if (floorInt < 10) {\n                                const paddedFloor = '0' + floorStr;\n                                if (numberPart.endsWith(paddedFloor)) {\n                                    const unitNumber = numberPart.substring(0, numberPart.length - 2);\n                                    return letterPart + unitNumber;\n                                }\n                            }\n                            if (numberPart.endsWith(floorStr)) {\n                                const unitNumber = numberPart.substring(0, numberPart.length - floorStr.length);\n                                return letterPart + unitNumber;\n                            }\n                        }\n                    }\n                    return letterPart + numberPart;\n                },\n                confidence: 80,\n                priority: 4.5\n            },\n            {\n                id: 'letter_floor',\n                name: '字母樓層格式',\n                regex: /^([A-Z])-(\\d{1,2})F?[號号]?$/,\n                extract: (m, ctx) => {\n                    const floorInUnit = m[2];\n                    if (ctx?.floor && parseInt(floorInUnit, 10) === parseInt(ctx.floor, 10)) {\n                        return m[1];\n                    }\n                    return m[1] + floorInUnit;\n                },\n                confidence: 70,\n                priority: 5\n            }\n        ];\n\n        basePatterns.forEach(pattern => {\n            this.knownPatterns.set(pattern.id, pattern);\n        });\n    }\n\n    public detectPattern(text: string, context?: ParseContext): { rule: PatternRule; match: RegExpMatchArray } | null {\n        const normalizedText = this.normalizeText(text);\n        let bestMatch: { rule: PatternRule; match: RegExpMatchArray } | null = null;\n\n        const sortedPatterns = Array.from(this.knownPatterns.values())\n            .sort((a, b) => a.priority - b.priority);\n\n        for (const rule of sortedPatterns) {\n            const match = normalizedText.match(rule.regex);\n            if (match) {\n                if (rule.conditions && context) {\n                    const allConditionsMet = rule.conditions.every(\n                        condition => condition.validator(context)\n                    );\n                    if (!allConditionsMet) continue;\n                }\n                bestMatch = { rule, match };\n                break;\n            }\n        }\n\n        if (bestMatch) {\n            this.patternFrequency.set(\n                bestMatch.rule.id,\n                (this.patternFrequency.get(bestMatch.rule.id) || 0) + 1\n            );\n        }\n\n        return bestMatch;\n    }\n\n    private normalizeText(text: string): string {\n        if (!text) return '';\n        return text\n            .toUpperCase()\n            .replace(/[\\uff01-\\uff5e]/g, ch => String.fromCharCode(ch.charCodeAt(0) - 0xfee0))\n            .replace(/\\s+/g, '');\n    }\n}\n\n// ===== 建案分析器 =====\n\nclass ProjectAnalyzer {\n    private projectProfiles: Map<string, ProjectProfile> = new Map();\n\n    public analyzeProject(projectName: string, records: any[]): ProjectProfile {\n        const profile: ProjectProfile = {\n            projectName,\n            patterns: new Map(),\n            unitMappings: new Map(),\n            namingStyle: 'unknown'\n        };\n\n        const detector = new PatternDetector();\n\n        for (const record of records) {\n            const rawUnit = record['戶別'];\n            const floor = record['樓層'];\n\n            if (!rawUnit) continue;\n\n            const context: ParseContext = {\n                rawUnit,\n                floor: floor ? String(floor) : undefined,\n                projectName\n            };\n\n            const detectionResult = detector.detectPattern(rawUnit, context);\n\n            if (detectionResult) {\n                const pattern = detectionResult.rule;\n                if (!profile.patterns.has(pattern.id)) {\n                    profile.patterns.set(pattern.id, {\n                        patternId: pattern.id,\n                        count: 0,\n                        examples: [],\n                        confidence: pattern.confidence\n                    });\n                }\n\n                const usage = profile.patterns.get(pattern.id)!;\n                usage.count++;\n                if (usage.examples.length < 10) {\n                    usage.examples.push(rawUnit);\n                }\n            }\n\n            if (!profile.unitMappings.has(rawUnit)) {\n                profile.unitMappings.set(rawUnit, {\n                    floors: new Set(),\n                    rawVariations: new Set([rawUnit])\n                });\n            }\n\n            const unitInfo = profile.unitMappings.get(rawUnit)!;\n            if (floor) unitInfo.floors.add(String(floor));\n        }\n\n        this.determineNamingStyle(profile);\n        this.projectProfiles.set(projectName, profile);\n        return profile;\n    }\n\n    private determineNamingStyle(profile: ProjectProfile): void {\n        const patternCount = profile.patterns.size;\n        const totalUsage = Array.from(profile.patterns.values())\n            .reduce((sum, p) => sum + p.count, 0);\n\n        if (patternCount === 0) {\n            profile.namingStyle = 'unknown';\n            return;\n        }\n\n        let dominantPattern: PatternUsage | null = null;\n        let maxCount = 0;\n\n        for (const pattern of profile.patterns.values()) {\n            if (pattern.count > maxCount) {\n                maxCount = pattern.count;\n                dominantPattern = pattern;\n            }\n        }\n\n        if (dominantPattern) {\n            profile.dominantPattern = dominantPattern.patternId;\n            if (dominantPattern.count / totalUsage > 0.8) {\n                profile.namingStyle = 'consistent';\n            } else {\n                profile.namingStyle = 'mixed';\n            }\n        }\n    }\n\n    public getProjectProfile(projectName: string): ProjectProfile | undefined {\n        return this.projectProfiles.get(projectName);\n    }\n\n    public isAmbiguousUnit(projectName: string, rawUnit: string): boolean {\n        const profile = this.projectProfiles.get(projectName);\n        if (!profile) return false;\n\n        const unitInfo = profile.unitMappings.get(rawUnit);\n        return unitInfo ? unitInfo.floors.size > 1 : false;\n    }\n}\n\n\n// ===== 規則引擎 (RuleEngine) =====\n\nclass RuleEngine {\n    private detector: PatternDetector;\n    private customRules: Map<string, (context: ParseContext) => ParseResult | null> = new Map();\n\n    constructor(detector: PatternDetector) {\n        this.detector = detector;\n        this.initializeCustomRules();\n    }\n\n    private initializeCustomRules(): void {\n    }\n\n    public applyRules(context: ParseContext): ParseResult | null {\n        for (const [ruleName, ruleFunc] of this.customRules) {\n            const result = ruleFunc(context);\n            if (result) {\n                return result;\n            }\n        }\n\n        const detectionResult = this.detector.detectPattern(context.rawUnit, context);\n\n        if (detectionResult) {\n            const { rule, match } = detectionResult;\n            return {\n                identifier: rule.extract(match, context),\n                confidence: rule.confidence,\n                method: `pattern:${rule.id}`\n            };\n        }\n\n        return {\n            identifier: this.simpleFallback(context.rawUnit),\n            confidence: 50,\n            method: 'fallback'\n        };\n    }\n\n    private simpleFallback(text: string): string {\n        if (!text) return '';\n        const normalized = text\n            .toUpperCase()\n            .replace(/[\\uff01-\\uff5e]/g, ch => String.fromCharCode(ch.charCodeAt(0) - 0xfee0))\n            .replace(/\\s+/g, '');\n        return normalized.replace(/[棟樓F室號\\-]/g, '');\n    }\n}\n\n// ===== 自適應解析器（主類）與向後兼容介面 =====\n\nexport class AdaptiveUnitResolver {\n    private detector: PatternDetector;\n    public analyzer: ProjectAnalyzer;\n    private ruleEngine: RuleEngine;\n    private resolveCache: Map<string, ParseResult> = new Map();\n\n    constructor(records: any[]) {\n        console.log('[AdaptiveUnitResolver] 初始化，處理', records.length, '筆資料');\n\n        this.detector = new PatternDetector();\n        this.analyzer = new ProjectAnalyzer();\n        this.ruleEngine = new RuleEngine(this.detector);\n\n        this.buildKnowledgeBase(records);\n    }\n\n    private buildKnowledgeBase(records: any[]): void {\n        const projectGroups = new Map<string, any[]>();\n\n        for (const record of records) {\n            const projectName = record['建案名稱'];\n            if (!projectName) continue;\n\n            if (!projectGroups.has(projectName)) {\n                projectGroups.set(projectName, []);\n            }\n            projectGroups.get(projectName)!.push(record);\n        }\n\n        console.log('[AdaptiveUnitResolver] 分析', projectGroups.size, '個建案');\n\n        for (const [projectName, projectRecords] of projectGroups) {\n            this.analyzer.analyzeProject(projectName, projectRecords);\n        }\n    }\n\n    public resolve(record: any): string {\n        return this.resolveWithContext(record).identifier;\n    }\n\n    public resolveWithContext(record: any): ParseResult {\n        let rawUnit = record['戶別'];\n\n        if (rawUnit && typeof rawUnit === 'string') {\n            rawUnit = rawUnit.trim();\n        }\n\n        const floor = record['樓層'];\n        const projectName = record['建案名稱'];\n\n        if (!rawUnit) return { identifier: '', confidence: 0, method: 'no_input' };\n\n        const cacheKey = `${projectName}|${rawUnit}|${floor || ''}`;\n        if (this.resolveCache.has(cacheKey)) {\n            return this.resolveCache.get(cacheKey)!;\n        }\n\n        const context: ParseContext = {\n            rawUnit,\n            floor: floor ? String(floor) : undefined,\n            projectName\n        };\n\n        const result = this.ruleEngine.applyRules(context);\n\n        if (result) {\n            this.resolveCache.set(cacheKey, result);\n            return result;\n        }\n\n        // Should be covered by fallback in ruleEngine, but safe fallback here\n        const fallback: ParseResult = { identifier: rawUnit, confidence: 0, method: 'fallback_null' };\n        this.resolveCache.set(cacheKey, fallback);\n        return fallback;\n    }\n}\n\nexport class UnitIdentifierResolver extends AdaptiveUnitResolver { }\nexport const getUnitIdentifier = (rawText: string | null, _buildingName: string | null, floor: string | null): string => {\n    if (!rawText) return '';\n\n    let cleanedText = rawText;\n    cleanedText = cleanedText.trim();\n\n    const detector = new PatternDetector();\n    const ruleEngine = new RuleEngine(detector);\n    return ruleEngine.applyRules({ rawUnit: cleanedText, floor: floor || undefined })?.identifier || '';\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1590, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/lib/heatmap-utils.ts"],"sourcesContent":["\n/**\n * src/lib/heatmap-utils.ts\n * 負責將原始交易資料轉換為熱力圖所需的水平銷控表格式\n */\nimport { AdaptiveUnitResolver } from \"@/lib/unit-parser\";\n\nexport interface HeatmapDataInput {\n    transactionDetails: any[];\n}\n\ninterface HeatmapOutput {\n    horizontalGrid: Record<string, Record<string, any[]>>; // [floor][unit] -> tx[]\n    sortedFloors: string[];\n    sortedUnits: string[];\n    unitColorMap: Record<string, string>;\n    summary: {\n        totalBaselineHousePrice: number;\n        totalPricePremiumValue: number;\n        totalSoldArea: number;\n        transactionCount: number;\n    };\n    horizontalComparison: any[];\n    refFloorForComparison?: string;\n}\n\nexport function generateHeatmapData(projectTransactions: any[], floorPremiumPercent: number = 0.3): HeatmapOutput {\n    // 1. Group by Floor and Unit\n    const horizontalGrid: Record<string, Record<string, any[]>> = {};\n    const floorsSet = new Set<string>();\n    const unitsSet = new Set<string>();\n\n    // Initialize Unit Resolver with all transactions for context learning\n    const unitResolver = new AdaptiveUnitResolver(projectTransactions);\n\n    projectTransactions.forEach(tx => {\n        // Safe property access\n        let floor = tx['樓層'] || tx.floor || tx.layer;\n        if (floor === undefined || floor === null) return; // Skip invalid records\n        if (typeof floor === 'number') floor = String(floor);\n\n        if (typeof floor === 'number') floor = String(floor);\n\n        // Resolve Normalized Unit Name\n        const unit = unitResolver.resolve(tx);\n        // Fallback or keep raw if resolve returns empty? usually returns identifier.\n        // If empty, fallback to raw? NO, resolver should handle fallback.\n        // Original: const unit = tx['戶別'] || tx['戶型'] || tx.unit || '?';\n\n        floorsSet.add(floor);\n        unitsSet.add(unit);\n\n        if (!horizontalGrid[floor]) horizontalGrid[floor] = {};\n        if (!horizontalGrid[floor][unit]) horizontalGrid[floor][unit] = [];\n\n        // Pre-calculate some fields\n        const unitPrice = parseFloat(tx['房屋單價(萬)'] || tx.unitPrice || 0);\n        const totalPrice = parseFloat(tx['交易總價(萬)'] || tx.totalPrice || 0);\n        const housePrice = parseFloat(tx['房屋總價(萬)'] || tx.housePrice || 0);\n        const parkingPrice = parseFloat(tx['車位總價(萬)'] || tx.parkingPrice || 0);\n        const houseArea = parseFloat(tx['房屋面積(坪)'] || tx.houseArea || 0);\n        const rooms = tx['房數'] || tx.rooms;\n\n        const parkingType = tx['車位類別'] || tx.parkingType || '';\n        const parkingCount = (typeof parkingType === 'string' && parkingType.includes('車位')) ? 1 : 0;\n\n        const mainPurpose = tx['主要用途'] || tx.mainPurpose || '';\n        const buildingType = tx['建物型態'] || tx.buildingType || '';\n\n        const isStorefront = mainPurpose.includes('商業') || buildingType.includes('店') || mainPurpose.includes('店');\n        const isOffice = mainPurpose.includes('辦公') || buildingType.includes('辦公') || buildingType.includes('事務所');\n\n        horizontalGrid[floor][unit].push({\n            ...tx,\n            unitPrice,\n            floor,\n            unit,\n            isStorefront,\n            isOffice,\n            hasParking: parkingPrice > 0,\n            tooltipInfo: {\n                totalPrice,\n                housePrice,\n                parkingPrice,\n                houseArea,\n                rooms\n            }\n        });\n    });\n\n    if (floorsSet.size === 0) {\n        // Return empty structure if no valid data\n        return {\n            horizontalGrid: {},\n            sortedFloors: [],\n            sortedUnits: [],\n            unitColorMap: {},\n            summary: { totalBaselineHousePrice: 0, totalPricePremiumValue: 0, totalSoldArea: 0, transactionCount: 0 },\n            horizontalComparison: []\n        };\n    }\n\n    // Sort floors (numeric desc, handled B1 etc)\n    const sortedFloors = Array.from(floorsSet).sort((a, b) => {\n        const getFloorVal = (f: string) => {\n            if (!f) return 0;\n            if (f.startsWith('B')) return -parseInt(f.substring(1));\n            return parseInt(f) || 0;\n        };\n        return getFloorVal(b) - getFloorVal(a);\n    });\n\n    const sortedUnits = Array.from(unitsSet).sort();\n\n    // 2. Identify Anchor (Baseline) Transactions\n    let minPrice = Infinity;\n    let anchorTx: any = null;\n\n    projectTransactions.forEach(tx => {\n        const mainPurpose = tx['主要用途'] || tx.mainPurpose || '';\n        const buildingType = tx['建物型態'] || tx.buildingType || '';\n        const note = tx['備註'] || tx.note || '';\n        const unitPrice = parseFloat(tx['房屋單價(萬)'] || tx.unitPrice || 0);\n\n        const isSpecial = mainPurpose.includes('商業') || buildingType.includes('店') || note.includes('特殊') || note.includes('親友');\n        if (!isSpecial && unitPrice < minPrice && unitPrice > 0) {\n            minPrice = unitPrice;\n            anchorTx = tx;\n        }\n    });\n\n    // Calculate details\n    let totalBaselineHousePrice = 0;\n    let totalPricePremiumValue = 0;\n    let totalSoldArea = 0;\n    let transactionCount = 0;\n\n    // We need to apply the logic to each cell\n    Object.keys(horizontalGrid).forEach(floor => {\n        Object.keys(horizontalGrid[floor]).forEach(unit => {\n            horizontalGrid[floor][unit].forEach((tx: any, idx: number) => {\n                // Determine premium\n                let premium = null;\n\n                if (anchorTx) {\n                    // Theoretical price based on anchor\n                    // Floor diff\n                    const getFloorVal = (f: string) => f.startsWith('B') ? -parseInt(f.substring(1)) : parseInt(f);\n                    const anchorFloorVal = getFloorVal(anchorTx['樓層'].toString());\n                    const currentFloorVal = getFloorVal(tx.floor);\n                    const floorDiff = currentFloorVal - anchorFloorVal;\n\n                    // Theoretical Unit Price = Anchor Unit Price + (Floor Diff * Premium %)\n                    // Simplified model: \n                    const floorAdjustment = floorDiff * floorPremiumPercent; // %\n\n                    // If we treat the Anchor as THE baseline for the whole project:\n                    const theoreticalPrice = anchorTx['房屋單價(萬)'] * (1 + floorAdjustment / 100);\n\n                    // Premium = (Actual - Theoretical) / Theoretical * 100\n                    if (theoreticalPrice > 0) {\n                        premium = ((tx['房屋單價(萬)'] - theoreticalPrice) / theoreticalPrice) * 100;\n                        // If it IS the anchor, premium is 0\n                        if (tx === anchorTx || Math.abs(tx['房屋單價(萬)'] - theoreticalPrice) < 0.1) premium = 0;\n                    }\n\n                    // Accumulate summary stats (simplified)\n                    if (tx.tooltipInfo.housePrice && tx.tooltipInfo.houseArea) {\n                        const baselineHousePrice = (theoreticalPrice * tx.tooltipInfo.houseArea); // approx\n                        totalBaselineHousePrice += baselineHousePrice;\n                        totalPricePremiumValue += (tx.tooltipInfo.housePrice - baselineHousePrice);\n                        totalSoldArea += tx.tooltipInfo.houseArea;\n                        transactionCount++;\n                    }\n                }\n\n                horizontalGrid[floor][unit][idx].premium = premium;\n            });\n        });\n    });\n\n    // Color map\n    const unitColorMap: Record<string, string> = {};\n    const colors = ['#f87171', '#fb923c', '#fbbf24', '#a3e635', '#34d399', '#22d3ee', '#818cf8', '#c084fc', '#f472b6'];\n    sortedUnits.forEach((u, i) => {\n        unitColorMap[u] = colors[i % colors.length];\n    });\n\n    // 3. Horizontal Comparison (Unit Type Analysis)\n    const unitTypeStats: Record<string, {\n        totalPremium: number;\n        totalSoldArea: number;\n        count: number;\n        anchorPrice: number | null;\n    }> = {};\n\n    // Initialize map\n    sortedUnits.forEach(u => {\n        unitTypeStats[u] = { totalPremium: 0, totalSoldArea: 0, count: 0, anchorPrice: null };\n    });\n\n    // Find anchor price for each unit type (Baseline Logic: Anchor Floor's price for this unit)\n    if (anchorTx) {\n        const getFloorVal = (f: string) => f.startsWith('B') ? -parseInt(f.substring(1)) : parseInt(f);\n        const anchorFloorVal = getFloorVal(anchorTx['樓層'].toString());\n\n        projectTransactions.forEach(tx => {\n            const unit = unitResolver.resolve(tx); // Ensure consistent resolution\n            const floorVal = getFloorVal(tx['樓層']?.toString());\n            if (floorVal === anchorFloorVal) {\n                unitTypeStats[unit].anchorPrice = parseFloat(tx['房屋單價(萬)'] || 0);\n            }\n        });\n    }\n\n    // Accumulate Stats\n    Object.keys(horizontalGrid).forEach(floor => {\n        Object.keys(horizontalGrid[floor]).forEach(unit => {\n            horizontalGrid[floor][unit].forEach((tx: any) => {\n                if (tx.premium !== null && tx.tooltipInfo.housePrice && tx.tooltipInfo.houseArea) {\n                    // Using the calculated theoretical price from earlier loop\n                    const getFloorVal = (f: string) => f.startsWith('B') ? -parseInt(f.substring(1)) : parseInt(f);\n                    const anchorFloorVal = anchorTx ? getFloorVal(anchorTx['樓層'].toString()) : 0;\n                    const currentFloorVal = getFloorVal(tx.floor);\n                    const floorDiff = currentFloorVal - anchorFloorVal;\n                    const floorAdjustment = floorDiff * floorPremiumPercent;\n                    const theoreticalPrice = anchorTx ? (anchorTx['房屋單價(萬)'] * (1 + floorAdjustment / 100)) : 0;\n\n                    if (theoreticalPrice > 0) {\n                        const baselineHousePrice = (theoreticalPrice * tx.tooltipInfo.houseArea);\n                        const premiumValue = tx.tooltipInfo.housePrice - baselineHousePrice;\n\n                        if (unitTypeStats[unit]) {\n                            unitTypeStats[unit].totalPremium += premiumValue;\n                            unitTypeStats[unit].totalSoldArea += tx.tooltipInfo.houseArea;\n                            unitTypeStats[unit].count++;\n                        }\n                    }\n                }\n            });\n        });\n    });\n\n    const horizontalComparison = Object.keys(unitTypeStats).map(unit => {\n        const stats = unitTypeStats[unit];\n        if (stats.count === 0) return null;\n\n        return {\n            unitType: unit,\n            anchorInfo: stats.anchorPrice ? `${anchorTx['樓層']}F / ${stats.anchorPrice}萬` : 'N/A',\n            horizontalPriceDiff: stats.totalSoldArea > 0 ? (stats.totalPremium / stats.totalSoldArea) : 0,\n            unitsSold: stats.count,\n            timePremiumContribution: stats.totalPremium,\n            contributionPercentage: totalPricePremiumValue > 0 ? (stats.totalPremium / totalPricePremiumValue) * 100 : 0,\n            baselineHousePrice: totalBaselineHousePrice,\n            avgPriceAdjustment: stats.totalSoldArea > 0 ? (stats.totalPremium / stats.totalSoldArea) : 0\n        };\n    }).filter(Boolean);\n\n    return {\n        horizontalGrid,\n        sortedFloors,\n        sortedUnits,\n        unitColorMap,\n        summary: {\n            totalBaselineHousePrice,\n            totalPricePremiumValue,\n            totalSoldArea,\n            transactionCount\n        },\n        horizontalComparison,\n        refFloorForComparison: anchorTx ? anchorTx['樓層'] : '-'\n    };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1833, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/lib/data/policies.ts"],"sourcesContent":["export interface PolicyEvent {\n    id: string;\n    date: string; // YYYY-MM-DD\n    title: string;\n    category: 'policy' | 'finance' | 'global';\n    impact: 'high' | 'medium' | 'low';\n    description: string;\n    // New fields for comparison table\n    change_content?: string; // e.g. \"貸款成數 6成 -> 5成\"\n    affected_scope?: string; // e.g. \"自然人第3戶、公司法人\"\n    details?: string[];\n    background?: string;      // 當時金融大事件與背景\n    impact_analysis?: string; // 具體影響分析\n}\n\nexport const REAL_ESTATE_POLICIES: PolicyEvent[] = [\n    // 2012-2015: First Phase - Transparency & Initial Controls\n    {\n        id: 'p-2012-08-01',\n        date: '2012-08-01',\n        title: '實價登錄 1.0 上路',\n        category: 'policy',\n        impact: 'high',\n        description: '交易後30日內申報，區段化揭露(30號區間)，預售屋採代銷結案後整批申報。',\n        change_content: \"交易資訊不透明 -> 區段化揭露\",\n        affected_scope: \"房仲業者、買賣雙方、預售屋投機客\",\n        background: \"低利環境延續：國內房貸利率處於低檔 (約1.8%-1.9%)。\",\n        impact_analysis: \"[受益] 買方獲得參考依據。[適應] 房仲失去資訊壟斷優勢。[無感] 預售屋投機客因資訊未即時揭露，仍可操作紅單。\",\n        details: [\n            \"申報義務人：地政士、經紀業或權利人。\",\n            \"申報時機：買賣案件於辦竣所有權移轉登記後30日內申報。\",\n            \"揭露方式：以區段化、去識別化方式提供查詢 (例如：中正路1-30號)。\",\n            \"預售屋規定：委託代銷者，於委託代銷契約屆滿或終止30日內「整批」申報 (資訊落後嚴重)。\"\n        ]\n    },\n    {\n        id: 'p-2014-06-04',\n        date: '2014-06-04',\n        title: '囤房稅 1.0',\n        category: 'policy',\n        impact: 'medium',\n        description: '非自住住家用稅率由1.2%-2%調高為1.5%-3.6%，授權地方政府自訂差別稅率。',\n        change_content: \"非自住稅率 1.2% -> 1.5%~3.6%\",\n        affected_scope: \"多屋族、台北市置產客\",\n        background: \"美國聯準會結束QE：預期升息心理浮現，全球資金派對暫歇。\",\n        impact_analysis: \"[微痛] 持有成本上升，但因多數縣市未採最高稅率，且稅基(房屋評定現值)偏低，實質痛感有限。\",\n        details: [\n            \"自住房屋稅率：維持 1.2% (需本人、配偶或直系親屬實際居住，且全國合計3戶以內)。\",\n            \"非自住房屋稅率：由 1.2%~2% 調升至 1.5%~3.6%。\",\n            \"地方權限：各地方政府可視地方發展需要，在範圍內自訂差別稅率。\",\n            \"持有認定：以個人(自然人)或法人(公司)為單位個別計算。\"\n        ]\n    },\n\n    // 2016-2019: Second Phase - Tax Reform & Repatriation\n    {\n        id: 'p-2016-01-01',\n        date: '2016-01-01',\n        title: '房地合一稅 1.0',\n        category: 'policy',\n        impact: 'high',\n        description: '獲利課稅取代舊制。持有<1年45%，1-2年35%，自用滿6年獲利400萬免稅。奢侈稅同步停徵。',\n        change_content: \"按售價課稅(奢侈稅) -> 按獲利課稅(45%~15%)\",\n        affected_scope: \"短線炒作客、自住客\",\n        background: \"奢侈稅同步停徵：象徵房市進入「實價課稅」新紀元。\",\n        impact_analysis: \"[毀滅] 短進短出獲利被腰斬，投資客大量退場。[受益] 房價盤整，自住客獲得較佳議價空間。\",\n        details: [\n            \"課稅基礎：房地交易所得 = 交易成交價額 - 原始取得成本 - 相關費用 - 土地漲價總數額。\",\n            \"持有1年以內：稅率 45%。\",\n            \"持有1-2年：稅率 35%。\",\n            \"持有2-10年：稅率 20%。\",\n            \"持有超過10年：稅率 15%。\",\n            \"自用住宅優惠：獲利400萬元以下免稅，超過部分10%。(需連續設籍滿6年)\",\n            \"日出條款：2016年1月1日以後取得之房地適用新制。\"\n        ]\n    },\n    {\n        id: 'f-2016-03-24',\n        date: '2016-03-24',\n        title: '央行大幅鬆綁信用管制',\n        category: 'finance',\n        impact: 'high',\n        description: '刪除特定地區管制與自然人第3戶以上限制，僅保留豪宅管制(6成)。',\n        change_content: \"刪除多數管制，僅保留豪宅限貸\",\n        affected_scope: \"換屋族、一般投資客\",\n        background: \"經濟成長疲弱：為提振內需經濟，央行解除長達6年的房市管制。\",\n        impact_analysis: \"[受益] 貸款成數恢復，換屋與置產門檻降低，市場交易量逐漸回溫。\",\n        details: [\n            \"解除管制區域：台北市及新北市特定地區。\",\n            \"解除限制對象：自然人第3戶以上購屋貸款、公司法人購屋貸款。\",\n            \"保留限制：高價住宅(豪宅)貸款最高成數仍維持6成。\"\n        ]\n    },\n    {\n        id: 'p-2018-06-27',\n        date: '2018-06-27',\n        title: '租賃住宅市場發展及管理條例',\n        category: 'policy',\n        impact: 'low',\n        description: '建立包租代管機制，鼓勵房東釋出空屋，給予稅賦優惠(所得稅減免)。',\n        change_content: \"包租代管稅賦優惠\",\n        affected_scope: \"房東、租屋族\",\n        background: \"美中貿易戰開打：全球供應鏈重組，資金開始撤離中國。\",\n        impact_analysis: \"[受益] 房東享有所得稅減免；租屋族獲得專業代管服務，租賃關係較有保障。\",\n        details: [\n            \"租稅優惠：個人房東委託包租代管，月租金6000元以下免稅；6000-20000元必要費用率53%。\",\n            \"專業證照：建立租賃住宅管理人員證照制度。\",\n            \"糾紛處理：建立租賃糾紛免費調處機制。\"\n        ]\n    },\n    {\n        id: 'f-2019-08-15',\n        date: '2019-08-15',\n        title: '境外資金匯回專法',\n        category: 'finance',\n        impact: 'medium',\n        description: '鼓勵台商資金回流享優惠稅率，禁止直接投資房地產，但產生外溢效應帶動豪宅與工業地產。',\n        change_content: \"資金專法回流 (禁入房市但有外溢)\",\n        affected_scope: \"工業地產主、豪宅建商\",\n        background: \"台商回流潮：史上最大規模資金回台，雖禁入房市，但產生外溢效應。\",\n        impact_analysis: \"[暴富] 工業用地與廠房價格飆漲。[受益] 企業主獲利與分紅轉入豪宅市場，帶動高總價產品去化。\",\n        details: [\n            \"優惠稅率：第一年匯回稅率8%，第二年10%。(實質投資可退稅一半)\",\n            \"投資限制：禁止資金直接投資房地產(避免炒房)。\",\n            \"資金控管：資金需存入專戶，控管5-7年才能分批提取。\",\n            \"外溢效應：雖然不能直接買房，但增加市場資金總量，且企業獲利後的分紅仍可自由運用。\"\n        ]\n    },\n\n    // 2020-2022: Third Phase - Capital Surge & Crackdown\n    {\n        id: 'f-2020-03-19',\n        date: '2020-03-19',\n        title: '央行降息 1 碼',\n        category: 'finance',\n        impact: 'high',\n        description: '重貼現率降至1.125%，房貸利率跌破1.4%歷史新低，無限QE背景下引發資產通膨。',\n        change_content: \"重貼現率 1.375% -> 1.125%\",\n        affected_scope: \"全體購屋族、股市投資人\",\n        background: \"COVID-19 疫情爆發：美國聯準會無限QE，全球熱錢氾濫。\",\n        impact_analysis: \"[刺激] 持有成本極低，「租不如買」與「買房抗通膨」心理大爆發，股房雙漲。\",\n        details: [\n            \"降息幅度：調降重貼現率 0.25個百分點。\",\n            \"房貸利率：五大銀行新承做房貸利率跌破 1.4%，創歷史新低。\",\n            \"配套補貼：針對受疫情影響產業及自用住宅貸款提供額外補貼。\"\n        ]\n    },\n    {\n        id: 'f-2020-12-08',\n        date: '2020-12-08',\n        title: '央行信用管制 (第一波)',\n        category: 'finance',\n        impact: 'medium',\n        description: '法人購屋限貸6成，自然人第3戶限貸6成，建商餘屋限貸5成。',\n        change_content: \"法人/第3戶/餘屋 限貸 5-6成\",\n        affected_scope: \"公司法人、多屋族(3戶+)\",\n        background: \"房市過熱跡象：紅單炒作猖獗，排隊買房現象頻傳。\",\n        impact_analysis: \"[警示] 宣示政府打炒房決心，但因低利環境，實質殺傷力有限。\",\n        details: [\n            \"公司法人：第一戶貸款成數最高 6成，無寬限期。\",\n            \"自然人第3戶(含)以上：貸款成數最高 6成，無寬限期。\",\n            \"購地貸款：限貸 6.5成，需保留 1成動工款。\",\n            \"餘屋貸款：限貸 5成。\"\n        ]\n    },\n    {\n        id: 'f-2021-03-19',\n        date: '2021-03-19',\n        title: '央行信用管制 (第二波)',\n        category: 'finance',\n        impact: 'medium',\n        description: '法人購屋成數降至4成，豪宅降至5.5成。',\n        change_content: \"法人限貸 4成；豪宅限貸 5.5成\",\n        affected_scope: \"公司法人、豪宅客\",\n        background: \"投機風氣未減\",\n        impact_analysis: \"[打擊] 封鎖利用公司名義高槓桿炒房的途徑。\",\n        details: [\n            \"公司法人：貸款成數調降至 4成。\",\n            \"自然人高價住宅：第1戶限貸 5.5成，第3戶以上限貸 4成。\",\n            \"工業區閒置土地：貸款最高 5.5成。\"\n        ]\n    },\n    {\n        id: 'p-2021-07-01',\n        date: '2021-07-01',\n        title: '實價登錄 2.0 & 房地合一 2.0',\n        category: 'policy',\n        impact: 'high',\n        description: '門牌完整揭露，預售屋即時申報(30日)，禁止紅單轉售；重稅期延長(45%改2年, 35%改5年)，預售屋納稅。',\n        change_content: \"預售屋納管、重稅閉鎖期延長、禁紅單\",\n        affected_scope: \"預售屋買方/投機客、建商、換屋族\",\n        background: \"房市多頭確立；疫情三級警戒(內需停滯但房市創高)\",\n        impact_analysis: \"[雙面刃] 資訊全透明反成定錨工具。[閉鎖] 投機客無法短進短出，成屋惜售供給減少，價格難跌。\",\n        details: [\n            \"實價登錄2.0：門牌號碼完整揭露 (不再區段化)。\",\n            \"預售屋納管：銷售前需備查，簽約後30日內申報實價登錄。\",\n            \"紅單禁止：禁止預售屋紅單轉售。\",\n            \"房地合一2.0：預售屋獲利納入房地合一稅課徵。\",\n            \"延長重稅期：持有2年內45%，2-5年35% (原為1-2年)。\",\n            \"法人比照：法人交易比照自然人稅率 (防堵公司名義短期炒作)。\"\n        ]\n    },\n    {\n        id: 'f-2021-09-24',\n        date: '2021-09-24',\n        title: '央行信用管制 (第三波)',\n        category: 'finance',\n        impact: 'medium',\n        description: '特定地區 (六都+新竹) 第2戶取消寬限期。',\n        change_content: \"特定地區第2戶 取消寬限期\",\n        affected_scope: \"投資客、換屋族\",\n        background: \"房價持續攀升\",\n        impact_analysis: \"[壓力] 買第2間房必須立刻還本金，增加現金流壓力，迫使部分槓桿過大者退場。\",\n        details: [\n            \"管制區域：新增特定地區 (六都 + 新竹縣市)。\",\n            \"自然人第2戶：取消寬限期 (需本息攤還)。\",\n            \"購地貸款：調降至 6成。\",\n            \"工業區閒置土地：調降至 5成。\"\n        ]\n    },\n    {\n        id: 'f-2021-12-17',\n        date: '2021-12-17',\n        title: '央行信用管制 (第四波)',\n        category: 'finance',\n        impact: 'medium',\n        description: '豪宅貸款降至4成，第3戶降至4成，餘屋貸款降至4成。',\n        change_content: \"豪宅/第3戶/餘屋 限貸 4成\",\n        affected_scope: \"建商、豪宅客\",\n        background: \"營建成本飆漲：缺工缺料議題發酵。\",\n        impact_analysis: \"[緊縮] 建商資金鏈趨緊，中小型建商生存困難，市場走向大者恆大。\",\n        details: [\n            \"自然人高價住宅：貸款成數一律降至 4成 (無寬限期)。\",\n            \"自然人第3戶(含)以上：貸款成數一律降至 4成。\",\n            \"購地貸款：降至 5成。\",\n            \"餘屋貸款：降至 4成。\"\n        ]\n    },\n    {\n        id: 'f-2022-03-17',\n        date: '2022-03-17',\n        title: '央行升息循環啟動',\n        category: 'finance',\n        impact: 'medium',\n        description: '央行跟進Fed升息(全年共2.5碼)，房貸利率重回2%以上。',\n        change_content: \"升息 2.5碼 (利率重回 2% table+)\",\n        affected_scope: \"房貸族\",\n        background: \"全球通膨危機：美國暴力升息，全球股市修正。\",\n        impact_analysis: \"[負擔增加] 每千萬房貸每年利息支出增加約3-4萬元，稍微冷卻追價意願。\",\n        details: [\n            \"2022-03：升息 1碼 (0.25%)。\",\n            \"2022-06：升息 半碼 (0.125%)。\",\n            \"2022-09：升息 半碼 (0.125%)。\",\n            \"2022-12：升息 半碼 (0.125%)。\",\n            \"存款準備率：同步調升，緊縮市場游資。\"\n        ]\n    },\n\n    // 2023-2025: Fourth Phase - Contradictions & Heavy Controls\n    {\n        id: 'f-2023-06-16',\n        date: '2023-06-16',\n        title: '央行信用管制 (第五波)',\n        category: 'finance',\n        impact: 'medium',\n        description: '特定地區第2戶限貸成數上限 7成。',\n        change_content: \"特定地區第2戶 限貸 7成\",\n        affected_scope: \"換屋族、投資客\",\n        background: \"房市量縮價穩：市場觀望平均地權條例上路。\",\n        impact_analysis: \"[微痛] 需多準備1成自備款，影響尚可控。\",\n        details: [\n            \"管制區域：特定地區 (六都 + 新竹縣市)。\",\n            \"自然人第2戶：新增貸款成數上限 7成 (此前僅無寬限期)。\"\n        ]\n    },\n    {\n        id: 'p-2023-07-01',\n        date: '2023-07-01',\n        title: '平均地權條例修正',\n        category: 'policy',\n        impact: 'high',\n        description: '預售屋禁止換約轉售，建立檢舉獎金，私法人購屋許可制。',\n        change_content: \"預售屋禁換約、私法人許可制\",\n        affected_scope: \"預售屋黃牛、豪宅法人\",\n        background: \"投機客的大限\",\n        impact_analysis: \"[滅絕] 純粹賺價差的紅單與換約客徹底消失。豪宅市場因法人需經許可，交易量急凍。\",\n        details: [\n            \"限制換約轉售：預售屋與新建成屋簽約後，除配偶、直系或二親等旁系外，不得讓與或轉售 (禁止黃牛)。\",\n            \"重罰炒作：嚴懲散播不實資訊影響房價，最高罰5000萬元。\",\n            \"檢舉獎金：建立檢舉實名制，獎金為罰鍰 30%。\",\n            \"私法人購屋許可制：私法人購買住宅用房屋需經內政部許可 (限制豪宅私法人節稅管道)。\"\n        ]\n    },\n    {\n        id: 'p-2023-08-01',\n        date: '2023-08-01',\n        title: '新青安貸款專案',\n        category: 'policy',\n        impact: 'high',\n        description: '額度1000萬，年限40年，寬限期5年，利率補貼(1.775%起)。',\n        change_content: \"40年期/5年寬限/降息補貼\",\n        affected_scope: \"首購族、投機客(人頭)、低總價屋主\",\n        background: \"總統大選前夕：政府釋出利多，試圖減輕年輕人負擔。\",\n        impact_analysis: \"[狂熱] 創造「租不如買」與「5年免還本」的套利空間。低總價成屋被掃貨，房價逆勢暴漲。\",\n        details: [\n            \"貸款額度：提高至 1000萬元。\",\n            \"利息補貼：政府補貼 1.5碼 (0.375%) + 公股銀行減半碼 = 利率 1.775% 起。\",\n            \"貸款年限：延長至 40年。\",\n            \"寬限期：延長至 5年 (只繳息不還本)。\",\n            \"資格：本人、配偶及未成年子女名下均無自有住宅。\"\n        ]\n    },\n    {\n        id: 'f-2024-06-14',\n        date: '2024-06-14',\n        title: '央行信用管制 (第六波)',\n        category: 'finance',\n        impact: 'medium',\n        description: '特定地區第2戶限貸成數降至 6成。',\n        change_content: \"特定地區第2戶 限貸 6成\",\n        affected_scope: \"換屋族、置產客\",\n        background: \"台股站上2萬點：AI熱潮帶動股市財富效應，資金外溢至房市。\",\n        impact_analysis: \"[無效] 股市獲利豐厚，6成限貸無法阻擋資金湧入房市。\",\n        details: [\n            \"管制區域：特定地區 (六都 + 新竹縣市)。\",\n            \"自然人第2戶：貸款成數上限由 7成調降為 6成。\",\n            \"調升存款準備率：調升 0.25個百分點 (收回市場資金)。\"\n        ]\n    },\n    {\n        id: 'p-2024-07-01',\n        date: '2024-07-01',\n        title: '囤房稅 2.0 實施',\n        category: 'policy',\n        impact: 'medium',\n        description: '全國歸戶，非自用稅率調高至 2.0%-4.8%，建商餘屋依持有年限課稅。',\n        change_content: \"全國歸戶；稅率 2.0%~4.8%\",\n        affected_scope: \"多屋族、租屋族、建商\",\n        background: \"租金指數創高\",\n        impact_analysis: \"[轉嫁] 多屋族將稅負轉嫁至租金，導致租金上漲。建商面臨餘屋去化壓力，傾向預售完銷。\",\n        details: [\n            \"全國歸戶：由縣市歸戶改為全國歸戶計算戶數。\",\n            \"稅率調升：非自住住家用稅率調升為 2%~4.8% (原1.5%~3.6%)。\",\n            \"單一自住優惠：全國單一自住(本人配偶子女僅一戶)且房屋現值在一定金額以下，稅率降至 1%。\",\n            \"建商餘屋：持有2年以內稅率 2%~3.6%；超過2年稅率 2%~4.8% (鼓勵釋出餘屋)。\"\n        ]\n    },\n    {\n        id: 'f-2024-08-01',\n        date: '2024-08-01',\n        title: '銀行限貸令 (72-2水位)',\n        category: 'finance',\n        impact: 'high',\n        description: '銀行法72-2條逼近30%上限，自主限貸、排隊撥款，市場流動性急凍。',\n        change_content: \"銀行自主限貸、排隊撥款\",\n        affected_scope: \"即將交屋族、賣屋換屋族\",\n        background: \"新青安效應發酵：過多成屋交易與新青安撥款，耗盡銀行額度。\",\n        impact_analysis: \"[恐慌] 買了房卻貸不到款，面臨違約風險。市場流動性瞬間急凍。\",\n        details: [\n            \"銀行法72-2條：商業銀行辦理住宅建築及企業建築放款總額，不得超過存款總餘額及金融債券發售額之 30%。\",\n            \"現象：多家銀行房貸水位接近滿載。\",\n            \"影響：銀行暫停收件、排隊撥款(需等數月)、利率大幅調升(2.6%-3%以上)。\"\n        ]\n    },\n    {\n        id: 'f-2024-09-20',\n        date: '2024-09-20',\n        title: '央行信用管制 (第七波)',\n        category: 'finance',\n        impact: 'high',\n        description: '有房者第1戶無寬限期；全國第2戶限貸5成；法人/豪宅/第3戶限貸3成。',\n        change_content: \"有房者第1戶無寬限；第2戶全國限貸5成\",\n        affected_scope: \"換屋族、繼承族、交屋族\",\n        background: \"金龍海嘯：央行判定房市過熱，認為新青安助長投機，決心斷絕金流。\",\n        impact_analysis: \"[重傷/錯殺] 史上最嚴厲管制。1. 換屋族需5成自備。2. 繼承祖產失寬限。3. 預售交屋斷頭風險大增。\",\n        details: [\n            \"自然人第1戶：名下有房屋者(含繼承、持分)，第1戶購屋貸款「無寬限期」。\",\n            \"自然人第2戶：貸款成數上限降至 5成，且擴及「全國」。\",\n            \"自然人第3戶以上：貸款成數上限降至 3成。\",\n            \"公司法人：購屋貸款成數降至 3成。\",\n            \"豪宅(高價住宅)：貸款成數降至 3成。\",\n            \"餘屋貸款：降至 3成。\",\n            \"存款準備率：再調升 0.25個百分點。\"\n        ]\n    }\n];\n"],"names":[],"mappings":";;;;AAeO,MAAM,uBAAsC;IAC/C,2DAA2D;IAC3D;QACI,IAAI;QACJ,MAAM;QACN,OAAO;QACP,UAAU;QACV,QAAQ;QACR,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,YAAY;QACZ,iBAAiB;QACjB,SAAS;YACL;YACA;YACA;YACA;SACH;IACL;IACA;QACI,IAAI;QACJ,MAAM;QACN,OAAO;QACP,UAAU;QACV,QAAQ;QACR,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,YAAY;QACZ,iBAAiB;QACjB,SAAS;YACL;YACA;YACA;YACA;SACH;IACL;IAEA,sDAAsD;IACtD;QACI,IAAI;QACJ,MAAM;QACN,OAAO;QACP,UAAU;QACV,QAAQ;QACR,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,YAAY;QACZ,iBAAiB;QACjB,SAAS;YACL;YACA;YACA;YACA;YACA;YACA;YACA;SACH;IACL;IACA;QACI,IAAI;QACJ,MAAM;QACN,OAAO;QACP,UAAU;QACV,QAAQ;QACR,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,YAAY;QACZ,iBAAiB;QACjB,SAAS;YACL;YACA;YACA;SACH;IACL;IACA;QACI,IAAI;QACJ,MAAM;QACN,OAAO;QACP,UAAU;QACV,QAAQ;QACR,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,YAAY;QACZ,iBAAiB;QACjB,SAAS;YACL;YACA;YACA;SACH;IACL;IACA;QACI,IAAI;QACJ,MAAM;QACN,OAAO;QACP,UAAU;QACV,QAAQ;QACR,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,YAAY;QACZ,iBAAiB;QACjB,SAAS;YACL;YACA;YACA;YACA;SACH;IACL;IAEA,qDAAqD;IACrD;QACI,IAAI;QACJ,MAAM;QACN,OAAO;QACP,UAAU;QACV,QAAQ;QACR,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,YAAY;QACZ,iBAAiB;QACjB,SAAS;YACL;YACA;YACA;SACH;IACL;IACA;QACI,IAAI;QACJ,MAAM;QACN,OAAO;QACP,UAAU;QACV,QAAQ;QACR,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,YAAY;QACZ,iBAAiB;QACjB,SAAS;YACL;YACA;YACA;YACA;SACH;IACL;IACA;QACI,IAAI;QACJ,MAAM;QACN,OAAO;QACP,UAAU;QACV,QAAQ;QACR,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,YAAY;QACZ,iBAAiB;QACjB,SAAS;YACL;YACA;YACA;SACH;IACL;IACA;QACI,IAAI;QACJ,MAAM;QACN,OAAO;QACP,UAAU;QACV,QAAQ;QACR,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,YAAY;QACZ,iBAAiB;QACjB,SAAS;YACL;YACA;YACA;YACA;YACA;YACA;SACH;IACL;IACA;QACI,IAAI;QACJ,MAAM;QACN,OAAO;QACP,UAAU;QACV,QAAQ;QACR,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,YAAY;QACZ,iBAAiB;QACjB,SAAS;YACL;YACA;YACA;YACA;SACH;IACL;IACA;QACI,IAAI;QACJ,MAAM;QACN,OAAO;QACP,UAAU;QACV,QAAQ;QACR,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,YAAY;QACZ,iBAAiB;QACjB,SAAS;YACL;YACA;YACA;YACA;SACH;IACL;IACA;QACI,IAAI;QACJ,MAAM;QACN,OAAO;QACP,UAAU;QACV,QAAQ;QACR,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,YAAY;QACZ,iBAAiB;QACjB,SAAS;YACL;YACA;YACA;YACA;YACA;SACH;IACL;IAEA,4DAA4D;IAC5D;QACI,IAAI;QACJ,MAAM;QACN,OAAO;QACP,UAAU;QACV,QAAQ;QACR,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,YAAY;QACZ,iBAAiB;QACjB,SAAS;YACL;YACA;SACH;IACL;IACA;QACI,IAAI;QACJ,MAAM;QACN,OAAO;QACP,UAAU;QACV,QAAQ;QACR,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,YAAY;QACZ,iBAAiB;QACjB,SAAS;YACL;YACA;YACA;YACA;SACH;IACL;IACA;QACI,IAAI;QACJ,MAAM;QACN,OAAO;QACP,UAAU;QACV,QAAQ;QACR,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,YAAY;QACZ,iBAAiB;QACjB,SAAS;YACL;YACA;YACA;YACA;YACA;SACH;IACL;IACA;QACI,IAAI;QACJ,MAAM;QACN,OAAO;QACP,UAAU;QACV,QAAQ;QACR,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,YAAY;QACZ,iBAAiB;QACjB,SAAS;YACL;YACA;YACA;SACH;IACL;IACA;QACI,IAAI;QACJ,MAAM;QACN,OAAO;QACP,UAAU;QACV,QAAQ;QACR,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,YAAY;QACZ,iBAAiB;QACjB,SAAS;YACL;YACA;YACA;YACA;SACH;IACL;IACA;QACI,IAAI;QACJ,MAAM;QACN,OAAO;QACP,UAAU;QACV,QAAQ;QACR,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,YAAY;QACZ,iBAAiB;QACjB,SAAS;YACL;YACA;YACA;SACH;IACL;IACA;QACI,IAAI;QACJ,MAAM;QACN,OAAO;QACP,UAAU;QACV,QAAQ;QACR,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,YAAY;QACZ,iBAAiB;QACjB,SAAS;YACL;YACA;YACA;YACA;YACA;YACA;YACA;SACH;IACL;CACH"}},
    {"offset": {"line": 2212, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/lib/aggregator.ts"],"sourcesContent":["\nimport { AnalysisResult } from '@/types';\n\n/**\n * js/modules/aggregator.js -> src/lib/aggregator.ts\n * Responsible for merging analysis results from multiple counties.\n */\n\nexport function aggregateAnalysisData(currentTotal: AnalysisResult | null, newData: AnalysisResult): AnalysisResult {\n    if (!newData) return currentTotal as AnalysisResult;\n    // Note: Cast is needed if return type strictness varies, but with same type it should be fine.\n    if (!currentTotal) {\n        // Deep copy to avoid side effects\n        return JSON.parse(JSON.stringify(newData));\n    }\n\n    // 0. Merge Raw Transaction Details\n    if (newData.transactionDetails && Array.isArray(newData.transactionDetails)) {\n        if (!currentTotal.transactionDetails) currentTotal.transactionDetails = [];\n        currentTotal.transactionDetails = [...currentTotal.transactionDetails, ...newData.transactionDetails];\n    }\n\n    // 1. Merge Core Metrics\n    currentTotal.coreMetrics = aggregateCoreMetrics(currentTotal.coreMetrics, newData.coreMetrics);\n\n    // 2. Merge Project Ranking\n    if (newData.projectRanking && Array.isArray(newData.projectRanking)) {\n        currentTotal.projectRanking = [...currentTotal.projectRanking, ...newData.projectRanking];\n    }\n\n    // 3. Merge Price Band Analysis\n    currentTotal.priceBandAnalysis = aggregatePriceBandAnalysis(currentTotal.priceBandAnalysis, newData.priceBandAnalysis);\n\n    // 4. Merge Unit Price Analysis\n    currentTotal.unitPriceAnalysis = aggregateUnitPriceAnalysis(currentTotal.unitPriceAnalysis, newData.unitPriceAnalysis);\n\n    // Recalculate medians if transactions exist\n    if (currentTotal.transactionDetails && currentTotal.transactionDetails.length > 0) {\n        recalculateUnitPriceStats(currentTotal.unitPriceAnalysis, currentTotal.transactionDetails);\n    }\n\n    // 5. Merge Parking Analysis\n    currentTotal.parkingAnalysis = aggregateParkingAnalysis(currentTotal.parkingAnalysis, newData.parkingAnalysis);\n\n    // 6. Merge Sales Velocity Analysis\n    currentTotal.salesVelocityAnalysis = aggregateSalesVelocityAnalysis(currentTotal.salesVelocityAnalysis, newData.salesVelocityAnalysis);\n\n    // 7. Merge Price Grid Analysis\n    currentTotal.priceGridAnalysis = aggregatePriceGridAnalysis(currentTotal.priceGridAnalysis, newData.priceGridAnalysis);\n\n    // 8. Merge Area Distribution Analysis\n    currentTotal.areaDistributionAnalysis = aggregateAreaDistributionAnalysis(currentTotal.areaDistributionAnalysis, newData.areaDistributionAnalysis);\n\n    return currentTotal;\n}\n\nfunction aggregateCoreMetrics(metricsA: any, metricsB: any) {\n    if (!metricsB) return metricsA;\n    if (!metricsA) return metricsB;\n\n    const totalSaleAmount = (metricsA.totalSaleAmount || 0) + (metricsB.totalSaleAmount || 0);\n    const totalHouseArea = (metricsA.totalHouseArea || 0) + (metricsB.totalHouseArea || 0);\n    const transactionCount = (metricsA.transactionCount || 0) + (metricsB.transactionCount || 0);\n    const overallAveragePrice = totalHouseArea > 0 ? totalSaleAmount / totalHouseArea : 0;\n\n    return {\n        totalSaleAmount,\n        totalHouseArea,\n        overallAveragePrice,\n        transactionCount,\n        medianPrice: 0, // Difficult to recalculate without raw data\n        q1Price: 0,\n        q3Price: 0,\n        minPrice: Math.min(metricsA.minPrice || Infinity, metricsB.minPrice || Infinity),\n        maxPrice: Math.max(metricsA.maxPrice || 0, metricsB.maxPrice || 0)\n    };\n}\n\n\nfunction aggregatePriceBandAnalysis(bandsA: any, bandsB: any) {\n    if (!bandsB) return bandsA;\n\n    // Normalize: Handle both array format (legacy) and object format\n    const detailsA = Array.isArray(bandsA) ? bandsA : (bandsA?.details || []);\n    const detailsB = Array.isArray(bandsB) ? bandsB : (bandsB?.details || []);\n\n    const crossTableA = bandsA?.locationCrossTable || {};\n    const crossTableB = bandsB?.locationCrossTable || {};\n    const districtsA = bandsA?.allDistricts || [];\n    const districtsB = bandsB?.allDistricts || [];\n    const roomTypesA = bandsA?.allRoomTypes || [];\n    const roomTypesB = bandsB?.allRoomTypes || [];\n\n    const bandMap = new Map();\n\n    const addToMap = (item: any) => {\n        // Robust Key Generation: Ensure bathrooms is treated consistently\n        const baths = (item.bathrooms !== null && item.bathrooms !== undefined) ? String(item.bathrooms) : 'null';\n        // Normalize roomType: remove all whitespace to match frontend 'selectedRoomTypes'\n        const normalizedRoomType = (item.roomType || '').replace(/\\s+/g, '');\n        const key = `${normalizedRoomType}-${baths}`;\n\n        // Ensure numeric values\n        const itemCount = Number(item.count) || 0;\n        const itemAvg = Number(item.avgPrice) || 0;\n        const itemMin = Number(item.minPrice) || 0;\n        const itemMax = Number(item.maxPrice) || 0;\n\n        if (!bandMap.has(key)) {\n            bandMap.set(key, {\n                ...item,\n                roomType: normalizedRoomType, // Store normalized value for frontend filtering\n                count: itemCount,\n                avgPrice: itemAvg,\n                minPrice: itemMin,\n                maxPrice: itemMax,\n                projectNames: item.projectNames ? [...item.projectNames] : [],\n                byDistrict: item.byDistrict ? { ...item.byDistrict } : {}\n            });\n        } else {\n            const existing = bandMap.get(key);\n\n            const existingCount = Number(existing.count) || 0;\n            const existingAvg = Number(existing.avgPrice) || 0;\n\n            const totalAmountA = existingAvg * existingCount;\n            const totalAmountB = itemAvg * itemCount;\n            const newCount = existingCount + itemCount;\n            const newAvgPrice = newCount > 0 ? (totalAmountA + totalAmountB) / newCount : 0;\n\n            existing.count = newCount;\n            existing.avgPrice = parseFloat(newAvgPrice.toFixed(2));\n            existing.minPrice = Math.min(existing.minPrice, itemMin);\n            existing.maxPrice = Math.max(existing.maxPrice, itemMax);\n\n            if (item.projectNames) {\n                const newProjectNames = new Set([...existing.projectNames, ...item.projectNames]);\n                existing.projectNames = Array.from(newProjectNames);\n            }\n\n            if (item.byDistrict) {\n                Object.entries(item.byDistrict).forEach(([district, count]) => {\n                    existing.byDistrict[district] = ((existing.byDistrict[district] as number) || 0) + (count as number);\n                });\n            }\n        }\n    };\n\n    detailsA.forEach(addToMap);\n    detailsB.forEach(addToMap);\n\n    const mergedCrossTable = { ...crossTableA };\n    Object.entries(crossTableB).forEach(([roomType, districtCounts]) => {\n        if (!mergedCrossTable[roomType]) {\n            mergedCrossTable[roomType] = { ...(districtCounts as any) };\n        } else {\n            Object.entries(districtCounts as any).forEach(([district, count]) => {\n                mergedCrossTable[roomType][district] = (mergedCrossTable[roomType][district] || 0) + (count as number);\n            });\n        }\n    });\n\n    const mergedDistricts = Array.from(new Set([...districtsA, ...districtsB])).sort();\n    const mergedRoomTypes = Array.from(new Set([...roomTypesA, ...roomTypesB])).sort();\n\n    return {\n        details: Array.from(bandMap.values()),\n        locationCrossTable: mergedCrossTable,\n        allDistricts: mergedDistricts,\n        allRoomTypes: mergedRoomTypes\n    };\n}\n\nfunction aggregateUnitPriceAnalysis(unitA: any, unitB: any) {\n    if (!unitB) return unitA;\n\n    const mergeStats = (statsA: any, statsB: any) => {\n        if (!statsB) return statsA;\n        if (!statsA) return statsB;\n\n        const newCount = (statsA.count || 0) + (statsB.count || 0);\n        if (newCount === 0) return statsA;\n\n        const newAvgPrice: any = { arithmetic: 0, weighted: 0 };\n\n        // Helper to get price value safely\n        const getPrice = (stats: any, type: string) => {\n            if (typeof stats.avgPrice === 'number') {\n                // If pure number, it's typically the arithmetic mean. \n                // For weighted, we might fall back to it if weighted is missing, \n                // but ideally weighted should be present.\n                // If weighted is missing in source, use the number as fallback.\n                return stats.weightedAvgPrice || stats.avgPrice;\n            }\n            return stats.avgPrice?.[type] || 0;\n        };\n\n        ['arithmetic', 'weighted'].forEach(type => {\n            const priceA = getPrice(statsA, type);\n            const priceB = getPrice(statsB, type);\n            // Weighted average logic: (P1*N1 + P2*N2) / (N1+N2)\n            newAvgPrice[type] = (priceA * (statsA.count || 0) + priceB * (statsB.count || 0)) / newCount;\n        });\n\n        const newMinPrice = Math.min(statsA.minPrice, statsB.minPrice);\n        const newMaxPrice = Math.max(statsA.maxPrice, statsB.maxPrice);\n\n        let minPriceProject = statsA.minPrice < statsB.minPrice ? statsA.minPriceProject : statsB.minPriceProject;\n        let maxPriceProject = statsA.maxPrice > statsB.maxPrice ? statsA.maxPriceProject : statsB.maxPriceProject;\n\n        return {\n            count: newCount,\n            avgPrice: newAvgPrice,\n            minPrice: newMinPrice,\n            maxPrice: newMaxPrice,\n            minPriceProject,\n            maxPriceProject,\n            medianPrice: 0,\n            q1Price: 0,\n            q3Price: 0\n        };\n    };\n\n    const residentialStats = mergeStats(unitA.residentialStats, unitB.residentialStats);\n    const officeStats = mergeStats(unitA.officeStats, unitB.officeStats);\n    const storeStats = mergeStats(unitA.storeStats, unitB.storeStats);\n\n    let typeComparison = [...(unitA.typeComparison || [])];\n    if (unitB.typeComparison) {\n        typeComparison = [...typeComparison, ...unitB.typeComparison];\n    }\n\n    return {\n        residentialStats,\n        officeStats,\n        storeStats,\n        typeComparison\n    };\n}\n\nfunction recalculateUnitPriceStats(unitAnalysis: any, transactions: any[]) {\n    if (!unitAnalysis || !transactions || transactions.length === 0) return;\n\n    const residentialTx: number[] = [];\n    const residentialSum: { price: number, area: number, count: number } = { price: 0, area: 0, count: 0 };\n    const officeTx: number[] = [];\n    const officeSum: { price: number, area: number, count: number } = { price: 0, area: 0, count: 0 };\n    const storeTx: number[] = [];\n    const storeSum: { price: number, area: number, count: number } = { price: 0, area: 0, count: 0 };\n\n    // Track min/max records\n    const initialExtremes = () => ({\n        minPrice: Infinity,\n        maxPrice: -Infinity,\n        minRecord: null as any,\n        maxRecord: null as any\n    });\n\n    const resExtremes = initialExtremes();\n    const officeExtremes = initialExtremes();\n    const storeExtremes = initialExtremes();\n\n    transactions.forEach(record => {\n        const type = record['建物型態'];\n        const usage = record['主要用途'];\n        const unitPrice = record['房屋單價(萬)'];\n        const totalPrice = record['房屋總價(萬)'] || 0;\n        const totalArea = record['建物移轉總面積'] || 0;\n\n        if (typeof unitPrice !== 'number' || unitPrice <= 0) return;\n\n        let targetTx = residentialTx;\n        let targetSum = residentialSum;\n        let targetExtremes = resExtremes;\n\n        if (type?.includes('店') || usage === '商業用' || record['備註']?.includes('店')) {\n            targetTx = storeTx;\n            targetSum = storeSum;\n            targetExtremes = storeExtremes;\n        } else if (type?.includes('辦公') || type?.includes('廠辦') || type?.includes('事務所') || usage?.includes('辦公')) {\n            targetTx = officeTx;\n            targetSum = officeSum;\n            targetExtremes = officeExtremes;\n        }\n\n        targetTx.push(unitPrice);\n        targetSum.price += totalPrice;\n        targetSum.area += totalArea;\n        targetSum.count += 1;\n\n        // Update extremes\n        if (unitPrice > targetExtremes.maxPrice) {\n            targetExtremes.maxPrice = unitPrice;\n            targetExtremes.maxRecord = record;\n        }\n        if (unitPrice < targetExtremes.minPrice) {\n            targetExtremes.minPrice = unitPrice;\n            targetExtremes.minRecord = record;\n        }\n    });\n\n    const updateStats = (statsObj: any, tx: number[], sum: any, extremes: any) => {\n        if (!statsObj) return;\n        updateQuantiles(statsObj, tx);\n        statsObj.count = sum.count;\n        statsObj.avgPrice = sum.count > 0 ? tx.reduce((a, b) => a + b, 0) / sum.count : 0;\n        statsObj.weightedAvgPrice = sum.area > 0 ? sum.price / sum.area : 0;\n\n        // Update Extreme Details\n        if (extremes.maxRecord) {\n            statsObj.maxPrice = extremes.maxPrice;\n            statsObj.maxPriceProject = extremes.maxRecord['建案名稱'];\n            // Use '戶型' (Backend filtered unit name) if available, otherwise fallback to '戶別'\n            statsObj.maxPriceUnit = extremes.maxRecord['戶型'] || extremes.maxRecord['戶別'];\n            statsObj.maxPriceFloor = extremes.maxRecord['樓層'];\n        }\n        if (extremes.minRecord) {\n            statsObj.minPrice = extremes.minPrice;\n            statsObj.minPriceProject = extremes.minRecord['建案名稱'];\n            statsObj.minPriceUnit = extremes.minRecord['戶型'] || extremes.minRecord['戶別'];\n            statsObj.minPriceFloor = extremes.minRecord['樓層'];\n        }\n    };\n\n    if (unitAnalysis.residentialStats) updateStats(unitAnalysis.residentialStats, residentialTx, residentialSum, resExtremes);\n    if (unitAnalysis.officeStats) updateStats(unitAnalysis.officeStats, officeTx, officeSum, officeExtremes);\n    if (unitAnalysis.storeStats) updateStats(unitAnalysis.storeStats, storeTx, storeSum, storeExtremes);\n\n    // Rebuild Type Comparison Table from Transactions\n    const projectMap = new Map<string, {\n        resSum: { price: number, area: number, count: number },\n        shopSum: { price: number, area: number, count: number },\n        officeSum: { price: number, area: number, count: number },\n        county: string,\n        district: string\n    }>();\n\n    transactions.forEach(record => {\n        const projectName = record['建案名稱'];\n        if (!projectName) return;\n\n        if (!projectMap.has(projectName)) {\n            projectMap.set(projectName, {\n                resSum: { price: 0, area: 0, count: 0 },\n                shopSum: { price: 0, area: 0, count: 0 },\n                officeSum: { price: 0, area: 0, count: 0 },\n                county: record['縣市'],\n                district: record['行政區']\n            });\n        }\n\n        const stats = projectMap.get(projectName)!;\n        const type = record['建物型態'];\n        const usage = record['主要用途'];\n        const unitPrice = record['房屋單價(萬)'];\n        const totalPrice = record['房屋總價(萬)'] || 0;\n        const totalArea = record['建物移轉總面積'] || 0;\n\n        if (typeof unitPrice !== 'number' || unitPrice <= 0) return;\n\n        if (type?.includes('店') || usage === '商業用' || record['備註']?.includes('店')) {\n            stats.shopSum.price += totalPrice;\n            stats.shopSum.area += totalArea;\n            stats.shopSum.count += 1;\n        } else if (type?.includes('辦公') || type?.includes('廠辦') || type?.includes('事務所') || usage?.includes('辦公')) {\n            stats.officeSum.price += totalPrice;\n            stats.officeSum.area += totalArea;\n            stats.officeSum.count += 1;\n        } else {\n            stats.resSum.price += totalPrice;\n            stats.resSum.area += totalArea;\n            stats.resSum.count += 1;\n        }\n    });\n\n    const newTypeComparison: any[] = [];\n    projectMap.forEach((stats, projectName) => {\n        // Calculate Weighted Averages (or fall back to arithmetic if needed, but weighted is better for this)\n        const residentialAvg = stats.resSum.area > 0 ? stats.resSum.price / stats.resSum.area : 0;\n        const shopAvg = stats.shopSum.area > 0 ? stats.shopSum.price / stats.shopSum.area : 0;\n        const officeAvg = stats.officeSum.area > 0 ? stats.officeSum.price / stats.officeSum.area : 0;\n\n        if (residentialAvg > 0 && (shopAvg > 0 || officeAvg > 0)) {\n            newTypeComparison.push({\n                projectName,\n                county: stats.county,\n                district: stats.district,\n                residentialAvg,\n                shopAvg,\n                officeAvg,\n                shopMultiple: residentialAvg > 0 ? shopAvg / residentialAvg : 0,\n                officeMultiple: residentialAvg > 0 ? officeAvg / residentialAvg : 0\n            });\n        }\n    });\n\n    // Sort by project name\n    newTypeComparison.sort((a, b) => a.projectName.localeCompare(b.projectName));\n    unitAnalysis.typeComparison = newTypeComparison;\n}\n\nfunction updateQuantiles(statsObj: any, prices: number[]) {\n    if (!prices || prices.length === 0) {\n        statsObj.medianPrice = 0;\n        statsObj.q1Price = 0;\n        statsObj.q3Price = 0;\n        return;\n    }\n\n    prices.sort((a, b) => a - b);\n\n    statsObj.medianPrice = calculateQuantile(prices, 0.5);\n    statsObj.q1Price = calculateQuantile(prices, 0.25);\n    statsObj.q3Price = calculateQuantile(prices, 0.75);\n}\n\nfunction calculateQuantile(sortedArr: number[], q: number) {\n    const pos = (sortedArr.length - 1) * q;\n    const base = Math.floor(pos);\n    const rest = pos - base;\n    if (sortedArr[base + 1] !== undefined) {\n        return parseFloat((sortedArr[base] + rest * (sortedArr[base + 1] - sortedArr[base])).toFixed(2));\n    } else {\n        return parseFloat(sortedArr[base].toFixed(2));\n    }\n}\n\nfunction aggregateParkingAnalysis(parkA: any, parkB: any) {\n    if (!parkB) return parkA;\n\n    const ratioA = parkA.parkingRatio;\n    const ratioB = parkB.parkingRatio;\n    let newRatio = null;\n\n    if (ratioA && ratioB) {\n        const withA = ratioA.withParking.count;\n        const withoutA = ratioA.withoutParking.count;\n        const withB = ratioB.withParking.count;\n        const withoutB = ratioB.withoutParking.count;\n        const totalWith = withA + withB;\n        const totalWithout = withoutA + withoutB;\n        const total = totalWith + totalWithout;\n\n        newRatio = {\n            withParking: { count: totalWith, percentage: total > 0 ? (totalWith / total) * 100 : 0 },\n            withoutParking: { count: totalWithout, percentage: total > 0 ? (totalWithout / total) * 100 : 0 }\n        };\n    } else {\n        newRatio = ratioA || ratioB;\n    }\n\n    const typeMap = new Map();\n    const mergeTypeItem = (item: any) => {\n        if (!typeMap.has(item.type)) {\n            typeMap.set(item.type, { ...item });\n        } else {\n            const existing = typeMap.get(item.type);\n            const totalCount = existing.count + item.count;\n            const totalTx = existing.transactionCount + item.transactionCount;\n            const priceA = existing.avgPrice;\n            const priceB = item.avgPrice;\n            const newAvg = totalTx > 0 ? (priceA * existing.transactionCount + priceB * item.transactionCount) / totalTx : 0;\n\n            existing.count = totalCount;\n            existing.transactionCount = totalTx;\n            existing.avgPrice = newAvg;\n        }\n    };\n    (parkA.avgPriceByType || []).forEach(mergeTypeItem);\n    (parkB.avgPriceByType || []).forEach(mergeTypeItem);\n    const newAvgPriceByType = Array.from(typeMap.values());\n\n    const floorMap = new Map();\n    const mergeFloorItem = (item: any) => {\n        if (!floorMap.has(item.floor)) {\n            floorMap.set(item.floor, { ...item, rawRecords: item.rawRecords ? [...item.rawRecords] : [] });\n        } else {\n            const existing = floorMap.get(item.floor);\n            const newCount = existing.count + item.count;\n\n            if (item.rawRecords) {\n                existing.rawRecords = [...(existing.rawRecords || []), ...item.rawRecords];\n            }\n\n            const newAvg = newCount > 0 ? (existing.avgPrice * existing.count + item.avgPrice * item.count) / newCount : 0;\n\n            existing.count = newCount;\n            existing.avgPrice = newAvg;\n            existing.minPrice = Math.min(existing.minPrice, item.minPrice);\n            existing.maxPrice = Math.max(existing.maxPrice, item.maxPrice);\n\n            if (item.maxPrice > existing.maxPrice) {\n                existing.maxPriceProject = item.maxPriceProject;\n                existing.maxPriceUnit = item.maxPriceUnit;\n                existing.maxPriceFloor = item.maxPriceFloor;\n            }\n            if (item.minPrice < existing.minPrice) {\n                existing.minPriceProject = item.minPriceProject;\n                existing.minPriceUnit = item.minPriceUnit;\n                existing.minPriceFloor = item.minPriceFloor;\n            }\n        }\n    };\n    (parkA.rampPlanePriceByFloor || []).forEach(mergeFloorItem);\n    (parkB.rampPlanePriceByFloor || []).forEach(mergeFloorItem);\n    const newRampByFloor = Array.from(floorMap.values());\n\n    return {\n        parkingRatio: newRatio,\n        avgPriceByType: newAvgPriceByType,\n        rampPlanePriceByFloor: newRampByFloor\n    };\n}\n\nfunction aggregateSalesVelocityAnalysis(velA: any, velB: any) {\n    if (!velB) return velA;\n\n    const allRoomTypes: any = Array.from(new Set([...(velA.allRoomTypes || []), ...(velB.allRoomTypes || [])]));\n    const views = ['monthly', 'quarterly', 'yearly', 'weekly'];\n    const mergedViews: any = {};\n\n    views.forEach(view => {\n        const viewDataA = velA[view] || {};\n        const viewDataB = velB[view] || {};\n        const mergedTimeKeys: any = {};\n        const allTimeKeys = new Set([...Object.keys(viewDataA), ...Object.keys(viewDataB)]);\n\n        allTimeKeys.forEach(timeKey => {\n            const timeObjA = viewDataA[timeKey] || {};\n            const timeObjB = viewDataB[timeKey] || {};\n            const allRooms = new Set([...Object.keys(timeObjA), ...Object.keys(timeObjB)]);\n            const mergedRooms: any = {};\n\n            allRooms.forEach(room => {\n                const dataA = timeObjA[room];\n                const dataB = timeObjB[room];\n\n                if (dataA && dataB) {\n                    const totalCount = dataA.count + dataB.count;\n                    const totalPriceSum = dataA.priceSum + dataB.priceSum;\n                    const totalAreaSum = dataA.areaSum + dataB.areaSum;\n\n                    mergedRooms[room] = {\n                        count: totalCount,\n                        priceSum: totalPriceSum,\n                        areaSum: totalAreaSum,\n                        avgPrice: totalAreaSum > 0 ? totalPriceSum / totalAreaSum : 0\n                    };\n                } else if (dataA) {\n                    mergedRooms[room] = { ...dataA };\n                } else if (dataB) {\n                    mergedRooms[room] = { ...dataB };\n                }\n            });\n            mergedTimeKeys[timeKey] = mergedRooms;\n        });\n        mergedViews[view] = mergedTimeKeys;\n    });\n\n    return {\n        allRoomTypes,\n        ...mergedViews\n    };\n}\n\nfunction aggregateAreaDistributionAnalysis(distA: any, distB: any) {\n    if (!distB) return distA;\n    if (!distA) return distB;\n\n    const merged = { ...distA };\n    Object.keys(distB).forEach(room => {\n        if (merged[room]) {\n            merged[room] = [...merged[room], ...distB[room]];\n        } else {\n            merged[room] = [...distB[room]];\n        }\n    });\n    return merged;\n}\n\nfunction aggregatePriceGridAnalysis(gridA: any, gridB: any) {\n    if (!gridB) return gridA;\n\n    const projectNames = [...(gridA.projectNames || []), ...(gridB.projectNames || [])];\n    const byProject = { ...(gridA.byProject || {}), ...(gridB.byProject || {}) };\n\n    return {\n        projectNames,\n        byProject\n    };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2811, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/store/useFilterStore.ts"],"sourcesContent":["import { create } from 'zustand';\n\ninterface FilterState {\n    counties: string[];\n    districts: string[];\n    transactionType: string;\n    buildingType: string;\n    projectNames: string[];\n    dateRange: string;\n    startDate: string;\n    endDate: string;\n    excludeCommercial: boolean;\n    floorPremium: number;\n\n    setCounties: (counties: string[]) => void;\n    setDistricts: (districts: string[]) => void;\n    setTransactionType: (type: string) => void;\n    setBuildingType: (type: string) => void;\n    setProjectNames: (names: string[]) => void;\n    setDateRange: (range: string, start?: string, end?: string) => void;\n    setCustomDate: (start: string, end: string) => void;\n    setExcludeCommercial: (exclude: boolean) => void;\n    setFloorPremium: (value: number) => void;\n\n    // UI / Report State\n    rankingCurrentPage: number;\n    rankingPageSize: number;\n    currentSort: { key: string; order: 'asc' | 'desc' };\n    currentAverageType: 'arithmetic' | 'weighted';\n    velocityView: 'monthly' | 'quarterly';\n    velocityMetric: 'count' | 'priceSum' | 'areaSum';\n\n    setRankingCurrentPage: (page: number) => void;\n    setRankingPageSize: (size: number) => void;\n    setCurrentSort: (sort: { key: string; order: 'asc' | 'desc' }) => void;\n    setCurrentAverageType: (type: 'arithmetic' | 'weighted') => void;\n    setVelocityView: (view: 'monthly' | 'quarterly') => void;\n    setVelocityMetric: (metric: 'count' | 'priceSum' | 'areaSum') => void;\n\n    resetFilters: () => void;\n}\n\nconst DEFAULT_FILTERS = {\n    counties: [],\n    districts: [],\n    transactionType: '預售交易',\n    buildingType: '',\n    projectNames: [],\n    dateRange: '1y',\n    startDate: '', // Logic to calculate default date should be in component or helper\n    endDate: '',\n    excludeCommercial: false,\n    floorPremium: 0.3,\n\n    // UI Defaults\n    rankingCurrentPage: 1,\n    rankingPageSize: 10,\n    currentSort: { key: 'saleAmountSum', order: 'desc' } as { key: string; order: 'asc' | 'desc' },\n    currentAverageType: 'arithmetic' as 'arithmetic' | 'weighted',\n    velocityView: 'monthly' as 'monthly' | 'quarterly',\n    velocityMetric: 'count' as 'count' | 'priceSum' | 'areaSum'\n};\n\nexport const useFilterStore = create<FilterState>((set) => ({\n    ...DEFAULT_FILTERS,\n\n    setCounties: (counties) => set({ counties, districts: [] }), // Reset districts when county changes\n    setDistricts: (districts) => set({ districts }),\n    setTransactionType: (transactionType) => set({ transactionType }),\n    setBuildingType: (buildingType) => set({ buildingType }),\n    setProjectNames: (projectNames) => set({ projectNames }),\n\n    setDateRange: (dateRange, startDate, endDate) => set((plainState) => {\n        // Only update dates if provided, otherwise keep existing or require calc logic\n        return { dateRange, startDate: startDate || plainState.startDate, endDate: endDate || plainState.endDate };\n    }),\n\n    setCustomDate: (startDate, endDate) => set({ startDate, endDate, dateRange: 'custom' }),\n    setExcludeCommercial: (excludeCommercial) => set({ excludeCommercial }),\n    setFloorPremium: (floorPremium) => set({ floorPremium }),\n\n    setRankingCurrentPage: (rankingCurrentPage) => set({ rankingCurrentPage }),\n    setRankingPageSize: (rankingPageSize) => set({ rankingPageSize }),\n    setCurrentSort: (currentSort) => set({ currentSort }),\n    setCurrentAverageType: (currentAverageType) => set({ currentAverageType }),\n    setVelocityView: (velocityView) => set({ velocityView }),\n    setVelocityMetric: (velocityMetric) => set({ velocityMetric }),\n\n    resetFilters: () => set(DEFAULT_FILTERS)\n}));\n"],"names":[],"mappings":";;;;AAAA;;AA0CA,MAAM,kBAAkB;IACpB,UAAU,EAAE;IACZ,WAAW,EAAE;IACb,iBAAiB;IACjB,cAAc;IACd,cAAc,EAAE;IAChB,WAAW;IACX,WAAW;IACX,SAAS;IACT,mBAAmB;IACnB,cAAc;IAEd,cAAc;IACd,oBAAoB;IACpB,iBAAiB;IACjB,aAAa;QAAE,KAAK;QAAiB,OAAO;IAAO;IACnD,oBAAoB;IACpB,cAAc;IACd,gBAAgB;AACpB;AAEO,MAAM,iBAAiB,IAAA,yLAAM,EAAc,CAAC,MAAQ,CAAC;QACxD,GAAG,eAAe;QAElB,aAAa,CAAC,WAAa,IAAI;gBAAE;gBAAU,WAAW,EAAE;YAAC;QACzD,cAAc,CAAC,YAAc,IAAI;gBAAE;YAAU;QAC7C,oBAAoB,CAAC,kBAAoB,IAAI;gBAAE;YAAgB;QAC/D,iBAAiB,CAAC,eAAiB,IAAI;gBAAE;YAAa;QACtD,iBAAiB,CAAC,eAAiB,IAAI;gBAAE;YAAa;QAEtD,cAAc,CAAC,WAAW,WAAW,UAAY,IAAI,CAAC;gBAClD,+EAA+E;gBAC/E,OAAO;oBAAE;oBAAW,WAAW,aAAa,WAAW,SAAS;oBAAE,SAAS,WAAW,WAAW,OAAO;gBAAC;YAC7G;QAEA,eAAe,CAAC,WAAW,UAAY,IAAI;gBAAE;gBAAW;gBAAS,WAAW;YAAS;QACrF,sBAAsB,CAAC,oBAAsB,IAAI;gBAAE;YAAkB;QACrE,iBAAiB,CAAC,eAAiB,IAAI;gBAAE;YAAa;QAEtD,uBAAuB,CAAC,qBAAuB,IAAI;gBAAE;YAAmB;QACxE,oBAAoB,CAAC,kBAAoB,IAAI;gBAAE;YAAgB;QAC/D,gBAAgB,CAAC,cAAgB,IAAI;gBAAE;YAAY;QACnD,uBAAuB,CAAC,qBAAuB,IAAI;gBAAE;YAAmB;QACxE,iBAAiB,CAAC,eAAiB,IAAI;gBAAE;YAAa;QACtD,mBAAmB,CAAC,iBAAmB,IAAI;gBAAE;YAAe;QAE5D,cAAc,IAAM,IAAI;IAC5B,CAAC"}},
    {"offset": {"line": 2903, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/hooks/useAnalysisData.ts"],"sourcesContent":["\nimport { useState, useCallback } from \"react\";\nimport { api } from \"@/lib/api\";\nimport { useFilterStore } from \"@/store/useFilterStore\";\nimport { COUNTY_CODE_MAP } from \"@/lib/config\";\nimport { getDateRangeDates } from \"@/lib/date-utils\";\nimport { aggregateAnalysisData } from \"@/lib/aggregator\";\n\nexport function useAnalysisData() {\n    const filters = useFilterStore();\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState<string | null>(null);\n    const [analysisData, setAnalysisData] = useState<any>(null);\n\n    const handleAnalyze = useCallback(async () => {\n        setLoading(true);\n        setError(null);\n        setAnalysisData(null); // Clear previous data\n\n        try {\n            // Map county names to codes\n            const countyCodes = filters.counties.map(name => COUNTY_CODE_MAP[name] || name);\n\n            if (countyCodes.length === 0) {\n                setError(\"請至少選擇一個縣市\");\n                setLoading(false);\n                return;\n            }\n\n            // Date handling\n            let { dateRange, startDate, endDate } = filters;\n\n            // Ensure dates are populated if using a preset range but dates are empty\n            if (dateRange !== 'custom' && (!startDate || !endDate)) {\n                const calculated = getDateRangeDates(dateRange);\n                if (calculated.startDate && calculated.endDate) {\n                    startDate = calculated.startDate;\n                    endDate = calculated.endDate;\n                }\n            }\n\n            // Prepare common payload base\n            const basePayload = {\n                districts: filters.districts,\n                transactionType: filters.transactionType,\n                type: filters.transactionType,\n                projectNames: filters.projectNames,\n                buildingType: filters.buildingType,\n                excludeCommercial: filters.excludeCommercial,\n                floorPremium: filters.floorPremium,\n                dateRange,\n                dateStart: startDate,\n                dateEnd: endDate\n            };\n\n            console.log(\"Analyzing with counties:\", countyCodes);\n\n            // Fetch data for all counties in parallel\n            const promises = countyCodes.map(countyCode => {\n                const payload = { ...basePayload, countyCode, counties: [countyCode] };\n                return api.analyzeProjectRanking(payload as any)\n                    .catch(err => {\n                        console.error(`Failed to fetch data for ${countyCode}:`, err);\n                        return null;\n                    });\n            });\n\n            const results = await Promise.all(promises);\n\n            // Aggregate results\n            let totalResult: any = null;\n            let successCount = 0;\n\n            for (const result of results) {\n                // Validate result has expected structure (at least projectRanking/coreMetrics)\n                if (result && result.projectRanking && result.coreMetrics) {\n                    console.log(\"Merging result for county:\", result.projectRanking?.[0]?.county);\n                    totalResult = aggregateAnalysisData(totalResult, result);\n                    successCount++;\n                }\n            }\n\n            console.log(\"Aggregation complete. Total Transaction Details:\", totalResult?.transactionDetails?.length);\n\n            if (successCount === 0) {\n                if (filters.projectNames.length > 0) {\n                    throw new Error(\"這段時間 這個建案查詢不到資料\");\n                }\n                throw new Error(\"無法取得任何縣市的分析數據\");\n            } else if (successCount < countyCodes.length) {\n                // Partial success\n                const failedCount = countyCodes.length - successCount;\n                setError(`注意：有 ${failedCount} 個縣市的資料載入失敗，分析結果可能不完整。`);\n            }\n\n            setAnalysisData(totalResult);\n        } catch (err: any) {\n            console.error(\"Analysis failed:\", err);\n            setError(err.message || \"無法取得分析數據，請稍後再試。\");\n        } finally {\n            setLoading(false);\n        }\n    }, [filters]);\n\n    return { loading, error, analysisData, handleAnalyze, setError, setLoading, setAnalysisData };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3039, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/app/dashboard/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect, useCallback } from \"react\";\nimport { AppLayout } from \"@/components/layout/AppLayout\";\nimport { FilterBar } from \"@/components/features/FilterBar\";\nimport { RankingReport } from \"@/components/reports/RankingReport\";\nimport { PriceBandReport } from \"@/components/reports/PriceBandReport\";\nimport { SalesVelocityReport } from \"@/components/reports/SalesVelocityReport\";\nimport { ParkingAnalysisReport } from \"@/components/reports/ParkingAnalysisReport\";\nimport { UnitPriceAnalysisReport } from \"@/components/reports/UnitPriceAnalysisReport\";\nimport { HeatmapReport } from \"@/components/reports/HeatmapReport\";\nimport { DataListReport } from \"@/components/reports/DataListReport\";\nimport PolicyTimelineReport from \"@/components/reports/PolicyTimelineReport\";\n\nimport { api } from \"@/lib/api\";\nimport { useFilterStore } from \"@/store/useFilterStore\";\nimport { Loader2, AlertCircle } from \"lucide-react\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { COUNTY_CODE_MAP } from \"@/lib/config\";\nimport { getDateRangeDates } from \"@/lib/date-utils\";\n\nimport { aggregateAnalysisData } from \"@/lib/aggregator\";\nimport { useAnalysisData } from \"@/hooks/useAnalysisData\";\n\nexport default function DashboardPage() {\n    const filters = useFilterStore();\n    const {\n        loading,\n        error,\n        analysisData,\n        handleAnalyze\n    } = useAnalysisData();\n\n    // Initial load? Optional.\n    useEffect(() => {\n        // if (filters.counties.length > 0) handleAnalyze();\n    }, []);\n\n    return (\n        <AppLayout>\n            <section className=\"mb-6 sticky top-4 z-30\">\n                <FilterBar onAnalyze={handleAnalyze} isLoading={loading} />\n            </section>\n\n            {error && (\n                <div className=\"bg-red-500/10 border border-red-500/50 text-red-500 p-4 rounded-lg mb-6 flex items-center gap-2\">\n                    <AlertCircle size={20} />\n                    {error}\n                </div>\n            )}\n\n            {loading && (\n                <div className=\"flex flex-col items-center justify-center py-20\">\n                    <Loader2 className=\"h-10 w-10 animate-spin text-violet-500 mb-4\" />\n                    <p className=\"text-zinc-400\">正在分析數據，請稍候...</p>\n                </div>\n            )}\n\n            {!loading && !analysisData && !error && (\n                <div className=\"flex flex-col items-center justify-center py-20 glass-panel border-dashed border-2 border-zinc-800 rounded-xl\">\n                    <div className=\"text-zinc-500 mb-2\">尚未進行分析</div>\n                    <p className=\"text-zinc-600 text-sm\">請選擇篩選條件並點擊「開始分析」</p>\n                </div>\n            )}\n\n            {!loading && analysisData && (\n                <div className=\"space-y-8 pb-20\">\n                    {/* Reports Tabs */}\n                    <Tabs defaultValue=\"ranking\" className=\"w-full\">\n                        <div className=\"overflow-x-auto pb-2 scrollbar-hide\">\n                            <TabsList className=\"bg-zinc-900/50 border border-white/5 p-1 mb-6 inline-flex min-w-max\">\n                                <TabsTrigger value=\"ranking\">核心指標與排名</TabsTrigger>\n                                <TabsTrigger value=\"price-band\">總價帶分析</TabsTrigger>\n                                <TabsTrigger value=\"unit-price\">單價分析</TabsTrigger>\n                                <TabsTrigger value=\"heatmap\">調價熱力圖</TabsTrigger>\n                                <TabsTrigger value=\"timeline\">政策時光機</TabsTrigger>\n                                <TabsTrigger value=\"velocity\">銷售速度與房型</TabsTrigger>\n                                <TabsTrigger value=\"parking\">車位分析</TabsTrigger>\n                                <TabsTrigger value=\"data-list\">交易明細列表</TabsTrigger>\n\n                            </TabsList>\n                        </div>\n\n                        <TabsContent value=\"ranking\" className=\"focus-visible:outline-none focus-visible:ring-0\">\n                            <RankingReport data={analysisData} />\n                        </TabsContent>\n\n                        <TabsContent value=\"price-band\" className=\"focus-visible:outline-none focus-visible:ring-0\">\n                            <PriceBandReport data={{\n                                ...analysisData.priceBandAnalysis,\n                                transactionDetails: analysisData.transactionDetails\n                            }} />\n                        </TabsContent>\n\n                        <TabsContent value=\"unit-price\" className=\"focus-visible:outline-none focus-visible:ring-0\">\n                            <UnitPriceAnalysisReport data={analysisData} />\n                        </TabsContent>\n\n                        <TabsContent value=\"heatmap\" className=\"focus-visible:outline-none focus-visible:ring-0\">\n                            <HeatmapReport data={analysisData} />\n                        </TabsContent>\n\n                        <TabsContent value=\"timeline\" className=\"focus-visible:outline-none focus-visible:ring-0\">\n                            <PolicyTimelineReport data={analysisData.transactionDetails} />\n                        </TabsContent>\n\n                        <TabsContent value=\"velocity\" className=\"focus-visible:outline-none focus-visible:ring-0\">\n                            <SalesVelocityReport data={analysisData} />\n                        </TabsContent>\n\n                        <TabsContent value=\"parking\" className=\"focus-visible:outline-none focus-visible:ring-0\">\n                            <ParkingAnalysisReport data={analysisData} />\n                        </TabsContent>\n\n                        <TabsContent value=\"data-list\" className=\"focus-visible:outline-none focus-visible:ring-0\">\n                            <DataListReport trigger={analysisData} />\n                        </TabsContent>\n                    </Tabs>\n                </div>\n            )}\n\n        </AppLayout>\n    );\n}\n"],"names":[],"mappings":"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"}}]
}