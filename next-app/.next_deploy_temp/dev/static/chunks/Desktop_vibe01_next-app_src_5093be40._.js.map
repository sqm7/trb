{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/lib/supabase.ts"],"sourcesContent":["\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\n\nif (!supabaseUrl || !supabaseKey) {\n    console.error('Missing Supabase URL or Key');\n}\n\nexport const supabase = createClient(supabaseUrl, supabaseKey);\n"],"names":[],"mappings":";;;;AAGoB;AAFpB;;AAEA,MAAM;AACN,MAAM;AAEN;;AAIO,MAAM,WAAW,IAAA,qOAAY,EAAC,aAAa"}},
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/lib/uploader-config.ts"],"sourcesContent":["// uploader-config.ts\n\n// 縣市代碼與中文名稱對照表\nexport const counties: Record<string, string> = {\n    'A': '臺北市', 'B': '臺中市', 'C': '基隆市', 'D': '臺南市', 'E': '高雄市',\n    'F': '新北市', 'G': '宜蘭縣', 'H': '桃園市', 'I': '嘉義市', 'J': '新竹縣',\n    'K': '苗栗縣', 'M': '南投縣', 'N': '彰化縣', 'O': '新竹市', 'P': '雲林縣',\n    'Q': '嘉義縣', 'T': '屏東縣', 'U': '花蓮縣', 'V': '臺東縣', 'W': '金門縣',\n    'X': '澎湖縣', 'Z': '連江縣'\n};\n\n// CSV 欄位與資料庫欄位的對應規則\nexport const columnMappings: Record<string, Record<string, string>> = {\n    'a': { '編號': '編號', '鄉鎮市區': '行政區', '交易標的': '交易標的', '土地位置建物門牌': '地址', '交易年月日': '交易日', '交易筆棟數': '交易筆棟數', '移轉層次': '樓層', '建物型態': '建物型態', '主要用途': '主要用途', '建物移轉總面積平方公尺': '產權面積_房車', '建物現況格局-房': '房數', '建物現況格局-廳': '廳數', '建物現況格局-衛': '衛浴數', '總價元': '交易總價', '車位類別': '車位類別', '車位移轉總面積平方公尺': '車位總面積', '車位總價元': '車位總價', '備註': '備註', '主建物面積': '主建物面積', '附屬建物面積': '附屬建物面積', '陽台面積': '陽台面積' },\n    'a_build': { '編號': '編號', '屋齡': '交易屋齡', '主要建材': '結構', '建築完成年月日': '完工日', '建築完成日期': '完工日', '總層數': '總樓層', '移轉情形': '移轉情形' },\n    'a_land': { '編號': '編號', '土地位置': '地號_段', '地號': '地號', '土地移轉面積平方公尺': '土地持分面積', '使用分區或編定': '使用分區', '非都市土地使用分區': '使用分區', '權利人持分分母': '持分分母', '權利人持分分子': '持分分子' },\n    'a_park': { '編號': '編號', '車位類別': '車位類別', '車位價格': '車位價格', '車位面積平方公尺': '車位面積', '車位所在樓層': '車位樓層' },\n    'b': { '編號': '編號', '鄉鎮市區': '行政區', '交易標的': '交易標的', '土地位置建物門牌': '地址', '交易年月日': '交易日', '交易筆棟數': '交易筆棟數', '移轉層次': '樓層', '總層數': '總樓層', '總樓層數': '總樓層', '建物型態': '建物型態', '主要用途': '主要用途', '建物移轉總面積平方公尺': '產權面積_房車', '建物現況格局-房': '房數', '建物現況格局-廳': '廳數', '建物現況格局-衛': '衛浴數', '總價元': '交易總價', '車位類別': '車位類別', '車位移轉總面積平方公尺': '車位總面積', '車位總價元': '車位總價', '備註': '備註', '建案名稱': '建案名稱', '棟及號': '戶別', '解約情形': '解約情形' },\n    'b_land': { '編號': '編號', '土地位置': '地號_段', '地號': '地號', '土地移轉面積平方公尺': '土地持分面積', '使用分區或編定': '使用分區', '非都市土地使用分區': '使用分區', '權利人持分分母': '持分分母', '權利人持分分子': '持分分子' },\n    'b_park': { '編號': '編號', '車位類別': '車位類別', '車位價格': '車位價格', '車位面積平方公尺': '車位面積', '車位所在樓層': '車位樓層' },\n    'c': { '編號': '編號', '鄉鎮市區': '行政區', '交易標的': '交易標的', '土地位置建物門牌': '地址', '租賃年月日': '交易日', '租賃筆棟數': '交易筆棟數', '租賃層次': '樓層', '建物型態': '建物型態', '主要用途': '主要用途', '建物總面積平方公尺': '租賃面積', '建物現況格局-房': '房數', '建物現況格局-廳': '廳數', '建物現況格局-衛': '衛浴數', '總額元': '交易總價', '車位類別': '車位類別', '車位面積平方公尺': '車位總面積', '車位總額元': '車位總價', '備註': '備註', '出租型態': '出租型態', '租賃期間': '租賃期間', '附屬設備': '附屬設備', '租賃住宅服務': '租賃住宅服務' },\n    'c_build': { '編號': '編號', '屋齡': '交易屋齡', '主要建材': '結構', '建築完成年月日': '完工日', '建築完成日期': '完工日', '總層數': '總樓層', '移轉情形': '移轉情形' },\n    'c_land': { '編號': '編號', '土地位置': '地號_段', '地號': '地號', '土地移轉面積平方公尺': '土地租賃面積', '使用分區或編定': '使用分區', '非都市土地使用分區': '使用分區' },\n    'c_park': { '編號': '編號', '車位類別': '車位類別', '車位價格': '車位價格', '車位面積平方公尺': '車位面積', '車位所在樓層': '車位樓層' }\n};\n"],"names":[],"mappings":"AAAA,qBAAqB;AAErB,eAAe;;;;;;;AACR,MAAM,WAAmC;IAC5C,KAAK;IAAO,KAAK;IAAO,KAAK;IAAO,KAAK;IAAO,KAAK;IACrD,KAAK;IAAO,KAAK;IAAO,KAAK;IAAO,KAAK;IAAO,KAAK;IACrD,KAAK;IAAO,KAAK;IAAO,KAAK;IAAO,KAAK;IAAO,KAAK;IACrD,KAAK;IAAO,KAAK;IAAO,KAAK;IAAO,KAAK;IAAO,KAAK;IACrD,KAAK;IAAO,KAAK;AACrB;AAGO,MAAM,iBAAyD;IAClE,KAAK;QAAE,MAAM;QAAM,QAAQ;QAAO,QAAQ;QAAQ,YAAY;QAAM,SAAS;QAAO,SAAS;QAAS,QAAQ;QAAM,QAAQ;QAAQ,QAAQ;QAAQ,eAAe;QAAW,YAAY;QAAM,YAAY;QAAM,YAAY;QAAO,OAAO;QAAQ,QAAQ;QAAQ,eAAe;QAAS,SAAS;QAAQ,MAAM;QAAM,SAAS;QAAS,UAAU;QAAU,QAAQ;IAAO;IAC9W,WAAW;QAAE,MAAM;QAAM,MAAM;QAAQ,QAAQ;QAAM,WAAW;QAAO,UAAU;QAAO,OAAO;QAAO,QAAQ;IAAO;IACrH,UAAU;QAAE,MAAM;QAAM,QAAQ;QAAQ,MAAM;QAAM,cAAc;QAAU,WAAW;QAAQ,aAAa;QAAQ,WAAW;QAAQ,WAAW;IAAO;IACzJ,UAAU;QAAE,MAAM;QAAM,QAAQ;QAAQ,QAAQ;QAAQ,YAAY;QAAQ,UAAU;IAAO;IAC7F,KAAK;QAAE,MAAM;QAAM,QAAQ;QAAO,QAAQ;QAAQ,YAAY;QAAM,SAAS;QAAO,SAAS;QAAS,QAAQ;QAAM,OAAO;QAAO,QAAQ;QAAO,QAAQ;QAAQ,QAAQ;QAAQ,eAAe;QAAW,YAAY;QAAM,YAAY;QAAM,YAAY;QAAO,OAAO;QAAQ,QAAQ;QAAQ,eAAe;QAAS,SAAS;QAAQ,MAAM;QAAM,QAAQ;QAAQ,OAAO;QAAM,QAAQ;IAAO;IAClY,UAAU;QAAE,MAAM;QAAM,QAAQ;QAAQ,MAAM;QAAM,cAAc;QAAU,WAAW;QAAQ,aAAa;QAAQ,WAAW;QAAQ,WAAW;IAAO;IACzJ,UAAU;QAAE,MAAM;QAAM,QAAQ;QAAQ,QAAQ;QAAQ,YAAY;QAAQ,UAAU;IAAO;IAC7F,KAAK;QAAE,MAAM;QAAM,QAAQ;QAAO,QAAQ;QAAQ,YAAY;QAAM,SAAS;QAAO,SAAS;QAAS,QAAQ;QAAM,QAAQ;QAAQ,QAAQ;QAAQ,aAAa;QAAQ,YAAY;QAAM,YAAY;QAAM,YAAY;QAAO,OAAO;QAAQ,QAAQ;QAAQ,YAAY;QAAS,SAAS;QAAQ,MAAM;QAAM,QAAQ;QAAQ,QAAQ;QAAQ,QAAQ;QAAQ,UAAU;IAAS;IACpX,WAAW;QAAE,MAAM;QAAM,MAAM;QAAQ,QAAQ;QAAM,WAAW;QAAO,UAAU;QAAO,OAAO;QAAO,QAAQ;IAAO;IACrH,UAAU;QAAE,MAAM;QAAM,QAAQ;QAAQ,MAAM;QAAM,cAAc;QAAU,WAAW;QAAQ,aAAa;IAAO;IACnH,UAAU;QAAE,MAAM;QAAM,QAAQ;QAAQ,QAAQ;QAAQ,YAAY;QAAQ,UAAU;IAAO;AACjG"}},
    {"offset": {"line": 203, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/lib/uploader-utils.ts"],"sourcesContent":["import { columnMappings } from './uploader-config';\n\n/**\n * 清理並轉換字串或數字為純數字型別\n */\nfunction cleanNumber(value: string | number | null | undefined): number | null {\n    if (typeof value !== 'string' && typeof value !== 'number') return null;\n    const cleaned = String(value).replace(/,/g, '');\n    const num = parseFloat(cleaned);\n    return isNaN(num) ? null : num;\n}\n\n/**\n * 將民國年字串 (例如 \"1130101\") 轉換為西元年日期格式 (\"YYYY-MM-DD\")\n */\nfunction rocToDate(rocDateStr: string | number | null | undefined): string | null {\n    if (!rocDateStr) return null;\n    const match = String(rocDateStr).match(/(\\d{2,3})[^\\d]*(\\d{1,2})[^\\d]*(\\d{1,2})/);\n    if (!match) return null;\n    try {\n        const rocYear = parseInt(match[1], 10);\n        const month = parseInt(match[2], 10);\n        const day = parseInt(match[3], 10);\n        if (isNaN(rocYear) || isNaN(month) || isNaN(day)) return null;\n        const adYear = rocYear + 1911;\n        const monthStr = String(month).padStart(2, '0');\n        const dayStr = String(day).padStart(2, '0');\n        const date = new Date(`${adYear}-${monthStr}-${dayStr}`);\n        // 驗證日期是否有效\n        if (isNaN(date.getTime()) || date.getDate() !== day) return null;\n        return `${adYear}-${monthStr}-${dayStr}`;\n    } catch (e) {\n        return null;\n    }\n}\n\n/**\n * 將中文樓層字串 (例如 \"十一層\", \"地下層\") 轉換為數字\n */\nfunction chineseFloorToNumber(floorStr: string | null | undefined): number | null {\n    if (!floorStr || typeof floorStr !== 'string') return null;\n    const s = String(floorStr).replace(/層|樓/g, '');\n    const charMap: Record<string, number> = { '一': 1, '二': 2, '三': 3, '四': 4, '五': 5, '六': 6, '七': 7, '八': 8, '九': 9, '十': 10 };\n    if (!isNaN(parseInt(s))) return parseInt(s, 10);\n    if (s.includes('地下')) return -1;\n\n    let total = 0;\n    if (s.startsWith('十')) {\n        total = 10 + (charMap[s[1]] || 0);\n    } else if (s.includes('十')) {\n        const parts = s.split('十');\n        const part0 = charMap[parts[0]] || 1;\n        const part1 = charMap[parts[1]] || 0;\n        total = part0 * 10 + part1;\n    } else {\n        total = charMap[s] || 0;\n    }\n    return total > 0 ? total : null;\n}\n\n/**\n * 根據欄位對應規則，處理單筆 CSV 資料\n */\nexport function processRow(row: any, mapping: Record<string, string>): any {\n    const newRow: any = {};\n    const targetDbColumns = Array.from(new Set(Object.values(mapping)));\n    targetDbColumns.forEach(col => newRow[col] = null);\n\n    for (const csvHeader in row) {\n        const dbColumn = mapping[csvHeader.trim()];\n        if (dbColumn) {\n            let value = row[csvHeader];\n            if (value === undefined || value === '' || value === null) continue;\n\n            if (dbColumn === '樓層' || dbColumn === '總樓層') {\n                newRow[dbColumn] = chineseFloorToNumber(value);\n            } else if (dbColumn.includes('日')) {\n                newRow[dbColumn] = rocToDate(String(value));\n            } else if (['交易總價', '車位總價', '房數', '廳數', '衛浴數', '持分分母', '持分分子', '交易屋齡', '車位價格'].includes(dbColumn)) {\n                newRow[dbColumn] = cleanNumber(value); // parseInt removed, consistent with float handling or pure int handled by cleanNumber returning number\n            } else if (dbColumn.includes('面積')) {\n                newRow[dbColumn] = cleanNumber(value);\n            } else {\n                newRow[dbColumn] = String(value);\n            }\n        }\n    }\n    return newRow;\n}\n\n/**\n * 比較兩筆紀錄在指定欄位上是否相同\n */\nexport function isEqual(objA: any, objB: any, tableType: string): boolean {\n    const mapping = columnMappings[tableType];\n    if (!mapping) return false;\n\n    const keysToCheck = Object.values(mapping);\n    for (const key of keysToCheck) {\n        if (key === 'id' || key === '建案名稱') continue;\n        const valA = objA[key];\n        const valB = objB[key];\n\n        if (valA === null || valA === undefined || valA === '') continue;\n\n        const strValA = valA !== null && valA !== undefined ? String(valA) : '';\n        const strValB = valB !== null && valB !== undefined ? String(valB) : '';\n\n        // 對於浮點數（面積），使用容錯比較\n        if (key.includes('面積')) {\n            const numA = cleanNumber(valA) || 0;\n            const numB = cleanNumber(valB) || 0;\n            if (Math.abs(numA - numB) > 0.001) return false;\n        } else {\n            if (strValA !== strValB) return false;\n        }\n    }\n    return true;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 336, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/lib/file-handler.ts"],"sourcesContent":["import Papa from 'papaparse';\nimport { columnMappings } from './uploader-config';\nimport { processRow } from './uploader-utils';\n\nexport interface FileInfo {\n    handle: FileSystemFileHandle;\n    name: string;\n    fullPath: string;\n    countyCode: string;\n    tableType: string;\n    isMain: boolean;\n}\n\n/**\n * 遞迴掃描指定目錄，找出所有 .csv 檔案\n */\nexport async function scanDirectory(dirHandle: FileSystemDirectoryHandle, path = ''): Promise<FileInfo[]> {\n    let files: FileInfo[] = [];\n    // @ts-ignore - FileSystemDirectoryHandle iteration types might be missing in older TS/DOM lib\n    for await (const entry of dirHandle.values()) {\n        const currentPath = path ? `${path}/${entry.name}` : entry.name;\n        if (entry.kind === 'file' && entry.name.toLowerCase().endsWith('.csv')) {\n            const fileRegex = /^([a-z])_lvr_land_([a-c](?:_build|_land|_park)?)\\.csv$/i;\n            const match = entry.name.match(fileRegex);\n\n            if (match) {\n                files.push({\n                    handle: entry as FileSystemFileHandle,\n                    name: entry.name,\n                    fullPath: currentPath,\n                    countyCode: match[1].toLowerCase(),\n                    tableType: match[2].toLowerCase(),\n                    isMain: !match[2].includes('_')\n                });\n            }\n\n        } else if (entry.kind === 'directory') {\n            files.push(...await scanDirectory(entry as FileSystemDirectoryHandle, currentPath));\n        }\n    }\n    return files;\n}\n\n/**\n * 使用 PapaParse 解析單一 CSV 檔案的內容\n */\nexport async function parseFile(fileInfo: FileInfo, projectNameMappings?: Map<string, string>, onLog?: (msg: string, type: 'info' | 'warning' | 'error') => void): Promise<any[]> {\n    const file = await fileInfo.handle.getFile();\n\n    const parseResult = await new Promise<Papa.ParseResult<any>>((resolve) => {\n        Papa.parse(file, {\n            header: true,\n            skipEmptyLines: true,\n            transformHeader: (header) => header.trim(), // Ensure headers are trimmed\n            complete: resolve\n        });\n    });\n\n    if (parseResult.errors && parseResult.errors.length > 0) {\n        const nonCriticalErrorCodes = ['TooManyFields', 'TooFewFields', 'MissingQuotes'];\n        const criticalErrors = parseResult.errors.filter(e => !nonCriticalErrorCodes.includes(e.code));\n\n        if (criticalErrors.length > 0) {\n            throw new Error(`CSV 嚴重解析錯誤: ${criticalErrors[0].message}`);\n        }\n\n        if (onLog) {\n            parseResult.errors.forEach(warning => {\n                onLog(`檔案 ${fileInfo.fullPath} 有解析警告 (已忽略): ${warning.message} (行: ${(warning.row || 0) + 2})`, 'warning');\n            });\n        }\n    }\n\n    if (!parseResult.data || parseResult.data.length === 0) {\n        return [];\n    }\n\n    let dataRows = parseResult.data;\n    // 移除 CSV 檔案中可能存在的英文標頭行\n    if (dataRows[0]['編號']?.toLowerCase().includes('serial number')) {\n        dataRows.shift();\n    }\n\n    const mapping = columnMappings[fileInfo.tableType];\n    if (!mapping) {\n        throw new Error(`檔案 ${fileInfo.name} 找不到對應的欄位規則。`);\n    }\n\n    // 遍歷每一行資料，並使用 processRow 進行格式轉換\n    let processedData = dataRows.map(row => processRow(row, mapping));\n\n    // 套用建案名稱自動替換對應\n    if (projectNameMappings && projectNameMappings.size > 0) {\n        let replacementCount = 0;\n        processedData = processedData.map(row => {\n            const originalName = row['建案名稱'];\n            if (originalName && projectNameMappings.has(originalName)) {\n                const newName = projectNameMappings.get(originalName);\n                if (newName) {\n                    row['建案名稱'] = newName;\n                    replacementCount++;\n                }\n            }\n            return row;\n        });\n        if (replacementCount > 0 && onLog) {\n            onLog(`已自動替換 ${replacementCount} 筆建案名稱`, 'info');\n        }\n    }\n\n    return processedData;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 439, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/lib/uploader-service.ts"],"sourcesContent":["import { supabase } from './supabase';\nimport { isEqual } from './uploader-utils';\nimport { parseFile, FileInfo } from './file-handler';\n\nexport interface UploadSummary {\n    new: number;\n    updated: number;\n    identical: number;\n    subAdded: number;\n    errors: number;\n    warnings: number;\n    newRecords: any[];\n    updatedRecords: any[];\n    identicalRecords: any[];\n}\n\nexport type LogCallback = (msg: string, type: 'info' | 'success' | 'warning' | 'error') => void;\nexport type ProgressCallback = (current: number, total: number, phase: string) => void;\n\n\nlet projectNameMappings: Map<string, string> = new Map();\nlet processedMainIds: Set<string> = new Set();\nlet currentSummary: UploadSummary = {\n    new: 0, updated: 0, identical: 0, subAdded: 0, errors: 0, warnings: 0,\n    newRecords: [], updatedRecords: [], identicalRecords: []\n};\n\nexport function resetUploaderState() {\n    processedMainIds = new Set();\n    currentSummary = {\n        new: 0, updated: 0, identical: 0, subAdded: 0, errors: 0, warnings: 0,\n        newRecords: [], updatedRecords: [], identicalRecords: []\n    };\n}\n\nexport function getUploadSummary() {\n    return currentSummary;\n}\n\n/**\n * 載入所有建案名稱對應\n */\nexport async function getProjectNameMappings(onLog?: LogCallback) {\n    try {\n        const { data, error } = await supabase.from('project_name_mappings').select('old_name, new_name');\n\n        if (error) {\n            if (onLog) onLog(`載入建案名稱對應失敗: ${error.message}`, 'warning');\n            return new Map();\n        }\n\n        const mappings = new Map<string, string>();\n        data?.forEach((row: any) => {\n            mappings.set(row.old_name, row.new_name);\n        });\n\n        if (onLog) onLog(`已載入 ${mappings.size} 筆建案名稱對應規則`, 'info');\n        projectNameMappings = mappings;\n        return mappings;\n    } catch (e: any) {\n        if (onLog) onLog(`載入建案名稱對應時發生錯誤: ${e.message}`, 'warning');\n        return new Map();\n    }\n}\n\n\n/**\n * 上傳主表檔案，並進行智慧更新檢查\n */\nexport async function uploadMainFileWithSmartUpdate(fileInfo: FileInfo, onLog: LogCallback) {\n    try {\n        const tableName = `${fileInfo.countyCode}_lvr_land_${fileInfo.tableType}`;\n        // Load mappings if not loaded? Assume loaded via page init\n        const processedData = await parseFile(fileInfo, projectNameMappings, (msg, type) => onLog(msg, type as any));\n\n        if (!processedData || processedData.length === 0) {\n            onLog(`${fileInfo.fullPath}: 檔案為空或無有效資料，已跳過`, 'warning');\n            return;\n        }\n\n        const chunkSize = 500;\n        for (let i = 0; i < processedData.length; i += chunkSize) {\n            const chunk = processedData.slice(i, i + chunkSize);\n            const idsToCheck = chunk.map(row => row['編號']);\n            const { data: existingData, error: fetchError } = await supabase.from(tableName).select('*').in('編號', idsToCheck);\n\n            if (fetchError) throw fetchError;\n\n            const existingDataMap = new Map((existingData || []).map(item => [item['編號'], item]));\n            const newData: any[] = [];\n            const updatedData: any[] = [];\n            const idsToDeleteForUpdate: string[] = [];\n            let identicalCount = 0;\n\n            for (const newRecord of chunk) {\n                const existingRecord = existingDataMap.get(newRecord['編號']);\n                if (!existingRecord) {\n                    newData.push(newRecord);\n                    currentSummary.newRecords.push(newRecord);\n                } else if (!isEqual(newRecord, existingRecord, fileInfo.tableType)) {\n                    idsToDeleteForUpdate.push(newRecord['編號']);\n                    updatedData.push(newRecord);\n                    currentSummary.updatedRecords.push({ oldData: existingRecord, newData: newRecord });\n                } else {\n                    identicalCount++;\n                    currentSummary.identicalRecords.push(existingRecord);\n                }\n            }\n\n            onLog(`${fileInfo.fullPath} (區塊 ${Math.floor(i / chunkSize) + 1}): 新增 ${newData.length}, 更新 ${updatedData.length}, 跳過 ${identicalCount}`, 'info');\n            currentSummary.new += newData.length;\n            currentSummary.updated += updatedData.length;\n            currentSummary.identical += identicalCount;\n\n            const idsToProcess = [...newData.map(r => r['編號']), ...updatedData.map(r => r['編號'])];\n            idsToProcess.forEach(id => processedMainIds.add(id));\n\n            if (idsToDeleteForUpdate.length > 0) {\n                const { error: deleteError } = await supabase.from(tableName).delete().in('編號', idsToDeleteForUpdate);\n                if (deleteError) throw deleteError;\n            }\n\n            const dataToUpload = [...newData, ...updatedData];\n            if (dataToUpload.length > 0) {\n                const { error: insertError } = await supabase.from(tableName).insert(dataToUpload);\n                if (insertError) throw insertError;\n            }\n        }\n    } catch (error: any) {\n        onLog(`${fileInfo.fullPath} 上傳失敗: ${error.message}`, 'error');\n        currentSummary.errors++;\n    }\n}\n\n/**\n * 上傳附表檔案\n */\nexport async function uploadSubFile(fileInfo: FileInfo, onLog: LogCallback) {\n    try {\n        const tableName = `${fileInfo.countyCode}_lvr_land_${fileInfo.tableType}`;\n        const allSubData = await parseFile(fileInfo, projectNameMappings, (msg, type) => onLog(msg, type as any));\n\n        if (!allSubData || allSubData.length === 0) {\n            onLog(`${fileInfo.fullPath}: 檔案為空或無有效資料，已跳過`, 'warning');\n            return;\n        }\n\n        const dataToUpload = allSubData.filter(row => processedMainIds.has(row['編號']));\n\n        if (dataToUpload.length > 0) {\n            const { error } = await supabase.from(tableName).insert(dataToUpload);\n            if (error) throw error;\n            currentSummary.subAdded += dataToUpload.length;\n            onLog(`${fileInfo.fullPath}: 成功新增 ${dataToUpload.length} 筆關聯的附表紀錄`, 'success');\n        } else {\n            onLog(`${fileInfo.fullPath}: 無對應的主表變更，已跳過`, 'info');\n        }\n    } catch (error: any) {\n        onLog(`${fileInfo.fullPath} 上傳失敗: ${error.message}`, 'error');\n        currentSummary.errors++;\n    }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 602, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/app/admin/uploader/admin-service.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\n// Helper to create a dynamic client based on user input\nfunction createDynamicClient(supabaseUrl: string, supabaseKey: string) {\n    if (!supabaseUrl || !supabaseKey) {\n        throw new Error('請提供完整的 Supabase URL 和 Service Role Key');\n    }\n    return createClient(supabaseUrl, supabaseKey, {\n        auth: {\n            persistSession: false,\n        },\n    });\n}\n\n/**\n * 從 Supabase 查詢符合條件的資料\n */\nexport async function searchData(\n    countyCode: string,\n    transactionType: string,\n    searchField: string,\n    keyword: string,\n    dbConfig: { url: string; key: string }\n) {\n    try {\n        const supabase = createDynamicClient(dbConfig.url, dbConfig.key);\n\n        const tableName = `${countyCode.toLowerCase()}_lvr_land_${transactionType}`;\n        console.log(`[AdminService] Searching ${tableName} for ${searchField} like %${keyword}%`);\n\n        const { data, error } = await supabase\n            .from(tableName)\n            .select('*')\n            .ilike(searchField, `%${keyword}%`)\n            .limit(100); // Limit to 100 for performance in UI\n\n        if (error) throw error;\n\n        return { success: true, data, tableName };\n    } catch (error: any) {\n        console.error('Search error:', error);\n        return { success: false, error: error.message };\n    }\n}\n\n/**\n * 批次更新 Supabase 中的資料\n */\nexport async function batchUpdateData(\n    tableName: string,\n    ids: string[],\n    fieldToUpdate: string,\n    newValue: string,\n    oldValue: string | null,\n    district: string | null,\n    city: string | null,\n    dbConfig: { url: string; key: string }\n) {\n    try {\n        const supabase = createDynamicClient(dbConfig.url, dbConfig.key);\n\n        if (!ids || ids.length === 0) {\n            throw new Error('沒有選擇任何要更新的資料');\n        }\n\n        const updateObject = {\n            [fieldToUpdate]: newValue === '' ? null : newValue,\n        };\n\n        console.log(`[AdminService] Batch updating ${tableName}, Count: ${ids.length}, Field: ${fieldToUpdate}`);\n\n        const { error } = await supabase\n            .from(tableName)\n            .update(updateObject)\n            .in('編號', ids);\n\n        if (error) throw error;\n\n        // Check for Project Name Mapping Logic\n        // Condition: Updating '建案名稱', old value exists, new value is different, AND old value has '?'\n        const hasEncodingIssue = oldValue && oldValue.includes('?');\n        if (\n            fieldToUpdate === '建案名稱' &&\n            oldValue &&\n            newValue &&\n            oldValue !== newValue &&\n            hasEncodingIssue\n        ) {\n            console.log(`[AdminService] Detected encoding fix (old: ${oldValue}, new: ${newValue}). Saving mapping.`);\n            await saveProjectNameMapping(oldValue, newValue, district, city, supabase);\n        }\n\n        return { success: true, count: ids.length };\n    } catch (error: any) {\n        console.error('Batch update error:', error);\n        return { success: false, error: error.message };\n    }\n}\n\n/**\n * 儲存建案名稱對應 (Internal Helper)\n */\nasync function saveProjectNameMapping(\n    oldName: string,\n    newName: string,\n    district: string | null,\n    city: string | null,\n    supabase: any\n) {\n    try {\n        const insertData: any = {\n            old_name: oldName,\n            new_name: newName,\n            updated_at: new Date().toISOString(),\n        };\n\n        if (district) insertData.district = district;\n        if (city) insertData.city = city;\n\n        const { error } = await supabase\n            .from('project_name_mappings')\n            .upsert(insertData, {\n                onConflict: 'old_name',\n            });\n\n        if (error) {\n            console.error('Failed to save mapping:', error);\n        }\n    } catch (e) {\n        console.error('Error saving mapping:', e);\n    }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 700, "column": 0}, "map": {"version":3,"sources":["file:///Users/ktpro/Desktop/vibe01/next-app/src/app/admin/uploader/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport { supabase } from '@/lib/supabase';\nimport { scanDirectory, FileInfo } from '@/lib/file-handler';\nimport {\n    uploadMainFileWithSmartUpdate,\n    uploadSubFile,\n    resetUploaderState,\n    getProjectNameMappings,\n    getUploadSummary,\n    UploadSummary\n} from '@/lib/uploader-service';\nimport { useRouter } from 'next/navigation';\nimport { counties, columnMappings } from '@/lib/uploader-config';\nimport { searchData, batchUpdateData } from './admin-service';\n\ninterface LogEntry {\n    id: number;\n    text: string;\n    type: 'info' | 'success' | 'warning' | 'error';\n    time: string;\n}\n\nexport default function UploaderPage() {\n    const router = useRouter();\n    const [logs, setLogs] = useState<LogEntry[]>([]);\n    const [isUploading, setIsUploading] = useState(false);\n    const [files, setFiles] = useState<FileInfo[]>([]);\n    const [uploadType, setUploadType] = useState('all');\n    const [currentFile, setCurrentFile] = useState('');\n    const [progress, setProgress] = useState(0);\n    const [summary, setSummary] = useState<UploadSummary | null>(null);\n\n    // Database Config State\n    const [dbUrl, setDbUrl] = useState('');\n    const [dbKey, setDbKey] = useState('');\n    const [isConnected, setIsConnected] = useState(false);\n\n    // Batch Update State\n    const [updateCounty, setUpdateCounty] = useState('f'); // Default to New Taipei (F) as per legacy\n    const [updateType, setUpdateType] = useState('b'); // Default to Presale (B)\n    const [updateSearchField, setUpdateSearchField] = useState('建案名稱');\n    const [updateKeyword, setUpdateKeyword] = useState('');\n    const [searchResults, setSearchResults] = useState<any[]>([]);\n    const [showUpdateModal, setShowUpdateModal] = useState(false);\n    const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());\n    const [batchUpdateField, setBatchUpdateField] = useState('建案名稱');\n    const [batchUpdateValue, setBatchUpdateValue] = useState('');\n    const [isSearching, setIsSearching] = useState(false);\n    const [isBatchUpdating, setIsBatchUpdating] = useState(false);\n    const [currentUpdateContext, setCurrentUpdateContext] = useState<{ tableName: string, city: string } | null>(null);\n    const [expandedRows, setExpandedRows] = useState<Set<number>>(new Set());\n    const [showModalSearch, setShowModalSearch] = useState(false);\n\n    // Initial Auth Check (Optional - relax requirement)\n    useEffect(() => {\n        const checkAuth = async () => {\n            await supabase.auth.getSession();\n            // If logged in, maybe pre-fill or just show connected status if we assume env vars?\n            // For now, we follow legacy: require manual input or use env vars as default if available\n            // We do NOT pre-fill the Service Role Key nor the URL for security/privacy reasons.\n            // Users must paste it manually to ensure it's not exposed in client-side code.\n            // if (process.env.NEXT_PUBLIC_SUPABASE_URL) setDbUrl(process.env.NEXT_PUBLIC_SUPABASE_URL);\n        };\n        checkAuth();\n    }, []);\n\n    const addLog = (text: string, type: 'info' | 'success' | 'warning' | 'error') => {\n        const time = new Date().toLocaleTimeString();\n        setLogs(prev => [...prev, { id: Date.now() + Math.random(), text, type, time }]);\n    };\n\n    const handleTestConnection = async () => {\n        if (!dbUrl || !dbKey) {\n            addLog('請填寫完整的 Supabase URL 和 Service Role Key。', 'error');\n            return;\n        }\n        addLog('正在測試連線...', 'info');\n        try {\n            // Re-initialize client with manual keys if needed, or just test current\n            // Here we might need to dynamically create a client if we want to support custom keys\n            // For this version, let's assume we update the global client or just verify connectivity\n            // Note: In a real \"custom key\" scenario, we'd need a way to pass this client to the service\n            // For now, purely purely testing reachability:\n            const { error } = await supabase.from('county_codes').select('code', { count: 'exact', head: true });\n\n            // Legacy code ignores 42P01 (undefined table) as success? \n            // \"if (error && error.code !== '42P01') throw error;\"\n\n            if (error && error.code !== '42P01') throw error;\n\n            addLog('連線成功！', 'success');\n            setIsConnected(true);\n\n            // Load mappings\n            getProjectNameMappings((msg, type) => addLog(msg, type));\n\n        } catch (error: any) {\n            addLog(`連線失敗: ${error.message}`, 'error');\n            setIsConnected(false);\n        }\n    };\n\n    const handleSelectFolders = async () => {\n        setLogs([]);\n        setFiles([]);\n        setSummary(null);\n\n        try {\n            // @ts-expect-error - showDirectoryPicker is experimental\n            if (!window.showDirectoryPicker) {\n                addLog('您的瀏覽器不支援資料夾選擇功能，請使用 Chrome 或 Edge。', 'error');\n                return;\n            }\n\n            addLog('正在掃描資料夾...', 'info');\n            // @ts-expect-error - showDirectoryPicker is experimental\n            const dirHandle = await window.showDirectoryPicker();\n            const scannedFiles = await scanDirectory(dirHandle);\n\n            if (scannedFiles.length === 0) {\n                addLog('在選擇的資料夾中沒有找到符合命名規則的檔案。', 'warning');\n                return;\n            }\n\n            setFiles(scannedFiles);\n            addLog(`掃描完成！找到 ${scannedFiles.length} 個有效檔案。`, 'success');\n        } catch (err: any) {\n            if (err.name !== 'AbortError') {\n                addLog(`選擇資料夾時發生錯誤: ${err.message}`, 'error');\n            }\n        }\n    };\n\n    const handleStartUpload = async () => {\n        if (files.length === 0) return;\n        if (!isConnected) {\n            addLog('請先確認資料庫連線成功。', 'error');\n            return;\n        }\n\n        setIsUploading(true);\n        resetUploaderState();\n        setLogs([]);\n\n        addLog('開始上傳任務...', 'info');\n\n        const typeNameMap: Record<string, string> = { 'all': '全選', 'a': '中古', 'b': '預售', 'c': '租賃' };\n        let filesToUpload = files;\n        if (uploadType !== 'all') {\n            filesToUpload = files.filter(file => file.tableType.startsWith(uploadType));\n        }\n\n        if (filesToUpload.length === 0) {\n            addLog(`找不到符合「${typeNameMap[uploadType]}」類型的檔案...`, 'warning');\n            setIsUploading(false);\n            return;\n        }\n\n        const mainTables = filesToUpload.filter(f => f.isMain);\n        const subTables = filesToUpload.filter(f => !f.isMain);\n\n        // Phase 1: Main Tables\n        addLog(`--- 階段 1: 主表 (智慧更新) ---`, 'info');\n        for (let i = 0; i < mainTables.length; i++) {\n            const file = mainTables[i];\n            setCurrentFile(file.fullPath);\n            setProgress(Math.round(((i) / mainTables.length) * 100));\n            await uploadMainFileWithSmartUpdate(file, addLog);\n        }\n\n        // Phase 2: Sub Tables\n        addLog(`--- 階段 2: 附表 (智慧連動) ---`, 'info');\n        for (let i = 0; i < subTables.length; i++) {\n            const file = subTables[i];\n            setCurrentFile(file.fullPath);\n            setProgress(Math.round(((i) / subTables.length) * 100));\n            await uploadSubFile(file, addLog);\n        }\n\n        setCurrentFile('');\n        setProgress(100);\n\n        const finalSummary = getUploadSummary();\n        setSummary(finalSummary);\n        addLog(`所有檔案處理完成！新增: ${finalSummary.new}, 更新: ${finalSummary.updated}, 錯誤: ${finalSummary.errors}`, 'success');\n\n        setIsUploading(false);\n    };\n\n    // --- Batch Update Handlers ---\n    const handleSearch = async () => {\n        if (!dbUrl || !dbKey) {\n            addLog('請先填寫資料庫連線資訊 (URL & Key)', 'error');\n            return;\n        }\n        if (!updateKeyword.trim()) {\n            addLog('請輸入搜尋關鍵字', 'warning');\n            return;\n        }\n\n        setIsSearching(true);\n        setLogs([]); // Optional: clear logs or keep them\n        addLog(`正在搜尋: ${counties[updateCounty.toUpperCase()]} ${updateType} ${updateSearchField} containing \"${updateKeyword}\"...`, 'info');\n\n        try {\n            const result = await searchData(\n                updateCounty,\n                updateType,\n                updateSearchField,\n                updateKeyword.trim(),\n                { url: dbUrl, key: dbKey }\n            );\n\n            if (result.success && result.data) {\n                setSearchResults(result.data);\n                setCurrentUpdateContext({\n                    tableName: result.tableName!,\n                    city: counties[updateCounty.toUpperCase()]\n                });\n                setShowUpdateModal(true);\n                setSelectedIds(new Set()); // Reset selection\n                addLog(`搜尋完成，找到 ${result.data.length} 筆資料`, 'success');\n            } else {\n                addLog(`搜尋失敗: ${result.error}`, 'error');\n            }\n        } catch (e: any) {\n            addLog(`搜尋發生錯誤: ${e.message}`, 'error');\n        } finally {\n            setIsSearching(false);\n        }\n    };\n\n    const handleExecuteBatchUpdate = async () => {\n        if (!currentUpdateContext || selectedIds.size === 0) return;\n\n        // Find one sample for old value (legacy logic uses the first selected)\n        let oldValue = null;\n        let district = null;\n\n        // If updating '建案名稱', try to find old value from the first selected record\n        if (batchUpdateField === '建案名稱') {\n            const firstId = Array.from(selectedIds)[0];\n            const record = searchResults.find(r => r['編號'] === firstId);\n            if (record) {\n                oldValue = record['建案名稱'];\n                district = record['行政區'];\n            }\n        }\n\n        setIsBatchUpdating(true);\n        addLog(`開始批次更新 ${selectedIds.size} 筆資料...`, 'info');\n\n        try {\n            const result = await batchUpdateData(\n                currentUpdateContext.tableName,\n                Array.from(selectedIds),\n                batchUpdateField,\n                batchUpdateValue,\n                oldValue,\n                district,\n                currentUpdateContext.city,\n                { url: dbUrl, key: dbKey }\n            );\n\n            if (result.success) {\n                addLog(`成功更新 ${result.count} 筆資料！`, 'success');\n                setShowUpdateModal(false);\n                // Optionally re-search to show updated results? \n                // For now just close modal as per legacy\n            } else {\n                addLog(`批次更新失敗: ${result.error}`, 'error');\n            }\n        } catch (e: any) {\n            addLog(`批次更新發生錯誤: ${e.message}`, 'error');\n        } finally {\n            setIsBatchUpdating(false);\n        }\n    };\n\n    // Toggle checkbox\n    const toggleSelection = (id: string) => {\n        const newSet = new Set(selectedIds);\n        if (newSet.has(id)) newSet.delete(id);\n        else newSet.add(id);\n        setSelectedIds(newSet);\n    };\n\n    // Toggle All\n    const toggleSelectAll = () => {\n        if (selectedIds.size === searchResults.length) {\n            setSelectedIds(new Set());\n        } else {\n            setSelectedIds(new Set(searchResults.map(r => r['編號'])));\n        }\n    };\n\n    // Toggle Details Row\n    const toggleDetails = (index: number) => {\n        const newSet = new Set(expandedRows);\n        if (newSet.has(index)) newSet.delete(index);\n        else newSet.add(index);\n        setExpandedRows(newSet);\n    };\n\n    return (\n        <div className=\"min-h-screen bg-[#1a1d29] text-gray-100 p-8 font-sans\">\n            <div className=\"max-w-7xl mx-auto space-y-8\">\n\n                {/* Header */}\n                <div className=\"flex justify-between items-center bg-[#252836] p-6 rounded-xl border border-gray-700 shadow-lg\">\n                    <div>\n                        <h1 className=\"text-3xl font-extrabold text-white tracking-tight\">平米內參 <span className=\"text-cyan-400\">資料上傳工具</span></h1>\n                        <p className=\"text-gray-400 mt-2 text-sm\">高效能、智慧化的實價登錄資料批次處理系統 v2.0 (Next.js)</p>\n                    </div>\n                    <button onClick={() => router.push('/')} className=\"text-gray-400 hover:text-white transition-colors flex items-center gap-2\">\n                        <i className=\"fas fa-arrow-left\" /> 返回儀表板\n                    </button>\n                </div>\n\n                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n                    {/* Left Column: Settings */}\n                    <div className=\"space-y-6\">\n                        {/* 1. Database Connection */}\n                        <div className=\"bg-[#252836] p-6 rounded-xl border border-gray-700 shadow-lg\">\n                            <h2 className=\"text-xl font-bold text-white mb-4 flex items-center\">\n                                <span className=\"bg-cyan-900 text-cyan-400 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm\">1</span>\n                                資料庫連線\n                            </h2>\n                            <div className=\"space-y-4\">\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-400 mb-1\">Supabase URL</label>\n                                    <input\n                                        type=\"text\"\n                                        value={dbUrl}\n                                        onChange={(e) => setDbUrl(e.target.value)}\n                                        className=\"w-full bg-gray-800 border-gray-600 rounded-lg px-3 py-2 text-white focus:ring-cyan-500 focus:border-cyan-500 placeholder-gray-600\"\n                                        placeholder=\"https://xyz.supabase.co\"\n                                    />\n                                </div>\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-400 mb-1\">Service Role Key</label>\n                                    <input\n                                        type=\"password\"\n                                        value={dbKey}\n                                        onChange={(e) => setDbKey(e.target.value)}\n                                        className=\"w-full bg-gray-800 border-gray-600 rounded-lg px-3 py-2 text-white focus:ring-cyan-500 focus:border-cyan-500 placeholder-gray-600\"\n                                        placeholder=\"eyJhhGciOiJIUzI1NiIsInR5cCI...\"\n                                    />\n                                </div>\n                                <button\n                                    onClick={handleTestConnection}\n                                    className={`w-full font-bold py-2 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 ${isConnected\n                                        ? 'bg-green-600 hover:bg-green-500 text-white cursor-default'\n                                        : 'bg-gray-700 hover:bg-gray-600 text-white'\n                                        }`}\n                                >\n                                    {isConnected ? <><i className=\"fas fa-check\" /> 連線成功</> : '測試連線'}\n                                </button>\n                            </div>\n                        </div>\n\n                        {/* 2. Folder Selection */}\n                        <div className=\"bg-[#252836] p-6 rounded-xl border border-gray-700 shadow-lg\">\n                            <h2 className=\"text-xl font-bold text-white mb-4 flex items-center\">\n                                <span className=\"bg-cyan-900 text-cyan-400 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm\">2</span>\n                                選擇資料來源\n                            </h2>\n                            <button\n                                onClick={handleSelectFolders}\n                                disabled={isUploading}\n                                className=\"w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 disabled:opacity-50\"\n                            >\n                                <i className=\"fas fa-folder-open text-xl\" /> 選擇 lvr_land 資料夾\n                            </button>\n                            {files.length > 0 && (\n                                <div className=\"mt-4 p-3 bg-gray-800/50 rounded-lg text-sm\">\n                                    <div className=\"flex justify-between text-gray-300 mb-1\">\n                                        <span>已找到檔案:</span>\n                                        <span className=\"font-bold text-white\">{files.length} 個</span>\n                                    </div>\n                                    <div className=\"flex justify-between text-gray-400 text-xs\">\n                                        <span>主表 (Main):</span>\n                                        <span>{files.filter(f => f.isMain).length}</span>\n                                    </div>\n                                    <div className=\"flex justify-between text-gray-400 text-xs\">\n                                        <span>附表 (Sub):</span>\n                                        <span>{files.filter(f => !f.isMain).length}</span>\n                                    </div>\n                                </div>\n                            )}\n                        </div>\n\n                        {/* 3. Upload Action */}\n                        <div className=\"bg-[#252836] p-6 rounded-xl border border-gray-700 shadow-lg\">\n                            <h2 className=\"text-xl font-bold text-white mb-4 flex items-center\">\n                                <span className=\"bg-cyan-900 text-cyan-400 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm\">3</span>\n                                開始處理\n                            </h2>\n                            <div className=\"space-y-4\">\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-400 mb-2\">上傳類型</label>\n                                    <div className=\"grid grid-cols-2 gap-2\">\n                                        {['all', 'a', 'b', 'c'].map(type => (\n                                            <label key={type} className={`cursor-pointer border rounded-lg p-2 text-center transition-all ${uploadType === type\n                                                ? 'bg-cyan-900/30 border-cyan-500 text-cyan-400'\n                                                : 'bg-gray-800 border-gray-700 text-gray-400 hover:border-gray-500'\n                                                }`}>\n                                                <input\n                                                    type=\"radio\"\n                                                    name=\"uploadType\"\n                                                    value={type}\n                                                    checked={uploadType === type}\n                                                    onChange={(e) => setUploadType(e.target.value)}\n                                                    className=\"sr-only\"\n                                                    disabled={isUploading}\n                                                />\n                                                <span className=\"font-bold\">{type === 'all' ? '全部' : type === 'a' ? '中古' : type === 'b' ? '預售' : '租賃'}</span>\n                                            </label>\n                                        ))}\n                                    </div>\n                                </div>\n                                <button\n                                    onClick={handleStartUpload}\n                                    disabled={!isConnected || files.length === 0 || isUploading}\n                                    className=\"w-full bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white font-bold py-3 px-4 rounded-lg shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\n                                >\n                                    {isUploading ? <i className=\"fas fa-spinner fa-spin\" /> : <i className=\"fas fa-rocket\" />}\n                                    {isUploading ? '處理中...' : '開始上傳'}\n                                </button>\n                            </div>\n                        </div>\n\n                        {/* 4. Batch Data Modification (Legacy Feature) */}\n                        <div className=\"bg-[#252836] p-6 rounded-xl border border-gray-700 shadow-lg\">\n                            <h2 className=\"text-xl font-bold text-white mb-4 flex items-center\">\n                                <span className=\"bg-cyan-900 text-cyan-400 w-8 h-8 rounded-full flex items-center justify-center mr-3 text-sm\">4</span>\n                                資料批次修改 (獨立功能)\n                            </h2>\n                            <div className=\"space-y-4\">\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-400 mb-1\">選擇縣市</label>\n                                    <select\n                                        value={updateCounty}\n                                        onChange={(e) => setUpdateCounty(e.target.value)}\n                                        className=\"w-full bg-gray-800 border-gray-600 rounded-lg px-3 py-2 text-white focus:ring-cyan-500 focus:border-cyan-500\"\n                                    >\n                                        {Object.entries(counties).map(([code, name]) => (\n                                            <option key={code} value={code.toLowerCase()}>{name}</option>\n                                        ))}\n                                    </select>\n                                </div>\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-400 mb-2\">交易類型</label>\n                                    <div className=\"grid grid-cols-2 gap-2\">\n                                        {['a', 'b', 'c'].map(type => (\n                                            <label key={type} className={`cursor-pointer border rounded-lg p-2 text-center transition-all ${updateType === type\n                                                ? 'bg-cyan-900/30 border-cyan-500 text-cyan-400'\n                                                : 'bg-gray-800 border-gray-700 text-gray-400 hover:border-gray-500'\n                                                }`}>\n                                                <input\n                                                    type=\"radio\"\n                                                    name=\"updateType\"\n                                                    value={type}\n                                                    checked={updateType === type}\n                                                    onChange={(e) => setUpdateType(e.target.value)}\n                                                    className=\"sr-only\"\n                                                    disabled={isSearching}\n                                                />\n                                                <span className=\"font-bold\">{type === 'a' ? '中古' : type === 'b' ? '預售' : '租賃'}</span>\n                                            </label>\n                                        ))}\n                                    </div>\n                                </div>\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-400 mb-1\">搜尋欄位</label>\n                                    <select\n                                        value={updateSearchField}\n                                        onChange={(e) => setUpdateSearchField(e.target.value)}\n                                        className=\"w-full bg-gray-800 border-gray-600 rounded-lg px-3 py-2 text-white focus:ring-cyan-500 focus:border-cyan-500\"\n                                    >\n                                        {Array.from(new Set(Object.values(columnMappings[updateType] || {})))\n                                            .filter(f => !['編號', 'id'].includes(f))\n                                            .sort()\n                                            .map(field => (\n                                                <option key={field} value={field}>{field}</option>\n                                            ))}\n                                        <option value=\"編號\">編號</option>\n                                    </select>\n                                </div>\n                                <div>\n                                    <label className=\"block text-sm font-medium text-gray-400 mb-1\">關鍵字</label>\n                                    <input\n                                        type=\"text\"\n                                        value={updateKeyword}\n                                        onChange={(e) => setUpdateKeyword(e.target.value)}\n                                        onKeyDown={(e) => e.key === 'Enter' && handleSearch()}\n                                        className=\"w-full bg-gray-800 border-gray-600 rounded-lg px-3 py-2 text-white focus:ring-cyan-500 focus:border-cyan-500 placeholder-gray-600\"\n                                        placeholder=\"輸入關鍵字...\"\n                                    />\n                                </div>\n                                <button\n                                    onClick={handleSearch}\n                                    disabled={!isConnected || isSearching}\n                                    className=\"w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2 disabled:opacity-50\"\n                                >\n                                    {isSearching ? <i className=\"fas fa-spinner fa-spin\" /> : <i className=\"fas fa-search\" />}\n                                    {isSearching ? '搜尋中...' : '搜尋資料'}\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n\n                    {/* Right Column: Console & Visuals */}\n                    <div className=\"lg:col-span-2 space-y-6\">\n                        {/* Progress Area */}\n                        <div className=\"bg-[#252836] p-6 rounded-xl border border-gray-700 shadow-lg\">\n                            <h3 className=\"text-gray-300 font-bold mb-4 flex justify-between items-center\">\n                                <span><i className=\"fas fa-tasks mr-2 text-purple-400\" />執行進度</span>\n                                {isUploading && <span className=\"text-cyan-400\">{progress}%</span>}\n                            </h3>\n                            <div className=\"w-full bg-gray-700 rounded-full h-4 mb-2 overflow-hidden\">\n                                <div\n                                    className=\"bg-gradient-to-r from-cyan-500 to-purple-500 h-4 rounded-full transition-all duration-300 relative\"\n                                    style={{ width: `${progress}%` }}\n                                >\n                                    {isUploading && <div className=\"absolute inset-0 bg-white/20 animate-pulse\"></div>}\n                                </div>\n                            </div>\n                            <div className=\"text-xs text-gray-500 h-5\">\n                                {currentFile && `正在處理: ${currentFile}`}\n                            </div>\n                        </div>\n\n                        {/* Console */}\n                        <div className=\"bg-black/60 p-4 rounded-xl border border-gray-800 h-[500px] overflow-hidden flex flex-col font-mono text-sm shadow-inner\">\n                            <div className=\"flex justify-between items-center mb-2 border-b border-gray-800 pb-2\">\n                                <span className=\"text-gray-400 font-bold\"><i className=\"fas fa-terminal mr-2\" />系統日誌</span>\n                                <button onClick={() => setLogs([])} className=\"text-xs text-gray-600 hover:text-gray-300 transition-colors\">清除</button>\n                            </div>\n                            <div className=\"flex-1 overflow-y-auto space-y-1 p-2 custom-scrollbar\" ref={(el) => { if (el) el.scrollTop = el.scrollHeight; }}>\n                                {logs.map(log => (\n                                    <div key={log.id} className={`flex gap-3 leading-relaxed border-b border-white/5 pb-1 ${log.type === 'error' ? 'text-red-400 bg-red-900/10' :\n                                        log.type === 'warning' ? 'text-yellow-400' :\n                                            log.type === 'success' ? 'text-emerald-400' : 'text-gray-300'\n                                        }`}>\n                                        <span className=\"text-gray-600 select-none\">[{log.time}]</span>\n                                        <span className=\"break-all\">{log.text}</span>\n                                    </div>\n                                ))}\n                                {logs.length === 0 && <div className=\"text-gray-700 italic text-center mt-20\">等待任務啟動...</div>}\n                            </div>\n                        </div>\n\n                        {/* Results */}\n                        {summary && (\n                            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                                <div className=\"bg-emerald-900/20 border border-emerald-800 p-4 rounded-xl text-center\">\n                                    <div className=\"text-3xl font-bold text-emerald-400\">{summary.new}</div>\n                                    <div className=\"text-sm text-emerald-200/70 uppercase tracking-wider mt-1\">New</div>\n                                </div>\n                                <div className=\"bg-yellow-900/20 border border-yellow-800 p-4 rounded-xl text-center\">\n                                    <div className=\"text-3xl font-bold text-yellow-400\">{summary.updated}</div>\n                                    <div className=\"text-sm text-yellow-200/70 uppercase tracking-wider mt-1\">Updated</div>\n                                </div>\n                                <div className=\"bg-gray-800/40 border border-gray-700 p-4 rounded-xl text-center\">\n                                    <div className=\"text-3xl font-bold text-gray-400\">{summary.identical}</div>\n                                    <div className=\"text-sm text-gray-500 uppercase tracking-wider mt-1\">Skipped</div>\n                                </div>\n                                <div className=\"bg-red-900/20 border border-red-800 p-4 rounded-xl text-center\">\n                                    <div className=\"text-3xl font-bold text-red-400\">{summary.errors}</div>\n                                    <div className=\"text-sm text-red-200/70 uppercase tracking-wider mt-1\">Errors</div>\n                                </div>\n                            </div>\n                        )}\n                    </div>\n                </div>\n            </div>\n\n            {/* Batch Update Modal */}\n            {showUpdateModal && (\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4\">\n                    <div className=\"bg-[#1a1d29] border border-gray-700 rounded-xl w-full max-w-6xl max-h-[90vh] flex flex-col shadow-2xl\">\n                        {/* Modal Header */}\n                        <div className=\"p-4 border-b border-gray-700 flex justify-between items-center bg-[#252836] rounded-t-xl\">\n                            <div>\n                                <h3 className=\"text-xl font-bold text-white\">批次修改搜尋結果</h3>\n                                <p className=\"text-sm text-gray-400 mt-1\">\n                                    資料表: {currentUpdateContext?.tableName} |\n                                    搜尋條件: {counties[updateCounty.toUpperCase()]} {updateSearchField} like &apos;%{updateKeyword}%&apos; |\n                                    共 {searchResults.length} 筆\n                                </p>\n                            </div>\n                            <button\n                                onClick={() => setShowUpdateModal(false)}\n                                className=\"text-gray-400 hover:text-white transition-colors\"\n                            >\n                                <i className=\"fas fa-times text-xl\" />\n                            </button>\n                        </div>\n\n                        {/* Controls Toolbar */}\n                        <div className=\"p-4 border-b border-gray-700 bg-gray-800/50 flex gap-4 items-end flex-wrap\">\n                            <div className=\"flex items-center gap-2 text-sm text-gray-300\">\n                                <input\n                                    type=\"checkbox\"\n                                    checked={selectedIds.size > 0 && selectedIds.size === searchResults.length}\n                                    onChange={toggleSelectAll}\n                                    className=\"form-checkbox h-5 w-5 text-cyan-600 bg-gray-700 border-gray-600 rounded\"\n                                />\n                                <span>全選 ({selectedIds.size} 筆)</span>\n                            </div>\n\n                            <div className=\"flex-1\" />\n\n                            <div className=\"flex gap-2 items-center\">\n                                <div>\n                                    <label className=\"block text-xs text-gray-400 mb-1\">欲修改欄位</label>\n                                    <select\n                                        value={batchUpdateField}\n                                        onChange={(e) => setBatchUpdateField(e.target.value)}\n                                        className=\"bg-gray-800 border-gray-600 rounded px-3 py-1.5 text-sm text-white focus:ring-cyan-500\"\n                                    >\n                                        {Array.from(new Set(Object.values(columnMappings[updateType] || {})))\n                                            .filter(f => !['編號', 'id'].includes(f))\n                                            .sort()\n                                            .map(field => (\n                                                <option key={field} value={field}>{field}</option>\n                                            ))}\n                                    </select>\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs text-gray-400 mb-1\">新數值</label>\n                                    <input\n                                        type=\"text\"\n                                        value={batchUpdateValue}\n                                        onChange={(e) => setBatchUpdateValue(e.target.value)}\n                                        className=\"bg-gray-800 border-gray-600 rounded px-3 py-1.5 text-sm text-white w-48 focus:ring-cyan-500\"\n                                        placeholder=\"輸入新內容...\"\n                                    />\n                                </div>\n                                <div className=\"pb-0.5\">\n                                    <button\n                                        onClick={handleExecuteBatchUpdate}\n                                        disabled={selectedIds.size === 0 || isBatchUpdating}\n                                        className=\"bg-red-600 hover:bg-red-500 text-white font-bold py-1.5 px-4 rounded transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed h-[34px]\"\n                                    >\n                                        {isBatchUpdating ? '更新中...' : '執行批次更新'}\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Results Table */}\n                        <div className=\"flex-1 overflow-auto p-4 custom-scrollbar\">\n                            <table className=\"w-full text-left border-collapse\">\n                                <thead className=\"bg-gray-800 sticky top-0 z-10\">\n                                    <tr>\n                                        <th className=\"p-3 text-xs font-bold text-gray-400 border-b border-gray-700 w-12\">選取</th>\n                                        <th className=\"p-3 text-xs font-bold text-gray-400 border-b border-gray-700 w-24\">編號</th>\n                                        <th className=\"p-3 text-xs font-bold text-gray-400 border-b border-gray-700 w-24\">行政區</th>\n                                        <th className=\"p-3 text-xs font-bold text-gray-400 border-b border-gray-700 w-48\">建案名稱</th>\n                                        <th className=\"p-3 text-xs font-bold text-gray-400 border-b border-gray-700\">地址/位置</th>\n                                        <th className=\"p-3 text-xs font-bold text-gray-400 border-b border-gray-700 w-16\">操作</th>\n                                    </tr>\n                                </thead>\n                                <tbody className=\"text-sm\">\n                                    {searchResults.map((row, idx) => (\n                                        <>\n                                            <tr key={row['編號']} className=\"hover:bg-white/5 border-b border-gray-800\">\n                                                <td className=\"p-3\">\n                                                    <input\n                                                        type=\"checkbox\"\n                                                        checked={selectedIds.has(row['編號'])}\n                                                        onChange={() => toggleSelection(row['編號'])}\n                                                        className=\"form-checkbox h-4 w-4 text-cyan-600 bg-gray-700 border-gray-600 rounded\"\n                                                    />\n                                                </td>\n                                                <td className=\"p-3 font-mono text-xs text-gray-400\">{row['編號']}</td>\n                                                <td className=\"p-3\">{row['行政區']}</td>\n                                                <td className=\"p-3 text-cyan-300\">{row['建案名稱']}</td>\n                                                <td className=\"p-3 text-gray-400 truncate max-w-[200px]\">{row['其他門牌'] || row['地址'] || row['土地位置建物門牌']}</td>\n                                                <td className=\"p-3\">\n                                                    <button\n                                                        onClick={() => toggleDetails(idx)}\n                                                        className=\"text-gray-500 hover:text-white text-xs underline\"\n                                                    >\n                                                        {expandedRows.has(idx) ? '收合' : '明細'}\n                                                    </button>\n                                                </td>\n                                            </tr>\n                                            {expandedRows.has(idx) && (\n                                                <tr className=\"bg-gray-900/50\">\n                                                    <td colSpan={6} className=\"p-4 border-b border-gray-800\">\n                                                        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-xs\">\n                                                            {Object.entries(row).filter(([k]) => k !== 'id').map(([key, val]) => (\n                                                                <div key={key}>\n                                                                    <div className=\"text-gray-500 mb-1\">{key}</div>\n                                                                    <div className=\"text-gray-300 break-all\">{String(val)}</div>\n                                                                </div>\n                                                            ))}\n                                                        </div>\n                                                    </td>\n                                                </tr>\n                                            )}\n                                        </>\n                                    ))}\n                                </tbody>\n                            </table>\n                            {searchResults.length === 0 && (\n                                <div className=\"text-center py-20 text-gray-500\">\n                                    無符合資料\n                                </div>\n                            )}\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* Batch Update Modal */}\n            {showUpdateModal && (\n                <div\n                    className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4 transition-opacity animate-in fade-in duration-200\"\n                    onClick={() => setShowUpdateModal(false)}\n                >\n                    <div\n                        className=\"bg-[#1a1d29] border border-gray-700 rounded-xl w-full max-w-6xl max-h-[90vh] flex flex-col shadow-2xl relative\"\n                        onClick={(e) => e.stopPropagation()}\n                    >\n                        {/* Modal Header */}\n                        <div className=\"p-4 border-b border-gray-700 flex justify-between items-center bg-[#252836] rounded-t-xl\">\n                            <div>\n                                <h3 className=\"text-xl font-bold text-white\">批次修改搜尋結果</h3>\n                                <p className=\"text-sm text-gray-400 mt-1\">\n                                    資料表: {currentUpdateContext?.tableName} |\n                                    搜尋條件: {counties[updateCounty.toUpperCase()]} {updateSearchField} like &apos;%{updateKeyword}%&apos; |\n                                    共 {searchResults.length} 筆\n                                </p>\n                            </div>\n                            <button\n                                onClick={() => setShowUpdateModal(false)}\n                                className=\"text-gray-400 hover:text-white hover:bg-gray-700/50 p-2 rounded-full transition-colors flex items-center justify-center w-8 h-8\"\n                                title=\"關閉視窗 (Esc)\"\n                            >\n                                <i className=\"fas fa-times text-xl\" />\n                            </button>\n                        </div>\n\n                        {/* Modal Search Bar (Collapsible) */}\n                        <div className=\"bg-[#252836] border-b border-gray-700\">\n                            <button\n                                onClick={() => setShowModalSearch(!showModalSearch)}\n                                className=\"w-full text-center py-2 text-xs text-gray-500 hover:text-white hover:bg-gray-700/50 transition-colors flex items-center justify-center gap-2\"\n                            >\n                                <i className={`fas fa-search ${showModalSearch ? 'text-cyan-400' : ''}`} />\n                                {showModalSearch ? '收合搜尋條件' : '再次搜尋 / 修改條件'}\n                            </button>\n\n                            {showModalSearch && (\n                                <div className=\"p-4 grid grid-cols-1 md:grid-cols-5 gap-4 animate-in slide-in-from-top-2 duration-200\">\n                                    <div>\n                                        <label className=\"block text-xs text-gray-400 mb-1\">縣市</label>\n                                        <select\n                                            value={updateCounty}\n                                            onChange={(e) => setUpdateCounty(e.target.value)}\n                                            className=\"w-full bg-gray-800 border-gray-600 rounded px-2 py-1.5 text-sm text-white focus:ring-cyan-500\"\n                                        >\n                                            {Object.entries(counties).map(([code, name]) => (\n                                                <option key={code} value={code.toLowerCase()}>{name}</option>\n                                            ))}\n                                        </select>\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs text-gray-400 mb-1\">類型</label>\n                                        <div className=\"flex bg-gray-800 rounded border border-gray-600 p-0.5\">\n                                            {['a', 'b', 'c'].map(type => (\n                                                <button\n                                                    key={type}\n                                                    onClick={() => setUpdateType(type)}\n                                                    className={`flex-1 text-xs py-1 rounded transition-colors ${updateType === type\n                                                        ? 'bg-cyan-900 text-cyan-400'\n                                                        : 'text-gray-400 hover:text-white'}`}\n                                                >\n                                                    {type === 'a' ? '中古' : type === 'b' ? '預售' : '租賃'}\n                                                </button>\n                                            ))}\n                                        </div>\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs text-gray-400 mb-1\">欄位</label>\n                                        <select\n                                            value={updateSearchField}\n                                            onChange={(e) => setUpdateSearchField(e.target.value)}\n                                            className=\"w-full bg-gray-800 border-gray-600 rounded px-2 py-1.5 text-sm text-white focus:ring-cyan-500\"\n                                        >\n                                            {Array.from(new Set(Object.values(columnMappings[updateType] || {})))\n                                                .filter(f => !['編號', 'id'].includes(f))\n                                                .sort()\n                                                .map(field => (\n                                                    <option key={field} value={field}>{field}</option>\n                                                ))}\n                                            <option value=\"編號\">編號</option>\n                                        </select>\n                                    </div>\n                                    <div>\n                                        <label className=\"block text-xs text-gray-400 mb-1\">關鍵字</label>\n                                        <input\n                                            type=\"text\"\n                                            value={updateKeyword}\n                                            onChange={(e) => setUpdateKeyword(e.target.value)}\n                                            onKeyDown={(e) => e.key === 'Enter' && handleSearch()}\n                                            className=\"w-full bg-gray-800 border-gray-600 rounded px-2 py-1.5 text-sm text-white focus:ring-cyan-500\"\n                                            placeholder=\"關鍵字...\"\n                                        />\n                                    </div>\n                                    <div className=\"flex items-end\">\n                                        <button\n                                            onClick={handleSearch}\n                                            disabled={isSearching}\n                                            className=\"w-full bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-1.5 px-4 rounded transition-colors text-sm h-[34px] flex items-center justify-center gap-2 disabled:opacity-50\"\n                                        >\n                                            {isSearching ? <i className=\"fas fa-spinner fa-spin\" /> : <i className=\"fas fa-search\" />}\n                                            搜尋\n                                        </button>\n                                    </div>\n                                </div>\n                            )}\n                        </div>\n\n                        {/* Controls Toolbar */}\n                        <div className=\"p-4 border-b border-gray-700 bg-gray-800/50 flex gap-4 items-end flex-wrap\">\n                            <div className=\"flex items-center gap-2 text-sm text-gray-300\">\n                                <input\n                                    type=\"checkbox\"\n                                    checked={selectedIds.size > 0 && selectedIds.size === searchResults.length}\n                                    onChange={toggleSelectAll}\n                                    className=\"form-checkbox h-5 w-5 text-cyan-600 bg-gray-700 border-gray-600 rounded\"\n                                />\n                                <span>全選 ({selectedIds.size} 筆)</span>\n                            </div>\n\n                            <div className=\"flex-1\" />\n\n                            <div className=\"flex gap-2 items-center\">\n                                <div>\n                                    <label className=\"block text-xs text-gray-400 mb-1\">欲修改欄位</label>\n                                    <select\n                                        value={batchUpdateField}\n                                        onChange={(e) => setBatchUpdateField(e.target.value)}\n                                        className=\"bg-gray-800 border-gray-600 rounded px-3 py-1.5 text-sm text-white focus:ring-cyan-500\"\n                                    >\n                                        {Array.from(new Set(Object.values(columnMappings[updateType] || {})))\n                                            .filter(f => !['編號', 'id'].includes(f))\n                                            .sort()\n                                            .map(field => (\n                                                <option key={field} value={field}>{field}</option>\n                                            ))}\n                                    </select>\n                                </div>\n                                <div>\n                                    <label className=\"block text-xs text-gray-400 mb-1\">新數值</label>\n                                    <input\n                                        type=\"text\"\n                                        value={batchUpdateValue}\n                                        onChange={(e) => setBatchUpdateValue(e.target.value)}\n                                        className=\"bg-gray-800 border-gray-600 rounded px-3 py-1.5 text-sm text-white w-48 focus:ring-cyan-500\"\n                                        placeholder=\"輸入新內容...\"\n                                    />\n                                </div>\n                                <div className=\"pb-0.5\">\n                                    <button\n                                        onClick={handleExecuteBatchUpdate}\n                                        disabled={selectedIds.size === 0 || isBatchUpdating}\n                                        className=\"bg-red-600 hover:bg-red-500 text-white font-bold py-1.5 px-4 rounded transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed h-[34px]\"\n                                    >\n                                        {isBatchUpdating ? '更新中...' : '執行批次更新'}\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n\n                        {/* Results Table */}\n                        <div className=\"flex-1 overflow-auto p-4 custom-scrollbar\">\n                            <table className=\"w-full text-left border-collapse\">\n                                <thead className=\"bg-gray-800 sticky top-0 z-10\">\n                                    <tr>\n                                        <th className=\"p-3 text-xs font-bold text-gray-400 border-b border-gray-700 w-12\">選取</th>\n                                        <th className=\"p-3 text-xs font-bold text-gray-400 border-b border-gray-700 w-24\">編號</th>\n                                        <th className=\"p-3 text-xs font-bold text-gray-400 border-b border-gray-700 w-24\">行政區</th>\n                                        <th className=\"p-3 text-xs font-bold text-gray-400 border-b border-gray-700 w-48\">建案名稱</th>\n                                        <th className=\"p-3 text-xs font-bold text-gray-400 border-b border-gray-700\">地址/位置</th>\n                                        <th className=\"p-3 text-xs font-bold text-gray-400 border-b border-gray-700 w-16\">操作</th>\n                                    </tr>\n                                </thead>\n                                <tbody className=\"text-sm\">\n                                    {searchResults.map((row, idx) => (\n                                        <>\n                                            <tr key={row['編號']} className=\"hover:bg-white/5 border-b border-gray-800\">\n                                                <td className=\"p-3\">\n                                                    <input\n                                                        type=\"checkbox\"\n                                                        checked={selectedIds.has(row['編號'])}\n                                                        onChange={() => toggleSelection(row['編號'])}\n                                                        className=\"form-checkbox h-4 w-4 text-cyan-600 bg-gray-700 border-gray-600 rounded\"\n                                                    />\n                                                </td>\n                                                <td className=\"p-3 font-mono text-xs text-gray-400\">{row['編號']}</td>\n                                                <td className=\"p-3\">{row['行政區']}</td>\n                                                <td className=\"p-3 text-cyan-300\">{row['建案名稱']}</td>\n                                                <td className=\"p-3 text-gray-400 truncate max-w-[200px]\">{row['其他門牌'] || row['地址'] || row['土地位置建物門牌']}</td>\n                                                <td className=\"p-3\">\n                                                    <button\n                                                        onClick={() => toggleDetails(idx)}\n                                                        className=\"text-gray-500 hover:text-white text-xs underline\"\n                                                    >\n                                                        {expandedRows.has(idx) ? '收合' : '明細'}\n                                                    </button>\n                                                </td>\n                                            </tr>\n                                            {expandedRows.has(idx) && (\n                                                <tr className=\"bg-gray-900/50\">\n                                                    <td colSpan={6} className=\"p-4 border-b border-gray-800\">\n                                                        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-xs\">\n                                                            {Object.entries(row).filter(([k]) => k !== 'id').map(([key, val]) => (\n                                                                <div key={key}>\n                                                                    <div className=\"text-gray-500 mb-1\">{key}</div>\n                                                                    <div className=\"text-gray-300 break-all\">{String(val)}</div>\n                                                                </div>\n                                                            ))}\n                                                        </div>\n                                                    </td>\n                                                </tr>\n                                            )}\n                                        </>\n                                    ))}\n                                </tbody>\n                            </table>\n                            {searchResults.length === 0 && (\n                                <div className=\"text-center py-20 text-gray-500\">\n                                    無符合資料\n                                </div>\n                            )}\n                        </div>\n                    </div>\n                </div>\n            )}\n\n            {/* Styles for custom scrollbar */}\n            <style jsx global>{`\n                .custom-scrollbar::-webkit-scrollbar {\n                    width: 8px;\n                }\n                .custom-scrollbar::-webkit-scrollbar-track {\n                    background: rgba(0, 0, 0, 0.2);\n                }\n                .custom-scrollbar::-webkit-scrollbar-thumb {\n                    background: rgba(255, 255, 255, 0.1);\n                    border-radius: 4px;\n                }\n                .custom-scrollbar::-webkit-scrollbar-thumb:hover {\n                    background: rgba(255, 255, 255, 0.2);\n                }\n            `}</style>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}}]
}