(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,77154,e=>{"use strict";let t,n,r,a;var i,s,l,o,c,d,u,x=e.i(25191),m=e.i(68524),h=e.i(77019),p=e.i(21643),f=e.i(78885),g=e.i(74614),b=e.i(30844),v=e.i(5467);let y=(0,m.forwardRef)(({options:e,value:t,onChange:n,placeholder:r="Select...",maxItems:a,disabled:i=!1,className:s,onSearch:l,loading:o=!1,onFocus:c},d)=>{let[u,h]=(0,m.useState)(""),[p,f]=(0,m.useState)(!1),y=(0,m.useRef)(null),j=(0,m.useRef)(null),N=l?e:e.filter(e=>e.label.toLowerCase().includes(u.toLowerCase()));return t.map(t=>{let n=e.find(e=>e.value===t);return n?n.label:t}),(0,m.useEffect)(()=>{let e=e=>{y.current&&!y.current.contains(e.target)&&f(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,m.useEffect)(()=>{l&&l(u)},[u,l]),(0,x.jsxs)("div",{className:(0,g.cn)("relative w-full",s),ref:y,children:[(0,x.jsxs)("div",{className:(0,g.cn)("flex items-center gap-2 bg-zinc-950/50 border border-input rounded-md px-2 py-1.5 h-[42px] overflow-x-auto custom-scrollbar cursor-text transition-all",p&&"ring-2 ring-ring ring-offset-0 border-ring",i&&"bg-zinc-900/50 cursor-not-allowed opacity-50"),onClick:()=>!i&&j.current?.focus(),children:[t.map(r=>{let a=e.find(e=>e.value===r),s=a?a.label:r;return(0,x.jsxs)("span",{className:"bg-violet-500/20 text-violet-200 border border-violet-500/30 text-xs rounded-full px-2 py-0.5 flex items-center gap-1 animate-in fade-in zoom-in-95 duration-100 whitespace-nowrap shrink-0",children:[s,!i&&(0,x.jsx)(b.X,{size:12,className:"cursor-pointer hover:text-white transition-colors",onClick:e=>{e.stopPropagation(),n(t.filter(e=>e!==r))}})]},r)}),(0,x.jsx)("input",{ref:j,type:"text",value:u,onChange:e=>h(e.target.value),onFocus:()=>{f(!0),c?.()},onKeyDown:e=>{"Backspace"===e.key&&""===u&&t.length>0&&n(t.slice(0,-1))},placeholder:0===t.length?r:"",className:(0,g.cn)("bg-transparent outline-none flex-grow min-w-[60px] text-zinc-100 placeholder:text-zinc-500 text-sm",i&&"cursor-not-allowed"),disabled:i})]}),p&&!i&&(0,x.jsx)("div",{className:"absolute z-[110] w-full mt-1 bg-zinc-900 border border-zinc-700 rounded-md shadow-xl max-h-60 overflow-y-auto custom-scrollbar animate-in fade-in slide-in-from-top-2 duration-100",children:o?(0,x.jsx)("div",{className:"p-2 text-center text-zinc-500 text-sm",children:"Loading..."}):0===N.length?(0,x.jsx)("div",{className:"p-2 text-center text-zinc-500 text-sm",children:"No options found"}):N.map((e,r)=>{if(!e)return null;let i=0===r||e.group!==N[r-1]?.group;return(0,x.jsxs)(m.default.Fragment,{children:[i&&e.group&&(0,x.jsx)("div",{className:"px-2 py-1 bg-zinc-800/50 text-xs font-semibold text-zinc-400 sticky top-0 backdrop-blur-sm z-10",children:e.group}),(0,x.jsxs)("div",{className:(0,g.cn)("px-3 py-2 cursor-pointer text-sm flex items-start justify-between hover:bg-zinc-800 transition-colors",t.includes(e.value)&&"bg-violet-500/10 text-violet-400"),onClick:()=>(e=>{if(t.includes(e))n(t.filter(t=>t!==e));else{if(a&&t.length>=a)return;n([...t,e])}h("")})(e.value),children:[(0,x.jsxs)("div",{className:"flex flex-col",children:[(0,x.jsx)("span",{className:"font-medium",children:e.label}),e.details&&(0,x.jsxs)("div",{className:"flex items-center gap-2 mt-0.5",children:[(e.details.county||e.details.district)&&(0,x.jsxs)("span",{className:"text-xs text-zinc-500 bg-zinc-800/80 px-1.5 rounded border border-zinc-700",children:[e.details.county,e.details.district]}),e.details.date&&(0,x.jsx)("span",{className:"text-xs text-zinc-600 font-mono",children:e.details.date.substring(0,7)})]})]}),t.includes(e.value)&&(0,x.jsx)(v.Check,{size:16,className:"mt-1"})]})]},e.value)})})]})});y.displayName="MultiSelect";var j=e.i(78841);let N=m.forwardRef(({className:e,children:t,...n},r)=>(0,x.jsxs)("div",{className:"relative",children:[(0,x.jsx)("select",{className:(0,g.cn)("flex h-10 w-full appearance-none rounded-md border border-input bg-zinc-950/50 px-3 py-2 text-sm text-zinc-100 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 pr-8",e),ref:r,...n,children:t}),(0,x.jsx)(j.ChevronDown,{className:"absolute right-3 top-2.5 h-4 w-4 opacity-50 pointer-events-none"})]}));N.displayName="Select";var w=e.i(14897),z=e.i(42217),k=e.i(91568);let _=(0,k.default)("chart-line",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]),S=(0,k.default)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);var C=e.i(63028),P=e.i(72448),M=e.i(68609),A=e.i(59725);let E=[{value:"ranking",label:"核心指標與排名"},{value:"price-band",label:"總價帶分析"},{value:"unit-price",label:"單價分析"},{value:"heatmap",label:"調價熱力圖"},{value:"timeline",label:"政策時光機"},{value:"velocity",label:"銷售速度與房型"},{value:"parking",label:"車位分析"},{value:"data-list",label:"交易明細列表"}];function R({onAnalyze:e,isLoading:t}){let n,{counties:r,districts:a,transactionType:i,buildingType:s,projectNames:l,dateRange:o,startDate:c,endDate:d,excludeCommercial:u,activeTab:p,setCounties:g,setDistricts:v,setTransactionType:j,setBuildingType:k,setProjectNames:R,setDateRange:D,setCustomDate:F,setExcludeCommercial:T,setActiveTab:I,resetFilters:L}=(0,f.useFilterStore)(),[$,O]=(0,m.useState)(!1),[B,H]=(0,m.useState)([]),[K,Z]=(0,m.useState)(!1),q=Object.keys(P.COUNTY_CODE_MAP).map(e=>({label:e,value:e})),U=m.default.useMemo(()=>0===r.length?[]:r.flatMap(e=>(P.DISTRICT_DATA[e]||[]).map(t=>({label:t,value:t,group:e}))),[r]),W=(0,m.useRef)(null),[V,G]=(0,m.useState)(null),X=(0,m.useCallback)(async e=>{if(0===r.length)return void H([]);Z(!0),G(null);try{let t=r.map(async t=>{let n=P.COUNTY_CODE_MAP[t],r=a.filter(e=>P.DISTRICT_DATA[t]?.includes(e));return M.api.fetchProjectNameSuggestions(n,e,r).then(e=>{let n=[];return Array.isArray(e)?n=e:e&&e.data&&Array.isArray(e.data)?n=e.data:e&&e.names&&Array.isArray(e.names)&&(n=e.names),n.map(e=>{let n="string"==typeof e,r=n?e:e.name||e.建案名稱||String(e);return{label:r,value:r,group:t,details:n?void 0:{county:t,district:e.district||e.行政區,date:e.earliestDate||e.交易日}}})}).catch(e=>(console.error(`Failed to fetch projects for ${t}:`,e),[]))}),n=(await Promise.all(t)).flat(),i=Array.from(new Map(n.map(e=>[e.value,e])).values());H(i),0===i.length&&e.length>=2&&console.log(`No projects found for query "${e}" in counties: ${r.join(", ")}`)}catch(e){console.error("Project search error:",e),G("搜尋失敗，請稍後再試")}finally{Z(!1)}},[r,a]),Y=(0,m.useCallback)(e=>{W.current&&clearTimeout(W.current),W.current=setTimeout(()=>{X(e)},300)},[X]);(0,m.useEffect)(()=>()=>{W.current&&clearTimeout(W.current)},[]);let[Q,J]=(0,m.useState)(!1),ee=(0,m.useRef)(null);return(0,m.useEffect)(()=>{let e=()=>{let e=window.scrollY;e>250?J(!0):e<120&&J(!1)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(C.AnimatePresence,{mode:"wait",children:Q?(0,x.jsxs)(h.motion.div,{initial:{opacity:0,y:-20,x:"-50%",scale:.95},animate:{opacity:1,y:0,x:"-50%",scale:1},exit:{opacity:0,y:-20,x:"-50%",scale:.95},transition:{duration:.2,ease:"easeOut"},className:"fixed top-3 left-1/2 z-[70] p-1 glass-card rounded-full shadow-2xl flex items-center justify-between gap-1 transition-all mx-auto max-w-7xl backdrop-blur-2xl border border-white/20 origin-top",children:[(0,x.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1 hover:bg-white/5 rounded-full transition-colors cursor-pointer shrink-0",onClick:()=>{J(!1),window.scrollTo({top:0,behavior:"smooth"})},children:[(0,x.jsx)("div",{className:"h-6 w-6 rounded-full bg-violet-500/20 text-violet-400 flex items-center justify-center shrink-0",children:(0,x.jsx)(S,{className:"h-3 w-3"})}),(0,x.jsxs)("div",{className:"flex flex-col leading-tight overflow-hidden",children:[(0,x.jsx)("span",{className:"text-[9px] text-zinc-500 font-bold uppercase tracking-tighter",children:"篩選摘要"}),(0,x.jsx)("span",{className:"text-xs text-zinc-100 font-semibold truncate max-w-[150px]",children:(n=[],r.length>0&&n.push(`${r.length} 縣市`),i&&n.push(i.replace("交易","")),"custom"!==o?n.push({"1q":"近一季","2q":"近兩季","3q":"近三季","1y":"近一年",this_year:"今年",last_2_years:"近兩年"}[o]||o):n.push("自訂期間"),n.join(" • ")||"請選擇篩選條件")})]})]}),(0,x.jsx)("div",{className:"flex items-center gap-1 px-2 border-l border-white/10 overflow-x-auto scrollbar-hide max-w-full lg:max-w-none",children:E.map(e=>(0,x.jsx)("button",{onClick:t=>{t.stopPropagation(),I(e.value)},className:`px-3 py-1.5 rounded-full text-[11px] font-bold transition-all whitespace-nowrap ${p===e.value?"bg-violet-500 text-white shadow-inner scale-105":"text-zinc-400 hover:text-zinc-200 hover:bg-white/5"}`,children:e.label},e.value))}),(0,x.jsx)("div",{className:"pr-2 pl-1 hidden sm:block",children:(0,x.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-cyan-500/50 animate-pulse",title:"操作中"})})]},"compact-pill"):(0,x.jsxs)(h.motion.div,{ref:ee,initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.3},className:"p-4 md:p-6 glass-card rounded-xl shadow-lg",children:[(0,x.jsxs)("div",{className:"flex md:hidden items-center justify-between mb-4",children:[(0,x.jsxs)("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[(0,x.jsx)(S,{className:"h-5 w-5 text-violet-500"}),"篩選條件"]}),(0,x.jsxs)("div",{className:"flex gap-2",children:[(0,x.jsxs)(w.Button,{variant:"outline",size:"sm",onClick:()=>O(!$),className:"border-zinc-700 text-zinc-300",children:[$?(0,x.jsx)(b.X,{className:"h-4 w-4"}):(0,x.jsx)(S,{className:"h-4 w-4"}),$?"收起":"展開"]}),(0,x.jsx)(w.Button,{variant:"default",size:"sm",className:"bg-violet-600 text-white",disabled:0===r.length||t,onClick:e,children:t?"...":"分析"})]})]}),(0,x.jsxs)("div",{className:`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-7 gap-4 items-end ${$?"block":"hidden md:grid"}`,children:[(0,x.jsxs)("div",{className:"xl:col-span-1",children:[(0,x.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)("label",{className:"text-sm font-medium text-zinc-300",children:"縣市"}),r.length>3&&(0,x.jsxs)("span",{className:"text-xs text-amber-500 font-normal animate-in fade-in",children:["(已選 ",r.length,"/6)"]})]}),r.length>0&&(0,x.jsx)("button",{onClick:()=>g([]),className:"text-xs text-cyan-400 hover:text-cyan-300",children:"清除"})]}),(0,x.jsx)(y,{options:q,value:r,onChange:e=>{e.length>6||g(e)},placeholder:"請選擇縣市...",maxItems:6})]}),(0,x.jsxs)("div",{className:"xl:col-span-1",children:[(0,x.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,x.jsx)("label",{className:"text-sm font-medium text-zinc-300",children:"行政區"}),a.length>0&&(0,x.jsx)("button",{onClick:()=>v([]),className:"text-xs text-cyan-400 hover:text-cyan-300",children:"清除"})]}),(0,x.jsx)(y,{options:U,value:a,onChange:e=>{v(e)},placeholder:r.length>0?"請選擇行政區...":"請先選縣市",disabled:0===r.length})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"交易類型"}),(0,x.jsxs)(N,{value:i,onChange:e=>j(e.target.value),children:[(0,x.jsx)("option",{value:"預售交易",children:"預售交易"}),(0,x.jsx)("option",{value:"中古交易",disabled:!0,children:"中古交易 (開發中)"})]})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"建物型態"}),(0,x.jsxs)(N,{value:s,onChange:e=>k(e.target.value),children:[(0,x.jsx)("option",{value:"",children:"全部"}),(0,x.jsx)("option",{value:"住宅大樓(11層含以上有電梯)",children:"住宅大樓"}),(0,x.jsx)("option",{value:"華廈(10層含以下有電梯)",children:"華廈"}),(0,x.jsx)("option",{value:"公寓(5層含以下無電梯)",children:"公寓"}),(0,x.jsx)("option",{value:"套房(1房(1廳)1衛)",children:"套房"}),(0,x.jsx)("option",{value:"透天厝",children:"透天厝"}),(0,x.jsx)("option",{value:"店面(店鋪)",children:"店面"}),(0,x.jsx)("option",{value:"辦公商業大樓",children:"辦公商業大樓"}),(0,x.jsx)("option",{value:"工廠",children:"工廠/廠辦"}),(0,x.jsx)("option",{value:"其他",children:"其他"})]})]}),(0,x.jsxs)("div",{className:"xl:col-span-3",children:[(0,x.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,x.jsx)("label",{className:"text-sm font-medium text-zinc-300",children:"建案名稱"}),l.length>0&&(0,x.jsx)("button",{onClick:()=>R([]),className:"text-xs text-cyan-400 hover:text-cyan-300",children:"清除"})]}),(0,x.jsx)(y,{options:B,value:l,onChange:R,placeholder:r.length>0?"輸入建案名稱搜尋...":"請先選縣市",disabled:0===r.length,onSearch:Y,loading:K,onFocus:()=>{0===l.length&&0===B.length&&X("")}}),V&&(0,x.jsx)("span",{className:"text-xs text-red-400 mt-1",children:V})]}),(0,x.jsxs)("div",{className:"xl:col-span-3 sm:col-span-2 grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"快捷時間"}),(0,x.jsxs)(N,{value:o,onChange:e=>{let t=e.target.value;if("custom"===t)D("custom",c,d);else{let{startDate:e,endDate:n}=(0,A.getDateRangeDates)(t);e&&n&&D(t,e,n)}},children:[(0,x.jsx)("option",{value:"custom",children:"自訂範圍"}),(0,x.jsx)("option",{value:"1q",children:"近一季 (3個月)"}),(0,x.jsx)("option",{value:"2q",children:"近兩季 (6個月)"}),(0,x.jsx)("option",{value:"3q",children:"近三季 (9個月)"}),(0,x.jsx)("option",{value:"1y",children:"近一年 (12個月)"}),(0,x.jsx)("option",{value:"this_year",children:"今年以來"}),(0,x.jsx)("option",{value:"last_2_years",children:"去年＋今年"})]})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"起始日期"}),(0,x.jsx)(z.Input,{type:"date",value:c,onChange:e=>F(e.target.value,d),className:"bg-zinc-950/50 border-input text-zinc-100"})]}),(0,x.jsxs)("div",{children:[(0,x.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,x.jsx)("label",{className:"block text-sm font-medium text-zinc-300",children:"結束日期"}),(0,x.jsx)("button",{onClick:()=>{F(c,new Date().toISOString().split("T")[0])},className:"text-xs text-cyan-400 hover:text-cyan-300",children:"抓取今日"})]}),(0,x.jsx)(z.Input,{type:"date",value:d,onChange:e=>F(c,e.target.value),className:"bg-zinc-950/50 border-input text-zinc-100"})]})]}),(0,x.jsxs)("div",{className:"xl:col-span-4 sm:col-span-2 flex items-end gap-4 justify-end mt-4 md:mt-0",children:[(0,x.jsx)("div",{className:"flex items-center gap-4 mr-auto",children:(0,x.jsxs)("label",{className:"flex items-center gap-2 text-sm text-zinc-300 cursor-pointer",children:[(0,x.jsx)("input",{type:"checkbox",checked:u,onChange:e=>T(e.target.checked),className:"rounded border-zinc-600 bg-zinc-800 text-violet-500 focus:ring-violet-500 accent-violet-500"}),(0,x.jsx)("span",{children:"排除商辦/店面"})]})}),(0,x.jsxs)(w.Button,{variant:"default",className:"bg-violet-600 hover:bg-violet-500 text-white min-w-[120px] hidden md:flex",disabled:0===r.length||t,onClick:()=>{localStorage.setItem("reportReady","true"),window.dispatchEvent(new Event("reportReady")),e?.()},children:[t?(0,x.jsx)("span",{className:"animate-spin mr-2",children:"⟳"}):(0,x.jsx)(_,{className:"mr-2 h-4 w-4"}),t?"分析中...":"分析報表"]})]})]})]},"full-filterbar")})})}function D({title:e,description:t,children:n,headerAction:r,className:a}){return(0,x.jsxs)("div",{className:(0,g.cn)("bg-zinc-900/50 border border-white/5 rounded-2xl p-4 md:p-6 backdrop-blur-sm",a),children:[(0,x.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:e}),t&&(0,x.jsx)("p",{className:"text-zinc-400 text-sm mt-1",children:t})]}),r&&(0,x.jsx)("div",{className:"flex-shrink-0 w-full md:w-auto overflow-x-auto",children:r})]}),n]})}var F=e.i(50183),T=e.i(67690),I=e.i(50294);let L=(0,k.default)("arrow-up-down",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]),$=(0,k.default)("arrow-up",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),O=(0,k.default)("arrow-down",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);var B=e.i(2953);let H=(0,k.default)("layout-grid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),K=(0,k.default)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]);var Z=e.i(41724),q=e.i(72328);let U=(0,k.default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);var W=e.i(33298),V=e.i(60459);let G=(0,k.default)("layout-template",[["rect",{width:"18",height:"7",x:"3",y:"3",rx:"1",key:"f1a2em"}],["rect",{width:"9",height:"7",x:"3",y:"14",rx:"1",key:"jqznyg"}],["rect",{width:"5",height:"7",x:"16",y:"14",rx:"1",key:"q5h2i8"}]]);var X=e.i(41097),Y=e.i(8563),Q=e.i(12112),J=e.i(33209),ee=e.i(33142),et=e.i(93814),en=e.i(40058),er=e.i(16482);function ea(e){var t;let n,r=(t=e,(n=m.forwardRef((e,t)=>{let{children:n,...r}=e;if(m.isValidElement(n)){var a;let e,i,s=(a=n,(i=(e=Object.getOwnPropertyDescriptor(a.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?a.ref:(i=(e=Object.getOwnPropertyDescriptor(a,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?a.props.ref:a.props.ref||a.ref),l=function(e,t){let n={...t};for(let r in t){let a=e[r],i=t[r];/^on[A-Z]/.test(r)?a&&i?n[r]=(...e)=>{let t=i(...e);return a(...e),t}:a&&(n[r]=a):"style"===r?n[r]={...a,...i}:"className"===r&&(n[r]=[a,i].filter(Boolean).join(" "))}return{...e,...n}}(r,n.props);return n.type!==m.Fragment&&(l.ref=t?(0,ee.composeRefs)(t,s):s),m.cloneElement(n,l)}return m.Children.count(n)>1?m.Children.only(null):null})).displayName=`${t}.SlotClone`,n),a=m.forwardRef((e,t)=>{let{children:n,...a}=e,i=m.Children.toArray(n),s=i.find(es);if(s){let e=s.props.children,n=i.map(t=>t!==s?t:m.Children.count(e)>1?m.Children.only(null):m.isValidElement(e)?e.props.children:null);return(0,x.jsx)(r,{...a,ref:t,children:m.isValidElement(e)?m.cloneElement(e,void 0,n):null})}return(0,x.jsx)(r,{...a,ref:t,children:n})});return a.displayName=`${e}.Slot`,a}var ei=Symbol("radix.slottable");function es(e){return m.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===ei}function el(e){let t=e+"CollectionProvider",[n,r]=(0,et.createContextScope)(t),[a,i]=n(t,{collectionRef:{current:null},itemMap:new Map}),s=e=>{let{scope:t,children:n}=e,r=m.default.useRef(null),i=m.default.useRef(new Map).current;return(0,x.jsx)(a,{scope:t,itemMap:i,collectionRef:r,children:n})};s.displayName=t;let l=e+"CollectionSlot",o=ea(l),c=m.default.forwardRef((e,t)=>{let{scope:n,children:r}=e,a=i(l,n),s=(0,ee.useComposedRefs)(t,a.collectionRef);return(0,x.jsx)(o,{ref:s,children:r})});c.displayName=l;let d=e+"CollectionItemSlot",u="data-radix-collection-item",h=ea(d),p=m.default.forwardRef((e,t)=>{let{scope:n,children:r,...a}=e,s=m.default.useRef(null),l=(0,ee.useComposedRefs)(t,s),o=i(d,n);return m.default.useEffect(()=>(o.itemMap.set(s,{ref:s,...a}),()=>void o.itemMap.delete(s))),(0,x.jsx)(h,{...{[u]:""},ref:l,children:r})});return p.displayName=d,[{Provider:s,Slot:c,ItemSlot:p},function(t){let n=i(e+"CollectionConsumer",t);return m.default.useCallback(()=>{let e=n.collectionRef.current;if(!e)return[];let t=Array.from(e.querySelectorAll(`[${u}]`));return Array.from(n.itemMap.values()).sort((e,n)=>t.indexOf(e.ref.current)-t.indexOf(n.ref.current))},[n.collectionRef,n.itemMap])},r]}var eo=new WeakMap;function ec(e,t){var n,r;let a,i,s;if("at"in Array.prototype)return Array.prototype.at.call(e,t);let l=(n=e,r=t,a=n.length,(s=(i=ed(r))>=0?i:a+i)<0||s>=a?-1:s);return -1===l?void 0:e[l]}function ed(e){return e!=e||0===e?0:Math.trunc(e)}(class e extends Map{#e;constructor(e){super(e),this.#e=[...super.keys()],eo.set(this,!0)}set(e,t){return eo.get(this)&&(this.has(e)?this.#e[this.#e.indexOf(e)]=e:this.#e.push(e)),super.set(e,t),this}insert(e,t,n){let r,a=this.has(t),i=this.#e.length,s=ed(e),l=s>=0?s:i+s,o=l<0||l>=i?-1:l;if(o===this.size||a&&o===this.size-1||-1===o)return this.set(t,n),this;let c=this.size+ +!a;s<0&&l++;let d=[...this.#e],u=!1;for(let e=l;e<c;e++)if(l===e){let i=d[e];d[e]===t&&(i=d[e+1]),a&&this.delete(t),r=this.get(i),this.set(t,n)}else{u||d[e-1]!==t||(u=!0);let n=d[u?e:e-1],a=r;r=this.get(n),this.delete(n),this.set(n,a)}return this}with(t,n,r){let a=new e(this);return a.insert(t,n,r),a}before(e){let t=this.#e.indexOf(e)-1;if(!(t<0))return this.entryAt(t)}setBefore(e,t,n){let r=this.#e.indexOf(e);return -1===r?this:this.insert(r,t,n)}after(e){let t=this.#e.indexOf(e);if(-1!==(t=-1===t||t===this.size-1?-1:t+1))return this.entryAt(t)}setAfter(e,t,n){let r=this.#e.indexOf(e);return -1===r?this:this.insert(r+1,t,n)}first(){return this.entryAt(0)}last(){return this.entryAt(-1)}clear(){return this.#e=[],super.clear()}delete(e){let t=super.delete(e);return t&&this.#e.splice(this.#e.indexOf(e),1),t}deleteAt(e){let t=this.keyAt(e);return void 0!==t&&this.delete(t)}at(e){let t=ec(this.#e,e);if(void 0!==t)return this.get(t)}entryAt(e){let t=ec(this.#e,e);if(void 0!==t)return[t,this.get(t)]}indexOf(e){return this.#e.indexOf(e)}keyAt(e){return ec(this.#e,e)}from(e,t){let n=this.indexOf(e);if(-1===n)return;let r=n+t;return r<0&&(r=0),r>=this.size&&(r=this.size-1),this.at(r)}keyFrom(e,t){let n=this.indexOf(e);if(-1===n)return;let r=n+t;return r<0&&(r=0),r>=this.size&&(r=this.size-1),this.keyAt(r)}find(e,t){let n=0;for(let r of this){if(Reflect.apply(e,t,[r,n,this]))return r;n++}}findIndex(e,t){let n=0;for(let r of this){if(Reflect.apply(e,t,[r,n,this]))return n;n++}return -1}filter(t,n){let r=[],a=0;for(let e of this)Reflect.apply(t,n,[e,a,this])&&r.push(e),a++;return new e(r)}map(t,n){let r=[],a=0;for(let e of this)r.push([e[0],Reflect.apply(t,n,[e,a,this])]),a++;return new e(r)}reduce(...e){let[t,n]=e,r=0,a=n??this.at(0);for(let n of this)a=0===r&&1===e.length?n:Reflect.apply(t,this,[a,n,r,this]),r++;return a}reduceRight(...e){let[t,n]=e,r=n??this.at(-1);for(let n=this.size-1;n>=0;n--){let a=this.at(n);r=n===this.size-1&&1===e.length?a:Reflect.apply(t,this,[r,a,n,this])}return r}toSorted(t){return new e([...this.entries()].sort(t))}toReversed(){let t=new e;for(let e=this.size-1;e>=0;e--){let n=this.keyAt(e),r=this.get(n);t.set(n,r)}return t}toSpliced(...t){let n=[...this.entries()];return n.splice(...t),new e(n)}slice(t,n){let r=new e,a=this.size-1;if(void 0===t)return r;t<0&&(t+=this.size),void 0!==n&&n>0&&(a=n-1);for(let e=t;e<=a;e++){let t=this.keyAt(e),n=this.get(t);r.set(t,n)}return r}every(e,t){let n=0;for(let r of this){if(!Reflect.apply(e,t,[r,n,this]))return!1;n++}return!0}some(e,t){let n=0;for(let r of this){if(Reflect.apply(e,t,[r,n,this]))return!0;n++}return!1}});var eu=m.createContext(void 0);function ex(e){let t=m.useContext(eu);return e||t||"ltr"}var em=e.i(86790),eh=0;function ep(){let e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var ef=e.i(55751),eg="focusScope.autoFocusOnMount",eb="focusScope.autoFocusOnUnmount",ev={bubbles:!1,cancelable:!0},ey=m.forwardRef((e,t)=>{let{loop:n=!1,trapped:r=!1,onMountAutoFocus:a,onUnmountAutoFocus:i,...s}=e,[l,o]=m.useState(null),c=(0,ef.useCallbackRef)(a),d=(0,ef.useCallbackRef)(i),u=m.useRef(null),h=(0,ee.useComposedRefs)(t,e=>o(e)),p=m.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;m.useEffect(()=>{if(r){let e=function(e){if(p.paused||!l)return;let t=e.target;l.contains(t)?u.current=t:ew(u.current,{select:!0})},t=function(e){if(p.paused||!l)return;let t=e.relatedTarget;null!==t&&(l.contains(t)||ew(u.current,{select:!0}))};document.addEventListener("focusin",e),document.addEventListener("focusout",t);let n=new MutationObserver(function(e){if(document.activeElement===document.body)for(let t of e)t.removedNodes.length>0&&ew(l)});return l&&n.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),n.disconnect()}}},[r,l,p.paused]),m.useEffect(()=>{if(l){ez.add(p);let e=document.activeElement;if(!l.contains(e)){let t=new CustomEvent(eg,ev);l.addEventListener(eg,c),l.dispatchEvent(t),t.defaultPrevented||(function(e,{select:t=!1}={}){let n=document.activeElement;for(let r of e)if(ew(r,{select:t}),document.activeElement!==n)return}(ej(l).filter(e=>"A"!==e.tagName),{select:!0}),document.activeElement===e&&ew(l))}return()=>{l.removeEventListener(eg,c),setTimeout(()=>{let t=new CustomEvent(eb,ev);l.addEventListener(eb,d),l.dispatchEvent(t),t.defaultPrevented||ew(e??document.body,{select:!0}),l.removeEventListener(eb,d),ez.remove(p)},0)}}},[l,c,d,p]);let f=m.useCallback(e=>{if(!n&&!r||p.paused)return;let t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,a=document.activeElement;if(t&&a){var i;let t,r=e.currentTarget,[s,l]=[eN(t=ej(i=r),i),eN(t.reverse(),i)];s&&l?e.shiftKey||a!==l?e.shiftKey&&a===s&&(e.preventDefault(),n&&ew(l,{select:!0})):(e.preventDefault(),n&&ew(s,{select:!0})):a===r&&e.preventDefault()}},[n,r,p.paused]);return(0,x.jsx)(er.Primitive.div,{tabIndex:-1,...s,ref:h,onKeyDown:f})});function ej(e){let t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{let t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function eN(e,t){for(let n of e)if(!function(e,{upTo:t}){if("hidden"===getComputedStyle(e).visibility)return!0;for(;e&&(void 0===t||e!==t);){if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}(n,{upTo:t}))return n}function ew(e,{select:t=!1}={}){if(e&&e.focus){var n;let r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&(n=e)instanceof HTMLInputElement&&"select"in n&&t&&e.select()}}ey.displayName="FocusScope";var ez=(r=[],{add(e){let t=r[0];e!==t&&t?.pause(),(r=ek(r,e)).unshift(e)},remove(e){r=ek(r,e),r[0]?.resume()}});function ek(e,t){let n=[...e],r=n.indexOf(t);return -1!==r&&n.splice(r,1),n}var e_=e.i(1998),eS=e.i(54079),eC=e.i(67892),eP=e.i(48179),eM="rovingFocusGroup.onEntryFocus",eA={bubbles:!1,cancelable:!0},eE="RovingFocusGroup",[eR,eD,eF]=el(eE),[eT,eI]=(0,et.createContextScope)(eE,[eF]),[eL,e$]=eT(eE),eO=m.forwardRef((e,t)=>(0,x.jsx)(eR.Provider,{scope:e.__scopeRovingFocusGroup,children:(0,x.jsx)(eR.Slot,{scope:e.__scopeRovingFocusGroup,children:(0,x.jsx)(eB,{...e,ref:t})})}));eO.displayName=eE;var eB=m.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:n,orientation:r,loop:a=!1,dir:i,currentTabStopId:s,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:o,onEntryFocus:c,preventScrollOnEntryFocus:d=!1,...u}=e,h=m.useRef(null),p=(0,ee.useComposedRefs)(t,h),f=ex(i),[g,b]=(0,en.useControllableState)({prop:s,defaultProp:l??null,onChange:o,caller:eE}),[v,y]=m.useState(!1),j=(0,ef.useCallbackRef)(c),N=eD(n),w=m.useRef(!1),[z,k]=m.useState(0);return m.useEffect(()=>{let e=h.current;if(e)return e.addEventListener(eM,j),()=>e.removeEventListener(eM,j)},[j]),(0,x.jsx)(eL,{scope:n,orientation:r,dir:f,loop:a,currentTabStopId:g,onItemFocus:m.useCallback(e=>b(e),[b]),onItemShiftTab:m.useCallback(()=>y(!0),[]),onFocusableItemAdd:m.useCallback(()=>k(e=>e+1),[]),onFocusableItemRemove:m.useCallback(()=>k(e=>e-1),[]),children:(0,x.jsx)(er.Primitive.div,{tabIndex:v||0===z?-1:0,"data-orientation":r,...u,ref:p,style:{outline:"none",...e.style},onMouseDown:(0,J.composeEventHandlers)(e.onMouseDown,()=>{w.current=!0}),onFocus:(0,J.composeEventHandlers)(e.onFocus,e=>{let t=!w.current;if(e.target===e.currentTarget&&t&&!v){let t=new CustomEvent(eM,eA);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){let e=N().filter(e=>e.focusable);eq([e.find(e=>e.active),e.find(e=>e.id===g),...e].filter(Boolean).map(e=>e.ref.current),d)}}w.current=!1}),onBlur:(0,J.composeEventHandlers)(e.onBlur,()=>y(!1))})})}),eH="RovingFocusGroupItem",eK=m.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:n,focusable:r=!0,active:a=!1,tabStopId:i,children:s,...l}=e,o=(0,e_.useId)(),c=i||o,d=e$(eH,n),u=d.currentTabStopId===c,h=eD(n),{onFocusableItemAdd:p,onFocusableItemRemove:f,currentTabStopId:g}=d;return m.useEffect(()=>{if(r)return p(),()=>f()},[r,p,f]),(0,x.jsx)(eR.ItemSlot,{scope:n,id:c,focusable:r,active:a,children:(0,x.jsx)(er.Primitive.span,{tabIndex:u?0:-1,"data-orientation":d.orientation,...l,ref:t,onMouseDown:(0,J.composeEventHandlers)(e.onMouseDown,e=>{r?d.onItemFocus(c):e.preventDefault()}),onFocus:(0,J.composeEventHandlers)(e.onFocus,()=>d.onItemFocus(c)),onKeyDown:(0,J.composeEventHandlers)(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey)return void d.onItemShiftTab();if(e.target!==e.currentTarget)return;let t=function(e,t,n){var r;let a=(r=e.key,"rtl"!==n?r:"ArrowLeft"===r?"ArrowRight":"ArrowRight"===r?"ArrowLeft":r);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(a))&&!("horizontal"===t&&["ArrowUp","ArrowDown"].includes(a)))return eZ[a]}(e,d.orientation,d.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let a=h().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)a.reverse();else if("prev"===t||"next"===t){var n,r;"prev"===t&&a.reverse();let i=a.indexOf(e.currentTarget);a=d.loop?(n=a,r=i+1,n.map((e,t)=>n[(r+t)%n.length])):a.slice(i+1)}setTimeout(()=>eq(a))}}),children:"function"==typeof s?s({isCurrentTabStop:u,hasTabStop:null!=g}):s})})});eK.displayName=eH;var eZ={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function eq(e,t=!1){let n=document.activeElement;for(let r of e)if(r===n||(r.focus({preventScroll:t}),document.activeElement!==n))return}var eU=Symbol("radix.slottable");function eW(e){return m.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===eU}var eV=new WeakMap,eG=new WeakMap,eX={},eY=0,eQ=function(e){return e&&(e.host||eQ(e.parentNode))},eJ=function(e,t,n,r){var a=(Array.isArray(e)?e:[e]).map(function(e){if(t.contains(e))return e;var n=eQ(e);return n&&t.contains(n)?n:(console.error("aria-hidden",e,"in not contained inside",t,". Doing nothing"),null)}).filter(function(e){return!!e});eX[n]||(eX[n]=new WeakMap);var i=eX[n],s=[],l=new Set,o=new Set(a),c=function(e){!e||l.has(e)||(l.add(e),c(e.parentNode))};a.forEach(c);var d=function(e){!e||o.has(e)||Array.prototype.forEach.call(e.children,function(e){if(l.has(e))d(e);else try{var t=e.getAttribute(r),a=null!==t&&"false"!==t,o=(eV.get(e)||0)+1,c=(i.get(e)||0)+1;eV.set(e,o),i.set(e,c),s.push(e),1===o&&a&&eG.set(e,!0),1===c&&e.setAttribute(n,"true"),a||e.setAttribute(r,"true")}catch(t){console.error("aria-hidden: cannot operate on ",e,t)}})};return d(t),l.clear(),eY++,function(){s.forEach(function(e){var t=eV.get(e)-1,a=i.get(e)-1;eV.set(e,t),i.set(e,a),t||(eG.has(e)||e.removeAttribute(r),eG.delete(e)),a||e.removeAttribute(n)}),--eY||(eV=new WeakMap,eV=new WeakMap,eG=new WeakMap,eX={})}},e0=function(e,t,n){void 0===n&&(n="data-aria-hidden");var r=Array.from(Array.isArray(e)?e:[e]),a=t||("u"<typeof document?null:(Array.isArray(e)?e[0]:e).ownerDocument.body);return a?(r.push.apply(r,Array.from(a.querySelectorAll("[aria-live], script"))),eJ(r,a,n,"aria-hidden")):function(){return null}},e1=e.i(22766),e2="right-scroll-bar-position",e5="width-before-scroll-bar";function e4(e,t){return"function"==typeof e?e(t):e&&(e.current=t),e}var e3="u">typeof window?m.useLayoutEffect:m.useEffect,e8=new WeakMap,e6=(void 0===i&&(i={}),(void 0===s&&(s=function(e){return e}),l=[],o=!1,c={read:function(){if(o)throw Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return l.length?l[l.length-1]:null},useMedium:function(e){var t=s(e,o);return l.push(t),function(){l=l.filter(function(e){return e!==t})}},assignSyncMedium:function(e){for(o=!0;l.length;){var t=l;l=[],t.forEach(e)}l={push:function(t){return e(t)},filter:function(){return l}}},assignMedium:function(e){o=!0;var t=[];if(l.length){var n=l;l=[],n.forEach(e),t=l}var r=function(){var n=t;t=[],n.forEach(e)},a=function(){return Promise.resolve().then(r)};a(),l={push:function(e){t.push(e),a()},filter:function(e){return t=t.filter(e),l}}}}).options=(0,e1.__assign)({async:!0,ssr:!1},i),c),e9=function(){},e7=m.forwardRef(function(e,t){var n,r,a,i,s=m.useRef(null),l=m.useState({onScrollCapture:e9,onWheelCapture:e9,onTouchMoveCapture:e9}),o=l[0],c=l[1],d=e.forwardProps,u=e.children,x=e.className,h=e.removeScrollBar,p=e.enabled,f=e.shards,g=e.sideCar,b=e.noRelative,v=e.noIsolation,y=e.inert,j=e.allowPinchZoom,N=e.as,w=e.gapMode,z=(0,e1.__rest)(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),k=(n=[s,t],r=function(e){return n.forEach(function(t){return e4(t,e)})},(a=(0,m.useState)(function(){return{value:null,callback:r,facade:{get current(){return a.value},set current(value){var e=a.value;e!==value&&(a.value=value,a.callback(value,e))}}}})[0]).callback=r,i=a.facade,e3(function(){var e=e8.get(i);if(e){var t=new Set(e),r=new Set(n),a=i.current;t.forEach(function(e){r.has(e)||e4(e,null)}),r.forEach(function(e){t.has(e)||e4(e,a)})}e8.set(i,n)},[n]),i),_=(0,e1.__assign)((0,e1.__assign)({},z),o);return m.createElement(m.Fragment,null,p&&m.createElement(g,{sideCar:e6,removeScrollBar:h,shards:f,noRelative:b,noIsolation:v,inert:y,setCallbacks:c,allowPinchZoom:!!j,lockRef:s,gapMode:w}),d?m.cloneElement(m.Children.only(u),(0,e1.__assign)((0,e1.__assign)({},_),{ref:k})):m.createElement(void 0===N?"div":N,(0,e1.__assign)({},_,{className:x,ref:k}),u))});e7.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},e7.classNames={fullWidth:e5,zeroRight:e2};var te=function(e){var t=e.sideCar,n=(0,e1.__rest)(e,["sideCar"]);if(!t)throw Error("Sidecar: please provide `sideCar` property to import the right car");var r=t.read();if(!r)throw Error("Sidecar medium not found");return m.createElement(r,(0,e1.__assign)({},n))};te.isSideCarExport=!0;var tt=function(){var e=0,t=null;return{add:function(n){if(0==e&&(t=function(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=u||("u">typeof __webpack_nonce__?__webpack_nonce__:void 0);return t&&e.setAttribute("nonce",t),e}())){var r,a;(r=t).styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n)),a=t,(document.head||document.getElementsByTagName("head")[0]).appendChild(a)}e++},remove:function(){--e||!t||(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},tn=function(){var e=tt();return function(t,n){m.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},tr=function(){var e=tn();return function(t){return e(t.styles,t.dynamic),null}},ta={left:0,top:0,right:0,gap:0},ti=function(e){return parseInt(e||"",10)||0},ts=function(e){var t=window.getComputedStyle(document.body),n=t["padding"===e?"paddingLeft":"marginLeft"],r=t["padding"===e?"paddingTop":"marginTop"],a=t["padding"===e?"paddingRight":"marginRight"];return[ti(n),ti(r),ti(a)]},tl=function(e){if(void 0===e&&(e="margin"),"u"<typeof window)return ta;var t=ts(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},to=tr(),tc="data-scroll-locked",td=function(e,t,n,r){var a=e.left,i=e.top,s=e.right,l=e.gap;return void 0===n&&(n="margin"),"\n  .".concat("with-scroll-bars-hidden"," {\n   overflow: hidden ").concat(r,";\n   padding-right: ").concat(l,"px ").concat(r,";\n  }\n  body[").concat(tc,"] {\n    overflow: hidden ").concat(r,";\n    overscroll-behavior: contain;\n    ").concat([t&&"position: relative ".concat(r,";"),"margin"===n&&"\n    padding-left: ".concat(a,"px;\n    padding-top: ").concat(i,"px;\n    padding-right: ").concat(s,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(l,"px ").concat(r,";\n    "),"padding"===n&&"padding-right: ".concat(l,"px ").concat(r,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(e2," {\n    right: ").concat(l,"px ").concat(r,";\n  }\n  \n  .").concat(e5," {\n    margin-right: ").concat(l,"px ").concat(r,";\n  }\n  \n  .").concat(e2," .").concat(e2," {\n    right: 0 ").concat(r,";\n  }\n  \n  .").concat(e5," .").concat(e5," {\n    margin-right: 0 ").concat(r,";\n  }\n  \n  body[").concat(tc,"] {\n    ").concat("--removed-body-scroll-bar-size",": ").concat(l,"px;\n  }\n")},tu=function(){var e=parseInt(document.body.getAttribute(tc)||"0",10);return isFinite(e)?e:0},tx=function(){m.useEffect(function(){return document.body.setAttribute(tc,(tu()+1).toString()),function(){var e=tu()-1;e<=0?document.body.removeAttribute(tc):document.body.setAttribute(tc,e.toString())}},[])},tm=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,a=void 0===r?"margin":r;tx();var i=m.useMemo(function(){return tl(a)},[a]);return m.createElement(to,{styles:td(i,!t,a,n?"":"!important")})},th=!1;if("u">typeof window)try{var tp=Object.defineProperty({},"passive",{get:function(){return th=!0,!0}});window.addEventListener("test",tp,tp),window.removeEventListener("test",tp,tp)}catch(e){th=!1}var tf=!!th&&{passive:!1},tg=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return"hidden"!==n[t]&&(n.overflowY!==n.overflowX||"TEXTAREA"===e.tagName||"visible"!==n[t])},tb=function(e,t){var n=t.ownerDocument,r=t;do{if("u">typeof ShadowRoot&&r instanceof ShadowRoot&&(r=r.host),tv(e,r)){var a=ty(e,r);if(a[1]>a[2])return!0}r=r.parentNode}while(r&&r!==n.body)return!1},tv=function(e,t){return"v"===e?tg(t,"overflowY"):tg(t,"overflowX")},ty=function(e,t){return"v"===e?[t.scrollTop,t.scrollHeight,t.clientHeight]:[t.scrollLeft,t.scrollWidth,t.clientWidth]},tj=function(e,t,n,r,a){var i,s=(i=window.getComputedStyle(t).direction,"h"===e&&"rtl"===i?-1:1),l=s*r,o=n.target,c=t.contains(o),d=!1,u=l>0,x=0,m=0;do{if(!o)break;var h=ty(e,o),p=h[0],f=h[1]-h[2]-s*p;(p||f)&&tv(e,o)&&(x+=f,m+=p);var g=o.parentNode;o=g&&g.nodeType===Node.DOCUMENT_FRAGMENT_NODE?g.host:g}while(!c&&o!==document.body||c&&(t.contains(o)||t===o))return u&&(a&&1>Math.abs(x)||!a&&l>x)?d=!0:!u&&(a&&1>Math.abs(m)||!a&&-l>m)&&(d=!0),d},tN=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},tw=function(e){return[e.deltaX,e.deltaY]},tz=function(e){return e&&"current"in e?e.current:e},tk=0,t_=[];let tS=(d=function(e){var t=m.useRef([]),n=m.useRef([0,0]),r=m.useRef(),a=m.useState(tk++)[0],i=m.useState(tr)[0],s=m.useRef(e);m.useEffect(function(){s.current=e},[e]),m.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(a));var t=(0,e1.__spreadArray)([e.lockRef.current],(e.shards||[]).map(tz),!0).filter(Boolean);return t.forEach(function(e){return e.classList.add("allow-interactivity-".concat(a))}),function(){document.body.classList.remove("block-interactivity-".concat(a)),t.forEach(function(e){return e.classList.remove("allow-interactivity-".concat(a))})}}},[e.inert,e.lockRef.current,e.shards]);var l=m.useCallback(function(e,t){if("touches"in e&&2===e.touches.length||"wheel"===e.type&&e.ctrlKey)return!s.current.allowPinchZoom;var a,i=tN(e),l=n.current,o="deltaX"in e?e.deltaX:l[0]-i[0],c="deltaY"in e?e.deltaY:l[1]-i[1],d=e.target,u=Math.abs(o)>Math.abs(c)?"h":"v";if("touches"in e&&"h"===u&&"range"===d.type)return!1;var x=window.getSelection(),m=x&&x.anchorNode;if(m&&(m===d||m.contains(d)))return!1;var h=tb(u,d);if(!h)return!0;if(h?a=u:(a="v"===u?"h":"v",h=tb(u,d)),!h)return!1;if(!r.current&&"changedTouches"in e&&(o||c)&&(r.current=a),!a)return!0;var p=r.current||a;return tj(p,t,e,"h"===p?o:c,!0)},[]),o=m.useCallback(function(e){if(t_.length&&t_[t_.length-1]===i){var n="deltaY"in e?tw(e):tN(e),r=t.current.filter(function(t){var r;return t.name===e.type&&(t.target===e.target||e.target===t.shadowParent)&&(r=t.delta,r[0]===n[0]&&r[1]===n[1])})[0];if(r&&r.should){e.cancelable&&e.preventDefault();return}if(!r){var a=(s.current.shards||[]).map(tz).filter(Boolean).filter(function(t){return t.contains(e.target)});(a.length>0?l(e,a[0]):!s.current.noIsolation)&&e.cancelable&&e.preventDefault()}}},[]),c=m.useCallback(function(e,n,r,a){var i={name:e,delta:n,target:r,should:a,shadowParent:function(e){for(var t=null;null!==e;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}(r)};t.current.push(i),setTimeout(function(){t.current=t.current.filter(function(e){return e!==i})},1)},[]),d=m.useCallback(function(e){n.current=tN(e),r.current=void 0},[]),u=m.useCallback(function(t){c(t.type,tw(t),t.target,l(t,e.lockRef.current))},[]),x=m.useCallback(function(t){c(t.type,tN(t),t.target,l(t,e.lockRef.current))},[]);m.useEffect(function(){return t_.push(i),e.setCallbacks({onScrollCapture:u,onWheelCapture:u,onTouchMoveCapture:x}),document.addEventListener("wheel",o,tf),document.addEventListener("touchmove",o,tf),document.addEventListener("touchstart",d,tf),function(){t_=t_.filter(function(e){return e!==i}),document.removeEventListener("wheel",o,tf),document.removeEventListener("touchmove",o,tf),document.removeEventListener("touchstart",d,tf)}},[]);var h=e.removeScrollBar,p=e.inert;return m.createElement(m.Fragment,null,p?m.createElement(i,{styles:"\n  .block-interactivity-".concat(a," {pointer-events: none;}\n  .allow-interactivity-").concat(a," {pointer-events: all;}\n")}):null,h?m.createElement(tm,{noRelative:e.noRelative,gapMode:e.gapMode}):null)},e6.useMedium(d),te);var tC=m.forwardRef(function(e,t){return m.createElement(e7,(0,e1.__assign)({},e,{ref:t,sideCar:tS}))});tC.classNames=e7.classNames;var tP=["Enter"," "],tM=["ArrowUp","PageDown","End"],tA=["ArrowDown","PageUp","Home",...tM],tE={ltr:[...tP,"ArrowRight"],rtl:[...tP,"ArrowLeft"]},tR={ltr:["ArrowLeft"],rtl:["ArrowRight"]},tD="Menu",[tF,tT,tI]=el(tD),[tL,t$]=(0,et.createContextScope)(tD,[tI,eS.createPopperScope,eI]),tO=(0,eS.createPopperScope)(),tB=eI(),[tH,tK]=tL(tD),[tZ,tq]=tL(tD),tU=e=>{let{__scopeMenu:t,open:n=!1,children:r,dir:a,onOpenChange:i,modal:s=!0}=e,l=tO(t),[o,c]=m.useState(null),d=m.useRef(!1),u=(0,ef.useCallbackRef)(i),h=ex(a);return m.useEffect(()=>{let e=()=>{d.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>d.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}},[]),(0,x.jsx)(eS.Root,{...l,children:(0,x.jsx)(tH,{scope:t,open:n,onOpenChange:u,content:o,onContentChange:c,children:(0,x.jsx)(tZ,{scope:t,onClose:m.useCallback(()=>u(!1),[u]),isUsingKeyboardRef:d,dir:h,modal:s,children:r})})})};tU.displayName=tD;var tW=m.forwardRef((e,t)=>{let{__scopeMenu:n,...r}=e,a=tO(n);return(0,x.jsx)(eS.Anchor,{...a,...r,ref:t})});tW.displayName="MenuAnchor";var tV="MenuPortal",[tG,tX]=tL(tV,{forceMount:void 0}),tY=e=>{let{__scopeMenu:t,forceMount:n,children:r,container:a}=e,i=tK(tV,t);return(0,x.jsx)(tG,{scope:t,forceMount:n,children:(0,x.jsx)(eP.Presence,{present:n||i.open,children:(0,x.jsx)(eC.Portal,{asChild:!0,container:a,children:r})})})};tY.displayName=tV;var tQ="MenuContent",[tJ,t0]=tL(tQ),t1=m.forwardRef((e,t)=>{let n=tX(tQ,e.__scopeMenu),{forceMount:r=n.forceMount,...a}=e,i=tK(tQ,e.__scopeMenu),s=tq(tQ,e.__scopeMenu);return(0,x.jsx)(tF.Provider,{scope:e.__scopeMenu,children:(0,x.jsx)(eP.Presence,{present:r||i.open,children:(0,x.jsx)(tF.Slot,{scope:e.__scopeMenu,children:s.modal?(0,x.jsx)(t2,{...a,ref:t}):(0,x.jsx)(t5,{...a,ref:t})})})})}),t2=m.forwardRef((e,t)=>{let n=tK(tQ,e.__scopeMenu),r=m.useRef(null),a=(0,ee.useComposedRefs)(t,r);return m.useEffect(()=>{let e=r.current;if(e)return e0(e)},[]),(0,x.jsx)(t3,{...e,ref:a,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:(0,J.composeEventHandlers)(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),t5=m.forwardRef((e,t)=>{let n=tK(tQ,e.__scopeMenu);return(0,x.jsx)(t3,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),t4=((a=m.forwardRef((e,t)=>{let{children:n,...r}=e;if(m.isValidElement(n)){var a;let e,i,s=(a=n,(i=(e=Object.getOwnPropertyDescriptor(a.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?a.ref:(i=(e=Object.getOwnPropertyDescriptor(a,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?a.props.ref:a.props.ref||a.ref),l=function(e,t){let n={...t};for(let r in t){let a=e[r],i=t[r];/^on[A-Z]/.test(r)?a&&i?n[r]=(...e)=>{let t=i(...e);return a(...e),t}:a&&(n[r]=a):"style"===r?n[r]={...a,...i}:"className"===r&&(n[r]=[a,i].filter(Boolean).join(" "))}return{...e,...n}}(r,n.props);return n.type!==m.Fragment&&(l.ref=t?(0,ee.composeRefs)(t,s):s),m.cloneElement(n,l)}return m.Children.count(n)>1?m.Children.only(null):null})).displayName="MenuContent.ScrollLock.SlotClone",t=a,(n=m.forwardRef((e,n)=>{let{children:r,...a}=e,i=m.Children.toArray(r),s=i.find(eW);if(s){let e=s.props.children,r=i.map(t=>t!==s?t:m.Children.count(e)>1?m.Children.only(null):m.isValidElement(e)?e.props.children:null);return(0,x.jsx)(t,{...a,ref:n,children:m.isValidElement(e)?m.cloneElement(e,void 0,r):null})}return(0,x.jsx)(t,{...a,ref:n,children:r})})).displayName="MenuContent.ScrollLock.Slot",n),t3=m.forwardRef((e,t)=>{let{__scopeMenu:n,loop:r=!1,trapFocus:a,onOpenAutoFocus:i,onCloseAutoFocus:s,disableOutsidePointerEvents:l,onEntryFocus:o,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:h,onDismiss:p,disableOutsideScroll:f,...g}=e,b=tK(tQ,n),v=tq(tQ,n),y=tO(n),j=tB(n),N=tT(n),[w,z]=m.useState(null),k=m.useRef(null),_=(0,ee.useComposedRefs)(t,k,b.onContentChange),S=m.useRef(0),C=m.useRef(""),P=m.useRef(0),M=m.useRef(null),A=m.useRef("right"),E=m.useRef(0),R=f?tC:m.Fragment;m.useEffect(()=>()=>window.clearTimeout(S.current),[]),m.useEffect(()=>{let e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??ep()),document.body.insertAdjacentElement("beforeend",e[1]??ep()),eh++,()=>{1===eh&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),eh--}},[]);let D=m.useCallback(e=>{var t,n;return A.current===M.current?.side&&(t=e,!!(n=M.current?.area)&&function(e,t){let{x:n,y:r}=e,a=!1;for(let e=0,i=t.length-1;e<t.length;i=e++){let s=t[e],l=t[i],o=s.x,c=s.y,d=l.x,u=l.y;c>r!=u>r&&n<(d-o)*(r-c)/(u-c)+o&&(a=!a)}return a}({x:t.clientX,y:t.clientY},n))},[]);return(0,x.jsx)(tJ,{scope:n,searchRef:C,onItemEnter:m.useCallback(e=>{D(e)&&e.preventDefault()},[D]),onItemLeave:m.useCallback(e=>{D(e)||(k.current?.focus(),z(null))},[D]),onTriggerLeave:m.useCallback(e=>{D(e)&&e.preventDefault()},[D]),pointerGraceTimerRef:P,onPointerGraceIntentChange:m.useCallback(e=>{M.current=e},[]),children:(0,x.jsx)(R,{...f?{as:t4,allowPinchZoom:!0}:void 0,children:(0,x.jsx)(ey,{asChild:!0,trapped:a,onMountAutoFocus:(0,J.composeEventHandlers)(i,e=>{e.preventDefault(),k.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:s,children:(0,x.jsx)(em.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:h,onDismiss:p,children:(0,x.jsx)(eO,{asChild:!0,...j,dir:v.dir,orientation:"vertical",loop:r,currentTabStopId:w,onCurrentTabStopIdChange:z,onEntryFocus:(0,J.composeEventHandlers)(o,e=>{v.isUsingKeyboardRef.current||e.preventDefault()}),preventScrollOnEntryFocus:!0,children:(0,x.jsx)(eS.Content,{role:"menu","aria-orientation":"vertical","data-state":nj(b.open),"data-radix-menu-content":"",dir:v.dir,...y,...g,ref:_,style:{outline:"none",...g.style},onKeyDown:(0,J.composeEventHandlers)(g.onKeyDown,e=>{let t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,n=e.ctrlKey||e.altKey||e.metaKey,r=1===e.key.length;if(t){var a;let t,i,s,l,o,c;"Tab"===e.key&&e.preventDefault(),!n&&r&&(a=e.key,t=C.current+a,i=N().filter(e=>!e.disabled),s=document.activeElement,l=i.find(e=>e.ref.current===s)?.textValue,o=function(e,t,n){var r;let a=t.length>1&&Array.from(t).every(e=>e===t[0])?t[0]:t,i=n?e.indexOf(n):-1,s=(r=Math.max(i,0),e.map((t,n)=>e[(r+n)%e.length]));1===a.length&&(s=s.filter(e=>e!==n));let l=s.find(e=>e.toLowerCase().startsWith(a.toLowerCase()));return l!==n?l:void 0}(i.map(e=>e.textValue),t,l),c=i.find(e=>e.textValue===o)?.ref.current,function e(t){C.current=t,window.clearTimeout(S.current),""!==t&&(S.current=window.setTimeout(()=>e(""),1e3))}(t),c&&setTimeout(()=>c.focus()))}let i=k.current;if(e.target!==i||!tA.includes(e.key))return;e.preventDefault();let s=N().filter(e=>!e.disabled).map(e=>e.ref.current);tM.includes(e.key)&&s.reverse(),function(e){let t=document.activeElement;for(let n of e)if(n===t||(n.focus(),document.activeElement!==t))return}(s)}),onBlur:(0,J.composeEventHandlers)(e.onBlur,e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(S.current),C.current="")}),onPointerMove:(0,J.composeEventHandlers)(e.onPointerMove,nz(e=>{let t=e.target,n=E.current!==e.clientX;e.currentTarget.contains(t)&&n&&(A.current=e.clientX>E.current?"right":"left",E.current=e.clientX)}))})})})})})})});t1.displayName=tQ;var t8=m.forwardRef((e,t)=>{let{__scopeMenu:n,...r}=e;return(0,x.jsx)(er.Primitive.div,{role:"group",...r,ref:t})});t8.displayName="MenuGroup";var t6=m.forwardRef((e,t)=>{let{__scopeMenu:n,...r}=e;return(0,x.jsx)(er.Primitive.div,{...r,ref:t})});t6.displayName="MenuLabel";var t9="MenuItem",t7="menu.itemSelect",ne=m.forwardRef((e,t)=>{let{disabled:n=!1,onSelect:r,...a}=e,i=m.useRef(null),s=tq(t9,e.__scopeMenu),l=t0(t9,e.__scopeMenu),o=(0,ee.useComposedRefs)(t,i),c=m.useRef(!1);return(0,x.jsx)(nt,{...a,ref:o,disabled:n,onClick:(0,J.composeEventHandlers)(e.onClick,()=>{let e=i.current;if(!n&&e){let t=new CustomEvent(t7,{bubbles:!0,cancelable:!0});e.addEventListener(t7,e=>r?.(e),{once:!0}),(0,er.dispatchDiscreteCustomEvent)(e,t),t.defaultPrevented?c.current=!1:s.onClose()}}),onPointerDown:t=>{e.onPointerDown?.(t),c.current=!0},onPointerUp:(0,J.composeEventHandlers)(e.onPointerUp,e=>{c.current||e.currentTarget?.click()}),onKeyDown:(0,J.composeEventHandlers)(e.onKeyDown,e=>{let t=""!==l.searchRef.current;n||t&&" "===e.key||tP.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())})})});ne.displayName=t9;var nt=m.forwardRef((e,t)=>{let{__scopeMenu:n,disabled:r=!1,textValue:a,...i}=e,s=t0(t9,n),l=tB(n),o=m.useRef(null),c=(0,ee.useComposedRefs)(t,o),[d,u]=m.useState(!1),[h,p]=m.useState("");return m.useEffect(()=>{let e=o.current;e&&p((e.textContent??"").trim())},[i.children]),(0,x.jsx)(tF.ItemSlot,{scope:n,disabled:r,textValue:a??h,children:(0,x.jsx)(eK,{asChild:!0,...l,focusable:!r,children:(0,x.jsx)(er.Primitive.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...i,ref:c,onPointerMove:(0,J.composeEventHandlers)(e.onPointerMove,nz(e=>{r?s.onItemLeave(e):(s.onItemEnter(e),e.defaultPrevented||e.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:(0,J.composeEventHandlers)(e.onPointerLeave,nz(e=>s.onItemLeave(e))),onFocus:(0,J.composeEventHandlers)(e.onFocus,()=>u(!0)),onBlur:(0,J.composeEventHandlers)(e.onBlur,()=>u(!1))})})})}),nn=m.forwardRef((e,t)=>{let{checked:n=!1,onCheckedChange:r,...a}=e;return(0,x.jsx)(nd,{scope:e.__scopeMenu,checked:n,children:(0,x.jsx)(ne,{role:"menuitemcheckbox","aria-checked":nN(n)?"mixed":n,...a,ref:t,"data-state":nw(n),onSelect:(0,J.composeEventHandlers)(a.onSelect,()=>r?.(!!nN(n)||!n),{checkForDefaultPrevented:!1})})})});nn.displayName="MenuCheckboxItem";var nr="MenuRadioGroup",[na,ni]=tL(nr,{value:void 0,onValueChange:()=>{}}),ns=m.forwardRef((e,t)=>{let{value:n,onValueChange:r,...a}=e,i=(0,ef.useCallbackRef)(r);return(0,x.jsx)(na,{scope:e.__scopeMenu,value:n,onValueChange:i,children:(0,x.jsx)(t8,{...a,ref:t})})});ns.displayName=nr;var nl="MenuRadioItem",no=m.forwardRef((e,t)=>{let{value:n,...r}=e,a=ni(nl,e.__scopeMenu),i=n===a.value;return(0,x.jsx)(nd,{scope:e.__scopeMenu,checked:i,children:(0,x.jsx)(ne,{role:"menuitemradio","aria-checked":i,...r,ref:t,"data-state":nw(i),onSelect:(0,J.composeEventHandlers)(r.onSelect,()=>a.onValueChange?.(n),{checkForDefaultPrevented:!1})})})});no.displayName=nl;var nc="MenuItemIndicator",[nd,nu]=tL(nc,{checked:!1}),nx=m.forwardRef((e,t)=>{let{__scopeMenu:n,forceMount:r,...a}=e,i=nu(nc,n);return(0,x.jsx)(eP.Presence,{present:r||nN(i.checked)||!0===i.checked,children:(0,x.jsx)(er.Primitive.span,{...a,ref:t,"data-state":nw(i.checked)})})});nx.displayName=nc;var nm=m.forwardRef((e,t)=>{let{__scopeMenu:n,...r}=e;return(0,x.jsx)(er.Primitive.div,{role:"separator","aria-orientation":"horizontal",...r,ref:t})});nm.displayName="MenuSeparator";var nh=m.forwardRef((e,t)=>{let{__scopeMenu:n,...r}=e,a=tO(n);return(0,x.jsx)(eS.Arrow,{...a,...r,ref:t})});nh.displayName="MenuArrow";var[np,nf]=tL("MenuSub"),ng="MenuSubTrigger",nb=m.forwardRef((e,t)=>{let n=tK(ng,e.__scopeMenu),r=tq(ng,e.__scopeMenu),a=nf(ng,e.__scopeMenu),i=t0(ng,e.__scopeMenu),s=m.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:o}=i,c={__scopeMenu:e.__scopeMenu},d=m.useCallback(()=>{s.current&&window.clearTimeout(s.current),s.current=null},[]);return m.useEffect(()=>d,[d]),m.useEffect(()=>{let e=l.current;return()=>{window.clearTimeout(e),o(null)}},[l,o]),(0,x.jsx)(tW,{asChild:!0,...c,children:(0,x.jsx)(nt,{id:a.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":a.contentId,"data-state":nj(n.open),...e,ref:(0,ee.composeRefs)(t,a.onTriggerChange),onClick:t=>{e.onClick?.(t),e.disabled||t.defaultPrevented||(t.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:(0,J.composeEventHandlers)(e.onPointerMove,nz(t=>{i.onItemEnter(t),!t.defaultPrevented&&(e.disabled||n.open||s.current||(i.onPointerGraceIntentChange(null),s.current=window.setTimeout(()=>{n.onOpenChange(!0),d()},100)))})),onPointerLeave:(0,J.composeEventHandlers)(e.onPointerLeave,nz(e=>{d();let t=n.content?.getBoundingClientRect();if(t){let r=n.content?.dataset.side,a="right"===r,s=t[a?"left":"right"],o=t[a?"right":"left"];i.onPointerGraceIntentChange({area:[{x:e.clientX+(a?-5:5),y:e.clientY},{x:s,y:t.top},{x:o,y:t.top},{x:o,y:t.bottom},{x:s,y:t.bottom}],side:r}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>i.onPointerGraceIntentChange(null),300)}else{if(i.onTriggerLeave(e),e.defaultPrevented)return;i.onPointerGraceIntentChange(null)}})),onKeyDown:(0,J.composeEventHandlers)(e.onKeyDown,t=>{let a=""!==i.searchRef.current;e.disabled||a&&" "===t.key||tE[r.dir].includes(t.key)&&(n.onOpenChange(!0),n.content?.focus(),t.preventDefault())})})})});nb.displayName=ng;var nv="MenuSubContent",ny=m.forwardRef((e,t)=>{let n=tX(tQ,e.__scopeMenu),{forceMount:r=n.forceMount,...a}=e,i=tK(tQ,e.__scopeMenu),s=tq(tQ,e.__scopeMenu),l=nf(nv,e.__scopeMenu),o=m.useRef(null),c=(0,ee.useComposedRefs)(t,o);return(0,x.jsx)(tF.Provider,{scope:e.__scopeMenu,children:(0,x.jsx)(eP.Presence,{present:r||i.open,children:(0,x.jsx)(tF.Slot,{scope:e.__scopeMenu,children:(0,x.jsx)(t3,{id:l.contentId,"aria-labelledby":l.triggerId,...a,ref:c,align:"start",side:"rtl"===s.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{s.isUsingKeyboardRef.current&&o.current?.focus(),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:(0,J.composeEventHandlers)(e.onFocusOutside,e=>{e.target!==l.trigger&&i.onOpenChange(!1)}),onEscapeKeyDown:(0,J.composeEventHandlers)(e.onEscapeKeyDown,e=>{s.onClose(),e.preventDefault()}),onKeyDown:(0,J.composeEventHandlers)(e.onKeyDown,e=>{let t=e.currentTarget.contains(e.target),n=tR[s.dir].includes(e.key);t&&n&&(i.onOpenChange(!1),l.trigger?.focus(),e.preventDefault())})})})})})});function nj(e){return e?"open":"closed"}function nN(e){return"indeterminate"===e}function nw(e){return nN(e)?"indeterminate":e?"checked":"unchecked"}function nz(e){return t=>"mouse"===t.pointerType?e(t):void 0}ny.displayName=nv;var nk="DropdownMenu",[n_,nS]=(0,et.createContextScope)(nk,[t$]),nC=t$(),[nP,nM]=n_(nk),nA=e=>{let{__scopeDropdownMenu:t,children:n,dir:r,open:a,defaultOpen:i,onOpenChange:s,modal:l=!0}=e,o=nC(t),c=m.useRef(null),[d,u]=(0,en.useControllableState)({prop:a,defaultProp:i??!1,onChange:s,caller:nk});return(0,x.jsx)(nP,{scope:t,triggerId:(0,e_.useId)(),triggerRef:c,contentId:(0,e_.useId)(),open:d,onOpenChange:u,onOpenToggle:m.useCallback(()=>u(e=>!e),[u]),modal:l,children:(0,x.jsx)(tU,{...o,open:d,onOpenChange:u,dir:r,modal:l,children:n})})};nA.displayName=nk;var nE="DropdownMenuTrigger",nR=m.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,disabled:r=!1,...a}=e,i=nM(nE,n),s=nC(n);return(0,x.jsx)(tW,{asChild:!0,...s,children:(0,x.jsx)(er.Primitive.button,{type:"button",id:i.triggerId,"aria-haspopup":"menu","aria-expanded":i.open,"aria-controls":i.open?i.contentId:void 0,"data-state":i.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...a,ref:(0,ee.composeRefs)(t,i.triggerRef),onPointerDown:(0,J.composeEventHandlers)(e.onPointerDown,e=>{!r&&0===e.button&&!1===e.ctrlKey&&(i.onOpenToggle(),i.open||e.preventDefault())}),onKeyDown:(0,J.composeEventHandlers)(e.onKeyDown,e=>{!r&&(["Enter"," "].includes(e.key)&&i.onOpenToggle(),"ArrowDown"===e.key&&i.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())})})})});nR.displayName=nE;var nD=e=>{let{__scopeDropdownMenu:t,...n}=e,r=nC(t);return(0,x.jsx)(tY,{...r,...n})};nD.displayName="DropdownMenuPortal";var nF="DropdownMenuContent",nT=m.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,a=nM(nF,n),i=nC(n),s=m.useRef(!1);return(0,x.jsx)(t1,{id:a.contentId,"aria-labelledby":a.triggerId,...i,...r,ref:t,onCloseAutoFocus:(0,J.composeEventHandlers)(e.onCloseAutoFocus,e=>{s.current||a.triggerRef.current?.focus(),s.current=!1,e.preventDefault()}),onInteractOutside:(0,J.composeEventHandlers)(e.onInteractOutside,e=>{let t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,r=2===t.button||n;(!a.modal||r)&&(s.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});nT.displayName=nF,m.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,a=nC(n);return(0,x.jsx)(t8,{...a,...r,ref:t})}).displayName="DropdownMenuGroup",m.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,a=nC(n);return(0,x.jsx)(t6,{...a,...r,ref:t})}).displayName="DropdownMenuLabel";var nI=m.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,a=nC(n);return(0,x.jsx)(ne,{...a,...r,ref:t})});function nL({...e}){return(0,x.jsx)(nA,{"data-slot":"dropdown-menu",...e})}function n$({...e}){return(0,x.jsx)(nR,{"data-slot":"dropdown-menu-trigger",...e})}function nO({className:e,sideOffset:t=4,...n}){return(0,x.jsx)(nD,{children:(0,x.jsx)(nT,{"data-slot":"dropdown-menu-content",sideOffset:t,className:(0,g.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",e),...n})})}function nB({className:e,inset:t,variant:n="default",...r}){return(0,x.jsx)(nI,{"data-slot":"dropdown-menu-item","data-inset":t,"data-variant":n,className:(0,g.cn)("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...r})}nI.displayName="DropdownMenuItem",m.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,a=nC(n);return(0,x.jsx)(nn,{...a,...r,ref:t})}).displayName="DropdownMenuCheckboxItem",m.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,a=nC(n);return(0,x.jsx)(ns,{...a,...r,ref:t})}).displayName="DropdownMenuRadioGroup",m.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,a=nC(n);return(0,x.jsx)(no,{...a,...r,ref:t})}).displayName="DropdownMenuRadioItem",m.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,a=nC(n);return(0,x.jsx)(nx,{...a,...r,ref:t})}).displayName="DropdownMenuItemIndicator",m.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,a=nC(n);return(0,x.jsx)(nm,{...a,...r,ref:t})}).displayName="DropdownMenuSeparator",m.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,a=nC(n);return(0,x.jsx)(nh,{...a,...r,ref:t})}).displayName="DropdownMenuArrow",m.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,a=nC(n);return(0,x.jsx)(nb,{...a,...r,ref:t})}).displayName="DropdownMenuSubTrigger",m.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,a=nC(n);return(0,x.jsx)(ny,{...a,...r,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})}).displayName="DropdownMenuSubContent",e.i(33854),e.i(115),(0,k.default)("circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var nH=e.i(78812);function nK({data:e,filename:t="export",label:n="匯出",className:r,disabled:a=!1,columns:i,chartType:s,snapshotData:l}){let{role:o,isLoading:c}=function(){let[e,t]=(0,m.useState)(null),[n,r]=(0,m.useState)(!0);return(0,m.useEffect)(()=>{let e=!0,n=async()=>{try{let{data:{session:n}}=await X.supabase.auth.getSession();if(!n?.user){e&&(t(null),r(!1));return}let{data:a,error:i}=await X.supabase.from("profiles").select("role").eq("id",n.user.id).single();e&&(a?t(a.role):t("user"),r(!1))}catch(n){console.error("Error fetching user role:",n),e&&(t("user"),r(!1))}};n();let{data:{subscription:a}}=X.supabase.auth.onAuthStateChange((e,r)=>{r?n():t(null)});return()=>{e=!1,a.unsubscribe()}},[]),{role:e,isLoading:n}}(),d=(0,q.useRouter)(),u=(0,Y.useReportBuilderStore)(e=>e.addItem),h=["pro","pro_max","admin","super_admin"].includes(o||""),p=!c,f=()=>{if(p&&h){if(!e||0===e.length)return void alert("無數據可導出");try{let n=Object.keys(e[0]),r=[n.map(e=>i&&i[e]||e).join(","),...e.map(e=>n.map(t=>{let n=e[t];if(null==n)return"";if("number"==typeof n){let e=i&&i[t]||t;return/Area|坪|Rate|Ratio|Share|Percent|比|率/.test(t)||/Area|坪|Rate|Ratio|Share|Percent|比|率/.test(e)?n.toFixed(2):Math.round(n).toFixed(0)}if("object"==typeof n)try{return`"${JSON.stringify(n).replace(/"/g,'""')}"`}catch(e){return""}return"string"==typeof n?`"${n.replace(/"/g,'""').replace(/\n/g," ")}"`:n}).join(","))].join("\n"),a=new Blob(["\uFEFF"+r],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(a),l=document.createElement("a"),o=new Date().toISOString().split("T")[0],c=`${t}_${o}.csv`;l.href=s,l.setAttribute("download",c),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(s)}catch(e){console.error("Export failed:",e),alert("匯出失敗，請查看控制台日誌")}}};return c?(0,x.jsxs)(w.Button,{variant:"outline",size:"sm",disabled:!0,className:`gap-2 border-dashed border-zinc-700 bg-zinc-900/50 text-zinc-600 ${r}`,children:[(0,x.jsx)(V.Loader2,{className:"h-4 w-4 animate-spin"}),(0,x.jsx)("span",{className:"hidden sm:inline",children:"載入中..."})]}):s?(0,x.jsx)(Q.TooltipProvider,{children:(0,x.jsxs)(Q.Tooltip,{delayDuration:0,children:[(0,x.jsx)(Q.TooltipTrigger,{asChild:!0,children:(0,x.jsx)("span",{className:"inline-flex",tabIndex:h?-1:0,children:h?(0,x.jsxs)(nL,{children:[(0,x.jsx)(n$,{asChild:!0,children:(0,x.jsxs)(w.Button,{variant:"outline",size:"sm",disabled:a||!e||0===e.length,className:(0,g.cn)("gap-1.5 border-dashed transition-all border-zinc-700 bg-zinc-900/50 hover:bg-zinc-800 text-zinc-400 hover:text-white",r),children:[(0,x.jsx)(U,{className:"h-4 w-4"}),(0,x.jsx)("span",{className:"hidden sm:inline",children:n}),(0,x.jsx)(j.ChevronDown,{className:"h-3 w-3"})]})}),(0,x.jsxs)(nO,{align:"start",className:"min-w-[180px] bg-zinc-900 border-zinc-700",children:[(0,x.jsxs)(nB,{onClick:f,className:"flex items-center gap-2 text-zinc-300 hover:text-white focus:text-white cursor-pointer",children:[(0,x.jsx)(U,{className:"h-4 w-4 text-zinc-500"}),"匯出 CSV"]}),(0,x.jsxs)(nB,{onClick:()=>{h&&s&&(u(s,void 0!==l?l:e),nH.toast.success("已新增至報表編輯器",{description:"請點選左側「生成報告」繼續編輯",action:{label:"前往編輯",onClick:()=>d.push("/reports/builder")}}))},className:"flex items-center gap-2 text-zinc-300 hover:text-violet-300 focus:text-violet-300 hover:bg-violet-600/20 focus:bg-violet-600/20 cursor-pointer",children:[(0,x.jsx)(G,{className:"h-4 w-4 text-violet-500"}),"新增到報表編輯器"]})]})]}):(0,x.jsxs)(w.Button,{variant:"outline",size:"sm",disabled:!0,className:(0,g.cn)("gap-1.5 border-dashed transition-all border-zinc-800 bg-zinc-900/30 text-zinc-600 cursor-not-allowed hover:bg-zinc-900/30",r),children:[(0,x.jsx)(W.Lock,{className:"h-3 w-3"}),(0,x.jsx)("span",{className:"hidden sm:inline",children:n})]})})}),!h&&(0,x.jsx)(Q.TooltipContent,{className:"bg-zinc-950 border border-zinc-800 p-0 overflow-hidden",children:(0,x.jsxs)("div",{className:"flex flex-col gap-1 items-center p-3",children:[(0,x.jsx)("p",{className:"font-medium text-zinc-200",children:"Pro 會員限定功能"}),(0,x.jsx)(Z.default,{href:"/pricing",className:"text-xs text-violet-400 hover:text-violet-300 underline underline-offset-2 transition-colors flex items-center gap-1",children:"查看升級方案 →"})]})})]})}):(0,x.jsx)(Q.TooltipProvider,{children:(0,x.jsxs)(Q.Tooltip,{delayDuration:0,children:[(0,x.jsx)(Q.TooltipTrigger,{asChild:!0,children:(0,x.jsx)("span",{className:"inline-flex",tabIndex:h?-1:0,children:(0,x.jsxs)(w.Button,{variant:"outline",size:"sm",onClick:f,disabled:a||h&&(!e||0===e.length),className:(0,g.cn)("gap-1.5 border-dashed transition-all",h?"border-zinc-700 bg-zinc-900/50 hover:bg-zinc-800 text-zinc-400 hover:text-white":"border-zinc-800 bg-zinc-900/30 text-zinc-600 cursor-not-allowed hover:bg-zinc-900/30",r),children:[h?(0,x.jsx)(U,{className:"h-4 w-4"}):(0,x.jsx)(W.Lock,{className:"h-3 w-3"}),(0,x.jsx)("span",{className:"hidden sm:inline",children:n})]})})}),!h&&(0,x.jsx)(Q.TooltipContent,{className:"bg-zinc-950 border border-zinc-800 p-0 overflow-hidden",children:(0,x.jsxs)("div",{className:"flex flex-col gap-1 items-center p-3",children:[(0,x.jsx)("p",{className:"font-medium text-zinc-200",children:"Pro 會員限定功能"}),(0,x.jsx)(Z.default,{href:"/pricing",className:"text-xs text-violet-400 hover:text-violet-300 underline underline-offset-2 transition-colors flex items-center gap-1",children:"查看升級方案 →"})]})})]})})}function nZ({data:e,visibleSections:t=["metrics","chart","table"]}){let{rankingCurrentPage:n,rankingPageSize:r,setRankingCurrentPage:a,setRankingPageSize:i}=(0,f.useFilterStore)(),[s,l]=(0,m.useState)(1),[o,c]=(0,m.useState)(10),[d,u]=(0,m.useState)({key:"saleAmountSum",order:"desc"}),[h,p]=(0,m.useState)(30),[g,b]=(0,m.useState)("auto");if(!e)return null;let{coreMetrics:v,projectRanking:y}=e,j=(0,m.useMemo)(()=>{if(!y||0===y.length)return{min:0,max:0,median:0,parking:0};let e=Math.min(...y.map(e=>e.minPrice).filter(e=>e>0)),t=Math.max(...y.map(e=>e.maxPrice)),n=y.map(e=>e.medianPrice).filter(e=>e>0),r=n.length>0?n.reduce((e,t)=>e+t,0)/n.length:0,a=y.map(e=>e.avgParkingPrice).filter(e=>e>0);return{min:e,max:t,median:r,parking:a.length>0?a.reduce((e,t)=>e+t,0)/a.length:0}},[y]),N=(0,m.useMemo)(()=>y?[...y].sort((e,t)=>{let n=e[d.key]||0,r=t[d.key]||0;return"desc"===d.order?r-n:n-r}):[],[y,d]),z=Math.ceil(N.length/o),k=N.slice((s-1)*o,s*o),_=e=>{u({key:e,order:"desc"})},S=({title:e,value:t,unit:n,sortKey:r})=>(0,x.jsxs)("div",{onClick:()=>r&&_(r),className:`bg-zinc-800/50 rounded-lg p-4 border border-white/5 flex flex-col items-center justify-center text-center transition-all duration-300 ${r?"cursor-pointer hover:bg-zinc-800 hover:border-violet-500/30 hover:shadow-[0_0_20px_rgba(139,92,246,0.1)] group":""}`,children:[(0,x.jsx)("div",{className:`text-zinc-400 text-sm mb-1 ${r?"group-hover:text-violet-300":""}`,children:e}),(0,x.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,x.jsx)("span",{className:`text-2xl font-bold text-white ${r?"group-hover:text-white":""}`,children:t}),(0,x.jsx)("span",{className:"text-xs text-zinc-500",children:n})]})]});return(0,x.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[t.includes("metrics")&&(0,x.jsx)(D,{title:"核心數據指標",headerAction:(0,x.jsx)(nK,{data:[v,j],filename:"core_metrics",label:"匯出",chartType:"ranking-metrics",snapshotData:{coreMetrics:v,derivedMetrics:j}}),children:(0,x.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:[(0,x.jsx)(S,{title:"市場去化總銷售金額",value:v.totalSaleAmount.toLocaleString(),unit:"萬",sortKey:"saleAmountSum"}),(0,x.jsx)(S,{title:"總銷去化房屋坪數",value:v.totalHouseArea.toLocaleString(void 0,{maximumFractionDigits:2}),unit:"坪",sortKey:"houseAreaSum"}),(0,x.jsx)(S,{title:"總平均單價",value:v.overallAveragePrice.toLocaleString(void 0,{maximumFractionDigits:2}),unit:"萬/坪",sortKey:"averagePrice"}),(0,x.jsx)(S,{title:"總交易筆數",value:v.transactionCount.toLocaleString(),unit:"筆",sortKey:"transactionCount"}),(0,x.jsx)(S,{title:"最低成交單價 (Min)",value:j.min.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"萬/坪",sortKey:"minPrice"}),(0,x.jsx)(S,{title:"最高成交單價 (Max)",value:j.max.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"萬/坪",sortKey:"maxPrice"}),(0,x.jsx)(S,{title:"平均中位數單價",value:j.median.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"萬/坪",sortKey:"medianPrice"}),(0,x.jsx)(S,{title:"平均車位價格",value:j.parking.toLocaleString(void 0,{maximumFractionDigits:0}),unit:"萬",sortKey:"avgParkingPrice"})]})}),t.includes("chart")&&(0,x.jsxs)("div",{className:"space-y-4",children:[(0,x.jsx)("div",{className:"flex flex-wrap gap-2 justify-center",children:[{key:"saleAmountSum",label:"交易總價(萬)"},{key:"houseAreaSum",label:"房屋面積(坪)"},{key:"transactionCount",label:"資料筆數"},{key:"marketShare",label:"市場佔比(%)"},{key:"averagePrice",label:"平均單價"},{key:"minPrice",label:"最低單價"},{key:"maxPrice",label:"最高單價"},{key:"medianPrice",label:"中位數單價"},{key:"avgParkingPrice",label:"車位均價"}].map(e=>(0,x.jsx)("button",{onClick:()=>_(e.key),className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-all duration-300 ${d.key===e.key?"bg-violet-600/20 border-violet-500/50 text-violet-300 shadow-[0_0_15px_rgba(139,92,246,0.2)]":"bg-zinc-800/50 border-white/5 text-zinc-400 hover:text-white hover:bg-zinc-800 hover:border-white/10"}`,children:e.label},e.key))}),(0,x.jsx)(D,{title:"建案分析圖表",description:"根據排序指標顯示建案排名",headerAction:(0,x.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 w-full sm:w-auto",children:[(0,x.jsxs)("div",{className:"flex bg-zinc-800 p-0.5 rounded-lg border border-white/5",children:[(0,x.jsx)("button",{onClick:()=>b("auto"),className:`p-1.5 rounded-md transition-all ${"auto"===g?"bg-violet-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-400 hover:text-white hover:bg-white/5"}`,title:"自動選擇 (Auto)",children:(0,x.jsx)(K,{size:14})}),(0,x.jsx)("button",{onClick:()=>b("bar"),className:`p-1.5 rounded-md transition-all ${"bar"===g?"bg-violet-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-400 hover:text-white hover:bg-white/5"}`,title:"長條圖 (Bar)",children:(0,x.jsx)(B.BarChart3,{size:14})}),(0,x.jsx)("button",{onClick:()=>b("treemap"),className:`p-1.5 rounded-md transition-all ${"treemap"===g?"bg-violet-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-400 hover:text-white hover:bg-white/5"}`,title:"矩形樹圖 (Treemap)",children:(0,x.jsx)(H,{size:14})})]}),(0,x.jsx)("div",{className:"hidden sm:block w-px h-6 bg-white/10"}),(0,x.jsxs)("div",{className:"flex items-center gap-3 w-full sm:w-auto justify-between sm:justify-start",children:[(0,x.jsx)("div",{className:"flex bg-zinc-800 p-0.5 rounded-lg border border-white/5 overflow-x-auto max-w-[200px] sm:max-w-none scrollbar-hide",children:[10,30,50,100].map(e=>(0,x.jsxs)("button",{onClick:()=>p(e),className:`px-3 py-1 text-xs rounded-md transition-all whitespace-nowrap ${h===e?"bg-violet-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-400 hover:text-white hover:bg-white/5"}`,children:["Top ",e]},e))}),(0,x.jsx)("div",{className:"hidden sm:block w-px h-6 bg-white/10"}),(0,x.jsx)(nK,{data:N.slice(0,h),filename:"ranking_chart_data",label:"匯出",chartType:"ranking-chart",snapshotData:N.slice(0,h),columns:{projectName:"建案名稱",county:"縣市",district:"行政區",saleAmountSum:"交易總價",houseAreaSum:"房屋面積",transactionCount:"資料筆數",marketShare:"市場佔比",averagePrice:"平均單價",minPrice:"最低單價",maxPrice:"最高單價",medianPrice:"中位數單價",avgParkingPrice:"車位均價"}})]})]}),children:(0,x.jsx)(F.RankingChart,{data:N,sortKey:d.key,limit:h,chartType:g})})]}),t.includes("table")&&(0,x.jsxs)(D,{title:"區域建案排行列表",description:"點擊表頭可進行排序",headerAction:(0,x.jsx)(nK,{data:N,filename:"ranking_table_data",label:"匯出",chartType:"ranking-table",snapshotData:N,columns:{projectName:"建案名稱",county:"縣市",district:"行政區",saleAmountSum:"交易總價",houseAreaSum:"房屋面積",transactionCount:"資料筆數",marketShare:"市場佔比",averagePrice:"平均單價",minPrice:"最低單價",maxPrice:"最高單價",medianPrice:"中位數單價",avgParkingPrice:"車位均價"}}),children:[(0,x.jsx)("div",{className:"overflow-x-auto",children:(0,x.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,x.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"px-4 py-3 cursor-default",children:"排名"}),(0,x.jsx)("th",{className:"px-4 py-3 cursor-default",children:"建案名稱"}),[{key:"saleAmountSum",label:(0,x.jsxs)(x.Fragment,{children:["交易",(0,x.jsx)("br",{}),"總價(萬)"]})},{key:"houseAreaSum",label:(0,x.jsxs)(x.Fragment,{children:["房屋",(0,x.jsx)("br",{}),"面積(坪)"]})},{key:"transactionCount",label:(0,x.jsxs)(x.Fragment,{children:["資料",(0,x.jsx)("br",{}),"筆數"]})},{key:"marketShare",label:(0,x.jsxs)(x.Fragment,{children:["市場",(0,x.jsx)("br",{}),"佔比(%)"]})},{key:"averagePrice",label:(0,x.jsxs)(x.Fragment,{children:["平均",(0,x.jsx)("br",{}),"單價"]})},{key:"minPrice",label:(0,x.jsxs)(x.Fragment,{children:["最低",(0,x.jsx)("br",{}),"單價"]})},{key:"maxPrice",label:(0,x.jsxs)(x.Fragment,{children:["最高",(0,x.jsx)("br",{}),"單價"]})},{key:"medianPrice",label:(0,x.jsxs)(x.Fragment,{children:["中位數",(0,x.jsx)("br",{}),"單價"]})},{key:"avgParkingPrice",label:(0,x.jsxs)(x.Fragment,{children:["車位",(0,x.jsx)("br",{}),"均價"]})}].map(e=>(0,x.jsx)("th",{className:"px-3 py-3 cursor-pointer hover:text-white transition-colors text-center whitespace-nowrap",onClick:()=>_(e.key),children:(0,x.jsxs)("div",{className:"flex items-center justify-center gap-1.5 group/header",children:[(0,x.jsx)("span",{className:"leading-tight",children:e.label}),(0,x.jsx)("div",{className:"flex flex-col opacity-50 group-hover/header:opacity-100 transition-opacity",children:d.key===e.key?"desc"===d.order?(0,x.jsx)(O,{size:14,className:"text-violet-500"}):(0,x.jsx)($,{size:14,className:"text-violet-500"}):(0,x.jsx)(L,{size:14,className:"text-zinc-600 group-hover/header:text-zinc-400"})})]})},e.key))]})}),(0,x.jsx)("tbody",{className:"divide-y divide-white/5",children:k.map((e,t)=>(0,x.jsxs)("tr",{className:"hover:bg-zinc-800/50 transition-colors",children:[(0,x.jsx)("td",{className:"px-4 py-3 text-zinc-500 font-mono",children:(s-1)*o+t+1}),(0,x.jsx)("td",{className:"px-4 py-3",children:(0,x.jsxs)("div",{className:"flex flex-col",children:[(0,x.jsx)("span",{className:"font-medium text-white",children:e.projectName}),(0,x.jsxs)("div",{className:"flex gap-1 mt-1",children:[e.county&&(0,x.jsx)("span",{className:"text-[10px] bg-zinc-800 text-zinc-400 px-1 py-0.5 rounded",children:e.county}),e.district&&(0,x.jsx)("span",{className:"text-[10px] bg-zinc-800 text-zinc-400 px-1 py-0.5 rounded",children:e.district})]})]})}),(0,x.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.saleAmountSum.toLocaleString()}),(0,x.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.houseAreaSum.toLocaleString()}),(0,x.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.transactionCount.toLocaleString()}),(0,x.jsxs)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:[e.marketShare.toFixed(2),"%"]}),(0,x.jsx)("td",{className:"px-4 py-3 font-mono text-cyan-400",children:e.averagePrice.toFixed(1)}),(0,x.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.minPrice.toFixed(1)}),(0,x.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.maxPrice.toFixed(1)}),(0,x.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-400",children:e.medianPrice.toFixed(1)}),(0,x.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-400",children:e.avgParkingPrice>0?e.avgParkingPrice.toLocaleString():"-"})]},t))}),(0,x.jsx)("tfoot",{className:"bg-zinc-900/80 font-bold border-t-2 border-zinc-700",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{colSpan:2,className:"px-4 py-3 text-center text-zinc-300",children:"總計"}),(0,x.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:v.totalSaleAmount.toLocaleString()}),(0,x.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:v.totalHouseArea.toLocaleString()}),(0,x.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:v.transactionCount.toLocaleString()}),(0,x.jsx)("td",{colSpan:6})]})})]})}),(0,x.jsxs)("div",{className:"flex items-center justify-between mt-4 border-t border-white/5 pt-4",children:[(0,x.jsxs)("div",{className:"text-sm text-zinc-500",children:["顯示 ",(s-1)*o+1," 到 ",Math.min(s*o,N.length)," 筆，共 ",N.length," 筆"]}),(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)(w.Button,{variant:"outline",size:"sm",onClick:()=>l(e=>Math.max(1,e-1)),disabled:1===s,children:(0,x.jsx)(T.ChevronLeft,{size:16})}),(0,x.jsxs)("span",{className:"text-sm text-zinc-300",children:["Page ",s," of ",z]}),(0,x.jsx)(w.Button,{variant:"outline",size:"sm",onClick:()=>l(e=>Math.min(z,e+1)),disabled:s===z,children:(0,x.jsx)(I.ChevronRight,{size:16})})]})]})]})]})}var nq=e.i(843),nU=e.i(34029);function nW({roomTypes:e,locations:t,crossTable:n,dimension:r}){let a=(0,m.useMemo)(()=>e&&t&&n?e.map(e=>{let r=t.map(t=>n[e]&&n[e][t]||0);return{name:e,data:r}}):[],[e,t,n]),i=(0,m.useMemo)(()=>{let e="county"===r?"縣市":"行政區";return{chart:{type:"bar",height:Math.max(350,35*t.length),stacked:!0,background:"transparent",toolbar:{show:!0},foreColor:"#e5e7eb"},plotOptions:{bar:{horizontal:!0,barHeight:"70%",borderRadius:4,dataLabels:{total:{enabled:!0,offsetX:5,style:{fontSize:"11px",fontWeight:600,color:"#e5e7eb"},formatter:function(e,t){let n=t.w.config.series,r=t.dataPointIndex,a=0;return n.forEach(e=>{a+=e.data[r]||0}),a>0?a.toString():""}}}}},colors:["#06b6d4","#8b5cf6","#10b981","#f59e0b","#ef4444","#3b82f6","#ec4899","#84cc16","#6366f1","#14b8a6"],dataLabels:{enabled:!1},xaxis:{categories:t,title:{text:"成交筆數",style:{color:"#9ca3af"}},labels:{style:{colors:"#9ca3af"}}},yaxis:{title:{text:e,style:{color:"#9ca3af"}},labels:{style:{colors:"#e5e7eb"},maxWidth:150}},legend:{position:"top",horizontalAlign:"center",labels:{colors:"#e5e7eb"}},tooltip:{theme:"dark",y:{formatter:function(e){return e+" 筆"}}},grid:{borderColor:"#374151"},title:{text:`各${e}房型成交筆數分佈`,align:"center",style:{fontSize:"16px",color:"#e5e7eb"}}}},[t,r]);return a&&0!==a.length?(0,x.jsx)(nU.default,{type:"bar",series:a,options:i,height:i.chart?.height||350,className:"w-full"}):(0,x.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無區域分佈資料"})}function nV({isOpen:e,onClose:t,title:n,projects:r}){let a=(0,m.useRef)(null);return((0,m.useEffect)(()=>{let n=e=>{"Escape"===e.key&&t()};return e&&(document.addEventListener("keydown",n),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",n),document.body.style.overflow=""}},[e,t]),e)?(0,x.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",onClick:e=>{a.current&&!a.current.contains(e.target)&&t()},children:(0,x.jsxs)("div",{ref:a,className:"bg-zinc-900 border border-white/10 rounded-xl shadow-2xl max-w-md w-full mx-4 animate-in zoom-in-95 duration-200",children:[(0,x.jsxs)("div",{className:"flex items-center justify-between px-5 py-4 border-b border-white/5",children:[(0,x.jsx)("h3",{className:"text-lg font-semibold text-white",children:n}),(0,x.jsx)("button",{onClick:t,className:"p-1 rounded hover:bg-white/10 text-zinc-400 hover:text-white transition-colors",children:(0,x.jsx)(b.X,{size:20})})]}),(0,x.jsx)("div",{className:"px-5 py-4 max-h-[50vh] overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-700",children:0===r.length?(0,x.jsx)("p",{className:"text-zinc-500 text-center py-4",children:"無建案資料"}):(0,x.jsx)("ul",{className:"space-y-2",children:r.map((e,t)=>(0,x.jsx)("li",{className:(0,g.cn)("px-3 py-2 rounded-lg text-zinc-200 text-sm","bg-zinc-800/50 hover:bg-zinc-800 transition-colors","border border-white/5"),children:e},t))})}),(0,x.jsxs)("div",{className:"px-5 py-3 border-t border-white/5 flex justify-between items-center",children:[(0,x.jsxs)("span",{className:"text-xs text-zinc-500",children:["共 ",r.length," 個建案"]}),(0,x.jsx)("button",{onClick:t,className:"px-4 py-1.5 text-sm rounded-lg bg-zinc-800 text-zinc-300 hover:bg-zinc-700 transition-colors",children:"關閉"})]})]})}):null}function nG({data:e,visibleSections:t=["chart","table","location-table","location-chart"]}){let n=["套房","1房","2房","3房","4房","毛胚"],[r,a]=(0,m.useState)(n),[i,s]=(0,m.useState)("district"),[l,o]=(0,m.useState)(!1),[c,d]=(0,m.useState)(""),[u,h]=(0,m.useState)([]),[p,f]=(0,m.useState)(null),b=(0,m.useMemo)(()=>{if(!e?.transactionDetails)return[];let t=new Set;return e.transactionDetails.forEach(e=>{e["縣市"]&&t.add(e["縣市"])}),Array.from(t).sort()},[e?.transactionDetails]);m.default.useEffect(()=>{!p&&b.length>0&&f(b[0])},[b,p]);let v=(e,t,n)=>{d(`${e}${null!==t?` / ${t}衛`:""} 建案組成`),h(n),o(!0)};if(!e||!e.details||0===e.details.length)return null;let{details:y,locationCrossTable:j,allDistricts:N,transactionDetails:w}=e,z=(0,m.useMemo)(()=>Array.from(new Set(y.map(e=>e.roomType))),[y]),k=(0,m.useMemo)(()=>y.filter(e=>r.includes(e.roomType)),[y,r]),[_,S]=(0,m.useState)(!0),C=(0,m.useMemo)(()=>{let e=y.filter(e=>r.includes(e.roomType));if(!_)return e;let t=new Map;return e.forEach(e=>{let n=e.roomType;t.has(n)||t.set(n,{...e,bathrooms:null,projectNames:e.projectNames?[...e.projectNames]:[],count:0,avgPrice:0});let r=t.get(n),a=r.avgPrice*r.count,i=e.avgPrice*e.count,s=r.count+e.count;r.count=s,r.avgPrice=s>0?(a+i)/s:0,r.minPrice=Math.min(r.minPrice,e.minPrice),r.maxPrice=Math.max(r.maxPrice,e.maxPrice);let l=r.count-e.count,o=e.count;if(r.medianPrice=(r.medianPrice*l+e.medianPrice*o)/s,r.q1Price=(r.q1Price*l+e.q1Price*o)/s,r.q3Price=(r.q3Price*l+e.q3Price*o)/s,e.projectNames){let t=new Set([...r.projectNames||[],...e.projectNames]);r.projectNames=Array.from(t)}}),Array.from(t.values()).sort((e,t)=>n.indexOf(e.roomType)-n.indexOf(t.roomType))},[y,r,_,n]),P=(0,m.useMemo)(()=>{if("county"===i&&w){let e={},t=new Set;w.forEach(n=>{let r=n["房型"]||n.roomType||n["戶型"];if(!r||"其他"===r){let e=Number(n["房數"]);r=!isNaN(e)&&e>0?`${e}房`:"其他"}let a="string"==typeof r?r.replace(/\s+/g,""):r;("number"==typeof a||"string"==typeof a&&/^\d+$/.test(a))&&(a=`${a}房`);let i=n["縣市"]||"未知";e[a]||(e[a]={}),e[a][i]=(e[a][i]||0)+1,t.add(i)});let n=Array.from(t).sort(),a={},i=0;n.forEach(e=>a[e]=0);let s=r.map(t=>{let r=e[t]||{},s=0,l=n.map(e=>{let t=r[e]||0;return s+=t,a[e]+=t,t});return i+=s,{roomType:t,cells:l,rowTotal:s}});return{locations:n,rows:s,locationTotals:a,grandTotal:i}}if("district"===i){let e={},t=new Set;if(w)w.forEach(n=>{let r=n["房型"]||n.roomType||n["戶型"];if(!r||"其他"===r){let e=Number(n["房數"]);r=!isNaN(e)&&e>0?`${e}房`:"其他"}let a="string"==typeof r?r.replace(/\s+/g,""):r;("number"==typeof a||"string"==typeof a&&/^\d+$/.test(a))&&(a=`${a}房`);let i=n["行政區"]||"未知",s=n["縣市"]||"未知";p&&s!==p||(e[a]||(e[a]={}),e[a][i]=(e[a][i]||0)+1,t.add(i))});else if(j){let n=new Set;r.forEach(e=>{let t=j[e];t&&Object.keys(t).forEach(e=>n.add(e))}),n.forEach(e=>t.add(e)),r.forEach(t=>{let n=j[t];n&&(e[t]=n)})}let n=Array.from(t).sort(),a={},i=0;n.forEach(e=>a[e]=0);let s=r.map(t=>{let r=e[t]||{},s=0,l=n.map(e=>{let t=r[e]||0;return s+=t,a[e]+=t,t});return i+=s,{roomType:t,cells:l,rowTotal:s}});return{locations:n,rows:s,locationTotals:a,grandTotal:i}}return null},[j,w,r,i,p]),[M,A]=(0,m.useState)(new Set),E=(0,m.useMemo)(()=>P?P.rows.map(e=>{let t={房型:e.roomType};return P.locations.forEach((n,r)=>{t[n]=e.cells[r]}),t["總計"]=e.rowTotal,t}):[],[P]),R=e=>y.filter(t=>t.roomType===e).sort((e,t)=>(Number(e.bathrooms)||0)-(Number(t.bathrooms)||0)),F=(0,m.useMemo)(()=>{if(!_)return C;let e=[];return C.forEach(t=>{if(e.push(t),M.has(t.roomType)){let n=R(t.roomType);e.push(...n)}}),e},[C,_,M,y]);return(0,x.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,x.jsxs)("div",{className:"flex flex-col sm:flex-row sm:flex-wrap items-start sm:items-center justify-between gap-3 sm:gap-4",children:[(0,x.jsx)("div",{className:"flex flex-wrap gap-1.5 sm:gap-2",children:z.map(e=>(0,x.jsx)("button",{onClick:()=>{a(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},className:(0,g.cn)("px-3 py-1 rounded-full text-xs font-medium transition-colors border",r.includes(e)?"bg-violet-500/20 border-violet-500 text-violet-200":"bg-zinc-800/50 border-zinc-700 text-zinc-500 hover:bg-zinc-800"),children:e},e))}),(0,x.jsxs)("div",{className:"flex items-center gap-2 bg-zinc-800/50 p-1 rounded-lg border border-white/5",children:[(0,x.jsx)("span",{className:"text-xs text-zinc-400 pl-2",children:"表格顯示:"}),(0,x.jsx)("button",{onClick:()=>S(!_),className:(0,g.cn)("px-3 py-1 text-xs font-medium rounded-md transition-all",_?"bg-violet-500 text-white shadow-sm":"text-zinc-400 hover:text-white hover:bg-zinc-700"),children:_?"依房型合併":"顯示衛浴細節"})]})]}),t.includes("chart")&&(0,x.jsx)(D,{title:"各房型總價帶分佈箱型圖",description:"顯示各房型總價的中位數與四分位距",headerAction:(0,x.jsx)(nK,{data:C,filename:"price_band_chart_data",label:"匯出",chartType:"price-band-chart",snapshotData:C,columns:{roomType:"房型",bathrooms:"衛浴",minPrice:"最低價",q1Price:"Q1",medianPrice:"中位數",q3Price:"Q3",maxPrice:"最高價",avgPrice:"平均價",count:"筆數"}}),children:(0,x.jsx)(nq.PriceBandChart,{data:C})}),t.includes("table")&&(0,x.jsx)(D,{title:"總價帶詳細數據",description:_?"各房型合併統計 (點擊「全部」可展開細節)":"各房型詳細價格統計",headerAction:(0,x.jsx)(nK,{data:F,filename:"price_band_detail_data",label:"匯出",chartType:"price-band-table",snapshotData:F,columns:{roomType:"房型",bathrooms:"衛浴",minPrice:"最低價",q1Price:"Q1",medianPrice:"中位數",q3Price:"Q3",maxPrice:"最高價",avgPrice:"平均價",count:"筆數"}}),children:(0,x.jsx)("div",{className:"overflow-x-auto",children:(0,x.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,x.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"px-4 py-3",children:"房型"}),(0,x.jsx)("th",{className:"px-4 py-3",children:"衛浴"}),(0,x.jsx)("th",{className:"px-4 py-3",children:"建案數"}),(0,x.jsx)("th",{className:"px-4 py-3",children:"筆數"}),(0,x.jsx)("th",{className:"px-4 py-3",children:"平均總價"}),(0,x.jsx)("th",{className:"px-4 py-3",children:"最低總價"}),(0,x.jsx)("th",{className:"px-4 py-3",children:"1/4位總價"}),(0,x.jsx)("th",{className:"px-4 py-3 text-violet-400",children:"中位數總價"}),(0,x.jsx)("th",{className:"px-4 py-3",children:"3/4位總價"}),(0,x.jsx)("th",{className:"px-4 py-3",children:"最高總價"})]})}),(0,x.jsxs)("tbody",{className:"divide-y divide-white/5",children:[C.map((e,t)=>{let n=_&&null===e.bathrooms,r=M.has(e.roomType),a=n&&r?R(e.roomType):[];return(0,x.jsxs)(m.default.Fragment,{children:[(0,x.jsxs)("tr",{className:(0,g.cn)("hover:bg-zinc-800/50 transition-colors",r&&"bg-zinc-800/30"),children:[(0,x.jsx)("td",{className:"px-4 py-3 font-medium text-white",children:e.roomType}),(0,x.jsx)("td",{className:"px-4 py-3 text-zinc-400",children:n?(0,x.jsxs)("button",{onClick:()=>{var t;return t=e.roomType,void A(e=>{let n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n})},className:"flex items-center gap-1 text-xs px-2 py-0.5 rounded bg-zinc-700/50 hover:bg-zinc-600 hover:text-white transition-colors cursor-pointer",children:[(0,x.jsx)("span",{children:"全部"}),(0,x.jsx)("span",{className:(0,g.cn)("transform transition-transform text-[10px]",r?"rotate-180":""),children:"▼"})]}):e.bathrooms??"-"}),(0,x.jsx)("td",{className:"px-4 py-3",children:e.projectNames&&e.projectNames.length>0?(0,x.jsxs)("button",{onClick:()=>v(e.roomType,e.bathrooms,e.projectNames||[]),className:"px-2 py-1 text-xs font-medium rounded-full bg-violet-500/20 border border-violet-500/50 text-violet-300 hover:bg-violet-500/30 transition-colors cursor-pointer",children:[e.projectNames.length," 個建案"]}):(0,x.jsx)("span",{className:"text-zinc-500",children:"-"})}),(0,x.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:e.count.toLocaleString()}),(0,x.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.avgPrice.toLocaleString(void 0,{maximumFractionDigits:0})}),(0,x.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.minPrice.toLocaleString()}),(0,x.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.q1Price.toLocaleString()}),(0,x.jsx)("td",{className:"px-4 py-3 font-mono text-violet-400 font-bold",children:e.medianPrice.toLocaleString()}),(0,x.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.q3Price.toLocaleString()}),(0,x.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.maxPrice.toLocaleString()})]}),a.map((e,n)=>(0,x.jsxs)("tr",{className:"bg-zinc-900/50 hover:bg-zinc-900 border-l-2 border-l-violet-500/30",children:[(0,x.jsxs)("td",{className:"px-4 py-2 font-medium text-zinc-500 text-xs pl-8",children:["↳ ",e.roomType]}),(0,x.jsxs)("td",{className:"px-4 py-2 text-zinc-400 text-xs",children:[e.bathrooms," 衛"]}),(0,x.jsx)("td",{className:"px-4 py-2",children:e.projectNames&&e.projectNames.length>0?(0,x.jsxs)("button",{onClick:()=>v(e.roomType,e.bathrooms,e.projectNames||[]),className:"text-xs text-zinc-500 hover:text-zinc-300 underline decoration-zinc-700",children:[e.projectNames.length," 建案"]}):"-"}),(0,x.jsx)("td",{className:"px-4 py-2 text-zinc-500 text-xs",children:e.count.toLocaleString()}),(0,x.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-500 text-xs",children:e.avgPrice.toLocaleString(void 0,{maximumFractionDigits:0})}),(0,x.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.minPrice.toLocaleString()}),(0,x.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.q1Price.toLocaleString()}),(0,x.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-500 text-xs font-medium",children:e.medianPrice.toLocaleString()}),(0,x.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.q3Price.toLocaleString()}),(0,x.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.maxPrice.toLocaleString()})]},`${t}-sub-${n}`))]},t)}),0===k.length&&(0,x.jsx)("tr",{children:(0,x.jsx)("td",{colSpan:10,className:"p-8 text-center text-zinc-500",children:"請選擇房型顯示數據"})})]})]})})}),(P||w)&&(0,x.jsxs)("div",{className:"space-y-6 pt-4 border-t border-white/5",children:[(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsx)("h3",{className:"text-lg font-semibold text-white",children:"區域分組交叉分析"}),(0,x.jsxs)("div",{className:"flex bg-zinc-800 rounded-md p-0.5",children:[(0,x.jsx)("button",{onClick:()=>s("district"),className:(0,g.cn)("px-2 py-1 text-xs rounded transition-colors","district"===i?"bg-zinc-700 text-white":"text-zinc-400 hover:text-white"),children:"行政區"}),(0,x.jsx)("button",{onClick:()=>s("county"),className:(0,g.cn)("px-2 py-1 text-xs rounded transition-colors","county"===i?"bg-zinc-700 text-white":"text-zinc-400 hover:text-white"),children:"縣市"})]})]}),"district"===i&&b.length>1&&(0,x.jsxs)("div",{className:"flex items-center gap-2 pb-2",children:[(0,x.jsx)("span",{className:"text-sm text-zinc-500",children:"顯示縣市:"}),(0,x.jsx)("div",{className:"flex gap-1 bg-zinc-900 p-1 rounded-lg",children:b.map(e=>(0,x.jsx)("button",{onClick:()=>f(e),className:(0,g.cn)("px-3 py-1 text-xs font-medium rounded-md transition-all",p===e?"bg-violet-500/20 text-violet-300 shadow-sm border border-violet-500/50":"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800"),children:e},e))})]}),t.includes("location-table")&&(0,x.jsx)(D,{title:"區域房型成交分佈",description:"各區域不同房型的成交數量熱力分佈",headerAction:(0,x.jsx)(nK,{data:E,filename:"price_band_location_cross_table",label:"匯出",chartType:"price-band-location-table",snapshotData:P}),children:(0,x.jsx)("div",{className:"overflow-x-auto",children:P?(0,x.jsxs)("table",{className:"w-full text-sm text-left border-collapse",children:[(0,x.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 font-semibold",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"px-3 py-2 sticky left-0 bg-zinc-900 z-10 border-r border-white/5",children:"房型"}),P.locations.map(e=>(0,x.jsx)("th",{className:"px-3 py-2 text-center min-w-[80px]",children:e},e)),(0,x.jsx)("th",{className:"px-3 py-2 text-center border-l border-white/5 bg-zinc-900 font-bold text-white",children:"總計"})]})}),(0,x.jsx)("tbody",{className:"divide-y divide-white/5",children:P.rows.map((e,t)=>(0,x.jsxs)("tr",{className:"hover:bg-zinc-800/30",children:[(0,x.jsx)("td",{className:"px-3 py-2 font-medium text-zinc-300 sticky left-0 bg-zinc-950/90 border-r border-white/5",children:e.roomType}),e.cells.map((e,t)=>{let n=e>0?Math.min(e/20,1):0,r=e>0?{backgroundColor:`rgba(6, 182, 212, ${.3*n})`}:{};return(0,x.jsx)("td",{className:"px-3 py-2 text-center text-zinc-400",style:r,children:e>0?e:"-"},t)}),(0,x.jsx)("td",{className:"px-3 py-2 text-center font-bold text-white border-l border-white/5 bg-zinc-900/50",children:e.rowTotal})]},t))}),(0,x.jsx)("tfoot",{className:"bg-zinc-900 font-bold border-t-2 border-zinc-700",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{className:"px-3 py-2 sticky left-0 bg-zinc-900 border-r border-white/5 text-white",children:"總計"}),P.locations.map(e=>(0,x.jsx)("td",{className:"px-3 py-2 text-center text-white",children:P.locationTotals[e]},e)),(0,x.jsx)("td",{className:"px-3 py-2 text-center text-cyan-400 border-l border-white/5 bg-zinc-900",children:P.grandTotal})]})})]}):(0,x.jsx)("div",{className:"p-8 text-center text-zinc-500",children:"無區域分佈數據"})})}),t.includes("location-chart")&&(0,x.jsx)(D,{title:"區域成交佔比圖表",headerAction:(0,x.jsx)(nK,{data:E,filename:"price_band_location_chart_data",label:"匯出",chartType:"price-band-location-chart",snapshotData:P}),children:P&&(0,x.jsx)(nW,{roomTypes:r,locations:P.locations,crossTable:P.rows.reduce((e,t)=>{let n={};return P.locations.forEach((e,r)=>{n[e]=t.cells[r]}),e[t.roomType]=n,e},{}),dimension:i})})]}),(0,x.jsx)(nV,{isOpen:l,onClose:()=>o(!1),title:c,projects:u})]})}var nX=e.i(71925),nY=e.i(30286);function nQ({data:e,viewType:t,selectedRooms:n}){if(!e||0===Object.keys(e).length)return(0,x.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無銷售速度資料"});let r=Object.keys(e).sort().reverse();return(0,x.jsx)("div",{className:"overflow-x-auto max-h-[600px] border border-white/5 rounded-lg",children:(0,x.jsxs)("table",{className:"w-full text-sm text-left border-collapse",children:[(0,x.jsxs)("thead",{className:"bg-zinc-900 sticky top-0 z-20 shadow-md",children:[(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{rowSpan:2,className:"px-4 py-3 sticky left-0 z-30 bg-zinc-900 border-r border-white/10 font-medium text-white min-w-[120px]",children:"時間"}),n.map(e=>(0,x.jsx)("th",{colSpan:3,className:"px-2 py-2 text-center border-l border-white/5 text-zinc-300 font-medium bg-zinc-900/90",children:e},e)),(0,x.jsx)("th",{colSpan:3,className:"px-2 py-2 text-center border-l-2 border-white/10 text-cyan-400 font-bold bg-zinc-900/90",children:"總計"})]}),(0,x.jsxs)("tr",{children:[n.map((e,t)=>(0,x.jsxs)(m.default.Fragment,{children:[(0,x.jsx)("th",{className:(0,g.cn)("px-2 py-2 text-center text-xs text-zinc-500 font-normal bg-zinc-900/90 border-b border-white/10",0===t&&"border-l border-white/5"),children:"筆數"}),(0,x.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-500 font-normal bg-zinc-900/90 border-b border-white/10",children:"總價(萬)"}),(0,x.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-500 font-normal bg-zinc-900/90 border-b border-white/10",children:"坪數"})]},e)),(0,x.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-400 font-medium bg-zinc-900/90 border-b border-white/10 border-l-2 border-white/10",children:"筆數"}),(0,x.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-400 font-medium bg-zinc-900/90 border-b border-white/10",children:"總價(萬)"}),(0,x.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-400 font-medium bg-zinc-900/90 border-b border-white/10",children:"坪數"})]})]}),(0,x.jsx)("tbody",{className:"divide-y divide-white/5",children:r.map(r=>{let a=e[r]||{},i={count:0,priceSum:0,areaSum:0};return(0,x.jsxs)("tr",{className:"hover:bg-zinc-800/30 transition-colors",children:[(0,x.jsx)("td",{className:"px-4 py-2 sticky left-0 z-10 bg-zinc-950/90 border-r border-white/10 font-mono text-zinc-400",children:("weekly"===t&&r.includes("-W"),r)}),n.map((e,t)=>{let n=a[e];return n?(i.count+=n.count,i.priceSum+=n.priceSum,i.areaSum+=n.areaSum,(0,x.jsxs)(m.default.Fragment,{children:[(0,x.jsx)("td",{className:(0,g.cn)("px-2 py-2 text-center text-zinc-300",0===t&&"border-l border-white/5"),children:n.count>0?n.count.toLocaleString():"-"}),(0,x.jsx)("td",{className:"px-2 py-2 text-center text-zinc-500 font-mono text-xs",children:n.count>0?(0,g.formatNumber)(n.priceSum,0):"-"}),(0,x.jsx)("td",{className:"px-2 py-2 text-center text-zinc-500 font-mono text-xs",children:n.count>0?(0,g.formatNumber)(n.areaSum,1):"-"})]},e)):(0,x.jsxs)(m.default.Fragment,{children:[(0,x.jsx)("td",{className:(0,g.cn)("px-2 py-2 text-center text-zinc-700",0===t&&"border-l border-white/5"),children:"-"}),(0,x.jsx)("td",{className:"px-2 py-2 text-center text-zinc-700",children:"-"}),(0,x.jsx)("td",{className:"px-2 py-2 text-center text-zinc-700",children:"-"})]},e)}),(0,x.jsx)("td",{className:"px-2 py-2 text-center font-bold text-cyan-400 border-l-2 border-white/10",children:i.count.toLocaleString()}),(0,x.jsx)("td",{className:"px-2 py-2 text-center font-bold text-zinc-300 font-mono text-xs",children:(0,g.formatNumber)(i.priceSum,0)}),(0,x.jsx)("td",{className:"px-2 py-2 text-center font-bold text-zinc-300 font-mono text-xs",children:(0,g.formatNumber)(i.areaSum,1)})]},r)})})]})})}function nJ({data:e}){let[t,n]=(0,m.useState)("monthly"),[r,a]=(0,m.useState)("count"),[i,s]=(0,m.useState)(15),[l,o]=(0,m.useState)(65),[c,d]=(0,m.useState)(5),[u,h]=(0,m.useState)([]),[p,f]=(0,m.useState)(null),[b,v]=(0,m.useState)(["2房","3房"]);if(!e)return null;let{salesVelocityAnalysis:y,areaDistributionAnalysis:j}=e,w=e=>Math.round(e)+"萬";return(0,x.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,x.jsxs)("div",{className:"p-4 bg-zinc-900/30 border border-white/5 rounded-lg flex flex-wrap gap-2 items-center sticky top-0 z-40 backdrop-blur-md",children:[(0,x.jsx)("span",{className:"text-zinc-400 text-sm mr-2",children:"分析房型:"}),["套房","1房","2房","3房","4房","毛胚","店舖","辦公/事務所"].map(e=>(0,x.jsx)("button",{onClick:()=>{v(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},className:(0,g.cn)("px-3 py-1 text-xs rounded-full border transition-colors",b.includes(e)?"bg-violet-500/20 border-violet-500 text-violet-200":"bg-zinc-800 border-zinc-700 text-zinc-500 hover:bg-zinc-700"),children:e},e))]}),(0,x.jsx)(D,{title:"房型銷售速度與趨勢分析",headerAction:(0,x.jsxs)("div",{className:"flex gap-2",children:[(0,x.jsxs)(N,{value:t,onChange:e=>n(e.target.value),className:"w-[100px] h-8 text-xs bg-zinc-950/50",children:[(0,x.jsx)("option",{value:"weekly",children:"每週"}),(0,x.jsx)("option",{value:"monthly",children:"每月"}),(0,x.jsx)("option",{value:"quarterly",children:"每季"})]}),(0,x.jsxs)(N,{value:r,onChange:e=>a(e.target.value),className:"w-[100px] h-8 text-xs bg-zinc-950/50",children:[(0,x.jsx)("option",{value:"count",children:"交易筆數"}),(0,x.jsx)("option",{value:"priceSum",children:"總銷金額"}),(0,x.jsx)("option",{value:"areaSum",children:"總銷坪數"})]}),(0,x.jsx)(nK,{data:y?.[t]||[],filename:`sales_velocity_${t}`,label:"匯出",chartType:"sales-velocity-chart",snapshotData:y?.[t]||[],columns:{period:"時間區間",count:"交易筆數",priceSum:"總銷金額",areaSum:"總銷坪數"}})]}),children:(0,x.jsx)(nX.SalesVelocityChart,{data:y?.[t]||{},selectedRooms:b,metric:r})}),(0,x.jsx)(D,{title:"銷售速度明細表",description:"各時間段詳細銷售數據統計",headerAction:(0,x.jsx)(nK,{data:y?.[t],filename:`sales_velocity_table_${t}`,label:"匯出",chartType:"sales-velocity-table",snapshotData:y?.[t]||[],columns:{period:"時間區間",count:"交易筆數",priceSum:"總銷金額",areaSum:"總銷坪數"}}),children:(0,x.jsx)(nQ,{data:y?.[t]||[],viewType:t,selectedRooms:b})}),(0,x.jsxs)(D,{title:"房型面積分佈熱力圖",description:"分析不同坪數區間的產品供給與去化分佈",headerAction:(0,x.jsxs)("div",{className:"flex gap-2 items-center text-zinc-400 text-xs",children:[(0,x.jsx)("span",{children:"範圍:"}),(0,x.jsx)(z.Input,{type:"number",value:i,onChange:e=>s(Number(e.target.value)),className:"w-16 h-8 text-xs bg-zinc-950/50"}),(0,x.jsx)("span",{children:"-"}),(0,x.jsx)(z.Input,{type:"number",value:l,onChange:e=>o(Number(e.target.value)),className:"w-16 h-8 text-xs bg-zinc-950/50"}),(0,x.jsx)("span",{className:"ml-2",children:"級距:"}),(0,x.jsx)(z.Input,{type:"number",value:c,onChange:e=>d(Number(e.target.value)),className:"w-16 h-8 text-xs bg-zinc-950/50"}),(0,x.jsx)(nK,{data:j?Object.entries(j).map(([e,t])=>({key:e,value:JSON.stringify(t)})):[],filename:"area_distribution_heatmap",label:"匯出",chartType:"sales-heatmap",snapshotData:{distribution:j,selectedRooms:b,min:i,max:l,interval:c},columns:{key:"坪數區間",value:"分佈數據"}})]}),children:[(0,x.jsx)(nY.AreaHeatmapChart,{data:j||{},selectedRooms:b,minArea:i,maxArea:l,interval:c,onDataPointClick:(t,n)=>{let r=0,a=1/0;if(n.includes("<"))a=parseFloat(n.replace("<","").trim());else if(n.includes(">"))r=parseFloat(n.replace(">","").trim());else if(n.includes("-")){let e=n.split("-");r=parseFloat(e[0].trim()),a=parseFloat(e[1].trim())}let i=(e.transactionDetails||[]).filter(e=>{let n=function(e){let t=e=>e?String(e).normalize("NFKC").toUpperCase().replace(/\s+/g,""):"",n=t(e["建物型態"]||e.buildingType),r=t(e["主要用途"]||e.mainPurpose),a=t(e["戶別"]||e.unit),i=void 0!==e["房數"]?e["房數"]:e.rooms,s=void 0!==e["房屋面積(坪)"]?parseFloat(e["房屋面積(坪)"]):parseFloat(e.houseArea||0);if(n.includes("住宅大樓")&&a.includes("S")||a.includes("店舖")||a.includes("店面")||a.includes("店鋪"))return"店舖";if(a.includes("事務所")||a.includes("辦公"))return"辦公/事務所";if(n.includes("店舖")||n.includes("店面")||n.includes("店鋪"))return"店舖";if(n.includes("工廠")||n.includes("倉庫")||n.includes("廠辦"))return"廠辦/工廠";if(r.includes("商業")||n.includes("辦公")||n.includes("事務所"))return"辦公/事務所";if((n.includes("住宅大樓")||n.includes("華廈"))&&0===i){if(s>35)return"毛胚";if(s<=35)return"套房"}if("number"==typeof i&&!isNaN(i)){if(1===i)return"1房";if(2===i)return"2房";if(3===i)return"3房";if(4===i)return"4房";if(i>=5)return"5房以上"}return"其他"}(e),i=parseFloat(e["房屋面積(坪)"]||e.houseArea||(e["建物移轉平方公尺"]?.3025*e["建物移移轉平方公尺"]:0));if(!n)return!1;let s=i>=r&&i<a;return n===t&&s});console.log(`[Heatmap Click] Room: ${t}, Range: ${r}-${a}, Found: ${i.length}`);let s={};i.forEach(e=>{let t=e["建案名稱"]||e.projectName||"未知建案";s[t]||(s[t]=[]),s[t].push(e)});let l=Object.entries(s).map(([e,t])=>{let n=t.map(e=>e["產權總價"]||e["交易總價(萬)"]||e.totalPrice||0).filter(e=>e>0).sort((e,t)=>e-t),r=t.map(e=>e["房屋單價"]||e["房屋單價(萬)"]||e.unitPrice||0).filter(e=>e>0),a=0;if(n.length>0){let e=Math.floor(n.length/2);a=n.length%2!=0?n[e]:(n[e-1]+n[e])/2}return{projectName:e,count:t.length,priceRange:{min:n.length>0?n[0]:0,max:n.length>0?n[n.length-1]:0,median:a},unitPriceRange:{min:r.length>0?Math.min(...r):0,max:r.length>0?Math.max(...r):0},transactions:t.sort((e,t)=>{let n=e["房屋單價"]||e["房屋單價(萬)"]||e.unitPrice||0;return(t["房屋單價"]||t["房屋單價(萬)"]||t.unitPrice||0)-n}),isExpanded:!1}});l.sort((e,t)=>t.unitPriceRange.max-e.unitPriceRange.max),h(l),f({roomType:t,areaRange:n,totalCount:i.length})}}),p&&(0,x.jsxs)("div",{className:"mt-4 p-4 bg-zinc-900/50 border border-white/10 rounded-lg",children:[(0,x.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,x.jsxs)("div",{children:[(0,x.jsxs)("h4",{className:"text-white font-medium flex items-center gap-2",children:[(0,x.jsx)("span",{className:"text-cyan-400",children:p.roomType}),(0,x.jsx)("span",{className:"text-zinc-500",children:"|"}),(0,x.jsxs)("span",{children:[p.areaRange," 坪"]})]}),(0,x.jsxs)("p",{className:"text-zinc-400 text-xs mt-1",children:["共找到 ",u.length," 個建案，合計 ",p.totalCount," 筆交易"]})]}),(0,x.jsxs)("div",{className:"flex gap-2",children:[(0,x.jsx)(nK,{data:u,filename:`heatmap_aggregated_${p.roomType}_${p.areaRange}`,label:"匯出統計",chartType:"sales-heatmap-detail",snapshotData:u}),(0,x.jsx)(nK,{data:u.flatMap(e=>e.transactions),filename:`heatmap_details_${p.roomType}_${p.areaRange}`,label:"匯出明細"}),(0,x.jsx)("button",{onClick:()=>f(null),className:"text-zinc-400 hover:text-white text-sm bg-zinc-800/50 px-3 py-1 rounded-full hover:bg-zinc-700 transition-colors",children:"✕ 關閉"})]})]}),u.length>0?(0,x.jsx)("div",{className:"max-h-[500px] overflow-y-auto pr-1 custom-scrollbar",children:(0,x.jsxs)("table",{className:"w-full text-xs border-collapse",children:[(0,x.jsx)("thead",{className:"bg-zinc-800 text-zinc-300 sticky top-0 z-10 shadow-sm",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"p-3 text-left w-[25%]",children:"建案名稱 (戶數)"}),(0,x.jsx)("th",{className:"p-3 text-center w-[25%]",children:"成交單價範圍 (萬/坪)"}),(0,x.jsx)("th",{className:"p-3 text-center w-[15%]",children:"總價中位數"}),(0,x.jsx)("th",{className:"p-3 text-center w-[35%]",children:"成交總價範圍 (萬)"})]})}),(0,x.jsx)("tbody",{className:"divide-y divide-white/5",children:u.map((e,t)=>(0,x.jsxs)(m.default.Fragment,{children:[(0,x.jsxs)("tr",{className:(0,g.cn)("group transition-colors cursor-pointer select-none",e.isExpanded?"bg-zinc-800/60":"hover:bg-zinc-800/30"),onClick:()=>{h(e=>e.map((e,n)=>n===t?{...e,isExpanded:!e.isExpanded}:e))},children:[(0,x.jsxs)("td",{className:"p-3 font-medium text-white flex items-center gap-2",children:[(0,x.jsx)("span",{className:(0,g.cn)("text-zinc-500 transition-transform duration-200",e.isExpanded?"rotate-90":""),children:"▶"}),e.projectName,(0,x.jsx)("span",{className:"px-1.5 py-0.5 rounded-full bg-zinc-700 text-zinc-300 text-[10px] min-w-[24px] text-center",children:e.count})]}),(0,x.jsx)("td",{className:"p-3 text-center font-mono text-cyan-400",children:e.unitPriceRange.min===e.unitPriceRange.max?e.unitPriceRange.min.toFixed(1):`${e.unitPriceRange.min.toFixed(1)} ~ ${e.unitPriceRange.max.toFixed(1)}`}),(0,x.jsx)("td",{className:"p-3 text-center font-mono text-violet-400",children:w(e.priceRange.median||0)}),(0,x.jsx)("td",{className:"p-3 text-center font-mono text-zinc-300",children:e.priceRange.min===e.priceRange.max?w(e.priceRange.min):`${w(e.priceRange.min)} ~ ${w(e.priceRange.max)}`})]}),e.isExpanded&&(0,x.jsx)("tr",{children:(0,x.jsx)("td",{colSpan:4,className:"p-0 bg-zinc-950/30 inset-shadow",children:(0,x.jsx)("div",{className:"p-2 pl-8 border-l-2 border-zinc-700/50 ml-4 my-1",children:(0,x.jsxs)("table",{className:"w-full text-xs bg-transparent opacity-80",children:[(0,x.jsx)("thead",{className:"text-zinc-500 border-b border-white/5",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"py-1 text-left font-normal pl-2",children:"樓層"}),(0,x.jsx)("th",{className:"py-1 text-left font-normal",children:"戶型"}),(0,x.jsx)("th",{className:"py-1 text-right font-normal",children:"坪數"}),(0,x.jsx)("th",{className:"py-1 text-right font-normal",children:"單價"}),(0,x.jsx)("th",{className:"py-1 text-right font-normal pr-2",children:"總價"})]})}),(0,x.jsxs)("tbody",{children:[e.transactions.slice(0,e.showAll?void 0:10).map((e,t)=>(0,x.jsxs)("tr",{className:"hover:text-white",children:[(0,x.jsx)("td",{className:"py-1 pl-2",children:e["樓層"]||e.floor||"-"}),(0,x.jsx)("td",{className:"py-1 text-left text-zinc-400",children:e["戶型"]||"-"}),(0,x.jsx)("td",{className:"py-1 text-right font-mono",children:(e["房屋面積(坪)"]||e.houseArea||0).toFixed(1)}),(0,x.jsx)("td",{className:"py-1 text-right font-mono text-cyan-500",children:(e["房屋單價(萬)"]||e.unitPrice||0).toFixed(1)}),(0,x.jsx)("td",{className:"py-1 text-right font-mono pr-2",children:w(e["交易總價(萬)"]||e.totalPrice||0)})]},t)),e.transactions.length>10&&!e.showAll&&(0,x.jsx)("tr",{children:(0,x.jsx)("td",{colSpan:5,className:"py-2 text-center",children:(0,x.jsxs)("button",{onClick:e=>{e.stopPropagation(),h(e=>e.map((e,n)=>n===t?{...e,showAll:!0}:e))},className:"text-zinc-500 hover:text-zinc-300 italic text-xs hover:underline",children:["... 還有 ",e.transactions.length-10," 筆 (點擊展開) ..."]})})}),e.transactions.length>10&&e.showAll&&(0,x.jsx)("tr",{children:(0,x.jsx)("td",{colSpan:5,className:"py-2 text-center",children:(0,x.jsx)("button",{onClick:e=>{e.stopPropagation(),h(e=>e.map((e,n)=>n===t?{...e,showAll:!1}:e))},className:"text-zinc-500 hover:text-zinc-300 italic text-xs hover:underline",children:"... 收合 ..."})})})]})]})})})})]},t))})]})}):(0,x.jsx)("p",{className:"text-zinc-500 text-center py-8 bg-zinc-900/30 rounded border border-dashed border-zinc-800",children:"無詳細資料"})]})]})]})}function n0({data:e}){let t=(0,m.useMemo)(()=>e?[e.withParking.count,e.withoutParking.count]:[],[e]),n=(0,m.useMemo)(()=>({chart:{type:"donut",background:"transparent",foreColor:"#e5e7eb"},labels:["含車位","無車位"],colors:["#a5b4fc","#4b5563"],plotOptions:{pie:{donut:{labels:{show:!0,total:{show:!0,label:"總交易",color:"#e5e7eb",formatter:e=>e.globals.seriesTotals.reduce((e,t)=>e+t,0).toLocaleString()+" 筆"}}}}},dataLabels:{enabled:!0,formatter:e=>`${e.toFixed(1)}%`},legend:{show:!1},tooltip:{theme:"dark",y:{formatter:e=>`${e} 筆`}},stroke:{show:!1},responsive:[{breakpoint:480,options:{chart:{width:300},legend:{position:"bottom"}}}]}),[]);return e&&(0!==e.withParking.count||0!==e.withoutParking.count)?(0,x.jsx)(nU.default,{type:"donut",series:t,options:n,height:350,className:"w-full"}):(0,x.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無車位配比資料"})}function n1({data:e,xLabel:t,yLabel:n,xUnit:r="",yUnit:a="",title:i,highlightIds:s=[]}){let[l,o]=(0,m.useState)(null),[c,d]=(0,m.useState)(null),[u,h]=(0,m.useState)({x:0,y:0}),{xMin:p,xMax:f,yMin:b,yMax:v}=(0,m.useMemo)(()=>{if(0===e.length)return{xMin:0,xMax:100,yMin:0,yMax:100};let t=e.map(e=>e.x),n=e.map(e=>e.y),r=Math.min(...t),a=Math.max(...t),i=Math.min(...n),s=Math.max(...n),l=(a-r)*.1||1,o=(s-i)*.1||1;return{xMin:Math.max(0,r-l),xMax:a+l,yMin:Math.max(0,i-o),yMax:s+o}},[e]),y=s.length>0,j=e=>{let t=e.currentTarget.closest(".relative.bg-zinc-900\\/30")?.getBoundingClientRect();t&&h({x:e.clientX-t.left,y:e.clientY-t.top})},N=c||l,w=(0,m.useMemo)(()=>s.length?[...e].sort((e,t)=>!!s.includes(e.id)-!!s.includes(t.id)):e,[e,s]);return(0,x.jsxs)("div",{className:"w-full h-[400px] relative bg-zinc-900/30 rounded-xl border border-white/5 p-4 select-none cursor-crosshair",onClick:()=>{d(null),o(null)},onMouseMove:e=>{!c&&l&&j(e)},children:[i&&(0,x.jsx)("h4",{className:"absolute top-4 left-4 text-sm font-medium text-zinc-400 pointer-events-none",children:i}),(0,x.jsxs)("div",{className:"absolute inset-x-12 inset-y-12 pointer-events-none",children:[(0,x.jsx)("div",{className:"absolute inset-0 flex flex-col justify-between opacity-20",children:[0,.25,.5,.75,1].map(e=>(0,x.jsx)("div",{className:"w-full h-px border-t border-dashed border-zinc-500"},e))}),(0,x.jsx)("div",{className:"absolute inset-0 flex justify-between opacity-20",children:[0,.25,.5,.75,1].map(e=>(0,x.jsx)("div",{className:"h-full w-px border-l border-dashed border-zinc-500"},e))})]}),(0,x.jsx)("div",{className:"absolute inset-x-12 inset-y-12",children:w.map(e=>{var t,n;let r=(t=e.x,n=e.y,{left:`${(t-p)/(f-p)*100}%`,top:`${100-(n-b)/(v-b)*100}%`}),a=l?.id===e.id,i=c?.id===e.id,u=y&&s.includes(e.id),m="bg-cyan-500/60 hover:bg-cyan-400 z-10",h="";return y&&(u?(m="bg-yellow-400 shadow-[0_0_10px_rgba(250,204,21,0.6)] z-20",h="scale-125"):m="bg-zinc-700/30 z-0"),(a||i)&&(m="bg-cyan-400 shadow-[0_0_15px_rgba(34,211,238,0.8)] ring-2 ring-white z-30",h="scale-150",y&&u&&(m="bg-yellow-400 shadow-[0_0_15px_rgba(250,204,21,0.8)] ring-2 ring-white z-30")),(0,x.jsx)("div",{className:(0,g.cn)("absolute w-3 h-3 rounded-full cursor-pointer transition-all duration-300 transform -translate-x-1/2 -translate-y-1/2",m,h),style:{left:r.left,top:r.top},onMouseEnter:t=>{c||(!y||s.includes(e.id))&&(o(e),j(t))},onMouseLeave:()=>!c&&o(null),onClick:t=>{t.stopPropagation(),(!y||s.includes(e.id))&&(c?.id===e.id?(d(null),o(e)):(d(e),o(null),j(t)))}},e.id)})}),(0,x.jsxs)("div",{className:"absolute left-0 top-12 bottom-12 w-10 flex flex-col justify-between text-[10px] text-zinc-500 text-right pr-2 pointer-events-none",children:[(0,x.jsxs)("span",{children:[Math.round(v),a]}),(0,x.jsxs)("span",{children:[Math.round(b),a]})]}),(0,x.jsxs)("div",{className:"absolute left-12 right-12 bottom-4 h-6 flex justify-between text-[10px] text-zinc-500 pt-1 pointer-events-none",children:[(0,x.jsxs)("span",{children:[Math.round(p),r]}),(0,x.jsxs)("span",{children:[Math.round(f),r]})]}),(0,x.jsx)("div",{className:"absolute bottom-1 left-1/2 -translate-x-1/2 text-xs text-zinc-400 font-bold pointer-events-none",children:t}),(0,x.jsx)("div",{className:"absolute left-1 top-1/2 -translate-y-1/2 -rotate-90 text-xs text-zinc-400 font-bold pointer-events-none",children:n}),N&&(0,x.jsx)("div",{className:"absolute z-50 pointer-events-none",style:{left:u.x,top:u.y,transform:"translate(10px, 10px)"},children:(0,x.jsxs)("div",{className:"bg-zinc-950/90 border border-cyan-500/30 rounded-lg p-3 shadow-xl backdrop-blur-md w-48 animate-in zoom-in-95 fade-in duration-200",children:[(0,x.jsx)("div",{className:"text-sm font-bold text-white mb-1",children:N.label}),(0,x.jsxs)("div",{className:"space-y-1 text-xs text-zinc-400",children:[(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsxs)("span",{children:[t,":"]}),(0,x.jsxs)("span",{className:"text-cyan-400 font-mono",children:[N.x.toLocaleString()," ",r]})]}),(0,x.jsxs)("div",{className:"flex justify-between",children:[(0,x.jsxs)("span",{children:[n,":"]}),(0,x.jsxs)("span",{className:"text-cyan-400 font-mono",children:[N.y.toLocaleString()," ",a]})]})]})]})})]})}var n2=e.i(89950);let n5=(0,k.default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),n4=(0,k.default)("circle-question-mark",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var n3=e.i(36441);function n8({isOpen:e,onClose:t,title:n,children:r,className:a,maxWidth:i="max-w-4xl"}){return e?(0,x.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm animate-in fade-in duration-200",children:[(0,x.jsx)("div",{className:"absolute inset-0",onClick:t}),(0,x.jsxs)(n3.Card,{className:(0,g.cn)("relative w-full max-h-[90vh] flex flex-col overflow-hidden animate-in zoom-in-95 duration-200",i,a),onClick:e=>e.stopPropagation(),children:[(0,x.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border-default",children:[n&&(0,x.jsx)("h2",{className:"text-2xl font-bold text-white",children:n}),(0,x.jsx)("button",{onClick:t,className:"p-1 rounded-full hover:bg-white/10 transition-colors text-gray-400 hover:text-white",children:(0,x.jsx)(b.X,{size:24})})]}),(0,x.jsx)("div",{className:"p-6 overflow-y-auto custom-scrollbar",children:r})]})]}):null}var n6=e.i(74579);function n9({projects:e,className:t,onChange:n,max:r=6,placeholder:a="搜尋並加入比較...",title:i="建案亮點標示"}){let[s,l]=(0,m.useState)(""),[o,c]=(0,m.useState)([]),[d,u]=(0,m.useState)(!1),h=(0,m.useRef)(null),p=(0,m.useRef)(null);(0,m.useEffect)(()=>{let e=e=>{h.current&&!h.current.contains(e.target)&&u(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let f=e.filter(e=>!o.includes(e.value)&&e.label.toLowerCase().includes(s.toLowerCase())).slice(0,10);return(0,x.jsxs)("div",{className:(0,g.cn)("space-y-2",t),ref:h,children:[(0,x.jsxs)("div",{className:"flex justify-between items-center bg-zinc-900/50 p-1 rounded-lg border border-white/5",children:[(0,x.jsxs)("h4",{className:"text-sm font-medium text-zinc-400 pl-2 border-l-2 border-yellow-500",children:[i," ",(0,x.jsxs)("span",{className:"text-xs font-normal text-zinc-600",children:["(最多 ",r," 個)"]})]}),o.length>0&&(0,x.jsxs)("button",{onClick:()=>{c([]),n([]),p.current?.focus()},className:"p-1.5 text-zinc-500 hover:text-rose-400 hover:bg-rose-500/10 rounded transition-colors flex items-center gap-1 text-xs",title:"清除所有選擇",children:[(0,x.jsx)(n6.Trash2,{size:14}),"清除"]})]}),(0,x.jsxs)("div",{className:"flex flex-wrap gap-2 min-h-[32px]",children:[0===o.length&&(0,x.jsx)("span",{className:"text-xs text-zinc-600 italic py-1",children:"尚未選擇建案..."}),o.map(e=>(0,x.jsxs)("div",{className:"flex items-center gap-1 bg-yellow-500/10 text-yellow-500 px-2 py-1 rounded text-xs border border-yellow-500/30",children:[(0,x.jsx)("span",{children:e}),(0,x.jsx)("button",{onClick:()=>{let t;c(t=o.filter(t=>t!==e)),n(t)},className:"hover:text-yellow-300",children:(0,x.jsx)(v.Check,{size:12,className:"rotate-45"})})]},e))]}),(0,x.jsxs)("div",{className:"relative",children:[(0,x.jsx)(n2.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-500"}),(0,x.jsx)("input",{ref:p,type:"text",value:s,onChange:e=>{l(e.target.value),u(!0)},onFocus:()=>u(!0),placeholder:a,className:"w-full bg-zinc-900/50 border border-white/10 rounded-lg pl-9 pr-4 py-2 text-sm text-white placeholder:text-zinc-600 focus:outline-none focus:ring-1 focus:ring-cyan-500/50 transition-all",disabled:o.length>=r}),d&&(0,x.jsx)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-zinc-900 border border-white/10 rounded-lg shadow-xl z-50 max-h-60 overflow-y-auto",children:f.length>0?f.map(e=>(0,x.jsx)("button",{onClick:()=>(e=>{if(o.length>=r)return;let t=[...o,e];c(t),n(t),l(""),p.current?.focus()})(e.value),className:"w-full text-left px-3 py-2 text-sm text-zinc-300 hover:bg-white/5 hover:text-white transition-colors",children:e.label},e.value)):(0,x.jsx)("div",{className:"px-3 py-2 text-sm text-zinc-600",children:"無相關建案"})})]})]})}function n7({chartData:e,hasData:t,summaryStats:n}){let[r,a]=(0,m.useState)("scale"),[i,s]=(0,m.useState)(null);m.default.useRef(null);let[l,o]=(0,m.useState)([]);if(!t)return(0,x.jsx)("p",{className:"text-zinc-500 text-center py-4",children:"無坡道平面車位坪數資料"});let c="scale"===r?e.map(e=>({id:e.id,label:e.id,x:e.count,y:e.avgArea})):e.map(e=>({id:e.id,label:e.id,x:e.avgPrice,y:e.avgArea}));return(0,x.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 relative",children:[i&&(0,x.jsxs)("div",{className:"fixed z-50 px-3 py-2 bg-zinc-900 border border-white/10 rounded-lg shadow-xl text-xs text-zinc-300 pointer-events-none transform -translate-x-1/2 -translate-y-full animate-in fade-in zoom-in-95",style:{left:i.x,top:i.y},children:[i.text,(0,x.jsx)("div",{className:"absolute left-1/2 bottom-0 w-2 h-2 bg-zinc-900 border-r border-b border-white/10 text-zinc-900 transform rotate-45 -translate-x-1/2 -mb-1"})]}),(0,x.jsxs)("div",{className:"lg:col-span-1 space-y-6",children:[(0,x.jsxs)("div",{className:"space-y-4",children:[(0,x.jsx)("h4",{className:"text-sm font-medium text-zinc-400 pl-1 border-l-2 border-cyan-500",children:"總體統計數據"}),(0,x.jsx)("div",{className:"bg-zinc-900/30 rounded-xl border border-white/5 p-4",children:(0,x.jsx)("table",{className:"w-full text-sm",children:(0,x.jsxs)("tbody",{className:"divide-y divide-white/5",children:[(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{className:"py-3 text-zinc-500",children:"數據範圍"}),(0,x.jsxs)("td",{className:"py-3 text-right font-mono text-white",children:[(0,x.jsx)("span",{className:"text-cyan-400",children:e.length})," 建案",(0,x.jsx)("span",{className:"mx-1 text-zinc-600",children:"/"}),(0,x.jsx)("span",{className:"text-zinc-300",children:n.count.toLocaleString()})," 車位"]})]}),(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{className:"py-3 text-zinc-500",children:"平均坪數"}),(0,x.jsxs)("td",{className:"py-3 text-right font-mono text-cyan-400 text-lg font-bold",children:[n.avgArea.toFixed(2)," ",(0,x.jsx)("span",{className:"text-xs font-normal text-zinc-500",children:"坪"})]})]}),(0,x.jsxs)("tr",{children:[(0,x.jsx)("td",{className:"py-3 text-zinc-500",children:"坪數中位數"}),(0,x.jsxs)("td",{className:"py-3 text-right font-mono text-zinc-300 text-lg font-bold",children:[n.medianArea.toFixed(2)," ",(0,x.jsx)("span",{className:"text-xs font-normal text-zinc-500",children:"坪"})]})]})]})})})]}),(0,x.jsx)(n9,{projects:e.map(e=>({value:e.id,label:e.id})),className:"w-full",onChange:e=>o(e),max:6})]}),(0,x.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[(0,x.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-2",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("h4",{className:"text-sm font-medium text-zinc-400 pl-1 border-l-2 border-violet-500",children:"分佈散佈圖"}),(0,x.jsx)("div",{className:"mt-1 text-xs text-zinc-500 font-mono",children:"scale"===r?(0,x.jsxs)("span",{children:[(0,x.jsx)("span",{className:"text-cyan-400",children:"X軸"}),": 建案車位總數 ",(0,x.jsx)("span",{className:"text-zinc-600",children:"|"})," ",(0,x.jsx)("span",{className:"text-cyan-400",children:"Y軸"}),": 平均車位坪數"]}):(0,x.jsxs)("span",{children:[(0,x.jsx)("span",{className:"text-cyan-400",children:"X軸"}),": 平均車位價格 ",(0,x.jsx)("span",{className:"text-zinc-600",children:"|"})," ",(0,x.jsx)("span",{className:"text-cyan-400",children:"Y軸"}),": 平均車位坪數"]})})]}),(0,x.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,x.jsxs)("div",{className:"relative group",children:[(0,x.jsx)("button",{className:"p-1.5 text-zinc-500 hover:text-cyan-400 transition-colors",children:(0,x.jsx)(n4,{size:14})}),(0,x.jsx)("div",{className:"absolute right-0 top-full mt-2 w-64 p-3 bg-zinc-900 border border-white/10 rounded-lg shadow-xl z-50 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:(0,x.jsx)("div",{className:"text-xs text-zinc-300 leading-relaxed",children:"scale"===r?"分析各建案「規劃車位總數」與「平均車位坪數」的關係。可觀察大社區是否傾向規劃較大或較小的車位。":"分析各建案「平均車位價格」與「平均車位坪數」的關係。可觀察車位價格是否隨著坪數增加而顯著提升。"})})]}),(0,x.jsx)("div",{className:"w-px h-4 bg-white/10 mx-1"}),(0,x.jsx)("button",{onClick:()=>a("scale"),className:(0,g.cn)("px-3 py-1.5 text-xs font-medium rounded-md border transition-all duration-200","scale"===r?"bg-cyan-500/10 text-cyan-400 border-cyan-500/50 shadow-[0_0_10px_rgba(34,211,238,0.1)]":"bg-zinc-900/50 border-white/10 text-zinc-500 hover:text-zinc-300 hover:bg-white/5"),children:"規模分析"}),(0,x.jsx)("button",{onClick:()=>a("value"),className:(0,g.cn)("px-3 py-1.5 text-xs font-medium rounded-md border transition-all duration-200","value"===r?"bg-cyan-500/10 text-cyan-400 border-cyan-500/50 shadow-[0_0_10px_rgba(34,211,238,0.1)]":"bg-zinc-900/50 border-white/10 text-zinc-500 hover:text-zinc-300 hover:bg-white/5"),children:"價值分析"})]})]}),(0,x.jsx)(n1,{data:c,xLabel:"scale"===r?"建案車位總數":"平均車位價格",yLabel:"平均車位坪數",xUnit:"scale"===r?"位":"萬",yUnit:"坪",title:"scale"===r?"建案規模 vs 車位坪數分佈":"車位價值 vs 坪數分佈",highlightIds:l})]})]})}function re({data:e}){let[t,n]=(0,m.useState)(["B1","B2","B3","B4"]),[r,a]=(0,m.useState)(null),[i,s]=(0,m.useState)(!1),[l,o]=(0,m.useState)(null),[c,d]=(0,m.useState)([]),[u,h]=(0,m.useState)(!1),[p,f]=(0,m.useState)(0);if(!e?.parkingAnalysis)return null;let{parkingRatio:b,avgPriceByType:y,rampPlanePriceByFloor:j}=e.parkingAnalysis,N=["B1","B2","B3","B4","B5_below","Unknown"],w=j?.filter(e=>N.includes(e.floor)&&e.count>0)||[],z=(0,m.useMemo)(()=>(function(e,t){let n=[];if(e.forEach(e=>{t.includes(e.floor)&&e.rawRecords&&e.rawRecords.forEach(e=>{"number"!=typeof e.parkingPrice||isNaN(e.parkingPrice)||n.push(e.parkingPrice)})}),0===n.length)return{avgPrice:0,medianPrice:0,q3Price:0,count:0};n.sort((e,t)=>e-t);let r=n.reduce((e,t)=>e+t,0)/n.length,a=n[Math.floor(n.length/2)],i=Math.floor(.75*n.length),s=n[i]||a;return{avgPrice:r,medianPrice:a,q3Price:s,count:n.length}})(w,t),[w,t]),k=(0,m.useCallback)(e=>{n(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),_=(0,m.useCallback)(()=>{t.length===N.length?n([]):n([...N])},[t.length]),S={B1:"#06b6d4",B2:"#3b82f6",B3:"#6366f1",B4:"#8b5cf6",B5_below:"#a855f7",Unknown:"#71717a"},{parkingChartData:C,parkingChartStats:P,hasParkingData:M}=(0,m.useMemo)(()=>{let e=new Map,t=!1;w.forEach(n=>{n.rawRecords&&n.rawRecords.forEach(n=>{let r=n["建案名稱"],a=n.parkingArea||n["車位面積(坪)"]||.3025*(n["車位移轉總面積平方公尺"]||0),i=n.parkingPrice||n["車位價格(萬)"]||0;if(r&&a>0){e.has(r)||e.set(r,{count:0,totalArea:0,totalPrice:0});let n=e.get(r);n.count+=1,n.totalArea+=a,n.totalPrice+=i,t=!0}})});let n=Array.from(e.entries()).map(([e,t])=>({id:e,label:e,avgArea:parseFloat((t.totalArea/t.count).toFixed(2)),count:t.count,avgPrice:parseFloat((t.totalPrice/t.count).toFixed(2))})),r=0,a=[];n.forEach(e=>{r+=e.count,a.push(e.avgArea)}),a.sort((e,t)=>e-t);let i=a.length>0?a.reduce((e,t)=>e+t,0)/a.length:0,s=a.length>0?a[Math.floor(a.length/2)]:0;return{parkingChartData:n,parkingChartStats:{count:r,avgArea:i,medianArea:s},hasParkingData:t}},[w]);return(0,x.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500 text-white",children:[(0,x.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,x.jsx)(D,{title:"房車配比分析",description:"建案有購置車位的比例",headerAction:(0,x.jsx)(nK,{data:[{type:"有車位",...b?.withParking},{type:"無車位",...b?.withoutParking},{ratio:b?.avgRatio}],filename:"parking_ratio_data",label:"匯出",columns:{type:"類別",count:"數量",percentage:"百分比",ratio:"比率"},chartType:"parking-pie",snapshotData:[{type:"有車位",...b?.withParking},{type:"無車位",...b?.withoutParking},{ratio:b?.avgRatio}]}),children:(0,x.jsxs)("div",{className:"flex flex-col md:flex-row items-start gap-6",children:[(0,x.jsx)("div",{className:"w-full md:w-1/2",children:(0,x.jsx)(n0,{data:b})}),(0,x.jsxs)("div",{className:"w-full md:w-1/2 flex flex-col gap-4",children:[(0,x.jsxs)("table",{className:"w-full text-sm",children:[(0,x.jsx)("thead",{className:"bg-zinc-900/50 text-zinc-500",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"p-2 text-left",children:"類型"}),(0,x.jsx)("th",{className:"p-2 text-right",children:"筆數"}),(0,x.jsx)("th",{className:"p-2 text-right",children:"佔比"})]})}),(0,x.jsxs)("tbody",{className:"divide-y divide-white/5",children:[(0,x.jsxs)("tr",{children:[(0,x.jsxs)("td",{className:"p-2 flex items-center gap-2",children:[(0,x.jsx)("span",{className:"w-3 h-3 rounded-full bg-indigo-300"}),"有搭車位"]}),(0,x.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:b?.withParking?.count.toLocaleString()}),(0,x.jsxs)("td",{className:"p-2 text-right font-mono text-cyan-400",children:[b?.withParking?.percentage.toFixed(2),"%"]})]}),(0,x.jsxs)("tr",{children:[(0,x.jsxs)("td",{className:"p-2 flex items-center gap-2",children:[(0,x.jsx)("span",{className:"w-3 h-3 rounded-full bg-gray-600"}),"無車位"]}),(0,x.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:b?.withoutParking?.count.toLocaleString()}),(0,x.jsxs)("td",{className:"p-2 text-right font-mono text-zinc-500",children:[b?.withoutParking?.percentage.toFixed(2),"%"]})]})]})]}),(0,x.jsxs)("div",{className:"flex gap-6 justify-center md:justify-start px-2 text-sm text-zinc-400",children:[(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)("span",{className:"w-3 h-3 rounded-full bg-indigo-300"}),(0,x.jsx)("span",{children:"有搭車位"})]}),(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)("span",{className:"w-3 h-3 rounded-full bg-gray-600"}),(0,x.jsx)("span",{children:"無車位"})]})]})]})]})}),(0,x.jsx)(D,{title:"車位類型均價",description:"各類車位成交行情",headerAction:(0,x.jsx)(nK,{data:y||[],filename:"parking_price_by_type",label:"匯出",columns:{type:"車位類型",avgPrice:"平均價格",medianPrice:"中位數",count:"數量"},chartType:"parking-price",snapshotData:y||[]}),children:(0,x.jsxs)("table",{className:"w-full text-sm",children:[(0,x.jsx)("thead",{className:"bg-zinc-900/50 text-zinc-500",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"p-2 text-left",children:"類型"}),(0,x.jsx)("th",{className:"p-2 text-right",children:"均價(萬)"}),(0,x.jsx)("th",{className:"p-2 text-right",children:"中位數"}),(0,x.jsx)("th",{className:"p-2 text-right",children:"總數"})]})}),(0,x.jsx)("tbody",{className:"divide-y divide-white/5",children:y?.map(e=>(0,x.jsxs)("tr",{className:"hover:bg-zinc-800/50",children:[(0,x.jsx)("td",{className:"p-2 font-medium",children:e.type}),(0,x.jsx)("td",{className:"p-2 text-right font-mono text-cyan-400",children:Math.round(e.avgPrice).toLocaleString()}),(0,x.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:Math.round(e.medianPrice).toLocaleString()}),(0,x.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:e.count.toLocaleString()})]},e.type))})]})})]}),(0,x.jsx)(D,{title:"坡道平面車位坪數散佈分析",description:"建案車位數與坪數分佈",className:"relative z-20",headerAction:(0,x.jsx)(nK,{data:C||[],filename:"parking_area_scatter_data",label:"匯出",columns:{id:"建案名稱",label:"標籤",avgArea:"平均坪數",count:"車位數",avgPrice:"平均價格"},chartType:"parking-scatter",snapshotData:C||[]}),children:(0,x.jsx)(n7,{chartData:C,hasData:M,summaryStats:P})}),(0,x.jsx)(D,{title:"坡道平面車位 - 樓層價差分析",description:"勾選樓層以動態更新統計數據",headerAction:(0,x.jsx)(nK,{data:w||[],filename:"parking_floor_analysis",label:"匯出",columns:{floor:"樓層",count:"數量",avgPrice:"平均價格",medianPrice:"中位數",maxPrice:"最高價",minPrice:"最低價",q3Price:"第三四分位數"},chartType:"parking-floor",snapshotData:w||[]}),children:(0,x.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,x.jsx)("div",{className:"flex flex-col gap-2 items-center justify-center p-8 bg-zinc-900/30 rounded-xl relative",children:w.map((n,i)=>{let l=t.includes(n.floor),c=r===n.floor;return(0,x.jsxs)("div",{onMouseEnter:()=>a(n.floor),onMouseLeave:()=>a(null),className:(0,g.cn)("w-52 h-14 rounded-lg flex items-center justify-between px-4 shadow-lg transition-all duration-200 cursor-pointer group relative",c&&"ring-2 ring-white scale-105",!l&&"opacity-30"),style:{backgroundColor:S[n.floor]||"#4b5563"},onClick:()=>k(n.floor),children:[(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)("span",{className:(0,g.cn)("w-5 h-5 rounded border-2 flex items-center justify-center",l?"bg-white border-white":"border-white/50"),children:l&&(0,x.jsx)(v.Check,{size:14,className:"text-zinc-900"})}),(0,x.jsx)("span",{className:"font-bold text-white",children:n.floor})]}),(0,x.jsx)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:(0,x.jsx)("button",{onClick:t=>{t.stopPropagation(),(t=>{o(t),h(!1);let n=j?.find(e=>e.floor===t),r=n?.rawRecords;if(r&&r.length>0){let e=r.map(e=>({...e,_isMatch:!0}));e.sort((e,t)=>{let n=e["交易年月日"]||0;return(t["交易年月日"]||0)-n}),d(e),f(e.length)}else{let n=e?.transactionDetails||[],r=[t];"B1"===t&&r.push("地下一層","B1","b1"),"B2"===t&&r.push("地下二層","B2","b2"),"B3"===t&&r.push("地下三層","B3","b3"),"B4"===t&&r.push("地下四層","B4","b4"),"B5_below"===t&&r.push("地下五層","B5","b5");let a=n.filter(e=>(e["車位類別"]||"").includes("坡道平面")),i=a.filter(e=>{let t=e["車位所在樓層"]||"",n=e["備註"]||"";return r.some(e=>t&&t.includes(e)||n&&n.includes(e))});f(i.length);let s=a.map(e=>{let t=e["車位所在樓層"]||"",n=e["備註"]||"",a=r.some(e=>t&&t.includes(e)||n&&n.includes(e));return{...e,_isMatch:a}});s.sort((e,t)=>{if(e._isMatch&&!t._isMatch)return -1;if(!e._isMatch&&t._isMatch)return 1;let n=e["交易年月日"]||0;return(t["交易年月日"]||0)-n}),d(s),0===i.length&&h(!0)}s(!0)})(n.floor)},className:"p-1.5 bg-black/40 hover:bg-black/80 rounded-full text-white backdrop-blur-sm transition-colors ring-1 ring-white/20",title:`查看 ${n.floor} 建案明細`,children:(0,x.jsx)(n2.Search,{size:14})})}),(0,x.jsxs)("div",{className:"text-right mt-1",children:[(0,x.jsxs)("div",{className:"font-mono text-white text-sm",children:[Math.round(n.avgPrice).toLocaleString()," 萬"]}),(0,x.jsxs)("div",{className:"text-white/70 text-xs",children:[n.count," 位"]})]})]},n.floor)})}),(0,x.jsxs)(n8,{isOpen:i,onClose:()=>s(!1),title:`${l} 車位交易明細`,maxWidth:"max-w-5xl",children:[(0,x.jsx)("div",{className:"space-y-4",children:(0,x.jsxs)("div",{className:"flex items-center gap-2 bg-zinc-800/50 p-1 rounded-lg border border-white/10",children:[(0,x.jsxs)("button",{onClick:()=>h(!1),className:(0,g.cn)("px-3 py-1.5 rounded text-xs transition-colors font-medium flex items-center gap-1.5",u?"text-zinc-500 hover:text-zinc-300 hover:bg-white/5":"bg-cyan-500/20 text-cyan-400 border border-cyan-500/30 shadow-[0_0_10px_rgba(34,211,238,0.1)]"),children:[(0,x.jsx)(v.Check,{size:12}),"精確匹配 (",p,")"]}),(0,x.jsxs)("button",{onClick:()=>h(!0),className:(0,g.cn)("px-3 py-1.5 rounded text-xs transition-colors font-medium",u?"bg-rose-500/20 text-rose-400 border border-rose-500/30 shadow-[0_0_10px_rgba(244,63,94,0.1)]":"text-zinc-500 hover:text-zinc-300 hover:bg-white/5"),children:["未匹配 (",c.length-p,")"]}),(0,x.jsx)("div",{className:"ml-auto",children:(0,x.jsx)(nK,{data:c.filter(e=>u?!e._isMatch:e._isMatch),filename:`parking_details_${l}_${u?"all":"match"}`,label:"匯出明細"})})]})}),(0,x.jsx)("div",{className:"overflow-x-auto rounded-lg border border-white/10 max-h-[60vh] custom-scrollbar",children:(0,x.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,x.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 whitespace-nowrap sticky top-0 z-10 backdrop-blur-md",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"p-3",children:"建案名稱"}),(0,x.jsx)("th",{className:"p-3",children:"交易日期"}),(0,x.jsx)("th",{className:"p-3 text-right",children:"車位總價"}),(0,x.jsx)("th",{className:"p-3 text-right",children:"車位面積"}),(0,x.jsx)("th",{className:"p-3",children:"車位樓層"}),(0,x.jsx)("th",{className:"p-3",children:"備註"})]})}),(0,x.jsx)("tbody",{className:"divide-y divide-white/5",children:c.length>0?c.filter(e=>u?!e._isMatch:e._isMatch).map((e,t)=>(0,x.jsxs)("tr",{className:(0,g.cn)("hover:bg-zinc-800/50 transition-colors",e._isMatch?"bg-cyan-500/5":"opacity-60"),children:[(0,x.jsxs)("td",{className:"p-3 font-medium text-white",children:[(0,x.jsx)("div",{children:e["建案名稱"]}),(0,x.jsxs)("div",{className:"text-[10px] text-zinc-600 font-mono mt-0.5",children:["#",e.transactionId||e["編號"]]})]}),(0,x.jsxs)("td",{className:"p-3 text-zinc-400 flex items-center gap-1",children:[(0,x.jsx)(n5,{size:12,className:"text-zinc-600"}),e["交易日"]]}),(0,x.jsxs)("td",{className:"p-3 text-right font-mono text-cyan-400",children:[e["車位總價元"]?(e["車位總價元"]/1e4).toLocaleString():"-"," 萬"]}),(0,x.jsxs)("td",{className:"p-3 text-right font-mono text-zinc-300",children:[e["車位移轉總面積平方公尺"]?(.3025*e["車位移轉總面積平方公尺"]).toFixed(2):"-"," 坪"]}),(0,x.jsx)("td",{className:"p-3 text-zinc-300",children:e["車位所在樓層"]||"-"}),(0,x.jsx)("td",{className:"p-3 text-zinc-500 text-xs max-w-[200px] truncate",title:e["備註"],children:e["備註"]})]},t)):(0,x.jsx)("tr",{children:(0,x.jsx)("td",{colSpan:6,className:"p-8 text-center text-zinc-500",children:"查無相關交易資料。"})})})]})})]}),(0,x.jsxs)("div",{className:"space-y-4",children:[(0,x.jsxs)("div",{className:"p-4 bg-gradient-to-r from-cyan-500/10 to-violet-500/10 border border-cyan-500/30 rounded-lg",children:[(0,x.jsx)("h4",{className:"text-sm font-medium text-cyan-400 mb-3",children:"已選樓層統計"}),(0,x.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"text-xs text-zinc-500",children:"車位數"}),(0,x.jsx)("div",{className:"text-lg font-bold text-white",children:z.count.toLocaleString()})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"text-xs text-zinc-500",children:"平均單價"}),(0,x.jsxs)("div",{className:"text-lg font-bold text-cyan-400",children:[Math.round(z.avgPrice).toLocaleString()," 萬"]})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"text-xs text-zinc-500",children:"中位數"}),(0,x.jsxs)("div",{className:"text-lg font-bold text-zinc-300",children:[Math.round(z.medianPrice).toLocaleString()," 萬"]})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("div",{className:"text-xs text-zinc-500",children:"3/4位數"}),(0,x.jsxs)("div",{className:"text-lg font-bold text-zinc-300",children:[Math.round(z.q3Price).toLocaleString()," 萬"]})]})]})]}),(0,x.jsx)("div",{className:"overflow-x-auto",children:(0,x.jsxs)("table",{className:"w-full text-sm",children:[(0,x.jsx)("thead",{className:"bg-zinc-900/50 text-zinc-500",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"p-2 text-left",children:(0,x.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,x.jsx)("input",{type:"checkbox",checked:t.length===N.length,onChange:_,className:"form-checkbox rounded bg-zinc-800 border-zinc-600 text-cyan-500"}),(0,x.jsx)("span",{children:"全選"})]})}),(0,x.jsx)("th",{className:"p-2 text-left",children:"樓層"}),(0,x.jsx)("th",{className:"p-2 text-right",children:"均價(萬)"}),(0,x.jsx)("th",{className:"p-2 text-right",children:"中位數"}),(0,x.jsx)("th",{className:"p-2 text-right",children:"最高"}),(0,x.jsx)("th",{className:"p-2 text-right",children:"最低"}),(0,x.jsx)("th",{className:"p-2 text-right",children:"車位數"})]})}),(0,x.jsx)("tbody",{className:"divide-y divide-white/5",children:w.map(e=>{let n=t.includes(e.floor),i=r===e.floor;return(0,x.jsxs)("tr",{onMouseEnter:()=>a(e.floor),onMouseLeave:()=>a(null),className:(0,g.cn)("transition-colors cursor-pointer",i?"bg-zinc-800":"hover:bg-zinc-800/50",!n&&"opacity-50"),onClick:()=>k(e.floor),children:[(0,x.jsx)("td",{className:"p-2",children:(0,x.jsx)("input",{type:"checkbox",checked:n,onChange:()=>k(e.floor),className:"form-checkbox rounded bg-zinc-800 border-zinc-600 text-cyan-500",onClick:e=>e.stopPropagation()})}),(0,x.jsx)("td",{className:"p-2 font-medium",children:(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:S[e.floor]}}),e.floor]})}),(0,x.jsx)("td",{className:"p-2 text-right font-mono text-cyan-400",children:Math.round(e.avgPrice).toLocaleString()}),(0,x.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:Math.round(e.medianPrice).toLocaleString()}),(0,x.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:Math.round(e.maxPrice).toLocaleString()}),(0,x.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:Math.round(e.minPrice).toLocaleString()}),(0,x.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:e.count.toLocaleString()})]},e.floor)})})]})})]})]})})]})}var rt=e.i(19542),rn=e.i(99432);function rr({data:e}){if(!e||0===e.length)return(0,x.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無符合條件的建案可進行類型比較"});let t=Math.max(...e.map(e=>e.shopMultiple),1),n=Math.max(...e.map(e=>e.officeMultiple),1);return(0,x.jsx)("div",{className:"overflow-x-auto",children:(0,x.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,x.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 font-semibold uppercase text-xs",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"px-4 py-3",children:"建案名稱"}),(0,x.jsx)("th",{className:"px-4 py-3 text-right",children:"住宅均價"}),(0,x.jsx)("th",{className:"px-4 py-3 text-right",children:"店舖均價"}),(0,x.jsx)("th",{className:"px-4 py-3 w-[200px]",children:"店舖倍數"}),(0,x.jsx)("th",{className:"px-4 py-3 text-right",children:"事務所均價"}),(0,x.jsx)("th",{className:"px-4 py-3 w-[200px]",children:"事務所倍數"})]})}),(0,x.jsx)("tbody",{className:"divide-y divide-white/5",children:e.map((e,r)=>(0,x.jsxs)("tr",{className:"hover:bg-zinc-800/30 transition-colors",children:[(0,x.jsxs)("td",{className:"px-4 py-3",children:[(0,x.jsx)("div",{className:"font-medium text-white",children:e.projectName}),(0,x.jsxs)("div",{className:"text-xs text-zinc-500 flex gap-1 mt-0.5",children:[e.county&&(0,x.jsx)("span",{className:"bg-zinc-800 px-1 rounded",children:e.county}),e.district&&(0,x.jsx)("span",{className:"bg-zinc-800 px-1 rounded",children:e.district})]})]}),(0,x.jsx)("td",{className:"px-4 py-3 text-right font-mono text-zinc-300",children:e.residentialAvg>0?(0,g.formatNumber)(e.residentialAvg):"-"}),(0,x.jsx)("td",{className:"px-4 py-3 text-right font-mono text-zinc-300",children:e.shopAvg>0?(0,g.formatNumber)(e.shopAvg):"-"}),(0,x.jsx)("td",{className:"px-4 py-3",children:e.shopMultiple>0?(0,x.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,x.jsx)("div",{className:"flex justify-between text-xs mb-0.5",children:(0,x.jsxs)("span",{className:"font-bold text-violet-400",children:[e.shopMultiple.toFixed(2),"x"]})}),(0,x.jsx)("div",{className:"h-1.5 bg-zinc-800 rounded-full overflow-hidden w-full",children:(0,x.jsx)("div",{className:"h-full bg-violet-600 rounded-full",style:{width:`${Math.min(e.shopMultiple/t*100,100)}%`}})})]}):(0,x.jsx)("span",{className:"text-zinc-600",children:"-"})}),(0,x.jsx)("td",{className:"px-4 py-3 text-right font-mono text-zinc-300",children:e.officeAvg>0?(0,g.formatNumber)(e.officeAvg):"-"}),(0,x.jsx)("td",{className:"px-4 py-3",children:e.officeMultiple>0?(0,x.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,x.jsx)("div",{className:"flex justify-between text-xs mb-0.5",children:(0,x.jsxs)("span",{className:"font-bold text-cyan-400",children:[e.officeMultiple.toFixed(2),"x"]})}),(0,x.jsx)("div",{className:"h-1.5 bg-zinc-800 rounded-full overflow-hidden w-full",children:(0,x.jsx)("div",{className:"h-full bg-cyan-600 rounded-full",style:{width:`${Math.min(e.officeMultiple/n*100,100)}%`}})})]}):(0,x.jsx)("span",{className:"text-zinc-600",children:"-"})})]},r))})]})})}function ra({data:e,visibleSections:t=["stats","comparison","chart"]}){let[n,r]=(0,m.useState)("weighted"),[a,i]=(0,m.useState)(30),[s,l]=(0,m.useState)(150),[o,c]=(0,m.useState)(5),[d,u]=(0,m.useState)("count"),h=e?.transactionDetails||[],p=e?.unitPriceAnalysis,f=p?.residentialStats,b=p?.officeStats,v=p?.storeStats,y=p?.typeComparison;return e&&(h.length||p)?(0,x.jsxs)("div",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[t.includes("stats")&&(0,x.jsx)(D,{title:"各用途單價統計",headerAction:(0,x.jsxs)("div",{className:"flex items-center gap-4",children:[(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)("span",{className:"text-zinc-400 text-xs",children:"平均類型:"}),(0,x.jsxs)("div",{className:"flex bg-zinc-950/50 rounded-md p-1 border border-white/5",children:[(0,x.jsx)("button",{onClick:()=>r("arithmetic"),className:(0,g.cn)("px-2 py-0.5 text-[10px] rounded transition-colors","arithmetic"===n?"bg-violet-500 text-white":"text-zinc-500 hover:text-white"),children:"算術"}),(0,x.jsx)("button",{onClick:()=>r("weighted"),className:(0,g.cn)("px-2 py-0.5 text-[10px] rounded transition-colors","weighted"===n?"bg-violet-500 text-white":"text-zinc-500 hover:text-white"),children:"加權"})]})]}),(0,x.jsx)(nK,{data:[f,b,v],filename:"unit_price_stats",label:"匯出",chartType:"unit-price-stats",snapshotData:{residentialStats:f,officeStats:b,storeStats:v,averageType:n}})]}),children:(0,x.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[(0,x.jsx)(rn.UnitPriceStatsBlock,{title:"住宅建案統計",stats:f,noDataMessage:"無住宅交易數據",className:"border-violet-500/20",averageType:n}),(0,x.jsx)(rn.UnitPriceStatsBlock,{title:"一般事務所/辦公室統計",stats:b,noDataMessage:"無事務所/辦公室交易數據",className:"border-cyan-500/20",averageType:n}),(0,x.jsx)(rn.UnitPriceStatsBlock,{title:"店舖統計",stats:v,noDataMessage:"無店舖交易數據",className:"border-amber-500/20 xl:col-span-2",averageType:n})]})}),t.includes("comparison")&&y&&y.length>0&&(0,x.jsx)(D,{title:"建案產品類型單價比較",description:"同一建案內不同用途（住宅/店面/事務所）的單價與倍數比較",headerAction:(0,x.jsx)(nK,{data:y,filename:"type_comparison_data",label:"匯出",chartType:"type-comparison-table",snapshotData:y,columns:{projectName:"建案",residentialAvg:"住宅均價",officeAvg:"辦公均價",storeAvg:"店舖均價",officeRatio:"辦公倍數",storeRatio:"店舖倍數"}}),children:(0,x.jsx)(rr,{data:y})}),t.includes("chart")&&(0,x.jsx)("div",{className:"space-y-4",children:(0,x.jsx)(D,{title:"單價分佈泡泡圖",description:"分析各單價區間的成交熱度與分佈密集區",headerAction:(0,x.jsx)(nK,{data:h,filename:"bubble_chart_source_data",label:"匯出",chartType:"unit-price-bubble",snapshotData:h}),children:(0,x.jsx)(rt.BubbleChart,{data:h,minPrice:a,maxPrice:s,interval:o,sizeMetric:d,onMinPriceChange:i,onMaxPriceChange:l,onIntervalChange:c,onSizeMetricChange:u})})})]}):null}var ri=e.i(78956);let rs=(0,k.default)("wand-sparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);class rl{knownPatterns=new Map;patternFrequency=new Map;constructor(){this.initializeBasePatterns()}initializeBasePatterns(){[{id:"unit_slash_floorF_format",name:"戶號斜線樓層F格式",regex:/^([A-Z]\d+)\/(\d+)F[號号]?$/i,extract:(e,t)=>{let n=e[1],r=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?n:n+r},confidence:100,priority:.01},{id:"building_unit_floor_combined",name:"棟別戶號樓層合併格式",regex:/^([A-Z])棟(\d+)-(\d+)[號号]?$/i,extract:(e,t)=>{let n=e[1],r=e[2],a=e[3];return t?.floor&&parseInt(a,10)===parseInt(t.floor,10)?n+r:n+r+a},confidence:100,priority:.02},{id:"building_unit_floorF_format_v2",name:"棟別戶號樓層F格式v2",regex:/^([A-Z])棟(\d+)-(\d+)F[號号]?$/i,extract:(e,t)=>{let n=e[1],r=e[2],a=e[3];return t?.floor&&parseInt(a,10)===parseInt(t.floor,10)?n+r:n+r+a},confidence:100,priority:.03},{id:"unit_building_zero_format",name:"戶號棟別0號格式",regex:/^([A-Z]\d+)棟0[號号]?$/i,extract:e=>e[1],confidence:100,priority:.04},{id:"single_letter_unit",name:"單字母戶號格式",regex:/^([A-Z])[號号]$/i,extract:e=>e[1],confidence:95,priority:.045},{id:"building_floor_unit_letter_format",name:"棟別樓層數字戶型字母格式",regex:/^([A-Z])棟(\d+)([A-Z])[號号]?$/i,extract:(e,t)=>{let n=e[1],r=parseInt(e[2],10),a=e[3];return t?.floor&&r===parseInt(t.floor,10)?a:`${n}${r}${a}`},confidence:99,priority:.05},{id:"building_floor_unit_format",name:"棟別樓層戶號格式",regex:/^([A-Z])棟(\d{1,2})F-(\d+)[號号]?$/,extract:(e,t)=>{let n=e[1],r=e[2],a=e[3];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?n+a:n+r+a},confidence:99,priority:.1},{id:"letter_number_floor_format",name:"字母數字-樓層F格式",regex:/^([A-Z])0*(\d+)-(\d{1,2})F[號号]?$/,extract:(e,t)=>{let n=e[1],r=e[2],a=e[3];return t?.floor&&parseInt(a,10)===parseInt(t.floor,10)?n+r:n+r+a},confidence:99,priority:.15},{id:"identifier_building_floor_redundant",name:"識別碼棟與F樓層格式(贅余樓層)",regex:/^([A-Z]\d+)棟F(\d+)[號号]?$/i,extract:(e,t)=>{let n=e[1],r=e[2],a=n.match(/^[A-Z]+/)?.[0]||"",i=parseInt(n.match(/\d+/)?.[0]||"0",10),s=`${a}${i}`;return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?s:s+"F"+r},confidence:98,priority:.18},{id:"identifier_building_floorF_format",name:"識別碼棟與樓層F格式(贅余樓層)",regex:/^([A-Z]\d+)棟(\d{1,2})F[號号]?$/i,extract:(e,t)=>{let n=e[1],r=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?n:n+r},confidence:98,priority:.19},{id:"unit_building_floor_format",name:"戶棟樓層格式",regex:/^([A-Z]\d+)戶棟(\d+)F[號号]?$/,extract:(e,t)=>{let n=e[1],r=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?n:n+r},confidence:99,priority:.2},{id:"building_sub_unit_floor_format",name:"棟別子戶號樓層格式",regex:/^([A-Z])棟(\d+)-(\d+)F[號号]?$/,extract:(e,t)=>{let n=e[1],r=e[2],a=e[3];return t?.floor&&parseInt(a,10)===parseInt(t.floor,10)?n+r:n+r+a},confidence:99,priority:.3},{id:"building_unit_floor_format",name:"棟別戶別樓層格式",regex:/^([A-Z])棟([A-Z])-(\d{1,2})F[號号]?$/,extract:(e,t)=>{let n=e[2],r=e[3];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?n:n+r},confidence:99,priority:.4},{id:"building_self_unit_floor_format",name:"棟別自身戶號樓層格式",regex:/^([A-Z])棟\1-(\d+)[號号]?$/,extract:(e,t)=>{let n=e[1],r=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?n:n+r},confidence:98,priority:.45},{id:"building_unit_letter_floor_number",name:"棟別戶號字母樓層數字格式",regex:/^([A-Z])棟([A-Z])(\d{1,2})[號号]?$/,extract:(e,t)=>{let n=e[2],r=e[3];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?n:n+r},confidence:98,priority:.46},{id:"redundant_building_format",name:"重複棟別格式",regex:/^([A-Z])棟\1-(\d{1,2})F[號号]?$/,extract:(e,t)=>{let n=e[1],r=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?n:n+r},confidence:98,priority:.5},{id:"building_floor_letter_unit",name:"棟別樓層字母戶號格式",regex:/^[A-Z]棟(\d{1,2})F-([A-Z])[號号]?$/,extract:(e,t)=>{let n=e[1],r=e[2];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?r:r+n},confidence:98,priority:.6},{id:"letter_leading_zero_unit",name:"字母與0開頭數字戶號",regex:/^([A-Z])0+(\d+)[號号]?$/,extract:e=>e[1]+e[2],confidence:97,priority:.7},{id:"floor_prefix_format",name:"樓層前綴格式",regex:/^(\d{1,2})([A-Z])[號号]?$/,extract:(e,t)=>{let n=e[1],r=e[2];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?r:n+r},confidence:96,priority:.8},{id:"floorF_building_unit_format",name:"樓層F棟戶號格式",regex:/^(\d{1,2})F棟([A-Z])[號号]?$/,extract:(e,t)=>{let n=e[1],r=e[2];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?r:n+r},confidence:98,priority:.85},{id:"numericBuilding_floor_unit_format",name:"數字棟別樓層戶號格式",regex:/^(\d+)棟(\d{1,2})([A-Z])[號号]?$/,extract:(e,t)=>{let n=e[2],r=e[3];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?r:n+r},confidence:98,priority:.86},{id:"floor_first_detailed",name:"樓層優先詳細格式",regex:/(\d{1,2})F-([A-Z])(\d{2})/,extract:e=>e[2]+e[3],confidence:95,priority:1},{id:"floor_prefix_complex_unit",name:"樓層前綴複合戶號",regex:/^(\d{1,2})F-([A-Z]\d+)[號号]?$/,extract:(e,t)=>{let n=e[1],r=e[2];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?r:n+r},confidence:94,priority:1.2},{id:"floor_first_simple_letter",name:"樓層優先簡單字母格式",regex:/^(\d{1,2})F-([A-Z])[號号]?$/,extract:(e,t)=>{let n=e[1],r=e[2];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?r:n+r},confidence:90,priority:1.5},{id:"building_with_unit",name:"棟別完整戶號",regex:/([A-Z])棟([A-Z])(\d{1,2})(?:-(\d{1,2})F?[號号])?/,extract:e=>e[2]+e[3],confidence:90,priority:2,conditions:[{type:"building_match",validator:e=>{let t=e.rawUnit.match(/([A-Z])棟([A-Z])/);return!!t&&t[1]===t[2]}}]},{id:"building_simple_letter_unit",name:"棟別字母戶號格式",regex:/^[A-Z]棟([A-Z])[號号]?$/,extract:e=>e[1],confidence:92,priority:2.5},{id:"unit_floor_suffix",name:"戶號樓層後綴",regex:/([A-Z]\d{1,2})-(\d{1,2})F?[號号]?/,extract:e=>e[1],confidence:85,priority:3},{id:"building_floor_format",name:"棟別樓層格式",regex:/^([A-Z]\d{1,2})棟(\d{1,2})(?:F|樓)[號号]?$/,extract:(e,t)=>{let n=e[1],r=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?n:n+r},confidence:88,priority:3.5},{id:"building_complex_number",name:"複合棟別編號",regex:/^([A-Z]\d+)棟(\d+)[號号]$/,extract:(e,t)=>{let n=e[1],r=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?n:n+r},confidence:86,priority:3.8},{id:"building_floor_F_format",name:"棟別樓層F格式",regex:/^([A-Z])棟(\d{1,2})F[號号]?$/,extract:(e,t)=>{let n=e[1],r=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?n:n+r},confidence:87,priority:3.9},{id:"building_zero_placeholder_unit",name:"棟別0號佔位符格式",regex:/^([A-Z])棟0[號号]?$/,extract:e=>e[1],confidence:95,priority:3.95},{id:"building_simple_number",name:"棟別簡單編號",regex:/([A-Z])棟(\d{1,2})[號号]/,extract:(e,t)=>{let n=e[1],r=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?n:n+r},confidence:85,priority:4},{id:"unit_floor_concatenated",name:"複合戶號樓層格式",regex:/^([A-Z])(\d+)F[號号]?$/,extract:(e,t)=>{let n=e[1],r=e[2],a=t?.floor;if(a){let e=parseInt(a,10);if(!isNaN(e)){if(e<10){let e="0"+a;if(r.endsWith(e))return n+r.substring(0,r.length-2)}if(r.endsWith(a))return n+r.substring(0,r.length-a.length)}}return n+r},confidence:80,priority:4.5},{id:"letter_floor",name:"字母樓層格式",regex:/^([A-Z])-(\d{1,2})F?[號号]?$/,extract:(e,t)=>{let n=e[2];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?e[1]:e[1]+n},confidence:70,priority:5}].forEach(e=>{this.knownPatterns.set(e.id,e)})}detectPattern(e,t){let n=this.normalizeText(e),r=null;for(let e of Array.from(this.knownPatterns.values()).sort((e,t)=>e.priority-t.priority)){let a=n.match(e.regex);if(a){if(e.conditions&&t&&!e.conditions.every(e=>e.validator(t)))continue;r={rule:e,match:a};break}}return r&&this.patternFrequency.set(r.rule.id,(this.patternFrequency.get(r.rule.id)||0)+1),r}normalizeText(e){return e?e.toUpperCase().replace(/[\uff01-\uff5e]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248)).replace(/\s+/g,""):""}}class ro{projectProfiles=new Map;analyzeProject(e,t){let n={projectName:e,patterns:new Map,unitMappings:new Map,namingStyle:"unknown"},r=new rl;for(let a of t){let t=a["戶別"],i=a["樓層"];if(!t)continue;let s={rawUnit:t,floor:i?String(i):void 0,projectName:e},l=r.detectPattern(t,s);if(l){let e=l.rule;n.patterns.has(e.id)||n.patterns.set(e.id,{patternId:e.id,count:0,examples:[],confidence:e.confidence});let r=n.patterns.get(e.id);r.count++,r.examples.length<10&&r.examples.push(t)}n.unitMappings.has(t)||n.unitMappings.set(t,{floors:new Set,rawVariations:new Set([t])});let o=n.unitMappings.get(t);i&&o.floors.add(String(i))}return this.determineNamingStyle(n),this.projectProfiles.set(e,n),n}determineNamingStyle(e){let t=e.patterns.size,n=Array.from(e.patterns.values()).reduce((e,t)=>e+t.count,0);if(0===t){e.namingStyle="unknown";return}let r=null,a=0;for(let t of e.patterns.values())t.count>a&&(a=t.count,r=t);r&&(e.dominantPattern=r.patternId,r.count/n>.8?e.namingStyle="consistent":e.namingStyle="mixed")}getProjectProfile(e){return this.projectProfiles.get(e)}isAmbiguousUnit(e,t){let n=this.projectProfiles.get(e);if(!n)return!1;let r=n.unitMappings.get(t);return!!r&&r.floors.size>1}}class rc{detector;customRules=new Map;constructor(e){this.detector=e,this.initializeCustomRules()}initializeCustomRules(){}applyRules(e){for(let[t,n]of this.customRules){let t=n(e);if(t)return t}let t=this.detector.detectPattern(e.rawUnit,e);if(t){let{rule:n,match:r}=t;return{identifier:n.extract(r,e),confidence:n.confidence,method:`pattern:${n.id}`}}return{identifier:this.simpleFallback(e.rawUnit),confidence:50,method:"fallback"}}simpleFallback(e){return e?e.toUpperCase().replace(/[\uff01-\uff5e]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248)).replace(/\s+/g,"").replace(/[棟樓F室號\-]/g,""):""}}class rd{detector;analyzer;ruleEngine;resolveCache=new Map;constructor(e){console.log("[AdaptiveUnitResolver] 初始化，處理",e.length,"筆資料"),this.detector=new rl,this.analyzer=new ro,this.ruleEngine=new rc(this.detector),this.buildKnowledgeBase(e)}buildKnowledgeBase(e){let t=new Map;for(let n of e){let e=n["建案名稱"];e&&(t.has(e)||t.set(e,[]),t.get(e).push(n))}for(let[e,n]of(console.log("[AdaptiveUnitResolver] 分析",t.size,"個建案"),t))this.analyzer.analyzeProject(e,n)}resolve(e){return this.resolveWithContext(e).identifier}resolveWithContext(e){let t=e["戶別"];t&&"string"==typeof t&&(t=t.trim());let n=e["樓層"],r=e["建案名稱"];if(!t)return{identifier:"",confidence:0,method:"no_input"};let a=`${r}|${t}|${n||""}`;if(this.resolveCache.has(a))return this.resolveCache.get(a);let i={rawUnit:t,floor:n?String(n):void 0,projectName:r},s=this.ruleEngine.applyRules(i);if(s)return this.resolveCache.set(a,s),s;let l={identifier:t,confidence:0,method:"fallback_null"};return this.resolveCache.set(a,l),l}}function ru({transactions:e,project:t}){let[n,r]=(0,m.useState)(""),[a,i]=(0,m.useState)(""),[s,l]=(0,m.useState)(null);return(0,x.jsxs)("div",{className:"flex flex-col sm:flex-row flex-wrap items-start sm:items-center gap-3 sm:gap-4 bg-zinc-900/30 p-4 rounded-lg border border-white/5",children:[(0,x.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 w-full sm:w-auto",children:[(0,x.jsx)("span",{className:"text-sm text-zinc-400 font-semibold whitespace-nowrap",children:"區間均價試算:"}),(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)(z.Input,{type:"number",placeholder:"起樓",className:"w-20 h-8 bg-zinc-950/50",value:n,onChange:e=>r(e.target.value)}),(0,x.jsx)("span",{className:"text-zinc-500",children:"~"}),(0,x.jsx)(z.Input,{type:"number",placeholder:"迄樓",className:"w-20 h-8 bg-zinc-950/50",value:a,onChange:e=>i(e.target.value)})]}),(0,x.jsx)(w.Button,{size:"sm",variant:"secondary",onClick:()=>{if(!t||!e)return;let r=parseInt(n),i=parseInt(a);if(isNaN(r)||isNaN(i)||r>i)return void l(null);let s=e.filter(e=>{if(e["建案名稱"]!==t)return!1;let n=parseInt(String(e["樓層"]));return!isNaN(n)&&n>=r&&n<=i});if(0===s.length)return void l({avg:0,count:0});let o=s.reduce((e,t)=>e+(t["房屋總價(萬)"]||0),0),c=s.reduce((e,t)=>e+(t["房屋面積(坪)"]||0),0);l({avg:c>0?o/c:0,count:s.length})},className:"h-8 ml-2",children:"計算"})]}),s&&(0,x.jsxs)("div",{className:"flex items-center gap-4 ml-4 animate-in fade-in",children:[(0,x.jsxs)("div",{className:"flex flex-col",children:[(0,x.jsx)("span",{className:"text-xs text-zinc-500",children:"平均單價 (加權)"}),(0,x.jsxs)("span",{className:"text-lg font-bold text-violet-400",children:[s.avg.toFixed(2)," 萬/坪"]})]}),(0,x.jsxs)("div",{className:"flex flex-col",children:[(0,x.jsx)("span",{className:"text-xs text-zinc-500",children:"參考筆數"}),(0,x.jsxs)("span",{className:"text-sm text-zinc-300",children:[s.count," 筆"]})]})]})]})}function rx({data:e}){let[t,n]=(0,m.useState)(""),[r,a]=(0,m.useState)(.3),[i,s]=(0,m.useState)(14);if((0,m.useEffect)(()=>{e?.priceGridAnalysis?.projectNames?.length&&!t&&n(e.priceGridAnalysis.projectNames[0])},[e,t]),!e?.priceGridAnalysis)return null;let{projectNames:l,byProject:o}=e.priceGridAnalysis,c=m.default.useMemo(()=>{if(!t||!e.transactionDetails)return null;let n=e.transactionDetails.filter(e=>e["建案名稱"]===t),{excludeCommercial:r}=f.useFilterStore.getState();return r&&(n=n.filter(e=>{let t=e["主要用途"]||"",n=e["建物型態"]||"",r=e["備註"]||"";return!(t.includes("商業")||n.includes("店")||r.includes("店")||t.includes("辦公")||n.includes("辦公")||n.includes("事務所"))})),n},[t,e.transactionDetails]),d=m.default.useMemo(()=>{if(!t)return null;if(c&&c.length>0)try{return function(e,t=.3,n=14){let r={},a=new Set,i=new Set,s=new rd(e);if(e.forEach(e=>{let t=e["樓層"]||e.floor||e.layer;if(null==t)return;"number"==typeof t&&(t=String(t)),"number"==typeof t&&(t=String(t));let n=s.resolve(e);a.add(t),i.add(n),r[t]||(r[t]={}),r[t][n]||(r[t][n]=[]);let l=parseFloat(e["房屋單價(萬)"]||e.unitPrice||0),o=parseFloat(e["交易總價(萬)"]||e.totalPrice||0),c=parseFloat(e["房屋總價(萬)"]||e.housePrice||0),d=parseFloat(e["車位總價(萬)"]||e.parkingPrice||0),u=parseFloat(e["房屋面積(坪)"]||e.houseArea||0),x=e["房數"]||e.rooms,m=e["車位類別"]||e.parkingType||"";"string"==typeof m&&m.includes("車位");let h=e["主要用途"]||e.mainPurpose||"",p=e["建物型態"]||e.buildingType||"",f=h.includes("商業")||p.includes("店")||h.includes("店"),g=h.includes("辦公")||p.includes("辦公")||p.includes("事務所"),b=e["交易日"]||e["交易年月日"]||e.transactionDate||"",v=b;if(b&&/^\d{6,7}$/.test(String(b))){let e=String(b),t=6===e.length?2:3;v=`${e.substring(0,t)}/${e.substring(t,t+2)}/${e.substring(t+2)}`}r[t][n].push({...e,unitPrice:l,floor:t,unit:n,transactionDate:v,isStorefront:f,isOffice:g,hasParking:d>0,tooltipInfo:{totalPrice:o,housePrice:c,parkingPrice:d,houseArea:u,rooms:x}})}),0===a.size)return{horizontalGrid:{},sortedFloors:[],sortedUnits:[],unitColorMap:{},summary:{totalBaselineHousePrice:0,totalPricePremiumValue:0,totalSoldArea:0,transactionCount:0},horizontalComparison:[]};let l=Array.from(a).sort((e,t)=>{let n=e=>e?e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e)||0:0;return n(t)-n(e)}),o=Array.from(i).sort(),c={},d=e=>{if(!e)return null;let t=e.replace(/\//g,"");if(t.length<6)return null;let n=6===t.length?2:3,r=parseInt(t.substring(0,n)),a=parseInt(t.substring(n,n+2));return new Date(1911+r,a-1,parseInt(t.substring(n+2)))},u={};e.forEach(e=>{let t=s.resolve(e),n=e["主要用途"]||e.mainPurpose||"",r=e["建物型態"]||e.buildingType||"",a=e["備註"]||e.note||"",i=n.includes("商業")||r.includes("店")||n.includes("辦公")||r.includes("辦公")||r.includes("事務所")||a.includes("特殊")||a.includes("親友")||a.includes("員工")||a.includes("關係人")||a.includes("毛胚"),l=parseFloat(e["房屋單價(萬)"]||e.unitPrice||0);!i&&l>0&&(u[t]||(u[t]=[]),u[t].push(e))}),Object.keys(u).forEach(e=>{let r=u[e];if(r.sort((e,t)=>(d(e["交易年月日"]||e.transactionDate)?.getTime()||0x9184e729fff)-(d(t["交易年月日"]||t.transactionDate)?.getTime()||0x9184e729fff)),0===r.length)return;let a=d(r[0]["交易年月日"]||r[0].transactionDate);if(!a){c[e]=r.reduce((e,t)=>parseFloat(t["房屋單價(萬)"])<parseFloat(e["房屋單價(萬)"])?t:e,r[0]);return}let i=new Date(a);i.setDate(i.getDate()+n);let s=r.filter(e=>{let t=d(e["交易年月日"]||e.transactionDate);return t&&t<=i}),l=s[0],o=1/0;s.forEach(e=>{let n,r=parseFloat(e["房屋單價(萬)"]||0)-((n=String(e["樓層"]))?n.startsWith("B")?-parseInt(n.substring(1)):parseInt(n):0)*t;r<o&&(o=r,l=e)}),c[e]=l});let x=0,m=0,h=0,p=0;Object.keys(r).forEach(e=>{Object.keys(r[e]).forEach(n=>{r[e][n].forEach((a,i)=>{let s=null,l=c[n];if(l){let e=e=>e?e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e):0,n=String(l["樓層"]),r=String(a.floor),i=e(n),o=e(r),c=parseFloat(l["房屋單價(萬)"]||l.unitPrice||0)+(o-i)*t;if(c>0&&(s=(a["房屋單價(萬)"]-c)/c*100,(a===l||.1>Math.abs(a["房屋單價(萬)"]-c))&&(s=0)),a.tooltipInfo.housePrice&&a.tooltipInfo.houseArea){let e=c*a.tooltipInfo.houseArea;x+=e,m+=a.tooltipInfo.housePrice-e,h+=a.tooltipInfo.houseArea,p++}}r[e][n][i].premium=s})})});let f={},g=["#f87171","#fb923c","#fbbf24","#a3e635","#34d399","#22d3ee","#818cf8","#c084fc","#f472b6"];o.forEach((e,t)=>{f[e]=g[t%g.length]});let b={};o.forEach(e=>{b[e]={totalPremium:0,totalSoldArea:0,count:0,anchorPrice:null,anchorFloor:null};let t=c[e];t&&(b[e].anchorPrice=parseFloat(t["房屋單價(萬)"]||0),b[e].anchorFloor=String(t["樓層"]))}),Object.keys(r).forEach(e=>{Object.keys(r[e]).forEach(n=>{r[e][n].forEach(e=>{let r=c[n];if(null!==e.premium&&e.tooltipInfo.housePrice&&e.tooltipInfo.houseArea&&r){let a=e=>e?e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e):0,i=a(String(r["樓層"])),s=a(e.floor),l=parseFloat(r["房屋單價(萬)"]||r.unitPrice||0)+(s-i)*t;if(l>0){let t=l*e.tooltipInfo.houseArea,r=e.tooltipInfo.housePrice-t;b[n]&&(b[n].totalPremium+=r,b[n].totalSoldArea+=e.tooltipInfo.houseArea,b[n].count++)}}})})});let v=Object.keys(b).map(e=>{let t=b[e];return 0===t.count?null:{unitType:e,anchorInfo:t.anchorPrice?`${t.anchorFloor}F / ${t.anchorPrice}萬`:"N/A",horizontalPriceDiff:t.totalSoldArea>0?t.totalPremium/t.totalSoldArea:0,unitsSold:t.count,timePremiumContribution:t.totalPremium,contributionPercentage:m>0?t.totalPremium/m*100:0,baselineHousePrice:x,avgPriceAdjustment:t.totalSoldArea>0?t.totalPremium/t.totalSoldArea:0}}).filter(Boolean);return{horizontalGrid:r,sortedFloors:l,sortedUnits:o,unitColorMap:f,summary:{totalBaselineHousePrice:x,totalPricePremiumValue:m,totalSoldArea:h,transactionCount:p},horizontalComparison:v}}(c,r,i)}catch(e){console.error("Heatmap generation error:",e)}return o[t]&&o[t].horizontalGrid?o[t]:null},[t,c,o,r,i]);return(0,x.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,x.jsxs)("div",{className:"flex flex-col lg:flex-row flex-wrap items-start lg:items-center gap-4 bg-zinc-900/30 p-4 rounded-lg border border-white/5",children:[(0,x.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 w-full lg:w-auto",children:[(0,x.jsx)("span",{className:"text-sm text-zinc-400 whitespace-nowrap",children:"選擇建案:"}),(0,x.jsx)(N,{value:t,onChange:e=>n(e.target.value),className:"w-full sm:w-[280px] bg-zinc-950/50",children:l.map(e=>(0,x.jsx)("option",{value:e,children:e},e))})]}),(0,x.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3 w-full lg:w-auto",children:[(0,x.jsx)("span",{className:"text-sm text-zinc-400 whitespace-nowrap",children:"樓層價差:"}),(0,x.jsxs)("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[(0,x.jsx)("input",{type:"range",min:0,max:10,step:.05,value:r,onChange:e=>a(Number(e.target.value)),className:"flex-1 sm:w-32 h-2 accent-violet-500 cursor-pointer",style:{minHeight:"24px"}}),(0,x.jsx)(z.Input,{type:"number",min:0,max:10,step:.01,value:r,onChange:e=>a(Math.max(0,Number(e.target.value))),className:"w-20 h-8 bg-zinc-950/50 text-right pr-2"}),(0,x.jsx)("span",{className:"text-sm font-mono text-violet-400 whitespace-nowrap",children:"萬/坪"}),(0,x.jsx)(w.Button,{variant:"ghost",size:"icon",onClick:()=>{if(!e.transactionDetails||!t)return;let n=function(e){if(!e||0===e.length)return .3;let t=new rd(e),n={};e.forEach(e=>{let r=t.resolve(e),a=e["主要用途"]||e.mainPurpose||"",i=e["建物型態"]||e.buildingType||"",s=e["備註"]||e.note||"";!(a.includes("商業")||i.includes("店")||a.includes("辦公")||i.includes("辦公")||i.includes("事務所")||s.includes("特殊")||s.includes("親友")||s.includes("員工")||s.includes("關係人")||s.includes("毛胚"))&&parseFloat(e["房屋單價(萬)"])>0&&(n[r]||(n[r]=[]),n[r].push(e))});let r=[];if(Object.values(n).forEach(e=>{let t=e=>e?e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e):0;e.sort((e,n)=>t(String(e["樓層"]))-t(String(n["樓層"])));for(let n=0;n<e.length-1;n++){let a=e[n],i=e[n+1],s=t(String(a["樓層"])),l=t(String(i["樓層"]))-s,o=parseFloat(i["房屋單價(萬)"])-parseFloat(a["房屋單價(萬)"]);if(l>0&&l<=3){let e=o/l;e>-2&&e<10&&r.push(e)}}}),0===r.length)return .5;r.sort((e,t)=>e-t);let a=Math.floor(r.length/2);return Math.max(0,Math.round(100*(r.length%2!=0?r[a]:(r[a-1]+r[a])/2))/100)}(e.transactionDetails.filter(e=>e["建案名稱"]===t));a(n),console.log("Auto suggested premium:",n)},className:"h-8 w-8 text-yellow-400 hover:text-yellow-300 hover:bg-yellow-400/10 ml-1",title:"自動試算建議價差",children:(0,x.jsx)(rs,{className:"h-4 w-4"})})]}),(0,x.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,x.jsx)("span",{className:"text-sm font-medium text-zinc-400",children:"基準天數:"}),(0,x.jsx)(z.Input,{type:"number",min:"1",max:"365",value:i,onChange:e=>s(Number(e.target.value)||14),className:"w-16 h-8 bg-zinc-950/50 text-right pr-2"}),(0,x.jsx)("span",{className:"text-sm font-mono text-violet-400 whitespace-nowrap",children:"天"})]})]})]}),t&&e.transactionDetails&&(0,x.jsx)(ru,{transactions:e.transactionDetails,project:t}),(0,x.jsxs)("div",{className:"flex flex-wrap gap-4 p-4 bg-zinc-900/20 rounded-lg border border-white/5",children:[(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)("span",{className:"text-xs text-zinc-500",children:"溢價圖例:"}),(0,x.jsxs)("span",{className:"flex items-center gap-1",children:[(0,x.jsx)("span",{className:"w-4 h-4 rounded bg-red-500/80"}),(0,x.jsx)("span",{className:"text-xs text-zinc-400",children:"> 5%"})]}),(0,x.jsxs)("span",{className:"flex items-center gap-1",children:[(0,x.jsx)("span",{className:"w-4 h-4 rounded bg-orange-500/80"}),(0,x.jsx)("span",{className:"text-xs text-zinc-400",children:"2-5%"})]}),(0,x.jsxs)("span",{className:"flex items-center gap-1",children:[(0,x.jsx)("span",{className:"w-4 h-4 rounded bg-yellow-500/80"}),(0,x.jsx)("span",{className:"text-xs text-zinc-400",children:"0-2%"})]}),(0,x.jsxs)("span",{className:"flex items-center gap-1",children:[(0,x.jsx)("span",{className:"w-4 h-4 rounded bg-green-500/80"}),(0,x.jsx)("span",{className:"text-xs text-zinc-400",children:"< 0%"})]})]}),(0,x.jsxs)("div",{className:"flex items-center gap-2 ml-auto",children:[(0,x.jsx)("span",{className:"text-xs text-zinc-500",children:"特殊交易:"}),(0,x.jsxs)("span",{className:"flex items-center gap-1",children:[(0,x.jsx)("span",{className:"w-4 h-4 rounded bg-amber-600"}),(0,x.jsx)("span",{className:"text-xs text-zinc-400",children:"店舖"})]}),(0,x.jsxs)("span",{className:"flex items-center gap-1",children:[(0,x.jsx)("span",{className:"w-4 h-4 rounded bg-blue-600"}),(0,x.jsx)("span",{className:"text-xs text-zinc-400",children:"辦公室"})]}),(0,x.jsxs)("span",{className:"flex items-center gap-1",children:[(0,x.jsx)("span",{className:"w-4 h-4 rounded bg-purple-600"}),(0,x.jsx)("span",{className:"text-xs text-zinc-400",children:"廠辦"})]})]})]}),(0,x.jsx)(D,{title:"建案銷控表與調價熱力圖",description:"可視化建案各戶別的銷售狀況與價格調整幅度",headerAction:(0,x.jsx)(nK,{data:c||[],filename:`heatmap_grid_${t}`,label:"匯出",chartType:"heatmap-grid",snapshotData:{projectData:d,floorPremium:r,selectedProject:t}}),children:d?(0,x.jsx)(ri.PricingHeatmap,{data:d,floorPremium:r,showSummary:!1,showComparison:!1}):(0,x.jsx)("div",{className:"text-zinc-500 text-center p-12",children:"請選擇建案以查看銷控表"})}),d?.summary&&(0,x.jsx)(D,{title:"調價幅度統計摘要 (排除店舖/辦公室)",headerAction:(0,x.jsx)(nK,{data:[d.summary],filename:`heatmap_stats_${t}`,label:"匯出",chartType:"heatmap-stats",snapshotData:{summary:d.summary,selectedProject:t}}),children:(0,x.jsx)(ri.PricingHeatmap,{data:d,showGrid:!1,showSummary:!0,showComparison:!1})}),d?.horizontalComparison&&d.horizontalComparison.length>0&&(0,x.jsx)(D,{title:"戶型水平價差與溢價貢獻",headerAction:(0,x.jsx)(nK,{data:d.horizontalComparison,filename:`heatmap_comparison_${t}`,label:"匯出",chartType:"heatmap-comparison",snapshotData:{horizontalComparison:d.horizontalComparison,selectedProject:t}}),children:(0,x.jsx)(ri.PricingHeatmap,{data:d,showGrid:!1,showSummary:!1,showComparison:!0})})]})}let rm=(0,k.default)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);var rh=e.i(67874);function rp({data:e,trigger:t}){let n=(0,f.useFilterStore)(),[r,a]=(0,m.useState)([]),[i,s]=(0,m.useState)(!1),[l,o]=(0,m.useState)(null),[c,d]=(0,m.useState)(1),[u,h]=(0,m.useState)(new Set),[p,v]=(0,m.useState)({key:"",direction:null}),[y,N]=(0,m.useState)(""),[w,z]=(0,m.useState)("建案名稱"),[k,_]=(0,m.useState)(!1),[S,C]=(0,m.useState)([]),[E,R]=(0,m.useState)(!1),[F,$]=(0,m.useState)(""),O=(0,m.useCallback)(async()=>{s(!0),o(null),a([]);try{let{counties:e,districts:t,transactionType:r,dateRange:i,startDate:l,endDate:o,projectNames:c,buildingType:d}=n;if(0===e.length)return void s(!1);let u=l,x=o;if("custom"!==i){let e=(0,A.getDateRangeDates)(i);e.startDate&&(u=e.startDate),e.endDate&&(x=e.endDate)}let m=e.map(async e=>{let n=P.COUNTY_CODE_MAP[e],a=P.DISTRICT_DATA[e]||[],i=t.filter(e=>a.includes(e)),s={countyCode:n,districts:i.length>0?i:void 0,type:r,dateStart:u,dateEnd:x,projectNames:c,buildingType:d};try{return await M.api.fetchData(s,{page:1,limit:1e3})}catch(t){return console.warn(`Fetch failed for ${e}`,t),{data:[],count:0}}}),h=await Promise.all(m),p=[];h.forEach(e=>{e&&Array.isArray(e.data)&&(p=[...p,...e.data])}),p.sort((e,t)=>{let n=e["交易日"]||"";return(t["交易日"]||"").localeCompare(n)}),a(p)}catch(e){console.error("Data List fetch failed:",e),o(e.message||"讀取交易資料失敗")}finally{s(!1)}},[n]);(0,m.useEffect)(()=>{t&&O()},[O,t]);let B=async e=>{if(!e.編號||!e.縣市代碼)return;let t=e["交易類型"]||n.transactionType;$(`車位/附表明細 - ${e["建案名稱"]||e["編號"]}`),R(!0),_(!0),C([]);try{let n=await M.api.fetchSubData(e.編號,t,e.縣市代碼),r=[];if(n.park&&Array.isArray(n.park)&&n.park.length>0&&(r=[...r,...n.park.map(e=>({...e,_category:"車位資料"}))]),n.build&&Array.isArray(n.build)&&n.build.length>0&&(r=[...r,...n.build.map(e=>({...e,_category:"建物明細"}))]),Array.isArray(n)&&0===r.length?r=[...r,...n]:n.data&&Array.isArray(n.data)&&0===r.length&&(r=[...r,...n.data]),0===r.length){let t=e["車位數"]&&Number(e["車位數"])>0,n=e["車位總價"]||e["車位總價(萬)"];if(t||n){let t=e["車位總價"]?Number(e["車位總價"]):e["車位總價(萬)"]?1e4*Number(e["車位總價(萬)"]):0,n=e["車位總面積"]?Number(e["車位總面積"]):e["車位面積"]?Number(e["車位面積"]):0;r.push({車位類別:e["車位類別"]||"無資料",車位價格:t,車位面積:n,車位樓層:"-","車位價格(萬)":e["車位總價(萬)"]||t/1e4,"車位面積(坪)":e["車位面積(坪)"]||(n/3.30579).toFixed(2),編號:e["編號"],_category:"車位資料(來自交易明細)"})}}C(r)}catch(t){if(console.error(t),e["車位數"]&&Number(e["車位數"])>0){let t=e["車位總價"]?Number(e["車位總價"]):e["車位總價(萬)"]?1e4*Number(e["車位總價(萬)"]):0;C([{車位類別:e["車位類別"]||"無資料",車位價格:t,車位面積:e["車位總面積"]||0,編號:e["編號"],_category:"車位資料(來自交易明細)"}])}else C([])}finally{R(!1)}},H=[{key:"行政區",label:"行政區",sortable:!0},{key:"建案名稱",label:"建案名稱",sortable:!0},{key:"交易日",label:"交易日",sortable:!0},{key:"交易筆棟數",label:"交易筆棟數",sortable:!1},{key:"主要用途",label:"主要用途",sortable:!1},{key:"建物型態",label:"建物型態",sortable:!1},{key:"戶型",label:"戶型",sortable:!0},{key:"樓層",label:"樓層",sortable:!0},{key:"房屋面積(坪)",label:"坪數",sortable:!0},{key:"房屋單價(萬)",label:"單價",sortable:!0}],K=["編號","地址","總樓層","交易總價(萬)","房屋總價(萬)","車位總價(萬)","房數","廳數","衛浴數","備註","解約情形","戶別","主要用途","建物型態","車位類別","車位價格","車位面積","主建物面積","附屬建物面積","陽台面積"],Z=e=>null==e||""===e?"-":"number"==typeof e?Number.isInteger(e)?e.toLocaleString():e.toFixed(2):String(e),q=(0,m.useMemo)(()=>{let e=[...r];if(y.trim()){let t=y.toLowerCase();e=e.filter(e=>{let n=e[w];return null!=n&&String(n).toLowerCase().includes(t)})}return p.key&&p.direction&&e.sort((e,t)=>{let n=e[p.key],r=t[p.key];if(null==n&&null==r)return 0;if(null==n)return 1;if(null==r)return -1;if("number"==typeof n&&"number"==typeof r)return"asc"===p.direction?n-r:r-n;let a=String(n),i=String(r);return"asc"===p.direction?a.localeCompare(i,"zh-TW"):i.localeCompare(a,"zh-TW")}),e},[r,y,w,p]),U=Math.ceil(q.length/20),W=(c-1)*20,G=W+20,X=q.slice(W,G);return i?(0,x.jsxs)("div",{className:"flex flex-col items-center justify-center py-20",children:[(0,x.jsx)(V.Loader2,{className:"h-8 w-8 animate-spin text-violet-500 mb-2"}),(0,x.jsx)("p",{className:"text-zinc-500 text-sm",children:"正在載入交易資料相關明細..."})]}):l?(0,x.jsxs)("div",{className:"text-center p-12 text-red-400",children:[(0,x.jsxs)("p",{children:["載入失敗: ",l]}),(0,x.jsx)("button",{onClick:()=>O(),className:"mt-4 px-4 py-2 bg-zinc-800 rounded hover:bg-zinc-700",children:"重試"})]}):r&&0!==r.length?(0,x.jsxs)("div",{className:"space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,x.jsxs)("div",{className:"flex flex-wrap gap-3 items-center p-3 bg-zinc-900/50 rounded-lg border border-white/5",children:[(0,x.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-[200px]",children:[(0,x.jsx)(n2.Search,{size:16,className:"text-zinc-500"}),(0,x.jsx)("input",{type:"text",value:y,onChange:e=>{N(e.target.value),d(1)},placeholder:`搜尋 ${w}...`,className:"flex-1 bg-transparent border-none outline-none text-white placeholder-zinc-500 text-sm"}),y&&(0,x.jsx)("button",{onClick:()=>N(""),className:"text-zinc-500 hover:text-white",children:(0,x.jsx)(b.X,{size:14})})]}),(0,x.jsxs)("select",{value:w,onChange:e=>z(e.target.value),className:"bg-zinc-800 border border-zinc-700 rounded px-2 py-1 text-sm text-zinc-300",children:[(0,x.jsx)("option",{value:"建案名稱",children:"建案名稱"}),(0,x.jsx)("option",{value:"行政區",children:"行政區"}),(0,x.jsx)("option",{value:"戶型",children:"戶型"}),(0,x.jsx)("option",{value:"主要用途",children:"主要用途"})]})]}),(0,x.jsxs)("div",{className:"flex justify-between items-center text-sm text-zinc-400",children:[(0,x.jsxs)("span",{children:["共 ",(0,x.jsx)("span",{className:"text-white font-semibold",children:q.length.toLocaleString()})," 筆資料 ",y&&(0,x.jsx)("span",{className:"text-zinc-500",children:"(已篩選)"})]}),(0,x.jsxs)("span",{children:["第 ",c," / ",U||1," 頁"]})]}),(0,x.jsx)(D,{title:"交易資料明細",description:"點擊表頭可排序，點擊「明細」可展開詳細資訊",headerAction:(0,x.jsx)(nK,{data:q,filename:"transaction_list_data",label:"匯出",chartType:"data-list"}),children:(0,x.jsx)("div",{className:"overflow-x-auto",children:(0,x.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,x.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold sticky top-0",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"px-3 py-3 w-28 text-center",children:"操作"}),H.map(e=>{var t;return(0,x.jsx)("th",{className:(0,g.cn)("px-3 py-3 whitespace-nowrap",e.sortable&&"cursor-pointer select-none group hover:text-white transition-colors"),onClick:()=>{var t;return e.sortable&&(t=e.key,void(v(e=>{if(e.key===t){if("asc"===e.direction)return{key:t,direction:"desc"};if("desc"===e.direction)return{key:"",direction:null}}return{key:t,direction:"asc"}}),d(1)))},children:(0,x.jsxs)("div",{className:"flex items-center gap-1",children:[e.label,e.sortable&&(t=e.key,p.key!==t?(0,x.jsx)(L,{size:12,className:"opacity-30 group-hover:opacity-70"}):"asc"===p.direction?(0,x.jsx)(rm,{size:12,className:"text-violet-400"}):(0,x.jsx)(j.ChevronDown,{size:12,className:"text-violet-400"}))]})},e.key)})]})}),(0,x.jsxs)("tbody",{className:"divide-y divide-white/5",children:[X.map((e,t)=>{let n=W+t,r=u.has(n);return(0,x.jsxs)(m.default.Fragment,{children:[(0,x.jsxs)("tr",{className:(0,g.cn)("hover:bg-zinc-800/50 transition-colors",r&&"bg-zinc-800/30"),children:[(0,x.jsx)("td",{className:"px-3 py-2",children:(0,x.jsxs)("div",{className:"flex items-center gap-2 justify-center",children:[(0,x.jsxs)("button",{onClick:()=>B(e),className:"px-2 py-1 rounded text-xs font-medium bg-cyan-900/30 text-cyan-400 hover:bg-cyan-900/50 hover:text-cyan-300 transition-colors flex items-center gap-1 border border-cyan-800/50",title:"查看車位或其他附表資料",children:[(0,x.jsx)(rh.Table2,{size:12}),"附表"]}),(0,x.jsxs)("button",{onClick:()=>{h(e=>{let t=new Set(e);return t.has(n)?t.delete(n):t.add(n),t})},className:(0,g.cn)("flex items-center gap-1 px-2 py-1 rounded text-xs font-medium transition-colors border",r?"bg-violet-500/20 text-violet-300 border-violet-500/30":"bg-zinc-800 text-zinc-400 border-zinc-700 hover:bg-zinc-700 hover:text-zinc-200"),children:[r?(0,x.jsx)(rm,{size:12}):(0,x.jsx)(j.ChevronDown,{size:12}),"明細"]})]})}),H.map(t=>(0,x.jsx)("td",{className:"px-3 py-2 whitespace-nowrap",children:"戶型"===t.key?(0,x.jsx)("span",{className:"cursor-help border-b border-dotted border-zinc-600",title:`原始戶別: ${e["戶別"]||"無資料"}`,children:Z(e[t.key])}):(0,x.jsx)("span",{className:(0,g.cn)("房屋單價(萬)"===t.key&&"font-mono text-violet-400","建案名稱"===t.key&&"font-medium text-white"),children:Z(e[t.key])})},t.key))]}),r&&(0,x.jsx)("tr",{className:"bg-zinc-900/50",children:(0,x.jsx)("td",{colSpan:H.length+1,className:"px-4 py-4",children:(0,x.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3",children:K.map(t=>t in e?(0,x.jsxs)("div",{className:"bg-zinc-800/50 rounded p-2",children:[(0,x.jsx)("div",{className:"text-xs text-zinc-500 mb-1",children:t}),(0,x.jsx)("div",{className:"text-sm text-zinc-200 font-mono",children:Z(e[t])})]},t):null)})})})]},n)}),0===X.length&&(0,x.jsx)("tr",{children:(0,x.jsx)("td",{colSpan:H.length+1,className:"text-center py-8 text-zinc-500",children:"無符合條件的資料"})})]})]})})}),(0,x.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t border-white/5",children:[(0,x.jsxs)("div",{className:"text-sm text-zinc-500",children:["顯示第 ",q.length>0?W+1:0," - ",Math.min(G,q.length)," 筆"]}),(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)("button",{onClick:()=>d(e=>Math.max(1,e-1)),disabled:1===c,className:"p-2 rounded bg-zinc-800 text-zinc-300 hover:bg-zinc-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,x.jsx)(T.ChevronLeft,{size:16})}),(0,x.jsx)("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,U||1)},(e,t)=>{let n,r=U||1;return(n=r<=5||c<=3?t+1:c>=r-2?r-4+t:c-2+t)<1||n>r?null:(0,x.jsx)("button",{onClick:()=>d(n),className:(0,g.cn)("w-8 h-8 rounded text-sm font-medium transition-colors",c===n?"bg-violet-500 text-white":"bg-zinc-800 text-zinc-400 hover:bg-zinc-700"),children:n},n)})}),(0,x.jsx)("button",{onClick:()=>d(e=>Math.min(U||1,e+1)),disabled:c===U||0===U,className:"p-2 rounded bg-zinc-800 text-zinc-300 hover:bg-zinc-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,x.jsx)(I.ChevronRight,{size:16})})]})]}),(0,x.jsx)(n8,{isOpen:k,onClose:()=>_(!1),className:"max-w-5xl",title:(0,x.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)(rh.Table2,{className:"text-cyan-400"}),(0,x.jsx)("span",{children:F})]}),(0,x.jsx)(nK,{data:S,filename:`sub_table_${F}`,label:"匯出附表",className:"ml-4"})]}),children:E?(0,x.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,x.jsx)(V.Loader2,{className:"h-8 w-8 animate-spin text-cyan-400 mb-3"}),(0,x.jsx)("p",{className:"text-zinc-500 text-sm animate-pulse",children:"正在讀取附表資料..."})]}):S.length>0?(0,x.jsxs)("div",{className:"space-y-4",children:[(0,x.jsx)("div",{className:"bg-zinc-800/30 rounded-lg overflow-hidden border border-white/5",children:(0,x.jsx)("div",{className:"overflow-x-auto",children:(0,x.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,x.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold",children:(0,x.jsxs)("tr",{children:[(0,x.jsx)("th",{className:"px-4 py-3 whitespace-nowrap bg-zinc-900 text-cyan-400",children:"類別"}),Object.keys(S[0]).filter(e=>"id"!==e&&"編號"!==e&&"created_at"!==e&&"_category"!==e&&"車位價格"!==e&&"車位面積"!==e).map(e=>(0,x.jsx)("th",{className:"px-4 py-3 whitespace-nowrap bg-zinc-900",children:e},e))]})}),(0,x.jsx)("tbody",{className:"divide-y divide-white/5",children:S.map((e,t)=>(0,x.jsxs)("tr",{className:"hover:bg-zinc-800/50 transition-colors",children:[(0,x.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-cyan-400 font-medium",children:e._category||"附表"}),Object.keys(e).filter(e=>"id"!==e&&"編號"!==e&&"created_at"!==e&&"_category"!==e&&"車位價格"!==e&&"車位面積"!==e).map(t=>(0,x.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-zinc-300",children:Z(e[t])},t))]},t))})]})})}),(0,x.jsx)("div",{className:"flex justify-end",children:(0,x.jsx)("button",{onClick:()=>_(!1),className:"px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-sm text-white rounded transition-colors",children:"關閉"})})]}):(0,x.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-zinc-500",children:[(0,x.jsx)("div",{className:"bg-zinc-800/50 p-4 rounded-full mb-3",children:(0,x.jsx)(rh.Table2,{size:24,className:"opacity-20"})}),(0,x.jsx)("p",{children:"此筆交易沒有相關附表資料"})]})})]}):(0,x.jsx)("div",{className:"text-center p-12 text-zinc-500",children:"無交易資料可顯示"})}let rf=(0,e.i(42806).cva)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function rg({className:e,variant:t,...n}){return(0,x.jsx)("div",{className:(0,g.cn)(rf({variant:t}),e),...n})}let rb=[{id:"p-2012-08-01",date:"2012-08-01",title:"實價登錄 1.0 上路",category:"policy",impact:"high",description:"交易後30日內申報，區段化揭露(30號區間)，預售屋採代銷結案後整批申報。",change_content:"交易資訊不透明 -> 區段化揭露",affected_scope:"房仲業者、買賣雙方、預售屋投機客",background:"低利環境延續：國內房貸利率處於低檔 (約1.8%-1.9%)。",impact_analysis:"[受益] 買方獲得參考依據。[適應] 房仲失去資訊壟斷優勢。[無感] 預售屋投機客因資訊未即時揭露，仍可操作紅單。",details:["申報義務人：地政士、經紀業或權利人。","申報時機：買賣案件於辦竣所有權移轉登記後30日內申報。","揭露方式：以區段化、去識別化方式提供查詢 (例如：中正路1-30號)。","預售屋規定：委託代銷者，於委託代銷契約屆滿或終止30日內「整批」申報 (資訊落後嚴重)。"]},{id:"p-2014-06-04",date:"2014-06-04",title:"囤房稅 1.0",category:"policy",impact:"medium",description:"非自住住家用稅率由1.2%-2%調高為1.5%-3.6%，授權地方政府自訂差別稅率。",change_content:"非自住稅率 1.2% -> 1.5%~3.6%",affected_scope:"多屋族、台北市置產客",background:"美國聯準會結束QE：預期升息心理浮現，全球資金派對暫歇。",impact_analysis:"[微痛] 持有成本上升，但因多數縣市未採最高稅率，且稅基(房屋評定現值)偏低，實質痛感有限。",details:["自住房屋稅率：維持 1.2% (需本人、配偶或直系親屬實際居住，且全國合計3戶以內)。","非自住房屋稅率：由 1.2%~2% 調升至 1.5%~3.6%。","地方權限：各地方政府可視地方發展需要，在範圍內自訂差別稅率。","持有認定：以個人(自然人)或法人(公司)為單位個別計算。"]},{id:"p-2016-01-01",date:"2016-01-01",title:"房地合一稅 1.0",category:"policy",impact:"high",description:"獲利課稅取代舊制。持有<1年45%，1-2年35%，自用滿6年獲利400萬免稅。奢侈稅同步停徵。",change_content:"按售價課稅(奢侈稅) -> 按獲利課稅(45%~15%)",affected_scope:"短線炒作客、自住客",background:"奢侈稅同步停徵：象徵房市進入「實價課稅」新紀元。",impact_analysis:"[毀滅] 短進短出獲利被腰斬，投資客大量退場。[受益] 房價盤整，自住客獲得較佳議價空間。",details:["課稅基礎：房地交易所得 = 交易成交價額 - 原始取得成本 - 相關費用 - 土地漲價總數額。","持有1年以內：稅率 45%。","持有1-2年：稅率 35%。","持有2-10年：稅率 20%。","持有超過10年：稅率 15%。","自用住宅優惠：獲利400萬元以下免稅，超過部分10%。(需連續設籍滿6年)","日出條款：2016年1月1日以後取得之房地適用新制。"]},{id:"f-2016-03-24",date:"2016-03-24",title:"央行大幅鬆綁信用管制",category:"finance",impact:"high",description:"刪除特定地區管制與自然人第3戶以上限制，僅保留豪宅管制(6成)。",change_content:"刪除多數管制，僅保留豪宅限貸",affected_scope:"換屋族、一般投資客",background:"經濟成長疲弱：為提振內需經濟，央行解除長達6年的房市管制。",impact_analysis:"[受益] 貸款成數恢復，換屋與置產門檻降低，市場交易量逐漸回溫。",details:["解除管制區域：台北市及新北市特定地區。","解除限制對象：自然人第3戶以上購屋貸款、公司法人購屋貸款。","保留限制：高價住宅(豪宅)貸款最高成數仍維持6成。"]},{id:"p-2018-06-27",date:"2018-06-27",title:"租賃住宅市場發展及管理條例",category:"policy",impact:"low",description:"建立包租代管機制，鼓勵房東釋出空屋，給予稅賦優惠(所得稅減免)。",change_content:"包租代管稅賦優惠",affected_scope:"房東、租屋族",background:"美中貿易戰開打：全球供應鏈重組，資金開始撤離中國。",impact_analysis:"[受益] 房東享有所得稅減免；租屋族獲得專業代管服務，租賃關係較有保障。",details:["租稅優惠：個人房東委託包租代管，月租金6000元以下免稅；6000-20000元必要費用率53%。","專業證照：建立租賃住宅管理人員證照制度。","糾紛處理：建立租賃糾紛免費調處機制。"]},{id:"f-2019-08-15",date:"2019-08-15",title:"境外資金匯回專法",category:"finance",impact:"medium",description:"鼓勵台商資金回流享優惠稅率，禁止直接投資房地產，但產生外溢效應帶動豪宅與工業地產。",change_content:"資金專法回流 (禁入房市但有外溢)",affected_scope:"工業地產主、豪宅建商",background:"台商回流潮：史上最大規模資金回台，雖禁入房市，但產生外溢效應。",impact_analysis:"[暴富] 工業用地與廠房價格飆漲。[受益] 企業主獲利與分紅轉入豪宅市場，帶動高總價產品去化。",details:["優惠稅率：第一年匯回稅率8%，第二年10%。(實質投資可退稅一半)","投資限制：禁止資金直接投資房地產(避免炒房)。","資金控管：資金需存入專戶，控管5-7年才能分批提取。","外溢效應：雖然不能直接買房，但增加市場資金總量，且企業獲利後的分紅仍可自由運用。"]},{id:"f-2020-03-19",date:"2020-03-19",title:"央行降息 1 碼",category:"finance",impact:"high",description:"重貼現率降至1.125%，房貸利率跌破1.4%歷史新低，無限QE背景下引發資產通膨。",change_content:"重貼現率 1.375% -> 1.125%",affected_scope:"全體購屋族、股市投資人",background:"COVID-19 疫情爆發：美國聯準會無限QE，全球熱錢氾濫。",impact_analysis:"[刺激] 持有成本極低，「租不如買」與「買房抗通膨」心理大爆發，股房雙漲。",details:["降息幅度：調降重貼現率 0.25個百分點。","房貸利率：五大銀行新承做房貸利率跌破 1.4%，創歷史新低。","配套補貼：針對受疫情影響產業及自用住宅貸款提供額外補貼。"]},{id:"f-2020-12-08",date:"2020-12-08",title:"央行信用管制 (第一波)",category:"finance",impact:"medium",description:"法人購屋限貸6成，自然人第3戶限貸6成，建商餘屋限貸5成。",change_content:"法人/第3戶/餘屋 限貸 5-6成",affected_scope:"公司法人、多屋族(3戶+)",background:"房市過熱跡象：紅單炒作猖獗，排隊買房現象頻傳。",impact_analysis:"[警示] 宣示政府打炒房決心，但因低利環境，實質殺傷力有限。",details:["公司法人：第一戶貸款成數最高 6成，無寬限期。","自然人第3戶(含)以上：貸款成數最高 6成，無寬限期。","購地貸款：限貸 6.5成，需保留 1成動工款。","餘屋貸款：限貸 5成。"]},{id:"f-2021-03-19",date:"2021-03-19",title:"央行信用管制 (第二波)",category:"finance",impact:"medium",description:"法人購屋成數降至4成，豪宅降至5.5成。",change_content:"法人限貸 4成；豪宅限貸 5.5成",affected_scope:"公司法人、豪宅客",background:"投機風氣未減",impact_analysis:"[打擊] 封鎖利用公司名義高槓桿炒房的途徑。",details:["公司法人：貸款成數調降至 4成。","自然人高價住宅：第1戶限貸 5.5成，第3戶以上限貸 4成。","工業區閒置土地：貸款最高 5.5成。"]},{id:"p-2021-07-01",date:"2021-07-01",title:"實價登錄 2.0 & 房地合一 2.0",category:"policy",impact:"high",description:"門牌完整揭露，預售屋即時申報(30日)，禁止紅單轉售；重稅期延長(45%改2年, 35%改5年)，預售屋納稅。",change_content:"預售屋納管、重稅閉鎖期延長、禁紅單",affected_scope:"預售屋買方/投機客、建商、換屋族",background:"房市多頭確立；疫情三級警戒(內需停滯但房市創高)",impact_analysis:"[雙面刃] 資訊全透明反成定錨工具。[閉鎖] 投機客無法短進短出，成屋惜售供給減少，價格難跌。",details:["實價登錄2.0：門牌號碼完整揭露 (不再區段化)。","預售屋納管：銷售前需備查，簽約後30日內申報實價登錄。","紅單禁止：禁止預售屋紅單轉售。","房地合一2.0：預售屋獲利納入房地合一稅課徵。","延長重稅期：持有2年內45%，2-5年35% (原為1-2年)。","法人比照：法人交易比照自然人稅率 (防堵公司名義短期炒作)。"]},{id:"f-2021-09-24",date:"2021-09-24",title:"央行信用管制 (第三波)",category:"finance",impact:"medium",description:"特定地區 (六都+新竹) 第2戶取消寬限期。",change_content:"特定地區第2戶 取消寬限期",affected_scope:"投資客、換屋族",background:"房價持續攀升",impact_analysis:"[壓力] 買第2間房必須立刻還本金，增加現金流壓力，迫使部分槓桿過大者退場。",details:["管制區域：新增特定地區 (六都 + 新竹縣市)。","自然人第2戶：取消寬限期 (需本息攤還)。","購地貸款：調降至 6成。","工業區閒置土地：調降至 5成。"]},{id:"f-2021-12-17",date:"2021-12-17",title:"央行信用管制 (第四波)",category:"finance",impact:"medium",description:"豪宅貸款降至4成，第3戶降至4成，餘屋貸款降至4成。",change_content:"豪宅/第3戶/餘屋 限貸 4成",affected_scope:"建商、豪宅客",background:"營建成本飆漲：缺工缺料議題發酵。",impact_analysis:"[緊縮] 建商資金鏈趨緊，中小型建商生存困難，市場走向大者恆大。",details:["自然人高價住宅：貸款成數一律降至 4成 (無寬限期)。","自然人第3戶(含)以上：貸款成數一律降至 4成。","購地貸款：降至 5成。","餘屋貸款：降至 4成。"]},{id:"f-2022-03-17",date:"2022-03-17",title:"央行升息循環啟動",category:"finance",impact:"medium",description:"央行跟進Fed升息(全年共2.5碼)，房貸利率重回2%以上。",change_content:"升息 2.5碼 (利率重回 2% table+)",affected_scope:"房貸族",background:"全球通膨危機：美國暴力升息，全球股市修正。",impact_analysis:"[負擔增加] 每千萬房貸每年利息支出增加約3-4萬元，稍微冷卻追價意願。",details:["2022-03：升息 1碼 (0.25%)。","2022-06：升息 半碼 (0.125%)。","2022-09：升息 半碼 (0.125%)。","2022-12：升息 半碼 (0.125%)。","存款準備率：同步調升，緊縮市場游資。"]},{id:"f-2023-06-16",date:"2023-06-16",title:"央行信用管制 (第五波)",category:"finance",impact:"medium",description:"特定地區第2戶限貸成數上限 7成。",change_content:"特定地區第2戶 限貸 7成",affected_scope:"換屋族、投資客",background:"房市量縮價穩：市場觀望平均地權條例上路。",impact_analysis:"[微痛] 需多準備1成自備款，影響尚可控。",details:["管制區域：特定地區 (六都 + 新竹縣市)。","自然人第2戶：新增貸款成數上限 7成 (此前僅無寬限期)。"]},{id:"p-2023-07-01",date:"2023-07-01",title:"平均地權條例修正",category:"policy",impact:"high",description:"預售屋禁止換約轉售，建立檢舉獎金，私法人購屋許可制。",change_content:"預售屋禁換約、私法人許可制",affected_scope:"預售屋黃牛、豪宅法人",background:"投機客的大限",impact_analysis:"[滅絕] 純粹賺價差的紅單與換約客徹底消失。豪宅市場因法人需經許可，交易量急凍。",details:["限制換約轉售：預售屋與新建成屋簽約後，除配偶、直系或二親等旁系外，不得讓與或轉售 (禁止黃牛)。","重罰炒作：嚴懲散播不實資訊影響房價，最高罰5000萬元。","檢舉獎金：建立檢舉實名制，獎金為罰鍰 30%。","私法人購屋許可制：私法人購買住宅用房屋需經內政部許可 (限制豪宅私法人節稅管道)。"]},{id:"p-2023-08-01",date:"2023-08-01",title:"新青安貸款專案",category:"policy",impact:"high",description:"額度1000萬，年限40年，寬限期5年，利率補貼(1.775%起)。",change_content:"40年期/5年寬限/降息補貼",affected_scope:"首購族、投機客(人頭)、低總價屋主",background:"總統大選前夕：政府釋出利多，試圖減輕年輕人負擔。",impact_analysis:"[狂熱] 創造「租不如買」與「5年免還本」的套利空間。低總價成屋被掃貨，房價逆勢暴漲。",details:["貸款額度：提高至 1000萬元。","利息補貼：政府補貼 1.5碼 (0.375%) + 公股銀行減半碼 = 利率 1.775% 起。","貸款年限：延長至 40年。","寬限期：延長至 5年 (只繳息不還本)。","資格：本人、配偶及未成年子女名下均無自有住宅。"]},{id:"f-2024-06-14",date:"2024-06-14",title:"央行信用管制 (第六波)",category:"finance",impact:"medium",description:"特定地區第2戶限貸成數降至 6成。",change_content:"特定地區第2戶 限貸 6成",affected_scope:"換屋族、置產客",background:"台股站上2萬點：AI熱潮帶動股市財富效應，資金外溢至房市。",impact_analysis:"[無效] 股市獲利豐厚，6成限貸無法阻擋資金湧入房市。",details:["管制區域：特定地區 (六都 + 新竹縣市)。","自然人第2戶：貸款成數上限由 7成調降為 6成。","調升存款準備率：調升 0.25個百分點 (收回市場資金)。"]},{id:"p-2024-07-01",date:"2024-07-01",title:"囤房稅 2.0 實施",category:"policy",impact:"medium",description:"全國歸戶，非自用稅率調高至 2.0%-4.8%，建商餘屋依持有年限課稅。",change_content:"全國歸戶；稅率 2.0%~4.8%",affected_scope:"多屋族、租屋族、建商",background:"租金指數創高",impact_analysis:"[轉嫁] 多屋族將稅負轉嫁至租金，導致租金上漲。建商面臨餘屋去化壓力，傾向預售完銷。",details:["全國歸戶：由縣市歸戶改為全國歸戶計算戶數。","稅率調升：非自住住家用稅率調升為 2%~4.8% (原1.5%~3.6%)。","單一自住優惠：全國單一自住(本人配偶子女僅一戶)且房屋現值在一定金額以下，稅率降至 1%。","建商餘屋：持有2年以內稅率 2%~3.6%；超過2年稅率 2%~4.8% (鼓勵釋出餘屋)。"]},{id:"f-2024-08-01",date:"2024-08-01",title:"銀行限貸令 (72-2水位)",category:"finance",impact:"high",description:"銀行法72-2條逼近30%上限，自主限貸、排隊撥款，市場流動性急凍。",change_content:"銀行自主限貸、排隊撥款",affected_scope:"即將交屋族、賣屋換屋族",background:"新青安效應發酵：過多成屋交易與新青安撥款，耗盡銀行額度。",impact_analysis:"[恐慌] 買了房卻貸不到款，面臨違約風險。市場流動性瞬間急凍。",details:["銀行法72-2條：商業銀行辦理住宅建築及企業建築放款總額，不得超過存款總餘額及金融債券發售額之 30%。","現象：多家銀行房貸水位接近滿載。","影響：銀行暫停收件、排隊撥款(需等數月)、利率大幅調升(2.6%-3%以上)。"]},{id:"f-2024-09-20",date:"2024-09-20",title:"央行信用管制 (第七波)",category:"finance",impact:"high",description:"有房者第1戶無寬限期；全國第2戶限貸5成；法人/豪宅/第3戶限貸3成。",change_content:"有房者第1戶無寬限；第2戶全國限貸5成",affected_scope:"換屋族、繼承族、交屋族",background:"金龍海嘯：央行判定房市過熱，認為新青安助長投機，決心斷絕金流。",impact_analysis:"[重傷/錯殺] 史上最嚴厲管制。1. 換屋族需5成自備。2. 繼承祖產失寬限。3. 預售交屋斷頭風險大增。",details:["自然人第1戶：名下有房屋者(含繼承、持分)，第1戶購屋貸款「無寬限期」。","自然人第2戶：貸款成數上限降至 5成，且擴及「全國」。","自然人第3戶以上：貸款成數上限降至 3成。","公司法人：購屋貸款成數降至 3成。","豪宅(高價住宅)：貸款成數降至 3成。","餘屋貸款：降至 3成。","存款準備率：再調升 0.25個百分點。"]}];var rv=e.i(80467);let ry=(0,k.default)("gavel",[["path",{d:"m14 13-8.381 8.38a1 1 0 0 1-3.001-3l8.384-8.381",key:"pgg06f"}],["path",{d:"m16 16 6-6",key:"vzrcl6"}],["path",{d:"m21.5 10.5-8-8",key:"a17d9x"}],["path",{d:"m8 8 6-6",key:"18bi4p"}],["path",{d:"m8.5 7.5 8 8",key:"1oyaui"}]]),rj=(0,k.default)("landmark",[["path",{d:"M10 18v-7",key:"wt116b"}],["path",{d:"M11.12 2.198a2 2 0 0 1 1.76.006l7.866 3.847c.476.233.31.949-.22.949H3.474c-.53 0-.695-.716-.22-.949z",key:"1m329m"}],["path",{d:"M14 18v-7",key:"vav6t3"}],["path",{d:"M18 18v-7",key:"aexdmj"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M6 18v-7",key:"1ivflk"}]]);var rN=e.i(53402);let rw=(0,k.default)("zoom-in",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),rz=(0,k.default)("zoom-out",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);function rk({data:e}){let t=(0,m.useMemo)(()=>{if(!e)return[];let t=new Set;return e.forEach(e=>{e["建案名稱"]&&t.add(e["建案名稱"])}),Array.from(t).map(e=>({value:e,label:e}))},[e]),[n,r]=(0,m.useState)([]),[a,i]=(0,m.useState)(null),[s,l]=(0,m.useState)(1),[o,c]=(0,m.useState)(!1),d=(0,m.useMemo)(()=>{if(0===n.length||!e||0===e.length)return[];let t={};return e.forEach(e=>{let r=e["建案名稱"];if(!r||!n.includes(r))return;let a=new Date(e["交易日"]).getTime();isNaN(a)||(t[r]||(t[r]=[]),t[r].push(a))}),Object.entries(t).map(([e,t])=>{let n=Math.min(...t),r=Math.max(...t);return{name:e,start:new Date(n),end:new Date(r),startStr:new Date(n).toISOString().slice(0,10),endStr:new Date(r).toISOString().slice(0,10),count:t.length}}).sort((e,t)=>e.start.getTime()-t.start.getTime()).slice(0,10)},[e,n]),u=(0,m.useMemo)(()=>{let e=new Date().getFullYear()+1;return d.length>0&&(e=Math.max(e,Math.max(...d.map(e=>e.end.getFullYear()))+1)),{start:new Date("2012-01-01"),end:new Date(`${e}-12-31`),totalMonths:(e-2012+1)*12}},[d]),h=Math.max(350,100+40*d.length+80),p=e=>{let t=new Date(e),n=u.start.getTime(),r=u.end.getTime(),a=t.getTime();return a<n?0:a>r?100:(a-n)/(r-n)*100},f=(0,m.useMemo)(()=>rb.filter(e=>{let t=new Date(e.date);return t>=u.start&&t<=u.end}),[u]),b=(0,m.useMemo)(()=>f.slice().reverse().map(e=>({日期:e.date,標題:e.title,類別:"finance"===e.category?"金融":"政策",影響:e.impact,變革內容:e.change_content,影響對象:e.affected_scope})),[f]);return(0,x.jsxs)(n3.Card,{className:"w-full bg-black/40 border-zinc-800 backdrop-blur-xl",children:[(0,x.jsxs)(n3.CardHeader,{children:[(0,x.jsxs)(n3.CardTitle,{className:"flex items-center gap-2 text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400",children:[(0,x.jsx)(n5,{className:"w-6 h-6 text-cyan-500"}),"房市政策時光機"]}),(0,x.jsx)(n3.CardDescription,{className:"text-zinc-400",children:"建案銷售期間與重大政策/金融事件的交叉比對"})]}),(0,x.jsxs)(n3.CardContent,{children:[(0,x.jsxs)("div",{className:"flex flex-col md:flex-row items-start md:items-end justify-between mb-6 px-2 gap-4",children:[(0,x.jsx)("div",{className:"w-full md:w-1/2 lg:w-1/3",children:(0,x.jsx)(n9,{projects:t,onChange:r,title:"選擇建案 (顯示銷售區間)",placeholder:"搜尋建案以顯示在時間軸...",max:6})}),(0,x.jsxs)("div",{className:"flex items-center justify-between w-full md:w-auto gap-4",children:[(0,x.jsxs)("div",{className:"flex items-center gap-2 bg-black/20 rounded-lg p-1 border border-white/5",children:[(0,x.jsx)("button",{onClick:()=>l(e=>Math.max(.5,e-.25)),className:"p-1.5 hover:bg-white/10 rounded-md text-zinc-400 hover:text-white transition-colors",children:(0,x.jsx)(rz,{className:"w-4 h-4"})}),(0,x.jsxs)("span",{className:"text-xs font-mono text-zinc-500 w-12 text-center",children:[(100*s).toFixed(0),"%"]}),(0,x.jsx)("button",{onClick:()=>l(e=>Math.min(3,e+.25)),className:"p-1.5 hover:bg-white/10 rounded-md text-zinc-400 hover:text-white transition-colors",children:(0,x.jsx)(rw,{className:"w-4 h-4"})})]}),(0,x.jsxs)("div",{className:"flex items-center gap-3 text-xs text-zinc-500",children:[(0,x.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,x.jsx)("div",{className:"w-2 h-2 rounded-full bg-emerald-500"})," 金融事件"]}),(0,x.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,x.jsx)("div",{className:"w-2 h-2 rounded-full bg-rose-500"})," 房市政策"]})]})]})]}),(0,x.jsx)("div",{className:"relative w-full overflow-x-auto pb-12 pt-8 hide-scrollbar",children:(0,x.jsxs)("div",{className:"relative pr-20 ml-24 border-b border-zinc-800 transition-all duration-300 ease-out",style:{minWidth:`${1200*s}px`,height:`${h}px`},children:[(0,x.jsx)("div",{className:"absolute top-0 w-full h-full pointer-events-none",children:Array.from({length:u.end.getFullYear()-u.start.getFullYear()+1}).map((e,t)=>{let n=u.start.getFullYear()+t,r=p(`${n}-01-01`);return(0,x.jsx)("div",{className:"absolute h-full border-l border-dashed border-zinc-800/50",style:{left:`${r}%`},children:(0,x.jsx)("span",{className:"absolute -top-6 -left-3 text-xs font-mono text-zinc-500",children:n})},n)})}),d.map((e,t)=>{let n=["from-cyan-500/20 to-blue-500/20 border-cyan-500/30 text-cyan-400","from-violet-500/20 to-purple-500/20 border-violet-500/30 text-violet-400","from-amber-500/20 to-orange-500/20 border-amber-500/30 text-amber-400","from-emerald-500/20 to-teal-500/20 border-emerald-500/30 text-emerald-400","from-pink-500/20 to-rose-500/20 border-pink-500/30 text-pink-400"],r=n[t%n.length];return(0,x.jsxs)("div",{className:(0,g.cn)("absolute h-8 border-y backdrop-blur-sm z-10 flex items-center justify-center group transition-all hover:bg-white/5",`bg-gradient-to-r ${r}`),style:{left:`${p(e.startStr)}%`,width:`${Math.max(.5,p(e.endStr)-p(e.startStr))}%`,top:`${100+40*t}px`},children:[(0,x.jsx)("div",{className:"absolute right-full mr-2 flex items-center h-full top-0",children:(0,x.jsx)("span",{className:"text-[10px] font-bold text-zinc-400 whitespace-nowrap bg-black/40 px-1.5 py-0.5 rounded border border-white/5",children:e.name})}),(0,x.jsxs)("div",{className:"absolute -top-8 text-[10px] whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity bg-black/90 px-2 py-1 rounded border border-zinc-700 z-20 pointer-events-none",children:[e.startStr," ~ ",e.endStr," (",e.count,"筆)"]})]},e.name)}),f.map((e,t)=>{let n=p(e.date),r="high"===e.impact,s=t%2==0?"8%":"85%",l=!1;if(d.length>0){let t=new Date(e.date);l=d.some(e=>t>=e.start&&t<=e.end)}return(0,x.jsxs)("div",{className:(0,g.cn)("absolute transform -translate-x-1/2 flex flex-col items-center group cursor-pointer transition-all duration-300 z-20",l?"opacity-100 scale-110":"opacity-60 hover:opacity-100 hover:scale-110",a?.id===e.id&&"scale-125 opacity-100 z-30"),style:{left:`${n}%`,top:s},onClick:()=>i(e),children:[(0,x.jsx)("div",{className:(0,g.cn)("h-8 w-px absolute","8%"===s?"top-full bg-gradient-to-b":"bottom-full bg-gradient-to-t","from-transparent to-zinc-700")}),(0,x.jsx)("div",{className:(0,g.cn)("w-8 h-8 rounded-full flex items-center justify-center border shadow-[0_0_15px_rgba(0,0,0,0.5)] transition-all","finance"===e.category?"bg-emerald-950/80 border-emerald-500/50 text-emerald-400 group-hover:shadow-emerald-500/20":"bg-rose-950/80 border-rose-500/50 text-rose-400 group-hover:shadow-rose-500/20",r&&"ring-2 ring-offset-2 ring-offset-black/50 ring-opacity-50","finance"===e.category&&r?"ring-emerald-500":"ring-rose-500",a?.id===e.id&&"ring-2 ring-white ring-offset-2 ring-offset-black"),children:(e=>{switch(e){case"finance":return(0,x.jsx)(rj,{className:"w-3 h-3 text-emerald-400"});case"policy":return(0,x.jsx)(ry,{className:"w-3 h-3 text-rose-400"});default:return(0,x.jsx)(rN.Info,{className:"w-3 h-3 text-blue-400"})}})(e.category)}),(0,x.jsx)("div",{className:(0,g.cn)("absolute whitespace-nowrap text-[10px] px-2 py-0.5 mt-2 rounded bg-black/80 border border-zinc-700 backdrop-blur-md transition-all font-medium","8%"===s?"-top-8":"-bottom-8",l?"text-white border-yellow-500/50":"text-zinc-400 group-hover:text-white",a?.id===e.id&&"text-white border-white/50 bg-zinc-800"),children:e.title}),(0,x.jsx)("div",{className:(0,g.cn)("absolute text-[9px] font-mono text-zinc-600","8%"===s?"top-10":"bottom-10"),children:e.date})]},e.id)})]})}),a&&(0,x.jsx)("div",{className:"mt-6 mb-8 border border-zinc-700/50 bg-zinc-900/80 p-6 rounded-xl animate-in fade-in slide-in-from-top-4 shadow-2xl shadow-black/50",children:(0,x.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,x.jsxs)("div",{className:"flex items-start justify-between border-b border-white/5 pb-4",children:[(0,x.jsxs)("div",{className:"space-y-1",children:[(0,x.jsxs)("div",{className:"flex items-center gap-3",children:[(0,x.jsx)(rg,{variant:"outline",className:(0,g.cn)("text-sm px-3 py-1","finance"===a.category?"bg-emerald-500/10 text-emerald-400 border-emerald-500/30":"bg-rose-500/10 text-rose-400 border-rose-500/30"),children:"finance"===a.category?"金融事件":"房市政策"}),(0,x.jsx)("span",{className:"text-zinc-400 font-mono text-sm",children:a.date})]}),(0,x.jsx)("h3",{className:"text-2xl font-bold text-white tracking-tight",children:a.title})]}),(0,x.jsxs)("div",{className:(0,g.cn)("px-3 py-1 rounded-full text-xs font-medium border","high"===a.impact?"bg-red-500/10 text-red-400 border-red-500/30":"bg-yellow-500/10 text-yellow-400 border-yellow-500/30"),children:["影響程度: ","high"===a.impact?"高":"medium"===a.impact?"中":"低"]})]}),(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,x.jsxs)("div",{className:"space-y-6",children:[(0,x.jsxs)("div",{children:[(0,x.jsxs)("h4",{className:"text-sm font-bold text-zinc-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[(0,x.jsx)(rN.Info,{className:"w-4 h-4"})," 政策/事件內容"]}),(0,x.jsx)("p",{className:"text-zinc-200 text-base leading-relaxed bg-zinc-950/50 p-4 rounded-lg border border-white/5",children:a.description})]}),(0,x.jsxs)("div",{children:[(0,x.jsxs)("h4",{className:"text-sm font-bold text-zinc-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[(0,x.jsx)(ry,{className:"w-4 h-4"})," 具體規範變革"]}),(0,x.jsx)("div",{className:"bg-zinc-950/50 p-4 rounded-lg border border-white/5 text-cyan-400 font-medium",children:a.change_content||"無具體規範變更"})]})]}),(0,x.jsxs)("div",{className:"space-y-6",children:[(0,x.jsxs)("div",{children:[(0,x.jsxs)("h4",{className:"text-sm font-bold text-zinc-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[(0,x.jsx)(rj,{className:"w-4 h-4"})," 時代背景與金融環境"]}),(0,x.jsx)("p",{className:"text-zinc-300 text-sm leading-relaxed bg-zinc-950/30 p-4 rounded-lg border border-white/5",children:a.background||"尚無背景資料"})]}),(0,x.jsxs)("div",{children:[(0,x.jsxs)("h4",{className:"text-sm font-bold text-zinc-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[(0,x.jsx)(rv.TrendingUp,{className:"w-4 h-4"})," 受眾影響分析"]}),(0,x.jsxs)("div",{className:"relative overflow-hidden rounded-lg border border-white/10 bg-gradient-to-br from-indigo-500/10 to-purple-500/10 p-4",children:[(0,x.jsx)("div",{className:"absolute top-0 right-0 p-2 opacity-10",children:(0,x.jsx)(rv.TrendingUp,{className:"w-24 h-24"})}),(0,x.jsxs)("div",{className:"relative z-10",children:[(0,x.jsxs)("p",{className:"text-indigo-300 font-medium mb-2 text-xs uppercase",children:["影響對象: ",a.affected_scope]}),(0,x.jsx)("p",{className:"text-white text-sm leading-relaxed",children:a.impact_analysis||"尚無詳細分析"})]})]})]})]})]}),a.details&&a.details.length>0&&(0,x.jsxs)("div",{className:"border-t border-white/5 pt-4",children:[(0,x.jsx)("button",{onClick:()=>c(!o),className:"flex items-center gap-2 text-sm text-zinc-400 hover:text-white transition-colors w-full justify-center py-2",children:o?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(rm,{className:"w-4 h-4"})," 收起完整規範細節"]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(j.ChevronDown,{className:"w-4 h-4"})," 展開完整規範細節 (",a.details.length," 項)"]})}),o&&(0,x.jsx)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 animate-in fade-in slide-in-from-top-2",children:a.details.map((e,t)=>(0,x.jsxs)("div",{className:"flex items-start gap-3 bg-black/40 p-3 rounded border border-zinc-800 text-sm text-zinc-300",children:[(0,x.jsx)("span",{className:"flex items-center justify-center w-5 h-5 rounded-full bg-zinc-800 text-zinc-500 text-xs shrink-0 mt-0.5",children:t+1}),(0,x.jsx)("span",{children:e})]},t))})]})]})}),(0,x.jsxs)("div",{className:"mt-8 border-t border-zinc-800 pt-6",children:[(0,x.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)(rv.TrendingUp,{className:"w-5 h-5 text-purple-400"}),(0,x.jsx)("h3",{className:"text-lg font-bold text-zinc-200",children:"政策影響比較表"})]}),(0,x.jsx)(nK,{data:b,filename:"policy_comparison",label:"匯出政策表"})]}),(0,x.jsxs)("div",{className:"rounded-xl border border-white/10 overflow-hidden bg-black/20",children:[(0,x.jsxs)("div",{className:"grid grid-cols-12 gap-4 p-4 bg-zinc-900/50 border-b border-white/5 text-xs font-bold text-zinc-400 uppercase tracking-wider",children:[(0,x.jsx)("div",{className:"col-span-2",children:"實施日期"}),(0,x.jsx)("div",{className:"col-span-3",children:"政策/事件名稱"}),(0,x.jsx)("div",{className:"col-span-4",children:"變革內容 (Before vs After)"}),(0,x.jsx)("div",{className:"col-span-3",children:"影響對象與範圍"})]}),(0,x.jsx)("div",{className:"divide-y divide-white/5 max-h-[400px] overflow-y-auto custom-scrollbar",children:f.slice().reverse().map(e=>(0,x.jsxs)("div",{className:(0,g.cn)("grid grid-cols-12 gap-4 p-4 text-sm transition-colors hover:bg-white/5 cursor-pointer",a?.id===e.id?"bg-white/10":""),onClick:()=>i(e),children:[(0,x.jsx)("div",{className:"col-span-2 font-mono text-zinc-500",children:e.date}),(0,x.jsxs)("div",{className:"col-span-3 flex items-start gap-2",children:[(0,x.jsx)(rg,{variant:"outline",className:(0,g.cn)("shrink-0 mt-0.5","finance"===e.category?"text-emerald-400 border-emerald-500/30":"text-rose-400 border-rose-500/30"),children:"finance"===e.category?"金融":"政策"}),(0,x.jsx)("span",{className:(0,g.cn)("font-medium","high"===e.impact?"text-white":"text-zinc-400"),children:e.title})]}),(0,x.jsx)("div",{className:"col-span-4 text-zinc-300",children:e.change_content?(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-cyan-500 shrink-0"}),e.change_content]}):(0,x.jsx)("span",{className:"text-zinc-600 italic",children:"--"})}),(0,x.jsx)("div",{className:"col-span-3 text-zinc-400",children:e.affected_scope||(0,x.jsx)("span",{className:"text-zinc-600 italic",children:"--"})})]},e.id))})]})]})]})]})}var r_=e.i(10115),rS="Tabs",[rC,rP]=(0,et.createContextScope)(rS,[eI]),rM=eI(),[rA,rE]=rC(rS),rR=m.forwardRef((e,t)=>{let{__scopeTabs:n,value:r,onValueChange:a,defaultValue:i,orientation:s="horizontal",dir:l,activationMode:o="automatic",...c}=e,d=ex(l),[u,m]=(0,en.useControllableState)({prop:r,onChange:a,defaultProp:i??"",caller:rS});return(0,x.jsx)(rA,{scope:n,baseId:(0,e_.useId)(),value:u,onValueChange:m,orientation:s,dir:d,activationMode:o,children:(0,x.jsx)(er.Primitive.div,{dir:d,"data-orientation":s,...c,ref:t})})});rR.displayName=rS;var rD="TabsList",rF=m.forwardRef((e,t)=>{let{__scopeTabs:n,loop:r=!0,...a}=e,i=rE(rD,n),s=rM(n);return(0,x.jsx)(eO,{asChild:!0,...s,orientation:i.orientation,dir:i.dir,loop:r,children:(0,x.jsx)(er.Primitive.div,{role:"tablist","aria-orientation":i.orientation,...a,ref:t})})});rF.displayName=rD;var rT="TabsTrigger",rI=m.forwardRef((e,t)=>{let{__scopeTabs:n,value:r,disabled:a=!1,...i}=e,s=rE(rT,n),l=rM(n),o=rO(s.baseId,r),c=rB(s.baseId,r),d=r===s.value;return(0,x.jsx)(eK,{asChild:!0,...l,focusable:!a,active:d,children:(0,x.jsx)(er.Primitive.button,{type:"button",role:"tab","aria-selected":d,"aria-controls":c,"data-state":d?"active":"inactive","data-disabled":a?"":void 0,disabled:a,id:o,...i,ref:t,onMouseDown:(0,J.composeEventHandlers)(e.onMouseDown,e=>{a||0!==e.button||!1!==e.ctrlKey?e.preventDefault():s.onValueChange(r)}),onKeyDown:(0,J.composeEventHandlers)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&s.onValueChange(r)}),onFocus:(0,J.composeEventHandlers)(e.onFocus,()=>{let e="manual"!==s.activationMode;d||a||!e||s.onValueChange(r)})})})});rI.displayName=rT;var rL="TabsContent",r$=m.forwardRef((e,t)=>{let{__scopeTabs:n,value:r,forceMount:a,children:i,...s}=e,l=rE(rL,n),o=rO(l.baseId,r),c=rB(l.baseId,r),d=r===l.value,u=m.useRef(d);return m.useEffect(()=>{let e=requestAnimationFrame(()=>u.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,x.jsx)(eP.Presence,{present:a||d,children:({present:n})=>(0,x.jsx)(er.Primitive.div,{"data-state":d?"active":"inactive","data-orientation":l.orientation,role:"tabpanel","aria-labelledby":o,hidden:!n,id:c,tabIndex:0,...s,ref:t,style:{...e.style,animationDuration:u.current?"0s":void 0},children:n&&i})})});function rO(e,t){return`${e}-trigger-${t}`}function rB(e,t){return`${e}-content-${t}`}r$.displayName=rL;let rH=m.forwardRef(({className:e,...t},n)=>(0,x.jsx)(rF,{ref:n,className:(0,g.cn)("inline-flex h-10 items-center justify-center rounded-md bg-zinc-800 p-1 text-zinc-400",e),...t}));rH.displayName=rF.displayName;let rK=m.forwardRef(({className:e,...t},n)=>(0,x.jsx)(rI,{ref:n,className:(0,g.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-zinc-950 data-[state=active]:text-white data-[state=active]:shadow-sm",e),...t}));rK.displayName=rI.displayName;let rZ=m.forwardRef(({className:e,...t},n)=>(0,x.jsx)(r$,{ref:n,className:(0,g.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));rZ.displayName=r$.displayName;var rq=e.i(14302);function rU(){let e=(0,f.useFilterStore)(),{loading:t,error:n,analysisData:r,handleAnalyze:a}=(0,rq.useAnalysisData)();return(0,m.useEffect)(()=>{},[]),(0,x.jsxs)(p.AppLayout,{children:[(0,x.jsx)("section",{className:"mb-6 relative z-50",children:(0,x.jsx)(R,{onAnalyze:a,isLoading:t})}),n&&(0,x.jsxs)("div",{className:"bg-red-500/10 border border-red-500/50 text-red-500 p-4 rounded-lg mb-6 flex items-center gap-2",children:[(0,x.jsx)(r_.AlertCircle,{size:20}),n]}),t&&(0,x.jsxs)("div",{className:"flex flex-col items-center justify-center py-20",children:[(0,x.jsx)(V.Loader2,{className:"h-10 w-10 animate-spin text-violet-500 mb-4"}),(0,x.jsx)("p",{className:"text-zinc-400",children:"正在分析數據，請稍候..."})]}),!t&&!r&&!n&&(0,x.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 glass-panel border-dashed border-2 border-zinc-800 rounded-xl",children:[(0,x.jsx)("div",{className:"text-zinc-500 mb-2",children:"尚未進行分析"}),(0,x.jsx)("p",{className:"text-zinc-600 text-sm",children:"請選擇篩選條件並點擊「開始分析」"})]}),!t&&r&&(0,x.jsx)("div",{className:"space-y-8 pb-20",children:(0,x.jsxs)(rR,{value:e.activeTab,onValueChange:e.setActiveTab,className:"w-full",children:[(0,x.jsx)("div",{className:"overflow-x-auto pb-2 scrollbar-hide",children:(0,x.jsxs)(rH,{className:"bg-zinc-900/50 border border-white/5 p-1 mb-6 inline-flex min-w-max",children:[(0,x.jsx)(rK,{value:"ranking",children:"核心指標與排名"}),(0,x.jsx)(rK,{value:"price-band",children:"總價帶分析"}),(0,x.jsx)(rK,{value:"unit-price",children:"單價分析"}),(0,x.jsx)(rK,{value:"heatmap",children:"調價熱力圖"}),(0,x.jsx)(rK,{value:"timeline",children:"政策時光機"}),(0,x.jsx)(rK,{value:"velocity",children:"銷售速度與房型"}),(0,x.jsx)(rK,{value:"parking",children:"車位分析"}),(0,x.jsx)(rK,{value:"data-list",children:"交易明細列表"})]})}),(0,x.jsx)(rZ,{value:"ranking",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,x.jsx)(h.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,x.jsx)(nZ,{data:r})})}),(0,x.jsx)(rZ,{value:"price-band",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,x.jsx)(h.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,x.jsx)(nG,{data:r.priceBandAnalysis?{...r.priceBandAnalysis,transactionDetails:r.transactionDetails}:null})})}),(0,x.jsx)(rZ,{value:"unit-price",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,x.jsx)(h.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,x.jsx)(ra,{data:r})})}),(0,x.jsx)(rZ,{value:"heatmap",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,x.jsx)(h.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,x.jsx)(rx,{data:r.priceGridAnalysis?r:null})})}),(0,x.jsx)(rZ,{value:"timeline",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,x.jsx)(h.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,x.jsx)(rk,{data:r.transactionDetails})})}),(0,x.jsx)(rZ,{value:"velocity",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,x.jsx)(h.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,x.jsx)(nJ,{data:r})})}),(0,x.jsx)(rZ,{value:"parking",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,x.jsx)(h.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,x.jsx)(re,{data:r.parkingAnalysis?.parkingRatio?r:null})})}),(0,x.jsx)(rZ,{value:"data-list",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,x.jsx)(h.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,x.jsx)(rp,{trigger:r.transactionDetails?.length?r:null})})})]})})]})}e.s(["default",()=>rU],77154)}]);