(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,77154,e=>{"use strict";var t=e.i(25191),i=e.i(68524),s=e.i(77019),n=e.i(21643),l=e.i(78885),r=e.i(74614),a=e.i(30844),o=e.i(5467);let c=(0,i.forwardRef)(({options:e,value:s,onChange:n,placeholder:l="Select...",maxItems:c,disabled:d=!1,className:u,onSearch:x,loading:h=!1,onFocus:m},p)=>{let[f,v]=(0,i.useState)(""),[b,y]=(0,i.useState)(!1),g=(0,i.useRef)(null),j=(0,i.useRef)(null),N=x?e:e.filter(e=>e.label.toLowerCase().includes(f.toLowerCase()));return s.map(t=>{let i=e.find(e=>e.value===t);return i?i.label:t}),(0,i.useEffect)(()=>{let e=e=>{g.current&&!g.current.contains(e.target)&&y(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,i.useEffect)(()=>{x&&x(f)},[f,x]),(0,t.jsxs)("div",{className:(0,r.cn)("relative w-full",u),ref:g,children:[(0,t.jsxs)("div",{className:(0,r.cn)("flex items-center gap-2 bg-zinc-950/50 border border-input rounded-md px-2 py-1.5 h-[42px] overflow-x-auto custom-scrollbar cursor-text transition-all",b&&"ring-2 ring-ring ring-offset-0 border-ring",d&&"bg-zinc-900/50 cursor-not-allowed opacity-50"),onClick:()=>!d&&j.current?.focus(),children:[s.map(i=>{let l=e.find(e=>e.value===i),r=l?l.label:i;return(0,t.jsxs)("span",{className:"bg-violet-500/20 text-violet-200 border border-violet-500/30 text-xs rounded-full px-2 py-0.5 flex items-center gap-1 animate-in fade-in zoom-in-95 duration-100 whitespace-nowrap shrink-0",children:[r,!d&&(0,t.jsx)(a.X,{size:12,className:"cursor-pointer hover:text-white transition-colors",onClick:e=>{e.stopPropagation(),n(s.filter(e=>e!==i))}})]},i)}),(0,t.jsx)("input",{ref:j,type:"text",value:f,onChange:e=>v(e.target.value),onFocus:()=>{y(!0),m?.()},onKeyDown:e=>{"Backspace"===e.key&&""===f&&s.length>0&&n(s.slice(0,-1))},placeholder:0===s.length?l:"",className:(0,r.cn)("bg-transparent outline-none flex-grow min-w-[60px] text-zinc-100 placeholder:text-zinc-500 text-sm",d&&"cursor-not-allowed"),disabled:d})]}),b&&!d&&(0,t.jsx)("div",{className:"absolute z-[110] w-full mt-1 bg-zinc-900 border border-zinc-700 rounded-md shadow-xl max-h-60 overflow-y-auto custom-scrollbar animate-in fade-in slide-in-from-top-2 duration-100",children:h?(0,t.jsx)("div",{className:"p-2 text-center text-zinc-500 text-sm",children:"Loading..."}):0===N.length?(0,t.jsx)("div",{className:"p-2 text-center text-zinc-500 text-sm",children:"No options found"}):N.map((e,l)=>{if(!e)return null;let a=0===l||e.group!==N[l-1]?.group;return(0,t.jsxs)(i.default.Fragment,{children:[a&&e.group&&(0,t.jsx)("div",{className:"px-2 py-1 bg-zinc-800/50 text-xs font-semibold text-zinc-400 sticky top-0 backdrop-blur-sm z-10",children:e.group}),(0,t.jsxs)("div",{className:(0,r.cn)("px-3 py-2 cursor-pointer text-sm flex items-start justify-between hover:bg-zinc-800 transition-colors",s.includes(e.value)&&"bg-violet-500/10 text-violet-400"),onClick:()=>(e=>{if(s.includes(e))n(s.filter(t=>t!==e));else{if(c&&s.length>=c)return;n([...s,e])}v("")})(e.value),children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"font-medium",children:e.label}),e.details&&(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-0.5",children:[(e.details.county||e.details.district)&&(0,t.jsxs)("span",{className:"text-xs text-zinc-500 bg-zinc-800/80 px-1.5 rounded border border-zinc-700",children:[e.details.county,e.details.district]}),e.details.date&&(0,t.jsx)("span",{className:"text-xs text-zinc-600 font-mono",children:e.details.date.substring(0,7)})]})]}),s.includes(e.value)&&(0,t.jsx)(o.Check,{size:16,className:"mt-1"})]})]},e.value)})})]})});c.displayName="MultiSelect";var d=e.i(22112),u=e.i(14897),x=e.i(42217),h=e.i(91568);let m=(0,h.default)("chart-line",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]),p=(0,h.default)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);var f=e.i(63028),v=e.i(72448),b=e.i(68609),y=e.i(59725);function g({onAnalyze:e,isLoading:n}){let r,{counties:o,districts:h,transactionType:g,buildingType:j,projectNames:N,dateRange:w,startDate:z,endDate:k,excludeCommercial:C,setCounties:A,setDistricts:R,setTransactionType:S,setBuildingType:D,setProjectNames:E,setDateRange:T,setCustomDate:I,setExcludeCommercial:M,resetFilters:_}=(0,l.useFilterStore)(),[F,O]=(0,i.useState)(!1),[P,L]=(0,i.useState)([]),[$,B]=(0,i.useState)(!1),H=Object.keys(v.COUNTY_CODE_MAP).map(e=>({label:e,value:e})),K=i.default.useMemo(()=>0===o.length?[]:o.flatMap(e=>(v.DISTRICT_DATA[e]||[]).map(t=>({label:t,value:t,group:e}))),[o]),U=(0,i.useRef)(null),[V,q]=(0,i.useState)(null),W=(0,i.useCallback)(async e=>{if(0===o.length)return void L([]);B(!0),q(null);try{let t=o.map(async t=>{let i=v.COUNTY_CODE_MAP[t],s=h.filter(e=>v.DISTRICT_DATA[t]?.includes(e));return b.api.fetchProjectNameSuggestions(i,e,s).then(e=>{let i=[];return Array.isArray(e)?i=e:e&&e.data&&Array.isArray(e.data)?i=e.data:e&&e.names&&Array.isArray(e.names)&&(i=e.names),i.map(e=>{let i="string"==typeof e,s=i?e:e.name||e.建案名稱||String(e);return{label:s,value:s,group:t,details:i?void 0:{county:t,district:e.district||e.行政區,date:e.earliestDate||e.交易日}}})}).catch(e=>(console.error(`Failed to fetch projects for ${t}:`,e),[]))}),i=(await Promise.all(t)).flat(),s=Array.from(new Map(i.map(e=>[e.value,e])).values());L(s),0===s.length&&e.length>=2&&console.log(`No projects found for query "${e}" in counties: ${o.join(", ")}`)}catch(e){console.error("Project search error:",e),q("搜尋失敗，請稍後再試")}finally{B(!1)}},[o,h]),G=(0,i.useCallback)(e=>{U.current&&clearTimeout(U.current),U.current=setTimeout(()=>{W(e)},300)},[W]);(0,i.useEffect)(()=>()=>{U.current&&clearTimeout(U.current)},[]);let[Y,X]=(0,i.useState)(!1),Z=(0,i.useRef)(null);return(0,i.useEffect)(()=>{let e=()=>{let e=window.scrollY;e>250?X(!0):e<120&&X(!1)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(f.AnimatePresence,{mode:"wait",children:Y?(0,t.jsxs)(s.motion.div,{initial:{opacity:0,y:-20,x:"-50%",scale:.95},animate:{opacity:1,y:0,x:"-50%",scale:1},exit:{opacity:0,y:-20,x:"-50%",scale:.95},transition:{duration:.2,ease:"easeOut"},className:"fixed top-3 left-1/2 z-[70] p-1.5 glass-card rounded-full shadow-xl flex items-center justify-between gap-3 cursor-pointer hover:bg-zinc-900/90 transition-all mx-auto max-w-lg backdrop-blur-2xl border border-white/20 origin-top",onClick:()=>{X(!1),window.scrollTo({top:0,behavior:"smooth"})},children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 px-1",children:[(0,t.jsx)("div",{className:"h-6 w-6 rounded-full bg-violet-500/20 text-violet-400 flex items-center justify-center shrink-0",children:(0,t.jsx)(p,{className:"h-3 w-3"})}),(0,t.jsxs)("div",{className:"flex flex-col leading-tight overflow-hidden",children:[(0,t.jsx)("span",{className:"text-[9px] text-zinc-500 font-bold uppercase tracking-tighter",children:"篩選摘要"}),(0,t.jsx)("span",{className:"text-xs text-zinc-100 font-semibold truncate max-w-[200px]",children:(r=[],o.length>0&&r.push(`${o.length} 縣市`),g&&r.push(g.replace("交易","")),"custom"!==w?r.push({"1q":"近一季","2q":"近兩季","3q":"近三季","1y":"近一年",this_year:"今年",last_2_years:"近兩年"}[w]||w):r.push("自訂期間"),r.join(" • ")||"請選擇篩選條件")})]})]}),(0,t.jsx)("div",{className:"flex items-center gap-2 pl-2 border-l border-white/5",children:(0,t.jsx)("span",{className:"text-[10px] text-cyan-400/80 font-medium whitespace-nowrap pr-1",children:"展開"})})]},"compact-pill"):(0,t.jsxs)(s.motion.div,{ref:Z,initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.3},className:"p-4 md:p-6 glass-card rounded-xl shadow-lg",children:[(0,t.jsxs)("div",{className:"flex md:hidden items-center justify-between mb-4",children:[(0,t.jsxs)("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[(0,t.jsx)(p,{className:"h-5 w-5 text-violet-500"}),"篩選條件"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(u.Button,{variant:"outline",size:"sm",onClick:()=>O(!F),className:"border-zinc-700 text-zinc-300",children:[F?(0,t.jsx)(a.X,{className:"h-4 w-4"}):(0,t.jsx)(p,{className:"h-4 w-4"}),F?"收起":"展開"]}),(0,t.jsx)(u.Button,{variant:"default",size:"sm",className:"bg-violet-600 text-white",disabled:0===o.length||n,onClick:e,children:n?"...":"分析"})]})]}),(0,t.jsxs)("div",{className:`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-7 gap-4 items-end ${F?"block":"hidden md:grid"}`,children:[(0,t.jsxs)("div",{className:"xl:col-span-1",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-zinc-300",children:"縣市"}),o.length>3&&(0,t.jsxs)("span",{className:"text-xs text-amber-500 font-normal animate-in fade-in",children:["(已選 ",o.length,"/6)"]})]}),o.length>0&&(0,t.jsx)("button",{onClick:()=>A([]),className:"text-xs text-cyan-400 hover:text-cyan-300",children:"清除"})]}),(0,t.jsx)(c,{options:H,value:o,onChange:e=>{e.length>6||A(e)},placeholder:"請選擇縣市...",maxItems:6})]}),(0,t.jsxs)("div",{className:"xl:col-span-1",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-zinc-300",children:"行政區"}),h.length>0&&(0,t.jsx)("button",{onClick:()=>R([]),className:"text-xs text-cyan-400 hover:text-cyan-300",children:"清除"})]}),(0,t.jsx)(c,{options:K,value:h,onChange:e=>{R(e)},placeholder:o.length>0?"請選擇行政區...":"請先選縣市",disabled:0===o.length})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"交易類型"}),(0,t.jsxs)(d.Select,{value:g,onChange:e=>S(e.target.value),children:[(0,t.jsx)("option",{value:"預售交易",children:"預售交易"}),(0,t.jsx)("option",{value:"中古交易",disabled:!0,children:"中古交易 (開發中)"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"建物型態"}),(0,t.jsxs)(d.Select,{value:j,onChange:e=>D(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"全部"}),(0,t.jsx)("option",{value:"住宅大樓(11層含以上有電梯)",children:"住宅大樓"}),(0,t.jsx)("option",{value:"華廈(10層含以下有電梯)",children:"華廈"}),(0,t.jsx)("option",{value:"公寓(5層含以下無電梯)",children:"公寓"}),(0,t.jsx)("option",{value:"套房(1房(1廳)1衛)",children:"套房"}),(0,t.jsx)("option",{value:"透天厝",children:"透天厝"}),(0,t.jsx)("option",{value:"店面(店鋪)",children:"店面"}),(0,t.jsx)("option",{value:"辦公商業大樓",children:"辦公商業大樓"}),(0,t.jsx)("option",{value:"工廠",children:"工廠/廠辦"}),(0,t.jsx)("option",{value:"其他",children:"其他"})]})]}),(0,t.jsxs)("div",{className:"xl:col-span-3",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-zinc-300",children:"建案名稱"}),N.length>0&&(0,t.jsx)("button",{onClick:()=>E([]),className:"text-xs text-cyan-400 hover:text-cyan-300",children:"清除"})]}),(0,t.jsx)(c,{options:P,value:N,onChange:E,placeholder:o.length>0?"輸入建案名稱搜尋...":"請先選縣市",disabled:0===o.length,onSearch:G,loading:$,onFocus:()=>{0===N.length&&0===P.length&&W("")}}),V&&(0,t.jsx)("span",{className:"text-xs text-red-400 mt-1",children:V})]}),(0,t.jsxs)("div",{className:"xl:col-span-3 sm:col-span-2 grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"快捷時間"}),(0,t.jsxs)(d.Select,{value:w,onChange:e=>{let t=e.target.value;if("custom"===t)T("custom",z,k);else{let{startDate:e,endDate:i}=(0,y.getDateRangeDates)(t);e&&i&&T(t,e,i)}},children:[(0,t.jsx)("option",{value:"custom",children:"自訂範圍"}),(0,t.jsx)("option",{value:"1q",children:"近一季 (3個月)"}),(0,t.jsx)("option",{value:"2q",children:"近兩季 (6個月)"}),(0,t.jsx)("option",{value:"3q",children:"近三季 (9個月)"}),(0,t.jsx)("option",{value:"1y",children:"近一年 (12個月)"}),(0,t.jsx)("option",{value:"this_year",children:"今年以來"}),(0,t.jsx)("option",{value:"last_2_years",children:"去年＋今年"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"起始日期"}),(0,t.jsx)(x.Input,{type:"date",value:z,onChange:e=>I(e.target.value,k),className:"bg-zinc-950/50 border-input text-zinc-100"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-zinc-300",children:"結束日期"}),(0,t.jsx)("button",{onClick:()=>{I(z,new Date().toISOString().split("T")[0])},className:"text-xs text-cyan-400 hover:text-cyan-300",children:"抓取今日"})]}),(0,t.jsx)(x.Input,{type:"date",value:k,onChange:e=>I(z,e.target.value),className:"bg-zinc-950/50 border-input text-zinc-100"})]})]}),(0,t.jsxs)("div",{className:"xl:col-span-4 sm:col-span-2 flex items-end gap-4 justify-end mt-4 md:mt-0",children:[(0,t.jsx)("div",{className:"flex items-center gap-4 mr-auto",children:(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm text-zinc-300 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:C,onChange:e=>M(e.target.checked),className:"rounded border-zinc-600 bg-zinc-800 text-violet-500 focus:ring-violet-500 accent-violet-500"}),(0,t.jsx)("span",{children:"排除商辦/店面"})]})}),(0,t.jsxs)(u.Button,{variant:"default",className:"bg-violet-600 hover:bg-violet-500 text-white min-w-[120px] hidden md:flex",disabled:0===o.length||n,onClick:()=>{localStorage.setItem("reportReady","true"),window.dispatchEvent(new Event("reportReady")),e?.()},children:[n?(0,t.jsx)("span",{className:"animate-spin mr-2",children:"⟳"}):(0,t.jsx)(m,{className:"mr-2 h-4 w-4"}),n?"分析中...":"分析報表"]})]})]})]},"full-filterbar")})})}var j=e.i(98264),N=e.i(65145),w=e.i(87373),z=e.i(15866),k=e.i(12885),C=e.i(65787),A=e.i(78320),R=e.i(67690),S=e.i(50294),D=e.i(78841),E=e.i(23372),T=e.i(63393),I=e.i(89950),M=e.i(60459);let _=(0,h.default)("table-2",[["path",{d:"M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",key:"gugj83"}]]);var F=e.i(7797),O=e.i(65949);function P({data:e,trigger:s}){let n=(0,l.useFilterStore)(),[o,c]=(0,i.useState)([]),[d,u]=(0,i.useState)(!1),[x,h]=(0,i.useState)(null),[m,p]=(0,i.useState)(1),[f,g]=(0,i.useState)(new Set),[j,N]=(0,i.useState)({key:"",direction:null}),[w,z]=(0,i.useState)(""),[k,C]=(0,i.useState)("建案名稱"),[P,L]=(0,i.useState)(!1),[$,B]=(0,i.useState)([]),[H,K]=(0,i.useState)(!1),[U,V]=(0,i.useState)(""),q=(0,i.useCallback)(async()=>{u(!0),h(null),c([]);try{let{counties:e,districts:t,transactionType:i,dateRange:s,startDate:l,endDate:r,projectNames:a,buildingType:o}=n;if(0===e.length)return void u(!1);let d=l,x=r;if("custom"!==s){let e=(0,y.getDateRangeDates)(s);e.startDate&&(d=e.startDate),e.endDate&&(x=e.endDate)}let h=e.map(async e=>{let s=v.COUNTY_CODE_MAP[e],n=v.DISTRICT_DATA[e]||[],l=t.filter(e=>n.includes(e)),r={countyCode:s,districts:l.length>0?l:void 0,type:i,dateStart:d,dateEnd:x,projectNames:a,buildingType:o};try{return await b.api.fetchData(r,{page:1,limit:1e3})}catch(t){return console.warn(`Fetch failed for ${e}`,t),{data:[],count:0}}}),m=await Promise.all(h),p=[];m.forEach(e=>{e&&Array.isArray(e.data)&&(p=[...p,...e.data])}),p.sort((e,t)=>{let i=e["交易日"]||"";return(t["交易日"]||"").localeCompare(i)}),c(p)}catch(e){console.error("Data List fetch failed:",e),h(e.message||"讀取交易資料失敗")}finally{u(!1)}},[n]);(0,i.useEffect)(()=>{s&&q()},[q,s]);let W=async e=>{if(!e.編號||!e.縣市代碼)return;let t=e["交易類型"]||n.transactionType;V(`車位/附表明細 - ${e["建案名稱"]||e["編號"]}`),K(!0),L(!0),B([]);try{let i=await b.api.fetchSubData(e.編號,t,e.縣市代碼),s=[];if(i.park&&Array.isArray(i.park)&&i.park.length>0&&(s=[...s,...i.park.map(e=>({...e,_category:"車位資料"}))]),i.build&&Array.isArray(i.build)&&i.build.length>0&&(s=[...s,...i.build.map(e=>({...e,_category:"建物明細"}))]),Array.isArray(i)&&0===s.length?s=[...s,...i]:i.data&&Array.isArray(i.data)&&0===s.length&&(s=[...s,...i.data]),0===s.length){let t=e["車位數"]&&Number(e["車位數"])>0,i=e["車位總價"]||e["車位總價(萬)"];if(t||i){let t=e["車位總價"]?Number(e["車位總價"]):e["車位總價(萬)"]?1e4*Number(e["車位總價(萬)"]):0,i=e["車位總面積"]?Number(e["車位總面積"]):e["車位面積"]?Number(e["車位面積"]):0;s.push({車位類別:e["車位類別"]||"無資料",車位價格:t,車位面積:i,車位樓層:"-","車位價格(萬)":e["車位總價(萬)"]||t/1e4,"車位面積(坪)":e["車位面積(坪)"]||(i/3.30579).toFixed(2),編號:e["編號"],_category:"車位資料(來自交易明細)"})}}B(s)}catch(t){if(console.error(t),e["車位數"]&&Number(e["車位數"])>0){let t=e["車位總價"]?Number(e["車位總價"]):e["車位總價(萬)"]?1e4*Number(e["車位總價(萬)"]):0;B([{車位類別:e["車位類別"]||"無資料",車位價格:t,車位面積:e["車位總面積"]||0,編號:e["編號"],_category:"車位資料(來自交易明細)"}])}else B([])}finally{K(!1)}},G=[{key:"行政區",label:"行政區",sortable:!0},{key:"建案名稱",label:"建案名稱",sortable:!0},{key:"交易日",label:"交易日",sortable:!0},{key:"交易筆棟數",label:"交易筆棟數",sortable:!1},{key:"主要用途",label:"主要用途",sortable:!1},{key:"建物型態",label:"建物型態",sortable:!1},{key:"戶型",label:"戶型",sortable:!0},{key:"樓層",label:"樓層",sortable:!0},{key:"房屋面積(坪)",label:"坪數",sortable:!0},{key:"房屋單價(萬)",label:"單價",sortable:!0}],Y=["編號","地址","總樓層","交易總價(萬)","房屋總價(萬)","車位總價(萬)","房數","廳數","衛浴數","備註","解約情形","戶別","主要用途","建物型態","車位類別","車位價格","車位面積","主建物面積","附屬建物面積","陽台面積"],X=e=>null==e||""===e?"-":"number"==typeof e?Number.isInteger(e)?e.toLocaleString():e.toFixed(2):String(e),Z=(0,i.useMemo)(()=>{let e=[...o];if(w.trim()){let t=w.toLowerCase();e=e.filter(e=>{let i=e[k];return null!=i&&String(i).toLowerCase().includes(t)})}return j.key&&j.direction&&e.sort((e,t)=>{let i=e[j.key],s=t[j.key];if(null==i&&null==s)return 0;if(null==i)return 1;if(null==s)return -1;if("number"==typeof i&&"number"==typeof s)return"asc"===j.direction?i-s:s-i;let n=String(i),l=String(s);return"asc"===j.direction?n.localeCompare(l,"zh-TW"):l.localeCompare(n,"zh-TW")}),e},[o,w,k,j]),J=Math.ceil(Z.length/20),Q=(m-1)*20,ee=Q+20,et=Z.slice(Q,ee);return d?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-20",children:[(0,t.jsx)(M.Loader2,{className:"h-8 w-8 animate-spin text-violet-500 mb-2"}),(0,t.jsx)("p",{className:"text-zinc-500 text-sm",children:"正在載入交易資料相關明細..."})]}):x?(0,t.jsxs)("div",{className:"text-center p-12 text-red-400",children:[(0,t.jsxs)("p",{children:["載入失敗: ",x]}),(0,t.jsx)("button",{onClick:()=>q(),className:"mt-4 px-4 py-2 bg-zinc-800 rounded hover:bg-zinc-700",children:"重試"})]}):o&&0!==o.length?(0,t.jsxs)("div",{className:"space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,t.jsxs)("div",{className:"flex flex-wrap gap-3 items-center p-3 bg-zinc-900/50 rounded-lg border border-white/5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-[200px]",children:[(0,t.jsx)(I.Search,{size:16,className:"text-zinc-500"}),(0,t.jsx)("input",{type:"text",value:w,onChange:e=>{z(e.target.value),p(1)},placeholder:`搜尋 ${k}...`,className:"flex-1 bg-transparent border-none outline-none text-white placeholder-zinc-500 text-sm"}),w&&(0,t.jsx)("button",{onClick:()=>z(""),className:"text-zinc-500 hover:text-white",children:(0,t.jsx)(a.X,{size:14})})]}),(0,t.jsxs)("select",{value:k,onChange:e=>C(e.target.value),className:"bg-zinc-800 border border-zinc-700 rounded px-2 py-1 text-sm text-zinc-300",children:[(0,t.jsx)("option",{value:"建案名稱",children:"建案名稱"}),(0,t.jsx)("option",{value:"行政區",children:"行政區"}),(0,t.jsx)("option",{value:"戶型",children:"戶型"}),(0,t.jsx)("option",{value:"主要用途",children:"主要用途"})]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center text-sm text-zinc-400",children:[(0,t.jsxs)("span",{children:["共 ",(0,t.jsx)("span",{className:"text-white font-semibold",children:Z.length.toLocaleString()})," 筆資料 ",w&&(0,t.jsx)("span",{className:"text-zinc-500",children:"(已篩選)"})]}),(0,t.jsxs)("span",{children:["第 ",m," / ",J||1," 頁"]})]}),(0,t.jsx)(A.ReportWrapper,{title:"交易資料明細",description:"點擊表頭可排序，點擊「明細」可展開詳細資訊",headerAction:(0,t.jsx)(O.ExportButton,{data:Z,filename:"transaction_list_data",label:"匯出明細表"}),children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,t.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold sticky top-0",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-3 py-3 w-28 text-center",children:"操作"}),G.map(e=>{var i;return(0,t.jsx)("th",{className:(0,r.cn)("px-3 py-3 whitespace-nowrap",e.sortable&&"cursor-pointer select-none group hover:text-white transition-colors"),onClick:()=>{var t;return e.sortable&&(t=e.key,void(N(e=>{if(e.key===t){if("asc"===e.direction)return{key:t,direction:"desc"};if("desc"===e.direction)return{key:"",direction:null}}return{key:t,direction:"asc"}}),p(1)))},children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[e.label,e.sortable&&(i=e.key,j.key!==i?(0,t.jsx)(T.ArrowUpDown,{size:12,className:"opacity-30 group-hover:opacity-70"}):"asc"===j.direction?(0,t.jsx)(E.ChevronUp,{size:12,className:"text-violet-400"}):(0,t.jsx)(D.ChevronDown,{size:12,className:"text-violet-400"}))]})},e.key)})]})}),(0,t.jsxs)("tbody",{className:"divide-y divide-white/5",children:[et.map((e,s)=>{let n=Q+s,l=f.has(n);return(0,t.jsxs)(i.default.Fragment,{children:[(0,t.jsxs)("tr",{className:(0,r.cn)("hover:bg-zinc-800/50 transition-colors",l&&"bg-zinc-800/30"),children:[(0,t.jsx)("td",{className:"px-3 py-2",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 justify-center",children:[(0,t.jsxs)("button",{onClick:()=>W(e),className:"px-2 py-1 rounded text-xs font-medium bg-cyan-900/30 text-cyan-400 hover:bg-cyan-900/50 hover:text-cyan-300 transition-colors flex items-center gap-1 border border-cyan-800/50",title:"查看車位或其他附表資料",children:[(0,t.jsx)(_,{size:12}),"附表"]}),(0,t.jsxs)("button",{onClick:()=>{g(e=>{let t=new Set(e);return t.has(n)?t.delete(n):t.add(n),t})},className:(0,r.cn)("flex items-center gap-1 px-2 py-1 rounded text-xs font-medium transition-colors border",l?"bg-violet-500/20 text-violet-300 border-violet-500/30":"bg-zinc-800 text-zinc-400 border-zinc-700 hover:bg-zinc-700 hover:text-zinc-200"),children:[l?(0,t.jsx)(E.ChevronUp,{size:12}):(0,t.jsx)(D.ChevronDown,{size:12}),"明細"]})]})}),G.map(i=>(0,t.jsx)("td",{className:"px-3 py-2 whitespace-nowrap",children:"戶型"===i.key?(0,t.jsx)("span",{className:"cursor-help border-b border-dotted border-zinc-600",title:`原始戶別: ${e["戶別"]||"無資料"}`,children:X(e[i.key])}):(0,t.jsx)("span",{className:(0,r.cn)("房屋單價(萬)"===i.key&&"font-mono text-violet-400","建案名稱"===i.key&&"font-medium text-white"),children:X(e[i.key])})},i.key))]}),l&&(0,t.jsx)("tr",{className:"bg-zinc-900/50",children:(0,t.jsx)("td",{colSpan:G.length+1,className:"px-4 py-4",children:(0,t.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3",children:Y.map(i=>i in e?(0,t.jsxs)("div",{className:"bg-zinc-800/50 rounded p-2",children:[(0,t.jsx)("div",{className:"text-xs text-zinc-500 mb-1",children:i}),(0,t.jsx)("div",{className:"text-sm text-zinc-200 font-mono",children:X(e[i])})]},i):null)})})})]},n)}),0===et.length&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:G.length+1,className:"text-center py-8 text-zinc-500",children:"無符合條件的資料"})})]})]})})}),(0,t.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t border-white/5",children:[(0,t.jsxs)("div",{className:"text-sm text-zinc-500",children:["顯示第 ",Z.length>0?Q+1:0," - ",Math.min(ee,Z.length)," 筆"]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{onClick:()=>p(e=>Math.max(1,e-1)),disabled:1===m,className:"p-2 rounded bg-zinc-800 text-zinc-300 hover:bg-zinc-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,t.jsx)(R.ChevronLeft,{size:16})}),(0,t.jsx)("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,J||1)},(e,i)=>{let s,n=J||1;return(s=n<=5||m<=3?i+1:m>=n-2?n-4+i:m-2+i)<1||s>n?null:(0,t.jsx)("button",{onClick:()=>p(s),className:(0,r.cn)("w-8 h-8 rounded text-sm font-medium transition-colors",m===s?"bg-violet-500 text-white":"bg-zinc-800 text-zinc-400 hover:bg-zinc-700"),children:s},s)})}),(0,t.jsx)("button",{onClick:()=>p(e=>Math.min(J||1,e+1)),disabled:m===J||0===J,className:"p-2 rounded bg-zinc-800 text-zinc-300 hover:bg-zinc-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,t.jsx)(S.ChevronRight,{size:16})})]})]}),(0,t.jsx)(F.Modal,{isOpen:P,onClose:()=>L(!1),className:"max-w-5xl",title:(0,t.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(_,{className:"text-cyan-400"}),(0,t.jsx)("span",{children:U})]}),(0,t.jsx)(O.ExportButton,{data:$,filename:`sub_table_${U}`,label:"匯出附表",className:"ml-4"})]}),children:H?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,t.jsx)(M.Loader2,{className:"h-8 w-8 animate-spin text-cyan-400 mb-3"}),(0,t.jsx)("p",{className:"text-zinc-500 text-sm animate-pulse",children:"正在讀取附表資料..."})]}):$.length>0?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"bg-zinc-800/30 rounded-lg overflow-hidden border border-white/5",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,t.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-3 whitespace-nowrap bg-zinc-900 text-cyan-400",children:"類別"}),Object.keys($[0]).filter(e=>"id"!==e&&"編號"!==e&&"created_at"!==e&&"_category"!==e&&"車位價格"!==e&&"車位面積"!==e).map(e=>(0,t.jsx)("th",{className:"px-4 py-3 whitespace-nowrap bg-zinc-900",children:e},e))]})}),(0,t.jsx)("tbody",{className:"divide-y divide-white/5",children:$.map((e,i)=>(0,t.jsxs)("tr",{className:"hover:bg-zinc-800/50 transition-colors",children:[(0,t.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-cyan-400 font-medium",children:e._category||"附表"}),Object.keys(e).filter(e=>"id"!==e&&"編號"!==e&&"created_at"!==e&&"_category"!==e&&"車位價格"!==e&&"車位面積"!==e).map(i=>(0,t.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-zinc-300",children:X(e[i])},i))]},i))})]})})}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsx)("button",{onClick:()=>L(!1),className:"px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-sm text-white rounded transition-colors",children:"關閉"})})]}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-zinc-500",children:[(0,t.jsx)("div",{className:"bg-zinc-800/50 p-4 rounded-full mb-3",children:(0,t.jsx)(_,{size:24,className:"opacity-20"})}),(0,t.jsx)("p",{children:"此筆交易沒有相關附表資料"})]})})]}):(0,t.jsx)("div",{className:"text-center p-12 text-zinc-500",children:"無交易資料可顯示"})}var L=e.i(59264),$=e.i(10115),B=e.i(33209),H=e.i(93814),K=e.i(33142);function U(e){var s;let n,l=(s=e,(n=i.forwardRef((e,t)=>{let{children:s,...n}=e;if(i.isValidElement(s)){var l;let e,r,a=(l=s,(r=(e=Object.getOwnPropertyDescriptor(l.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?l.ref:(r=(e=Object.getOwnPropertyDescriptor(l,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?l.props.ref:l.props.ref||l.ref),o=function(e,t){let i={...t};for(let s in t){let n=e[s],l=t[s];/^on[A-Z]/.test(s)?n&&l?i[s]=(...e)=>{let t=l(...e);return n(...e),t}:n&&(i[s]=n):"style"===s?i[s]={...n,...l}:"className"===s&&(i[s]=[n,l].filter(Boolean).join(" "))}return{...e,...i}}(n,s.props);return s.type!==i.Fragment&&(o.ref=t?(0,K.composeRefs)(t,a):a),i.cloneElement(s,o)}return i.Children.count(s)>1?i.Children.only(null):null})).displayName=`${s}.SlotClone`,n),r=i.forwardRef((e,s)=>{let{children:n,...r}=e,a=i.Children.toArray(n),o=a.find(q);if(o){let e=o.props.children,n=a.map(t=>t!==o?t:i.Children.count(e)>1?i.Children.only(null):i.isValidElement(e)?e.props.children:null);return(0,t.jsx)(l,{...r,ref:s,children:i.isValidElement(e)?i.cloneElement(e,void 0,n):null})}return(0,t.jsx)(l,{...r,ref:s,children:n})});return r.displayName=`${e}.Slot`,r}var V=Symbol("radix.slottable");function q(e){return i.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===V}var W=new WeakMap;function G(e,t){var i,s;let n,l,r;if("at"in Array.prototype)return Array.prototype.at.call(e,t);let a=(i=e,s=t,n=i.length,(r=(l=Y(s))>=0?l:n+l)<0||r>=n?-1:r);return -1===a?void 0:e[a]}function Y(e){return e!=e||0===e?0:Math.trunc(e)}(class e extends Map{#e;constructor(e){super(e),this.#e=[...super.keys()],W.set(this,!0)}set(e,t){return W.get(this)&&(this.has(e)?this.#e[this.#e.indexOf(e)]=e:this.#e.push(e)),super.set(e,t),this}insert(e,t,i){let s,n=this.has(t),l=this.#e.length,r=Y(e),a=r>=0?r:l+r,o=a<0||a>=l?-1:a;if(o===this.size||n&&o===this.size-1||-1===o)return this.set(t,i),this;let c=this.size+ +!n;r<0&&a++;let d=[...this.#e],u=!1;for(let e=a;e<c;e++)if(a===e){let l=d[e];d[e]===t&&(l=d[e+1]),n&&this.delete(t),s=this.get(l),this.set(t,i)}else{u||d[e-1]!==t||(u=!0);let i=d[u?e:e-1],n=s;s=this.get(i),this.delete(i),this.set(i,n)}return this}with(t,i,s){let n=new e(this);return n.insert(t,i,s),n}before(e){let t=this.#e.indexOf(e)-1;if(!(t<0))return this.entryAt(t)}setBefore(e,t,i){let s=this.#e.indexOf(e);return -1===s?this:this.insert(s,t,i)}after(e){let t=this.#e.indexOf(e);if(-1!==(t=-1===t||t===this.size-1?-1:t+1))return this.entryAt(t)}setAfter(e,t,i){let s=this.#e.indexOf(e);return -1===s?this:this.insert(s+1,t,i)}first(){return this.entryAt(0)}last(){return this.entryAt(-1)}clear(){return this.#e=[],super.clear()}delete(e){let t=super.delete(e);return t&&this.#e.splice(this.#e.indexOf(e),1),t}deleteAt(e){let t=this.keyAt(e);return void 0!==t&&this.delete(t)}at(e){let t=G(this.#e,e);if(void 0!==t)return this.get(t)}entryAt(e){let t=G(this.#e,e);if(void 0!==t)return[t,this.get(t)]}indexOf(e){return this.#e.indexOf(e)}keyAt(e){return G(this.#e,e)}from(e,t){let i=this.indexOf(e);if(-1===i)return;let s=i+t;return s<0&&(s=0),s>=this.size&&(s=this.size-1),this.at(s)}keyFrom(e,t){let i=this.indexOf(e);if(-1===i)return;let s=i+t;return s<0&&(s=0),s>=this.size&&(s=this.size-1),this.keyAt(s)}find(e,t){let i=0;for(let s of this){if(Reflect.apply(e,t,[s,i,this]))return s;i++}}findIndex(e,t){let i=0;for(let s of this){if(Reflect.apply(e,t,[s,i,this]))return i;i++}return -1}filter(t,i){let s=[],n=0;for(let e of this)Reflect.apply(t,i,[e,n,this])&&s.push(e),n++;return new e(s)}map(t,i){let s=[],n=0;for(let e of this)s.push([e[0],Reflect.apply(t,i,[e,n,this])]),n++;return new e(s)}reduce(...e){let[t,i]=e,s=0,n=i??this.at(0);for(let i of this)n=0===s&&1===e.length?i:Reflect.apply(t,this,[n,i,s,this]),s++;return n}reduceRight(...e){let[t,i]=e,s=i??this.at(-1);for(let i=this.size-1;i>=0;i--){let n=this.at(i);s=i===this.size-1&&1===e.length?n:Reflect.apply(t,this,[s,n,i,this])}return s}toSorted(t){return new e([...this.entries()].sort(t))}toReversed(){let t=new e;for(let e=this.size-1;e>=0;e--){let i=this.keyAt(e),s=this.get(i);t.set(i,s)}return t}toSpliced(...t){let i=[...this.entries()];return i.splice(...t),new e(i)}slice(t,i){let s=new e,n=this.size-1;if(void 0===t)return s;t<0&&(t+=this.size),void 0!==i&&i>0&&(n=i-1);for(let e=t;e<=n;e++){let t=this.keyAt(e),i=this.get(t);s.set(t,i)}return s}every(e,t){let i=0;for(let s of this){if(!Reflect.apply(e,t,[s,i,this]))return!1;i++}return!0}some(e,t){let i=0;for(let s of this){if(Reflect.apply(e,t,[s,i,this]))return!0;i++}return!1}});var X=e.i(1998),Z=e.i(16482),J=e.i(55751),Q=e.i(40058),ee=i.createContext(void 0);function et(e){let t=i.useContext(ee);return e||t||"ltr"}var ei="rovingFocusGroup.onEntryFocus",es={bubbles:!1,cancelable:!0},en="RovingFocusGroup",[el,er,ea]=function(e){let s=e+"CollectionProvider",[n,l]=(0,H.createContextScope)(s),[r,a]=n(s,{collectionRef:{current:null},itemMap:new Map}),o=e=>{let{scope:s,children:n}=e,l=i.default.useRef(null),a=i.default.useRef(new Map).current;return(0,t.jsx)(r,{scope:s,itemMap:a,collectionRef:l,children:n})};o.displayName=s;let c=e+"CollectionSlot",d=U(c),u=i.default.forwardRef((e,i)=>{let{scope:s,children:n}=e,l=a(c,s),r=(0,K.useComposedRefs)(i,l.collectionRef);return(0,t.jsx)(d,{ref:r,children:n})});u.displayName=c;let x=e+"CollectionItemSlot",h="data-radix-collection-item",m=U(x),p=i.default.forwardRef((e,s)=>{let{scope:n,children:l,...r}=e,o=i.default.useRef(null),c=(0,K.useComposedRefs)(s,o),d=a(x,n);return i.default.useEffect(()=>(d.itemMap.set(o,{ref:o,...r}),()=>void d.itemMap.delete(o))),(0,t.jsx)(m,{...{[h]:""},ref:c,children:l})});return p.displayName=x,[{Provider:o,Slot:u,ItemSlot:p},function(t){let s=a(e+"CollectionConsumer",t);return i.default.useCallback(()=>{let e=s.collectionRef.current;if(!e)return[];let t=Array.from(e.querySelectorAll(`[${h}]`));return Array.from(s.itemMap.values()).sort((e,i)=>t.indexOf(e.ref.current)-t.indexOf(i.ref.current))},[s.collectionRef,s.itemMap])},l]}(en),[eo,ec]=(0,H.createContextScope)(en,[ea]),[ed,eu]=eo(en),ex=i.forwardRef((e,i)=>(0,t.jsx)(el.Provider,{scope:e.__scopeRovingFocusGroup,children:(0,t.jsx)(el.Slot,{scope:e.__scopeRovingFocusGroup,children:(0,t.jsx)(eh,{...e,ref:i})})}));ex.displayName=en;var eh=i.forwardRef((e,s)=>{let{__scopeRovingFocusGroup:n,orientation:l,loop:r=!1,dir:a,currentTabStopId:o,defaultCurrentTabStopId:c,onCurrentTabStopIdChange:d,onEntryFocus:u,preventScrollOnEntryFocus:x=!1,...h}=e,m=i.useRef(null),p=(0,K.useComposedRefs)(s,m),f=et(a),[v,b]=(0,Q.useControllableState)({prop:o,defaultProp:c??null,onChange:d,caller:en}),[y,g]=i.useState(!1),j=(0,J.useCallbackRef)(u),N=er(n),w=i.useRef(!1),[z,k]=i.useState(0);return i.useEffect(()=>{let e=m.current;if(e)return e.addEventListener(ei,j),()=>e.removeEventListener(ei,j)},[j]),(0,t.jsx)(ed,{scope:n,orientation:l,dir:f,loop:r,currentTabStopId:v,onItemFocus:i.useCallback(e=>b(e),[b]),onItemShiftTab:i.useCallback(()=>g(!0),[]),onFocusableItemAdd:i.useCallback(()=>k(e=>e+1),[]),onFocusableItemRemove:i.useCallback(()=>k(e=>e-1),[]),children:(0,t.jsx)(Z.Primitive.div,{tabIndex:y||0===z?-1:0,"data-orientation":l,...h,ref:p,style:{outline:"none",...e.style},onMouseDown:(0,B.composeEventHandlers)(e.onMouseDown,()=>{w.current=!0}),onFocus:(0,B.composeEventHandlers)(e.onFocus,e=>{let t=!w.current;if(e.target===e.currentTarget&&t&&!y){let t=new CustomEvent(ei,es);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){let e=N().filter(e=>e.focusable);ev([e.find(e=>e.active),e.find(e=>e.id===v),...e].filter(Boolean).map(e=>e.ref.current),x)}}w.current=!1}),onBlur:(0,B.composeEventHandlers)(e.onBlur,()=>g(!1))})})}),em="RovingFocusGroupItem",ep=i.forwardRef((e,s)=>{let{__scopeRovingFocusGroup:n,focusable:l=!0,active:r=!1,tabStopId:a,children:o,...c}=e,d=(0,X.useId)(),u=a||d,x=eu(em,n),h=x.currentTabStopId===u,m=er(n),{onFocusableItemAdd:p,onFocusableItemRemove:f,currentTabStopId:v}=x;return i.useEffect(()=>{if(l)return p(),()=>f()},[l,p,f]),(0,t.jsx)(el.ItemSlot,{scope:n,id:u,focusable:l,active:r,children:(0,t.jsx)(Z.Primitive.span,{tabIndex:h?0:-1,"data-orientation":x.orientation,...c,ref:s,onMouseDown:(0,B.composeEventHandlers)(e.onMouseDown,e=>{l?x.onItemFocus(u):e.preventDefault()}),onFocus:(0,B.composeEventHandlers)(e.onFocus,()=>x.onItemFocus(u)),onKeyDown:(0,B.composeEventHandlers)(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey)return void x.onItemShiftTab();if(e.target!==e.currentTarget)return;let t=function(e,t,i){var s;let n=(s=e.key,"rtl"!==i?s:"ArrowLeft"===s?"ArrowRight":"ArrowRight"===s?"ArrowLeft":s);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(n))&&!("horizontal"===t&&["ArrowUp","ArrowDown"].includes(n)))return ef[n]}(e,x.orientation,x.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let n=m().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)n.reverse();else if("prev"===t||"next"===t){var i,s;"prev"===t&&n.reverse();let l=n.indexOf(e.currentTarget);n=x.loop?(i=n,s=l+1,i.map((e,t)=>i[(s+t)%i.length])):n.slice(l+1)}setTimeout(()=>ev(n))}}),children:"function"==typeof o?o({isCurrentTabStop:h,hasTabStop:null!=v}):o})})});ep.displayName=em;var ef={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function ev(e,t=!1){let i=document.activeElement;for(let s of e)if(s===i||(s.focus({preventScroll:t}),document.activeElement!==i))return}var eb=e.i(48179),ey="Tabs",[eg,ej]=(0,H.createContextScope)(ey,[ec]),eN=ec(),[ew,ez]=eg(ey),ek=i.forwardRef((e,i)=>{let{__scopeTabs:s,value:n,onValueChange:l,defaultValue:r,orientation:a="horizontal",dir:o,activationMode:c="automatic",...d}=e,u=et(o),[x,h]=(0,Q.useControllableState)({prop:n,onChange:l,defaultProp:r??"",caller:ey});return(0,t.jsx)(ew,{scope:s,baseId:(0,X.useId)(),value:x,onValueChange:h,orientation:a,dir:u,activationMode:c,children:(0,t.jsx)(Z.Primitive.div,{dir:u,"data-orientation":a,...d,ref:i})})});ek.displayName=ey;var eC="TabsList",eA=i.forwardRef((e,i)=>{let{__scopeTabs:s,loop:n=!0,...l}=e,r=ez(eC,s),a=eN(s);return(0,t.jsx)(ex,{asChild:!0,...a,orientation:r.orientation,dir:r.dir,loop:n,children:(0,t.jsx)(Z.Primitive.div,{role:"tablist","aria-orientation":r.orientation,...l,ref:i})})});eA.displayName=eC;var eR="TabsTrigger",eS=i.forwardRef((e,i)=>{let{__scopeTabs:s,value:n,disabled:l=!1,...r}=e,a=ez(eR,s),o=eN(s),c=eT(a.baseId,n),d=eI(a.baseId,n),u=n===a.value;return(0,t.jsx)(ep,{asChild:!0,...o,focusable:!l,active:u,children:(0,t.jsx)(Z.Primitive.button,{type:"button",role:"tab","aria-selected":u,"aria-controls":d,"data-state":u?"active":"inactive","data-disabled":l?"":void 0,disabled:l,id:c,...r,ref:i,onMouseDown:(0,B.composeEventHandlers)(e.onMouseDown,e=>{l||0!==e.button||!1!==e.ctrlKey?e.preventDefault():a.onValueChange(n)}),onKeyDown:(0,B.composeEventHandlers)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&a.onValueChange(n)}),onFocus:(0,B.composeEventHandlers)(e.onFocus,()=>{let e="manual"!==a.activationMode;u||l||!e||a.onValueChange(n)})})})});eS.displayName=eR;var eD="TabsContent",eE=i.forwardRef((e,s)=>{let{__scopeTabs:n,value:l,forceMount:r,children:a,...o}=e,c=ez(eD,n),d=eT(c.baseId,l),u=eI(c.baseId,l),x=l===c.value,h=i.useRef(x);return i.useEffect(()=>{let e=requestAnimationFrame(()=>h.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,t.jsx)(eb.Presence,{present:r||x,children:({present:i})=>(0,t.jsx)(Z.Primitive.div,{"data-state":x?"active":"inactive","data-orientation":c.orientation,role:"tabpanel","aria-labelledby":d,hidden:!i,id:u,tabIndex:0,...o,ref:s,style:{...e.style,animationDuration:h.current?"0s":void 0},children:i&&a})})});function eT(e,t){return`${e}-trigger-${t}`}function eI(e,t){return`${e}-content-${t}`}eE.displayName=eD;let eM=i.forwardRef(({className:e,...i},s)=>(0,t.jsx)(eA,{ref:s,className:(0,r.cn)("inline-flex h-10 items-center justify-center rounded-md bg-zinc-800 p-1 text-zinc-400",e),...i}));eM.displayName=eA.displayName;let e_=i.forwardRef(({className:e,...i},s)=>(0,t.jsx)(eS,{ref:s,className:(0,r.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-zinc-950 data-[state=active]:text-white data-[state=active]:shadow-sm",e),...i}));e_.displayName=eS.displayName;let eF=i.forwardRef(({className:e,...i},s)=>(0,t.jsx)(eE,{ref:s,className:(0,r.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...i}));eF.displayName=eE.displayName;var eO=e.i(14302);function eP(){(0,l.useFilterStore)();let{loading:e,error:r,analysisData:a,handleAnalyze:o}=(0,eO.useAnalysisData)();return(0,i.useEffect)(()=>{},[]),(0,t.jsxs)(n.AppLayout,{children:[(0,t.jsx)("section",{className:"mb-6 relative z-50",children:(0,t.jsx)(g,{onAnalyze:o,isLoading:e})}),r&&(0,t.jsxs)("div",{className:"bg-red-500/10 border border-red-500/50 text-red-500 p-4 rounded-lg mb-6 flex items-center gap-2",children:[(0,t.jsx)($.AlertCircle,{size:20}),r]}),e&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-20",children:[(0,t.jsx)(M.Loader2,{className:"h-10 w-10 animate-spin text-violet-500 mb-4"}),(0,t.jsx)("p",{className:"text-zinc-400",children:"正在分析數據，請稍候..."})]}),!e&&!a&&!r&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 glass-panel border-dashed border-2 border-zinc-800 rounded-xl",children:[(0,t.jsx)("div",{className:"text-zinc-500 mb-2",children:"尚未進行分析"}),(0,t.jsx)("p",{className:"text-zinc-600 text-sm",children:"請選擇篩選條件並點擊「開始分析」"})]}),!e&&a&&(0,t.jsx)("div",{className:"space-y-8 pb-20",children:(0,t.jsxs)(ek,{defaultValue:"ranking",className:"w-full",children:[(0,t.jsx)("div",{className:"overflow-x-auto pb-2 scrollbar-hide",children:(0,t.jsxs)(eM,{className:"bg-zinc-900/50 border border-white/5 p-1 mb-6 inline-flex min-w-max",children:[(0,t.jsx)(e_,{value:"ranking",children:"核心指標與排名"}),(0,t.jsx)(e_,{value:"price-band",children:"總價帶分析"}),(0,t.jsx)(e_,{value:"unit-price",children:"單價分析"}),(0,t.jsx)(e_,{value:"heatmap",children:"調價熱力圖"}),(0,t.jsx)(e_,{value:"timeline",children:"政策時光機"}),(0,t.jsx)(e_,{value:"velocity",children:"銷售速度與房型"}),(0,t.jsx)(e_,{value:"parking",children:"車位分析"}),(0,t.jsx)(e_,{value:"data-list",children:"交易明細列表"})]})}),(0,t.jsx)(eF,{value:"ranking",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,t.jsx)(s.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,t.jsx)(j.RankingReport,{data:a})})}),(0,t.jsx)(eF,{value:"price-band",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,t.jsx)(s.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,t.jsx)(N.PriceBandReport,{data:{...a.priceBandAnalysis,transactionDetails:a.transactionDetails}})})}),(0,t.jsx)(eF,{value:"unit-price",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,t.jsx)(s.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,t.jsx)(k.UnitPriceAnalysisReport,{data:a})})}),(0,t.jsx)(eF,{value:"heatmap",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,t.jsx)(s.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,t.jsx)(C.HeatmapReport,{data:a})})}),(0,t.jsx)(eF,{value:"timeline",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,t.jsx)(s.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,t.jsx)(L.default,{data:a.transactionDetails})})}),(0,t.jsx)(eF,{value:"velocity",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,t.jsx)(s.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,t.jsx)(w.SalesVelocityReport,{data:a})})}),(0,t.jsx)(eF,{value:"parking",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,t.jsx)(s.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,t.jsx)(z.ParkingAnalysisReport,{data:a})})}),(0,t.jsx)(eF,{value:"data-list",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,t.jsx)(s.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,t.jsx)(P,{trigger:a})})})]})})]})}e.s(["default",()=>eP],77154)}]);