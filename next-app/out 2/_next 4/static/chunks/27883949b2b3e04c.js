(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,78885,e=>{"use strict";let t;var r=e.i(68524);let n=e=>{let t,r=new Set,n=(e,n)=>{let i="function"==typeof e?e(t):e;if(!Object.is(i,t)){let e=t;t=(null!=n?n:"object"!=typeof i||null===i)?i:Object.assign({},t,i),r.forEach(r=>r(t,e))}},i=()=>t,a={setState:n,getState:i,getInitialState:()=>s,subscribe:e=>(r.add(e),()=>r.delete(e))},s=t=e(n,i,a);return a},i=e=>{let t=e?n(e):n,i=e=>(function(e,t=e=>e){let n=r.default.useSyncExternalStore(e.subscribe,r.default.useCallback(()=>t(e.getState()),[e,t]),r.default.useCallback(()=>t(e.getInitialState()),[e,t]));return r.default.useDebugValue(n),n})(t,e);return Object.assign(i,t),i},a={counties:[],districts:[],transactionType:"預售交易",buildingType:"",projectNames:[],dateRange:"1y",startDate:"",endDate:"",excludeCommercial:!1,floorPremium:.3,rankingCurrentPage:1,rankingPageSize:10,currentSort:{key:"saleAmountSum",order:"desc"},currentAverageType:"arithmetic",velocityView:"monthly",velocityMetric:"count"},s=(t=e=>({...a,setCounties:t=>e({counties:t,districts:[]}),setDistricts:t=>e({districts:t}),setTransactionType:t=>e({transactionType:t}),setBuildingType:t=>e({buildingType:t}),setProjectNames:t=>e({projectNames:t}),setDateRange:(t,r,n)=>e(e=>({dateRange:t,startDate:r||e.startDate,endDate:n||e.endDate})),setCustomDate:(t,r)=>e({startDate:t,endDate:r,dateRange:"custom"}),setExcludeCommercial:t=>e({excludeCommercial:t}),setFloorPremium:t=>e({floorPremium:t}),setRankingCurrentPage:t=>e({rankingCurrentPage:t}),setRankingPageSize:t=>e({rankingPageSize:t}),setCurrentSort:t=>e({currentSort:t}),setCurrentAverageType:t=>e({currentAverageType:t}),setVelocityView:t=>e({velocityView:t}),setVelocityMetric:t=>e({velocityMetric:t}),resetFilters:()=>e(a)}))?i(t):i;e.s(["useFilterStore",0,s],78885)},22112,e=>{"use strict";var t=e.i(25191),r=e.i(68524),n=e.i(74614),i=e.i(78841);let a=r.forwardRef(({className:e,children:r,...a},s)=>(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("select",{className:(0,n.cn)("flex h-10 w-full appearance-none rounded-md border border-input bg-zinc-950/50 px-3 py-2 text-sm text-zinc-100 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 pr-8",e),ref:s,...a,children:r}),(0,t.jsx)(i.ChevronDown,{className:"absolute right-3 top-2.5 h-4 w-4 opacity-50 pointer-events-none"})]}));a.displayName="Select",e.s(["Select",()=>a])},42217,e=>{"use strict";var t=e.i(25191),r=e.i(68524),n=e.i(74614);let i=r.forwardRef(({className:e,type:r,...i},a)=>(0,t.jsx)("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-zinc-950/50 px-3 py-2 text-sm text-zinc-100 ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...i}));i.displayName="Input",e.s(["Input",()=>i])},59725,e=>{"use strict";e.s(["getDateRangeDates",0,e=>{let t=new Date,r=new Date;switch(e){case"1q":r.setMonth(t.getMonth()-3);break;case"2q":r.setMonth(t.getMonth()-6);break;case"3q":r.setMonth(t.getMonth()-9);break;case"1y":r.setFullYear(t.getFullYear()-1);break;case"this_year":r=new Date(t.getFullYear(),0,1);break;case"last_2_years":r=new Date(t.getFullYear()-1,0,1);break;case"last_3_years":r=new Date(t.getFullYear()-2,0,1);break;default:return{startDate:"",endDate:""}}return{startDate:r.toISOString().split("T")[0],endDate:t.toISOString().split("T")[0]}}])},78320,36441,34029,50183,67690,e=>{"use strict";var t=e.i(25191),r=e.i(74614);function n({title:e,description:n,children:i,headerAction:a,className:s}){return(0,t.jsxs)("div",{className:(0,r.cn)("bg-zinc-900/50 border border-white/5 rounded-2xl p-4 md:p-6 backdrop-blur-sm",s),children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:e}),n&&(0,t.jsx)("p",{className:"text-zinc-400 text-sm mt-1",children:n})]}),a&&(0,t.jsx)("div",{className:"flex-shrink-0 w-full md:w-auto overflow-x-auto",children:a})]}),i]})}e.s(["ReportWrapper",()=>n],78320);var i=e.i(68524),a=e.i(67123);let s=i.forwardRef(({className:e,...n},i)=>(0,t.jsx)("div",{ref:i,className:(0,r.cn)("glass-panel rounded-xl text-card-foreground",e),...n}));s.displayName="Card";let l=i.forwardRef(({className:e,...n},i)=>(0,t.jsx)("div",{ref:i,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",e),...n}));l.displayName="CardHeader";let o=i.forwardRef(({className:e,...n},i)=>(0,t.jsx)("h3",{ref:i,className:(0,r.cn)("text-lg font-semibold leading-none tracking-tight text-white",e),...n}));o.displayName="CardTitle";let c=i.forwardRef(({className:e,...n},i)=>(0,t.jsx)("p",{ref:i,className:(0,r.cn)("text-sm text-zinc-400",e),...n}));c.displayName="CardDescription";let d=i.forwardRef(({className:e,...n},i)=>(0,t.jsx)("div",{ref:i,className:(0,r.cn)("p-6 pt-0",e),...n}));d.displayName="CardContent",i.forwardRef(({className:e,...n},i)=>(0,t.jsx)("div",{ref:i,className:(0,r.cn)("flex items-center p-6 pt-0",e),...n})).displayName="CardFooter",e.s(["Card",()=>s,"CardContent",()=>d,"CardDescription",()=>c,"CardHeader",()=>l,"CardTitle",()=>o],36441);let x=(0,a.default)(()=>e.A(31593),{loadableGenerated:{modules:[94861]},ssr:!1});function u({type:e,series:r,options:n,height:i=350,title:a,description:l,className:o,loading:c}){let d={chart:{background:"transparent",toolbar:{show:!1}},theme:{mode:"dark",palette:"palette1"},dataLabels:{enabled:!1},grid:{borderColor:"#374151",strokeDashArray:4},xaxis:{labels:{style:{colors:"#9ca3af"}},axisBorder:{color:"#4b5563"},axisTicks:{color:"#4b5563"}},yaxis:{labels:{style:{colors:"#9ca3af"}}},tooltip:{theme:"dark",style:{fontSize:"12px"},x:{show:!0}}},u={...d,...n,chart:{...d.chart,...n.chart}};return(0,t.jsxs)(s,{className:`p-4 ${o}`,children:[(a||l)&&(0,t.jsxs)("div",{className:"mb-4",children:[a&&(0,t.jsx)("h3",{className:"text-lg font-bold text-white mb-1",children:a}),l&&(0,t.jsx)("p",{className:"text-sm text-gray-400",children:l})]}),c?(0,t.jsx)("div",{className:"flex items-center justify-center",style:{height:i},children:(0,t.jsx)("div",{className:"loader"})}):(0,t.jsx)(x,{options:u,series:r,type:e,height:i,width:"100%"})]})}function m({data:e,sortKey:r,limit:n=30,chartType:a="auto"}){let s=(0,i.useMemo)(()=>a&&"auto"!==a?a:["averagePrice","minPrice","maxPrice","medianPrice","avgParkingPrice"].includes(r)?"bar":"treemap",[r,a]),l=(0,i.useMemo)(()=>({averagePrice:{title:"建案平均單價排行",unit:"萬/坪"},minPrice:{title:"建案最低單價排行",unit:"萬/坪"},maxPrice:{title:"建案最高單價排行",unit:"萬/坪"},medianPrice:{title:"建案單價中位數排行",unit:"萬/坪"},avgParkingPrice:{title:"車位平均單價排行",unit:"萬"},saleAmountSum:{title:"建案銷售總額佔比",unit:"萬",yLabel:"銷售總額"},houseAreaSum:{title:"建案房屋面積佔比",unit:"坪",yLabel:"房屋面積"},transactionCount:{title:"建案交易筆數佔比",unit:"筆",yLabel:"資料筆數"}})[r]||{title:"建案分析圖表",unit:"",yLabel:"數值"},[r]),o=(0,i.useMemo)(()=>{if(!e||0===e.length)return[];if("bar"!==s)return e.reduce((e,t)=>e+(t[r]||0),0),[{name:l.yLabel||l.unit,data:e.map(e=>({x:e.projectName,y:parseFloat((e[r]||0).toFixed(2))}))}];{let t=[...e].filter(e=>e[r]>0).sort((e,t)=>t[r]-e[r]).slice(0,n);return[{name:l.unit,data:t.map(e=>parseFloat((e[r]||0).toFixed(2)))}]}},[e,r,s,l,n]),c=(0,i.useMemo)(()=>{let t={title:{text:l.title,align:"center",style:{fontSize:"16px",fontWeight:600,color:"#e5e7eb"}}};if("bar"===s){let i=[...e].filter(e=>e[r]>0).sort((e,t)=>t[r]-e[r]).slice(0,n).map(e=>e.projectName);return{...t,chart:{type:"bar",toolbar:{show:!0},animations:{enabled:!1}},tooltip:{theme:"dark",y:{formatter:e=>`${e.toLocaleString()} ${l.unit}`,title:{formatter:(e,t)=>{let r=i[t?.dataPointIndex];return r?`${r}:`:`${e}:`}}},x:{show:!0,formatter:(e,t)=>i[t?.dataPointIndex]||e}},plotOptions:{bar:{horizontal:!1,columnWidth:"60%",borderRadius:4,distributed:!1}},colors:["#8b5cf6"],fill:{type:"gradient",gradient:{shade:"dark",type:"vertical",shadeIntensity:.5,gradientToColors:["#a78bfa"],inverseColors:!0,opacityFrom:1,opacityTo:1,stops:[0,100]}},dataLabels:{enabled:!1},xaxis:{categories:i,labels:{style:{colors:"#9ca3af"},rotate:-45,trim:!0,maxHeight:100}},yaxis:{title:{text:l.unit,style:{color:"#6b7280"}},labels:{style:{colors:"#e5e7eb",fontSize:"12px",fontWeight:500}}},legend:{show:!1}}}{let n=e.reduce((e,t)=>e+(t[r]||0),0);return{...t,tooltip:{theme:"dark",y:{formatter:e=>`${e.toLocaleString()} ${l.unit}`}},chart:{type:"treemap",height:450,toolbar:{show:!0}},plotOptions:{treemap:{distributed:!0,enableShades:!1,colorScale:{ranges:[{from:0,to:.1*n,color:"#06b6d4"},{from:.1*n,to:.3*n,color:"#3b82f6"},{from:.3*n,to:.6*n,color:"#8b5cf6"},{from:.6*n,to:1/0,color:"#d946ef"}]}}},dataLabels:{enabled:!0,style:{fontSize:"11px",fontWeight:500,colors:["#fff"]},formatter:e=>e,offsetY:-2}}}},[s,o,l,e,r,n]);if(!e||0===e.length)return(0,t.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無排名資料可顯示"});let d="bar"===s&&o[0]?.data?o[0].data.length:0,x="bar"===s?{width:"100%",minWidth:`${45*d}px`}:{width:"100%"};return(0,t.jsx)("div",{className:`w-full ${"bar"===s?"overflow-x-auto pb-4":""}`,children:(0,t.jsx)("div",{style:x,children:(0,t.jsx)(u,{type:"bar"===s?"bar":"treemap",series:o,options:c,height:450,className:"w-full"})})})}e.s(["default",()=>u],34029),e.s(["RankingChart",()=>m],50183);let h=(0,e.i(91568).default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);e.s(["ChevronLeft",()=>h],67690)},50294,e=>{"use strict";let t=(0,e.i(91568).default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);e.s(["ChevronRight",()=>t],50294)},98264,63393,33209,93814,16482,55751,1998,48179,40058,65949,65145,e=>{"use strict";let t;var r,n=e.i(25191),i=e.i(68524),a=e.i(78320),s=e.i(50183),l=e.i(78885),o=e.i(14897),c=e.i(67690),d=e.i(50294),x=e.i(91568);let u=(0,x.default)("arrow-up-down",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);e.s(["ArrowUpDown",()=>u],63393);let m=(0,x.default)("arrow-up",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),h=(0,x.default)("arrow-down",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),p=(0,x.default)("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),f=(0,x.default)("layout-grid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]),g=(0,x.default)("sparkles",[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]]);var b=e.i(41724);let y=(0,x.default)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);var v=e.i(33298),j=e.i(60459),w=e.i(41097);function N(e,t,{checkForDefaultPrevented:r=!0}={}){return function(n){if(e?.(n),!1===r||!n.defaultPrevented)return t?.(n)}}"u">typeof window&&window.document&&window.document.createElement,e.s(["composeEventHandlers",()=>N],33209);var z=e.i(33142);function P(e,t=[]){let r=[],a=()=>{let t=r.map(e=>i.createContext(e));return function(r){let n=r?.[e]||t;return i.useMemo(()=>({[`__scope${e}`]:{...r,[e]:n}}),[r,n])}};return a.scopeName=e,[function(t,a){let s=i.createContext(a),l=r.length;r=[...r,a];let o=t=>{let{scope:r,children:a,...o}=t,c=r?.[e]?.[l]||s,d=i.useMemo(()=>o,Object.values(o));return(0,n.jsx)(c.Provider,{value:d,children:a})};return o.displayName=t+"Provider",[o,function(r,n){let o=n?.[e]?.[l]||s,c=i.useContext(o);if(c)return c;if(void 0!==a)return a;throw Error(`\`${r}\` must be used within \`${t}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let r=()=>{let r=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let n=r.reduce((t,{useScope:r,scopeName:n})=>{let i=r(e)[`__scope${n}`];return{...t,...i}},{});return i.useMemo(()=>({[`__scope${t.scopeName}`]:n}),[n])}};return r.scopeName=t.scopeName,r}(a,...t)]}e.s(["createContextScope",()=>P],93814);var k=e.i(1801),S=Symbol("radix.slottable");function C(e){return i.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===S}var A=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{var r,a;let s,l,o,c=(a=r=`Primitive.${t}`,(s=i.forwardRef((e,t)=>{let{children:r,...n}=e;if(i.isValidElement(r)){var a;let e,s,l=(a=r,(s=(e=Object.getOwnPropertyDescriptor(a.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?a.ref:(s=(e=Object.getOwnPropertyDescriptor(a,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?a.props.ref:a.props.ref||a.ref),o=function(e,t){let r={...t};for(let n in t){let i=e[n],a=t[n];/^on[A-Z]/.test(n)?i&&a?r[n]=(...e)=>{let t=a(...e);return i(...e),t}:i&&(r[n]=i):"style"===n?r[n]={...i,...a}:"className"===n&&(r[n]=[i,a].filter(Boolean).join(" "))}return{...e,...r}}(n,r.props);return r.type!==i.Fragment&&(o.ref=t?(0,z.composeRefs)(t,l):l),i.cloneElement(r,o)}return i.Children.count(r)>1?i.Children.only(null):null})).displayName=`${a}.SlotClone`,l=s,(o=i.forwardRef((e,t)=>{let{children:r,...a}=e,s=i.Children.toArray(r),o=s.find(C);if(o){let e=o.props.children,r=s.map(t=>t!==o?t:i.Children.count(e)>1?i.Children.only(null):i.isValidElement(e)?e.props.children:null);return(0,n.jsx)(l,{...a,ref:t,children:i.isValidElement(e)?i.cloneElement(e,void 0,r):null})}return(0,n.jsx)(l,{...a,ref:t,children:r})})).displayName=`${r}.Slot`,o),d=i.forwardRef((e,r)=>{let{asChild:i,...a}=e;return"u">typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,n.jsx)(i?c:t,{...a,ref:r})});return d.displayName=`Primitive.${t}`,{...e,[t]:d}},{});function M(e,t){e&&k.flushSync(()=>e.dispatchEvent(t))}function _(e){let t=i.useRef(e);return i.useEffect(()=>{t.current=e}),i.useMemo(()=>(...e)=>t.current?.(...e),[])}e.s(["Primitive",()=>A,"dispatchDiscreteCustomEvent",()=>M],16482),e.s(["useCallbackRef",()=>_],55751);var R="dismissableLayer.update",E=i.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),F=i.forwardRef((e,t)=>{let{disableOutsidePointerEvents:a=!1,onEscapeKeyDown:s,onPointerDownOutside:l,onFocusOutside:o,onInteractOutside:c,onDismiss:d,...x}=e,u=i.useContext(E),[m,h]=i.useState(null),p=m?.ownerDocument??globalThis?.document,[,f]=i.useState({}),g=(0,z.useComposedRefs)(t,e=>h(e)),b=Array.from(u.layers),[y]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),v=b.indexOf(y),j=m?b.indexOf(m):-1,w=u.layersWithOutsidePointerEventsDisabled.size>0,P=j>=v,k=function(e,t=globalThis?.document){let r=_(e),n=i.useRef(!1),a=i.useRef(()=>{});return i.useEffect(()=>{let e=e=>{if(e.target&&!n.current){let n=function(){L("dismissableLayer.pointerDownOutside",r,i,{discrete:!0})},i={originalEvent:e};"touch"===e.pointerType?(t.removeEventListener("click",a.current),a.current=n,t.addEventListener("click",a.current,{once:!0})):n()}else t.removeEventListener("click",a.current);n.current=!1},i=window.setTimeout(()=>{t.addEventListener("pointerdown",e)},0);return()=>{window.clearTimeout(i),t.removeEventListener("pointerdown",e),t.removeEventListener("click",a.current)}},[t,r]),{onPointerDownCapture:()=>n.current=!0}}(e=>{let t=e.target,r=[...u.branches].some(e=>e.contains(t));P&&!r&&(l?.(e),c?.(e),e.defaultPrevented||d?.())},p),S=function(e,t=globalThis?.document){let r=_(e),n=i.useRef(!1);return i.useEffect(()=>{let e=e=>{e.target&&!n.current&&L("dismissableLayer.focusOutside",r,{originalEvent:e},{discrete:!1})};return t.addEventListener("focusin",e),()=>t.removeEventListener("focusin",e)},[t,r]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}(e=>{let t=e.target;![...u.branches].some(e=>e.contains(t))&&(o?.(e),c?.(e),e.defaultPrevented||d?.())},p);return!function(e,t=globalThis?.document){let r=_(e);i.useEffect(()=>{let e=e=>{"Escape"===e.key&&r(e)};return t.addEventListener("keydown",e,{capture:!0}),()=>t.removeEventListener("keydown",e,{capture:!0})},[r,t])}(e=>{j===u.layers.size-1&&(s?.(e),!e.defaultPrevented&&d&&(e.preventDefault(),d()))},p),i.useEffect(()=>{if(m)return a&&(0===u.layersWithOutsidePointerEventsDisabled.size&&(r=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(m)),u.layers.add(m),T(),()=>{a&&1===u.layersWithOutsidePointerEventsDisabled.size&&(p.body.style.pointerEvents=r)}},[m,p,a,u]),i.useEffect(()=>()=>{m&&(u.layers.delete(m),u.layersWithOutsidePointerEventsDisabled.delete(m),T())},[m,u]),i.useEffect(()=>{let e=()=>f({});return document.addEventListener(R,e),()=>document.removeEventListener(R,e)},[]),(0,n.jsx)(A.div,{...x,ref:g,style:{pointerEvents:w?P?"auto":"none":void 0,...e.style},onFocusCapture:N(e.onFocusCapture,S.onFocusCapture),onBlurCapture:N(e.onBlurCapture,S.onBlurCapture),onPointerDownCapture:N(e.onPointerDownCapture,k.onPointerDownCapture)})});function T(){let e=new CustomEvent(R);document.dispatchEvent(e)}function L(e,t,r,{discrete:n}){let i=r.originalEvent.target,a=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&i.addEventListener(e,t,{once:!0}),n?M(i,a):i.dispatchEvent(a)}F.displayName="DismissableLayer",i.forwardRef((e,t)=>{let r=i.useContext(E),a=i.useRef(null),s=(0,z.useComposedRefs)(t,a);return i.useEffect(()=>{let e=a.current;if(e)return r.branches.add(e),()=>{r.branches.delete(e)}},[r.branches]),(0,n.jsx)(A.div,{...e,ref:s})}).displayName="DismissableLayerBranch";var D=globalThis?.document?i.useLayoutEffect:()=>{},$=i[" useId ".trim().toString()]||(()=>void 0),I=0;function O(e){let[t,r]=i.useState($());return D(()=>{e||r(e=>e??String(I++))},[e]),e||(t?`radix-${t}`:"")}e.s(["useId",()=>O],1998);let B=["top","right","bottom","left"],W=Math.min,H=Math.max,q=Math.round,V=Math.floor,Z=e=>({x:e,y:e}),U={left:"right",right:"left",bottom:"top",top:"bottom"},Y={start:"end",end:"start"};function X(e,t){return"function"==typeof e?e(t):e}function G(e){return e.split("-")[0]}function K(e){return e.split("-")[1]}function Q(e){return"x"===e?"y":"x"}function J(e){return"y"===e?"height":"width"}let ee=new Set(["top","bottom"]);function et(e){return ee.has(G(e))?"y":"x"}function er(e){return e.replace(/start|end/g,e=>Y[e])}let en=["left","right"],ei=["right","left"],ea=["top","bottom"],es=["bottom","top"];function el(e){return e.replace(/left|right|bottom|top/g,e=>U[e])}function eo(e){return"number"!=typeof e?{top:0,right:0,bottom:0,left:0,...e}:{top:e,right:e,bottom:e,left:e}}function ec(e){let{x:t,y:r,width:n,height:i}=e;return{width:n,height:i,top:r,left:t,right:t+n,bottom:r+i,x:t,y:r}}function ed(e,t,r){let n,{reference:i,floating:a}=e,s=et(t),l=Q(et(t)),o=J(l),c=G(t),d="y"===s,x=i.x+i.width/2-a.width/2,u=i.y+i.height/2-a.height/2,m=i[o]/2-a[o]/2;switch(c){case"top":n={x:x,y:i.y-a.height};break;case"bottom":n={x:x,y:i.y+i.height};break;case"right":n={x:i.x+i.width,y:u};break;case"left":n={x:i.x-a.width,y:u};break;default:n={x:i.x,y:i.y}}switch(K(t)){case"start":n[l]-=m*(r&&d?-1:1);break;case"end":n[l]+=m*(r&&d?-1:1)}return n}let ex=async(e,t,r)=>{let{placement:n="bottom",strategy:i="absolute",middleware:a=[],platform:s}=r,l=a.filter(Boolean),o=await (null==s.isRTL?void 0:s.isRTL(t)),c=await s.getElementRects({reference:e,floating:t,strategy:i}),{x:d,y:x}=ed(c,n,o),u=n,m={},h=0;for(let r=0;r<l.length;r++){let{name:a,fn:p}=l[r],{x:f,y:g,data:b,reset:y}=await p({x:d,y:x,initialPlacement:n,placement:u,strategy:i,middlewareData:m,rects:c,platform:s,elements:{reference:e,floating:t}});d=null!=f?f:d,x=null!=g?g:x,m={...m,[a]:{...m[a],...b}},y&&h<=50&&(h++,"object"==typeof y&&(y.placement&&(u=y.placement),y.rects&&(c=!0===y.rects?await s.getElementRects({reference:e,floating:t,strategy:i}):y.rects),{x:d,y:x}=ed(c,u,o)),r=-1)}return{x:d,y:x,placement:u,strategy:i,middlewareData:m}};async function eu(e,t){var r;void 0===t&&(t={});let{x:n,y:i,platform:a,rects:s,elements:l,strategy:o}=e,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:x="floating",altBoundary:u=!1,padding:m=0}=X(t,e),h=eo(m),p=l[u?"floating"===x?"reference":"floating":x],f=ec(await a.getClippingRect({element:null==(r=await (null==a.isElement?void 0:a.isElement(p)))||r?p:p.contextElement||await (null==a.getDocumentElement?void 0:a.getDocumentElement(l.floating)),boundary:c,rootBoundary:d,strategy:o})),g="floating"===x?{x:n,y:i,width:s.floating.width,height:s.floating.height}:s.reference,b=await (null==a.getOffsetParent?void 0:a.getOffsetParent(l.floating)),y=await (null==a.isElement?void 0:a.isElement(b))&&await (null==a.getScale?void 0:a.getScale(b))||{x:1,y:1},v=ec(a.convertOffsetParentRelativeRectToViewportRelativeRect?await a.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:g,offsetParent:b,strategy:o}):g);return{top:(f.top-v.top+h.top)/y.y,bottom:(v.bottom-f.bottom+h.bottom)/y.y,left:(f.left-v.left+h.left)/y.x,right:(v.right-f.right+h.right)/y.x}}function em(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function eh(e){return B.some(t=>e[t]>=0)}let ep=new Set(["left","top"]);async function ef(e,t){let{placement:r,platform:n,elements:i}=e,a=await (null==n.isRTL?void 0:n.isRTL(i.floating)),s=G(r),l=K(r),o="y"===et(r),c=ep.has(s)?-1:1,d=a&&o?-1:1,x=X(t,e),{mainAxis:u,crossAxis:m,alignmentAxis:h}="number"==typeof x?{mainAxis:x,crossAxis:0,alignmentAxis:null}:{mainAxis:x.mainAxis||0,crossAxis:x.crossAxis||0,alignmentAxis:x.alignmentAxis};return l&&"number"==typeof h&&(m="end"===l?-1*h:h),o?{x:m*d,y:u*c}:{x:u*c,y:m*d}}function eg(){return"u">typeof window}function eb(e){return ej(e)?(e.nodeName||"").toLowerCase():"#document"}function ey(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function ev(e){var t;return null==(t=(ej(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function ej(e){return!!eg()&&(e instanceof Node||e instanceof ey(e).Node)}function ew(e){return!!eg()&&(e instanceof Element||e instanceof ey(e).Element)}function eN(e){return!!eg()&&(e instanceof HTMLElement||e instanceof ey(e).HTMLElement)}function ez(e){return!(!eg()||"u"<typeof ShadowRoot)&&(e instanceof ShadowRoot||e instanceof ey(e).ShadowRoot)}let eP=new Set(["inline","contents"]);function ek(e){let{overflow:t,overflowX:r,overflowY:n,display:i}=eD(e);return/auto|scroll|overlay|hidden|clip/.test(t+n+r)&&!eP.has(i)}let eS=new Set(["table","td","th"]),eC=[":popover-open",":modal"];function eA(e){return eC.some(t=>{try{return e.matches(t)}catch(e){return!1}})}let eM=["transform","translate","scale","rotate","perspective"],e_=["transform","translate","scale","rotate","perspective","filter"],eR=["paint","layout","strict","content"];function eE(e){let t=eF(),r=ew(e)?eD(e):e;return eM.some(e=>!!r[e]&&"none"!==r[e])||!!r.containerType&&"normal"!==r.containerType||!t&&!!r.backdropFilter&&"none"!==r.backdropFilter||!t&&!!r.filter&&"none"!==r.filter||e_.some(e=>(r.willChange||"").includes(e))||eR.some(e=>(r.contain||"").includes(e))}function eF(){return!("u"<typeof CSS)&&!!CSS.supports&&CSS.supports("-webkit-backdrop-filter","none")}let eT=new Set(["html","body","#document"]);function eL(e){return eT.has(eb(e))}function eD(e){return ey(e).getComputedStyle(e)}function e$(e){return ew(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function eI(e){if("html"===eb(e))return e;let t=e.assignedSlot||e.parentNode||ez(e)&&e.host||ev(e);return ez(t)?t.host:t}function eO(e,t,r){var n;void 0===t&&(t=[]),void 0===r&&(r=!0);let i=function e(t){let r=eI(t);return eL(r)?t.ownerDocument?t.ownerDocument.body:t.body:eN(r)&&ek(r)?r:e(r)}(e),a=i===(null==(n=e.ownerDocument)?void 0:n.body),s=ey(i);if(a){let e=eB(s);return t.concat(s,s.visualViewport||[],ek(i)?i:[],e&&r?eO(e):[])}return t.concat(i,eO(i,[],r))}function eB(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function eW(e){let t=eD(e),r=parseFloat(t.width)||0,n=parseFloat(t.height)||0,i=eN(e),a=i?e.offsetWidth:r,s=i?e.offsetHeight:n,l=q(r)!==a||q(n)!==s;return l&&(r=a,n=s),{width:r,height:n,$:l}}function eH(e){return ew(e)?e:e.contextElement}function eq(e){let t=eH(e);if(!eN(t))return Z(1);let r=t.getBoundingClientRect(),{width:n,height:i,$:a}=eW(t),s=(a?q(r.width):r.width)/n,l=(a?q(r.height):r.height)/i;return s&&Number.isFinite(s)||(s=1),l&&Number.isFinite(l)||(l=1),{x:s,y:l}}let eV=Z(0);function eZ(e){let t=ey(e);return eF()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:eV}function eU(e,t,r,n){var i;void 0===t&&(t=!1),void 0===r&&(r=!1);let a=e.getBoundingClientRect(),s=eH(e),l=Z(1);t&&(n?ew(n)&&(l=eq(n)):l=eq(e));let o=(void 0===(i=r)&&(i=!1),n&&(!i||n===ey(s))&&i)?eZ(s):Z(0),c=(a.left+o.x)/l.x,d=(a.top+o.y)/l.y,x=a.width/l.x,u=a.height/l.y;if(s){let e=ey(s),t=n&&ew(n)?ey(n):n,r=e,i=eB(r);for(;i&&n&&t!==r;){let e=eq(i),t=i.getBoundingClientRect(),n=eD(i),a=t.left+(i.clientLeft+parseFloat(n.paddingLeft))*e.x,s=t.top+(i.clientTop+parseFloat(n.paddingTop))*e.y;c*=e.x,d*=e.y,x*=e.x,u*=e.y,c+=a,d+=s,i=eB(r=ey(i))}}return ec({width:x,height:u,x:c,y:d})}function eY(e,t){let r=e$(e).scrollLeft;return t?t.left+r:eU(ev(e)).left+r}function eX(e,t){let r=e.getBoundingClientRect();return{x:r.left+t.scrollLeft-eY(e,r),y:r.top+t.scrollTop}}let eG=new Set(["absolute","fixed"]);function eK(e,t,r){var n;let i;if("viewport"===t)i=function(e,t){let r=ey(e),n=ev(e),i=r.visualViewport,a=n.clientWidth,s=n.clientHeight,l=0,o=0;if(i){a=i.width,s=i.height;let e=eF();(!e||e&&"fixed"===t)&&(l=i.offsetLeft,o=i.offsetTop)}let c=eY(n);if(c<=0){let e=n.ownerDocument,t=e.body,r=getComputedStyle(t),i="CSS1Compat"===e.compatMode&&parseFloat(r.marginLeft)+parseFloat(r.marginRight)||0,s=Math.abs(n.clientWidth-t.clientWidth-i);s<=25&&(a-=s)}else c<=25&&(a+=c);return{width:a,height:s,x:l,y:o}}(e,r);else if("document"===t){let t,r,a,s,l,o,c;n=ev(e),t=ev(n),r=e$(n),a=n.ownerDocument.body,s=H(t.scrollWidth,t.clientWidth,a.scrollWidth,a.clientWidth),l=H(t.scrollHeight,t.clientHeight,a.scrollHeight,a.clientHeight),o=-r.scrollLeft+eY(n),c=-r.scrollTop,"rtl"===eD(a).direction&&(o+=H(t.clientWidth,a.clientWidth)-s),i={width:s,height:l,x:o,y:c}}else if(ew(t)){let e,n,a,s,l,o;n=(e=eU(t,!0,"fixed"===r)).top+t.clientTop,a=e.left+t.clientLeft,s=eN(t)?eq(t):Z(1),l=t.clientWidth*s.x,o=t.clientHeight*s.y,i={width:l,height:o,x:a*s.x,y:n*s.y}}else{let r=eZ(e);i={x:t.x-r.x,y:t.y-r.y,width:t.width,height:t.height}}return ec(i)}function eQ(e){return"static"===eD(e).position}function eJ(e,t){if(!eN(e)||"fixed"===eD(e).position)return null;if(t)return t(e);let r=e.offsetParent;return ev(e)===r&&(r=r.ownerDocument.body),r}function e0(e,t){var r;let n=ey(e);if(eA(e))return n;if(!eN(e)){let t=eI(e);for(;t&&!eL(t);){if(ew(t)&&!eQ(t))return t;t=eI(t)}return n}let i=eJ(e,t);for(;i&&(r=i,eS.has(eb(r)))&&eQ(i);)i=eJ(i,t);return i&&eL(i)&&eQ(i)&&!eE(i)?n:i||function(e){let t=eI(e);for(;eN(t)&&!eL(t);){if(eE(t))return t;if(eA(t))break;t=eI(t)}return null}(e)||n}let e1=async function(e){let t=this.getOffsetParent||e0,r=this.getDimensions,n=await r(e.floating);return{reference:function(e,t,r){let n=eN(t),i=ev(t),a="fixed"===r,s=eU(e,!0,a,t),l={scrollLeft:0,scrollTop:0},o=Z(0);if(n||!n&&!a)if(("body"!==eb(t)||ek(i))&&(l=e$(t)),n){let e=eU(t,!0,a,t);o.x=e.x+t.clientLeft,o.y=e.y+t.clientTop}else i&&(o.x=eY(i));a&&!n&&i&&(o.x=eY(i));let c=!i||n||a?Z(0):eX(i,l);return{x:s.left+l.scrollLeft-o.x-c.x,y:s.top+l.scrollTop-o.y-c.y,width:s.width,height:s.height}}(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}},e2={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{elements:t,rect:r,offsetParent:n,strategy:i}=e,a="fixed"===i,s=ev(n),l=!!t&&eA(t.floating);if(n===s||l&&a)return r;let o={scrollLeft:0,scrollTop:0},c=Z(1),d=Z(0),x=eN(n);if((x||!x&&!a)&&(("body"!==eb(n)||ek(s))&&(o=e$(n)),eN(n))){let e=eU(n);c=eq(n),d.x=e.x+n.clientLeft,d.y=e.y+n.clientTop}let u=!s||x||a?Z(0):eX(s,o);return{width:r.width*c.x,height:r.height*c.y,x:r.x*c.x-o.scrollLeft*c.x+d.x+u.x,y:r.y*c.y-o.scrollTop*c.y+d.y+u.y}},getDocumentElement:ev,getClippingRect:function(e){let{element:t,boundary:r,rootBoundary:n,strategy:i}=e,a=[..."clippingAncestors"===r?eA(t)?[]:function(e,t){let r=t.get(e);if(r)return r;let n=eO(e,[],!1).filter(e=>ew(e)&&"body"!==eb(e)),i=null,a="fixed"===eD(e).position,s=a?eI(e):e;for(;ew(s)&&!eL(s);){let t=eD(s),r=eE(s);r||"fixed"!==t.position||(i=null),(a?!r&&!i:!r&&"static"===t.position&&!!i&&eG.has(i.position)||ek(s)&&!r&&function e(t,r){let n=eI(t);return!(n===r||!ew(n)||eL(n))&&("fixed"===eD(n).position||e(n,r))}(e,s))?n=n.filter(e=>e!==s):i=t,s=eI(s)}return t.set(e,n),n}(t,this._c):[].concat(r),n],s=a[0],l=a.reduce((e,r)=>{let n=eK(t,r,i);return e.top=H(n.top,e.top),e.right=W(n.right,e.right),e.bottom=W(n.bottom,e.bottom),e.left=H(n.left,e.left),e},eK(t,s,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}},getOffsetParent:e0,getElementRects:e1,getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){let{width:t,height:r}=eW(e);return{width:t,height:r}},getScale:eq,isElement:ew,isRTL:function(e){return"rtl"===eD(e).direction}};function e5(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}let e4=e=>({name:"arrow",options:e,async fn(t){let{x:r,y:n,placement:i,rects:a,platform:s,elements:l,middlewareData:o}=t,{element:c,padding:d=0}=X(e,t)||{};if(null==c)return{};let x=eo(d),u={x:r,y:n},m=Q(et(i)),h=J(m),p=await s.getDimensions(c),f="y"===m,g=f?"clientHeight":"clientWidth",b=a.reference[h]+a.reference[m]-u[m]-a.floating[h],y=u[m]-a.reference[m],v=await (null==s.getOffsetParent?void 0:s.getOffsetParent(c)),j=v?v[g]:0;j&&await (null==s.isElement?void 0:s.isElement(v))||(j=l.floating[g]||a.floating[h]);let w=j/2-p[h]/2-1,N=W(x[f?"top":"left"],w),z=W(x[f?"bottom":"right"],w),P=j-p[h]-z,k=j/2-p[h]/2+(b/2-y/2),S=H(N,W(k,P)),C=!o.arrow&&null!=K(i)&&k!==S&&a.reference[h]/2-(k<N?N:z)-p[h]/2<0,A=C?k<N?k-N:k-P:0;return{[m]:u[m]+A,data:{[m]:S,centerOffset:k-S-A,...C&&{alignmentOffset:A}},reset:C}}});var e3="u">typeof document?i.useLayoutEffect:function(){};function e8(e,t){let r,n,i;if(e===t)return!0;if(typeof e!=typeof t)return!1;if("function"==typeof e&&e.toString()===t.toString())return!0;if(e&&t&&"object"==typeof e){if(Array.isArray(e)){if((r=e.length)!==t.length)return!1;for(n=r;0!=n--;)if(!e8(e[n],t[n]))return!1;return!0}if((r=(i=Object.keys(e)).length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!({}).hasOwnProperty.call(t,i[n]))return!1;for(n=r;0!=n--;){let r=i[n];if(("_owner"!==r||!e.$$typeof)&&!e8(e[r],t[r]))return!1}return!0}return e!=e&&t!=t}function e6(e){return"u"<typeof window?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function e9(e,t){let r=e6(e);return Math.round(t*r)/r}function e7(e){let t=i.useRef(e);return e3(()=>{t.current=e}),t}var te=i.forwardRef((e,t)=>{let{children:r,width:i=10,height:a=5,...s}=e;return(0,n.jsx)(A.svg,{...s,ref:t,width:i,height:a,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:(0,n.jsx)("polygon",{points:"0,0 30,0 15,10"})})});te.displayName="Arrow";var tt="Popper",[tr,tn]=P(tt),[ti,ta]=tr(tt),ts=e=>{let{__scopePopper:t,children:r}=e,[a,s]=i.useState(null);return(0,n.jsx)(ti,{scope:t,anchor:a,onAnchorChange:s,children:r})};ts.displayName=tt;var tl="PopperAnchor",to=i.forwardRef((e,t)=>{let{__scopePopper:r,virtualRef:a,...s}=e,l=ta(tl,r),o=i.useRef(null),c=(0,z.useComposedRefs)(t,o),d=i.useRef(null);return i.useEffect(()=>{let e=d.current;d.current=a?.current||o.current,e!==d.current&&l.onAnchorChange(d.current)}),a?null:(0,n.jsx)(A.div,{...s,ref:c})});to.displayName=tl;var tc="PopperContent",[td,tx]=tr(tc),tu=i.forwardRef((e,t)=>{var r,a,s,l,o,c,d,x,u,m,h,p,f;let{__scopePopper:g,side:b="bottom",sideOffset:y=0,align:v="center",alignOffset:j=0,arrowPadding:w=0,avoidCollisions:N=!0,collisionBoundary:P=[],collisionPadding:S=0,sticky:C="partial",hideWhenDetached:M=!1,updatePositionStrategy:R="optimized",onPlaced:E,...F}=e,T=ta(tc,g),[L,$]=i.useState(null),I=(0,z.useComposedRefs)(t,e=>$(e)),[O,B]=i.useState(null),q=function(e){let[t,r]=i.useState(void 0);return D(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{let n,i;if(!Array.isArray(t)||!t.length)return;let a=t[0];if("borderBoxSize"in a){let e=a.borderBoxSize,t=Array.isArray(e)?e[0]:e;n=t.inlineSize,i=t.blockSize}else n=e.offsetWidth,i=e.offsetHeight;r({width:n,height:i})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}r(void 0)},[e]),t}(O),Z=q?.width??0,U=q?.height??0,Y="number"==typeof S?S:{top:0,right:0,bottom:0,left:0,...S},ee=Array.isArray(P)?P:[P],eo=ee.length>0,ec={padding:Y,boundary:ee.filter(tf),altBoundary:eo},{refs:ed,floatingStyles:eg,placement:eb,isPositioned:ey,middlewareData:ej}=function(e){void 0===e&&(e={});let{placement:t="bottom",strategy:r="absolute",middleware:n=[],platform:a,elements:{reference:s,floating:l}={},transform:o=!0,whileElementsMounted:c,open:d}=e,[x,u]=i.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[m,h]=i.useState(n);e8(m,n)||h(n);let[p,f]=i.useState(null),[g,b]=i.useState(null),y=i.useCallback(e=>{e!==N.current&&(N.current=e,f(e))},[]),v=i.useCallback(e=>{e!==z.current&&(z.current=e,b(e))},[]),j=s||p,w=l||g,N=i.useRef(null),z=i.useRef(null),P=i.useRef(x),S=null!=c,C=e7(c),A=e7(a),M=e7(d),_=i.useCallback(()=>{var e,n;let i,a,s;if(!N.current||!z.current)return;let l={placement:t,strategy:r,middleware:m};A.current&&(l.platform=A.current),(e=N.current,n=z.current,i=new Map,s={...(a={platform:e2,...l}).platform,_c:i},ex(e,n,{...a,platform:s})).then(e=>{let t={...e,isPositioned:!1!==M.current};R.current&&!e8(P.current,t)&&(P.current=t,k.flushSync(()=>{u(t)}))})},[m,t,r,A,M]);e3(()=>{!1===d&&P.current.isPositioned&&(P.current.isPositioned=!1,u(e=>({...e,isPositioned:!1})))},[d]);let R=i.useRef(!1);e3(()=>(R.current=!0,()=>{R.current=!1}),[]),e3(()=>{if(j&&(N.current=j),w&&(z.current=w),j&&w){if(C.current)return C.current(j,w,_);_()}},[j,w,_,C,S]);let E=i.useMemo(()=>({reference:N,floating:z,setReference:y,setFloating:v}),[y,v]),F=i.useMemo(()=>({reference:j,floating:w}),[j,w]),T=i.useMemo(()=>{let e={position:r,left:0,top:0};if(!F.floating)return e;let t=e9(F.floating,x.x),n=e9(F.floating,x.y);return o?{...e,transform:"translate("+t+"px, "+n+"px)",...e6(F.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:t,top:n}},[r,o,F.floating,x.x,x.y]);return i.useMemo(()=>({...x,update:_,refs:E,elements:F,floatingStyles:T}),[x,_,E,F,T])}({strategy:"fixed",placement:b+("center"!==v?"-"+v:""),whileElementsMounted:(...e)=>(function(e,t,r,n){let i;void 0===n&&(n={});let{ancestorScroll:a=!0,ancestorResize:s=!0,elementResize:l="function"==typeof ResizeObserver,layoutShift:o="function"==typeof IntersectionObserver,animationFrame:c=!1}=n,d=eH(e),x=a||s?[...d?eO(d):[],...eO(t)]:[];x.forEach(e=>{a&&e.addEventListener("scroll",r,{passive:!0}),s&&e.addEventListener("resize",r)});let u=d&&o?function(e,t){let r,n=null,i=ev(e);function a(){var e;clearTimeout(r),null==(e=n)||e.disconnect(),n=null}return!function s(l,o){void 0===l&&(l=!1),void 0===o&&(o=1),a();let c=e.getBoundingClientRect(),{left:d,top:x,width:u,height:m}=c;if(l||t(),!u||!m)return;let h={rootMargin:-V(x)+"px "+-V(i.clientWidth-(d+u))+"px "+-V(i.clientHeight-(x+m))+"px "+-V(d)+"px",threshold:H(0,W(1,o))||1},p=!0;function f(t){let n=t[0].intersectionRatio;if(n!==o){if(!p)return s();n?s(!1,n):r=setTimeout(()=>{s(!1,1e-7)},1e3)}1!==n||e5(c,e.getBoundingClientRect())||s(),p=!1}try{n=new IntersectionObserver(f,{...h,root:i.ownerDocument})}catch(e){n=new IntersectionObserver(f,h)}n.observe(e)}(!0),a}(d,r):null,m=-1,h=null;l&&(h=new ResizeObserver(e=>{let[n]=e;n&&n.target===d&&h&&(h.unobserve(t),cancelAnimationFrame(m),m=requestAnimationFrame(()=>{var e;null==(e=h)||e.observe(t)})),r()}),d&&!c&&h.observe(d),h.observe(t));let p=c?eU(e):null;return c&&function t(){let n=eU(e);p&&!e5(p,n)&&r(),p=n,i=requestAnimationFrame(t)}(),r(),()=>{var e;x.forEach(e=>{a&&e.removeEventListener("scroll",r),s&&e.removeEventListener("resize",r)}),null==u||u(),null==(e=h)||e.disconnect(),h=null,c&&cancelAnimationFrame(i)}})(...e,{animationFrame:"always"===R}),elements:{reference:T.anchor},middleware:[{...{name:"offset",options:a=r={mainAxis:y+U,alignmentAxis:j},async fn(e){var t,r;let{x:n,y:i,placement:s,middlewareData:l}=e,o=await ef(e,a);return s===(null==(t=l.offset)?void 0:t.placement)&&null!=(r=l.arrow)&&r.alignmentOffset?{}:{x:n+o.x,y:i+o.y,data:{...o,placement:s}}}},options:[r,void 0]},N&&{...{name:"shift",options:o=l={mainAxis:!0,crossAxis:!1,limiter:"partial"===C?{...(s=void 0,{options:s={},fn(e){let{x:t,y:r,placement:n,rects:i,middlewareData:a}=e,{offset:l=0,mainAxis:o=!0,crossAxis:c=!0}=X(s,e),d={x:t,y:r},x=et(n),u=Q(x),m=d[u],h=d[x],p=X(l,e),f="number"==typeof p?{mainAxis:p,crossAxis:0}:{mainAxis:0,crossAxis:0,...p};if(o){let e="y"===u?"height":"width",t=i.reference[u]-i.floating[e]+f.mainAxis,r=i.reference[u]+i.reference[e]-f.mainAxis;m<t?m=t:m>r&&(m=r)}if(c){var g,b;let e="y"===u?"width":"height",t=ep.has(G(n)),r=i.reference[x]-i.floating[e]+(t&&(null==(g=a.offset)?void 0:g[x])||0)+(t?0:f.crossAxis),s=i.reference[x]+i.reference[e]+(t?0:(null==(b=a.offset)?void 0:b[x])||0)-(t?f.crossAxis:0);h<r?h=r:h>s&&(h=s)}return{[u]:m,[x]:h}}}),options:[void 0,void 0]}:void 0,...ec},async fn(e){let{x:t,y:r,placement:n}=e,{mainAxis:i=!0,crossAxis:a=!1,limiter:s={fn:e=>{let{x:t,y:r}=e;return{x:t,y:r}}},...l}=X(o,e),c={x:t,y:r},d=await eu(e,l),x=et(G(n)),u=Q(x),m=c[u],h=c[x];if(i){let e="y"===u?"top":"left",t="y"===u?"bottom":"right",r=m+d[e],n=m-d[t];m=H(r,W(m,n))}if(a){let e="y"===x?"top":"left",t="y"===x?"bottom":"right",r=h+d[e],n=h-d[t];h=H(r,W(h,n))}let p=s.fn({...e,[u]:m,[x]:h});return{...p,data:{x:p.x-t,y:p.y-r,enabled:{[u]:i,[x]:a}}}}},options:[l,void 0]},N&&{...{name:"flip",options:d=c={...ec},async fn(e){var t,r,n,i,a,s,l,o;let c,x,u,{placement:m,middlewareData:h,rects:p,initialPlacement:f,platform:g,elements:b}=e,{mainAxis:y=!0,crossAxis:v=!0,fallbackPlacements:j,fallbackStrategy:w="bestFit",fallbackAxisSideDirection:N="none",flipAlignment:z=!0,...P}=X(d,e);if(null!=(t=h.arrow)&&t.alignmentOffset)return{};let k=G(m),S=et(f),C=G(f)===f,A=await (null==g.isRTL?void 0:g.isRTL(b.floating)),M=j||(C||!z?[el(f)]:(c=el(f),[er(f),c,er(c)])),_="none"!==N;!j&&_&&M.push(...(x=K(f),u=function(e,t,r){switch(e){case"top":case"bottom":if(r)return t?ei:en;return t?en:ei;case"left":case"right":return t?ea:es;default:return[]}}(G(f),"start"===N,A),x&&(u=u.map(e=>e+"-"+x),z&&(u=u.concat(u.map(er)))),u));let R=[f,...M],E=await eu(e,P),F=[],T=(null==(r=h.flip)?void 0:r.overflows)||[];if(y&&F.push(E[k]),v){let e,t,r,n,i=(s=m,l=p,void 0===(o=A)&&(o=!1),e=K(s),r=J(t=Q(et(s))),n="x"===t?e===(o?"end":"start")?"right":"left":"start"===e?"bottom":"top",l.reference[r]>l.floating[r]&&(n=el(n)),[n,el(n)]);F.push(E[i[0]],E[i[1]])}if(T=[...T,{placement:m,overflows:F}],!F.every(e=>e<=0)){let e=((null==(n=h.flip)?void 0:n.index)||0)+1,t=R[e];if(t&&("alignment"!==v||S===et(t)||T.every(e=>et(e.placement)!==S||e.overflows[0]>0)))return{data:{index:e,overflows:T},reset:{placement:t}};let r=null==(i=T.filter(e=>e.overflows[0]<=0).sort((e,t)=>e.overflows[1]-t.overflows[1])[0])?void 0:i.placement;if(!r)switch(w){case"bestFit":{let e=null==(a=T.filter(e=>{if(_){let t=et(e.placement);return t===S||"y"===t}return!0}).map(e=>[e.placement,e.overflows.filter(e=>e>0).reduce((e,t)=>e+t,0)]).sort((e,t)=>e[1]-t[1])[0])?void 0:a[0];e&&(r=e);break}case"initialPlacement":r=f}if(m!==r)return{reset:{placement:r}}}return{}}},options:[c,void 0]},{...{name:"size",options:u=x={...ec,apply:({elements:e,rects:t,availableWidth:r,availableHeight:n})=>{let{width:i,height:a}=t.reference,s=e.floating.style;s.setProperty("--radix-popper-available-width",`${r}px`),s.setProperty("--radix-popper-available-height",`${n}px`),s.setProperty("--radix-popper-anchor-width",`${i}px`),s.setProperty("--radix-popper-anchor-height",`${a}px`)}},async fn(e){var t,r;let n,i,{placement:a,rects:s,platform:l,elements:o}=e,{apply:c=()=>{},...d}=X(u,e),x=await eu(e,d),m=G(a),h=K(a),p="y"===et(a),{width:f,height:g}=s.floating;"top"===m||"bottom"===m?(n=m,i=h===(await (null==l.isRTL?void 0:l.isRTL(o.floating))?"start":"end")?"left":"right"):(i=m,n="end"===h?"top":"bottom");let b=g-x.top-x.bottom,y=f-x.left-x.right,v=W(g-x[n],b),j=W(f-x[i],y),w=!e.middlewareData.shift,N=v,z=j;if(null!=(t=e.middlewareData.shift)&&t.enabled.x&&(z=y),null!=(r=e.middlewareData.shift)&&r.enabled.y&&(N=b),w&&!h){let e=H(x.left,0),t=H(x.right,0),r=H(x.top,0),n=H(x.bottom,0);p?z=f-2*(0!==e||0!==t?e+t:H(x.left,x.right)):N=g-2*(0!==r||0!==n?r+n:H(x.top,x.bottom))}await c({...e,availableWidth:z,availableHeight:N});let P=await l.getDimensions(o.floating);return f!==P.width||g!==P.height?{reset:{rects:!0}}:{}}},options:[x,void 0]},O&&{...{name:"arrow",options:h=m={element:O,padding:w},fn(e){let{element:t,padding:r}="function"==typeof h?h(e):h;return t&&({}).hasOwnProperty.call(t,"current")?null!=t.current?e4({element:t.current,padding:r}).fn(e):{}:t?e4({element:t,padding:r}).fn(e):{}}},options:[m,void 0]},tg({arrowWidth:Z,arrowHeight:U}),M&&{...{name:"hide",options:f=p={strategy:"referenceHidden",...ec},async fn(e){let{rects:t}=e,{strategy:r="referenceHidden",...n}=X(f,e);switch(r){case"referenceHidden":{let r=em(await eu(e,{...n,elementContext:"reference"}),t.reference);return{data:{referenceHiddenOffsets:r,referenceHidden:eh(r)}}}case"escaped":{let r=em(await eu(e,{...n,altBoundary:!0}),t.floating);return{data:{escapedOffsets:r,escaped:eh(r)}}}default:return{}}}},options:[p,void 0]}]}),[ew,eN]=tb(eb),ez=_(E);D(()=>{ey&&ez?.()},[ey,ez]);let eP=ej.arrow?.x,ek=ej.arrow?.y,eS=ej.arrow?.centerOffset!==0,[eC,eA]=i.useState();return D(()=>{L&&eA(window.getComputedStyle(L).zIndex)},[L]),(0,n.jsx)("div",{ref:ed.setFloating,"data-radix-popper-content-wrapper":"",style:{...eg,transform:ey?eg.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:eC,"--radix-popper-transform-origin":[ej.transformOrigin?.x,ej.transformOrigin?.y].join(" "),...ej.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:(0,n.jsx)(td,{scope:g,placedSide:ew,onArrowChange:B,arrowX:eP,arrowY:ek,shouldHideArrow:eS,children:(0,n.jsx)(A.div,{"data-side":ew,"data-align":eN,...F,ref:I,style:{...F.style,animation:ey?void 0:"none"}})})})});tu.displayName=tc;var tm="PopperArrow",th={top:"bottom",right:"left",bottom:"top",left:"right"},tp=i.forwardRef(function(e,t){let{__scopePopper:r,...i}=e,a=tx(tm,r),s=th[a.placedSide];return(0,n.jsx)("span",{ref:a.onArrowChange,style:{position:"absolute",left:a.arrowX,top:a.arrowY,[s]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[a.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[a.placedSide],visibility:a.shouldHideArrow?"hidden":void 0},children:(0,n.jsx)(te,{...i,ref:t,style:{...i.style,display:"block"}})})});function tf(e){return null!==e}tp.displayName=tm;var tg=e=>({name:"transformOrigin",options:e,fn(t){let{placement:r,rects:n,middlewareData:i}=t,a=i.arrow?.centerOffset!==0,s=a?0:e.arrowWidth,l=a?0:e.arrowHeight,[o,c]=tb(r),d={start:"0%",center:"50%",end:"100%"}[c],x=(i.arrow?.x??0)+s/2,u=(i.arrow?.y??0)+l/2,m="",h="";return"bottom"===o?(m=a?d:`${x}px`,h=`${-l}px`):"top"===o?(m=a?d:`${x}px`,h=`${n.floating.height+l}px`):"right"===o?(m=`${-l}px`,h=a?d:`${u}px`):"left"===o&&(m=`${n.floating.width+l}px`,h=a?d:`${u}px`),{data:{x:m,y:h}}}});function tb(e){let[t,r="center"]=e.split("-");return[t,r]}i.forwardRef((e,t)=>{let{container:r,...a}=e,[s,l]=i.useState(!1);D(()=>l(!0),[]);let o=r||s&&globalThis?.document?.body;return o?k.default.createPortal((0,n.jsx)(A.div,{...a,ref:t}),o):null}).displayName="Portal";var ty=e=>{var t;let r,n,{present:a,children:s}=e,l=function(e){var t,r;let[n,a]=i.useState(),s=i.useRef(null),l=i.useRef(e),o=i.useRef("none"),[c,d]=(t=e?"mounted":"unmounted",r={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},i.useReducer((e,t)=>r[e][t]??e,t));return i.useEffect(()=>{let e=tv(s.current);o.current="mounted"===c?e:"none"},[c]),D(()=>{let t=s.current,r=l.current;if(r!==e){let n=o.current,i=tv(t);e?d("MOUNT"):"none"===i||t?.display==="none"?d("UNMOUNT"):r&&n!==i?d("ANIMATION_OUT"):d("UNMOUNT"),l.current=e}},[e,d]),D(()=>{if(n){let e,t=n.ownerDocument.defaultView??window,r=r=>{let i=tv(s.current).includes(CSS.escape(r.animationName));if(r.target===n&&i&&(d("ANIMATION_END"),!l.current)){let r=n.style.animationFillMode;n.style.animationFillMode="forwards",e=t.setTimeout(()=>{"forwards"===n.style.animationFillMode&&(n.style.animationFillMode=r)})}},i=e=>{e.target===n&&(o.current=tv(s.current))};return n.addEventListener("animationstart",i),n.addEventListener("animationcancel",r),n.addEventListener("animationend",r),()=>{t.clearTimeout(e),n.removeEventListener("animationstart",i),n.removeEventListener("animationcancel",r),n.removeEventListener("animationend",r)}}d("ANIMATION_END")},[n,d]),{isPresent:["mounted","unmountSuspended"].includes(c),ref:i.useCallback(e=>{s.current=e?getComputedStyle(e):null,a(e)},[])}}(a),o="function"==typeof s?s({present:l.isPresent}):i.Children.only(s),c=(0,z.useComposedRefs)(l.ref,(t=o,(n=(r=Object.getOwnPropertyDescriptor(t.props,"ref")?.get)&&"isReactWarning"in r&&r.isReactWarning)?t.ref:(n=(r=Object.getOwnPropertyDescriptor(t,"ref")?.get)&&"isReactWarning"in r&&r.isReactWarning)?t.props.ref:t.props.ref||t.ref));return"function"==typeof s||l.isPresent?i.cloneElement(o,{ref:c}):null};function tv(e){return e?.animationName||"none"}ty.displayName="Presence",e.s(["Presence",()=>ty],48179);var tj=Symbol("radix.slottable");i[" useEffectEvent ".trim().toString()],i[" useInsertionEffect ".trim().toString()];var tw=i[" useInsertionEffect ".trim().toString()]||D;function tN({prop:e,defaultProp:t,onChange:r=()=>{},caller:n}){let[a,s,l]=function({defaultProp:e,onChange:t}){let[r,n]=i.useState(e),a=i.useRef(r),s=i.useRef(t);return tw(()=>{s.current=t},[t]),i.useEffect(()=>{a.current!==r&&(s.current?.(r),a.current=r)},[r,a]),[r,n,s]}({defaultProp:t,onChange:r}),o=void 0!==e,c=o?e:a;{let t=i.useRef(void 0!==e);i.useEffect(()=>{let e=t.current;if(e!==o){let t=o?"controlled":"uncontrolled";console.warn(`${n} is changing from ${e?"controlled":"uncontrolled"} to ${t}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`)}t.current=o},[o,n])}return[c,i.useCallback(t=>{if(o){let r="function"==typeof t?t(e):t;r!==e&&l.current?.(r)}else s(t)},[o,e,s,l])]}Symbol("RADIX:SYNC_STATE"),e.s(["useControllableState",()=>tN],40058);var tz=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),tP=i.forwardRef((e,t)=>(0,n.jsx)(A.span,{...e,ref:t,style:{...tz,...e.style}}));tP.displayName="VisuallyHidden";var[tk,tS]=P("Tooltip",[tn]),tC=tn(),tA="TooltipProvider",tM="tooltip.open",[t_,tR]=tk(tA),tE=e=>{let{__scopeTooltip:t,delayDuration:r=700,skipDelayDuration:a=300,disableHoverableContent:s=!1,children:l}=e,o=i.useRef(!0),c=i.useRef(!1),d=i.useRef(0);return i.useEffect(()=>{let e=d.current;return()=>window.clearTimeout(e)},[]),(0,n.jsx)(t_,{scope:t,isOpenDelayedRef:o,delayDuration:r,onOpen:i.useCallback(()=>{window.clearTimeout(d.current),o.current=!1},[]),onClose:i.useCallback(()=>{window.clearTimeout(d.current),d.current=window.setTimeout(()=>o.current=!0,a)},[a]),isPointerInTransitRef:c,onPointerInTransitChange:i.useCallback(e=>{c.current=e},[]),disableHoverableContent:s,children:l})};tE.displayName=tA;var tF="Tooltip",[tT,tL]=tk(tF),tD=e=>{let{__scopeTooltip:t,children:r,open:a,defaultOpen:s,onOpenChange:l,disableHoverableContent:o,delayDuration:c}=e,d=tR(tF,e.__scopeTooltip),x=tC(t),[u,m]=i.useState(null),h=O(),p=i.useRef(0),f=o??d.disableHoverableContent,g=c??d.delayDuration,b=i.useRef(!1),[y,v]=tN({prop:a,defaultProp:s??!1,onChange:e=>{e?(d.onOpen(),document.dispatchEvent(new CustomEvent(tM))):d.onClose(),l?.(e)},caller:tF}),j=i.useMemo(()=>y?b.current?"delayed-open":"instant-open":"closed",[y]),w=i.useCallback(()=>{window.clearTimeout(p.current),p.current=0,b.current=!1,v(!0)},[v]),N=i.useCallback(()=>{window.clearTimeout(p.current),p.current=0,v(!1)},[v]),z=i.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{b.current=!0,v(!0),p.current=0},g)},[g,v]);return i.useEffect(()=>()=>{p.current&&(window.clearTimeout(p.current),p.current=0)},[]),(0,n.jsx)(ts,{...x,children:(0,n.jsx)(tT,{scope:t,contentId:h,open:y,stateAttribute:j,trigger:u,onTriggerChange:m,onTriggerEnter:i.useCallback(()=>{d.isOpenDelayedRef.current?z():w()},[d.isOpenDelayedRef,z,w]),onTriggerLeave:i.useCallback(()=>{f?N():(window.clearTimeout(p.current),p.current=0)},[N,f]),onOpen:w,onClose:N,disableHoverableContent:f,children:r})})};tD.displayName=tF;var t$="TooltipTrigger",tI=i.forwardRef((e,t)=>{let{__scopeTooltip:r,...a}=e,s=tL(t$,r),l=tR(t$,r),o=tC(r),c=i.useRef(null),d=(0,z.useComposedRefs)(t,c,s.onTriggerChange),x=i.useRef(!1),u=i.useRef(!1),m=i.useCallback(()=>x.current=!1,[]);return i.useEffect(()=>()=>document.removeEventListener("pointerup",m),[m]),(0,n.jsx)(to,{asChild:!0,...o,children:(0,n.jsx)(A.button,{"aria-describedby":s.open?s.contentId:void 0,"data-state":s.stateAttribute,...a,ref:d,onPointerMove:N(e.onPointerMove,e=>{"touch"!==e.pointerType&&(u.current||l.isPointerInTransitRef.current||(s.onTriggerEnter(),u.current=!0))}),onPointerLeave:N(e.onPointerLeave,()=>{s.onTriggerLeave(),u.current=!1}),onPointerDown:N(e.onPointerDown,()=>{s.open&&s.onClose(),x.current=!0,document.addEventListener("pointerup",m,{once:!0})}),onFocus:N(e.onFocus,()=>{x.current||s.onOpen()}),onBlur:N(e.onBlur,s.onClose),onClick:N(e.onClick,s.onClose)})})});tI.displayName=t$;var[tO,tB]=tk("TooltipPortal",{forceMount:void 0}),tW="TooltipContent",tH=i.forwardRef((e,t)=>{let r=tB(tW,e.__scopeTooltip),{forceMount:i=r.forceMount,side:a="top",...s}=e,l=tL(tW,e.__scopeTooltip);return(0,n.jsx)(ty,{present:i||l.open,children:l.disableHoverableContent?(0,n.jsx)(tY,{side:a,...s,ref:t}):(0,n.jsx)(tq,{side:a,...s,ref:t})})}),tq=i.forwardRef((e,t)=>{let r=tL(tW,e.__scopeTooltip),a=tR(tW,e.__scopeTooltip),s=i.useRef(null),l=(0,z.useComposedRefs)(t,s),[o,c]=i.useState(null),{trigger:d,onClose:x}=r,u=s.current,{onPointerInTransitChange:m}=a,h=i.useCallback(()=>{c(null),m(!1)},[m]),p=i.useCallback((e,t)=>{let r,n=e.currentTarget,i={x:e.clientX,y:e.clientY},a=function(e,t){let r=Math.abs(t.top-e.y),n=Math.abs(t.bottom-e.y),i=Math.abs(t.right-e.x),a=Math.abs(t.left-e.x);switch(Math.min(r,n,i,a)){case a:return"left";case i:return"right";case r:return"top";case n:return"bottom";default:throw Error("unreachable")}}(i,n.getBoundingClientRect());c(((r=[...function(e,t,r=5){let n=[];switch(t){case"top":n.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":n.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":n.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":n.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r})}return n}(i,a),...function(e){let{top:t,right:r,bottom:n,left:i}=e;return[{x:i,y:t},{x:r,y:t},{x:r,y:n},{x:i,y:n}]}(t.getBoundingClientRect())].slice()).sort((e,t)=>e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:1*!!(e.y>t.y)),function(e){if(e.length<=1)return e.slice();let t=[];for(let r=0;r<e.length;r++){let n=e[r];for(;t.length>=2;){let e=t[t.length-1],r=t[t.length-2];if((e.x-r.x)*(n.y-r.y)>=(e.y-r.y)*(n.x-r.x))t.pop();else break}t.push(n)}t.pop();let r=[];for(let t=e.length-1;t>=0;t--){let n=e[t];for(;r.length>=2;){let e=r[r.length-1],t=r[r.length-2];if((e.x-t.x)*(n.y-t.y)>=(e.y-t.y)*(n.x-t.x))r.pop();else break}r.push(n)}return(r.pop(),1===t.length&&1===r.length&&t[0].x===r[0].x&&t[0].y===r[0].y)?t:t.concat(r)}(r))),m(!0)},[m]);return i.useEffect(()=>()=>h(),[h]),i.useEffect(()=>{if(d&&u){let e=e=>p(e,u),t=e=>p(e,d);return d.addEventListener("pointerleave",e),u.addEventListener("pointerleave",t),()=>{d.removeEventListener("pointerleave",e),u.removeEventListener("pointerleave",t)}}},[d,u,p,h]),i.useEffect(()=>{if(o){let e=e=>{let t=e.target,r={x:e.clientX,y:e.clientY},n=d?.contains(t)||u?.contains(t),i=!function(e,t){let{x:r,y:n}=e,i=!1;for(let e=0,a=t.length-1;e<t.length;a=e++){let s=t[e],l=t[a],o=s.x,c=s.y,d=l.x,x=l.y;c>n!=x>n&&r<(d-o)*(n-c)/(x-c)+o&&(i=!i)}return i}(r,o);n?h():i&&(h(),x())};return document.addEventListener("pointermove",e),()=>document.removeEventListener("pointermove",e)}},[d,u,o,x,h]),(0,n.jsx)(tY,{...e,ref:l})}),[tV,tZ]=tk(tF,{isInside:!1}),tU=((t=({children:e})=>(0,n.jsx)(n.Fragment,{children:e})).displayName="TooltipContent.Slottable",t.__radixId=tj,t),tY=i.forwardRef((e,t)=>{let{__scopeTooltip:r,children:a,"aria-label":s,onEscapeKeyDown:l,onPointerDownOutside:o,...c}=e,d=tL(tW,r),x=tC(r),{onClose:u}=d;return i.useEffect(()=>(document.addEventListener(tM,u),()=>document.removeEventListener(tM,u)),[u]),i.useEffect(()=>{if(d.trigger){let e=e=>{let t=e.target;t?.contains(d.trigger)&&u()};return window.addEventListener("scroll",e,{capture:!0}),()=>window.removeEventListener("scroll",e,{capture:!0})}},[d.trigger,u]),(0,n.jsx)(F,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:l,onPointerDownOutside:o,onFocusOutside:e=>e.preventDefault(),onDismiss:u,children:(0,n.jsxs)(tu,{"data-state":d.stateAttribute,...x,...c,ref:t,style:{...c.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[(0,n.jsx)(tU,{children:a}),(0,n.jsx)(tV,{scope:r,isInside:!0,children:(0,n.jsx)(tP,{id:d.contentId,role:"tooltip",children:s||a})})]})})});tH.displayName=tW;var tX="TooltipArrow";i.forwardRef((e,t)=>{let{__scopeTooltip:r,...i}=e,a=tC(r);return tZ(tX,r).isInside?null:(0,n.jsx)(tp,{...a,...i,ref:t})}).displayName=tX;var tG=e.i(74614);let tK=i.forwardRef(({className:e,sideOffset:t=4,...r},i)=>(0,n.jsx)(tH,{ref:i,sideOffset:t,className:(0,tG.cn)("z-50 overflow-hidden rounded-md border border-zinc-800 bg-zinc-950 px-3 py-1.5 text-sm text-zinc-100 shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));function tQ({data:e,filename:t="export",label:r="匯出 CSV",className:a,disabled:s=!1,columns:l}){let{role:c,isLoading:d}=function(){let[e,t]=(0,i.useState)(null),[r,n]=(0,i.useState)(!0);return(0,i.useEffect)(()=>{let e=!0,r=async()=>{try{let{data:{session:r}}=await w.supabase.auth.getSession();if(!r?.user){e&&(t(null),n(!1));return}let{data:i,error:a}=await w.supabase.from("profiles").select("role").eq("id",r.user.id).single();e&&(i?t(i.role):t("user"),n(!1))}catch(r){console.error("Error fetching user role:",r),e&&(t("user"),n(!1))}};r();let{data:{subscription:i}}=w.supabase.auth.onAuthStateChange((e,n)=>{n?r():t(null)});return()=>{e=!1,i.unsubscribe()}},[]),{role:e,isLoading:r}}(),x=["pro","pro_max","admin","super_admin"].includes(c||""),u=!d;return d?(0,n.jsxs)(o.Button,{variant:"outline",size:"sm",disabled:!0,className:`gap-2 border-dashed border-zinc-700 bg-zinc-900/50 text-zinc-600 ${a}`,children:[(0,n.jsx)(j.Loader2,{className:"h-4 w-4 animate-spin"}),(0,n.jsx)("span",{className:"hidden sm:inline",children:"載入中..."})]}):(0,n.jsx)(tE,{children:(0,n.jsxs)(tD,{delayDuration:0,children:[(0,n.jsx)(tI,{asChild:!0,children:(0,n.jsx)("span",{className:"inline-block",tabIndex:x?-1:0,children:(0,n.jsxs)(o.Button,{variant:"outline",size:"sm",onClick:()=>{if(u&&x){if(!e||0===e.length)return void alert("無數據可導出");try{let r=Object.keys(e[0]),n=[r.map(e=>l&&l[e]||e).join(","),...e.map(e=>r.map(t=>{let r=e[t];if(null==r)return"";if("number"==typeof r){let e=l&&l[t]||t;return/Area|坪|Rate|Ratio|Share|Percent|比|率/.test(t)||/Area|坪|Rate|Ratio|Share|Percent|比|率/.test(e)?r.toFixed(2):Math.round(r).toFixed(0)}if("object"==typeof r)try{return`"${JSON.stringify(r).replace(/"/g,'""')}"`}catch(e){return""}return"string"==typeof r?`"${r.replace(/"/g,'""').replace(/\n/g," ")}"`:r}).join(","))].join("\n"),i=new Blob(["\uFEFF"+n],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(i),s=document.createElement("a"),o=new Date().toISOString().split("T")[0],c=`${t}_${o}.csv`;s.href=a,s.setAttribute("download",c),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}catch(e){console.error("Export failed:",e),alert("匯出失敗，請查看控制台日誌")}}},disabled:s||x&&(!e||0===e.length),className:`gap-2 border-dashed ${!x?"border-zinc-800 bg-zinc-900/30 text-zinc-600 cursor-not-allowed hover:bg-zinc-900/30":"border-zinc-700 bg-zinc-900/50 hover:bg-zinc-800 text-zinc-400 hover:text-white"} transition-all ${a}`,children:[x?(0,n.jsx)(y,{className:"h-4 w-4"}):(0,n.jsx)(v.Lock,{className:"h-3 w-3"}),(0,n.jsx)("span",{className:"hidden sm:inline",children:r})]})})}),(0,n.jsx)(tK,{className:"bg-zinc-950 border border-zinc-800 p-0 overflow-hidden",children:(0,n.jsxs)("div",{className:"flex flex-col gap-1 items-center p-3",children:[(0,n.jsx)("p",{className:"font-medium text-zinc-200",children:x?"下載 CSV 檔案":"Pro 會員限定功能"}),!x&&(0,n.jsx)(b.default,{href:"/pricing",className:"text-xs text-violet-400 hover:text-violet-300 underline underline-offset-2 transition-colors flex items-center gap-1",children:"查看升級方案 →"})]})})]})})}function tJ({data:e,visibleSections:t=["metrics","chart","table"]}){let{rankingCurrentPage:r,rankingPageSize:x,setRankingCurrentPage:b,setRankingPageSize:y}=(0,l.useFilterStore)(),[v,j]=(0,i.useState)(1),[w,N]=(0,i.useState)(10),[z,P]=(0,i.useState)({key:"saleAmountSum",order:"desc"}),[k,S]=(0,i.useState)(30),[C,A]=(0,i.useState)("auto");if(!e)return null;let{coreMetrics:M,projectRanking:_}=e,R=(0,i.useMemo)(()=>{if(!_||0===_.length)return{min:0,max:0,median:0,parking:0};let e=Math.min(..._.map(e=>e.minPrice).filter(e=>e>0)),t=Math.max(..._.map(e=>e.maxPrice)),r=_.map(e=>e.medianPrice).filter(e=>e>0),n=r.length>0?r.reduce((e,t)=>e+t,0)/r.length:0,i=_.map(e=>e.avgParkingPrice).filter(e=>e>0);return{min:e,max:t,median:n,parking:i.length>0?i.reduce((e,t)=>e+t,0)/i.length:0}},[_]),E=(0,i.useMemo)(()=>_?[..._].sort((e,t)=>{let r=e[z.key]||0,n=t[z.key]||0;return"desc"===z.order?n-r:r-n}):[],[_,z]),F=Math.ceil(E.length/w),T=E.slice((v-1)*w,v*w),L=e=>{P({key:e,order:"desc"})},D=({title:e,value:t,unit:r,sortKey:i})=>(0,n.jsxs)("div",{onClick:()=>i&&L(i),className:`bg-zinc-800/50 rounded-lg p-4 border border-white/5 flex flex-col items-center justify-center text-center transition-all duration-300 ${i?"cursor-pointer hover:bg-zinc-800 hover:border-violet-500/30 hover:shadow-[0_0_20px_rgba(139,92,246,0.1)] group":""}`,children:[(0,n.jsx)("div",{className:`text-zinc-400 text-sm mb-1 ${i?"group-hover:text-violet-300":""}`,children:e}),(0,n.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,n.jsx)("span",{className:`text-2xl font-bold text-white ${i?"group-hover:text-white":""}`,children:t}),(0,n.jsx)("span",{className:"text-xs text-zinc-500",children:r})]})]});return(0,n.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[t.includes("metrics")&&(0,n.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4",children:[(0,n.jsx)(D,{title:"市場去化總銷售金額",value:M.totalSaleAmount.toLocaleString(),unit:"萬",sortKey:"saleAmountSum"}),(0,n.jsx)(D,{title:"總銷去化房屋坪數",value:M.totalHouseArea.toLocaleString(void 0,{maximumFractionDigits:2}),unit:"坪",sortKey:"houseAreaSum"}),(0,n.jsx)(D,{title:"總平均單價",value:M.overallAveragePrice.toLocaleString(void 0,{maximumFractionDigits:2}),unit:"萬/坪",sortKey:"averagePrice"}),(0,n.jsx)(D,{title:"總交易筆數",value:M.transactionCount.toLocaleString(),unit:"筆",sortKey:"transactionCount"}),(0,n.jsx)(D,{title:"最低成交單價 (Min)",value:R.min.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"萬/坪",sortKey:"minPrice"}),(0,n.jsx)(D,{title:"最高成交單價 (Max)",value:R.max.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"萬/坪",sortKey:"maxPrice"}),(0,n.jsx)(D,{title:"平均中位數單價",value:R.median.toLocaleString(void 0,{maximumFractionDigits:1}),unit:"萬/坪",sortKey:"medianPrice"}),(0,n.jsx)(D,{title:"平均車位價格",value:R.parking.toLocaleString(void 0,{maximumFractionDigits:0}),unit:"萬",sortKey:"avgParkingPrice"})]}),t.includes("chart")&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"flex flex-wrap gap-2 justify-center",children:[{key:"saleAmountSum",label:"交易總價(萬)"},{key:"houseAreaSum",label:"房屋面積(坪)"},{key:"transactionCount",label:"資料筆數"},{key:"marketShare",label:"市場佔比(%)"},{key:"averagePrice",label:"平均單價"},{key:"minPrice",label:"最低單價"},{key:"maxPrice",label:"最高單價"},{key:"medianPrice",label:"中位數單價"},{key:"avgParkingPrice",label:"車位均價"}].map(e=>(0,n.jsx)("button",{onClick:()=>L(e.key),className:`px-3 py-1.5 text-xs font-medium rounded-full border transition-all duration-300 ${z.key===e.key?"bg-violet-600/20 border-violet-500/50 text-violet-300 shadow-[0_0_15px_rgba(139,92,246,0.2)]":"bg-zinc-800/50 border-white/5 text-zinc-400 hover:text-white hover:bg-zinc-800 hover:border-white/10"}`,children:e.label},e.key))}),(0,n.jsx)(a.ReportWrapper,{title:"建案分析圖表",description:"根據排序指標顯示建案排名",headerAction:(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 w-full sm:w-auto",children:[(0,n.jsxs)("div",{className:"flex bg-zinc-800 p-0.5 rounded-lg border border-white/5",children:[(0,n.jsx)("button",{onClick:()=>A("auto"),className:`p-1.5 rounded-md transition-all ${"auto"===C?"bg-violet-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-400 hover:text-white hover:bg-white/5"}`,title:"自動選擇 (Auto)",children:(0,n.jsx)(g,{size:14})}),(0,n.jsx)("button",{onClick:()=>A("bar"),className:`p-1.5 rounded-md transition-all ${"bar"===C?"bg-violet-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-400 hover:text-white hover:bg-white/5"}`,title:"長條圖 (Bar)",children:(0,n.jsx)(p,{size:14})}),(0,n.jsx)("button",{onClick:()=>A("treemap"),className:`p-1.5 rounded-md transition-all ${"treemap"===C?"bg-violet-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-400 hover:text-white hover:bg-white/5"}`,title:"矩形樹圖 (Treemap)",children:(0,n.jsx)(f,{size:14})})]}),(0,n.jsx)("div",{className:"hidden sm:block w-px h-6 bg-white/10"}),(0,n.jsxs)("div",{className:"flex items-center gap-3 w-full sm:w-auto justify-between sm:justify-start",children:[(0,n.jsx)("div",{className:"flex bg-zinc-800 p-0.5 rounded-lg border border-white/5 overflow-x-auto max-w-[200px] sm:max-w-none scrollbar-hide",children:[10,30,50,100].map(e=>(0,n.jsxs)("button",{onClick:()=>S(e),className:`px-3 py-1 text-xs rounded-md transition-all whitespace-nowrap ${k===e?"bg-violet-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-400 hover:text-white hover:bg-white/5"}`,children:["Top ",e]},e))}),(0,n.jsx)("div",{className:"hidden sm:block w-px h-6 bg-white/10"}),(0,n.jsx)(tQ,{data:E.slice(0,k),filename:"ranking_chart_data",label:"匯出",columns:{projectName:"建案名稱",county:"縣市",district:"行政區",saleAmountSum:"交易總價",houseAreaSum:"房屋面積",transactionCount:"資料筆數",marketShare:"市場佔比",averagePrice:"平均單價",minPrice:"最低單價",maxPrice:"最高單價",medianPrice:"中位數單價",avgParkingPrice:"車位均價"}})]})]}),children:(0,n.jsx)(s.RankingChart,{data:E,sortKey:z.key,limit:k,chartType:C})})]}),t.includes("table")&&(0,n.jsxs)(a.ReportWrapper,{title:"區域建案排行列表",description:"點擊表頭可進行排序",headerAction:(0,n.jsx)(tQ,{data:E,filename:"ranking_table_data",label:"匯出完整列表",columns:{projectName:"建案名稱",county:"縣市",district:"行政區",saleAmountSum:"交易總價",houseAreaSum:"房屋面積",transactionCount:"資料筆數",marketShare:"市場佔比",averagePrice:"平均單價",minPrice:"最低單價",maxPrice:"最高單價",medianPrice:"中位數單價",avgParkingPrice:"車位均價"}}),children:[(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,n.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-4 py-3 cursor-default",children:"排名"}),(0,n.jsx)("th",{className:"px-4 py-3 cursor-default",children:"建案名稱"}),[{key:"saleAmountSum",label:(0,n.jsxs)(n.Fragment,{children:["交易",(0,n.jsx)("br",{}),"總價(萬)"]})},{key:"houseAreaSum",label:(0,n.jsxs)(n.Fragment,{children:["房屋",(0,n.jsx)("br",{}),"面積(坪)"]})},{key:"transactionCount",label:(0,n.jsxs)(n.Fragment,{children:["資料",(0,n.jsx)("br",{}),"筆數"]})},{key:"marketShare",label:(0,n.jsxs)(n.Fragment,{children:["市場",(0,n.jsx)("br",{}),"佔比(%)"]})},{key:"averagePrice",label:(0,n.jsxs)(n.Fragment,{children:["平均",(0,n.jsx)("br",{}),"單價"]})},{key:"minPrice",label:(0,n.jsxs)(n.Fragment,{children:["最低",(0,n.jsx)("br",{}),"單價"]})},{key:"maxPrice",label:(0,n.jsxs)(n.Fragment,{children:["最高",(0,n.jsx)("br",{}),"單價"]})},{key:"medianPrice",label:(0,n.jsxs)(n.Fragment,{children:["中位數",(0,n.jsx)("br",{}),"單價"]})},{key:"avgParkingPrice",label:(0,n.jsxs)(n.Fragment,{children:["車位",(0,n.jsx)("br",{}),"均價"]})}].map(e=>(0,n.jsx)("th",{className:"px-3 py-3 cursor-pointer hover:text-white transition-colors text-center whitespace-nowrap",onClick:()=>L(e.key),children:(0,n.jsxs)("div",{className:"flex items-center justify-center gap-1.5 group/header",children:[(0,n.jsx)("span",{className:"leading-tight",children:e.label}),(0,n.jsx)("div",{className:"flex flex-col opacity-50 group-hover/header:opacity-100 transition-opacity",children:z.key===e.key?"desc"===z.order?(0,n.jsx)(h,{size:14,className:"text-violet-500"}):(0,n.jsx)(m,{size:14,className:"text-violet-500"}):(0,n.jsx)(u,{size:14,className:"text-zinc-600 group-hover/header:text-zinc-400"})})]})},e.key))]})}),(0,n.jsx)("tbody",{className:"divide-y divide-white/5",children:T.map((e,t)=>(0,n.jsxs)("tr",{className:"hover:bg-zinc-800/50 transition-colors",children:[(0,n.jsx)("td",{className:"px-4 py-3 text-zinc-500 font-mono",children:(v-1)*w+t+1}),(0,n.jsx)("td",{className:"px-4 py-3",children:(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("span",{className:"font-medium text-white",children:e.projectName}),(0,n.jsxs)("div",{className:"flex gap-1 mt-1",children:[e.county&&(0,n.jsx)("span",{className:"text-[10px] bg-zinc-800 text-zinc-400 px-1 py-0.5 rounded",children:e.county}),e.district&&(0,n.jsx)("span",{className:"text-[10px] bg-zinc-800 text-zinc-400 px-1 py-0.5 rounded",children:e.district})]})]})}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.saleAmountSum.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.houseAreaSum.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.transactionCount.toLocaleString()}),(0,n.jsxs)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:[e.marketShare.toFixed(2),"%"]}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-cyan-400",children:e.averagePrice.toFixed(1)}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.minPrice.toFixed(1)}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.maxPrice.toFixed(1)}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-400",children:e.medianPrice.toFixed(1)}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-400",children:e.avgParkingPrice>0?e.avgParkingPrice.toLocaleString():"-"})]},t))}),(0,n.jsx)("tfoot",{className:"bg-zinc-900/80 font-bold border-t-2 border-zinc-700",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{colSpan:2,className:"px-4 py-3 text-center text-zinc-300",children:"總計"}),(0,n.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:M.totalSaleAmount.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:M.totalHouseArea.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:M.transactionCount.toLocaleString()}),(0,n.jsx)("td",{colSpan:6})]})})]})}),(0,n.jsxs)("div",{className:"flex items-center justify-between mt-4 border-t border-white/5 pt-4",children:[(0,n.jsxs)("div",{className:"text-sm text-zinc-500",children:["顯示 ",(v-1)*w+1," 到 ",Math.min(v*w,E.length)," 筆，共 ",E.length," 筆"]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(o.Button,{variant:"outline",size:"sm",onClick:()=>j(e=>Math.max(1,e-1)),disabled:1===v,children:(0,n.jsx)(c.ChevronLeft,{size:16})}),(0,n.jsxs)("span",{className:"text-sm text-zinc-300",children:["Page ",v," of ",F]}),(0,n.jsx)(o.Button,{variant:"outline",size:"sm",onClick:()=>j(e=>Math.min(F,e+1)),disabled:v===F,children:(0,n.jsx)(d.ChevronRight,{size:16})})]})]})]})]})}tK.displayName=tH.displayName,e.s(["ExportButton",()=>tQ],65949),e.s(["RankingReport",()=>tJ],98264);var t0=e.i(34029);function t1({data:e}){let t=(0,i.useMemo)(()=>e&&0!==e.length?[{name:"總價分佈",type:"boxPlot",data:e.map(e=>{let t=[e.minPrice,e.q1Price,e.medianPrice,e.q3Price,e.maxPrice];return t.some(e=>"number"!=typeof e||isNaN(e))?null:{x:null!==e.bathrooms?`${e.roomType}-${e.bathrooms}衛`:e.roomType,y:t.map(e=>Math.round(e))}}).filter(Boolean)}]:[],[e]),r=(0,i.useMemo)(()=>{if(0===t.length||0===t[0].data.length)return{};let e=t[0].data.flatMap(e=>e.y),r=Math.min(...e),n=Math.max(...e),i=n-r,a=0===i?Math.max(.1*r,100):.1*i;return{chart:{type:"boxPlot",height:450,background:"transparent",toolbar:{show:!0},foreColor:"#e5e7eb"},plotOptions:{boxPlot:{colors:{upper:"#06b6d4",lower:"#8b5cf6"},stroke:{colors:["#e5e7eb"]}}},xaxis:{type:"category",labels:{style:{colors:"#9ca3af"},rotate:-45,offsetY:5}},yaxis:{min:Math.max(0,r-a),max:n+a,title:{text:"房屋總價 (萬)",style:{color:"#9ca3af"}},labels:{formatter:e=>`${Math.round(e).toLocaleString()} 萬`,style:{colors:"#9ca3af"}}},tooltip:{custom:function({seriesIndex:e,dataPointIndex:t,w:r}){let n=r.globals.initialSeries[e].data[t].y;if(Array.isArray(n)&&5===n.length){let[e,t,r,i,a]=n;return`
                    <div class="apexcharts-tooltip-box" style="background: #18181b; border: 1px solid #27272a; padding: 8px 12px; border-radius: 8px; color: #fff;">
                        <div><strong>最高總價:</strong> ${a.toLocaleString()} 萬</div>
                        <div><strong>3/4位總價:</strong> ${i.toLocaleString()} 萬</div>
                        <div><strong>中位數總價:</strong> ${r.toLocaleString()} 萬</div>
                        <div><strong>1/4位總價:</strong> ${t.toLocaleString()} 萬</div>
                        <div><strong>最低總價:</strong> ${e.toLocaleString()} 萬</div>
                    </div>
                `}return""}}}},[t]);return e&&0!==e.length&&0!==t.length?(0,n.jsx)(t0.default,{type:"boxPlot",series:t,options:r,height:450,className:"w-full"}):(0,n.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無總價帶資料可顯示"})}function t2({roomTypes:e,locations:t,crossTable:r,dimension:a}){let s=(0,i.useMemo)(()=>e&&t&&r?e.map(e=>{let n=t.map(t=>r[e]&&r[e][t]||0);return{name:e,data:n}}):[],[e,t,r]),l=(0,i.useMemo)(()=>{let e="county"===a?"縣市":"行政區";return{chart:{type:"bar",height:Math.max(350,35*t.length),stacked:!0,background:"transparent",toolbar:{show:!0},foreColor:"#e5e7eb"},plotOptions:{bar:{horizontal:!0,barHeight:"70%",borderRadius:4,dataLabels:{total:{enabled:!0,offsetX:5,style:{fontSize:"11px",fontWeight:600,color:"#e5e7eb"},formatter:function(e,t){let r=t.w.config.series,n=t.dataPointIndex,i=0;return r.forEach(e=>{i+=e.data[n]||0}),i>0?i.toString():""}}}}},colors:["#06b6d4","#8b5cf6","#10b981","#f59e0b","#ef4444","#3b82f6","#ec4899","#84cc16","#6366f1","#14b8a6"],dataLabels:{enabled:!1},xaxis:{categories:t,title:{text:"成交筆數",style:{color:"#9ca3af"}},labels:{style:{colors:"#9ca3af"}}},yaxis:{title:{text:e,style:{color:"#9ca3af"}},labels:{style:{colors:"#e5e7eb"},maxWidth:150}},legend:{position:"top",horizontalAlign:"center",labels:{colors:"#e5e7eb"}},tooltip:{theme:"dark",y:{formatter:function(e){return e+" 筆"}}},grid:{borderColor:"#374151"},title:{text:`各${e}房型成交筆數分佈`,align:"center",style:{fontSize:"16px",color:"#e5e7eb"}}}},[t,a]);return s&&0!==s.length?(0,n.jsx)(t0.default,{type:"bar",series:s,options:l,height:l.chart?.height||350,className:"w-full"}):(0,n.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無區域分佈資料"})}var t5=e.i(30844);function t4({isOpen:e,onClose:t,title:r,projects:a}){let s=(0,i.useRef)(null);return((0,i.useEffect)(()=>{let r=e=>{"Escape"===e.key&&t()};return e&&(document.addEventListener("keydown",r),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",r),document.body.style.overflow=""}},[e,t]),e)?(0,n.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",onClick:e=>{s.current&&!s.current.contains(e.target)&&t()},children:(0,n.jsxs)("div",{ref:s,className:"bg-zinc-900 border border-white/10 rounded-xl shadow-2xl max-w-md w-full mx-4 animate-in zoom-in-95 duration-200",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between px-5 py-4 border-b border-white/5",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-white",children:r}),(0,n.jsx)("button",{onClick:t,className:"p-1 rounded hover:bg-white/10 text-zinc-400 hover:text-white transition-colors",children:(0,n.jsx)(t5.X,{size:20})})]}),(0,n.jsx)("div",{className:"px-5 py-4 max-h-[50vh] overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-700",children:0===a.length?(0,n.jsx)("p",{className:"text-zinc-500 text-center py-4",children:"無建案資料"}):(0,n.jsx)("ul",{className:"space-y-2",children:a.map((e,t)=>(0,n.jsx)("li",{className:(0,tG.cn)("px-3 py-2 rounded-lg text-zinc-200 text-sm","bg-zinc-800/50 hover:bg-zinc-800 transition-colors","border border-white/5"),children:e},t))})}),(0,n.jsxs)("div",{className:"px-5 py-3 border-t border-white/5 flex justify-between items-center",children:[(0,n.jsxs)("span",{className:"text-xs text-zinc-500",children:["共 ",a.length," 個建案"]}),(0,n.jsx)("button",{onClick:t,className:"px-4 py-1.5 text-sm rounded-lg bg-zinc-800 text-zinc-300 hover:bg-zinc-700 transition-colors",children:"關閉"})]})]})}):null}function t3({data:e,visibleSections:t=["chart","table","location-table","location-chart"]}){let r=["套房","1房","2房","3房","4房","毛胚"],[s,l]=(0,i.useState)(r),[o,c]=(0,i.useState)("district"),[d,x]=(0,i.useState)(!1),[u,m]=(0,i.useState)(""),[h,p]=(0,i.useState)([]),[f,g]=(0,i.useState)(null),b=(0,i.useMemo)(()=>{if(!e?.transactionDetails)return[];let t=new Set;return e.transactionDetails.forEach(e=>{e["縣市"]&&t.add(e["縣市"])}),Array.from(t).sort()},[e?.transactionDetails]);i.default.useEffect(()=>{!f&&b.length>0&&g(b[0])},[b,f]);let y=(e,t,r)=>{m(`${e}${null!==t?` / ${t}衛`:""} 建案組成`),p(r),x(!0)};if(!e||!e.details)return null;let{details:v,locationCrossTable:j,allDistricts:w,transactionDetails:N}=e,z=(0,i.useMemo)(()=>Array.from(new Set(v.map(e=>e.roomType))),[v]),P=(0,i.useMemo)(()=>v.filter(e=>s.includes(e.roomType)),[v,s]),[k,S]=(0,i.useState)(!0),C=(0,i.useMemo)(()=>{let e=v.filter(e=>s.includes(e.roomType));if(!k)return e;let t=new Map;return e.forEach(e=>{let r=e.roomType;t.has(r)||t.set(r,{...e,bathrooms:null,projectNames:e.projectNames?[...e.projectNames]:[],count:0,avgPrice:0});let n=t.get(r),i=n.avgPrice*n.count,a=e.avgPrice*e.count,s=n.count+e.count;n.count=s,n.avgPrice=s>0?(i+a)/s:0,n.minPrice=Math.min(n.minPrice,e.minPrice),n.maxPrice=Math.max(n.maxPrice,e.maxPrice);let l=n.count-e.count,o=e.count;if(n.medianPrice=(n.medianPrice*l+e.medianPrice*o)/s,n.q1Price=(n.q1Price*l+e.q1Price*o)/s,n.q3Price=(n.q3Price*l+e.q3Price*o)/s,e.projectNames){let t=new Set([...n.projectNames||[],...e.projectNames]);n.projectNames=Array.from(t)}}),Array.from(t.values()).sort((e,t)=>r.indexOf(e.roomType)-r.indexOf(t.roomType))},[v,s,k,r]),A=(0,i.useMemo)(()=>{if("county"===o&&N){let e={},t=new Set;N.forEach(r=>{let n=r["房型"]||r.roomType||r["戶型"];if(!n||"其他"===n){let e=Number(r["房數"]);n=!isNaN(e)&&e>0?`${e}房`:"其他"}let i="string"==typeof n?n.replace(/\s+/g,""):n;("number"==typeof i||"string"==typeof i&&/^\d+$/.test(i))&&(i=`${i}房`);let a=r["縣市"]||"未知";e[i]||(e[i]={}),e[i][a]=(e[i][a]||0)+1,t.add(a)});let r=Array.from(t).sort(),n={},i=0;r.forEach(e=>n[e]=0);let a=s.map(t=>{let a=e[t]||{},s=0,l=r.map(e=>{let t=a[e]||0;return s+=t,n[e]+=t,t});return i+=s,{roomType:t,cells:l,rowTotal:s}});return{locations:r,rows:a,locationTotals:n,grandTotal:i}}if("district"===o){let e={},t=new Set;if(N)N.forEach(r=>{let n=r["房型"]||r.roomType||r["戶型"];if(!n||"其他"===n){let e=Number(r["房數"]);n=!isNaN(e)&&e>0?`${e}房`:"其他"}let i="string"==typeof n?n.replace(/\s+/g,""):n;("number"==typeof i||"string"==typeof i&&/^\d+$/.test(i))&&(i=`${i}房`);let a=r["行政區"]||"未知",s=r["縣市"]||"未知";f&&s!==f||(e[i]||(e[i]={}),e[i][a]=(e[i][a]||0)+1,t.add(a))});else if(j){let r=new Set;s.forEach(e=>{let t=j[e];t&&Object.keys(t).forEach(e=>r.add(e))}),r.forEach(e=>t.add(e)),s.forEach(t=>{let r=j[t];r&&(e[t]=r)})}let r=Array.from(t).sort(),n={},i=0;r.forEach(e=>n[e]=0);let a=s.map(t=>{let a=e[t]||{},s=0,l=r.map(e=>{let t=a[e]||0;return s+=t,n[e]+=t,t});return i+=s,{roomType:t,cells:l,rowTotal:s}});return{locations:r,rows:a,locationTotals:n,grandTotal:i}}return null},[j,N,s,o,f]),[M,_]=(0,i.useState)(new Set),R=(0,i.useMemo)(()=>A?A.rows.map(e=>{let t={房型:e.roomType};return A.locations.forEach((r,n)=>{t[r]=e.cells[n]}),t["總計"]=e.rowTotal,t}):[],[A]),E=e=>v.filter(t=>t.roomType===e).sort((e,t)=>(Number(e.bathrooms)||0)-(Number(t.bathrooms)||0)),F=(0,i.useMemo)(()=>{if(!k)return C;let e=[];return C.forEach(t=>{if(e.push(t),M.has(t.roomType)){let r=E(t.roomType);e.push(...r)}}),e},[C,k,M,v]);return(0,n.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row sm:flex-wrap items-start sm:items-center justify-between gap-3 sm:gap-4",children:[(0,n.jsx)("div",{className:"flex flex-wrap gap-1.5 sm:gap-2",children:z.map(e=>(0,n.jsx)("button",{onClick:()=>{l(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},className:(0,tG.cn)("px-3 py-1 rounded-full text-xs font-medium transition-colors border",s.includes(e)?"bg-violet-500/20 border-violet-500 text-violet-200":"bg-zinc-800/50 border-zinc-700 text-zinc-500 hover:bg-zinc-800"),children:e},e))}),(0,n.jsxs)("div",{className:"flex items-center gap-2 bg-zinc-800/50 p-1 rounded-lg border border-white/5",children:[(0,n.jsx)("span",{className:"text-xs text-zinc-400 pl-2",children:"表格顯示:"}),(0,n.jsx)("button",{onClick:()=>S(!k),className:(0,tG.cn)("px-3 py-1 text-xs font-medium rounded-md transition-all",k?"bg-violet-500 text-white shadow-sm":"text-zinc-400 hover:text-white hover:bg-zinc-700"),children:k?"依房型合併":"顯示衛浴細節"})]})]}),t.includes("chart")&&(0,n.jsx)(a.ReportWrapper,{title:"各房型總價帶分佈箱型圖",description:"顯示各房型總價的中位數與四分位距",headerAction:(0,n.jsx)(tQ,{data:C,filename:"price_band_chart_data",label:"匯出",columns:{roomType:"房型",bathrooms:"衛浴",minPrice:"最低價",q1Price:"Q1",medianPrice:"中位數",q3Price:"Q3",maxPrice:"最高價",avgPrice:"平均價",count:"筆數"}}),children:(0,n.jsx)(t1,{data:C})}),t.includes("table")&&(0,n.jsx)(a.ReportWrapper,{title:"總價帶詳細數據",description:k?"各房型合併統計 (點擊「全部」可展開細節)":"各房型詳細價格統計",headerAction:(0,n.jsx)(tQ,{data:F,filename:"price_band_detail_data",label:"匯出列表",columns:{roomType:"房型",bathrooms:"衛浴",minPrice:"最低價",q1Price:"Q1",medianPrice:"中位數",q3Price:"Q3",maxPrice:"最高價",avgPrice:"平均價",count:"筆數"}}),children:(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,n.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-4 py-3",children:"房型"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"衛浴"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"建案數"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"筆數"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"平均總價"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"最低總價"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"1/4位總價"}),(0,n.jsx)("th",{className:"px-4 py-3 text-violet-400",children:"中位數總價"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"3/4位總價"}),(0,n.jsx)("th",{className:"px-4 py-3",children:"最高總價"})]})}),(0,n.jsxs)("tbody",{className:"divide-y divide-white/5",children:[C.map((e,t)=>{let r=k&&null===e.bathrooms,a=M.has(e.roomType),s=r&&a?E(e.roomType):[];return(0,n.jsxs)(i.default.Fragment,{children:[(0,n.jsxs)("tr",{className:(0,tG.cn)("hover:bg-zinc-800/50 transition-colors",a&&"bg-zinc-800/30"),children:[(0,n.jsx)("td",{className:"px-4 py-3 font-medium text-white",children:e.roomType}),(0,n.jsx)("td",{className:"px-4 py-3 text-zinc-400",children:r?(0,n.jsxs)("button",{onClick:()=>{var t;return t=e.roomType,void _(e=>{let r=new Set(e);return r.has(t)?r.delete(t):r.add(t),r})},className:"flex items-center gap-1 text-xs px-2 py-0.5 rounded bg-zinc-700/50 hover:bg-zinc-600 hover:text-white transition-colors cursor-pointer",children:[(0,n.jsx)("span",{children:"全部"}),(0,n.jsx)("span",{className:(0,tG.cn)("transform transition-transform text-[10px]",a?"rotate-180":""),children:"▼"})]}):e.bathrooms??"-"}),(0,n.jsx)("td",{className:"px-4 py-3",children:e.projectNames&&e.projectNames.length>0?(0,n.jsxs)("button",{onClick:()=>y(e.roomType,e.bathrooms,e.projectNames||[]),className:"px-2 py-1 text-xs font-medium rounded-full bg-violet-500/20 border border-violet-500/50 text-violet-300 hover:bg-violet-500/30 transition-colors cursor-pointer",children:[e.projectNames.length," 個建案"]}):(0,n.jsx)("span",{className:"text-zinc-500",children:"-"})}),(0,n.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:e.count.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.avgPrice.toLocaleString(void 0,{maximumFractionDigits:0})}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.minPrice.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.q1Price.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-violet-400 font-bold",children:e.medianPrice.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.q3Price.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.maxPrice.toLocaleString()})]}),s.map((e,r)=>(0,n.jsxs)("tr",{className:"bg-zinc-900/50 hover:bg-zinc-900 border-l-2 border-l-violet-500/30",children:[(0,n.jsxs)("td",{className:"px-4 py-2 font-medium text-zinc-500 text-xs pl-8",children:["↳ ",e.roomType]}),(0,n.jsxs)("td",{className:"px-4 py-2 text-zinc-400 text-xs",children:[e.bathrooms," 衛"]}),(0,n.jsx)("td",{className:"px-4 py-2",children:e.projectNames&&e.projectNames.length>0?(0,n.jsxs)("button",{onClick:()=>y(e.roomType,e.bathrooms,e.projectNames||[]),className:"text-xs text-zinc-500 hover:text-zinc-300 underline decoration-zinc-700",children:[e.projectNames.length," 建案"]}):"-"}),(0,n.jsx)("td",{className:"px-4 py-2 text-zinc-500 text-xs",children:e.count.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-500 text-xs",children:e.avgPrice.toLocaleString(void 0,{maximumFractionDigits:0})}),(0,n.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.minPrice.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.q1Price.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-500 text-xs font-medium",children:e.medianPrice.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.q3Price.toLocaleString()}),(0,n.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.maxPrice.toLocaleString()})]},`${t}-sub-${r}`))]},t)}),0===P.length&&(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:10,className:"p-8 text-center text-zinc-500",children:"請選擇房型顯示數據"})})]})]})})}),(A||N)&&(0,n.jsxs)("div",{className:"space-y-6 pt-4 border-t border-white/5",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-white",children:"區域分組交叉分析"}),(0,n.jsxs)("div",{className:"flex bg-zinc-800 rounded-md p-0.5",children:[(0,n.jsx)("button",{onClick:()=>c("district"),className:(0,tG.cn)("px-2 py-1 text-xs rounded transition-colors","district"===o?"bg-zinc-700 text-white":"text-zinc-400 hover:text-white"),children:"行政區"}),(0,n.jsx)("button",{onClick:()=>c("county"),className:(0,tG.cn)("px-2 py-1 text-xs rounded transition-colors","county"===o?"bg-zinc-700 text-white":"text-zinc-400 hover:text-white"),children:"縣市"})]})]}),"district"===o&&b.length>1&&(0,n.jsxs)("div",{className:"flex items-center gap-2 pb-2",children:[(0,n.jsx)("span",{className:"text-sm text-zinc-500",children:"顯示縣市:"}),(0,n.jsx)("div",{className:"flex gap-1 bg-zinc-900 p-1 rounded-lg",children:b.map(e=>(0,n.jsx)("button",{onClick:()=>g(e),className:(0,tG.cn)("px-3 py-1 text-xs font-medium rounded-md transition-all",f===e?"bg-violet-500/20 text-violet-300 shadow-sm border border-violet-500/50":"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800"),children:e},e))})]}),t.includes("location-table")&&(0,n.jsx)(a.ReportWrapper,{title:"區域房型成交分佈",description:"各區域不同房型的成交數量熱力分佈",headerAction:(0,n.jsx)(tQ,{data:R,filename:"price_band_location_cross_table",label:"匯出分佈表"}),children:(0,n.jsx)("div",{className:"overflow-x-auto",children:A?(0,n.jsxs)("table",{className:"w-full text-sm text-left border-collapse",children:[(0,n.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 font-semibold",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:"px-3 py-2 sticky left-0 bg-zinc-900 z-10 border-r border-white/5",children:"房型"}),A.locations.map(e=>(0,n.jsx)("th",{className:"px-3 py-2 text-center min-w-[80px]",children:e},e)),(0,n.jsx)("th",{className:"px-3 py-2 text-center border-l border-white/5 bg-zinc-900 font-bold text-white",children:"總計"})]})}),(0,n.jsx)("tbody",{className:"divide-y divide-white/5",children:A.rows.map((e,t)=>(0,n.jsxs)("tr",{className:"hover:bg-zinc-800/30",children:[(0,n.jsx)("td",{className:"px-3 py-2 font-medium text-zinc-300 sticky left-0 bg-zinc-950/90 border-r border-white/5",children:e.roomType}),e.cells.map((e,t)=>{let r=e>0?Math.min(e/20,1):0,i=e>0?{backgroundColor:`rgba(6, 182, 212, ${.3*r})`}:{};return(0,n.jsx)("td",{className:"px-3 py-2 text-center text-zinc-400",style:i,children:e>0?e:"-"},t)}),(0,n.jsx)("td",{className:"px-3 py-2 text-center font-bold text-white border-l border-white/5 bg-zinc-900/50",children:e.rowTotal})]},t))}),(0,n.jsx)("tfoot",{className:"bg-zinc-900 font-bold border-t-2 border-zinc-700",children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{className:"px-3 py-2 sticky left-0 bg-zinc-900 border-r border-white/5 text-white",children:"總計"}),A.locations.map(e=>(0,n.jsx)("td",{className:"px-3 py-2 text-center text-white",children:A.locationTotals[e]},e)),(0,n.jsx)("td",{className:"px-3 py-2 text-center text-cyan-400 border-l border-white/5 bg-zinc-900",children:A.grandTotal})]})})]}):(0,n.jsx)("div",{className:"p-8 text-center text-zinc-500",children:"無區域分佈數據"})})}),t.includes("location-chart")&&(0,n.jsx)(a.ReportWrapper,{title:"區域成交佔比圖表",children:A&&(0,n.jsx)(t2,{roomTypes:s,locations:A.locations,crossTable:A.rows.reduce((e,t)=>{let r={};return A.locations.forEach((e,n)=>{r[e]=t.cells[n]}),e[t.roomType]=r,e},{}),dimension:o})})]}),(0,n.jsx)(t4,{isOpen:d,onClose:()=>x(!1),title:u,projects:h})]})}e.s(["PriceBandReport",()=>t3],65145)},87373,76220,7797,74229,15866,e=>{"use strict";var t=e.i(25191),r=e.i(68524),n=e.i(78320),i=e.i(34029);function a({data:e,selectedRooms:n,metric:a}){let s=(0,r.useMemo)(()=>({count:{label:"交易筆數",unit:"筆",decimals:0},priceSum:{label:"產權總價",unit:"萬",decimals:0},areaSum:{label:"房屋坪數",unit:"坪",decimals:2}})[a],[a]),l=(0,r.useMemo)(()=>{if(!e||0===n.length)return[];let t=Object.keys(e).sort();return 0===t.length?[]:n.map(r=>({name:r,data:t.map(t=>e[t]?.[r]?.[a]||0)}))},[e,n,a]),o=(0,r.useMemo)(()=>({chart:{type:"line",height:350,background:"transparent",toolbar:{show:!0},zoom:{enabled:!1},foreColor:"#e5e7eb"},stroke:{curve:"smooth",width:2},dataLabels:{enabled:!1},xaxis:{categories:e?Object.keys(e).sort():[],labels:{style:{colors:"#9ca3af"}}},yaxis:{title:{text:s.label,style:{color:"#9ca3af"}},labels:{style:{colors:"#9ca3af"},formatter:e=>e.toLocaleString("zh-TW",{minimumFractionDigits:0,maximumFractionDigits:0})}},legend:{position:"top",horizontalAlign:"right"},tooltip:{theme:"dark",y:{formatter:e=>`${e.toLocaleString("zh-TW",{minimumFractionDigits:s.decimals,maximumFractionDigits:s.decimals})} ${s.unit}`}},grid:{borderColor:"#374151"}}),[e,s]);return e&&0!==Object.keys(e).length&&0!==n.length?(0,t.jsx)(i.default,{type:"line",series:l,options:o,height:350,className:"w-full"}):(0,t.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"請選擇房型以顯示銷售趨勢"})}function s({data:e,selectedRooms:n,minArea:a,maxArea:s,interval:l,onDataPointClick:o}){let c=(0,r.useMemo)(()=>[{from:0,to:0,color:"#27272a",name:"0 戶"},{from:1,to:5,color:"#facc15",name:"1-5 戶"},{from:6,to:20,color:"#fbbf24",name:"6-20 戶"},{from:21,to:50,color:"#f97316",name:"21-50 戶"},{from:51,to:1e4,color:"#dc2626",name:"> 50 戶"}],[]),{series:d,maxValue:x}=(0,r.useMemo)(()=>{if(!e||0===n.length)return{series:[],maxValue:0};let t=[];for(let e=a;e<s;e+=l)t.push(`${e.toFixed(1)}-${(e+l).toFixed(1)}`);let r=0;return{series:t.map(t=>{let[i,l]=t.split("-").map(parseFloat);return{name:t,data:n.map(t=>{let n=(e[t]||[]).filter(e=>e>=i&&e<l&&e>=a&&e<=s).length;return n>r&&(r=n),n})}}),maxValue:r}},[e,n,a,s,l]),u=(0,r.useMemo)(()=>({chart:{type:"heatmap",height:Math.max(400,22*d.length),background:"transparent",toolbar:{show:!0},foreColor:"#e5e7eb",events:{dataPointSelection:(e,t,r)=>{if(o){let{seriesIndex:e,dataPointIndex:t}=r,i=r.w.globals.seriesNames[e];o(n[t],i)}}}},plotOptions:{heatmap:{radius:0,useFillColorAsStroke:!0,enableShades:!1,colorScale:{ranges:c}}},dataLabels:{enabled:!0,style:{colors:[({value:e})=>0===e?"transparent":"#e5e7eb"]}},xaxis:{type:"category",categories:n},title:{text:"房型面積分佈熱力圖",align:"center",style:{color:"#e5e7eb",fontSize:"16px"}},grid:{borderColor:"#374151"},tooltip:{theme:"dark",y:{formatter:e=>0===e?"無成交紀錄":`${e} 戶`}}}),[d,n,c,o]);return e&&0!==d.length?(0,t.jsx)(i.default,{type:"heatmap",series:d,options:u,height:u.chart?.height||400,className:"w-full"}):(0,t.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無面積分佈資料"})}var l=e.i(74614);function o({data:e,viewType:n,selectedRooms:i}){if(!e||0===Object.keys(e).length)return(0,t.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無銷售速度資料"});let a=Object.keys(e).sort().reverse();return(0,t.jsx)("div",{className:"overflow-x-auto max-h-[600px] border border-white/5 rounded-lg",children:(0,t.jsxs)("table",{className:"w-full text-sm text-left border-collapse",children:[(0,t.jsxs)("thead",{className:"bg-zinc-900 sticky top-0 z-20 shadow-md",children:[(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{rowSpan:2,className:"px-4 py-3 sticky left-0 z-30 bg-zinc-900 border-r border-white/10 font-medium text-white min-w-[120px]",children:"時間"}),i.map(e=>(0,t.jsx)("th",{colSpan:3,className:"px-2 py-2 text-center border-l border-white/5 text-zinc-300 font-medium bg-zinc-900/90",children:e},e)),(0,t.jsx)("th",{colSpan:3,className:"px-2 py-2 text-center border-l-2 border-white/10 text-cyan-400 font-bold bg-zinc-900/90",children:"總計"})]}),(0,t.jsxs)("tr",{children:[i.map((e,n)=>(0,t.jsxs)(r.default.Fragment,{children:[(0,t.jsx)("th",{className:(0,l.cn)("px-2 py-2 text-center text-xs text-zinc-500 font-normal bg-zinc-900/90 border-b border-white/10",0===n&&"border-l border-white/5"),children:"筆數"}),(0,t.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-500 font-normal bg-zinc-900/90 border-b border-white/10",children:"總價(萬)"}),(0,t.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-500 font-normal bg-zinc-900/90 border-b border-white/10",children:"坪數"})]},e)),(0,t.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-400 font-medium bg-zinc-900/90 border-b border-white/10 border-l-2 border-white/10",children:"筆數"}),(0,t.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-400 font-medium bg-zinc-900/90 border-b border-white/10",children:"總價(萬)"}),(0,t.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-400 font-medium bg-zinc-900/90 border-b border-white/10",children:"坪數"})]})]}),(0,t.jsx)("tbody",{className:"divide-y divide-white/5",children:a.map(a=>{let s=e[a]||{},o={count:0,priceSum:0,areaSum:0};return(0,t.jsxs)("tr",{className:"hover:bg-zinc-800/30 transition-colors",children:[(0,t.jsx)("td",{className:"px-4 py-2 sticky left-0 z-10 bg-zinc-950/90 border-r border-white/10 font-mono text-zinc-400",children:("weekly"===n&&a.includes("-W"),a)}),i.map((e,n)=>{let i=s[e];return i?(o.count+=i.count,o.priceSum+=i.priceSum,o.areaSum+=i.areaSum,(0,t.jsxs)(r.default.Fragment,{children:[(0,t.jsx)("td",{className:(0,l.cn)("px-2 py-2 text-center text-zinc-300",0===n&&"border-l border-white/5"),children:i.count>0?i.count.toLocaleString():"-"}),(0,t.jsx)("td",{className:"px-2 py-2 text-center text-zinc-500 font-mono text-xs",children:i.count>0?(0,l.formatNumber)(i.priceSum,0):"-"}),(0,t.jsx)("td",{className:"px-2 py-2 text-center text-zinc-500 font-mono text-xs",children:i.count>0?(0,l.formatNumber)(i.areaSum,1):"-"})]},e)):(0,t.jsxs)(r.default.Fragment,{children:[(0,t.jsx)("td",{className:(0,l.cn)("px-2 py-2 text-center text-zinc-700",0===n&&"border-l border-white/5"),children:"-"}),(0,t.jsx)("td",{className:"px-2 py-2 text-center text-zinc-700",children:"-"}),(0,t.jsx)("td",{className:"px-2 py-2 text-center text-zinc-700",children:"-"})]},e)}),(0,t.jsx)("td",{className:"px-2 py-2 text-center font-bold text-cyan-400 border-l-2 border-white/10",children:o.count.toLocaleString()}),(0,t.jsx)("td",{className:"px-2 py-2 text-center font-bold text-zinc-300 font-mono text-xs",children:(0,l.formatNumber)(o.priceSum,0)}),(0,t.jsx)("td",{className:"px-2 py-2 text-center font-bold text-zinc-300 font-mono text-xs",children:(0,l.formatNumber)(o.areaSum,1)})]},a)})})]})})}var c=e.i(22112),d=e.i(42217),x=e.i(65949);function u({data:e}){let[i,u]=(0,r.useState)("monthly"),[m,h]=(0,r.useState)("count"),[p,f]=(0,r.useState)(15),[g,b]=(0,r.useState)(65),[y,v]=(0,r.useState)(5),[j,w]=(0,r.useState)([]),[N,z]=(0,r.useState)(null),[P,k]=(0,r.useState)(["2房","3房"]);if(!e)return null;let{salesVelocityAnalysis:S,areaDistributionAnalysis:C}=e,A=e=>Math.round(e)+"萬";return(0,t.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,t.jsxs)("div",{className:"p-4 bg-zinc-900/30 border border-white/5 rounded-lg flex flex-wrap gap-2 items-center sticky top-0 z-40 backdrop-blur-md",children:[(0,t.jsx)("span",{className:"text-zinc-400 text-sm mr-2",children:"分析房型:"}),["套房","1房","2房","3房","4房","毛胚","店舖","辦公/事務所"].map(e=>(0,t.jsx)("button",{onClick:()=>{k(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},className:(0,l.cn)("px-3 py-1 text-xs rounded-full border transition-colors",P.includes(e)?"bg-violet-500/20 border-violet-500 text-violet-200":"bg-zinc-800 border-zinc-700 text-zinc-500 hover:bg-zinc-700"),children:e},e))]}),(0,t.jsx)(n.ReportWrapper,{title:"房型銷售速度與趨勢分析",headerAction:(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(c.Select,{value:i,onChange:e=>u(e.target.value),className:"w-[100px] h-8 text-xs bg-zinc-950/50",children:[(0,t.jsx)("option",{value:"weekly",children:"每週"}),(0,t.jsx)("option",{value:"monthly",children:"每月"}),(0,t.jsx)("option",{value:"quarterly",children:"每季"})]}),(0,t.jsxs)(c.Select,{value:m,onChange:e=>h(e.target.value),className:"w-[100px] h-8 text-xs bg-zinc-950/50",children:[(0,t.jsx)("option",{value:"count",children:"交易筆數"}),(0,t.jsx)("option",{value:"priceSum",children:"總銷金額"}),(0,t.jsx)("option",{value:"areaSum",children:"總銷坪數"})]}),(0,t.jsx)(x.ExportButton,{data:S?.[i],filename:`sales_velocity_${i}`,label:"匯出",columns:{period:"時間區間",count:"交易筆數",priceSum:"總銷金額",areaSum:"總銷坪數"}})]}),children:(0,t.jsx)(a,{data:S?.[i],selectedRooms:P,metric:m})}),(0,t.jsx)(n.ReportWrapper,{title:"銷售速度明細表",description:"各時間段詳細銷售數據統計",headerAction:(0,t.jsx)(x.ExportButton,{data:S?.[i],filename:`sales_velocity_table_${i}`,label:"匯出明細",columns:{period:"時間區間",count:"交易筆數",priceSum:"總銷金額",areaSum:"總銷坪數"}}),children:(0,t.jsx)(o,{data:S?.[i],viewType:i,selectedRooms:P})}),(0,t.jsxs)(n.ReportWrapper,{title:"房型面積分佈熱力圖",description:"分析不同坪數區間的產品供給與去化分佈",headerAction:(0,t.jsxs)("div",{className:"flex gap-2 items-center text-zinc-400 text-xs",children:[(0,t.jsx)("span",{children:"範圍:"}),(0,t.jsx)(d.Input,{type:"number",value:p,onChange:e=>f(Number(e.target.value)),className:"w-16 h-8 text-xs bg-zinc-950/50"}),(0,t.jsx)("span",{children:"-"}),(0,t.jsx)(d.Input,{type:"number",value:g,onChange:e=>b(Number(e.target.value)),className:"w-16 h-8 text-xs bg-zinc-950/50"}),(0,t.jsx)("span",{className:"ml-2",children:"級距:"}),(0,t.jsx)(d.Input,{type:"number",value:y,onChange:e=>v(Number(e.target.value)),className:"w-16 h-8 text-xs bg-zinc-950/50"}),(0,t.jsx)(x.ExportButton,{data:C?Object.entries(C).map(([e,t])=>({key:e,value:JSON.stringify(t)})):[],filename:"area_distribution_heatmap",label:"匯出熱力數據",columns:{key:"坪數區間",value:"分佈數據"}})]}),children:[(0,t.jsx)(s,{data:C,selectedRooms:P,minArea:p,maxArea:g,interval:y,onDataPointClick:(t,r)=>{let n=0,i=1/0;if(r.includes("<"))i=parseFloat(r.replace("<","").trim());else if(r.includes(">"))n=parseFloat(r.replace(">","").trim());else if(r.includes("-")){let e=r.split("-");n=parseFloat(e[0].trim()),i=parseFloat(e[1].trim())}let a=(e.transactionDetails||[]).filter(e=>{let r=function(e){let t=e=>e?String(e).normalize("NFKC").toUpperCase().replace(/\s+/g,""):"",r=t(e["建物型態"]||e.buildingType),n=t(e["主要用途"]||e.mainPurpose),i=t(e["戶別"]||e.unit),a=void 0!==e["房數"]?e["房數"]:e.rooms,s=void 0!==e["房屋面積(坪)"]?parseFloat(e["房屋面積(坪)"]):parseFloat(e.houseArea||0);if(r.includes("住宅大樓")&&i.includes("S")||i.includes("店舖")||i.includes("店面")||i.includes("店鋪"))return"店舖";if(i.includes("事務所")||i.includes("辦公"))return"辦公/事務所";if(r.includes("店舖")||r.includes("店面")||r.includes("店鋪"))return"店舖";if(r.includes("工廠")||r.includes("倉庫")||r.includes("廠辦"))return"廠辦/工廠";if(n.includes("商業")||r.includes("辦公")||r.includes("事務所"))return"辦公/事務所";if((r.includes("住宅大樓")||r.includes("華廈"))&&0===a){if(s>35)return"毛胚";if(s<=35)return"套房"}if("number"==typeof a&&!isNaN(a)){if(1===a)return"1房";if(2===a)return"2房";if(3===a)return"3房";if(4===a)return"4房";if(a>=5)return"5房以上"}return"其他"}(e),a=parseFloat(e["房屋面積(坪)"]||e.houseArea||(e["建物移轉平方公尺"]?.3025*e["建物移移轉平方公尺"]:0));if(!r)return!1;let s=a>=n&&a<i;return r===t&&s});console.log(`[Heatmap Click] Room: ${t}, Range: ${n}-${i}, Found: ${a.length}`);let s={};a.forEach(e=>{let t=e["建案名稱"]||e.projectName||"未知建案";s[t]||(s[t]=[]),s[t].push(e)});let l=Object.entries(s).map(([e,t])=>{let r=t.map(e=>e["產權總價"]||e["交易總價(萬)"]||e.totalPrice||0).filter(e=>e>0).sort((e,t)=>e-t),n=t.map(e=>e["房屋單價"]||e["房屋單價(萬)"]||e.unitPrice||0).filter(e=>e>0),i=0;if(r.length>0){let e=Math.floor(r.length/2);i=r.length%2!=0?r[e]:(r[e-1]+r[e])/2}return{projectName:e,count:t.length,priceRange:{min:r.length>0?r[0]:0,max:r.length>0?r[r.length-1]:0,median:i},unitPriceRange:{min:n.length>0?Math.min(...n):0,max:n.length>0?Math.max(...n):0},transactions:t.sort((e,t)=>{let r=e["房屋單價"]||e["房屋單價(萬)"]||e.unitPrice||0;return(t["房屋單價"]||t["房屋單價(萬)"]||t.unitPrice||0)-r}),isExpanded:!1}});l.sort((e,t)=>t.unitPriceRange.max-e.unitPriceRange.max),w(l),z({roomType:t,areaRange:r,totalCount:a.length})}}),N&&(0,t.jsxs)("div",{className:"mt-4 p-4 bg-zinc-900/50 border border-white/10 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"text-white font-medium flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-cyan-400",children:N.roomType}),(0,t.jsx)("span",{className:"text-zinc-500",children:"|"}),(0,t.jsxs)("span",{children:[N.areaRange," 坪"]})]}),(0,t.jsxs)("p",{className:"text-zinc-400 text-xs mt-1",children:["共找到 ",j.length," 個建案，合計 ",N.totalCount," 筆交易"]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(x.ExportButton,{data:j.flatMap(e=>e.transactions),filename:`heatmap_details_${N.roomType}_${N.areaRange}`,label:"匯出交易明細"}),(0,t.jsx)("button",{onClick:()=>z(null),className:"text-zinc-400 hover:text-white text-sm bg-zinc-800/50 px-3 py-1 rounded-full hover:bg-zinc-700 transition-colors",children:"✕ 關閉"})]})]}),j.length>0?(0,t.jsx)("div",{className:"max-h-[500px] overflow-y-auto pr-1 custom-scrollbar",children:(0,t.jsxs)("table",{className:"w-full text-xs border-collapse",children:[(0,t.jsx)("thead",{className:"bg-zinc-800 text-zinc-300 sticky top-0 z-10 shadow-sm",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"p-3 text-left w-[25%]",children:"建案名稱 (戶數)"}),(0,t.jsx)("th",{className:"p-3 text-center w-[25%]",children:"成交單價範圍 (萬/坪)"}),(0,t.jsx)("th",{className:"p-3 text-center w-[15%]",children:"總價中位數"}),(0,t.jsx)("th",{className:"p-3 text-center w-[35%]",children:"成交總價範圍 (萬)"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-white/5",children:j.map((e,n)=>(0,t.jsxs)(r.default.Fragment,{children:[(0,t.jsxs)("tr",{className:(0,l.cn)("group transition-colors cursor-pointer select-none",e.isExpanded?"bg-zinc-800/60":"hover:bg-zinc-800/30"),onClick:()=>{w(e=>e.map((e,t)=>t===n?{...e,isExpanded:!e.isExpanded}:e))},children:[(0,t.jsxs)("td",{className:"p-3 font-medium text-white flex items-center gap-2",children:[(0,t.jsx)("span",{className:(0,l.cn)("text-zinc-500 transition-transform duration-200",e.isExpanded?"rotate-90":""),children:"▶"}),e.projectName,(0,t.jsx)("span",{className:"px-1.5 py-0.5 rounded-full bg-zinc-700 text-zinc-300 text-[10px] min-w-[24px] text-center",children:e.count})]}),(0,t.jsx)("td",{className:"p-3 text-center font-mono text-cyan-400",children:e.unitPriceRange.min===e.unitPriceRange.max?e.unitPriceRange.min.toFixed(1):`${e.unitPriceRange.min.toFixed(1)} ~ ${e.unitPriceRange.max.toFixed(1)}`}),(0,t.jsx)("td",{className:"p-3 text-center font-mono text-violet-400",children:A(e.priceRange.median||0)}),(0,t.jsx)("td",{className:"p-3 text-center font-mono text-zinc-300",children:e.priceRange.min===e.priceRange.max?A(e.priceRange.min):`${A(e.priceRange.min)} ~ ${A(e.priceRange.max)}`})]}),e.isExpanded&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:4,className:"p-0 bg-zinc-950/30 inset-shadow",children:(0,t.jsx)("div",{className:"p-2 pl-8 border-l-2 border-zinc-700/50 ml-4 my-1",children:(0,t.jsxs)("table",{className:"w-full text-xs bg-transparent opacity-80",children:[(0,t.jsx)("thead",{className:"text-zinc-500 border-b border-white/5",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"py-1 text-left font-normal pl-2",children:"樓層"}),(0,t.jsx)("th",{className:"py-1 text-left font-normal",children:"戶型"}),(0,t.jsx)("th",{className:"py-1 text-right font-normal",children:"坪數"}),(0,t.jsx)("th",{className:"py-1 text-right font-normal",children:"單價"}),(0,t.jsx)("th",{className:"py-1 text-right font-normal pr-2",children:"總價"})]})}),(0,t.jsxs)("tbody",{children:[e.transactions.slice(0,e.showAll?void 0:10).map((e,r)=>(0,t.jsxs)("tr",{className:"hover:text-white",children:[(0,t.jsx)("td",{className:"py-1 pl-2",children:e["樓層"]||e.floor||"-"}),(0,t.jsx)("td",{className:"py-1 text-left text-zinc-400",children:e["戶型"]||"-"}),(0,t.jsx)("td",{className:"py-1 text-right font-mono",children:(e["房屋面積(坪)"]||e.houseArea||0).toFixed(1)}),(0,t.jsx)("td",{className:"py-1 text-right font-mono text-cyan-500",children:(e["房屋單價(萬)"]||e.unitPrice||0).toFixed(1)}),(0,t.jsx)("td",{className:"py-1 text-right font-mono pr-2",children:A(e["交易總價(萬)"]||e.totalPrice||0)})]},r)),e.transactions.length>10&&!e.showAll&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:5,className:"py-2 text-center",children:(0,t.jsxs)("button",{onClick:e=>{e.stopPropagation(),w(e=>e.map((e,t)=>t===n?{...e,showAll:!0}:e))},className:"text-zinc-500 hover:text-zinc-300 italic text-xs hover:underline",children:["... 還有 ",e.transactions.length-10," 筆 (點擊展開) ..."]})})}),e.transactions.length>10&&e.showAll&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:5,className:"py-2 text-center",children:(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),w(e=>e.map((e,t)=>t===n?{...e,showAll:!1}:e))},className:"text-zinc-500 hover:text-zinc-300 italic text-xs hover:underline",children:"... 收合 ..."})})})]})]})})})})]},n))})]})}):(0,t.jsx)("p",{className:"text-zinc-500 text-center py-8 bg-zinc-900/30 rounded border border-dashed border-zinc-800",children:"無詳細資料"})]})]})]})}function m({data:e}){let n=(0,r.useMemo)(()=>e?[e.withParking.count,e.withoutParking.count]:[],[e]),a=(0,r.useMemo)(()=>({chart:{type:"donut",background:"transparent",foreColor:"#e5e7eb"},labels:["含車位","無車位"],colors:["#a5b4fc","#4b5563"],plotOptions:{pie:{donut:{labels:{show:!0,total:{show:!0,label:"總交易",color:"#e5e7eb",formatter:e=>e.globals.seriesTotals.reduce((e,t)=>e+t,0).toLocaleString()+" 筆"}}}}},dataLabels:{enabled:!0,formatter:e=>`${e.toFixed(1)}%`},legend:{show:!1},tooltip:{theme:"dark",y:{formatter:e=>`${e} 筆`}},stroke:{show:!1},responsive:[{breakpoint:480,options:{chart:{width:300},legend:{position:"bottom"}}}]}),[]);return e&&(0!==e.withParking.count||0!==e.withoutParking.count)?(0,t.jsx)(i.default,{type:"donut",series:n,options:a,height:350,className:"w-full"}):(0,t.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無車位配比資料"})}function h({data:e,xLabel:n,yLabel:i,xUnit:a="",yUnit:s="",title:o,highlightIds:c=[]}){let[d,x]=(0,r.useState)(null),[u,m]=(0,r.useState)(null),[h,p]=(0,r.useState)({x:0,y:0}),{xMin:f,xMax:g,yMin:b,yMax:y}=(0,r.useMemo)(()=>{if(0===e.length)return{xMin:0,xMax:100,yMin:0,yMax:100};let t=e.map(e=>e.x),r=e.map(e=>e.y),n=Math.min(...t),i=Math.max(...t),a=Math.min(...r),s=Math.max(...r),l=(i-n)*.1||1,o=(s-a)*.1||1;return{xMin:Math.max(0,n-l),xMax:i+l,yMin:Math.max(0,a-o),yMax:s+o}},[e]),v=c.length>0,j=e=>{let t=e.currentTarget.closest(".relative.bg-zinc-900\\/30")?.getBoundingClientRect();t&&p({x:e.clientX-t.left,y:e.clientY-t.top})},w=u||d,N=(0,r.useMemo)(()=>c.length?[...e].sort((e,t)=>!!c.includes(e.id)-!!c.includes(t.id)):e,[e,c]);return(0,t.jsxs)("div",{className:"w-full h-[400px] relative bg-zinc-900/30 rounded-xl border border-white/5 p-4 select-none cursor-crosshair",onClick:()=>{m(null),x(null)},onMouseMove:e=>{!u&&d&&j(e)},children:[o&&(0,t.jsx)("h4",{className:"absolute top-4 left-4 text-sm font-medium text-zinc-400 pointer-events-none",children:o}),(0,t.jsxs)("div",{className:"absolute inset-x-12 inset-y-12 pointer-events-none",children:[(0,t.jsx)("div",{className:"absolute inset-0 flex flex-col justify-between opacity-20",children:[0,.25,.5,.75,1].map(e=>(0,t.jsx)("div",{className:"w-full h-px border-t border-dashed border-zinc-500"},e))}),(0,t.jsx)("div",{className:"absolute inset-0 flex justify-between opacity-20",children:[0,.25,.5,.75,1].map(e=>(0,t.jsx)("div",{className:"h-full w-px border-l border-dashed border-zinc-500"},e))})]}),(0,t.jsx)("div",{className:"absolute inset-x-12 inset-y-12",children:N.map(e=>{var r,n;let i=(r=e.x,n=e.y,{left:`${(r-f)/(g-f)*100}%`,top:`${100-(n-b)/(y-b)*100}%`}),a=d?.id===e.id,s=u?.id===e.id,o=v&&c.includes(e.id),h="bg-cyan-500/60 hover:bg-cyan-400 z-10",p="";return v&&(o?(h="bg-yellow-400 shadow-[0_0_10px_rgba(250,204,21,0.6)] z-20",p="scale-125"):h="bg-zinc-700/30 z-0"),(a||s)&&(h="bg-cyan-400 shadow-[0_0_15px_rgba(34,211,238,0.8)] ring-2 ring-white z-30",p="scale-150",v&&o&&(h="bg-yellow-400 shadow-[0_0_15px_rgba(250,204,21,0.8)] ring-2 ring-white z-30")),(0,t.jsx)("div",{className:(0,l.cn)("absolute w-3 h-3 rounded-full cursor-pointer transition-all duration-300 transform -translate-x-1/2 -translate-y-1/2",h,p),style:{left:i.left,top:i.top},onMouseEnter:t=>{u||(!v||c.includes(e.id))&&(x(e),j(t))},onMouseLeave:()=>!u&&x(null),onClick:t=>{t.stopPropagation(),(!v||c.includes(e.id))&&(u?.id===e.id?(m(null),x(e)):(m(e),x(null),j(t)))}},e.id)})}),(0,t.jsxs)("div",{className:"absolute left-0 top-12 bottom-12 w-10 flex flex-col justify-between text-[10px] text-zinc-500 text-right pr-2 pointer-events-none",children:[(0,t.jsxs)("span",{children:[Math.round(y),s]}),(0,t.jsxs)("span",{children:[Math.round(b),s]})]}),(0,t.jsxs)("div",{className:"absolute left-12 right-12 bottom-4 h-6 flex justify-between text-[10px] text-zinc-500 pt-1 pointer-events-none",children:[(0,t.jsxs)("span",{children:[Math.round(f),a]}),(0,t.jsxs)("span",{children:[Math.round(g),a]})]}),(0,t.jsx)("div",{className:"absolute bottom-1 left-1/2 -translate-x-1/2 text-xs text-zinc-400 font-bold pointer-events-none",children:n}),(0,t.jsx)("div",{className:"absolute left-1 top-1/2 -translate-y-1/2 -rotate-90 text-xs text-zinc-400 font-bold pointer-events-none",children:i}),w&&(0,t.jsx)("div",{className:"absolute z-50 pointer-events-none",style:{left:h.x,top:h.y,transform:"translate(10px, 10px)"},children:(0,t.jsxs)("div",{className:"bg-zinc-950/90 border border-cyan-500/30 rounded-lg p-3 shadow-xl backdrop-blur-md w-48 animate-in zoom-in-95 fade-in duration-200",children:[(0,t.jsx)("div",{className:"text-sm font-bold text-white mb-1",children:w.label}),(0,t.jsxs)("div",{className:"space-y-1 text-xs text-zinc-400",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("span",{children:[n,":"]}),(0,t.jsxs)("span",{className:"text-cyan-400 font-mono",children:[w.x.toLocaleString()," ",a]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsxs)("span",{children:[i,":"]}),(0,t.jsxs)("span",{className:"text-cyan-400 font-mono",children:[w.y.toLocaleString()," ",s]})]})]})]})})]})}e.s(["SalesVelocityReport",()=>u],87373);var p=e.i(5467),f=e.i(89950),g=e.i(91568);let b=(0,g.default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>b],76220);let y=(0,g.default)("circle-question-mark",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var v=e.i(30844),j=e.i(36441);function w({isOpen:e,onClose:r,title:n,children:i,className:a,maxWidth:s="max-w-4xl"}){return e?(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm animate-in fade-in duration-200",children:[(0,t.jsx)("div",{className:"absolute inset-0",onClick:r}),(0,t.jsxs)(j.Card,{className:(0,l.cn)("relative w-full max-h-[90vh] flex flex-col overflow-hidden animate-in zoom-in-95 duration-200",s,a),onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border-default",children:[n&&(0,t.jsx)("h2",{className:"text-2xl font-bold text-white",children:n}),(0,t.jsx)("button",{onClick:r,className:"p-1 rounded-full hover:bg-white/10 transition-colors text-gray-400 hover:text-white",children:(0,t.jsx)(v.X,{size:24})})]}),(0,t.jsx)("div",{className:"p-6 overflow-y-auto custom-scrollbar",children:i})]})]}):null}e.s(["Modal",()=>w],7797);var N=e.i(74579);function z({projects:e,className:n,onChange:i,max:a=6,placeholder:s="搜尋並加入比較...",title:o="建案亮點標示"}){let[c,d]=(0,r.useState)(""),[x,u]=(0,r.useState)([]),[m,h]=(0,r.useState)(!1),g=(0,r.useRef)(null),b=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=e=>{g.current&&!g.current.contains(e.target)&&h(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let y=e.filter(e=>!x.includes(e.value)&&e.label.toLowerCase().includes(c.toLowerCase())).slice(0,10);return(0,t.jsxs)("div",{className:(0,l.cn)("space-y-2",n),ref:g,children:[(0,t.jsxs)("div",{className:"flex justify-between items-center bg-zinc-900/50 p-1 rounded-lg border border-white/5",children:[(0,t.jsxs)("h4",{className:"text-sm font-medium text-zinc-400 pl-2 border-l-2 border-yellow-500",children:[o," ",(0,t.jsxs)("span",{className:"text-xs font-normal text-zinc-600",children:["(最多 ",a," 個)"]})]}),x.length>0&&(0,t.jsxs)("button",{onClick:()=>{u([]),i([]),b.current?.focus()},className:"p-1.5 text-zinc-500 hover:text-rose-400 hover:bg-rose-500/10 rounded transition-colors flex items-center gap-1 text-xs",title:"清除所有選擇",children:[(0,t.jsx)(N.Trash2,{size:14}),"清除"]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 min-h-[32px]",children:[0===x.length&&(0,t.jsx)("span",{className:"text-xs text-zinc-600 italic py-1",children:"尚未選擇建案..."}),x.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-1 bg-yellow-500/10 text-yellow-500 px-2 py-1 rounded text-xs border border-yellow-500/30",children:[(0,t.jsx)("span",{children:e}),(0,t.jsx)("button",{onClick:()=>{let t;u(t=x.filter(t=>t!==e)),i(t)},className:"hover:text-yellow-300",children:(0,t.jsx)(p.Check,{size:12,className:"rotate-45"})})]},e))]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(f.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-zinc-500"}),(0,t.jsx)("input",{ref:b,type:"text",value:c,onChange:e=>{d(e.target.value),h(!0)},onFocus:()=>h(!0),placeholder:s,className:"w-full bg-zinc-900/50 border border-white/10 rounded-lg pl-9 pr-4 py-2 text-sm text-white placeholder:text-zinc-600 focus:outline-none focus:ring-1 focus:ring-cyan-500/50 transition-all",disabled:x.length>=a}),m&&(0,t.jsx)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-zinc-900 border border-white/10 rounded-lg shadow-xl z-50 max-h-60 overflow-y-auto",children:y.length>0?y.map(e=>(0,t.jsx)("button",{onClick:()=>(e=>{if(x.length>=a)return;let t=[...x,e];u(t),i(t),d(""),b.current?.focus()})(e.value),className:"w-full text-left px-3 py-2 text-sm text-zinc-300 hover:bg-white/5 hover:text-white transition-colors",children:e.label},e.value)):(0,t.jsx)("div",{className:"px-3 py-2 text-sm text-zinc-600",children:"無相關建案"})})]})]})}function P({chartData:e,hasData:n,summaryStats:i}){let[a,s]=(0,r.useState)("scale"),[o,c]=(0,r.useState)(null);r.default.useRef(null);let[d,x]=(0,r.useState)([]);if(!n)return(0,t.jsx)("p",{className:"text-zinc-500 text-center py-4",children:"無坡道平面車位坪數資料"});let u="scale"===a?e.map(e=>({id:e.id,label:e.id,x:e.count,y:e.avgArea})):e.map(e=>({id:e.id,label:e.id,x:e.avgPrice,y:e.avgArea}));return(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 relative",children:[o&&(0,t.jsxs)("div",{className:"fixed z-50 px-3 py-2 bg-zinc-900 border border-white/10 rounded-lg shadow-xl text-xs text-zinc-300 pointer-events-none transform -translate-x-1/2 -translate-y-full animate-in fade-in zoom-in-95",style:{left:o.x,top:o.y},children:[o.text,(0,t.jsx)("div",{className:"absolute left-1/2 bottom-0 w-2 h-2 bg-zinc-900 border-r border-b border-white/10 text-zinc-900 transform rotate-45 -translate-x-1/2 -mb-1"})]}),(0,t.jsxs)("div",{className:"lg:col-span-1 space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-zinc-400 pl-1 border-l-2 border-cyan-500",children:"總體統計數據"}),(0,t.jsx)("div",{className:"bg-zinc-900/30 rounded-xl border border-white/5 p-4",children:(0,t.jsx)("table",{className:"w-full text-sm",children:(0,t.jsxs)("tbody",{className:"divide-y divide-white/5",children:[(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"py-3 text-zinc-500",children:"數據範圍"}),(0,t.jsxs)("td",{className:"py-3 text-right font-mono text-white",children:[(0,t.jsx)("span",{className:"text-cyan-400",children:e.length})," 建案",(0,t.jsx)("span",{className:"mx-1 text-zinc-600",children:"/"}),(0,t.jsx)("span",{className:"text-zinc-300",children:i.count.toLocaleString()})," 車位"]})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"py-3 text-zinc-500",children:"平均坪數"}),(0,t.jsxs)("td",{className:"py-3 text-right font-mono text-cyan-400 text-lg font-bold",children:[i.avgArea.toFixed(2)," ",(0,t.jsx)("span",{className:"text-xs font-normal text-zinc-500",children:"坪"})]})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"py-3 text-zinc-500",children:"坪數中位數"}),(0,t.jsxs)("td",{className:"py-3 text-right font-mono text-zinc-300 text-lg font-bold",children:[i.medianArea.toFixed(2)," ",(0,t.jsx)("span",{className:"text-xs font-normal text-zinc-500",children:"坪"})]})]})]})})})]}),(0,t.jsx)(z,{projects:e.map(e=>({value:e.id,label:e.id})),className:"w-full",onChange:e=>x(e),max:6})]}),(0,t.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-wrap justify-between items-center gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-zinc-400 pl-1 border-l-2 border-violet-500",children:"分佈散佈圖"}),(0,t.jsx)("div",{className:"mt-1 text-xs text-zinc-500 font-mono",children:"scale"===a?(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"text-cyan-400",children:"X軸"}),": 建案車位總數 ",(0,t.jsx)("span",{className:"text-zinc-600",children:"|"})," ",(0,t.jsx)("span",{className:"text-cyan-400",children:"Y軸"}),": 平均車位坪數"]}):(0,t.jsxs)("span",{children:[(0,t.jsx)("span",{className:"text-cyan-400",children:"X軸"}),": 平均車位價格 ",(0,t.jsx)("span",{className:"text-zinc-600",children:"|"})," ",(0,t.jsx)("span",{className:"text-cyan-400",children:"Y軸"}),": 平均車位坪數"]})})]}),(0,t.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)("button",{className:"p-1.5 text-zinc-500 hover:text-cyan-400 transition-colors",children:(0,t.jsx)(y,{size:14})}),(0,t.jsx)("div",{className:"absolute right-0 top-full mt-2 w-64 p-3 bg-zinc-900 border border-white/10 rounded-lg shadow-xl z-50 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:(0,t.jsx)("div",{className:"text-xs text-zinc-300 leading-relaxed",children:"scale"===a?"分析各建案「規劃車位總數」與「平均車位坪數」的關係。可觀察大社區是否傾向規劃較大或較小的車位。":"分析各建案「平均車位價格」與「平均車位坪數」的關係。可觀察車位價格是否隨著坪數增加而顯著提升。"})})]}),(0,t.jsx)("div",{className:"w-px h-4 bg-white/10 mx-1"}),(0,t.jsx)("button",{onClick:()=>s("scale"),className:(0,l.cn)("px-3 py-1.5 text-xs font-medium rounded-md border transition-all duration-200","scale"===a?"bg-cyan-500/10 text-cyan-400 border-cyan-500/50 shadow-[0_0_10px_rgba(34,211,238,0.1)]":"bg-zinc-900/50 border-white/10 text-zinc-500 hover:text-zinc-300 hover:bg-white/5"),children:"規模分析"}),(0,t.jsx)("button",{onClick:()=>s("value"),className:(0,l.cn)("px-3 py-1.5 text-xs font-medium rounded-md border transition-all duration-200","value"===a?"bg-cyan-500/10 text-cyan-400 border-cyan-500/50 shadow-[0_0_10px_rgba(34,211,238,0.1)]":"bg-zinc-900/50 border-white/10 text-zinc-500 hover:text-zinc-300 hover:bg-white/5"),children:"價值分析"})]})]}),(0,t.jsx)(h,{data:u,xLabel:"scale"===a?"建案車位總數":"平均車位價格",yLabel:"平均車位坪數",xUnit:"scale"===a?"位":"萬",yUnit:"坪",title:"scale"===a?"建案規模 vs 車位坪數分佈":"車位價值 vs 坪數分佈",highlightIds:d})]})]})}function k({data:e}){let[i,a]=(0,r.useState)(["B1","B2","B3","B4"]),[s,o]=(0,r.useState)(null),[c,d]=(0,r.useState)(!1),[u,h]=(0,r.useState)(null),[g,y]=(0,r.useState)([]),[v,j]=(0,r.useState)(!1),[N,z]=(0,r.useState)(0);if(!e?.parkingAnalysis)return null;let{parkingRatio:k,avgPriceByType:S,rampPlanePriceByFloor:C}=e.parkingAnalysis,A=["B1","B2","B3","B4","B5_below","Unknown"],M=C?.filter(e=>A.includes(e.floor)&&e.count>0)||[],_=(0,r.useMemo)(()=>(function(e,t){let r=[];if(e.forEach(e=>{t.includes(e.floor)&&e.rawRecords&&e.rawRecords.forEach(e=>{"number"!=typeof e.parkingPrice||isNaN(e.parkingPrice)||r.push(e.parkingPrice)})}),0===r.length)return{avgPrice:0,medianPrice:0,q3Price:0,count:0};r.sort((e,t)=>e-t);let n=r.reduce((e,t)=>e+t,0)/r.length,i=r[Math.floor(r.length/2)],a=Math.floor(.75*r.length),s=r[a]||i;return{avgPrice:n,medianPrice:i,q3Price:s,count:r.length}})(M,i),[M,i]),R=(0,r.useCallback)(e=>{a(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),E=(0,r.useCallback)(()=>{i.length===A.length?a([]):a([...A])},[i.length]),F={B1:"#06b6d4",B2:"#3b82f6",B3:"#6366f1",B4:"#8b5cf6",B5_below:"#a855f7",Unknown:"#71717a"},{parkingChartData:T,parkingChartStats:L,hasParkingData:D}=(0,r.useMemo)(()=>{let e=new Map,t=!1;M.forEach(r=>{r.rawRecords&&r.rawRecords.forEach(r=>{let n=r["建案名稱"],i=r.parkingArea||r["車位面積(坪)"]||.3025*(r["車位移轉總面積平方公尺"]||0),a=r.parkingPrice||r["車位價格(萬)"]||0;if(n&&i>0){e.has(n)||e.set(n,{count:0,totalArea:0,totalPrice:0});let r=e.get(n);r.count+=1,r.totalArea+=i,r.totalPrice+=a,t=!0}})});let r=Array.from(e.entries()).map(([e,t])=>({id:e,label:e,avgArea:parseFloat((t.totalArea/t.count).toFixed(2)),count:t.count,avgPrice:parseFloat((t.totalPrice/t.count).toFixed(2))})),n=0,i=[];r.forEach(e=>{n+=e.count,i.push(e.avgArea)}),i.sort((e,t)=>e-t);let a=i.length>0?i.reduce((e,t)=>e+t,0)/i.length:0,s=i.length>0?i[Math.floor(i.length/2)]:0;return{parkingChartData:r,parkingChartStats:{count:n,avgArea:a,medianArea:s},hasParkingData:t}},[M]);return(0,t.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500 text-white",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsx)(n.ReportWrapper,{title:"房車配比分析",description:"建案有購置車位的比例",headerAction:(0,t.jsx)(x.ExportButton,{data:[{type:"有車位",...k?.withParking},{type:"無車位",...k?.withoutParking},{ratio:k?.avgRatio}],filename:"parking_ratio_data",label:"匯出配比",columns:{type:"類別",count:"數量",percentage:"百分比",ratio:"比率"}}),children:(0,t.jsxs)("div",{className:"flex flex-col md:flex-row items-start gap-6",children:[(0,t.jsx)("div",{className:"w-full md:w-1/2",children:(0,t.jsx)(m,{data:k})}),(0,t.jsxs)("div",{className:"w-full md:w-1/2 flex flex-col gap-4",children:[(0,t.jsxs)("table",{className:"w-full text-sm",children:[(0,t.jsx)("thead",{className:"bg-zinc-900/50 text-zinc-500",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"p-2 text-left",children:"類型"}),(0,t.jsx)("th",{className:"p-2 text-right",children:"筆數"}),(0,t.jsx)("th",{className:"p-2 text-right",children:"佔比"})]})}),(0,t.jsxs)("tbody",{className:"divide-y divide-white/5",children:[(0,t.jsxs)("tr",{children:[(0,t.jsxs)("td",{className:"p-2 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"w-3 h-3 rounded-full bg-indigo-300"}),"有搭車位"]}),(0,t.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:k?.withParking?.count.toLocaleString()}),(0,t.jsxs)("td",{className:"p-2 text-right font-mono text-cyan-400",children:[k?.withParking?.percentage.toFixed(2),"%"]})]}),(0,t.jsxs)("tr",{children:[(0,t.jsxs)("td",{className:"p-2 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"w-3 h-3 rounded-full bg-gray-600"}),"無車位"]}),(0,t.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:k?.withoutParking?.count.toLocaleString()}),(0,t.jsxs)("td",{className:"p-2 text-right font-mono text-zinc-500",children:[k?.withoutParking?.percentage.toFixed(2),"%"]})]})]})]}),(0,t.jsxs)("div",{className:"flex gap-6 justify-center md:justify-start px-2 text-sm text-zinc-400",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"w-3 h-3 rounded-full bg-indigo-300"}),(0,t.jsx)("span",{children:"有搭車位"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"w-3 h-3 rounded-full bg-gray-600"}),(0,t.jsx)("span",{children:"無車位"})]})]})]})]})}),(0,t.jsx)(n.ReportWrapper,{title:"車位類型均價",description:"各類車位成交行情",headerAction:(0,t.jsx)(x.ExportButton,{data:S||[],filename:"parking_price_by_type",label:"匯出均價",columns:{type:"車位類型",avgPrice:"平均價格",medianPrice:"中位數",count:"數量"}}),children:(0,t.jsxs)("table",{className:"w-full text-sm",children:[(0,t.jsx)("thead",{className:"bg-zinc-900/50 text-zinc-500",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"p-2 text-left",children:"類型"}),(0,t.jsx)("th",{className:"p-2 text-right",children:"均價(萬)"}),(0,t.jsx)("th",{className:"p-2 text-right",children:"中位數"}),(0,t.jsx)("th",{className:"p-2 text-right",children:"總數"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-white/5",children:S?.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-zinc-800/50",children:[(0,t.jsx)("td",{className:"p-2 font-medium",children:e.type}),(0,t.jsx)("td",{className:"p-2 text-right font-mono text-cyan-400",children:Math.round(e.avgPrice).toLocaleString()}),(0,t.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:Math.round(e.medianPrice).toLocaleString()}),(0,t.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:e.count.toLocaleString()})]},e.type))})]})})]}),(0,t.jsx)(n.ReportWrapper,{title:"坡道平面車位坪數散佈分析",description:"建案車位數與坪數分佈",className:"relative z-20",headerAction:(0,t.jsx)(x.ExportButton,{data:T||[],filename:"parking_area_scatter_data",label:"匯出散佈數據",columns:{id:"建案名稱",label:"標籤",avgArea:"平均坪數",count:"車位數",avgPrice:"平均價格"}}),children:(0,t.jsx)(P,{chartData:T,hasData:D,summaryStats:L})}),(0,t.jsx)(n.ReportWrapper,{title:"坡道平面車位 - 樓層價差分析",description:"勾選樓層以動態更新統計數據",headerAction:(0,t.jsx)(x.ExportButton,{data:M||[],filename:"parking_floor_analysis",label:"匯出樓層統計",columns:{floor:"樓層",count:"數量",avgPrice:"平均價格",medianPrice:"中位數",maxPrice:"最高價",minPrice:"最低價",q3Price:"第三四分位數"}}),children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,t.jsx)("div",{className:"flex flex-col gap-2 items-center justify-center p-8 bg-zinc-900/30 rounded-xl relative",children:M.map((r,n)=>{let a=i.includes(r.floor),c=s===r.floor;return(0,t.jsxs)("div",{onMouseEnter:()=>o(r.floor),onMouseLeave:()=>o(null),className:(0,l.cn)("w-52 h-14 rounded-lg flex items-center justify-between px-4 shadow-lg transition-all duration-200 cursor-pointer group relative",c&&"ring-2 ring-white scale-105",!a&&"opacity-30"),style:{backgroundColor:F[r.floor]||"#4b5563"},onClick:()=>R(r.floor),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:(0,l.cn)("w-5 h-5 rounded border-2 flex items-center justify-center",a?"bg-white border-white":"border-white/50"),children:a&&(0,t.jsx)(p.Check,{size:14,className:"text-zinc-900"})}),(0,t.jsx)("span",{className:"font-bold text-white",children:r.floor})]}),(0,t.jsx)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity z-10",children:(0,t.jsx)("button",{onClick:t=>{t.stopPropagation(),(t=>{h(t),j(!1);let r=C?.find(e=>e.floor===t),n=r?.rawRecords;if(n&&n.length>0){let e=n.map(e=>({...e,_isMatch:!0}));e.sort((e,t)=>{let r=e["交易年月日"]||0;return(t["交易年月日"]||0)-r}),y(e),z(e.length)}else{let r=e?.transactionDetails||[],n=[t];"B1"===t&&n.push("地下一層","B1","b1"),"B2"===t&&n.push("地下二層","B2","b2"),"B3"===t&&n.push("地下三層","B3","b3"),"B4"===t&&n.push("地下四層","B4","b4"),"B5_below"===t&&n.push("地下五層","B5","b5");let i=r.filter(e=>(e["車位類別"]||"").includes("坡道平面")),a=i.filter(e=>{let t=e["車位所在樓層"]||"",r=e["備註"]||"";return n.some(e=>t&&t.includes(e)||r&&r.includes(e))});z(a.length);let s=i.map(e=>{let t=e["車位所在樓層"]||"",r=e["備註"]||"",i=n.some(e=>t&&t.includes(e)||r&&r.includes(e));return{...e,_isMatch:i}});s.sort((e,t)=>{if(e._isMatch&&!t._isMatch)return -1;if(!e._isMatch&&t._isMatch)return 1;let r=e["交易年月日"]||0;return(t["交易年月日"]||0)-r}),y(s),0===a.length&&j(!0)}d(!0)})(r.floor)},className:"p-1.5 bg-black/40 hover:bg-black/80 rounded-full text-white backdrop-blur-sm transition-colors ring-1 ring-white/20",title:`查看 ${r.floor} 建案明細`,children:(0,t.jsx)(f.Search,{size:14})})}),(0,t.jsxs)("div",{className:"text-right mt-1",children:[(0,t.jsxs)("div",{className:"font-mono text-white text-sm",children:[Math.round(r.avgPrice).toLocaleString()," 萬"]}),(0,t.jsxs)("div",{className:"text-white/70 text-xs",children:[r.count," 位"]})]})]},r.floor)})}),(0,t.jsxs)(w,{isOpen:c,onClose:()=>d(!1),title:`${u} 車位交易明細`,maxWidth:"max-w-5xl",children:[(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-zinc-800/50 p-1 rounded-lg border border-white/10",children:[(0,t.jsxs)("button",{onClick:()=>j(!1),className:(0,l.cn)("px-3 py-1.5 rounded text-xs transition-colors font-medium flex items-center gap-1.5",v?"text-zinc-500 hover:text-zinc-300 hover:bg-white/5":"bg-cyan-500/20 text-cyan-400 border border-cyan-500/30 shadow-[0_0_10px_rgba(34,211,238,0.1)]"),children:[(0,t.jsx)(p.Check,{size:12}),"精確匹配 (",N,")"]}),(0,t.jsxs)("button",{onClick:()=>j(!0),className:(0,l.cn)("px-3 py-1.5 rounded text-xs transition-colors font-medium",v?"bg-rose-500/20 text-rose-400 border border-rose-500/30 shadow-[0_0_10px_rgba(244,63,94,0.1)]":"text-zinc-500 hover:text-zinc-300 hover:bg-white/5"),children:["未匹配 (",g.length-N,")"]}),(0,t.jsx)("div",{className:"ml-auto",children:(0,t.jsx)(x.ExportButton,{data:g.filter(e=>v?!e._isMatch:e._isMatch),filename:`parking_details_${u}_${v?"all":"match"}`,label:"匯出明細"})})]})}),(0,t.jsx)("div",{className:"overflow-x-auto rounded-lg border border-white/10 max-h-[60vh] custom-scrollbar",children:(0,t.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,t.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 whitespace-nowrap sticky top-0 z-10 backdrop-blur-md",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"p-3",children:"建案名稱"}),(0,t.jsx)("th",{className:"p-3",children:"交易日期"}),(0,t.jsx)("th",{className:"p-3 text-right",children:"車位總價"}),(0,t.jsx)("th",{className:"p-3 text-right",children:"車位面積"}),(0,t.jsx)("th",{className:"p-3",children:"車位樓層"}),(0,t.jsx)("th",{className:"p-3",children:"備註"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-white/5",children:g.length>0?g.filter(e=>v?!e._isMatch:e._isMatch).map((e,r)=>(0,t.jsxs)("tr",{className:(0,l.cn)("hover:bg-zinc-800/50 transition-colors",e._isMatch?"bg-cyan-500/5":"opacity-60"),children:[(0,t.jsxs)("td",{className:"p-3 font-medium text-white",children:[(0,t.jsx)("div",{children:e["建案名稱"]}),(0,t.jsxs)("div",{className:"text-[10px] text-zinc-600 font-mono mt-0.5",children:["#",e.transactionId||e["編號"]]})]}),(0,t.jsxs)("td",{className:"p-3 text-zinc-400 flex items-center gap-1",children:[(0,t.jsx)(b,{size:12,className:"text-zinc-600"}),e["交易日"]]}),(0,t.jsxs)("td",{className:"p-3 text-right font-mono text-cyan-400",children:[e["車位總價元"]?(e["車位總價元"]/1e4).toLocaleString():"-"," 萬"]}),(0,t.jsxs)("td",{className:"p-3 text-right font-mono text-zinc-300",children:[e["車位移轉總面積平方公尺"]?(.3025*e["車位移轉總面積平方公尺"]).toFixed(2):"-"," 坪"]}),(0,t.jsx)("td",{className:"p-3 text-zinc-300",children:e["車位所在樓層"]||"-"}),(0,t.jsx)("td",{className:"p-3 text-zinc-500 text-xs max-w-[200px] truncate",title:e["備註"],children:e["備註"]})]},r)):(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:6,className:"p-8 text-center text-zinc-500",children:"查無相關交易資料。"})})})]})})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"p-4 bg-gradient-to-r from-cyan-500/10 to-violet-500/10 border border-cyan-500/30 rounded-lg",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-cyan-400 mb-3",children:"已選樓層統計"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-zinc-500",children:"車位數"}),(0,t.jsx)("div",{className:"text-lg font-bold text-white",children:_.count.toLocaleString()})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-zinc-500",children:"平均單價"}),(0,t.jsxs)("div",{className:"text-lg font-bold text-cyan-400",children:[Math.round(_.avgPrice).toLocaleString()," 萬"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-zinc-500",children:"中位數"}),(0,t.jsxs)("div",{className:"text-lg font-bold text-zinc-300",children:[Math.round(_.medianPrice).toLocaleString()," 萬"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-zinc-500",children:"3/4位數"}),(0,t.jsxs)("div",{className:"text-lg font-bold text-zinc-300",children:[Math.round(_.q3Price).toLocaleString()," 萬"]})]})]})]}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-sm",children:[(0,t.jsx)("thead",{className:"bg-zinc-900/50 text-zinc-500",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"p-2 text-left",children:(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:i.length===A.length,onChange:E,className:"form-checkbox rounded bg-zinc-800 border-zinc-600 text-cyan-500"}),(0,t.jsx)("span",{children:"全選"})]})}),(0,t.jsx)("th",{className:"p-2 text-left",children:"樓層"}),(0,t.jsx)("th",{className:"p-2 text-right",children:"均價(萬)"}),(0,t.jsx)("th",{className:"p-2 text-right",children:"中位數"}),(0,t.jsx)("th",{className:"p-2 text-right",children:"最高"}),(0,t.jsx)("th",{className:"p-2 text-right",children:"最低"}),(0,t.jsx)("th",{className:"p-2 text-right",children:"車位數"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-white/5",children:M.map(e=>{let r=i.includes(e.floor),n=s===e.floor;return(0,t.jsxs)("tr",{onMouseEnter:()=>o(e.floor),onMouseLeave:()=>o(null),className:(0,l.cn)("transition-colors cursor-pointer",n?"bg-zinc-800":"hover:bg-zinc-800/50",!r&&"opacity-50"),onClick:()=>R(e.floor),children:[(0,t.jsx)("td",{className:"p-2",children:(0,t.jsx)("input",{type:"checkbox",checked:r,onChange:()=>R(e.floor),className:"form-checkbox rounded bg-zinc-800 border-zinc-600 text-cyan-500",onClick:e=>e.stopPropagation()})}),(0,t.jsx)("td",{className:"p-2 font-medium",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:F[e.floor]}}),e.floor]})}),(0,t.jsx)("td",{className:"p-2 text-right font-mono text-cyan-400",children:Math.round(e.avgPrice).toLocaleString()}),(0,t.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:Math.round(e.medianPrice).toLocaleString()}),(0,t.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:Math.round(e.maxPrice).toLocaleString()}),(0,t.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:Math.round(e.minPrice).toLocaleString()}),(0,t.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:e.count.toLocaleString()})]},e.floor)})})]})})]})]})})]})}e.s(["ProjectSearchMultiselect",()=>z],74229),e.s(["ParkingAnalysisReport",()=>k],15866)},12885,78956,e=>{"use strict";var t=e.i(25191),r=e.i(68524),n=e.i(78320),i=e.i(1801),a=e.i(74614),s=e.i(42217);let l=({children:e,x:n,y:a,visible:s})=>{let[l,o]=(0,r.useState)(!1);return((0,r.useEffect)(()=>(o(!0),()=>o(!1)),[]),l&&s&&!("u"<typeof document))?(0,i.createPortal)((0,t.jsx)("div",{className:"fixed pointer-events-none z-[9999]",style:{left:n,top:a,transform:"translate(-50%, -100%) translateY(-12px)"},children:e}),document.body):null};function o({data:e,minPrice:n,maxPrice:i,interval:o,sizeMetric:c,onMinPriceChange:d,onMaxPriceChange:x,onIntervalChange:u,onSizeMetricChange:m}){let[h,p]=(0,r.useState)("natural"),[f,g]=(0,r.useState)(null),[b,y]=(0,r.useState)({x:0,y:0}),v=(0,r.useRef)(null),[j,w]=(0,r.useState)({width:0,height:0});(0,r.useEffect)(()=>{if(!v.current)return;let e=()=>{v.current&&w({width:v.current.clientWidth,height:v.current.clientHeight})};e(),window.addEventListener("resize",e);let t=setTimeout(e,200);return()=>{window.removeEventListener("resize",e),clearTimeout(t)}},[]);let N=(e,t)=>{let r=e.currentTarget.getBoundingClientRect();y({x:r.left+r.width/2,y:r.top}),g(t)},{buckets:z,validBuckets:P,maxValue:k}=(0,r.useMemo)(()=>{if(!e||0===e.length)return{buckets:[],validBuckets:[],maxValue:0};let t=[];for(let e=n;e<i;e+=o)t.push({min:e,max:Math.min(e+o,i),label:`${e}-${Math.min(e+o,i)}`,count:0,totalArea:0,avgPrice:0,transactions:[]});e.forEach(e=>{let r=e["房屋單價(萬)"],a=e["房屋面積(坪)"]||0;if("number"!=typeof r||r<n||r>=i)return;let s=Math.floor((r-n)/o);s>=0&&s<t.length&&(t[s].count++,t[s].totalArea+=a,t[s].transactions.push(e))});let r=t.filter(e=>e.count>0),a=Math.max(...r.map(e=>"count"===c?e.count:e.totalArea));return{buckets:t,validBuckets:r,maxValue:a}},[e,n,i,o,c]),{nodes:S,onMouseDown:C,dragId:A}=((e,t,n,i,a,s)=>{let[l,o]=(0,r.useState)([]),c=(0,r.useRef)(null),d=(0,r.useRef)(null),x=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(!e.length||!t||!n)return;let r=t/2,s=n/2,l=e.map((e,t)=>{let r="count"===i?e.count:e.totalArea,n=a>0?30+r/a*80:30;return{id:e.label,value:r,radius:n/2,x:0,y:0,vx:0,vy:0,origIndex:t}});l.sort((e,t)=>e.value-t.value),l=l.map((e,t)=>{let n=2.39996*t,i=10*Math.sqrt(t)*2.5;return{...e,x:r+Math.cos(n)*i,y:s+Math.sin(n)*i}});for(let e=0;e<120;e++)for(let e=0;e<l.length;e++)for(let t=e+1;t<l.length;t++){let r=l[e],n=l[t],i=n.x-r.x,a=n.y-r.y,s=i*i+a*a,o=r.radius+n.radius+5;if(s<o*o&&s>0){let e=Math.sqrt(s),t=o-e,l=i/e,c=a/e,d=.5*t;r.x-=l*d,r.y-=c*d,n.x+=l*d,n.y+=c*d}}o(l)},[e,t,n,i,a]),(0,r.useEffect)(()=>{if(!s)return;let e=e=>{x.current={x:e.clientX,y:e.clientY}},t=()=>{d.current=null,x.current=null};return window.addEventListener("mousemove",e),window.addEventListener("mouseup",t),()=>{window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",t)}},[s]),(0,r.useEffect)(()=>{if(!s||0===l.length||!t)return;let e=t/2,r=n/2,i=()=>{o(t=>{let n=t.map(e=>({...e})),i=0,a=0,s=0,l=0;d.current&&x.current&&(i=x.current.x-d.current.startX,a=x.current.y-d.current.startY,s=d.current.nodeOrigX+i,l=d.current.nodeOrigY+a),n.forEach(t=>{if(d.current?.id===t.id)t.x=s,t.y=l,t.vx=0,t.vy=0;else{let n=e-t.x,i=r-t.y;t.vx+=.05*n*.05,t.vy+=.05*i*.05,t.vx+=(Math.random()-.5)*.003,t.vy+=(Math.random()-.5)*.003,t.x+=t.vx,t.y+=t.vy,t.vx*=.94,t.vy*=.94}});for(let e=0;e<6;e++)for(let e=0;e<n.length;e++)for(let t=e+1;t<n.length;t++){let r=n[e],i=n[t],a=d.current?.id===r.id,s=d.current?.id===i.id,l=i.x-r.x,o=i.y-r.y,c=l*l+o*o,x=r.radius+i.radius+5;if(c<x*x&&c>0){let e=Math.sqrt(c),t=x-e,n=l/e,d=o/e,u=.5*t;a?(i.x+=n*t,i.y+=d*t):s?(r.x-=n*t,r.y-=d*t):(r.x-=n*u,r.y-=d*u,i.x+=n*u,i.y+=d*u)}}return n}),c.current=requestAnimationFrame(i)};return c.current=requestAnimationFrame(i),()=>{null!==c.current&&cancelAnimationFrame(c.current)}},[s,t,n,l.length]),{nodes:l,onMouseDown:(e,t,r,n)=>{e.preventDefault(),d.current={id:t,startX:e.clientX,startY:e.clientY,nodeOrigX:r,nodeOrigY:n},x.current={x:e.clientX,y:e.clientY}},dragId:d.current?.id}})(P,j.width,j.height,c,k,"natural"===h);if(!e||0===e.length)return(0,t.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無交易資料可顯示"});let M=(e,t)=>{let r,n,i=e/(t-1||1);return i<.33?(r="radial-gradient(circle at 30% 30%, rgb(167, 139, 250), rgb(124, 58, 237))",n="rgba(124, 58, 237, 0.4)"):i<.66?(r="radial-gradient(circle at 30% 30%, rgb(34, 211, 238), rgb(8, 145, 178))",n="rgba(8, 145, 178, 0.4)"):(r="radial-gradient(circle at 30% 30%, rgb(52, 211, 153), rgb(5, 150, 105))",n="rgba(5, 150, 105, 0.4)"),{background:r,shadowColor:n}},_=null!==f?P[f]:null;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(l,{x:b.x,y:b.y,visible:null!==f&&!!_&&!A,children:_&&(0,t.jsxs)("div",{className:"px-4 py-3 bg-zinc-900/90 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl min-w-[160px] animate-in fade-in zoom-in-95 duration-200",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("span",{className:"text-xs font-medium text-zinc-400",children:"成交單價"}),(0,t.jsx)("span",{className:"text-sm font-bold text-white",children:_.label})]}),(0,t.jsxs)("div",{className:"space-y-1.5",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center text-xs",children:[(0,t.jsx)("span",{className:"text-zinc-500",children:"成交筆數"}),(0,t.jsxs)("span",{className:"font-medium text-violet-300",children:[_.count," 筆"]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center text-xs",children:[(0,t.jsx)("span",{className:"text-zinc-500",children:"總銷坪數"}),(0,t.jsxs)("span",{className:"font-medium text-cyan-300",children:[Math.round(_.totalArea)," 坪"]})]})]}),(0,t.jsx)("div",{className:"absolute left-1/2 bottom-0 -mb-1 w-2 h-2 bg-zinc-900/90 border-r border-b border-white/10 rotate-45 -translate-x-1/2"})]})}),(0,t.jsxs)("div",{className:"flex flex-col xl:flex-row items-start xl:items-center justify-between gap-4 p-4 bg-zinc-900/30 border border-white/5 rounded-xl",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-zinc-400 text-xs",children:"單價範圍"}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(s.Input,{type:"number",value:n,onChange:e=>d(Number(e.target.value)),className:"w-16 h-7 text-xs bg-zinc-950/50 border-white/10 px-2"}),(0,t.jsx)("span",{className:"text-zinc-600",children:"-"}),(0,t.jsx)(s.Input,{type:"number",value:i,onChange:e=>x(Number(e.target.value)),className:"w-16 h-7 text-xs bg-zinc-950/50 border-white/10 px-2"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-zinc-400 text-xs",children:"級距"}),(0,t.jsx)(s.Input,{type:"number",value:o,onChange:e=>u(Number(e.target.value)),className:"w-14 h-7 text-xs bg-zinc-950/50 border-white/10 px-2"})]}),(0,t.jsxs)("div",{className:"flex bg-zinc-950/50 rounded-md p-0.5 border border-white/10",children:[(0,t.jsx)("button",{onClick:()=>m("count"),className:(0,a.cn)("px-2.5 py-1 text-[10px] rounded transition-colors","count"===c?"bg-violet-500 text-white shadow-sm":"text-zinc-400 hover:text-white"),children:"成交筆數"}),(0,t.jsx)("button",{onClick:()=>m("area"),className:(0,a.cn)("px-2.5 py-1 text-[10px] rounded transition-colors","area"===c?"bg-violet-500 text-white shadow-sm":"text-zinc-400 hover:text-white"),children:"總銷坪數"})]})]}),(0,t.jsxs)("div",{className:"bg-zinc-950/50 p-1 rounded-lg border border-white/5 flex gap-1 self-end xl:self-auto",children:[(0,t.jsx)("button",{onClick:()=>p("natural"),className:(0,a.cn)("px-3 py-1.5 text-xs font-medium rounded-md transition-all duration-300","natural"===h?"bg-gradient-to-r from-violet-600 to-indigo-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-500 hover:text-zinc-300"),children:(0,t.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,t.jsxs)("span",{className:"relative flex h-2 w-2",children:[(0,t.jsx)("span",{className:(0,a.cn)("absolute inline-flex h-full w-full rounded-full bg-violet-400 opacity-75","natural"===h&&"animate-ping")}),(0,t.jsx)("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-violet-500"})]}),"無重力模式"]})}),(0,t.jsx)("button",{onClick:()=>p("coordinate"),className:(0,a.cn)("px-3 py-1.5 text-xs font-medium rounded-md transition-all duration-300","coordinate"===h?"bg-gradient-to-r from-violet-600 to-indigo-600 text-white shadow-lg shadow-violet-500/20":"text-zinc-500 hover:text-zinc-300"),children:(0,t.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,t.jsxs)("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,t.jsx)("path",{d:"M3 3v18h18"}),(0,t.jsx)("path",{d:"M18 17V9"}),(0,t.jsx)("path",{d:"M13 17V5"}),(0,t.jsx)("path",{d:"M8 17v-3"})]}),"座標模式"]})})]})]}),(0,t.jsxs)("div",{ref:v,className:(0,a.cn)("relative rounded-3xl overflow-hidden border border-white/5 transition-all duration-500","bg-gradient-to-b from-zinc-900 via-zinc-900 to-zinc-950","min-h-[500px]"),children:[(0,t.jsxs)("div",{className:"absolute inset-0 pointer-events-none",children:[(0,t.jsx)("div",{className:"absolute top-0 inset-x-0 h-px bg-gradient-to-r from-transparent via-white/10 to-transparent"}),(0,t.jsx)("div",{className:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-violet-500/10 rounded-full blur-[100px]"}),(0,t.jsx)("div",{className:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-cyan-500/10 rounded-full blur-[100px]"})]}),(0,t.jsxs)("div",{className:"relative w-full h-full min-h-[500px]",children:["natural"===h&&(0,t.jsxs)("div",{className:"absolute inset-0",children:[S.map((e,r)=>{let n=f===e.origIndex,i=A===e.id,s=M(e.origIndex,P.length),l=2*e.radius;return(0,t.jsxs)("div",{className:(0,a.cn)("absolute block rounded-full select-none cursor-grab active:cursor-grabbing will-change-transform",i?"z-[100] scale-110 shadow-2xl":"transition-[transform,box-shadow] duration-75 ease-linear"),style:{width:l,height:l,left:0,top:0,transform:`translate(${e.x-e.radius}px, ${e.y-e.radius}px) scale(${n||i?1.1:1})`,background:s.background,boxShadow:i?`0 25px 50px -12px ${s.shadowColor}, inset 0 2px 20px rgba(255,255,255,0.6)`:n?`0 20px 40px -10px ${s.shadowColor}, inset 0 2px 20px rgba(255,255,255,0.4)`:`0 10px 30px -10px ${s.shadowColor}, inset 0 2px 10px rgba(255,255,255,0.2)`,zIndex:i?100:n?50:10},onMouseEnter:t=>N(t,e.origIndex),onMouseLeave:()=>g(null),onMouseDown:t=>C(t,e.id,e.x,e.y),children:[(0,t.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-white/0 via-white/0 to-white/30 opacity-50 pointer-events-none"}),(0,t.jsx)("div",{className:"absolute top-[15%] left-[15%] w-[25%] h-[15%] rounded-[100%] bg-white blur-[2px] opacity-40 transform -rotate-45 pointer-events-none"}),(0,t.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-center z-20 pointer-events-none",children:[(0,t.jsx)("div",{className:(0,a.cn)("font-bold text-white drop-shadow-md leading-none",l>80?"text-2xl":l>60?"text-lg":"text-sm","mix-blend-overlay opacity-90"),children:e.value>=1?Math.round(e.value):e.value.toFixed(1)}),l>80&&(0,t.jsx)("div",{className:"text-[10px] text-white/70 mt-1 font-medium tracking-wide",children:"count"===c?"筆":"坪"})]})]},e.id)}),(0,t.jsx)("div",{className:"absolute bottom-4 left-0 right-0 text-center text-xs text-zinc-500 font-medium tracking-widest uppercase opacity-50 pointer-events-none",children:"Zero Gravity • Force Layout • Draggable"})]}),"coordinate"===h&&(0,t.jsxs)("div",{className:"absolute inset-0 p-8",children:[(0,t.jsx)("div",{className:"flex flex-col justify-between py-6 pr-6 text-right w-[60px] border-r border-white/5 relative z-10 h-full float-left",children:[...Array(6)].map((e,r)=>(0,t.jsx)("span",{className:"text-xs font-mono text-zinc-600 block",children:Math.round(i-(i-n)/5*r)},r))}),(0,t.jsxs)("div",{className:"relative ml-[76px] h-full",children:[(0,t.jsx)("div",{className:"absolute inset-0 flex flex-col justify-between pointer-events-none",children:[...Array(6)].map((e,r)=>(0,t.jsx)("div",{className:"w-full h-px border-t border-dashed border-zinc-800"},r))}),(0,t.jsx)("div",{className:"absolute inset-0",children:P.map((e,r)=>{var s;let l=(s="count"===c?e.count:e.totalArea,0===k?40:40+s/k*100),o=(e.min+e.max)/2,d=r/(P.length-1||1)*90+5,x=100-(o-n)/(i-n)*100,u=f===r,m=M(r,P.length);return(0,t.jsx)("div",{className:"absolute transform -translate-x-1/2 -translate-y-1/2 transition-all duration-500",style:{left:`${d}%`,top:`${x}%`,zIndex:u?50:20},onMouseEnter:e=>N(e,r),onMouseLeave:()=>g(null),children:(0,t.jsx)("div",{className:(0,a.cn)("relative rounded-full flex items-center justify-center cursor-pointer shadow-lg transition-transform duration-300",u?"scale-110":"scale-100"),style:{width:l,height:l,background:m.background,boxShadow:u?`0 10px 20px -5px ${m.shadowColor}, inset 0 2px 10px rgba(255,255,255,0.3)`:`0 5px 15px -5px ${m.shadowColor}, inset 0 2px 5px rgba(255,255,255,0.2)`},children:(0,t.jsx)("div",{className:"absolute inset-0 rounded-full bg-gradient-to-tr from-transparent to-white/30 opacity-60"})})},e.label)})}),(0,t.jsxs)("div",{className:"absolute bottom-0 inset-x-0 flex justify-between text-xs text-zinc-600 font-mono translate-y-full pt-2",children:[(0,t.jsx)("span",{children:"Low Price"}),(0,t.jsx)("span",{children:"High Price"})]})]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between px-2 text-xs text-zinc-500",children:[(0,t.jsxs)("div",{children:["* Bubble size represents ","count"===c?"Transaction Count":"Total Area"]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-violet-500"}),(0,t.jsx)("span",{children:"Low"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-cyan-500"}),(0,t.jsx)("span",{children:"Mid"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),(0,t.jsx)("span",{children:"High"})]})]})]})]})}function c({title:e,stats:r,noDataMessage:n="無資料",className:i,averageType:s="weighted"}){if(!r||0===r.count)return(0,t.jsxs)("div",{className:(0,a.cn)("p-6 border border-white/5 rounded-lg bg-zinc-900/30",i),children:[(0,t.jsx)("h3",{className:"text-zinc-400 font-medium mb-4",children:e}),(0,t.jsx)("p",{className:"text-zinc-500 text-center py-4",children:n})]});let l="weighted"===s&&r.weightedAvgPrice?r.weightedAvgPrice:r.avgPrice;return(0,t.jsxs)("div",{className:(0,a.cn)("p-6 border border-white/5 rounded-lg bg-zinc-900/30",i),children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-white",children:e}),(0,t.jsxs)("span",{className:"text-xs text-zinc-500 bg-zinc-800 px-2 py-1 rounded",children:["樣本數: ",r.count]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,t.jsx)("div",{className:"space-y-1",children:(0,t.jsx)("table",{className:"w-full text-sm",children:(0,t.jsxs)("tbody",{className:"divide-y divide-white/5",children:[(0,t.jsxs)("tr",{className:"group",children:[(0,t.jsx)("td",{className:"py-2 text-zinc-400",children:"weighted"===s?"加權平均單價":"算術平均單價"}),(0,t.jsxs)("td",{className:"py-2 text-right font-mono text-white group-hover:text-cyan-400 transition-colors",children:[(0,a.formatNumber)(l)," 萬/坪"]})]}),(0,t.jsxs)("tr",{className:"group",children:[(0,t.jsx)("td",{className:"py-2 text-zinc-400",children:"最低單價"}),(0,t.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors",children:(0,a.formatNumber)(r.minPrice)})]}),(0,t.jsxs)("tr",{className:"group",children:[(0,t.jsx)("td",{className:"py-2 text-zinc-400",children:"1/4分位數"}),(0,t.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors",children:(0,a.formatNumber)(r.q1Price)})]}),(0,t.jsxs)("tr",{className:"group",children:[(0,t.jsx)("td",{className:"py-2 text-violet-400 font-medium",children:"中位數單價"}),(0,t.jsx)("td",{className:"py-2 text-right font-mono text-violet-400 font-bold",children:(0,a.formatNumber)(r.medianPrice)})]}),(0,t.jsxs)("tr",{className:"group",children:[(0,t.jsx)("td",{className:"py-2 text-zinc-400",children:"3/4分位數"}),(0,t.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors",children:(0,a.formatNumber)(r.q3Price)})]}),(0,t.jsxs)("tr",{className:"group",children:[(0,t.jsx)("td",{className:"py-2 text-zinc-400",children:"最高單價"}),(0,t.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors",children:(0,a.formatNumber)(r.maxPrice)})]})]})})}),(0,t.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,t.jsxs)("div",{className:"p-3 bg-zinc-950/50 rounded border border-white/5",children:[(0,t.jsx)("div",{className:"text-cyan-500 font-medium mb-1 text-xs uppercase tracking-wider",children:"最高價建案"}),(0,t.jsx)("div",{className:"text-white font-bold text-lg mb-1",children:r.maxPriceProject||"N/A"}),(0,t.jsxs)("div",{className:"flex gap-4 text-zinc-400 text-xs",children:[(0,t.jsxs)("span",{children:["戶型: ",r.maxPriceUnit||"-"]}),(0,t.jsxs)("span",{children:["樓層: ",r.maxPriceFloor||"-"]})]})]}),(0,t.jsxs)("div",{className:"p-3 bg-zinc-950/50 rounded border border-white/5",children:[(0,t.jsx)("div",{className:"text-green-500 font-medium mb-1 text-xs uppercase tracking-wider",children:"最低價建案"}),(0,t.jsx)("div",{className:"text-white font-bold text-lg mb-1",children:r.minPriceProject||"N/A"}),(0,t.jsxs)("div",{className:"flex gap-4 text-zinc-400 text-xs",children:[(0,t.jsxs)("span",{children:["戶型: ",r.minPriceUnit||"-"]}),(0,t.jsxs)("span",{children:["樓層: ",r.minPriceFloor||"-"]})]})]})]})]})]})}function d({data:e}){if(!e||0===e.length)return(0,t.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無符合條件的建案可進行類型比較"});let r=Math.max(...e.map(e=>e.shopMultiple),1),n=Math.max(...e.map(e=>e.officeMultiple),1);return(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,t.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 font-semibold uppercase text-xs",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-3",children:"建案名稱"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right",children:"住宅均價"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right",children:"店舖均價"}),(0,t.jsx)("th",{className:"px-4 py-3 w-[200px]",children:"店舖倍數"}),(0,t.jsx)("th",{className:"px-4 py-3 text-right",children:"事務所均價"}),(0,t.jsx)("th",{className:"px-4 py-3 w-[200px]",children:"事務所倍數"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-white/5",children:e.map((e,i)=>(0,t.jsxs)("tr",{className:"hover:bg-zinc-800/30 transition-colors",children:[(0,t.jsxs)("td",{className:"px-4 py-3",children:[(0,t.jsx)("div",{className:"font-medium text-white",children:e.projectName}),(0,t.jsxs)("div",{className:"text-xs text-zinc-500 flex gap-1 mt-0.5",children:[e.county&&(0,t.jsx)("span",{className:"bg-zinc-800 px-1 rounded",children:e.county}),e.district&&(0,t.jsx)("span",{className:"bg-zinc-800 px-1 rounded",children:e.district})]})]}),(0,t.jsx)("td",{className:"px-4 py-3 text-right font-mono text-zinc-300",children:e.residentialAvg>0?(0,a.formatNumber)(e.residentialAvg):"-"}),(0,t.jsx)("td",{className:"px-4 py-3 text-right font-mono text-zinc-300",children:e.shopAvg>0?(0,a.formatNumber)(e.shopAvg):"-"}),(0,t.jsx)("td",{className:"px-4 py-3",children:e.shopMultiple>0?(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("div",{className:"flex justify-between text-xs mb-0.5",children:(0,t.jsxs)("span",{className:"font-bold text-violet-400",children:[e.shopMultiple.toFixed(2),"x"]})}),(0,t.jsx)("div",{className:"h-1.5 bg-zinc-800 rounded-full overflow-hidden w-full",children:(0,t.jsx)("div",{className:"h-full bg-violet-600 rounded-full",style:{width:`${Math.min(e.shopMultiple/r*100,100)}%`}})})]}):(0,t.jsx)("span",{className:"text-zinc-600",children:"-"})}),(0,t.jsx)("td",{className:"px-4 py-3 text-right font-mono text-zinc-300",children:e.officeAvg>0?(0,a.formatNumber)(e.officeAvg):"-"}),(0,t.jsx)("td",{className:"px-4 py-3",children:e.officeMultiple>0?(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("div",{className:"flex justify-between text-xs mb-0.5",children:(0,t.jsxs)("span",{className:"font-bold text-cyan-400",children:[e.officeMultiple.toFixed(2),"x"]})}),(0,t.jsx)("div",{className:"h-1.5 bg-zinc-800 rounded-full overflow-hidden w-full",children:(0,t.jsx)("div",{className:"h-full bg-cyan-600 rounded-full",style:{width:`${Math.min(e.officeMultiple/n*100,100)}%`}})})]}):(0,t.jsx)("span",{className:"text-zinc-600",children:"-"})})]},i))})]})})}var x=e.i(65949);function u({data:e,visibleSections:i=["stats","comparison","chart"]}){let[s,l]=(0,r.useState)("weighted"),[u,m]=(0,r.useState)(30),[h,p]=(0,r.useState)(150),[f,g]=(0,r.useState)(5),[b,y]=(0,r.useState)("count"),v=e?.transactionDetails||[],j=e?.unitPriceAnalysis,w=j?.residentialStats,N=j?.officeStats,z=j?.storeStats,P=j?.typeComparison;return e&&(v.length||j)?(0,t.jsxs)("div",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[i.includes("stats")&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,t.jsx)("h3",{className:"text-xl font-bold text-white pl-2 border-l-4 border-violet-500",children:"各用途單價統計"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-zinc-400 text-sm",children:"平均類型:"}),(0,t.jsxs)("div",{className:"flex bg-zinc-950/50 rounded-md p-1 border border-white/5",children:[(0,t.jsx)("button",{onClick:()=>l("arithmetic"),className:(0,a.cn)("px-3 py-1 text-xs rounded transition-colors","arithmetic"===s?"bg-violet-500 text-white":"text-zinc-400 hover:text-white"),children:"算術平均"}),(0,t.jsx)("button",{onClick:()=>l("weighted"),className:(0,a.cn)("px-3 py-1 text-xs rounded transition-colors","weighted"===s?"bg-violet-500 text-white":"text-zinc-400 hover:text-white"),children:"加權平均"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[(0,t.jsx)(c,{title:"住宅建案統計",stats:w,noDataMessage:"無住宅交易數據",className:"border-violet-500/20",averageType:s}),(0,t.jsx)(c,{title:"一般事務所/辦公室統計",stats:N,noDataMessage:"無事務所/辦公室交易數據",className:"border-cyan-500/20",averageType:s}),(0,t.jsx)(c,{title:"店舖統計",stats:z,noDataMessage:"無店舖交易數據",className:"border-amber-500/20 xl:col-span-2",averageType:s})]})]}),i.includes("comparison")&&P&&P.length>0&&(0,t.jsx)(n.ReportWrapper,{title:"建案產品類型單價比較",description:"同一建案內不同用途（住宅/店面/事務所）的單價與倍數比較",headerAction:(0,t.jsx)(x.ExportButton,{data:P,filename:"type_comparison_data",label:"匯出比較表",columns:{projectName:"建案",residentialAvg:"住宅均價",officeAvg:"辦公均價",storeAvg:"店舖均價",officeRatio:"辦公倍數",storeRatio:"店舖倍數"}}),children:(0,t.jsx)(d,{data:P})}),i.includes("chart")&&(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsx)(n.ReportWrapper,{title:"單價分佈泡泡圖",description:"分析各單價區間的成交熱度與分佈密集區",headerAction:(0,t.jsx)(x.ExportButton,{data:v,filename:"bubble_chart_source_data",label:"匯出交易數據"}),children:(0,t.jsx)(o,{data:v,minPrice:u,maxPrice:h,interval:f,sizeMetric:b,onMinPriceChange:m,onMaxPriceChange:p,onIntervalChange:g,onSizeMetricChange:y})})})]}):null}e.s(["UnitPriceAnalysisReport",()=>u],12885);var m=e.i(91568);let h=(0,m.default)("store",[["path",{d:"M15 21v-5a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v5",key:"slp6dd"}],["path",{d:"M17.774 10.31a1.12 1.12 0 0 0-1.549 0 2.5 2.5 0 0 1-3.451 0 1.12 1.12 0 0 0-1.548 0 2.5 2.5 0 0 1-3.452 0 1.12 1.12 0 0 0-1.549 0 2.5 2.5 0 0 1-3.77-3.248l2.889-4.184A2 2 0 0 1 7 2h10a2 2 0 0 1 1.653.873l2.895 4.192a2.5 2.5 0 0 1-3.774 3.244",key:"o0xfot"}],["path",{d:"M4 10.95V19a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8.05",key:"wn3emo"}]]),p=(0,m.default)("briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]),f=(0,m.default)("sprout",[["path",{d:"M14 9.536V7a4 4 0 0 1 4-4h1.5a.5.5 0 0 1 .5.5V5a4 4 0 0 1-4 4 4 4 0 0 0-4 4c0 2 1 3 1 5a5 5 0 0 1-1 3",key:"139s4v"}],["path",{d:"M4 9a5 5 0 0 1 8 4 5 5 0 0 1-8-4",key:"1dlkgp"}],["path",{d:"M5 21h14",key:"11awu3"}]]);var g=e.i(52973);let b=(e,t=0)=>e?.toLocaleString(void 0,{maximumFractionDigits:t}),y=({children:e,triggerRect:r,isTopRow:n})=>{if(!r)return null;let a={position:"fixed",left:r.left+r.width/2,transform:"translateX(-50%)",zIndex:9999};return n?a.top=r.bottom+8:a.bottom=window.innerHeight-r.top+8,(0,i.createPortal)((0,t.jsx)("div",{style:a,className:"pointer-events-none",children:e}),document.body)};function v({data:e,floorPremium:n=.3}){let{horizontalGrid:i,sortedFloors:s,sortedUnits:l,unitColorMap:o,summary:c,horizontalComparison:d}=e,[x,u]=(0,r.useState)(null),m=()=>{u(null)};return i&&s&&l?(0,t.jsxs)("div",{className:"space-y-8 overflow-x-auto relative",children:[x&&(0,t.jsx)(y,{triggerRect:x.rect,isTopRow:x.isTopRow,children:(0,t.jsx)("div",{className:"w-48 bg-zinc-900 border border-zinc-700 rounded-lg p-3 shadow-xl animate-in fade-in zoom-in-95 duration-200",children:(0,t.jsxs)("div",{className:"space-y-1",children:[0===x.data.premium&&(0,t.jsx)("div",{className:"text-cyan-400 font-bold mb-1",children:"★ 基準戶"}),null!==x.data.premium&&(0,t.jsxs)("div",{className:"text-zinc-300",children:["調價: ",(0,t.jsxs)("span",{className:(0,a.cn)(x.data.premium>0?"text-red-400":x.data.premium<0?"text-violet-400":"text-zinc-400"),children:[x.data.premium>0?"+":"",x.data.premium.toFixed(2),"%"]})]}),(0,t.jsx)("div",{className:"h-px bg-zinc-700 my-2"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-x-2 gap-y-1 text-xs text-zinc-400",children:[(0,t.jsx)("span",{children:"成交總價:"})," ",(0,t.jsxs)("span",{className:"text-white text-right",children:[b(x.data.tooltipInfo.totalPrice),"萬"]}),(0,t.jsx)("span",{children:"房屋總價:"})," ",(0,t.jsxs)("span",{className:"text-white text-right",children:[b(x.data.tooltipInfo.housePrice),"萬"]}),(0,t.jsx)("span",{children:"車位總價:"})," ",(0,t.jsxs)("span",{className:"text-white text-right",children:[b(x.data.tooltipInfo.parkingPrice),"萬"]}),(0,t.jsx)("span",{children:"房屋面積:"})," ",(0,t.jsxs)("span",{className:"text-white text-right",children:[b(x.data.tooltipInfo.houseArea,2),"坪"]})]})]})})}),(0,t.jsx)("div",{className:"min-w-max pb-32",children:(0,t.jsxs)("table",{className:"divide-y divide-zinc-800 border-collapse w-full text-sm",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"sticky left-0 bg-dark-card z-20 p-2 text-zinc-400 border-r border-zinc-800",children:"樓層 \\ 戶別"}),l.map(e=>(0,t.jsx)("th",{className:"p-2 text-zinc-300 font-medium border-l border-zinc-800/50 bg-zinc-900/50",children:e},e))]})}),(0,t.jsx)("tbody",{className:"divide-y divide-zinc-800/50",children:s.map((e,r)=>(0,t.jsxs)("tr",{className:"hover:bg-zinc-800/30 transition-colors",children:[(0,t.jsx)("td",{className:"sticky left-0 bg-dark-card z-10 p-2 font-bold text-zinc-300 border-r border-zinc-800 text-center",children:e}),l.map(n=>{let s=i[e]?.[n];return s&&0!==s.length?(0,t.jsx)("td",{className:"p-1 border-l border-zinc-800/50 align-top",children:(0,t.jsx)("div",{className:"flex flex-col gap-1",children:s.map((e,n)=>{var i;let s=(i=e.premium,e.isStorefront?"rgba(217, 119, 6, 0.4)":e.isOffice?"rgba(37, 99, 235, 0.4)":null===i?"#1f2937":i<0?"rgba(139, 92, 246, 0.4)":0===i?"#06b6d4":i>5?"rgba(244, 63, 94, 0.5)":i>2?"rgba(234, 179, 8, 0.4)":"rgba(34, 197, 94, 0.3)"),l=e.isStorefront?{icon:(0,t.jsx)(h,{className:"w-3 h-3"}),label:"店舖"}:e.isOffice?{icon:(0,t.jsx)(p,{className:"w-3 h-3"}),label:"辦公"}:e.remark?.includes("露台")?{icon:(0,t.jsx)(f,{className:"w-3 h-3"}),label:"露台"}:e.remark?.includes("親友")||e.remark?.includes("員工")?{icon:(0,t.jsx)(g.Users,{className:"w-3 h-3"}),label:"親友"}:null,o=0===e.premium,c=r<3;return(0,t.jsxs)("div",{className:(0,a.cn)("p-1.5 rounded text-xs transition-transform hover:scale-105 cursor-default relative group",o&&"ring-1 ring-cyan-500"),style:{backgroundColor:s},onMouseEnter:t=>{u({rect:t.currentTarget.getBoundingClientRect(),data:e,isTopRow:c})},onMouseLeave:m,children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,t.jsxs)("span",{className:"font-semibold text-white flex items-center gap-1",children:[l&&(0,t.jsx)("span",{className:"text-zinc-200",title:l.label,children:l.icon}),e.unitPrice.toFixed(1),"萬"]}),e.hasParking&&(0,t.jsx)("span",{className:"flex items-center justify-center w-3.5 h-3.5 bg-blue-500 text-white text-[9px] font-bold rounded-sm ml-0.5",title:"含車位",children:"P"})]}),(0,t.jsx)("div",{className:"text-[10px] text-zinc-300 mt-0.5 font-mono tracking-tight opacity-90",children:e.transactionDate||"-"})]},n)})})},`${e}-${n}`):(0,t.jsx)("td",{className:"p-2 border-l border-zinc-800/50 bg-zinc-900/20 text-center text-zinc-600",children:"-"},`${e}-${n}`)})]},e))})]})}),c&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-zinc-200",children:"調價幅度統計摘要 (排除店舖/辦公室)"}),(0,t.jsx)("div",{className:"overflow-x-auto rounded-lg border border-zinc-800",children:(0,t.jsxs)("table",{className:"w-full text-sm text-left text-zinc-300",children:[(0,t.jsx)("thead",{className:"text-xs text-zinc-400 uppercase bg-zinc-900/50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-3",children:"基準房屋總價"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"調價幅度總額"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"總溢價率"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"已售房屋坪數"}),(0,t.jsx)("th",{className:"px-6 py-3",children:"平均單價調價"})]})}),(0,t.jsx)("tbody",{children:(0,t.jsxs)("tr",{className:"bg-zinc-900/20 border-b border-zinc-800",children:[(0,t.jsxs)("td",{className:"px-6 py-4",children:[b(c.totalBaselineHousePrice)," 萬"]}),(0,t.jsxs)("td",{className:(0,a.cn)("px-6 py-4 font-bold",c.totalPricePremiumValue>0?"text-red-400":"text-violet-400"),children:[c.totalPricePremiumValue>0?"+":"",b(c.totalPricePremiumValue)," 萬"]}),(0,t.jsxs)("td",{className:"px-6 py-4",children:[(c.totalPricePremiumValue/c.totalBaselineHousePrice*100).toFixed(2)," %"]}),(0,t.jsxs)("td",{className:"px-6 py-4",children:[b(c.totalSoldArea)," 坪"]}),(0,t.jsxs)("td",{className:(0,a.cn)("px-6 py-4",c.totalPricePremiumValue>0?"text-red-400":"text-violet-400"),children:[(c.totalPricePremiumValue/c.totalSoldArea).toFixed(2)," 萬/坪"]})]})})]})})]}),d&&d.length>0&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-zinc-200",children:"戶型水平價差與溢價貢獻"}),(0,t.jsx)("div",{className:"overflow-x-auto rounded-lg border border-zinc-800",children:(0,t.jsxs)("table",{className:"w-full text-sm text-left text-zinc-300",children:[(0,t.jsx)("thead",{className:"text-xs text-zinc-400 uppercase bg-zinc-900/50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-3",children:"戶型"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"基準戶 (樓/價)"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"水平價差(萬/坪)"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"去化戶數"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"溢價貢獻"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"貢獻佔比"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"基準房屋總價"}),(0,t.jsx)("th",{className:"px-4 py-3",children:"平均單價調價"})]})}),(0,t.jsx)("tbody",{children:d.map((e,r)=>(0,t.jsxs)("tr",{className:"bg-zinc-900/20 border-b border-zinc-800 hover:bg-zinc-800/20",children:[(0,t.jsx)("td",{className:"px-4 py-3 font-medium text-white",children:e.unitType}),(0,t.jsx)("td",{className:"px-4 py-3",children:e.anchorInfo}),(0,t.jsx)("td",{className:(0,a.cn)("px-4 py-3",(e.horizontalPriceDiff||0)>0?"text-red-400":"text-zinc-400"),children:"number"==typeof e.horizontalPriceDiff?`${e.horizontalPriceDiff>0?"+":""}${e.horizontalPriceDiff.toFixed(2)} 萬/坪`:"-"}),(0,t.jsxs)("td",{className:"px-4 py-3",children:[e.unitsSold," 戶"]}),(0,t.jsxs)("td",{className:(0,a.cn)("px-4 py-3 font-bold",e.timePremiumContribution>0?"text-red-400":"text-violet-400"),children:[e.timePremiumContribution>0?"+":"",b(e.timePremiumContribution)," 萬"]}),(0,t.jsxs)("td",{className:"px-4 py-3",children:["number"==typeof e.contributionPercentage?e.contributionPercentage.toFixed(2):"0.00","%"]}),(0,t.jsxs)("td",{className:"px-4 py-3",children:[b(e.baselineHousePrice)," 萬"]}),(0,t.jsxs)("td",{className:"px-4 py-3",children:["number"==typeof e.avgPriceAdjustment?e.avgPriceAdjustment.toFixed(2):"-"," 萬/坪"]})]},r))})]})})]})]}):(0,t.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無有效熱力圖資料"})}e.s(["PricingHeatmap",()=>v],78956)},65787,e=>{"use strict";var t=e.i(25191),r=e.i(68524),n=e.i(78320),i=e.i(78956),a=e.i(22112),s=e.i(42217),l=e.i(14897);let o=(0,e.i(91568).default)("wand-sparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]);class c{knownPatterns=new Map;patternFrequency=new Map;constructor(){this.initializeBasePatterns()}initializeBasePatterns(){[{id:"unit_slash_floorF_format",name:"戶號斜線樓層F格式",regex:/^([A-Z]\d+)\/(\d+)F[號号]?$/i,extract:(e,t)=>{let r=e[1],n=e[2];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?r:r+n},confidence:100,priority:.01},{id:"building_unit_floor_combined",name:"棟別戶號樓層合併格式",regex:/^([A-Z])棟(\d+)-(\d+)[號号]?$/i,extract:(e,t)=>{let r=e[1],n=e[2],i=e[3];return t?.floor&&parseInt(i,10)===parseInt(t.floor,10)?r+n:r+n+i},confidence:100,priority:.02},{id:"building_unit_floorF_format_v2",name:"棟別戶號樓層F格式v2",regex:/^([A-Z])棟(\d+)-(\d+)F[號号]?$/i,extract:(e,t)=>{let r=e[1],n=e[2],i=e[3];return t?.floor&&parseInt(i,10)===parseInt(t.floor,10)?r+n:r+n+i},confidence:100,priority:.03},{id:"unit_building_zero_format",name:"戶號棟別0號格式",regex:/^([A-Z]\d+)棟0[號号]?$/i,extract:e=>e[1],confidence:100,priority:.04},{id:"single_letter_unit",name:"單字母戶號格式",regex:/^([A-Z])[號号]$/i,extract:e=>e[1],confidence:95,priority:.045},{id:"building_floor_unit_letter_format",name:"棟別樓層數字戶型字母格式",regex:/^([A-Z])棟(\d+)([A-Z])[號号]?$/i,extract:(e,t)=>{let r=e[1],n=parseInt(e[2],10),i=e[3];return t?.floor&&n===parseInt(t.floor,10)?i:`${r}${n}${i}`},confidence:99,priority:.05},{id:"building_floor_unit_format",name:"棟別樓層戶號格式",regex:/^([A-Z])棟(\d{1,2})F-(\d+)[號号]?$/,extract:(e,t)=>{let r=e[1],n=e[2],i=e[3];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?r+i:r+n+i},confidence:99,priority:.1},{id:"letter_number_floor_format",name:"字母數字-樓層F格式",regex:/^([A-Z])0*(\d+)-(\d{1,2})F[號号]?$/,extract:(e,t)=>{let r=e[1],n=e[2],i=e[3];return t?.floor&&parseInt(i,10)===parseInt(t.floor,10)?r+n:r+n+i},confidence:99,priority:.15},{id:"identifier_building_floor_redundant",name:"識別碼棟與F樓層格式(贅余樓層)",regex:/^([A-Z]\d+)棟F(\d+)[號号]?$/i,extract:(e,t)=>{let r=e[1],n=e[2],i=r.match(/^[A-Z]+/)?.[0]||"",a=parseInt(r.match(/\d+/)?.[0]||"0",10),s=`${i}${a}`;return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?s:s+"F"+n},confidence:98,priority:.18},{id:"identifier_building_floorF_format",name:"識別碼棟與樓層F格式(贅余樓層)",regex:/^([A-Z]\d+)棟(\d{1,2})F[號号]?$/i,extract:(e,t)=>{let r=e[1],n=e[2];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?r:r+n},confidence:98,priority:.19},{id:"unit_building_floor_format",name:"戶棟樓層格式",regex:/^([A-Z]\d+)戶棟(\d+)F[號号]?$/,extract:(e,t)=>{let r=e[1],n=e[2];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?r:r+n},confidence:99,priority:.2},{id:"building_sub_unit_floor_format",name:"棟別子戶號樓層格式",regex:/^([A-Z])棟(\d+)-(\d+)F[號号]?$/,extract:(e,t)=>{let r=e[1],n=e[2],i=e[3];return t?.floor&&parseInt(i,10)===parseInt(t.floor,10)?r+n:r+n+i},confidence:99,priority:.3},{id:"building_unit_floor_format",name:"棟別戶別樓層格式",regex:/^([A-Z])棟([A-Z])-(\d{1,2})F[號号]?$/,extract:(e,t)=>{let r=e[2],n=e[3];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?r:r+n},confidence:99,priority:.4},{id:"building_self_unit_floor_format",name:"棟別自身戶號樓層格式",regex:/^([A-Z])棟\1-(\d+)[號号]?$/,extract:(e,t)=>{let r=e[1],n=e[2];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?r:r+n},confidence:98,priority:.45},{id:"building_unit_letter_floor_number",name:"棟別戶號字母樓層數字格式",regex:/^([A-Z])棟([A-Z])(\d{1,2})[號号]?$/,extract:(e,t)=>{let r=e[2],n=e[3];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?r:r+n},confidence:98,priority:.46},{id:"redundant_building_format",name:"重複棟別格式",regex:/^([A-Z])棟\1-(\d{1,2})F[號号]?$/,extract:(e,t)=>{let r=e[1],n=e[2];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?r:r+n},confidence:98,priority:.5},{id:"building_floor_letter_unit",name:"棟別樓層字母戶號格式",regex:/^[A-Z]棟(\d{1,2})F-([A-Z])[號号]?$/,extract:(e,t)=>{let r=e[1],n=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?n:n+r},confidence:98,priority:.6},{id:"letter_leading_zero_unit",name:"字母與0開頭數字戶號",regex:/^([A-Z])0+(\d+)[號号]?$/,extract:e=>e[1]+e[2],confidence:97,priority:.7},{id:"floor_prefix_format",name:"樓層前綴格式",regex:/^(\d{1,2})([A-Z])[號号]?$/,extract:(e,t)=>{let r=e[1],n=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?n:r+n},confidence:96,priority:.8},{id:"floorF_building_unit_format",name:"樓層F棟戶號格式",regex:/^(\d{1,2})F棟([A-Z])[號号]?$/,extract:(e,t)=>{let r=e[1],n=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?n:r+n},confidence:98,priority:.85},{id:"numericBuilding_floor_unit_format",name:"數字棟別樓層戶號格式",regex:/^(\d+)棟(\d{1,2})([A-Z])[號号]?$/,extract:(e,t)=>{let r=e[2],n=e[3];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?n:r+n},confidence:98,priority:.86},{id:"floor_first_detailed",name:"樓層優先詳細格式",regex:/(\d{1,2})F-([A-Z])(\d{2})/,extract:e=>e[2]+e[3],confidence:95,priority:1},{id:"floor_prefix_complex_unit",name:"樓層前綴複合戶號",regex:/^(\d{1,2})F-([A-Z]\d+)[號号]?$/,extract:(e,t)=>{let r=e[1],n=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?n:r+n},confidence:94,priority:1.2},{id:"floor_first_simple_letter",name:"樓層優先簡單字母格式",regex:/^(\d{1,2})F-([A-Z])[號号]?$/,extract:(e,t)=>{let r=e[1],n=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?n:r+n},confidence:90,priority:1.5},{id:"building_with_unit",name:"棟別完整戶號",regex:/([A-Z])棟([A-Z])(\d{1,2})(?:-(\d{1,2})F?[號号])?/,extract:e=>e[2]+e[3],confidence:90,priority:2,conditions:[{type:"building_match",validator:e=>{let t=e.rawUnit.match(/([A-Z])棟([A-Z])/);return!!t&&t[1]===t[2]}}]},{id:"building_simple_letter_unit",name:"棟別字母戶號格式",regex:/^[A-Z]棟([A-Z])[號号]?$/,extract:e=>e[1],confidence:92,priority:2.5},{id:"unit_floor_suffix",name:"戶號樓層後綴",regex:/([A-Z]\d{1,2})-(\d{1,2})F?[號号]?/,extract:e=>e[1],confidence:85,priority:3},{id:"building_floor_format",name:"棟別樓層格式",regex:/^([A-Z]\d{1,2})棟(\d{1,2})(?:F|樓)[號号]?$/,extract:(e,t)=>{let r=e[1],n=e[2];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?r:r+n},confidence:88,priority:3.5},{id:"building_complex_number",name:"複合棟別編號",regex:/^([A-Z]\d+)棟(\d+)[號号]$/,extract:(e,t)=>{let r=e[1],n=e[2];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?r:r+n},confidence:86,priority:3.8},{id:"building_floor_F_format",name:"棟別樓層F格式",regex:/^([A-Z])棟(\d{1,2})F[號号]?$/,extract:(e,t)=>{let r=e[1],n=e[2];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?r:r+n},confidence:87,priority:3.9},{id:"building_zero_placeholder_unit",name:"棟別0號佔位符格式",regex:/^([A-Z])棟0[號号]?$/,extract:e=>e[1],confidence:95,priority:3.95},{id:"building_simple_number",name:"棟別簡單編號",regex:/([A-Z])棟(\d{1,2})[號号]/,extract:(e,t)=>{let r=e[1],n=e[2];return t?.floor&&parseInt(n,10)===parseInt(t.floor,10)?r:r+n},confidence:85,priority:4},{id:"unit_floor_concatenated",name:"複合戶號樓層格式",regex:/^([A-Z])(\d+)F[號号]?$/,extract:(e,t)=>{let r=e[1],n=e[2],i=t?.floor;if(i){let e=parseInt(i,10);if(!isNaN(e)){if(e<10){let e="0"+i;if(n.endsWith(e))return r+n.substring(0,n.length-2)}if(n.endsWith(i))return r+n.substring(0,n.length-i.length)}}return r+n},confidence:80,priority:4.5},{id:"letter_floor",name:"字母樓層格式",regex:/^([A-Z])-(\d{1,2})F?[號号]?$/,extract:(e,t)=>{let r=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?e[1]:e[1]+r},confidence:70,priority:5}].forEach(e=>{this.knownPatterns.set(e.id,e)})}detectPattern(e,t){let r=this.normalizeText(e),n=null;for(let e of Array.from(this.knownPatterns.values()).sort((e,t)=>e.priority-t.priority)){let i=r.match(e.regex);if(i){if(e.conditions&&t&&!e.conditions.every(e=>e.validator(t)))continue;n={rule:e,match:i};break}}return n&&this.patternFrequency.set(n.rule.id,(this.patternFrequency.get(n.rule.id)||0)+1),n}normalizeText(e){return e?e.toUpperCase().replace(/[\uff01-\uff5e]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248)).replace(/\s+/g,""):""}}class d{projectProfiles=new Map;analyzeProject(e,t){let r={projectName:e,patterns:new Map,unitMappings:new Map,namingStyle:"unknown"},n=new c;for(let i of t){let t=i["戶別"],a=i["樓層"];if(!t)continue;let s={rawUnit:t,floor:a?String(a):void 0,projectName:e},l=n.detectPattern(t,s);if(l){let e=l.rule;r.patterns.has(e.id)||r.patterns.set(e.id,{patternId:e.id,count:0,examples:[],confidence:e.confidence});let n=r.patterns.get(e.id);n.count++,n.examples.length<10&&n.examples.push(t)}r.unitMappings.has(t)||r.unitMappings.set(t,{floors:new Set,rawVariations:new Set([t])});let o=r.unitMappings.get(t);a&&o.floors.add(String(a))}return this.determineNamingStyle(r),this.projectProfiles.set(e,r),r}determineNamingStyle(e){let t=e.patterns.size,r=Array.from(e.patterns.values()).reduce((e,t)=>e+t.count,0);if(0===t){e.namingStyle="unknown";return}let n=null,i=0;for(let t of e.patterns.values())t.count>i&&(i=t.count,n=t);n&&(e.dominantPattern=n.patternId,n.count/r>.8?e.namingStyle="consistent":e.namingStyle="mixed")}getProjectProfile(e){return this.projectProfiles.get(e)}isAmbiguousUnit(e,t){let r=this.projectProfiles.get(e);if(!r)return!1;let n=r.unitMappings.get(t);return!!n&&n.floors.size>1}}class x{detector;customRules=new Map;constructor(e){this.detector=e,this.initializeCustomRules()}initializeCustomRules(){}applyRules(e){for(let[t,r]of this.customRules){let t=r(e);if(t)return t}let t=this.detector.detectPattern(e.rawUnit,e);if(t){let{rule:r,match:n}=t;return{identifier:r.extract(n,e),confidence:r.confidence,method:`pattern:${r.id}`}}return{identifier:this.simpleFallback(e.rawUnit),confidence:50,method:"fallback"}}simpleFallback(e){return e?e.toUpperCase().replace(/[\uff01-\uff5e]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248)).replace(/\s+/g,"").replace(/[棟樓F室號\-]/g,""):""}}class u{detector;analyzer;ruleEngine;resolveCache=new Map;constructor(e){console.log("[AdaptiveUnitResolver] 初始化，處理",e.length,"筆資料"),this.detector=new c,this.analyzer=new d,this.ruleEngine=new x(this.detector),this.buildKnowledgeBase(e)}buildKnowledgeBase(e){let t=new Map;for(let r of e){let e=r["建案名稱"];e&&(t.has(e)||t.set(e,[]),t.get(e).push(r))}for(let[e,r]of(console.log("[AdaptiveUnitResolver] 分析",t.size,"個建案"),t))this.analyzer.analyzeProject(e,r)}resolve(e){return this.resolveWithContext(e).identifier}resolveWithContext(e){let t=e["戶別"];t&&"string"==typeof t&&(t=t.trim());let r=e["樓層"],n=e["建案名稱"];if(!t)return{identifier:"",confidence:0,method:"no_input"};let i=`${n}|${t}|${r||""}`;if(this.resolveCache.has(i))return this.resolveCache.get(i);let a={rawUnit:t,floor:r?String(r):void 0,projectName:n},s=this.ruleEngine.applyRules(a);if(s)return this.resolveCache.set(i,s),s;let l={identifier:t,confidence:0,method:"fallback_null"};return this.resolveCache.set(i,l),l}}var m=e.i(78885),h=e.i(65949);function p({transactions:e,project:n}){let[i,a]=(0,r.useState)(""),[o,c]=(0,r.useState)(""),[d,x]=(0,r.useState)(null);return(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row flex-wrap items-start sm:items-center gap-3 sm:gap-4 bg-zinc-900/30 p-4 rounded-lg border border-white/5",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 w-full sm:w-auto",children:[(0,t.jsx)("span",{className:"text-sm text-zinc-400 font-semibold whitespace-nowrap",children:"區間均價試算:"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(s.Input,{type:"number",placeholder:"起樓",className:"w-20 h-8 bg-zinc-950/50",value:i,onChange:e=>a(e.target.value)}),(0,t.jsx)("span",{className:"text-zinc-500",children:"~"}),(0,t.jsx)(s.Input,{type:"number",placeholder:"迄樓",className:"w-20 h-8 bg-zinc-950/50",value:o,onChange:e=>c(e.target.value)})]}),(0,t.jsx)(l.Button,{size:"sm",variant:"secondary",onClick:()=>{if(!n||!e)return;let t=parseInt(i),r=parseInt(o);if(isNaN(t)||isNaN(r)||t>r)return void x(null);let a=e.filter(e=>{if(e["建案名稱"]!==n)return!1;let i=parseInt(String(e["樓層"]));return!isNaN(i)&&i>=t&&i<=r});if(0===a.length)return void x({avg:0,count:0});let s=a.reduce((e,t)=>e+(t["房屋總價(萬)"]||0),0),l=a.reduce((e,t)=>e+(t["房屋面積(坪)"]||0),0);x({avg:l>0?s/l:0,count:a.length})},className:"h-8 ml-2",children:"計算"})]}),d&&(0,t.jsxs)("div",{className:"flex items-center gap-4 ml-4 animate-in fade-in",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs text-zinc-500",children:"平均單價 (加權)"}),(0,t.jsxs)("span",{className:"text-lg font-bold text-violet-400",children:[d.avg.toFixed(2)," 萬/坪"]})]}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{className:"text-xs text-zinc-500",children:"參考筆數"}),(0,t.jsxs)("span",{className:"text-sm text-zinc-300",children:[d.count," 筆"]})]})]})]})}function f({data:e}){let[c,d]=(0,r.useState)(""),[x,f]=(0,r.useState)(.3),[g,b]=(0,r.useState)(14);if((0,r.useEffect)(()=>{e?.priceGridAnalysis?.projectNames?.length&&!c&&d(e.priceGridAnalysis.projectNames[0])},[e,c]),!e?.priceGridAnalysis)return null;let{projectNames:y,byProject:v}=e.priceGridAnalysis,j=r.default.useMemo(()=>{if(!c||!e.transactionDetails)return null;let t=e.transactionDetails.filter(e=>e["建案名稱"]===c),{excludeCommercial:r}=m.useFilterStore.getState();return r&&(t=t.filter(e=>{let t=e["主要用途"]||"",r=e["建物型態"]||"",n=e["備註"]||"";return!(t.includes("商業")||r.includes("店")||n.includes("店")||t.includes("辦公")||r.includes("辦公")||r.includes("事務所"))})),t},[c,e.transactionDetails]),w=r.default.useMemo(()=>{if(!c)return null;if(j&&j.length>0)try{return function(e,t=.3,r=14){let n={},i=new Set,a=new Set,s=new u(e);if(e.forEach(e=>{let t=e["樓層"]||e.floor||e.layer;if(null==t)return;"number"==typeof t&&(t=String(t)),"number"==typeof t&&(t=String(t));let r=s.resolve(e);i.add(t),a.add(r),n[t]||(n[t]={}),n[t][r]||(n[t][r]=[]);let l=parseFloat(e["房屋單價(萬)"]||e.unitPrice||0),o=parseFloat(e["交易總價(萬)"]||e.totalPrice||0),c=parseFloat(e["房屋總價(萬)"]||e.housePrice||0),d=parseFloat(e["車位總價(萬)"]||e.parkingPrice||0),x=parseFloat(e["房屋面積(坪)"]||e.houseArea||0),u=e["房數"]||e.rooms,m=e["車位類別"]||e.parkingType||"";"string"==typeof m&&m.includes("車位");let h=e["主要用途"]||e.mainPurpose||"",p=e["建物型態"]||e.buildingType||"",f=h.includes("商業")||p.includes("店")||h.includes("店"),g=h.includes("辦公")||p.includes("辦公")||p.includes("事務所"),b=e["交易日"]||e["交易年月日"]||e.transactionDate||"",y=b;if(b&&/^\d{6,7}$/.test(String(b))){let e=String(b),t=6===e.length?2:3;y=`${e.substring(0,t)}/${e.substring(t,t+2)}/${e.substring(t+2)}`}n[t][r].push({...e,unitPrice:l,floor:t,unit:r,transactionDate:y,isStorefront:f,isOffice:g,hasParking:d>0,tooltipInfo:{totalPrice:o,housePrice:c,parkingPrice:d,houseArea:x,rooms:u}})}),0===i.size)return{horizontalGrid:{},sortedFloors:[],sortedUnits:[],unitColorMap:{},summary:{totalBaselineHousePrice:0,totalPricePremiumValue:0,totalSoldArea:0,transactionCount:0},horizontalComparison:[]};let l=Array.from(i).sort((e,t)=>{let r=e=>e?e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e)||0:0;return r(t)-r(e)}),o=Array.from(a).sort(),c={},d=e=>{if(!e)return null;let t=e.replace(/\//g,"");if(t.length<6)return null;let r=6===t.length?2:3,n=parseInt(t.substring(0,r)),i=parseInt(t.substring(r,r+2));return new Date(1911+n,i-1,parseInt(t.substring(r+2)))},x={};e.forEach(e=>{let t=s.resolve(e),r=e["主要用途"]||e.mainPurpose||"",n=e["建物型態"]||e.buildingType||"",i=e["備註"]||e.note||"",a=r.includes("商業")||n.includes("店")||r.includes("辦公")||n.includes("辦公")||n.includes("事務所")||i.includes("特殊")||i.includes("親友")||i.includes("員工")||i.includes("關係人")||i.includes("毛胚"),l=parseFloat(e["房屋單價(萬)"]||e.unitPrice||0);!a&&l>0&&(x[t]||(x[t]=[]),x[t].push(e))}),Object.keys(x).forEach(e=>{let n=x[e];if(n.sort((e,t)=>(d(e["交易年月日"]||e.transactionDate)?.getTime()||0x9184e729fff)-(d(t["交易年月日"]||t.transactionDate)?.getTime()||0x9184e729fff)),0===n.length)return;let i=d(n[0]["交易年月日"]||n[0].transactionDate);if(!i){c[e]=n.reduce((e,t)=>parseFloat(t["房屋單價(萬)"])<parseFloat(e["房屋單價(萬)"])?t:e,n[0]);return}let a=new Date(i);a.setDate(a.getDate()+r);let s=n.filter(e=>{let t=d(e["交易年月日"]||e.transactionDate);return t&&t<=a}),l=s[0],o=1/0;s.forEach(e=>{let r,n=parseFloat(e["房屋單價(萬)"]||0)-((r=String(e["樓層"]))?r.startsWith("B")?-parseInt(r.substring(1)):parseInt(r):0)*t;n<o&&(o=n,l=e)}),c[e]=l});let m=0,h=0,p=0,f=0;Object.keys(n).forEach(e=>{Object.keys(n[e]).forEach(r=>{n[e][r].forEach((i,a)=>{let s=null,l=c[r];if(l){let e=e=>e?e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e):0,r=String(l["樓層"]),n=String(i.floor),a=e(r),o=e(n),c=parseFloat(l["房屋單價(萬)"]||l.unitPrice||0)+(o-a)*t;if(c>0&&(s=(i["房屋單價(萬)"]-c)/c*100,(i===l||.1>Math.abs(i["房屋單價(萬)"]-c))&&(s=0)),i.tooltipInfo.housePrice&&i.tooltipInfo.houseArea){let e=c*i.tooltipInfo.houseArea;m+=e,h+=i.tooltipInfo.housePrice-e,p+=i.tooltipInfo.houseArea,f++}}n[e][r][a].premium=s})})});let g={},b=["#f87171","#fb923c","#fbbf24","#a3e635","#34d399","#22d3ee","#818cf8","#c084fc","#f472b6"];o.forEach((e,t)=>{g[e]=b[t%b.length]});let y={};o.forEach(e=>{y[e]={totalPremium:0,totalSoldArea:0,count:0,anchorPrice:null,anchorFloor:null};let t=c[e];t&&(y[e].anchorPrice=parseFloat(t["房屋單價(萬)"]||0),y[e].anchorFloor=String(t["樓層"]))}),Object.keys(n).forEach(e=>{Object.keys(n[e]).forEach(r=>{n[e][r].forEach(e=>{let n=c[r];if(null!==e.premium&&e.tooltipInfo.housePrice&&e.tooltipInfo.houseArea&&n){let i=e=>e?e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e):0,a=i(String(n["樓層"])),s=i(e.floor),l=parseFloat(n["房屋單價(萬)"]||n.unitPrice||0)+(s-a)*t;if(l>0){let t=l*e.tooltipInfo.houseArea,n=e.tooltipInfo.housePrice-t;y[r]&&(y[r].totalPremium+=n,y[r].totalSoldArea+=e.tooltipInfo.houseArea,y[r].count++)}}})})});let v=Object.keys(y).map(e=>{let t=y[e];return 0===t.count?null:{unitType:e,anchorInfo:t.anchorPrice?`${t.anchorFloor}F / ${t.anchorPrice}萬`:"N/A",horizontalPriceDiff:t.totalSoldArea>0?t.totalPremium/t.totalSoldArea:0,unitsSold:t.count,timePremiumContribution:t.totalPremium,contributionPercentage:h>0?t.totalPremium/h*100:0,baselineHousePrice:m,avgPriceAdjustment:t.totalSoldArea>0?t.totalPremium/t.totalSoldArea:0}}).filter(Boolean);return{horizontalGrid:n,sortedFloors:l,sortedUnits:o,unitColorMap:g,summary:{totalBaselineHousePrice:m,totalPricePremiumValue:h,totalSoldArea:p,transactionCount:f},horizontalComparison:v}}(j,x,g)}catch(e){console.error("Heatmap generation error:",e)}return v[c]&&v[c].horizontalGrid?v[c]:null},[c,j,v,x,g]);return(0,t.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,t.jsxs)("div",{className:"flex flex-col lg:flex-row flex-wrap items-start lg:items-center gap-4 bg-zinc-900/30 p-4 rounded-lg border border-white/5",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 w-full lg:w-auto",children:[(0,t.jsx)("span",{className:"text-sm text-zinc-400 whitespace-nowrap",children:"選擇建案:"}),(0,t.jsx)(a.Select,{value:c,onChange:e=>d(e.target.value),className:"w-full sm:w-[280px] bg-zinc-950/50",children:y.map(e=>(0,t.jsx)("option",{value:e,children:e},e))})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3 w-full lg:w-auto",children:[(0,t.jsx)("span",{className:"text-sm text-zinc-400 whitespace-nowrap",children:"樓層價差:"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[(0,t.jsx)("input",{type:"range",min:0,max:10,step:.05,value:x,onChange:e=>f(Number(e.target.value)),className:"flex-1 sm:w-32 h-2 accent-violet-500 cursor-pointer",style:{minHeight:"24px"}}),(0,t.jsx)(s.Input,{type:"number",min:0,max:10,step:.01,value:x,onChange:e=>f(Math.max(0,Number(e.target.value))),className:"w-20 h-8 bg-zinc-950/50 text-right pr-2"}),(0,t.jsx)("span",{className:"text-sm font-mono text-violet-400 whitespace-nowrap",children:"萬/坪"}),(0,t.jsx)(l.Button,{variant:"ghost",size:"icon",onClick:()=>{if(!e.transactionDetails||!c)return;let t=function(e){if(!e||0===e.length)return .3;let t=new u(e),r={};e.forEach(e=>{let n=t.resolve(e),i=e["主要用途"]||e.mainPurpose||"",a=e["建物型態"]||e.buildingType||"",s=e["備註"]||e.note||"";!(i.includes("商業")||a.includes("店")||i.includes("辦公")||a.includes("辦公")||a.includes("事務所")||s.includes("特殊")||s.includes("親友")||s.includes("員工")||s.includes("關係人")||s.includes("毛胚"))&&parseFloat(e["房屋單價(萬)"])>0&&(r[n]||(r[n]=[]),r[n].push(e))});let n=[];if(Object.values(r).forEach(e=>{let t=e=>e?e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e):0;e.sort((e,r)=>t(String(e["樓層"]))-t(String(r["樓層"])));for(let r=0;r<e.length-1;r++){let i=e[r],a=e[r+1],s=t(String(i["樓層"])),l=t(String(a["樓層"]))-s,o=parseFloat(a["房屋單價(萬)"])-parseFloat(i["房屋單價(萬)"]);if(l>0&&l<=3){let e=o/l;e>-2&&e<10&&n.push(e)}}}),0===n.length)return .5;n.sort((e,t)=>e-t);let i=Math.floor(n.length/2);return Math.max(0,Math.round(100*(n.length%2!=0?n[i]:(n[i-1]+n[i])/2))/100)}(e.transactionDetails.filter(e=>e["建案名稱"]===c));f(t),console.log("Auto suggested premium:",t)},className:"h-8 w-8 text-yellow-400 hover:text-yellow-300 hover:bg-yellow-400/10 ml-1",title:"自動試算建議價差",children:(0,t.jsx)(o,{className:"h-4 w-4"})})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-zinc-400",children:"基準天數:"}),(0,t.jsx)(s.Input,{type:"number",min:"1",max:"365",value:g,onChange:e=>b(Number(e.target.value)||14),className:"w-16 h-8 bg-zinc-950/50 text-right pr-2"}),(0,t.jsx)("span",{className:"text-sm font-mono text-violet-400 whitespace-nowrap",children:"天"})]})]})]}),c&&e.transactionDetails&&(0,t.jsx)(p,{transactions:e.transactionDetails,project:c}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-4 p-4 bg-zinc-900/20 rounded-lg border border-white/5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs text-zinc-500",children:"溢價圖例:"}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"w-4 h-4 rounded bg-red-500/80"}),(0,t.jsx)("span",{className:"text-xs text-zinc-400",children:"> 5%"})]}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"w-4 h-4 rounded bg-orange-500/80"}),(0,t.jsx)("span",{className:"text-xs text-zinc-400",children:"2-5%"})]}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"w-4 h-4 rounded bg-yellow-500/80"}),(0,t.jsx)("span",{className:"text-xs text-zinc-400",children:"0-2%"})]}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"w-4 h-4 rounded bg-green-500/80"}),(0,t.jsx)("span",{className:"text-xs text-zinc-400",children:"< 0%"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 ml-auto",children:[(0,t.jsx)("span",{className:"text-xs text-zinc-500",children:"特殊交易:"}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"w-4 h-4 rounded bg-amber-600"}),(0,t.jsx)("span",{className:"text-xs text-zinc-400",children:"店舖"})]}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"w-4 h-4 rounded bg-blue-600"}),(0,t.jsx)("span",{className:"text-xs text-zinc-400",children:"辦公室"})]}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{className:"w-4 h-4 rounded bg-purple-600"}),(0,t.jsx)("span",{className:"text-xs text-zinc-400",children:"廠辦"})]})]})]}),(0,t.jsx)(n.ReportWrapper,{title:"建案銷控表與調價熱力圖",description:"可視化建案各戶別的銷售狀況與價格調整幅度",headerAction:(0,t.jsx)(h.ExportButton,{data:j||[],filename:`heatmap_tx_${c}`,label:"匯出交易明細"}),children:w?(0,t.jsx)(i.PricingHeatmap,{data:w,floorPremium:x}):(0,t.jsx)("div",{className:"text-zinc-500 text-center p-12",children:"請選擇建案以查看銷控表"})})]})}e.s(["HeatmapReport",()=>f],65787)},23372,e=>{"use strict";let t=(0,e.i(91568).default)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);e.s(["ChevronUp",()=>t],23372)},75358,44402,47550,43453,59610,16455,e=>{"use strict";var t=e.i(25191),r=e.i(42806),n=e.i(74614);let i=(0,r.cva)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function a({className:e,variant:r,...a}){return(0,t.jsx)("div",{className:(0,n.cn)(i({variant:r}),e),...a})}e.s(["Badge",()=>a],75358),e.s(["REAL_ESTATE_POLICIES",0,[{id:"p-2012-08-01",date:"2012-08-01",title:"實價登錄 1.0 上路",category:"policy",impact:"high",description:"交易後30日內申報，區段化揭露(30號區間)，預售屋採代銷結案後整批申報。",change_content:"交易資訊不透明 -> 區段化揭露",affected_scope:"房仲業者、買賣雙方、預售屋投機客",background:"低利環境延續：國內房貸利率處於低檔 (約1.8%-1.9%)。",impact_analysis:"[受益] 買方獲得參考依據。[適應] 房仲失去資訊壟斷優勢。[無感] 預售屋投機客因資訊未即時揭露，仍可操作紅單。",details:["申報義務人：地政士、經紀業或權利人。","申報時機：買賣案件於辦竣所有權移轉登記後30日內申報。","揭露方式：以區段化、去識別化方式提供查詢 (例如：中正路1-30號)。","預售屋規定：委託代銷者，於委託代銷契約屆滿或終止30日內「整批」申報 (資訊落後嚴重)。"]},{id:"p-2014-06-04",date:"2014-06-04",title:"囤房稅 1.0",category:"policy",impact:"medium",description:"非自住住家用稅率由1.2%-2%調高為1.5%-3.6%，授權地方政府自訂差別稅率。",change_content:"非自住稅率 1.2% -> 1.5%~3.6%",affected_scope:"多屋族、台北市置產客",background:"美國聯準會結束QE：預期升息心理浮現，全球資金派對暫歇。",impact_analysis:"[微痛] 持有成本上升，但因多數縣市未採最高稅率，且稅基(房屋評定現值)偏低，實質痛感有限。",details:["自住房屋稅率：維持 1.2% (需本人、配偶或直系親屬實際居住，且全國合計3戶以內)。","非自住房屋稅率：由 1.2%~2% 調升至 1.5%~3.6%。","地方權限：各地方政府可視地方發展需要，在範圍內自訂差別稅率。","持有認定：以個人(自然人)或法人(公司)為單位個別計算。"]},{id:"p-2016-01-01",date:"2016-01-01",title:"房地合一稅 1.0",category:"policy",impact:"high",description:"獲利課稅取代舊制。持有<1年45%，1-2年35%，自用滿6年獲利400萬免稅。奢侈稅同步停徵。",change_content:"按售價課稅(奢侈稅) -> 按獲利課稅(45%~15%)",affected_scope:"短線炒作客、自住客",background:"奢侈稅同步停徵：象徵房市進入「實價課稅」新紀元。",impact_analysis:"[毀滅] 短進短出獲利被腰斬，投資客大量退場。[受益] 房價盤整，自住客獲得較佳議價空間。",details:["課稅基礎：房地交易所得 = 交易成交價額 - 原始取得成本 - 相關費用 - 土地漲價總數額。","持有1年以內：稅率 45%。","持有1-2年：稅率 35%。","持有2-10年：稅率 20%。","持有超過10年：稅率 15%。","自用住宅優惠：獲利400萬元以下免稅，超過部分10%。(需連續設籍滿6年)","日出條款：2016年1月1日以後取得之房地適用新制。"]},{id:"f-2016-03-24",date:"2016-03-24",title:"央行大幅鬆綁信用管制",category:"finance",impact:"high",description:"刪除特定地區管制與自然人第3戶以上限制，僅保留豪宅管制(6成)。",change_content:"刪除多數管制，僅保留豪宅限貸",affected_scope:"換屋族、一般投資客",background:"經濟成長疲弱：為提振內需經濟，央行解除長達6年的房市管制。",impact_analysis:"[受益] 貸款成數恢復，換屋與置產門檻降低，市場交易量逐漸回溫。",details:["解除管制區域：台北市及新北市特定地區。","解除限制對象：自然人第3戶以上購屋貸款、公司法人購屋貸款。","保留限制：高價住宅(豪宅)貸款最高成數仍維持6成。"]},{id:"p-2018-06-27",date:"2018-06-27",title:"租賃住宅市場發展及管理條例",category:"policy",impact:"low",description:"建立包租代管機制，鼓勵房東釋出空屋，給予稅賦優惠(所得稅減免)。",change_content:"包租代管稅賦優惠",affected_scope:"房東、租屋族",background:"美中貿易戰開打：全球供應鏈重組，資金開始撤離中國。",impact_analysis:"[受益] 房東享有所得稅減免；租屋族獲得專業代管服務，租賃關係較有保障。",details:["租稅優惠：個人房東委託包租代管，月租金6000元以下免稅；6000-20000元必要費用率53%。","專業證照：建立租賃住宅管理人員證照制度。","糾紛處理：建立租賃糾紛免費調處機制。"]},{id:"f-2019-08-15",date:"2019-08-15",title:"境外資金匯回專法",category:"finance",impact:"medium",description:"鼓勵台商資金回流享優惠稅率，禁止直接投資房地產，但產生外溢效應帶動豪宅與工業地產。",change_content:"資金專法回流 (禁入房市但有外溢)",affected_scope:"工業地產主、豪宅建商",background:"台商回流潮：史上最大規模資金回台，雖禁入房市，但產生外溢效應。",impact_analysis:"[暴富] 工業用地與廠房價格飆漲。[受益] 企業主獲利與分紅轉入豪宅市場，帶動高總價產品去化。",details:["優惠稅率：第一年匯回稅率8%，第二年10%。(實質投資可退稅一半)","投資限制：禁止資金直接投資房地產(避免炒房)。","資金控管：資金需存入專戶，控管5-7年才能分批提取。","外溢效應：雖然不能直接買房，但增加市場資金總量，且企業獲利後的分紅仍可自由運用。"]},{id:"f-2020-03-19",date:"2020-03-19",title:"央行降息 1 碼",category:"finance",impact:"high",description:"重貼現率降至1.125%，房貸利率跌破1.4%歷史新低，無限QE背景下引發資產通膨。",change_content:"重貼現率 1.375% -> 1.125%",affected_scope:"全體購屋族、股市投資人",background:"COVID-19 疫情爆發：美國聯準會無限QE，全球熱錢氾濫。",impact_analysis:"[刺激] 持有成本極低，「租不如買」與「買房抗通膨」心理大爆發，股房雙漲。",details:["降息幅度：調降重貼現率 0.25個百分點。","房貸利率：五大銀行新承做房貸利率跌破 1.4%，創歷史新低。","配套補貼：針對受疫情影響產業及自用住宅貸款提供額外補貼。"]},{id:"f-2020-12-08",date:"2020-12-08",title:"央行信用管制 (第一波)",category:"finance",impact:"medium",description:"法人購屋限貸6成，自然人第3戶限貸6成，建商餘屋限貸5成。",change_content:"法人/第3戶/餘屋 限貸 5-6成",affected_scope:"公司法人、多屋族(3戶+)",background:"房市過熱跡象：紅單炒作猖獗，排隊買房現象頻傳。",impact_analysis:"[警示] 宣示政府打炒房決心，但因低利環境，實質殺傷力有限。",details:["公司法人：第一戶貸款成數最高 6成，無寬限期。","自然人第3戶(含)以上：貸款成數最高 6成，無寬限期。","購地貸款：限貸 6.5成，需保留 1成動工款。","餘屋貸款：限貸 5成。"]},{id:"f-2021-03-19",date:"2021-03-19",title:"央行信用管制 (第二波)",category:"finance",impact:"medium",description:"法人購屋成數降至4成，豪宅降至5.5成。",change_content:"法人限貸 4成；豪宅限貸 5.5成",affected_scope:"公司法人、豪宅客",background:"投機風氣未減",impact_analysis:"[打擊] 封鎖利用公司名義高槓桿炒房的途徑。",details:["公司法人：貸款成數調降至 4成。","自然人高價住宅：第1戶限貸 5.5成，第3戶以上限貸 4成。","工業區閒置土地：貸款最高 5.5成。"]},{id:"p-2021-07-01",date:"2021-07-01",title:"實價登錄 2.0 & 房地合一 2.0",category:"policy",impact:"high",description:"門牌完整揭露，預售屋即時申報(30日)，禁止紅單轉售；重稅期延長(45%改2年, 35%改5年)，預售屋納稅。",change_content:"預售屋納管、重稅閉鎖期延長、禁紅單",affected_scope:"預售屋買方/投機客、建商、換屋族",background:"房市多頭確立；疫情三級警戒(內需停滯但房市創高)",impact_analysis:"[雙面刃] 資訊全透明反成定錨工具。[閉鎖] 投機客無法短進短出，成屋惜售供給減少，價格難跌。",details:["實價登錄2.0：門牌號碼完整揭露 (不再區段化)。","預售屋納管：銷售前需備查，簽約後30日內申報實價登錄。","紅單禁止：禁止預售屋紅單轉售。","房地合一2.0：預售屋獲利納入房地合一稅課徵。","延長重稅期：持有2年內45%，2-5年35% (原為1-2年)。","法人比照：法人交易比照自然人稅率 (防堵公司名義短期炒作)。"]},{id:"f-2021-09-24",date:"2021-09-24",title:"央行信用管制 (第三波)",category:"finance",impact:"medium",description:"特定地區 (六都+新竹) 第2戶取消寬限期。",change_content:"特定地區第2戶 取消寬限期",affected_scope:"投資客、換屋族",background:"房價持續攀升",impact_analysis:"[壓力] 買第2間房必須立刻還本金，增加現金流壓力，迫使部分槓桿過大者退場。",details:["管制區域：新增特定地區 (六都 + 新竹縣市)。","自然人第2戶：取消寬限期 (需本息攤還)。","購地貸款：調降至 6成。","工業區閒置土地：調降至 5成。"]},{id:"f-2021-12-17",date:"2021-12-17",title:"央行信用管制 (第四波)",category:"finance",impact:"medium",description:"豪宅貸款降至4成，第3戶降至4成，餘屋貸款降至4成。",change_content:"豪宅/第3戶/餘屋 限貸 4成",affected_scope:"建商、豪宅客",background:"營建成本飆漲：缺工缺料議題發酵。",impact_analysis:"[緊縮] 建商資金鏈趨緊，中小型建商生存困難，市場走向大者恆大。",details:["自然人高價住宅：貸款成數一律降至 4成 (無寬限期)。","自然人第3戶(含)以上：貸款成數一律降至 4成。","購地貸款：降至 5成。","餘屋貸款：降至 4成。"]},{id:"f-2022-03-17",date:"2022-03-17",title:"央行升息循環啟動",category:"finance",impact:"medium",description:"央行跟進Fed升息(全年共2.5碼)，房貸利率重回2%以上。",change_content:"升息 2.5碼 (利率重回 2% table+)",affected_scope:"房貸族",background:"全球通膨危機：美國暴力升息，全球股市修正。",impact_analysis:"[負擔增加] 每千萬房貸每年利息支出增加約3-4萬元，稍微冷卻追價意願。",details:["2022-03：升息 1碼 (0.25%)。","2022-06：升息 半碼 (0.125%)。","2022-09：升息 半碼 (0.125%)。","2022-12：升息 半碼 (0.125%)。","存款準備率：同步調升，緊縮市場游資。"]},{id:"f-2023-06-16",date:"2023-06-16",title:"央行信用管制 (第五波)",category:"finance",impact:"medium",description:"特定地區第2戶限貸成數上限 7成。",change_content:"特定地區第2戶 限貸 7成",affected_scope:"換屋族、投資客",background:"房市量縮價穩：市場觀望平均地權條例上路。",impact_analysis:"[微痛] 需多準備1成自備款，影響尚可控。",details:["管制區域：特定地區 (六都 + 新竹縣市)。","自然人第2戶：新增貸款成數上限 7成 (此前僅無寬限期)。"]},{id:"p-2023-07-01",date:"2023-07-01",title:"平均地權條例修正",category:"policy",impact:"high",description:"預售屋禁止換約轉售，建立檢舉獎金，私法人購屋許可制。",change_content:"預售屋禁換約、私法人許可制",affected_scope:"預售屋黃牛、豪宅法人",background:"投機客的大限",impact_analysis:"[滅絕] 純粹賺價差的紅單與換約客徹底消失。豪宅市場因法人需經許可，交易量急凍。",details:["限制換約轉售：預售屋與新建成屋簽約後，除配偶、直系或二親等旁系外，不得讓與或轉售 (禁止黃牛)。","重罰炒作：嚴懲散播不實資訊影響房價，最高罰5000萬元。","檢舉獎金：建立檢舉實名制，獎金為罰鍰 30%。","私法人購屋許可制：私法人購買住宅用房屋需經內政部許可 (限制豪宅私法人節稅管道)。"]},{id:"p-2023-08-01",date:"2023-08-01",title:"新青安貸款專案",category:"policy",impact:"high",description:"額度1000萬，年限40年，寬限期5年，利率補貼(1.775%起)。",change_content:"40年期/5年寬限/降息補貼",affected_scope:"首購族、投機客(人頭)、低總價屋主",background:"總統大選前夕：政府釋出利多，試圖減輕年輕人負擔。",impact_analysis:"[狂熱] 創造「租不如買」與「5年免還本」的套利空間。低總價成屋被掃貨，房價逆勢暴漲。",details:["貸款額度：提高至 1000萬元。","利息補貼：政府補貼 1.5碼 (0.375%) + 公股銀行減半碼 = 利率 1.775% 起。","貸款年限：延長至 40年。","寬限期：延長至 5年 (只繳息不還本)。","資格：本人、配偶及未成年子女名下均無自有住宅。"]},{id:"f-2024-06-14",date:"2024-06-14",title:"央行信用管制 (第六波)",category:"finance",impact:"medium",description:"特定地區第2戶限貸成數降至 6成。",change_content:"特定地區第2戶 限貸 6成",affected_scope:"換屋族、置產客",background:"台股站上2萬點：AI熱潮帶動股市財富效應，資金外溢至房市。",impact_analysis:"[無效] 股市獲利豐厚，6成限貸無法阻擋資金湧入房市。",details:["管制區域：特定地區 (六都 + 新竹縣市)。","自然人第2戶：貸款成數上限由 7成調降為 6成。","調升存款準備率：調升 0.25個百分點 (收回市場資金)。"]},{id:"p-2024-07-01",date:"2024-07-01",title:"囤房稅 2.0 實施",category:"policy",impact:"medium",description:"全國歸戶，非自用稅率調高至 2.0%-4.8%，建商餘屋依持有年限課稅。",change_content:"全國歸戶；稅率 2.0%~4.8%",affected_scope:"多屋族、租屋族、建商",background:"租金指數創高",impact_analysis:"[轉嫁] 多屋族將稅負轉嫁至租金，導致租金上漲。建商面臨餘屋去化壓力，傾向預售完銷。",details:["全國歸戶：由縣市歸戶改為全國歸戶計算戶數。","稅率調升：非自住住家用稅率調升為 2%~4.8% (原1.5%~3.6%)。","單一自住優惠：全國單一自住(本人配偶子女僅一戶)且房屋現值在一定金額以下，稅率降至 1%。","建商餘屋：持有2年以內稅率 2%~3.6%；超過2年稅率 2%~4.8% (鼓勵釋出餘屋)。"]},{id:"f-2024-08-01",date:"2024-08-01",title:"銀行限貸令 (72-2水位)",category:"finance",impact:"high",description:"銀行法72-2條逼近30%上限，自主限貸、排隊撥款，市場流動性急凍。",change_content:"銀行自主限貸、排隊撥款",affected_scope:"即將交屋族、賣屋換屋族",background:"新青安效應發酵：過多成屋交易與新青安撥款，耗盡銀行額度。",impact_analysis:"[恐慌] 買了房卻貸不到款，面臨違約風險。市場流動性瞬間急凍。",details:["銀行法72-2條：商業銀行辦理住宅建築及企業建築放款總額，不得超過存款總餘額及金融債券發售額之 30%。","現象：多家銀行房貸水位接近滿載。","影響：銀行暫停收件、排隊撥款(需等數月)、利率大幅調升(2.6%-3%以上)。"]},{id:"f-2024-09-20",date:"2024-09-20",title:"央行信用管制 (第七波)",category:"finance",impact:"high",description:"有房者第1戶無寬限期；全國第2戶限貸5成；法人/豪宅/第3戶限貸3成。",change_content:"有房者第1戶無寬限；第2戶全國限貸5成",affected_scope:"換屋族、繼承族、交屋族",background:"金龍海嘯：央行判定房市過熱，認為新青安助長投機，決心斷絕金流。",impact_analysis:"[重傷/錯殺] 史上最嚴厲管制。1. 換屋族需5成自備。2. 繼承祖產失寬限。3. 預售交屋斷頭風險大增。",details:["自然人第1戶：名下有房屋者(含繼承、持分)，第1戶購屋貸款「無寬限期」。","自然人第2戶：貸款成數上限降至 5成，且擴及「全國」。","自然人第3戶以上：貸款成數上限降至 3成。","公司法人：購屋貸款成數降至 3成。","豪宅(高價住宅)：貸款成數降至 3成。","餘屋貸款：降至 3成。","存款準備率：再調升 0.25個百分點。"]}]],44402);var s=e.i(91568);let l=(0,s.default)("gavel",[["path",{d:"m14 13-8.381 8.38a1 1 0 0 1-3.001-3l8.384-8.381",key:"pgg06f"}],["path",{d:"m16 16 6-6",key:"vzrcl6"}],["path",{d:"m21.5 10.5-8-8",key:"a17d9x"}],["path",{d:"m8 8 6-6",key:"18bi4p"}],["path",{d:"m8.5 7.5 8 8",key:"1oyaui"}]]);e.s(["Gavel",()=>l],47550);let o=(0,s.default)("landmark",[["path",{d:"M10 18v-7",key:"wt116b"}],["path",{d:"M11.12 2.198a2 2 0 0 1 1.76.006l7.866 3.847c.476.233.31.949-.22.949H3.474c-.53 0-.695-.716-.22-.949z",key:"1m329m"}],["path",{d:"M14 18v-7",key:"vav6t3"}],["path",{d:"M18 18v-7",key:"aexdmj"}],["path",{d:"M3 22h18",key:"8prr45"}],["path",{d:"M6 18v-7",key:"1ivflk"}]]);e.s(["Landmark",()=>o],43453);let c=(0,s.default)("zoom-in",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);e.s(["ZoomIn",()=>c],59610);let d=(0,s.default)("zoom-out",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);e.s(["ZoomOut",()=>d],16455)},59264,e=>{"use strict";var t=e.i(25191),r=e.i(68524),n=e.i(36441),i=e.i(75358),a=e.i(44402),s=e.i(74614),l=e.i(76220),o=e.i(80467),c=e.i(47550),d=e.i(43453),x=e.i(53402),u=e.i(59610),m=e.i(16455),h=e.i(78841),p=e.i(23372),f=e.i(74229),g=e.i(65949);function b({data:e}){let b=(0,r.useMemo)(()=>{if(!e)return[];let t=new Set;return e.forEach(e=>{e["建案名稱"]&&t.add(e["建案名稱"])}),Array.from(t).map(e=>({value:e,label:e}))},[e]),[y,v]=(0,r.useState)([]),[j,w]=(0,r.useState)(null),[N,z]=(0,r.useState)(1),[P,k]=(0,r.useState)(!1),S=(0,r.useMemo)(()=>{if(0===y.length||!e||0===e.length)return[];let t={};return e.forEach(e=>{let r=e["建案名稱"];if(!r||!y.includes(r))return;let n=new Date(e["交易日"]).getTime();isNaN(n)||(t[r]||(t[r]=[]),t[r].push(n))}),Object.entries(t).map(([e,t])=>{let r=Math.min(...t),n=Math.max(...t);return{name:e,start:new Date(r),end:new Date(n),startStr:new Date(r).toISOString().slice(0,10),endStr:new Date(n).toISOString().slice(0,10),count:t.length}}).sort((e,t)=>e.start.getTime()-t.start.getTime()).slice(0,10)},[e,y]),C=(0,r.useMemo)(()=>{let e=new Date().getFullYear()+1;return S.length>0&&(e=Math.max(e,Math.max(...S.map(e=>e.end.getFullYear()))+1)),{start:new Date("2012-01-01"),end:new Date(`${e}-12-31`),totalMonths:(e-2012+1)*12}},[S]),A=Math.max(350,100+40*S.length+80),M=e=>{let t=new Date(e),r=C.start.getTime(),n=C.end.getTime(),i=t.getTime();return i<r?0:i>n?100:(i-r)/(n-r)*100},_=(0,r.useMemo)(()=>a.REAL_ESTATE_POLICIES.filter(e=>{let t=new Date(e.date);return t>=C.start&&t<=C.end}),[C]),R=(0,r.useMemo)(()=>_.slice().reverse().map(e=>({日期:e.date,標題:e.title,類別:"finance"===e.category?"金融":"政策",影響:e.impact,變革內容:e.change_content,影響對象:e.affected_scope})),[_]);return(0,t.jsxs)(n.Card,{className:"w-full bg-black/40 border-zinc-800 backdrop-blur-xl",children:[(0,t.jsxs)(n.CardHeader,{children:[(0,t.jsxs)(n.CardTitle,{className:"flex items-center gap-2 text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-400",children:[(0,t.jsx)(l.Calendar,{className:"w-6 h-6 text-cyan-500"}),"房市政策時光機"]}),(0,t.jsx)(n.CardDescription,{className:"text-zinc-400",children:"建案銷售期間與重大政策/金融事件的交叉比對"})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row items-start md:items-end justify-between mb-6 px-2 gap-4",children:[(0,t.jsx)("div",{className:"w-full md:w-1/2 lg:w-1/3",children:(0,t.jsx)(f.ProjectSearchMultiselect,{projects:b,onChange:v,title:"選擇建案 (顯示銷售區間)",placeholder:"搜尋建案以顯示在時間軸...",max:6})}),(0,t.jsxs)("div",{className:"flex items-center justify-between w-full md:w-auto gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 bg-black/20 rounded-lg p-1 border border-white/5",children:[(0,t.jsx)("button",{onClick:()=>z(e=>Math.max(.5,e-.25)),className:"p-1.5 hover:bg-white/10 rounded-md text-zinc-400 hover:text-white transition-colors",children:(0,t.jsx)(m.ZoomOut,{className:"w-4 h-4"})}),(0,t.jsxs)("span",{className:"text-xs font-mono text-zinc-500 w-12 text-center",children:[(100*N).toFixed(0),"%"]}),(0,t.jsx)("button",{onClick:()=>z(e=>Math.min(3,e+.25)),className:"p-1.5 hover:bg-white/10 rounded-md text-zinc-400 hover:text-white transition-colors",children:(0,t.jsx)(u.ZoomIn,{className:"w-4 h-4"})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3 text-xs text-zinc-500",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-emerald-500"})," 金融事件"]}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-rose-500"})," 房市政策"]})]})]})]}),(0,t.jsx)("div",{className:"relative w-full overflow-x-auto pb-12 pt-8 hide-scrollbar",children:(0,t.jsxs)("div",{className:"relative pr-20 ml-24 border-b border-zinc-800 transition-all duration-300 ease-out",style:{minWidth:`${1200*N}px`,height:`${A}px`},children:[(0,t.jsx)("div",{className:"absolute top-0 w-full h-full pointer-events-none",children:Array.from({length:C.end.getFullYear()-C.start.getFullYear()+1}).map((e,r)=>{let n=C.start.getFullYear()+r,i=M(`${n}-01-01`);return(0,t.jsx)("div",{className:"absolute h-full border-l border-dashed border-zinc-800/50",style:{left:`${i}%`},children:(0,t.jsx)("span",{className:"absolute -top-6 -left-3 text-xs font-mono text-zinc-500",children:n})},n)})}),S.map((e,r)=>{let n=["from-cyan-500/20 to-blue-500/20 border-cyan-500/30 text-cyan-400","from-violet-500/20 to-purple-500/20 border-violet-500/30 text-violet-400","from-amber-500/20 to-orange-500/20 border-amber-500/30 text-amber-400","from-emerald-500/20 to-teal-500/20 border-emerald-500/30 text-emerald-400","from-pink-500/20 to-rose-500/20 border-pink-500/30 text-pink-400"],i=n[r%n.length];return(0,t.jsxs)("div",{className:(0,s.cn)("absolute h-8 border-y backdrop-blur-sm z-10 flex items-center justify-center group transition-all hover:bg-white/5",`bg-gradient-to-r ${i}`),style:{left:`${M(e.startStr)}%`,width:`${Math.max(.5,M(e.endStr)-M(e.startStr))}%`,top:`${100+40*r}px`},children:[(0,t.jsx)("div",{className:"absolute right-full mr-2 flex items-center h-full top-0",children:(0,t.jsx)("span",{className:"text-[10px] font-bold text-zinc-400 whitespace-nowrap bg-black/40 px-1.5 py-0.5 rounded border border-white/5",children:e.name})}),(0,t.jsxs)("div",{className:"absolute -top-8 text-[10px] whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity bg-black/90 px-2 py-1 rounded border border-zinc-700 z-20 pointer-events-none",children:[e.startStr," ~ ",e.endStr," (",e.count,"筆)"]})]},e.name)}),_.map((e,r)=>{let n=M(e.date),i="high"===e.impact,a=r%2==0?"8%":"85%",l=!1;if(S.length>0){let t=new Date(e.date);l=S.some(e=>t>=e.start&&t<=e.end)}return(0,t.jsxs)("div",{className:(0,s.cn)("absolute transform -translate-x-1/2 flex flex-col items-center group cursor-pointer transition-all duration-300 z-20",l?"opacity-100 scale-110":"opacity-60 hover:opacity-100 hover:scale-110",j?.id===e.id&&"scale-125 opacity-100 z-30"),style:{left:`${n}%`,top:a},onClick:()=>w(e),children:[(0,t.jsx)("div",{className:(0,s.cn)("h-8 w-px absolute","8%"===a?"top-full bg-gradient-to-b":"bottom-full bg-gradient-to-t","from-transparent to-zinc-700")}),(0,t.jsx)("div",{className:(0,s.cn)("w-8 h-8 rounded-full flex items-center justify-center border shadow-[0_0_15px_rgba(0,0,0,0.5)] transition-all","finance"===e.category?"bg-emerald-950/80 border-emerald-500/50 text-emerald-400 group-hover:shadow-emerald-500/20":"bg-rose-950/80 border-rose-500/50 text-rose-400 group-hover:shadow-rose-500/20",i&&"ring-2 ring-offset-2 ring-offset-black/50 ring-opacity-50","finance"===e.category&&i?"ring-emerald-500":"ring-rose-500",j?.id===e.id&&"ring-2 ring-white ring-offset-2 ring-offset-black"),children:(e=>{switch(e){case"finance":return(0,t.jsx)(d.Landmark,{className:"w-3 h-3 text-emerald-400"});case"policy":return(0,t.jsx)(c.Gavel,{className:"w-3 h-3 text-rose-400"});default:return(0,t.jsx)(x.Info,{className:"w-3 h-3 text-blue-400"})}})(e.category)}),(0,t.jsx)("div",{className:(0,s.cn)("absolute whitespace-nowrap text-[10px] px-2 py-0.5 mt-2 rounded bg-black/80 border border-zinc-700 backdrop-blur-md transition-all font-medium","8%"===a?"-top-8":"-bottom-8",l?"text-white border-yellow-500/50":"text-zinc-400 group-hover:text-white",j?.id===e.id&&"text-white border-white/50 bg-zinc-800"),children:e.title}),(0,t.jsx)("div",{className:(0,s.cn)("absolute text-[9px] font-mono text-zinc-600","8%"===a?"top-10":"bottom-10"),children:e.date})]},e.id)})]})}),j&&(0,t.jsx)("div",{className:"mt-6 mb-8 border border-zinc-700/50 bg-zinc-900/80 p-6 rounded-xl animate-in fade-in slide-in-from-top-4 shadow-2xl shadow-black/50",children:(0,t.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between border-b border-white/5 pb-4",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(i.Badge,{variant:"outline",className:(0,s.cn)("text-sm px-3 py-1","finance"===j.category?"bg-emerald-500/10 text-emerald-400 border-emerald-500/30":"bg-rose-500/10 text-rose-400 border-rose-500/30"),children:"finance"===j.category?"金融事件":"房市政策"}),(0,t.jsx)("span",{className:"text-zinc-400 font-mono text-sm",children:j.date})]}),(0,t.jsx)("h3",{className:"text-2xl font-bold text-white tracking-tight",children:j.title})]}),(0,t.jsxs)("div",{className:(0,s.cn)("px-3 py-1 rounded-full text-xs font-medium border","high"===j.impact?"bg-red-500/10 text-red-400 border-red-500/30":"bg-yellow-500/10 text-yellow-400 border-yellow-500/30"),children:["影響程度: ","high"===j.impact?"高":"medium"===j.impact?"中":"低"]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"text-sm font-bold text-zinc-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[(0,t.jsx)(x.Info,{className:"w-4 h-4"})," 政策/事件內容"]}),(0,t.jsx)("p",{className:"text-zinc-200 text-base leading-relaxed bg-zinc-950/50 p-4 rounded-lg border border-white/5",children:j.description})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"text-sm font-bold text-zinc-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[(0,t.jsx)(c.Gavel,{className:"w-4 h-4"})," 具體規範變革"]}),(0,t.jsx)("div",{className:"bg-zinc-950/50 p-4 rounded-lg border border-white/5 text-cyan-400 font-medium",children:j.change_content||"無具體規範變更"})]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"text-sm font-bold text-zinc-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[(0,t.jsx)(d.Landmark,{className:"w-4 h-4"})," 時代背景與金融環境"]}),(0,t.jsx)("p",{className:"text-zinc-300 text-sm leading-relaxed bg-zinc-950/30 p-4 rounded-lg border border-white/5",children:j.background||"尚無背景資料"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"text-sm font-bold text-zinc-500 uppercase tracking-wider mb-2 flex items-center gap-2",children:[(0,t.jsx)(o.TrendingUp,{className:"w-4 h-4"})," 受眾影響分析"]}),(0,t.jsxs)("div",{className:"relative overflow-hidden rounded-lg border border-white/10 bg-gradient-to-br from-indigo-500/10 to-purple-500/10 p-4",children:[(0,t.jsx)("div",{className:"absolute top-0 right-0 p-2 opacity-10",children:(0,t.jsx)(o.TrendingUp,{className:"w-24 h-24"})}),(0,t.jsxs)("div",{className:"relative z-10",children:[(0,t.jsxs)("p",{className:"text-indigo-300 font-medium mb-2 text-xs uppercase",children:["影響對象: ",j.affected_scope]}),(0,t.jsx)("p",{className:"text-white text-sm leading-relaxed",children:j.impact_analysis||"尚無詳細分析"})]})]})]})]})]}),j.details&&j.details.length>0&&(0,t.jsxs)("div",{className:"border-t border-white/5 pt-4",children:[(0,t.jsx)("button",{onClick:()=>k(!P),className:"flex items-center gap-2 text-sm text-zinc-400 hover:text-white transition-colors w-full justify-center py-2",children:P?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(p.ChevronUp,{className:"w-4 h-4"})," 收起完整規範細節"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.ChevronDown,{className:"w-4 h-4"})," 展開完整規範細節 (",j.details.length," 項)"]})}),P&&(0,t.jsx)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4 animate-in fade-in slide-in-from-top-2",children:j.details.map((e,r)=>(0,t.jsxs)("div",{className:"flex items-start gap-3 bg-black/40 p-3 rounded border border-zinc-800 text-sm text-zinc-300",children:[(0,t.jsx)("span",{className:"flex items-center justify-center w-5 h-5 rounded-full bg-zinc-800 text-zinc-500 text-xs shrink-0 mt-0.5",children:r+1}),(0,t.jsx)("span",{children:e})]},r))})]})]})}),(0,t.jsxs)("div",{className:"mt-8 border-t border-zinc-800 pt-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(o.TrendingUp,{className:"w-5 h-5 text-purple-400"}),(0,t.jsx)("h3",{className:"text-lg font-bold text-zinc-200",children:"政策影響比較表"})]}),(0,t.jsx)(g.ExportButton,{data:R,filename:"policy_comparison",label:"匯出政策表"})]}),(0,t.jsxs)("div",{className:"rounded-xl border border-white/10 overflow-hidden bg-black/20",children:[(0,t.jsxs)("div",{className:"grid grid-cols-12 gap-4 p-4 bg-zinc-900/50 border-b border-white/5 text-xs font-bold text-zinc-400 uppercase tracking-wider",children:[(0,t.jsx)("div",{className:"col-span-2",children:"實施日期"}),(0,t.jsx)("div",{className:"col-span-3",children:"政策/事件名稱"}),(0,t.jsx)("div",{className:"col-span-4",children:"變革內容 (Before vs After)"}),(0,t.jsx)("div",{className:"col-span-3",children:"影響對象與範圍"})]}),(0,t.jsx)("div",{className:"divide-y divide-white/5 max-h-[400px] overflow-y-auto custom-scrollbar",children:_.slice().reverse().map(e=>(0,t.jsxs)("div",{className:(0,s.cn)("grid grid-cols-12 gap-4 p-4 text-sm transition-colors hover:bg-white/5 cursor-pointer",j?.id===e.id?"bg-white/10":""),onClick:()=>w(e),children:[(0,t.jsx)("div",{className:"col-span-2 font-mono text-zinc-500",children:e.date}),(0,t.jsxs)("div",{className:"col-span-3 flex items-start gap-2",children:[(0,t.jsx)(i.Badge,{variant:"outline",className:(0,s.cn)("shrink-0 mt-0.5","finance"===e.category?"text-emerald-400 border-emerald-500/30":"text-rose-400 border-rose-500/30"),children:"finance"===e.category?"金融":"政策"}),(0,t.jsx)("span",{className:(0,s.cn)("font-medium","high"===e.impact?"text-white":"text-zinc-400"),children:e.title})]}),(0,t.jsx)("div",{className:"col-span-4 text-zinc-300",children:e.change_content?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-cyan-500 shrink-0"}),e.change_content]}):(0,t.jsx)("span",{className:"text-zinc-600 italic",children:"--"})}),(0,t.jsx)("div",{className:"col-span-3 text-zinc-400",children:e.affected_scope||(0,t.jsx)("span",{className:"text-zinc-600 italic",children:"--"})})]},e.id))})]})]})]})]})}e.s(["default",()=>b])},14302,e=>{"use strict";var t=e.i(68524),r=e.i(68609),n=e.i(78885),i=e.i(72448),a=e.i(59725);function s(e,t){let r=(e.length-1)*t,n=Math.floor(r);return void 0!==e[n+1]?parseFloat((e[n]+(r-n)*(e[n+1]-e[n])).toFixed(2)):parseFloat(e[n].toFixed(2))}function l(){let e=(0,n.useFilterStore)(),[l,o]=(0,t.useState)(!1),[c,d]=(0,t.useState)(null),[x,u]=(0,t.useState)(null),m=(0,t.useCallback)(async()=>{o(!0),d(null),u(null);try{let c=e.counties.map(e=>i.COUNTY_CODE_MAP[e]||e);if(0===c.length){d("請至少選擇一個縣市"),o(!1);return}let{dateRange:x,startDate:m,endDate:h}=e;if("custom"!==x&&(!m||!h)){let e=(0,a.getDateRangeDates)(x);e.startDate&&e.endDate&&(m=e.startDate,h=e.endDate)}let p={districts:e.districts,transactionType:e.transactionType,type:e.transactionType,projectNames:e.projectNames,buildingType:e.buildingType,excludeCommercial:e.excludeCommercial,floorPremium:e.floorPremium,dateRange:x,dateStart:m,dateEnd:h};console.log("Analyzing with counties:",c);let f=c.map(e=>{let t={...p,countyCode:e,counties:[e]};return r.api.analyzeProjectRanking(t).catch(t=>(console.error(`Failed to fetch data for ${e}:`,t),null))}),g=await Promise.all(f),b=null,y=0;for(let e of g)if(e&&e.projectRanking&&e.coreMetrics){var t,n,l;console.log("Merging result for county:",e.projectRanking?.[0]?.county),t=b,b=e?t?(e.transactionDetails&&Array.isArray(e.transactionDetails)&&(t.transactionDetails||(t.transactionDetails=[]),t.transactionDetails=[...t.transactionDetails,...e.transactionDetails]),t.coreMetrics=function(e,t){if(!t)return e;if(!e)return t;let r=(e.totalSaleAmount||0)+(t.totalSaleAmount||0),n=(e.totalHouseArea||0)+(t.totalHouseArea||0),i=(e.transactionCount||0)+(t.transactionCount||0);return{totalSaleAmount:r,totalHouseArea:n,overallAveragePrice:n>0?r/n:0,transactionCount:i,medianPrice:0,q1Price:0,q3Price:0,minPrice:Math.min(e.minPrice||1/0,t.minPrice||1/0),maxPrice:Math.max(e.maxPrice||0,t.maxPrice||0)}}(t.coreMetrics,e.coreMetrics),e.projectRanking&&Array.isArray(e.projectRanking)&&(t.projectRanking=[...t.projectRanking,...e.projectRanking]),t.priceBandAnalysis=function(e,t){if(!t)return e;let r=Array.isArray(e)?e:e?.details||[],n=Array.isArray(t)?t:t?.details||[],i=e?.locationCrossTable||{},a=t?.locationCrossTable||{},s=e?.allDistricts||[],l=t?.allDistricts||[],o=e?.allRoomTypes||[],c=t?.allRoomTypes||[],d=new Map,x=e=>{let t=null!==e.bathrooms&&void 0!==e.bathrooms?String(e.bathrooms):"null",r=(e.roomType||"").replace(/\s+/g,""),n=`${r}-${t}`,i=Number(e.count)||0,a=Number(e.avgPrice)||0,s=Number(e.minPrice)||0,l=Number(e.maxPrice)||0;if(d.has(n)){let t=d.get(n),r=Number(t.count)||0,o=Number(t.avgPrice)||0,c=a*i,x=r+i,u=x>0?(o*r+c)/x:0;if(t.count=x,t.avgPrice=parseFloat(u.toFixed(2)),t.minPrice=Math.min(t.minPrice,s),t.maxPrice=Math.max(t.maxPrice,l),e.projectNames){let r=new Set([...t.projectNames,...e.projectNames]);t.projectNames=Array.from(r)}e.byDistrict&&Object.entries(e.byDistrict).forEach(([e,r])=>{t.byDistrict[e]=(t.byDistrict[e]||0)+r})}else d.set(n,{...e,roomType:r,count:i,avgPrice:a,minPrice:s,maxPrice:l,projectNames:e.projectNames?[...e.projectNames]:[],byDistrict:e.byDistrict?{...e.byDistrict}:{}})};r.forEach(x),n.forEach(x);let u={...i};Object.entries(a).forEach(([e,t])=>{u[e]?Object.entries(t).forEach(([t,r])=>{u[e][t]=(u[e][t]||0)+r}):u[e]={...t}});let m=Array.from(new Set([...s,...l])).sort(),h=Array.from(new Set([...o,...c])).sort();return{details:Array.from(d.values()),locationCrossTable:u,allDistricts:m,allRoomTypes:h}}(t.priceBandAnalysis,e.priceBandAnalysis),t.unitPriceAnalysis=function(e,t){if(!t)return e;let r=(e,t)=>{if(!t)return e;if(!e)return t;let r=(e.count||0)+(t.count||0);if(0===r)return e;let n={arithmetic:0,weighted:0},i=(e,t)=>"number"==typeof e.avgPrice?e.weightedAvgPrice||e.avgPrice:e.avgPrice?.[t]||0;["arithmetic","weighted"].forEach(a=>{let s=i(e,a),l=i(t,a);n[a]=(s*(e.count||0)+l*(t.count||0))/r});let a=Math.min(e.minPrice,t.minPrice),s=Math.max(e.maxPrice,t.maxPrice),l=e.minPrice<t.minPrice?e.minPriceProject:t.minPriceProject;return{count:r,avgPrice:n,minPrice:a,maxPrice:s,minPriceProject:l,maxPriceProject:e.maxPrice>t.maxPrice?e.maxPriceProject:t.maxPriceProject,medianPrice:0,q1Price:0,q3Price:0}},n=r(e.residentialStats,t.residentialStats),i=r(e.officeStats,t.officeStats),a=r(e.storeStats,t.storeStats),s=[...e.typeComparison||[]];return t.typeComparison&&(s=[...s,...t.typeComparison]),{residentialStats:n,officeStats:i,storeStats:a,typeComparison:s}}(t.unitPriceAnalysis,e.unitPriceAnalysis),t.transactionDetails&&t.transactionDetails.length>0&&function(e,t){if(!e||!t||0===t.length)return;let r=[],n={price:0,area:0,count:0},i=[],a={price:0,area:0,count:0},l=[],o={price:0,area:0,count:0},c=()=>({minPrice:1/0,maxPrice:-1/0,minRecord:null,maxRecord:null}),d=c(),x=c(),u=c();t.forEach(e=>{let t=e["建物型態"],s=e["主要用途"],c=e["房屋單價(萬)"],m=e["房屋總價(萬)"]||0,h=e["建物移轉總面積"]||0;if("number"!=typeof c||c<=0)return;let p=r,f=n,g=d;t?.includes("店")||"商業用"===s||e["備註"]?.includes("店")?(p=l,f=o,g=u):(t?.includes("辦公")||t?.includes("廠辦")||t?.includes("事務所")||s?.includes("辦公"))&&(p=i,f=a,g=x),p.push(c),f.price+=m,f.area+=h,f.count+=1,c>g.maxPrice&&(g.maxPrice=c,g.maxRecord=e),c<g.minPrice&&(g.minPrice=c,g.minRecord=e)});let m=(e,t,r,n)=>{e&&(function(e,t){if(!t||0===t.length){e.medianPrice=0,e.q1Price=0,e.q3Price=0;return}t.sort((e,t)=>e-t),e.medianPrice=s(t,.5),e.q1Price=s(t,.25),e.q3Price=s(t,.75)}(e,t),e.count=r.count,e.avgPrice=r.count>0?t.reduce((e,t)=>e+t,0)/r.count:0,e.weightedAvgPrice=r.area>0?r.price/r.area:0,n.maxRecord&&(e.maxPrice=n.maxPrice,e.maxPriceProject=n.maxRecord["建案名稱"],e.maxPriceUnit=n.maxRecord["戶型"]||n.maxRecord["戶別"],e.maxPriceFloor=n.maxRecord["樓層"]),n.minRecord&&(e.minPrice=n.minPrice,e.minPriceProject=n.minRecord["建案名稱"],e.minPriceUnit=n.minRecord["戶型"]||n.minRecord["戶別"],e.minPriceFloor=n.minRecord["樓層"]))};e.residentialStats&&m(e.residentialStats,r,n,d),e.officeStats&&m(e.officeStats,i,a,x),e.storeStats&&m(e.storeStats,l,o,u);let h=new Map;t.forEach(e=>{let t=e["建案名稱"];if(!t)return;h.has(t)||h.set(t,{resSum:{price:0,area:0,count:0},shopSum:{price:0,area:0,count:0},officeSum:{price:0,area:0,count:0},county:e["縣市"],district:e["行政區"]});let r=h.get(t),n=e["建物型態"],i=e["主要用途"],a=e["房屋單價(萬)"],s=e["房屋總價(萬)"]||0,l=e["建物移轉總面積"]||0;"number"!=typeof a||a<=0||(n?.includes("店")||"商業用"===i||e["備註"]?.includes("店")?(r.shopSum.price+=s,r.shopSum.area+=l,r.shopSum.count+=1):n?.includes("辦公")||n?.includes("廠辦")||n?.includes("事務所")||i?.includes("辦公")?(r.officeSum.price+=s,r.officeSum.area+=l,r.officeSum.count+=1):(r.resSum.price+=s,r.resSum.area+=l,r.resSum.count+=1))});let p=[];h.forEach((e,t)=>{let r=e.resSum.area>0?e.resSum.price/e.resSum.area:0,n=e.shopSum.area>0?e.shopSum.price/e.shopSum.area:0,i=e.officeSum.area>0?e.officeSum.price/e.officeSum.area:0;r>0&&(n>0||i>0)&&p.push({projectName:t,county:e.county,district:e.district,residentialAvg:r,shopAvg:n,officeAvg:i,shopMultiple:r>0?n/r:0,officeMultiple:r>0?i/r:0})}),p.sort((e,t)=>e.projectName.localeCompare(t.projectName)),e.typeComparison=p}(t.unitPriceAnalysis,t.transactionDetails),t.parkingAnalysis=function(e,t){if(!t)return e;let r=e.parkingRatio,n=t.parkingRatio,i=null;if(r&&n){let e=r.withParking.count,t=r.withoutParking.count,a=n.withParking.count,s=n.withoutParking.count,l=e+a,o=t+s,c=l+o;i={withParking:{count:l,percentage:c>0?l/c*100:0},withoutParking:{count:o,percentage:c>0?o/c*100:0}}}else i=r||n;let a=new Map,s=e=>{if(a.has(e.type)){let t=a.get(e.type),r=t.count+e.count,n=t.transactionCount+e.transactionCount,i=t.avgPrice,s=e.avgPrice,l=n>0?(i*t.transactionCount+s*e.transactionCount)/n:0;t.count=r,t.transactionCount=n,t.avgPrice=l}else a.set(e.type,{...e})};(e.avgPriceByType||[]).forEach(s),(t.avgPriceByType||[]).forEach(s);let l=Array.from(a.values()),o=new Map,c=e=>{if(o.has(e.floor)){let t=o.get(e.floor),r=t.count+e.count;e.rawRecords&&(t.rawRecords=[...t.rawRecords||[],...e.rawRecords]);let n=r>0?(t.avgPrice*t.count+e.avgPrice*e.count)/r:0;t.count=r,t.avgPrice=n,t.minPrice=Math.min(t.minPrice,e.minPrice),t.maxPrice=Math.max(t.maxPrice,e.maxPrice),e.maxPrice>t.maxPrice&&(t.maxPriceProject=e.maxPriceProject,t.maxPriceUnit=e.maxPriceUnit,t.maxPriceFloor=e.maxPriceFloor),e.minPrice<t.minPrice&&(t.minPriceProject=e.minPriceProject,t.minPriceUnit=e.minPriceUnit,t.minPriceFloor=e.minPriceFloor)}else o.set(e.floor,{...e,rawRecords:e.rawRecords?[...e.rawRecords]:[]})};return(e.rampPlanePriceByFloor||[]).forEach(c),(t.rampPlanePriceByFloor||[]).forEach(c),{parkingRatio:i,avgPriceByType:l,rampPlanePriceByFloor:Array.from(o.values())}}(t.parkingAnalysis,e.parkingAnalysis),t.salesVelocityAnalysis=function(e,t){if(!t)return e;let r=Array.from(new Set([...e.allRoomTypes||[],...t.allRoomTypes||[]])),n={};return["monthly","quarterly","yearly","weekly"].forEach(r=>{let i=e[r]||{},a=t[r]||{},s={};new Set([...Object.keys(i),...Object.keys(a)]).forEach(e=>{let t=i[e]||{},r=a[e]||{},n=new Set([...Object.keys(t),...Object.keys(r)]),l={};n.forEach(e=>{let n=t[e],i=r[e];if(n&&i){let t=n.count+i.count,r=n.priceSum+i.priceSum,a=n.areaSum+i.areaSum;l[e]={count:t,priceSum:r,areaSum:a,avgPrice:a>0?r/a:0}}else n?l[e]={...n}:i&&(l[e]={...i})}),s[e]=l}),n[r]=s}),{allRoomTypes:r,...n}}(t.salesVelocityAnalysis,e.salesVelocityAnalysis),n=t.priceGridAnalysis,t.priceGridAnalysis=(l=e.priceGridAnalysis)?{projectNames:[...n.projectNames||[],...l.projectNames||[]],byProject:{...n.byProject||{},...l.byProject||{}}}:n,t.areaDistributionAnalysis=function(e,t){if(!t)return e;if(!e)return t;let r={...e};return Object.keys(t).forEach(e=>{r[e]?r[e]=[...r[e],...t[e]]:r[e]=[...t[e]]}),r}(t.areaDistributionAnalysis,e.areaDistributionAnalysis),t):JSON.parse(JSON.stringify(e)):t,y++}if(console.log("Aggregation complete. Total Transaction Details:",b?.transactionDetails?.length),0===y){if(e.projectNames.length>0)throw Error("這段時間 這個建案查詢不到資料");throw Error("無法取得任何縣市的分析數據")}if(y<c.length){let e=c.length-y;d(`注意：有 ${e} 個縣市的資料載入失敗，分析結果可能不完整。`)}u(b)}catch(e){console.error("Analysis failed:",e),d(e.message||"無法取得分析數據，請稍後再試。")}finally{o(!1)}},[e]);return{loading:l,error:c,analysisData:x,handleAnalyze:m,setError:d,setLoading:o,setAnalysisData:u}}e.s(["useAnalysisData",()=>l],14302)}]);