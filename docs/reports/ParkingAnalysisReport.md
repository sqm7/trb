# Parking Analysis Report (車位分析)

## 1. 概述
`ParkingAnalysisReport` 專注於分析車位市場的供需與價格結構。包含房車配比、車位價格分佈、坪數分析以及樓層價差分析。

## 2. 功能特點
- **房車配比 (`ParkingRatioChart`)**: 
  - 分析建案中「有購置車位」與「無車位」的交易比例。
  - 圓餅圖展示。
- **車位類型均價**: 
  - 列表展示坡道平面、機械車位等不同類型的平均價格、中位數與數量。
- **車位坪數/價格散佈圖 (`ParkingScatterChart`)**:
  - **規模分析**: X軸(車位總數) vs Y軸(平均坪數)。觀察大社區是否傾向規劃大車位。
  - **價值分析**: X軸(平均價格) vs Y軸(平均坪數)。觀測價格與坪數的相關性。
  - 支援滑鼠懸停 tooltip 顯示建案詳情。
- **坡道平面樓層價差分析**:
  - **3D 互動堆疊圖**: 可視化 B1 ~ B4+ 各樓層的均價與數量。
  - **動態統計**: 點選不同樓層組合，即時計算已選樓層的平均價、中位數與分佈區間。
  - **明細彈窗**: 點擊特定樓層可查看該樓層所有車位交易明細（支援精確匹配與模糊匹配）。

## 3. props 定義
- `data`: `AnalysisData` 物件，需包含 `parkingAnalysis` 與 `transactionDetails`。

## 4. 關鍵邏輯
- **樓層統計計算 (`calculateFloorStats`)**: 
  - 前端即時聚合所選樓層（如 B1+B2）的車位價格，計算加權平均與四分位數。
- **散佈圖數據處理**: 
  - 聚合每個建案的車位坪數與價格，生成散佈圖所需的 XY 座標點。
- **車位明細匹配**: 
  - 優先使用後端聚合的 `trustedRecords`。
  - 若無，則透過關鍵字（"B1", "地下一層"）對原始交易備註進行模糊匹配 (`Legacy Flattened Filter`)。
