(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7803],{1934:(e,t,s)=>{"use strict";s.d(t,{v:()=>i});var l=s(12115);let r=e=>{let t,s=new Set,l=(e,l)=>{let r="function"==typeof e?e(t):e;if(!Object.is(r,t)){let e=t;t=(null!=l?l:"object"!=typeof r||null===r)?r:Object.assign({},t,r),s.forEach(s=>s(t,e))}},r=()=>t,a={setState:l,getState:r,getInitialState:()=>i,subscribe:e=>(s.add(e),()=>s.delete(e))},i=t=e(l,r,a);return a},a=e=>{let t=e?r(e):r,s=e=>(function(e,t=e=>e){let s=l.useSyncExternalStore(e.subscribe,l.useCallback(()=>t(e.getState()),[e,t]),l.useCallback(()=>t(e.getInitialState()),[e,t]));return l.useDebugValue(s),s})(t,e);return Object.assign(s,t),s},i=e=>e?a(e):a},6296:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(78340).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},13545:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(78340).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},15751:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>v});var l=s(95155),r=s(12115),a=s(16385),i=s(73321),n=s(86120),c=s(14670),d=s(80723),o=s(17758),x=s(51914),m=s(6296),b=s(13545),u=s(94514),p=s(67635),h=s(51997),g=s(68459);let j=[{key:"dashboard",label:"總儀表板"},{key:"floor_plan",label:"平面圖測量"},{key:"report_builder",label:"報表編輯器"}],f=e=>{let t={};return j.forEach(s=>{let l=e?.[s.key];t[s.key]={enabled:void 0!==l,limit:null==l?"":String(l)}}),t},y=e=>{let t={};return Object.entries(e).forEach(([e,s])=>{if(!s.enabled)return;if(""===s.limit){t[e]=null;return}let l=parseInt(s.limit,10);t[e]=Number.isFinite(l)?l:null}),t},z=e=>{if(!e)return"不限";let t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleDateString()},N=e=>e&&e.split("T")[0]||"";function v(){let{isAdmin:e}=(0,n.b)(),{guard:t}=(0,c.X)("manage_plans"),s=(0,i.useRouter)(),[v,_]=(0,r.useState)([]),[k,w]=(0,r.useState)([]),[C,S]=(0,r.useState)(!0),[A,$]=(0,r.useState)(""),[M,E]=(0,r.useState)(""),[q,L]=(0,r.useState)(""),[O,I]=(0,r.useState)(""),[V,F]=(0,r.useState)(""),[D,H]=(0,r.useState)("usage"),[T,U]=(0,r.useState)(!1),[P,R]=(0,r.useState)(!1),[X,Z]=(0,r.useState)(!1),[B,G]=(0,r.useState)(!1),[J,K]=(0,r.useState)(()=>f(null)),[Q,W]=(0,r.useState)(!1),[Y,ee]=(0,r.useState)(null),[et,es]=(0,r.useState)(null),[el,er]=(0,r.useState)(""),[ea,ei]=(0,r.useState)(""),[en,ec]=(0,r.useState)(""),[ed,eo]=(0,r.useState)(""),[ex,em]=(0,r.useState)("usage"),[eb,eu]=(0,r.useState)(!1),[ep,eh]=(0,r.useState)(!1),[eg,ej]=(0,r.useState)(!1),[ef,ey]=(0,r.useState)(!1),[ez,eN]=(0,r.useState)(()=>f(null)),[ev,e_]=(0,r.useState)(!0),[ek,ew]=(0,r.useState)(!1);(0,r.useEffect)(()=>{e&&(eS(),eC())},[e]);let eC=async()=>{try{let{data:e,error:t}=await a.N.from("pricing_tiers").select("tier_code, label, min_referrals").order("min_referrals",{ascending:!0});if(t)throw t;let s=(e||[]).filter(e=>"Free"!==e.tier_code);w(s)}catch(e){console.error("Error fetching pricing tiers:",e),w([])}},eS=async()=>{S(!0);try{let{data:e,error:t}=await a.N.from("referral_codes").select("*").eq("code_type","seed").order("is_default_l1",{ascending:!1}).order("created_at",{ascending:!1});if(t)throw t;_(e||[])}catch(e){console.error("Error fetching codes:",e),alert("無法載入推薦碼列表")}finally{S(!1)}},eA=async e=>{let{data:t}=await a.N.from("referral_codes").select("id").eq("code_type","seed").eq(e,!0).limit(1),s=t?.[0]?.id??null;if(s){let{error:t}=await a.N.from("referral_codes").update({[e]:!1}).eq("code_type","seed").eq(e,!0);if(t)throw t}return s},e$=async()=>{if(!A.trim())return;W(!0);let e=null,t=null;try{let s=A.trim().toUpperCase(),{data:l}=await a.N.from("referral_codes").select("id").eq("code",s).maybeSingle();if(l){alert("此代碼已存在"),W(!1);return}X&&(e=await eA("is_default_l1")),B&&(t=await eA("is_default_l2"));let{error:r}=await a.N.from("referral_codes").insert([{code:s,code_type:"seed",is_active:!0,is_default_l1:X,is_default_l2:B,promo_tier_code:"promo"===D&&V||null,owner_id:null,valid_from:M||null,valid_until:q||null,max_uses:O?parseInt(O,10):null,feature_limits:"usage"===D?y(J):{},feature_usage:{},monthly_reset_enabled:"usage"===D&&T,daily_reset_enabled:"usage"===D&&P,last_reset_at:null}]);if(r)throw r;$(""),E(""),L(""),I(""),F(""),H("usage"),U(!1),R(!1),Z(!1),G(!1),K(f(null)),eS()}catch(s){console.error("Error creating code:",s),e&&await a.N.from("referral_codes").update({is_default_l1:!0}).eq("id",e),t&&await a.N.from("referral_codes").update({is_default_l2:!0}).eq("id",t),alert("建立失敗: "+s.message)}finally{W(!1)}},eM=async()=>{if(et){ew(!0);try{let e=null,t=null;eg&&(e=await eA("is_default_l1")),ef&&(t=await eA("is_default_l2"));let s={is_active:ev,is_default_l1:eg,is_default_l2:ef,promo_tier_code:"promo"===ex&&ed||null,valid_from:el||null,valid_until:ea||null,max_uses:en?parseInt(en,10):null,monthly_reset_enabled:"usage"===ex&&eb,daily_reset_enabled:"usage"===ex&&ep,feature_limits:"usage"===ex?y(ez):{}},{error:l}=await a.N.from("referral_codes").update(s).eq("id",et.id);if(l)throw e&&await a.N.from("referral_codes").update({is_default_l1:!0}).eq("id",e),t&&await a.N.from("referral_codes").update({is_default_l2:!0}).eq("id",t),l;es(null),eS()}catch(e){console.error("Error updating code:",e),alert("更新失敗: "+e.message)}finally{ew(!1)}}},eE=async(e,t)=>{if(confirm(`確定要刪除推薦碼 "${t}" 嗎？此操作無法復原。`))try{let{error:t}=await a.N.from("referral_codes").delete().eq("id",e);if(t)throw t;eS()}catch(e){console.error("Error deleting code:",e),alert("刪除失敗: "+e.message)}};return t||(0,l.jsxs)("div",{className:"min-h-screen bg-zinc-950 text-zinc-100 p-8",children:[(0,l.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,l.jsx)("div",{className:"flex items-center justify-between mb-8",children:(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsx)("button",{onClick:()=>s.push("/dashboard"),className:"p-2 hover:bg-zinc-900 rounded-lg transition-colors text-zinc-400 hover:text-white",children:(0,l.jsx)(d.A,{className:"h-5 w-5"})}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[(0,l.jsx)(o.A,{className:"h-6 w-6 text-amber-500"}),"推薦碼管理 (Seed Codes)"]}),(0,l.jsx)("p",{className:"text-zinc-500 text-sm mt-1",children:"管理官方種子推薦碼，供特定活動或合作使用。"})]})]})}),(0,l.jsxs)("div",{className:"bg-zinc-900/50 border border-zinc-800 rounded-xl p-6 mb-8",children:[(0,l.jsxs)("h2",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[(0,l.jsx)(x.A,{className:"h-4 w-4 text-emerald-500"}),"新增種子推薦碼"]}),(0,l.jsxs)("div",{className:"flex gap-4",children:[(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsx)("input",{type:"text",value:A,onChange:e=>$(e.target.value.toUpperCase()),placeholder:"輸入推薦碼 (例如: EVENT2026)...",className:"w-full bg-zinc-950 border border-zinc-700 rounded-lg px-4 py-2.5 text-zinc-100 placeholder:text-zinc-600 focus:outline-none focus:border-amber-500 transition-colors uppercase font-mono"})}),(0,l.jsxs)("button",{onClick:e$,disabled:Q||!A.trim(),className:"bg-emerald-600 hover:bg-emerald-500 disabled:opacity-50 disabled:cursor-not-allowed text-white px-6 py-2 rounded-lg font-medium transition-colors flex items-center gap-2",children:[Q?(0,l.jsx)(m.A,{className:"h-4 w-4 animate-spin"}):(0,l.jsx)(x.A,{className:"h-4 w-4"}),"建立"]})]}),(0,l.jsxs)("div",{className:"mt-5 grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs text-zinc-400 mb-1 block",children:"有效起日"}),(0,l.jsx)("input",{type:"date",value:M,onChange:e=>E(e.target.value),className:"w-full bg-zinc-950 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-zinc-100 focus:outline-none focus:border-amber-500 transition-colors"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs text-zinc-400 mb-1 block",children:"有效迄日"}),(0,l.jsx)("input",{type:"date",value:q,onChange:e=>L(e.target.value),className:"w-full bg-zinc-950 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-zinc-100 focus:outline-none focus:border-amber-500 transition-colors"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs text-zinc-400 mb-1 block",children:"被使用次數上限"}),(0,l.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:O,onChange:e=>{let t=e.target.value;(""===t||/^\d+$/.test(t))&&I(t)},placeholder:"不限",className:"w-full bg-zinc-950 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-zinc-100 focus:outline-none focus:border-amber-500 transition-colors"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs text-zinc-400 mb-1 block",children:"L1 預設"}),(0,l.jsx)("button",{onClick:()=>Z(e=>!e),className:`w-full px-3 py-2 rounded-lg text-sm border transition-colors ${X?"bg-sky-500/10 border-sky-500 text-sky-300":"bg-zinc-900 border-zinc-700 text-zinc-500 hover:border-zinc-600"}`,children:X?"已設定":"未設定"}),(0,l.jsx)("p",{className:"text-[10px] text-zinc-500 mt-1",children:"顯示於角色權限表與 L1 面板標籤"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs text-zinc-400 mb-1 block",children:"L2 促銷"}),(0,l.jsx)("button",{onClick:()=>G(e=>!e),className:`w-full px-3 py-2 rounded-lg text-sm border transition-colors ${B?"bg-amber-500/10 border-amber-500 text-amber-300":"bg-zinc-900 border-zinc-700 text-zinc-500 hover:border-zinc-600"}`,children:B?"已設定":"未設定"}),(0,l.jsx)("p",{className:"text-[10px] text-zinc-500 mt-1",children:"顯示於會員方案 L2 圖卡促銷標籤"})]})]}),(0,l.jsxs)("div",{className:"mt-6 flex flex-wrap items-center gap-2",children:[(0,l.jsx)("span",{className:"text-xs text-zinc-400",children:"設定模式"}),(0,l.jsxs)("div",{className:"inline-flex rounded-lg border border-zinc-800 bg-zinc-950/70 p-1",children:[(0,l.jsx)("button",{type:"button",onClick:()=>H("promo"),className:`px-3 py-1.5 text-xs rounded-md transition-colors ${"promo"===D?"bg-amber-500/20 text-amber-200":"text-zinc-500 hover:text-zinc-200"}`,children:"促銷方案"}),(0,l.jsx)("button",{type:"button",onClick:()=>H("usage"),className:`px-3 py-1.5 text-xs rounded-md transition-colors ${"usage"===D?"bg-cyan-500/20 text-cyan-200":"text-zinc-500 hover:text-zinc-200"}`,children:"功能次數"})]}),(0,l.jsx)("span",{className:"text-[10px] text-zinc-500",children:"促銷方案與功能次數只能二選一"})]}),(0,l.jsxs)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{className:"bg-zinc-950/70 border border-zinc-800 rounded-xl p-4",children:[(0,l.jsx)("div",{className:"text-sm text-white font-semibold mb-2",children:"促銷方案設定"}),(0,l.jsx)("p",{className:"text-[11px] text-zinc-500 mb-3",children:"讓使用此種子碼訂閱時直接套用指定方案（僅種子碼、Free 不可）。"}),(0,l.jsx)("label",{className:"text-xs text-zinc-400 mb-1 block",children:"促銷方案（訂閱直接套用）"}),(0,l.jsxs)("select",{value:V,onChange:e=>F(e.target.value),disabled:"promo"!==D,className:"w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-zinc-100 focus:outline-none focus:border-amber-500 transition-colors",children:[(0,l.jsx)("option",{value:"",children:"不指定"}),k.map(e=>(0,l.jsx)("option",{value:e.tier_code,children:e.label||`${e.tier_code} 方案`},e.tier_code))]}),(0,l.jsx)("p",{className:"text-[10px] text-zinc-500 mt-1",children:"僅限種子碼，Free 不可選"})]}),(0,l.jsxs)("div",{className:"bg-zinc-950/70 border border-zinc-800 rounded-xl p-4",children:[(0,l.jsx)("div",{className:"text-sm text-white font-semibold mb-2",children:"功能使用次數設定"}),(0,l.jsx)("p",{className:"text-[11px] text-zinc-500 mb-3",children:"針對總儀表板 / 平面圖測量 / 報表編輯器設定可用次數。"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs text-zinc-400 mb-1 block",children:"每月回溯"}),(0,l.jsx)("button",{type:"button",onClick:()=>U(e=>!e),disabled:"usage"!==D,className:`w-full px-3 py-2 rounded-lg text-sm border transition-colors ${T?"bg-emerald-500/10 border-emerald-500 text-emerald-300":"bg-zinc-900 border-zinc-700 text-zinc-500 hover:border-zinc-600"} ${"usage"!==D?"opacity-40 cursor-not-allowed":""}`,children:T?"已開啟":"已關閉"}),(0,l.jsx)("p",{className:"text-[10px] text-zinc-500 mt-1",children:"每月 1 日 00:00 重置"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs text-zinc-400 mb-1 block",children:"每日回溯"}),(0,l.jsx)("button",{type:"button",onClick:()=>R(e=>!e),disabled:"usage"!==D,className:`w-full px-3 py-2 rounded-lg text-sm border transition-colors ${P?"bg-emerald-500/10 border-emerald-500 text-emerald-300":"bg-zinc-900 border-zinc-700 text-zinc-500 hover:border-zinc-600"} ${"usage"!==D?"opacity-40 cursor-not-allowed":""}`,children:P?"已開啟":"已關閉"}),(0,l.jsx)("p",{className:"text-[10px] text-zinc-500 mt-1",children:"每日 00:00 重置（優先）"})]})]}),(0,l.jsx)("div",{className:"text-xs text-zinc-400 mb-2",children:"功能使用次數上限"}),(0,l.jsx)("div",{className:"grid grid-cols-1 gap-3",children:j.map(e=>{let t=J[e.key];return(0,l.jsxs)("div",{className:"bg-zinc-950/60 border border-zinc-800 rounded-lg p-3",children:[(0,l.jsxs)("label",{className:"flex items-center gap-2 text-sm text-zinc-300 mb-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:t.enabled,disabled:"usage"!==D,onChange:t=>K(s=>({...s,[e.key]:{...s[e.key],enabled:t.target.checked}})),className:"rounded border-zinc-600 bg-zinc-800 text-amber-500 focus:ring-amber-500 accent-amber-500"}),e.label]}),(0,l.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:t.limit,onChange:t=>{let s=t.target.value;(""===s||/^\d+$/.test(s))&&K(t=>({...t,[e.key]:{...t[e.key],limit:s}}))},placeholder:t.enabled?"不限":"未啟用",disabled:!t.enabled||"usage"!==D,className:"w-full bg-zinc-900/60 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-zinc-100 focus:outline-none focus:border-amber-500 transition-colors disabled:opacity-40"})]},e.key)})})]})]}),(0,l.jsxs)("p",{className:"text-xs text-zinc-500 mt-2 flex items-center gap-1",children:[(0,l.jsx)(b.A,{className:"h-3 w-3"}),"可設定有效期間、被使用次數上限與功能使用次數上限。"]}),(0,l.jsx)("p",{className:"text-[10px] text-zinc-500 mt-1",children:"建立僅透過「建立」按鈕，不支援 Enter 快速建立。"})]}),(0,l.jsxs)("div",{className:"bg-zinc-900/30 border border-zinc-800 rounded-xl overflow-hidden",children:[(0,l.jsxs)("div",{className:"px-6 py-4 border-b border-zinc-800 flex justify-between items-center",children:[(0,l.jsxs)("h3",{className:"font-semibold text-zinc-300",children:["所有種子碼 (",v.length,")"]}),C&&(0,l.jsx)(m.A,{className:"h-4 w-4 animate-spin text-zinc-500"})]}),0!==v.length||C?(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"w-full text-left text-sm",children:[(0,l.jsx)("thead",{className:"bg-zinc-900/50 text-zinc-500 border-b border-zinc-800",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"px-6 py-3 font-medium whitespace-nowrap min-w-[160px]",children:"代碼 (Code)"}),(0,l.jsx)("th",{className:"px-6 py-3 font-medium whitespace-nowrap",children:"狀態"}),(0,l.jsx)("th",{className:"px-6 py-3 font-medium whitespace-nowrap",children:"有效期間"}),(0,l.jsx)("th",{className:"px-6 py-3 font-medium whitespace-nowrap min-w-[110px]",children:"使用次數"}),(0,l.jsx)("th",{className:"px-6 py-3 font-medium whitespace-nowrap",children:"建立時間"}),(0,l.jsx)("th",{className:"px-6 py-3 font-medium whitespace-nowrap text-right",children:"操作"})]})}),(0,l.jsx)("tbody",{className:"divide-y divide-zinc-800",children:v.map(e=>(0,l.jsxs)("tr",{className:"hover:bg-zinc-900/40 transition-colors group",children:[(0,l.jsxs)("td",{className:"px-6 py-4 font-mono text-base font-medium text-white flex items-center gap-3 whitespace-nowrap min-w-[160px]",children:[e.code,e.is_default_l1&&(0,l.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded border border-sky-500/30 text-sky-300 bg-sky-500/10",children:"L1 預設"}),e.is_default_l2&&(0,l.jsx)("span",{className:"text-[10px] px-2 py-0.5 rounded border border-amber-500/30 text-amber-300 bg-amber-500/10",children:"L2 促銷"}),(0,l.jsx)("button",{onClick:()=>{var t,s;return t=e.code,s=e.id,void navigator.clipboard.writeText(t).then(()=>{ee(s),setTimeout(()=>ee(null),2e3)})},className:"text-zinc-600 hover:text-zinc-300 transition-colors",title:"複製",children:Y===e.id?(0,l.jsx)(u.A,{className:"h-3 w-3 text-emerald-500"}):(0,l.jsx)(p.A,{className:"h-3 w-3"})})]}),(0,l.jsx)("td",{className:"px-6 py-4",children:(0,l.jsx)("span",{className:`px-2 py-0.5 rounded textxs font-medium ${e.is_active?"bg-emerald-500/10 text-emerald-400 border border-emerald-500/20":"bg-red-500/10 text-red-400"}`,children:e.is_active?"Active":"Inactive"})}),(0,l.jsxs)("td",{className:"px-6 py-4 text-zinc-400 text-xs",children:[(0,l.jsxs)("div",{children:[z(e.valid_from)," ~ ",z(e.valid_until)]}),e.promo_tier_code&&(0,l.jsxs)("div",{className:"text-[10px] text-emerald-400 mt-1",children:["促銷方案：",e.promo_tier_code]}),(0,l.jsx)("div",{className:"text-[10px] text-zinc-500 mt-1",children:Object.keys(e.feature_limits||{}).length>0?`功能: ${Object.entries(e.feature_limits||{}).map(([e,t])=>{let s=j.find(t=>t.key===e)?.label||e;return`${s}${t?`(${t})`:"(不限)"}`}).join("、")}`:"功能: 未設定"}),(0,l.jsxs)("div",{className:"text-[10px] text-zinc-500 mt-1",children:["每月回溯: ",e.monthly_reset_enabled?"開啟":"關閉"]}),(0,l.jsxs)("div",{className:"text-[10px] text-zinc-500 mt-1",children:["每日回溯: ",e.daily_reset_enabled?"開啟":"關閉"]})]}),(0,l.jsxs)("td",{className:"px-6 py-4 text-zinc-400 text-xs",children:[e.used_count||0," / ",e.max_uses??"∞"]}),(0,l.jsx)("td",{className:"px-6 py-4 text-zinc-400",children:new Date(e.created_at).toLocaleDateString()}),(0,l.jsx)("td",{className:"px-6 py-4 text-right",children:(0,l.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,l.jsx)("button",{onClick:()=>{es(e),er(N(e.valid_from)),ei(N(e.valid_until)),ec(null!==e.max_uses&&void 0!==e.max_uses?String(e.max_uses):""),eo(e.promo_tier_code||""),em(e.promo_tier_code?"promo":"usage"),eu(!!e.monthly_reset_enabled),eh(!!e.daily_reset_enabled),ej(!!e.is_default_l1),ey(!!e.is_default_l2),eN(f(e.feature_limits||null)),e_(e.is_active)},className:"p-2 text-zinc-500 hover:text-amber-300 hover:bg-amber-500/10 rounded-lg transition-colors",title:"編輯",children:(0,l.jsx)(h.A,{className:"h-4 w-4"})}),(0,l.jsx)("button",{onClick:()=>eE(e.id,e.code),className:"p-2 text-zinc-500 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors",title:"刪除",children:(0,l.jsx)(g.A,{className:"h-4 w-4"})})]})})]},e.id))})]})}):(0,l.jsx)("div",{className:"p-12 text-center text-zinc-500",children:"尚無種子推薦碼"})]})]}),et&&(0,l.jsx)("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:(0,l.jsxs)("div",{className:"bg-zinc-950 border border-zinc-800 rounded-2xl w-full max-w-2xl p-6",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-white",children:"編輯推薦碼"}),(0,l.jsx)("button",{onClick:()=>es(null),className:"text-zinc-500 hover:text-white",children:(0,l.jsx)(d.A,{className:"h-4 w-4 rotate-180"})})]}),(0,l.jsxs)("div",{className:"text-sm text-zinc-400 mb-4",children:["代碼：",(0,l.jsx)("span",{className:"text-white font-mono",children:et.code})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs text-zinc-400 mb-1 block",children:"有效起日"}),(0,l.jsx)("input",{type:"date",value:el,onChange:e=>er(e.target.value),className:"w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-zinc-100 focus:outline-none focus:border-amber-500"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs text-zinc-400 mb-1 block",children:"有效迄日"}),(0,l.jsx)("input",{type:"date",value:ea,onChange:e=>ei(e.target.value),className:"w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-zinc-100 focus:outline-none focus:border-amber-500"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs text-zinc-400 mb-1 block",children:"被使用次數上限"}),(0,l.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:en,onChange:e=>{let t=e.target.value;(""===t||/^\d+$/.test(t))&&ec(t)},placeholder:"不限",className:"w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-zinc-100 focus:outline-none focus:border-amber-500"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs text-zinc-400 mb-1 block",children:"L1 預設"}),(0,l.jsx)("button",{onClick:()=>ej(e=>!e),className:`w-full px-3 py-2 rounded-lg text-sm border transition-colors ${eg?"bg-sky-500/10 border-sky-500 text-sky-300":"bg-zinc-900 border-zinc-700 text-zinc-500 hover:border-zinc-600"}`,children:eg?"已設定":"未設定"}),(0,l.jsx)("p",{className:"text-[10px] text-zinc-500 mt-1",children:"顯示於角色權限表與 L1 面板標籤"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs text-zinc-400 mb-1 block",children:"L2 促銷"}),(0,l.jsx)("button",{onClick:()=>ey(e=>!e),className:`w-full px-3 py-2 rounded-lg text-sm border transition-colors ${ef?"bg-amber-500/10 border-amber-500 text-amber-300":"bg-zinc-900 border-zinc-700 text-zinc-500 hover:border-zinc-600"}`,children:ef?"已設定":"未設定"}),(0,l.jsx)("p",{className:"text-[10px] text-zinc-500 mt-1",children:"顯示於會員方案 L2 圖卡促銷標籤"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs text-zinc-400 mb-1 block",children:"狀態"}),(0,l.jsx)("button",{onClick:()=>e_(!ev),className:`w-full px-3 py-2 rounded-lg text-sm border transition-colors ${ev?"bg-emerald-500/10 border-emerald-500 text-emerald-300":"bg-red-500/10 border-red-500 text-red-300"}`,children:ev?"Active":"Inactive"})]})]}),(0,l.jsxs)("div",{className:"mt-5 flex flex-wrap items-center gap-2",children:[(0,l.jsx)("span",{className:"text-xs text-zinc-400",children:"設定模式"}),(0,l.jsxs)("div",{className:"inline-flex rounded-lg border border-zinc-800 bg-zinc-900/60 p-1",children:[(0,l.jsx)("button",{type:"button",onClick:()=>em("promo"),className:`px-3 py-1.5 text-xs rounded-md transition-colors ${"promo"===ex?"bg-amber-500/20 text-amber-200":"text-zinc-500 hover:text-zinc-200"}`,children:"促銷方案"}),(0,l.jsx)("button",{type:"button",onClick:()=>em("usage"),className:`px-3 py-1.5 text-xs rounded-md transition-colors ${"usage"===ex?"bg-cyan-500/20 text-cyan-200":"text-zinc-500 hover:text-zinc-200"}`,children:"功能次數"})]}),(0,l.jsx)("span",{className:"text-[10px] text-zinc-500",children:"促銷方案與功能次數只能二選一"})]}),(0,l.jsxs)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{className:"bg-zinc-900/60 border border-zinc-800 rounded-xl p-4",children:[(0,l.jsx)("div",{className:"text-sm text-white font-semibold mb-2",children:"促銷方案設定"}),(0,l.jsx)("p",{className:"text-[11px] text-zinc-500 mb-3",children:"讓使用此種子碼訂閱時直接套用指定方案（僅種子碼、Free 不可）。"}),(0,l.jsx)("label",{className:"text-xs text-zinc-400 mb-1 block",children:"促銷方案（訂閱直接套用）"}),(0,l.jsxs)("select",{value:ed,onChange:e=>eo(e.target.value),disabled:"promo"!==ex,className:"w-full bg-zinc-900 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-zinc-100 focus:outline-none focus:border-amber-500",children:[(0,l.jsx)("option",{value:"",children:"不指定"}),k.map(e=>(0,l.jsx)("option",{value:e.tier_code,children:e.label||`${e.tier_code} 方案`},e.tier_code))]}),(0,l.jsx)("p",{className:"text-[10px] text-zinc-500 mt-1",children:"僅限種子碼，Free 不可選"})]}),(0,l.jsxs)("div",{className:"bg-zinc-900/60 border border-zinc-800 rounded-xl p-4",children:[(0,l.jsx)("div",{className:"text-sm text-white font-semibold mb-2",children:"功能使用次數設定"}),(0,l.jsx)("p",{className:"text-[11px] text-zinc-500 mb-3",children:"針對總儀表板 / 平面圖測量 / 報表編輯器設定可用次數。"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 mb-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs text-zinc-400 mb-1 block",children:"每月回溯"}),(0,l.jsx)("button",{type:"button",onClick:()=>eu(e=>!e),disabled:"usage"!==ex,className:`w-full px-3 py-2 rounded-lg text-sm border transition-colors ${eb?"bg-emerald-500/10 border-emerald-500 text-emerald-300":"bg-zinc-900 border-zinc-700 text-zinc-500 hover:border-zinc-600"} ${"usage"!==ex?"opacity-40 cursor-not-allowed":""}`,children:eb?"已開啟":"已關閉"}),(0,l.jsx)("p",{className:"text-[10px] text-zinc-500 mt-1",children:"每月 1 日 00:00 重置"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"text-xs text-zinc-400 mb-1 block",children:"每日回溯"}),(0,l.jsx)("button",{type:"button",onClick:()=>eh(e=>!e),disabled:"usage"!==ex,className:`w-full px-3 py-2 rounded-lg text-sm border transition-colors ${ep?"bg-emerald-500/10 border-emerald-500 text-emerald-300":"bg-zinc-900 border-zinc-700 text-zinc-500 hover:border-zinc-600"} ${"usage"!==ex?"opacity-40 cursor-not-allowed":""}`,children:ep?"已開啟":"已關閉"}),(0,l.jsx)("p",{className:"text-[10px] text-zinc-500 mt-1",children:"每日 00:00 重置（優先）"})]})]}),(0,l.jsx)("div",{className:"text-xs text-zinc-400 mb-2",children:"功能使用次數上限"}),(0,l.jsx)("div",{className:"grid grid-cols-1 gap-3",children:j.map(e=>{let t=ez[e.key];return(0,l.jsxs)("div",{className:"bg-zinc-900/50 border border-zinc-800 rounded-lg p-3",children:[(0,l.jsxs)("label",{className:"flex items-center gap-2 text-sm text-zinc-300 mb-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:t.enabled,disabled:"usage"!==ex,onChange:t=>eN(s=>({...s,[e.key]:{...s[e.key],enabled:t.target.checked}})),className:"rounded border-zinc-600 bg-zinc-800 text-amber-500 focus:ring-amber-500 accent-amber-500"}),e.label]}),(0,l.jsx)("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:t.limit,onChange:t=>{let s=t.target.value;(""===s||/^\d+$/.test(s))&&eN(t=>({...t,[e.key]:{...t[e.key],limit:s}}))},placeholder:t.enabled?"不限":"未啟用",disabled:!t.enabled||"usage"!==ex,className:"w-full bg-zinc-900/60 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-zinc-100 focus:outline-none focus:border-amber-500 disabled:opacity-40"})]},e.key)})})]})]}),(0,l.jsxs)("div",{className:"mt-6 flex justify-end gap-3",children:[(0,l.jsx)("button",{onClick:()=>es(null),className:"px-4 py-2 rounded-lg text-sm text-zinc-400 hover:text-white border border-zinc-700",children:"取消"}),(0,l.jsx)("button",{onClick:eM,disabled:ek,className:"px-4 py-2 rounded-lg text-sm text-white bg-amber-600 hover:bg-amber-500 disabled:opacity-50",children:ek?"儲存中...":"儲存"})]})]})})]})}},17758:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(78340).A)("ticket",[["path",{d:"M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z",key:"qn84l0"}],["path",{d:"M13 5v2",key:"dyzc3o"}],["path",{d:"M13 17v2",key:"1ont0d"}],["path",{d:"M13 11v2",key:"1wjjxi"}]])},38762:(e,t,s)=>{Promise.resolve().then(s.bind(s,15751))},51914:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(78340).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},51997:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(78340).A)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]])},54452:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(78340).A)("log-in",[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]])},62032:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(78340).A)("shield-alert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]])},66614:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(78340).A)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]])},67635:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(78340).A)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]])},68459:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(78340).A)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},80723:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(78340).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},94514:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});let l=(0,s(78340).A)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])}},e=>{e.O(0,[4764,5969,8962,4670,8441,3794,7358],()=>e(e.s=38762)),_N_E=e.O()}]);