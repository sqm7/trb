"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4670],{14670:(e,t,s)=>{s.d(t,{X:()=>p});var i=s(95155),r=s(12115),n=s(86120),a=s(38346),l=s(85993),c=s(39430),o=s(62032),d=s(54452),u=s(66614),m=s(80723),x=s(73321);let b={login:{title:"權限不足，請登入",description:"此頁面僅供管理者使用，請先登入後再嘗試。"},forbidden:{title:"權限不足",description:"你的帳號目前沒有存取此管理功能的權限。"}};function h({variant:e}){let t=(0,x.useRouter)();if("loading"===e)return(0,i.jsx)("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center",children:(0,i.jsx)("div",{className:"h-8 w-8 border-2 border-amber-500/30 border-t-amber-500 rounded-full animate-spin"})});let s=b[e];return(0,i.jsxs)("div",{className:"min-h-screen bg-black flex items-center justify-center p-4 relative overflow-hidden",children:[(0,i.jsx)("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-amber-500/10 rounded-full blur-[140px] pointer-events-none"}),(0,i.jsx)("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-red-500/10 rounded-full blur-[140px] pointer-events-none"}),(0,i.jsx)("div",{className:"relative z-10 max-w-md w-full",children:(0,i.jsxs)(c.P.div,{initial:{opacity:0,scale:.96},animate:{opacity:1,scale:1},transition:{duration:.5},className:"bg-zinc-900/60 backdrop-blur-xl border border-amber-500/10 rounded-3xl p-8 shadow-2xl",children:[(0,i.jsxs)(c.P.div,{className:"w-20 h-20 bg-amber-500/10 rounded-full flex items-center justify-center mx-auto mb-6 border border-amber-500/20 relative",initial:{rotate:-90,opacity:0},animate:{rotate:0,opacity:1},transition:{delay:.2,type:"spring"},children:[(0,i.jsx)(o.A,{className:"w-10 h-10 text-amber-400"}),(0,i.jsx)(c.P.div,{className:"absolute inset-0 bg-amber-500/10 rounded-full",animate:{scale:[1,1.15,1]},transition:{duration:2,repeat:1/0}})]}),(0,i.jsxs)("div",{className:"text-center space-y-3 mb-8",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold text-white tracking-tight",children:s.title}),(0,i.jsx)("p",{className:"text-zinc-400 text-sm leading-relaxed",children:s.description})]}),(0,i.jsx)("div",{className:"space-y-3",children:"login"===e?(0,i.jsxs)("button",{onClick:()=>t.push("/"),className:"w-full flex items-center justify-center gap-2 bg-amber-500 hover:bg-amber-400 text-black font-bold py-3.5 px-4 rounded-xl transition-all active:scale-[0.98]",children:[(0,i.jsx)(d.A,{className:"w-4 h-4"}),"前往登入"]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("button",{onClick:()=>t.push("/dashboard"),className:"w-full flex items-center justify-center gap-2 bg-white text-black hover:bg-zinc-200 font-bold py-3.5 px-4 rounded-xl transition-all active:scale-[0.98]",children:[(0,i.jsx)(u.A,{className:"w-4 h-4"}),"回主控台"]}),(0,i.jsxs)("button",{onClick:()=>t.back(),className:"w-full flex items-center justify-center gap-2 bg-transparent hover:bg-white/5 text-zinc-400 hover:text-white font-medium py-3.5 px-4 rounded-xl border border-white/5 hover:border-white/10 transition-all active:scale-[0.98]",children:[(0,i.jsx)(m.A,{className:"w-4 h-4"}),"回上一頁"]})]})}),(0,i.jsx)(c.P.div,{className:"mt-8 pt-6 border-t border-white/5 text-center",initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},children:(0,i.jsx)("p",{className:"text-[10px] text-zinc-600 font-mono uppercase tracking-widest",children:"Error: ADMIN_ACCESS"})})]})})]})}function p(e){let{user:t,isAdmin:s,isLoading:c}=(0,n.b)(),{role:o,isLoading:d}=(0,a.h)(),{fetchFlags:u,checkAccess:m,isLoading:x}=(0,l.T)();return(0,r.useEffect)(()=>{u()},[u]),(0,r.useMemo)(()=>c||d||x?{guard:(0,i.jsx)(h,{variant:"loading"}),isAllowed:!1}:t?s&&(!e||m(e,o).allowed)?{guard:null,isAllowed:!0}:{guard:(0,i.jsx)(h,{variant:"forbidden"}),isAllowed:!1}:{guard:(0,i.jsx)(h,{variant:"login"}),isAllowed:!1},[c,d,x,t,s,e,m,o])}},86120:(e,t,s)=>{s.d(t,{b:()=>m,i:()=>x});var i=s(95155),r=s(12115),n=s(73321),a=s(16385),l=s(39430),c=s(62032),o=s(66614),d=s(80723);function u(){let e=(0,n.useRouter)();return(0,i.jsxs)("div",{className:"min-h-screen bg-black flex items-center justify-center p-4 relative overflow-hidden",children:[(0,i.jsx)("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-red-600/10 rounded-full blur-[128px] pointer-events-none"}),(0,i.jsx)("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-amber-600/10 rounded-full blur-[128px] pointer-events-none"}),(0,i.jsx)("div",{className:"relative z-10 max-w-md w-full",children:(0,i.jsxs)(l.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5},className:"bg-zinc-900/50 backdrop-blur-xl border border-red-500/20 rounded-3xl p-8 shadow-2xl overflow-hidden",children:[(0,i.jsxs)(l.P.div,{className:"w-20 h-20 bg-red-500/10 rounded-full flex items-center justify-center mx-auto mb-6 border border-red-500/20 relative",initial:{rotate:-180,opacity:0},animate:{rotate:0,opacity:1},transition:{delay:.2,type:"spring"},children:[(0,i.jsx)(c.A,{className:"w-10 h-10 text-red-500"}),(0,i.jsx)(l.P.div,{className:"absolute inset-0 bg-red-500/20 rounded-full",animate:{scale:[1,1.2,1]},transition:{duration:2,repeat:1/0}})]}),(0,i.jsxs)("div",{className:"text-center space-y-3 mb-8",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold text-white tracking-tight",children:"Access Denied"}),(0,i.jsxs)("p",{className:"text-zinc-400 text-sm leading-relaxed",children:["權限不足。此區域僅限系統管理員訪問。",(0,i.jsx)("br",{}),"若您認為這是錯誤，請聯繫技術支援。"]})]}),(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("button",{onClick:()=>e.push("/dashboard"),className:"w-full flex items-center justify-center gap-2 bg-white text-black hover:bg-zinc-200 font-bold py-3.5 px-4 rounded-xl transition-all active:scale-[0.98]",children:[(0,i.jsx)(o.A,{className:"w-4 h-4"}),"返回主控台 (Dashboard)"]}),(0,i.jsxs)("button",{onClick:()=>e.back(),className:"w-full flex items-center justify-center gap-2 bg-transparent hover:bg-white/5 text-zinc-400 hover:text-white font-medium py-3.5 px-4 rounded-xl border border-white/5 hover:border-white/10 transition-all active:scale-[0.98]",children:[(0,i.jsx)(d.A,{className:"w-4 h-4"}),"回上一頁"]})]}),(0,i.jsx)(l.P.div,{className:"mt-8 pt-6 border-t border-white/5 text-center",initial:{opacity:0},animate:{opacity:1},transition:{delay:.8},children:(0,i.jsx)("p",{className:"text-[10px] text-zinc-600 font-mono uppercase tracking-widest",children:"Error: 403_FORBIDDEN"})})]})})]})}function m(){let[e,t]=(0,r.useState)({user:null,isAdmin:!1,permissions:{canPostAnnouncement:!1,accessibleCounties:[],isSuperAdmin:!1},isLoading:!0,error:null});return(0,r.useEffect)(()=>{let e=async()=>{try{let{data:{session:e},error:s}=await a.N.auth.getSession();if(s)throw s;if(!e?.user)return void t({user:null,isAdmin:!1,permissions:{canPostAnnouncement:!1,accessibleCounties:[],isSuperAdmin:!1},isLoading:!1,error:null});let{data:i,error:r}=await a.N.from("profiles").select("role, accessible_counties, can_post_announcement").eq("id",e.user.id).single();if(r){console.warn("Profile fetch error:",r),t({user:e.user,isAdmin:!1,permissions:{canPostAnnouncement:!1,accessibleCounties:[],isSuperAdmin:!1},isLoading:!1,error:null});return}let n=i?.role==="super_admin",l=i?.role==="admin"||n,c=n?null:i?.accessible_counties,o=!!n||i?.can_post_announcement||!1;t({user:e.user,isAdmin:l,permissions:{canPostAnnouncement:o,accessibleCounties:c,isSuperAdmin:n},isLoading:!1,error:null})}catch(e){console.error("Admin auth check error:",e),t({user:null,isAdmin:!1,permissions:{canPostAnnouncement:!1,accessibleCounties:[],isSuperAdmin:!1},isLoading:!1,error:e.message})}};e();let{data:{subscription:s}}=a.N.auth.onAuthStateChange(()=>{e()});return()=>s.unsubscribe()},[]),e}function x(e){return function(t){let{user:s,isAdmin:a,isLoading:l,error:c}=m(),o=(0,n.useRouter)();return((0,r.useEffect)(()=>{l||a||o.replace("/")},[l,a,o]),l)?(0,i.jsx)("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center space-y-4",children:[(0,i.jsx)("div",{className:"h-8 w-8 border-2 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin mx-auto"}),(0,i.jsx)("p",{className:"text-zinc-500 text-sm",children:"驗證管理員權限..."})]})}):s?a?(0,i.jsx)(e,{...t}):(0,i.jsx)(u,{}):(0,i.jsx)("div",{className:"min-h-screen bg-zinc-950 flex items-center justify-center",children:(0,i.jsxs)("div",{className:"text-center space-y-4 p-8",children:[(0,i.jsx)("div",{className:"text-4xl",children:"\uD83D\uDD12"}),(0,i.jsx)("h1",{className:"text-xl font-bold text-white",children:"請先登入"}),(0,i.jsx)("p",{className:"text-zinc-500",children:"此頁面需要登入才能訪問"}),(0,i.jsx)("button",{onClick:()=>o.push("/"),className:"bg-cyan-600 hover:bg-cyan-500 text-white px-6 py-2 rounded-lg transition-colors",children:"前往登入"})]})})}}}}]);