(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,6698,e=>{"use strict";let t;var r=e.i(25191),s=e.i(68524),i=e.i(21643);let n=e=>{let t,r=new Set,s=(e,s)=>{let i="function"==typeof e?e(t):e;if(!Object.is(i,t)){let e=t;t=(null!=s?s:"object"!=typeof i||null===i)?i:Object.assign({},t,i),r.forEach(r=>r(t,e))}},i=()=>t,n={setState:s,getState:i,getInitialState:()=>a,subscribe:e=>(r.add(e),()=>r.delete(e))},a=t=e(s,i,n);return n},a=e=>{let t=e?n(e):n,r=e=>(function(e,t=e=>e){let r=s.default.useSyncExternalStore(e.subscribe,s.default.useCallback(()=>t(e.getState()),[e,t]),s.default.useCallback(()=>t(e.getInitialState()),[e,t]));return s.default.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},l={counties:[],districts:[],transactionType:"預售交易",buildingType:"",projectNames:[],dateRange:"1y",startDate:"",endDate:"",excludeCommercial:!1,floorPremium:.3,rankingCurrentPage:1,rankingPageSize:10,currentSort:{key:"saleAmountSum",order:"desc"},currentAverageType:"arithmetic",velocityView:"monthly",velocityMetric:"count"},o=(t=e=>({...l,setCounties:t=>e({counties:t,districts:[]}),setDistricts:t=>e({districts:t}),setTransactionType:t=>e({transactionType:t}),setBuildingType:t=>e({buildingType:t}),setProjectNames:t=>e({projectNames:t}),setDateRange:(t,r,s)=>e(e=>({dateRange:t,startDate:r||e.startDate,endDate:s||e.endDate})),setCustomDate:(t,r)=>e({startDate:t,endDate:r,dateRange:"custom"}),setExcludeCommercial:t=>e({excludeCommercial:t}),setFloorPremium:t=>e({floorPremium:t}),setRankingCurrentPage:t=>e({rankingCurrentPage:t}),setRankingPageSize:t=>e({rankingPageSize:t}),setCurrentSort:t=>e({currentSort:t}),setCurrentAverageType:t=>e({currentAverageType:t}),setVelocityView:t=>e({velocityView:t}),setVelocityMetric:t=>e({velocityMetric:t}),resetFilters:()=>e(l)}))?a(t):a;var c=e.i(74614),d=e.i(91568);let x=(0,d.default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var m=e.i(5467);let u=(0,s.forwardRef)(({options:e,value:t,onChange:i,placeholder:n="Select...",maxItems:a,disabled:l=!1,className:o,onSearch:d,loading:u=!1},h)=>{let[p,f]=(0,s.useState)(""),[g,b]=(0,s.useState)(!1),j=(0,s.useRef)(null),y=(0,s.useRef)(null),N=d?e:e.filter(e=>e.label.toLowerCase().includes(p.toLowerCase()));return t.map(t=>{let r=e.find(e=>e.value===t);return r?r.label:t}),(0,s.useEffect)(()=>{let e=e=>{j.current&&!j.current.contains(e.target)&&b(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,s.useEffect)(()=>{d&&d(p)},[p,d]),(0,r.jsxs)("div",{className:(0,c.cn)("relative w-full",o),ref:j,children:[(0,r.jsxs)("div",{className:(0,c.cn)("flex items-center gap-2 bg-zinc-950/50 border border-input rounded-md px-2 py-1.5 h-[42px] overflow-x-auto custom-scrollbar cursor-text transition-all",g&&"ring-2 ring-ring ring-offset-0 border-ring",l&&"bg-zinc-900/50 cursor-not-allowed opacity-50"),onClick:()=>!l&&y.current?.focus(),children:[t.map(s=>{let n=e.find(e=>e.value===s),a=n?n.label:s;return(0,r.jsxs)("span",{className:"bg-violet-500/20 text-violet-200 border border-violet-500/30 text-xs rounded-full px-2 py-0.5 flex items-center gap-1 animate-in fade-in zoom-in-95 duration-100 whitespace-nowrap shrink-0",children:[a,!l&&(0,r.jsx)(x,{size:12,className:"cursor-pointer hover:text-white transition-colors",onClick:e=>{e.stopPropagation(),i(t.filter(e=>e!==s))}})]},s)}),(0,r.jsx)("input",{ref:y,type:"text",value:p,onChange:e=>f(e.target.value),onFocus:()=>b(!0),onKeyDown:e=>{"Backspace"===e.key&&""===p&&t.length>0&&i(t.slice(0,-1))},placeholder:0===t.length?n:"",className:(0,c.cn)("bg-transparent outline-none flex-grow min-w-[60px] text-zinc-100 placeholder:text-zinc-500 text-sm",l&&"cursor-not-allowed"),disabled:l})]}),g&&!l&&(0,r.jsx)("div",{className:"absolute z-50 w-full mt-1 bg-zinc-900 border border-zinc-700 rounded-md shadow-xl max-h-60 overflow-y-auto custom-scrollbar animate-in fade-in slide-in-from-top-2 duration-100",children:u?(0,r.jsx)("div",{className:"p-2 text-center text-zinc-500 text-sm",children:"Loading..."}):0===N.length?(0,r.jsx)("div",{className:"p-2 text-center text-zinc-500 text-sm",children:"No options found"}):N.map((e,n)=>{if(!e)return null;let l=0===n||e.group!==N[n-1]?.group;return(0,r.jsxs)(s.default.Fragment,{children:[l&&e.group&&(0,r.jsx)("div",{className:"px-2 py-1 bg-zinc-800/50 text-xs font-semibold text-zinc-400 sticky top-0 backdrop-blur-sm z-10",children:e.group}),(0,r.jsxs)("div",{className:(0,c.cn)("px-3 py-2 cursor-pointer text-sm flex items-start justify-between hover:bg-zinc-800 transition-colors",t.includes(e.value)&&"bg-violet-500/10 text-violet-400"),onClick:()=>(e=>{if(t.includes(e))i(t.filter(t=>t!==e));else{if(a&&t.length>=a)return;i([...t,e])}f("")})(e.value),children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{className:"font-medium",children:e.label}),e.details&&(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-0.5",children:[(e.details.county||e.details.district)&&(0,r.jsxs)("span",{className:"text-xs text-zinc-500 bg-zinc-800/80 px-1.5 rounded border border-zinc-700",children:[e.details.county,e.details.district]}),e.details.date&&(0,r.jsx)("span",{className:"text-xs text-zinc-600 font-mono",children:e.details.date.substring(0,7)})]})]}),t.includes(e.value)&&(0,r.jsx)(m.Check,{size:16,className:"mt-1"})]})]},e.value)})})]})});u.displayName="MultiSelect";var h=e.i(78841);let p=s.forwardRef(({className:e,children:t,...s},i)=>(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("select",{className:(0,c.cn)("flex h-10 w-full appearance-none rounded-md border border-input bg-zinc-950/50 px-3 py-2 text-sm text-zinc-100 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 pr-8",e),ref:i,...s,children:t}),(0,r.jsx)(h.ChevronDown,{className:"absolute right-3 top-2.5 h-4 w-4 opacity-50 pointer-events-none"})]}));p.displayName="Select";var f=e.i(14897),g=e.i(42217);let b=(0,d.default)("chart-line",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"m19 9-5 5-4-4-3 3",key:"2osh9i"}]]),j=(0,d.default)("file-down",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]]),y=(0,d.default)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);e.i(20585);let N="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp4Ym1iYmZyemJ0dXVleXNpY29jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA2ODg5ODksImV4cCI6MjA2NjI2NDk4OX0.1IUynv5eK1xF_3pb-oasqaTrPvbeAOC4Sc1oykPBy4M",v="https://zxbmbbfrzbtuueysicoc.supabase.co/functions/v1",w={QUERY_DATA:`${v}/query-data`,SUB_DATA:`${v}/query-sub-data`,PROJECT_NAMES:`${v}/query-names`,RANKING_ANALYSIS:`${v}/analyze-project-ranking`,GENERATE_SHARE_LINK:`${v}/generate-share-link`},z={臺北市:["中正區","大同區","中山區","松山區","大安區","萬華區","信義區","士林區","北投區","內湖區","南港區","文山區"],新北市:["板橋區","三重區","中和區","永和區","新莊區","新店區","樹林區","鶯歌區","三峽區","淡水區","汐止區","瑞芳區","土城區","蘆洲區","五股區","泰山區","林口區","深坑區","石碇區","坪林區","三芝區","石門區","八里區","平溪區","雙溪區","貢寮區","金山區","萬里區","烏來區"],桃園市:["桃園區","中壢區","大溪區","楊梅區","蘆竹區","大園區","龜山區","八德區","龍潭區","平鎮區","新屋區","觀音區","復興區"],臺中市:["中區","東區","南區","西區","北區","北屯區","西屯區","南屯區","太平區","大里區","霧峰區","烏日區","豐原區","后里區","石岡區","東勢區","和平區","新社區","潭子區","大雅區","神岡區","大肚區","沙鹿區","龍井區","梧棲區","清水區","大甲區","外埔區","大安區"],臺南市:["中西區","東區","南區","北區","安平區","安南區","永康區","歸仁區","新化區","左鎮區","玉井區","楠西區","南化區","仁德區","關廟區","龍崎區","官田區","麻豆區","佳里區","西港區","七股區","將軍區","學甲區","北門區","新營區","後壁區","白河區","東山區","六甲區","下營區","柳營區","鹽水區","善化區","大內區","山上區","新市區","安定區"],高雄市:["新興區","前金區","苓雅區","鹽埕區","鼓山區","旗津區","前鎮區","三民區","楠梓區","小港區","左營區","仁武區","大社區","岡山區","路竹區","阿蓮區","田寮區","燕巢區","橋頭區","梓官區","彌陀區","永安區","湖內區","鳳山區","大寮區","林園區","鳥松區","大樹區","旗山區","美濃區","六龜區","內門區","杉林區","甲仙區","桃源區","那瑪夏區","茂林區","茄萣區"],基隆市:["仁愛區","信義區","中正區","中山區","安樂區","暖暖區","七堵區"],新竹市:["東區","北區","香山區"],嘉義市:["東區","西區"],宜蘭縣:["宜蘭市","羅東鎮","蘇澳鎮","頭城鎮","礁溪鄉","壯圍鄉","員山鄉","冬山鄉","五結鄉","三星鄉","大同鄉","南澳鄉"],新竹縣:["竹北市","竹東鎮","新埔鎮","關西鎮","湖口鄉","新豐鄉","芎林鄉","橫山鄉","北埔鄉","寶山鄉","峨眉鄉","尖石鄉","五峰鄉"],苗栗縣:["苗栗市","苑裡鎮","通霄鎮","竹南鎮","頭份鎮","後龍鎮","卓蘭鎮","大湖鄉","公館鄉","銅鑼鄉","南庄鄉","頭屋鄉","三義鄉","西湖鄉","造橋鄉","三灣鄉","獅潭鄉","泰安鄉"],彰化縣:["彰化市","鹿港鎮","和美鎮","線西鄉","伸港鄉","福興鄉","秀水鄉","花壇鄉","芬園鄉","員林鎮","溪湖鎮","田中鎮","大村鄉","埔鹽鄉","埔心鄉","永靖鄉","社頭鄉","二水鄉","北斗鎮","二林鎮","田尾鄉","埤頭鄉","芳苑鄉","大城鄉","竹塘鄉","溪州鄉"],南投縣:["南投市","埔里鎮","草屯鎮","竹山鎮","集集鎮","名間鄉","鹿谷鄉","中寮鄉","魚池鄉","國姓鄉","水里鄉","信義鄉","仁愛鄉"],雲林縣:["斗六市","斗南鎮","虎尾鎮","西螺鎮","土庫鎮","北港鎮","古坑鄉","大埤鄉","莿桐鄉","林內鄉","二崙鄉","崙背鄉","麥寮鄉","東勢鄉","褒忠鄉","台西鄉","元長鄉","四湖鄉","口湖鄉","水林鄉"],嘉義縣:["太保市","朴子市","布袋鎮","大林鎮","民雄鄉","溪口鄉","新港鄉","六腳鄉","東石鄉","義竹鄉","鹿草鄉","水上鄉","中埔鄉","竹崎鄉","梅山鄉","番路鄉","大埔鄉","阿里山鄉"],屏東縣:["屏東市","潮州鎮","東港鎮","恆春鎮","萬丹鄉","長治鄉","麟洛鄉","九如鄉","里港鄉","鹽埔鄉","高樹鄉","萬巒鄉","內埔鄉","竹田鄉","新埤鄉","枋寮鄉","新園鄉","崁頂鄉","林邊鄉","南州鄉","佳冬鄉","琉球鄉","車城鄉","滿州鄉","枋山鄉","霧台鄉","瑪家鄉","泰武鄉","來義鄉","春日鄉","獅子鄉","牡丹鄉","三地門鄉"],花蓮縣:["花蓮市","鳳林鎮","玉里鎮","新城鄉","吉安鄉","壽豐鄉","光復鄉","豐濱鄉","瑞穗鄉","富里鄉","秀林鄉","萬榮鄉","卓溪鄉"],臺東縣:["臺東市","成功鎮","關山鎮","卑南鄉","鹿野鄉","池上鄉","東河鄉","長濱鄉","太麻里鄉","大武鄉","綠島鄉","海端鄉","延平鄉","金峰鄉","達仁鄉","蘭嶼鄉"],澎湖縣:["馬公市","湖西鄉","白沙鄉","西嶼鄉","望安鄉","七美鄉"],金門縣:["金城鎮","金湖鎮","金沙鄉","金寧鄉","烈嶼鄉","烏坵鄉"],連江縣:["南竿鄉","北竿鄉","莒光鄉","東引鄉"]},P={臺北市:"A",新北市:"F",桃園市:"H",臺中市:"B",臺南市:"D",高雄市:"E",基隆市:"C",新竹市:"O",嘉義市:"I",新竹縣:"J",苗栗縣:"K",彰化縣:"N",南投縣:"M",雲林縣:"P",嘉義縣:"Q",屏東縣:"T",宜蘭縣:"G",花蓮縣:"U",臺東縣:"V",澎湖縣:"X",金門縣:"W",連江縣:"Z"};var k=e.i(41097);async function S(){let{data:{session:e}}=await k.supabase.auth.getSession();return{"Content-Type":"application/json",apikey:N,Authorization:`Bearer ${e?.access_token||N}`}}async function A(e){let t=await S(),r=await fetch(w.RANKING_ANALYSIS,{method:"POST",headers:t,body:JSON.stringify({filters:e})});if(!r.ok)throw Error((await r.json().catch(()=>({error:`Analysis request failed: ${r.status}`}))).error||"Analyze data failed");return r.json()}let C=async function(e,t){let r=await S(),s=await fetch(w.QUERY_DATA,{method:"POST",headers:r,body:JSON.stringify({filters:e,pagination:t})});if(!s.ok)throw Error((await s.json().catch(()=>({error:"Failed to parse server response"}))).error||"Fetch data failed");return s.json()},M=async function(e,t,r){if(!e||!t||!r)throw Error(`Insufficient parameters: ${e}, ${t}, ${r}`);let s=await S(),i=await fetch(w.SUB_DATA,{method:"POST",headers:s,body:JSON.stringify({id:e,type:t,county:r})});if(!i.ok)throw Error((await i.json().catch(()=>({error:"Failed to fetch sub data"}))).error||"Fetch sub data failed");return i.json()},F=async function(e,t,r=[]){let s=await S(),i=await fetch(w.PROJECT_NAMES,{method:"POST",headers:s,body:JSON.stringify({countyCode:e,query:t,districts:r,detailed:!0})});if(!i.ok)throw Error(`Server error: ${i.status}`);return i.json()},R=e=>{let t=new Date,r=new Date;switch(e){case"1q":r.setMonth(t.getMonth()-3);break;case"2q":r.setMonth(t.getMonth()-6);break;case"3q":r.setMonth(t.getMonth()-9);break;case"1y":r.setFullYear(t.getFullYear()-1);break;case"this_year":r=new Date(t.getFullYear(),0,1);break;case"last_2_years":r=new Date(t.getFullYear()-1,0,1);break;case"last_3_years":r=new Date(t.getFullYear()-2,0,1);break;default:return{startDate:"",endDate:""}}return{startDate:r.toISOString().split("T")[0],endDate:t.toISOString().split("T")[0]}};function I({onAnalyze:e,isLoading:t}){let{counties:i,districts:n,transactionType:a,buildingType:l,projectNames:c,dateRange:d,startDate:m,endDate:h,excludeCommercial:N,setCounties:v,setDistricts:w,setTransactionType:k,setBuildingType:S,setProjectNames:A,setDateRange:C,setCustomDate:M,setExcludeCommercial:I,resetFilters:_}=o(),[$,E]=(0,s.useState)(!1),[T,D]=(0,s.useState)([]),[L,O]=(0,s.useState)(!1),B=Object.keys(P).map(e=>({label:e,value:e})),q=s.default.useMemo(()=>0===i.length?[]:i.flatMap(e=>(z[e]||[]).map(t=>({label:t,value:t,group:e}))),[i]),Z=(0,s.useRef)(null),[V,U]=(0,s.useState)(null),W=(0,s.useCallback)(async e=>{if(!e||e.length<1||0===i.length)return void D([]);O(!0),U(null);try{let t=i.map(async t=>{let r=P[t],s=n.filter(e=>z[t]?.includes(e));return F(r,e,s).then(e=>{let r=[];return Array.isArray(e)?r=e:e&&e.data&&Array.isArray(e.data)?r=e.data:e&&e.names&&Array.isArray(e.names)&&(r=e.names),r.map(e=>{let r="string"==typeof e,s=r?e:e.name||e.建案名稱||String(e);return{label:s,value:s,group:t,details:r?void 0:{county:t,district:e.district||e.行政區,date:e.earliestDate||e.交易日}}})}).catch(e=>(console.error(`Failed to fetch projects for ${t}:`,e),[]))}),r=(await Promise.all(t)).flat(),s=Array.from(new Map(r.map(e=>[e.value,e])).values());D(s),0===s.length&&e.length>=2&&console.log(`No projects found for query "${e}" in counties: ${i.join(", ")}`)}catch(e){console.error("Project search error:",e),U("搜尋失敗，請稍後再試")}finally{O(!1)}},[i,n]),H=(0,s.useCallback)(e=>{Z.current&&clearTimeout(Z.current),Z.current=setTimeout(()=>{W(e)},300)},[W]);return(0,s.useEffect)(()=>()=>{Z.current&&clearTimeout(Z.current)},[]),(0,r.jsxs)("div",{className:"p-4 md:p-6 glass-card rounded-xl shadow-lg animate-in fade-in slide-in-from-top-4 duration-500",children:[(0,r.jsxs)("div",{className:"flex md:hidden items-center justify-between mb-4",children:[(0,r.jsxs)("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[(0,r.jsx)(y,{className:"h-5 w-5 text-violet-500"}),"篩選條件"]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>E(!$),className:"border-zinc-700 text-zinc-300",children:[$?(0,r.jsx)(x,{className:"h-4 w-4"}):(0,r.jsx)(y,{className:"h-4 w-4"}),$?"收起":"展開"]}),(0,r.jsx)(f.Button,{variant:"default",size:"sm",className:"bg-violet-600 text-white",disabled:0===i.length||t,onClick:e,children:t?"...":"分析"})]})]}),(0,r.jsxs)("div",{className:`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-7 gap-4 items-end ${$?"block":"hidden md:grid"}`,children:[(0,r.jsxs)("div",{className:"xl:col-span-1",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-zinc-300",children:"縣市"}),i.length>3&&(0,r.jsxs)("span",{className:"text-xs text-amber-500 font-normal animate-in fade-in",children:["(已選 ",i.length,"/6)"]})]}),i.length>0&&(0,r.jsx)("button",{onClick:()=>v([]),className:"text-xs text-cyan-400 hover:text-cyan-300",children:"清除"})]}),(0,r.jsx)(u,{options:B,value:i,onChange:e=>{e.length>6||v(e)},placeholder:"請選擇縣市...",maxItems:6})]}),(0,r.jsxs)("div",{className:"xl:col-span-1",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-zinc-300",children:"行政區"}),n.length>0&&(0,r.jsx)("button",{onClick:()=>w([]),className:"text-xs text-cyan-400 hover:text-cyan-300",children:"清除"})]}),(0,r.jsx)(u,{options:q,value:n,onChange:e=>{w(e)},placeholder:i.length>0?"請選擇行政區...":"請先選縣市",disabled:0===i.length})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"交易類型"}),(0,r.jsxs)(p,{value:a,onChange:e=>k(e.target.value),children:[(0,r.jsx)("option",{value:"預售交易",children:"預售交易"}),(0,r.jsx)("option",{value:"中古交易",disabled:!0,children:"中古交易 (開發中)"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"建物型態"}),(0,r.jsxs)(p,{value:l,onChange:e=>S(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"全部"}),(0,r.jsx)("option",{value:"住宅大樓(11層含以上有電梯)",children:"住宅大樓"}),(0,r.jsx)("option",{value:"華廈(10層含以下有電梯)",children:"華廈"}),(0,r.jsx)("option",{value:"公寓(5層含以下無電梯)",children:"公寓"}),(0,r.jsx)("option",{value:"套房(1房(1廳)1衛)",children:"套房"}),(0,r.jsx)("option",{value:"透天厝",children:"透天厝"}),(0,r.jsx)("option",{value:"店面(店鋪)",children:"店面"}),(0,r.jsx)("option",{value:"辦公商業大樓",children:"辦公商業大樓"}),(0,r.jsx)("option",{value:"工廠",children:"工廠/廠辦"}),(0,r.jsx)("option",{value:"其他",children:"其他"})]})]}),(0,r.jsxs)("div",{className:"xl:col-span-3",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-zinc-300",children:"建案名稱"}),c.length>0&&(0,r.jsx)("button",{onClick:()=>A([]),className:"text-xs text-cyan-400 hover:text-cyan-300",children:"清除"})]}),(0,r.jsx)(u,{options:T,value:c,onChange:A,placeholder:i.length>0?"輸入建案名稱搜尋...":"請先選縣市",disabled:0===i.length,onSearch:H,loading:L}),V&&(0,r.jsx)("span",{className:"text-xs text-red-400 mt-1",children:V})]}),(0,r.jsxs)("div",{className:"xl:col-span-3 sm:col-span-2 grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"快捷時間"}),(0,r.jsxs)(p,{value:d,onChange:e=>{let t=e.target.value;if("custom"===t)C("custom",m,h);else{let{startDate:e,endDate:r}=R(t);e&&r&&C(t,e,r)}},children:[(0,r.jsx)("option",{value:"custom",children:"自訂範圍"}),(0,r.jsx)("option",{value:"1q",children:"近一季 (3個月)"}),(0,r.jsx)("option",{value:"2q",children:"近兩季 (6個月)"}),(0,r.jsx)("option",{value:"3q",children:"近三季 (9個月)"}),(0,r.jsx)("option",{value:"1y",children:"近一年 (12個月)"}),(0,r.jsx)("option",{value:"this_year",children:"今年以來"}),(0,r.jsx)("option",{value:"last_2_years",children:"去年＋今年"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-zinc-300 mb-1",children:"起始日期"}),(0,r.jsx)(g.Input,{type:"date",value:m,onChange:e=>M(e.target.value,h),className:"bg-zinc-950/50 border-input text-zinc-100"})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-zinc-300",children:"結束日期"}),(0,r.jsx)("button",{onClick:()=>{M(m,new Date().toISOString().split("T")[0])},className:"text-xs text-cyan-400 hover:text-cyan-300",children:"抓取今日"})]}),(0,r.jsx)(g.Input,{type:"date",value:h,onChange:e=>M(m,e.target.value),className:"bg-zinc-950/50 border-input text-zinc-100"})]})]}),(0,r.jsxs)("div",{className:"xl:col-span-4 sm:col-span-2 flex items-end gap-4 justify-end mt-4 md:mt-0",children:[(0,r.jsx)("div",{className:"flex items-center gap-4 mr-auto",children:(0,r.jsxs)("label",{className:"flex items-center gap-2 text-sm text-zinc-300 cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:N,onChange:e=>I(e.target.checked),className:"rounded border-zinc-600 bg-zinc-800 text-violet-500 focus:ring-violet-500 accent-violet-500"}),(0,r.jsx)("span",{children:"排除商辦/店面"})]})}),(0,r.jsxs)(f.Button,{variant:"outline",className:"hidden xl:flex bg-green-900/20 border-green-500/30 text-green-400 hover:bg-green-900/40 hover:text-green-300",children:[(0,r.jsx)(j,{className:"mr-2 h-4 w-4"}),"輸出報表"]}),(0,r.jsxs)(f.Button,{variant:"default",className:"bg-violet-600 hover:bg-violet-500 text-white min-w-[120px] hidden md:flex",disabled:0===i.length||t,onClick:e,children:[t?(0,r.jsx)("span",{className:"animate-spin mr-2",children:"⟳"}):(0,r.jsx)(b,{className:"mr-2 h-4 w-4"}),t?"分析中...":"分析報表"]})]})]})]})}let _=s.forwardRef(({className:e,...t},s)=>(0,r.jsx)("div",{ref:s,className:(0,c.cn)("glass-panel rounded-xl text-card-foreground",e),...t}));function $({title:e,description:t,children:s,action:i,className:n}){return(0,r.jsxs)(_,{className:(0,c.cn)("bg-zinc-900/50 border-white/5 overflow-hidden",n),children:[(0,r.jsxs)("div",{className:"p-6 border-b border-white/5 flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-white tracking-tight",children:e}),t&&(0,r.jsx)("p",{className:"text-sm text-zinc-400",children:t})]}),i&&(0,r.jsx)("div",{className:"flex items-center gap-2",children:i})]}),(0,r.jsx)("div",{className:"p-6",children:s})]})}_.displayName="Card",s.forwardRef(({className:e,...t},s)=>(0,r.jsx)("div",{ref:s,className:(0,c.cn)("flex flex-col space-y-1.5 p-6",e),...t})).displayName="CardHeader",s.forwardRef(({className:e,...t},s)=>(0,r.jsx)("h3",{ref:s,className:(0,c.cn)("text-lg font-semibold leading-none tracking-tight text-white",e),...t})).displayName="CardTitle",s.forwardRef(({className:e,...t},s)=>(0,r.jsx)("p",{ref:s,className:(0,c.cn)("text-sm text-zinc-400",e),...t})).displayName="CardDescription",s.forwardRef(({className:e,...t},s)=>(0,r.jsx)("div",{ref:s,className:(0,c.cn)("p-6 pt-0",e),...t})).displayName="CardContent",s.forwardRef(({className:e,...t},s)=>(0,r.jsx)("div",{ref:s,className:(0,c.cn)("flex items-center p-6 pt-0",e),...t})).displayName="CardFooter";let E=(0,e.i(67123).default)(()=>e.A(31593),{loadableGenerated:{modules:[94861]},ssr:!1});function T({type:e,series:t,options:s,height:i=350,title:n,description:a,className:l,loading:o}){let c={chart:{background:"transparent",toolbar:{show:!1}},theme:{mode:"dark",palette:"palette1"},dataLabels:{enabled:!1},grid:{borderColor:"#374151",strokeDashArray:4},xaxis:{labels:{style:{colors:"#9ca3af"}},axisBorder:{color:"#4b5563"},axisTicks:{color:"#4b5563"}},yaxis:{labels:{style:{colors:"#9ca3af"}}},tooltip:{theme:"dark",style:{fontSize:"12px"},x:{show:!0}}},d={...c,...s,chart:{...c.chart,...s.chart}};return(0,r.jsxs)(_,{className:`p-4 ${l}`,children:[(n||a)&&(0,r.jsxs)("div",{className:"mb-4",children:[n&&(0,r.jsx)("h3",{className:"text-lg font-bold text-white mb-1",children:n}),a&&(0,r.jsx)("p",{className:"text-sm text-gray-400",children:a})]}),o?(0,r.jsx)("div",{className:"flex items-center justify-center",style:{height:i},children:(0,r.jsx)("div",{className:"loader"})}):(0,r.jsx)(E,{options:d,series:t,type:e,height:i,width:"100%"})]})}function D({data:e,sortKey:t}){let i=(0,s.useMemo)(()=>["averagePrice","minPrice","maxPrice","medianPrice","avgParkingPrice"].includes(t)?"bar":"treemap",[t]),n=(0,s.useMemo)(()=>({averagePrice:{title:"建案平均單價排行",unit:"萬/坪"},minPrice:{title:"建案最低單價排行",unit:"萬/坪"},maxPrice:{title:"建案最高單價排行",unit:"萬/坪"},medianPrice:{title:"建案單價中位數排行",unit:"萬/坪"},avgParkingPrice:{title:"車位平均單價排行",unit:"萬"},saleAmountSum:{title:"建案銷售總額佔比",unit:"萬",yLabel:"銷售總額"},houseAreaSum:{title:"建案房屋面積佔比",unit:"坪",yLabel:"房屋面積"},transactionCount:{title:"建案交易筆數佔比",unit:"筆",yLabel:"資料筆數"}})[t]||{title:"建案分析圖表",unit:"",yLabel:"數值"},[t]),a=(0,s.useMemo)(()=>{if(!e||0===e.length)return[];if("bar"!==i)return e.reduce((e,r)=>e+(r[t]||0),0),[{name:n.yLabel||n.unit,data:e.map(e=>({x:e.projectName,y:parseFloat((e[t]||0).toFixed(2))}))}];{let r=[...e].filter(e=>e[t]>0).sort((e,r)=>e[t]-r[t]).slice(-30);return[{name:n.unit,data:r.map(e=>({x:e.projectName,y:parseFloat((e[t]||0).toFixed(2))}))}]}},[e,t,i,n]),l=(0,s.useMemo)(()=>{let r={title:{text:n.title,align:"center",style:{fontSize:"16px",fontWeight:600,color:"#e5e7eb"}},tooltip:{theme:"dark",y:{formatter:e=>`${e.toLocaleString()} ${n.unit}`}}};if("bar"===i){let e=Math.max(400,32*(a[0]?.data.length||0));return{...r,chart:{type:"bar",height:e,toolbar:{show:!0},animations:{enabled:!1}},plotOptions:{bar:{horizontal:!0,barHeight:"70%",borderRadius:6,distributed:!0}},dataLabels:{enabled:!0,textAnchor:"start",offsetX:0,formatter:e=>e.toLocaleString(),style:{colors:["#fff"]}},xaxis:{labels:{style:{colors:"#9ca3af"}}},yaxis:{labels:{maxWidth:200,style:{colors:"#e5e7eb",fontSize:"12px",fontWeight:500}}},legend:{show:!1}}}{let s=e.reduce((e,r)=>e+(r[t]||0),0);return{...r,chart:{type:"treemap",height:450,toolbar:{show:!0}},plotOptions:{treemap:{distributed:!0,enableShades:!1,colorScale:{ranges:[{from:0,to:.1*s,color:"#06b6d4"},{from:.1*s,to:.3*s,color:"#3b82f6"},{from:.3*s,to:.6*s,color:"#8b5cf6"},{from:.6*s,to:1/0,color:"#d946ef"}]}}},dataLabels:{enabled:!0,style:{fontSize:"11px",fontWeight:500,colors:["#fff"]},formatter:function(e,t){return e},offsetY:-2},tooltip:{...r.tooltip,y:{formatter:e=>{let t=s>0?(e/s*100).toFixed(2):0;return`${e.toLocaleString()} ${n.unit} (${t}%)`}}}}}},[i,a,n,e,t]);return e&&0!==e.length?(0,r.jsx)(T,{type:"bar"===i?"bar":"treemap",series:a,options:l,height:"bar"===i?l.chart?.height||400:450,className:"w-full"}):(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無排名資料可顯示"})}var L=e.i(67690);let O=(0,d.default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),B=(0,d.default)("arrow-up-down",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]),q=(0,d.default)("arrow-up",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),Z=(0,d.default)("arrow-down",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);function V({data:e}){let{rankingCurrentPage:t,rankingPageSize:i,setRankingCurrentPage:n,setRankingPageSize:a}=o(),[l,c]=(0,s.useState)(1),[d,x]=(0,s.useState)(10),[m,u]=(0,s.useState)({key:"saleAmountSum",order:"desc"});if(!e)return null;let{coreMetrics:h,projectRanking:p}=e,g=(0,s.useMemo)(()=>p?[...p].sort((e,t)=>{let r=e[m.key]||0,s=t[m.key]||0;return"desc"===m.order?s-r:r-s}):[],[p,m]),b=Math.ceil(g.length/d),j=g.slice((l-1)*d,l*d),y=({title:e,value:t,unit:s})=>(0,r.jsxs)("div",{className:"bg-zinc-800/50 rounded-lg p-4 border border-white/5 flex flex-col items-center justify-center text-center",children:[(0,r.jsx)("div",{className:"text-zinc-400 text-sm mb-1",children:e}),(0,r.jsxs)("div",{className:"flex items-baseline gap-1",children:[(0,r.jsx)("span",{className:"text-2xl font-bold text-white",children:t}),(0,r.jsx)("span",{className:"text-xs text-zinc-500",children:s})]})]});return(0,r.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,r.jsx)(y,{title:"市場去化總銷售金額",value:h.totalSaleAmount.toLocaleString(),unit:"萬"}),(0,r.jsx)(y,{title:"總銷去化房屋坪數",value:h.totalHouseArea.toLocaleString(void 0,{maximumFractionDigits:2}),unit:"坪"}),(0,r.jsx)(y,{title:"總平均單價",value:h.overallAveragePrice.toLocaleString(void 0,{maximumFractionDigits:2}),unit:"萬/坪"}),(0,r.jsx)(y,{title:"總交易筆數",value:h.transactionCount.toLocaleString(),unit:"筆"})]}),(0,r.jsx)($,{title:"建案分析圖表",description:"根據排序指標顯示前30名建案",children:(0,r.jsx)(D,{data:g,sortKey:m.key})}),(0,r.jsxs)($,{title:"區域建案排行列表",description:"點擊表頭可進行排序",children:[(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,r.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3 cursor-default",children:"排名"}),(0,r.jsx)("th",{className:"px-4 py-3 cursor-default",children:"建案名稱"}),[{key:"saleAmountSum",label:(0,r.jsxs)(r.Fragment,{children:["交易",(0,r.jsx)("br",{}),"總價(萬)"]})},{key:"houseAreaSum",label:(0,r.jsxs)(r.Fragment,{children:["房屋",(0,r.jsx)("br",{}),"面積(坪)"]})},{key:"transactionCount",label:(0,r.jsxs)(r.Fragment,{children:["資料",(0,r.jsx)("br",{}),"筆數"]})},{key:"marketShare",label:(0,r.jsxs)(r.Fragment,{children:["市場",(0,r.jsx)("br",{}),"佔比(%)"]})},{key:"averagePrice",label:(0,r.jsxs)(r.Fragment,{children:["平均",(0,r.jsx)("br",{}),"單價"]})},{key:"minPrice",label:(0,r.jsxs)(r.Fragment,{children:["最低",(0,r.jsx)("br",{}),"單價"]})},{key:"maxPrice",label:(0,r.jsxs)(r.Fragment,{children:["最高",(0,r.jsx)("br",{}),"單價"]})},{key:"medianPrice",label:(0,r.jsxs)(r.Fragment,{children:["中位數",(0,r.jsx)("br",{}),"單價"]})},{key:"avgParkingPrice",label:(0,r.jsxs)(r.Fragment,{children:["車位",(0,r.jsx)("br",{}),"均價"]})}].map(e=>(0,r.jsx)("th",{className:"px-3 py-3 cursor-pointer hover:text-white transition-colors text-center whitespace-nowrap",onClick:()=>{var t;return t=e.key,void u(e=>({key:t,order:e.key===t&&"desc"===e.order?"asc":"desc"}))},children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-0.5",children:[(0,r.jsx)("span",{className:"leading-tight",children:e.label}),m.key===e.key?"desc"===m.order?(0,r.jsx)(Z,{size:12,className:"text-violet-500"}):(0,r.jsx)(q,{size:12,className:"text-violet-500"}):(0,r.jsx)(B,{size:12,className:"opacity-30"})]})},e.key))]})}),(0,r.jsx)("tbody",{className:"divide-y divide-white/5",children:j.map((e,t)=>(0,r.jsxs)("tr",{className:"hover:bg-zinc-800/50 transition-colors",children:[(0,r.jsx)("td",{className:"px-4 py-3 text-zinc-500 font-mono",children:(l-1)*d+t+1}),(0,r.jsx)("td",{className:"px-4 py-3",children:(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{className:"font-medium text-white",children:e.projectName}),(0,r.jsxs)("div",{className:"flex gap-1 mt-1",children:[e.county&&(0,r.jsx)("span",{className:"text-[10px] bg-zinc-800 text-zinc-400 px-1 py-0.5 rounded",children:e.county}),e.district&&(0,r.jsx)("span",{className:"text-[10px] bg-zinc-800 text-zinc-400 px-1 py-0.5 rounded",children:e.district})]})]})}),(0,r.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.saleAmountSum.toLocaleString()}),(0,r.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.houseAreaSum.toLocaleString()}),(0,r.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.transactionCount.toLocaleString()}),(0,r.jsxs)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:[e.marketShare.toFixed(2),"%"]}),(0,r.jsx)("td",{className:"px-4 py-3 font-mono text-cyan-400",children:e.averagePrice.toFixed(1)}),(0,r.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.minPrice.toFixed(1)}),(0,r.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.maxPrice.toFixed(1)}),(0,r.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-400",children:e.medianPrice.toFixed(1)}),(0,r.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-400",children:e.avgParkingPrice>0?e.avgParkingPrice.toLocaleString():"-"})]},t))}),(0,r.jsx)("tfoot",{className:"bg-zinc-900/80 font-bold border-t-2 border-zinc-700",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{colSpan:2,className:"px-4 py-3 text-center text-zinc-300",children:"總計"}),(0,r.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:h.totalSaleAmount.toLocaleString()}),(0,r.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:h.totalHouseArea.toLocaleString()}),(0,r.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:h.transactionCount.toLocaleString()}),(0,r.jsx)("td",{colSpan:6})]})})]})}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-4 border-t border-white/5 pt-4",children:[(0,r.jsxs)("div",{className:"text-sm text-zinc-500",children:["顯示 ",(l-1)*d+1," 到 ",Math.min(l*d,g.length)," 筆，共 ",g.length," 筆"]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(f.Button,{variant:"outline",size:"sm",onClick:()=>c(e=>Math.max(1,e-1)),disabled:1===l,children:(0,r.jsx)(L.ChevronLeft,{size:16})}),(0,r.jsxs)("span",{className:"text-sm text-zinc-300",children:["Page ",l," of ",b]}),(0,r.jsx)(f.Button,{variant:"outline",size:"sm",onClick:()=>c(e=>Math.min(b,e+1)),disabled:l===b,children:(0,r.jsx)(O,{size:16})})]})]})]})]})}function U({data:e}){let t=(0,s.useMemo)(()=>e&&0!==e.length?[{name:"總價分佈",type:"boxPlot",data:e.map(e=>{let t=[e.minPrice,e.q1Price,e.medianPrice,e.q3Price,e.maxPrice];return t.some(e=>"number"!=typeof e||isNaN(e))?null:{x:null!==e.bathrooms?`${e.roomType}-${e.bathrooms}衛`:e.roomType,y:t.map(e=>Math.round(e))}}).filter(Boolean)}]:[],[e]),i=(0,s.useMemo)(()=>{if(0===t.length||0===t[0].data.length)return{};let e=t[0].data.flatMap(e=>e.y),r=Math.min(...e),s=Math.max(...e),i=s-r,n=0===i?Math.max(.1*r,100):.1*i;return{chart:{type:"boxPlot",height:450,background:"transparent",toolbar:{show:!0},foreColor:"#e5e7eb"},title:{text:"各房型總價帶分佈箱型圖",align:"center",style:{fontSize:"16px",color:"#e5e7eb"}},plotOptions:{boxPlot:{colors:{upper:"#06b6d4",lower:"#8b5cf6"},stroke:{colors:["#e5e7eb"]}}},xaxis:{type:"category",labels:{style:{colors:"#9ca3af"},rotate:-45,offsetY:5}},yaxis:{min:Math.max(0,r-n),max:s+n,title:{text:"房屋總價 (萬)",style:{color:"#9ca3af"}},labels:{formatter:e=>`${Math.round(e).toLocaleString()} 萬`,style:{colors:"#9ca3af"}}},tooltip:{custom:function({seriesIndex:e,dataPointIndex:t,w:r}){let s=r.globals.initialSeries[e].data[t].y;if(Array.isArray(s)&&5===s.length){let[e,t,r,i,n]=s;return`
                    <div class="apexcharts-tooltip-box" style="background: #18181b; border: 1px solid #27272a; padding: 8px 12px; border-radius: 8px; color: #fff;">
                        <div><strong>最高總價:</strong> ${n.toLocaleString()} 萬</div>
                        <div><strong>3/4位總價:</strong> ${i.toLocaleString()} 萬</div>
                        <div><strong>中位數總價:</strong> ${r.toLocaleString()} 萬</div>
                        <div><strong>1/4位總價:</strong> ${t.toLocaleString()} 萬</div>
                        <div><strong>最低總價:</strong> ${e.toLocaleString()} 萬</div>
                    </div>
                `}return""}}}},[t]);return e&&0!==e.length&&0!==t.length?(0,r.jsx)(T,{type:"boxPlot",series:t,options:i,height:450,className:"w-full"}):(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無總價帶資料可顯示"})}function W({roomTypes:e,locations:t,crossTable:i,dimension:n}){let a=(0,s.useMemo)(()=>e&&t&&i?e.map(e=>{let r=t.map(t=>i[e]&&i[e][t]||0);return{name:e,data:r}}):[],[e,t,i]),l=(0,s.useMemo)(()=>{let e="county"===n?"縣市":"行政區";return{chart:{type:"bar",height:Math.max(350,35*t.length),stacked:!0,background:"transparent",toolbar:{show:!0},foreColor:"#e5e7eb"},plotOptions:{bar:{horizontal:!0,barHeight:"70%",borderRadius:4,dataLabels:{total:{enabled:!0,offsetX:5,style:{fontSize:"11px",fontWeight:600,color:"#e5e7eb"},formatter:function(e,t){let r=t.w.config.series,s=t.dataPointIndex,i=0;return r.forEach(e=>{i+=e.data[s]||0}),i>0?i.toString():""}}}}},colors:["#06b6d4","#8b5cf6","#10b981","#f59e0b","#ef4444","#3b82f6","#ec4899","#84cc16","#6366f1","#14b8a6"],dataLabels:{enabled:!1},xaxis:{categories:t,title:{text:"成交筆數",style:{color:"#9ca3af"}},labels:{style:{colors:"#9ca3af"}}},yaxis:{title:{text:e,style:{color:"#9ca3af"}},labels:{style:{colors:"#e5e7eb"},maxWidth:150}},legend:{position:"top",horizontalAlign:"center",labels:{colors:"#e5e7eb"}},tooltip:{theme:"dark",y:{formatter:function(e){return e+" 筆"}}},grid:{borderColor:"#374151"},title:{text:`各${e}房型成交筆數分佈`,align:"center",style:{fontSize:"16px",color:"#e5e7eb"}}}},[t,n]);return a&&0!==a.length?(0,r.jsx)(T,{type:"bar",series:a,options:l,height:l.chart?.height||350,className:"w-full"}):(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無區域分佈資料"})}function H({isOpen:e,onClose:t,title:i,projects:n}){let a=(0,s.useRef)(null);return((0,s.useEffect)(()=>{let r=e=>{"Escape"===e.key&&t()};return e&&(document.addEventListener("keydown",r),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",r),document.body.style.overflow=""}},[e,t]),e)?(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",onClick:e=>{a.current&&!a.current.contains(e.target)&&t()},children:(0,r.jsxs)("div",{ref:a,className:"bg-zinc-900 border border-white/10 rounded-xl shadow-2xl max-w-md w-full mx-4 animate-in zoom-in-95 duration-200",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-5 py-4 border-b border-white/5",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-white",children:i}),(0,r.jsx)("button",{onClick:t,className:"p-1 rounded hover:bg-white/10 text-zinc-400 hover:text-white transition-colors",children:(0,r.jsx)(x,{size:20})})]}),(0,r.jsx)("div",{className:"px-5 py-4 max-h-[50vh] overflow-y-auto scrollbar-thin scrollbar-thumb-zinc-700",children:0===n.length?(0,r.jsx)("p",{className:"text-zinc-500 text-center py-4",children:"無建案資料"}):(0,r.jsx)("ul",{className:"space-y-2",children:n.map((e,t)=>(0,r.jsx)("li",{className:(0,c.cn)("px-3 py-2 rounded-lg text-zinc-200 text-sm","bg-zinc-800/50 hover:bg-zinc-800 transition-colors","border border-white/5"),children:e},t))})}),(0,r.jsxs)("div",{className:"px-5 py-3 border-t border-white/5 flex justify-between items-center",children:[(0,r.jsxs)("span",{className:"text-xs text-zinc-500",children:["共 ",n.length," 個建案"]}),(0,r.jsx)("button",{onClick:t,className:"px-4 py-1.5 text-sm rounded-lg bg-zinc-800 text-zinc-300 hover:bg-zinc-700 transition-colors",children:"關閉"})]})]})}):null}function K({data:e}){let t=["套房","1房","2房","3房","4房","毛胚"],[i,n]=(0,s.useState)(t),[a,l]=(0,s.useState)("district"),[o,d]=(0,s.useState)(!1),[x,m]=(0,s.useState)(""),[u,h]=(0,s.useState)([]),[p,f]=(0,s.useState)(null),g=(0,s.useMemo)(()=>{if(!e?.transactionDetails)return[];let t=new Set;return e.transactionDetails.forEach(e=>{e["縣市"]&&t.add(e["縣市"])}),Array.from(t).sort()},[e?.transactionDetails]);s.default.useEffect(()=>{!p&&g.length>0&&f(g[0])},[g,p]);let b=(e,t,r)=>{m(`${e}${null!==t?` / ${t}衛`:""} 建案組成`),h(r),d(!0)};if(!e||!e.details)return null;let{details:j,locationCrossTable:y,allDistricts:N,transactionDetails:v}=e,w=(0,s.useMemo)(()=>Array.from(new Set(j.map(e=>e.roomType))),[j]),z=(0,s.useMemo)(()=>j.filter(e=>i.includes(e.roomType)),[j,i]),[P,k]=(0,s.useState)(!0),S=(0,s.useMemo)(()=>{let e=j.filter(e=>i.includes(e.roomType));if(!P)return e;let r=new Map;return e.forEach(e=>{let t=e.roomType;r.has(t)||r.set(t,{...e,bathrooms:null,projectNames:e.projectNames?[...e.projectNames]:[],count:0,avgPrice:0});let s=r.get(t),i=s.avgPrice*s.count,n=e.avgPrice*e.count,a=s.count+e.count;s.count=a,s.avgPrice=a>0?(i+n)/a:0,s.minPrice=Math.min(s.minPrice,e.minPrice),s.maxPrice=Math.max(s.maxPrice,e.maxPrice);let l=s.count-e.count,o=e.count;if(s.medianPrice=(s.medianPrice*l+e.medianPrice*o)/a,s.q1Price=(s.q1Price*l+e.q1Price*o)/a,s.q3Price=(s.q3Price*l+e.q3Price*o)/a,e.projectNames){let t=new Set([...s.projectNames||[],...e.projectNames]);s.projectNames=Array.from(t)}}),Array.from(r.values()).sort((e,r)=>t.indexOf(e.roomType)-t.indexOf(r.roomType))},[j,i,P,t]),A=(0,s.useMemo)(()=>{if("county"===a&&v){let e={},t=new Set;v.forEach(r=>{let s=r["房型"]||r.roomType||r["戶型"];if(!s||"其他"===s){let e=Number(r["房數"]);s=!isNaN(e)&&e>0?`${e}房`:"其他"}let i="string"==typeof s?s.replace(/\s+/g,""):s;("number"==typeof i||"string"==typeof i&&/^\d+$/.test(i))&&(i=`${i}房`);let n=r["縣市"]||"未知";e[i]||(e[i]={}),e[i][n]=(e[i][n]||0)+1,t.add(n)});let r=Array.from(t).sort(),s={},n=0;r.forEach(e=>s[e]=0);let a=i.map(t=>{let i=e[t]||{},a=0,l=r.map(e=>{let t=i[e]||0;return a+=t,s[e]+=t,t});return n+=a,{roomType:t,cells:l,rowTotal:a}});return{locations:r,rows:a,locationTotals:s,grandTotal:n}}if("district"===a){let e={},t=new Set;if(v)v.forEach(r=>{let s=r["房型"]||r.roomType||r["戶型"];if(!s||"其他"===s){let e=Number(r["房數"]);s=!isNaN(e)&&e>0?`${e}房`:"其他"}let i="string"==typeof s?s.replace(/\s+/g,""):s;("number"==typeof i||"string"==typeof i&&/^\d+$/.test(i))&&(i=`${i}房`);let n=r["行政區"]||"未知",a=r["縣市"]||"未知";p&&a!==p||(e[i]||(e[i]={}),e[i][n]=(e[i][n]||0)+1,t.add(n))});else if(y){let r=new Set;i.forEach(e=>{let t=y[e];t&&Object.keys(t).forEach(e=>r.add(e))}),r.forEach(e=>t.add(e)),i.forEach(t=>{let r=y[t];r&&(e[t]=r)})}let r=Array.from(t).sort(),s={},n=0;r.forEach(e=>s[e]=0);let a=i.map(t=>{let i=e[t]||{},a=0,l=r.map(e=>{let t=i[e]||0;return a+=t,s[e]+=t,t});return n+=a,{roomType:t,cells:l,rowTotal:a}});return{locations:r,rows:a,locationTotals:s,grandTotal:n}}return null},[y,v,i,a,p]),[C,M]=(0,s.useState)(new Set);return(0,r.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:w.map(e=>(0,r.jsx)("button",{onClick:()=>{n(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},className:(0,c.cn)("px-3 py-1 rounded-full text-xs font-medium transition-colors border",i.includes(e)?"bg-violet-500/20 border-violet-500 text-violet-200":"bg-zinc-800/50 border-zinc-700 text-zinc-500 hover:bg-zinc-800"),children:e},e))}),(0,r.jsxs)("div",{className:"flex items-center gap-2 bg-zinc-800/50 p-1 rounded-lg border border-white/5",children:[(0,r.jsx)("span",{className:"text-xs text-zinc-400 pl-2",children:"表格顯示:"}),(0,r.jsx)("button",{onClick:()=>k(!P),className:(0,c.cn)("px-3 py-1 text-xs font-medium rounded-md transition-all",P?"bg-violet-500 text-white shadow-sm":"text-zinc-400 hover:text-white hover:bg-zinc-700"),children:P?"依房型合併":"顯示衛浴細節"})]})]}),(0,r.jsx)($,{title:"各房型總價帶分佈箱型圖",description:"顯示各房型總價的中位數與四分位距",children:(0,r.jsx)(U,{data:S})}),(0,r.jsx)($,{title:"總價帶詳細數據",description:P?"各房型合併統計 (點擊「全部」可展開細節)":"各房型詳細價格統計",children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,r.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3",children:"房型"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"衛浴"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"建案數"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"筆數"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"平均總價"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"最低總價"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"1/4位總價"}),(0,r.jsx)("th",{className:"px-4 py-3 text-violet-400",children:"中位數總價"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"3/4位總價"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"最高總價"})]})}),(0,r.jsxs)("tbody",{className:"divide-y divide-white/5",children:[S.map((e,t)=>{let i,n=P&&null===e.bathrooms,a=C.has(e.roomType),l=n&&a?(i=e.roomType,j.filter(e=>e.roomType===i).sort((e,t)=>(Number(e.bathrooms)||0)-(Number(t.bathrooms)||0))):[];return(0,r.jsxs)(s.default.Fragment,{children:[(0,r.jsxs)("tr",{className:(0,c.cn)("hover:bg-zinc-800/50 transition-colors",a&&"bg-zinc-800/30"),children:[(0,r.jsx)("td",{className:"px-4 py-3 font-medium text-white",children:e.roomType}),(0,r.jsx)("td",{className:"px-4 py-3 text-zinc-400",children:n?(0,r.jsxs)("button",{onClick:()=>{var t;return t=e.roomType,void M(e=>{let r=new Set(e);return r.has(t)?r.delete(t):r.add(t),r})},className:"flex items-center gap-1 text-xs px-2 py-0.5 rounded bg-zinc-700/50 hover:bg-zinc-600 hover:text-white transition-colors cursor-pointer",children:[(0,r.jsx)("span",{children:"全部"}),(0,r.jsx)("span",{className:(0,c.cn)("transform transition-transform text-[10px]",a?"rotate-180":""),children:"▼"})]}):e.bathrooms??"-"}),(0,r.jsx)("td",{className:"px-4 py-3",children:e.projectNames&&e.projectNames.length>0?(0,r.jsxs)("button",{onClick:()=>b(e.roomType,e.bathrooms,e.projectNames||[]),className:"px-2 py-1 text-xs font-medium rounded-full bg-violet-500/20 border border-violet-500/50 text-violet-300 hover:bg-violet-500/30 transition-colors cursor-pointer",children:[e.projectNames.length," 個建案"]}):(0,r.jsx)("span",{className:"text-zinc-500",children:"-"})}),(0,r.jsx)("td",{className:"px-4 py-3 text-zinc-300",children:e.count.toLocaleString()}),(0,r.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-300",children:e.avgPrice.toLocaleString(void 0,{maximumFractionDigits:0})}),(0,r.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.minPrice.toLocaleString()}),(0,r.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.q1Price.toLocaleString()}),(0,r.jsx)("td",{className:"px-4 py-3 font-mono text-violet-400 font-bold",children:e.medianPrice.toLocaleString()}),(0,r.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.q3Price.toLocaleString()}),(0,r.jsx)("td",{className:"px-4 py-3 font-mono text-zinc-500",children:e.maxPrice.toLocaleString()})]}),l.map((e,s)=>(0,r.jsxs)("tr",{className:"bg-zinc-900/50 hover:bg-zinc-900 border-l-2 border-l-violet-500/30",children:[(0,r.jsxs)("td",{className:"px-4 py-2 font-medium text-zinc-500 text-xs pl-8",children:["↳ ",e.roomType]}),(0,r.jsxs)("td",{className:"px-4 py-2 text-zinc-400 text-xs",children:[e.bathrooms," 衛"]}),(0,r.jsx)("td",{className:"px-4 py-2",children:e.projectNames&&e.projectNames.length>0?(0,r.jsxs)("button",{onClick:()=>b(e.roomType,e.bathrooms,e.projectNames||[]),className:"text-xs text-zinc-500 hover:text-zinc-300 underline decoration-zinc-700",children:[e.projectNames.length," 建案"]}):"-"}),(0,r.jsx)("td",{className:"px-4 py-2 text-zinc-500 text-xs",children:e.count.toLocaleString()}),(0,r.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-500 text-xs",children:e.avgPrice.toLocaleString(void 0,{maximumFractionDigits:0})}),(0,r.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.minPrice.toLocaleString()}),(0,r.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.q1Price.toLocaleString()}),(0,r.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-500 text-xs font-medium",children:e.medianPrice.toLocaleString()}),(0,r.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.q3Price.toLocaleString()}),(0,r.jsx)("td",{className:"px-4 py-2 font-mono text-zinc-600 text-xs",children:e.maxPrice.toLocaleString()})]},`${t}-sub-${s}`))]},t)}),0===z.length&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:10,className:"p-8 text-center text-zinc-500",children:"請選擇房型顯示數據"})})]})]})})}),(A||v)&&(0,r.jsxs)("div",{className:"space-y-6 pt-4 border-t border-white/5",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-white",children:"區域分組交叉分析"}),(0,r.jsxs)("div",{className:"flex bg-zinc-800 rounded-md p-0.5",children:[(0,r.jsx)("button",{onClick:()=>l("district"),className:(0,c.cn)("px-2 py-1 text-xs rounded transition-colors","district"===a?"bg-zinc-700 text-white":"text-zinc-400 hover:text-white"),children:"行政區"}),(0,r.jsx)("button",{onClick:()=>l("county"),className:(0,c.cn)("px-2 py-1 text-xs rounded transition-colors","county"===a?"bg-zinc-700 text-white":"text-zinc-400 hover:text-white"),children:"縣市"})]})]}),"district"===a&&g.length>1&&(0,r.jsxs)("div",{className:"flex items-center gap-2 pb-2",children:[(0,r.jsx)("span",{className:"text-sm text-zinc-500",children:"顯示縣市:"}),(0,r.jsx)("div",{className:"flex gap-1 bg-zinc-900 p-1 rounded-lg",children:g.map(e=>(0,r.jsx)("button",{onClick:()=>f(e),className:(0,c.cn)("px-3 py-1 text-xs font-medium rounded-md transition-all",p===e?"bg-violet-500/20 text-violet-300 shadow-sm border border-violet-500/50":"text-zinc-500 hover:text-zinc-300 hover:bg-zinc-800"),children:e},e))})]}),(0,r.jsx)($,{title:"區域房型成交分佈",description:"各區域不同房型的成交數量熱力分佈",children:(0,r.jsx)("div",{className:"overflow-x-auto",children:A?(0,r.jsxs)("table",{className:"w-full text-sm text-left border-collapse",children:[(0,r.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 font-semibold",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-3 py-2 sticky left-0 bg-zinc-900 z-10 border-r border-white/5",children:"房型"}),A.locations.map(e=>(0,r.jsx)("th",{className:"px-3 py-2 text-center min-w-[80px]",children:e},e)),(0,r.jsx)("th",{className:"px-3 py-2 text-center border-l border-white/5 bg-zinc-900 font-bold text-white",children:"總計"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-white/5",children:A.rows.map((e,t)=>(0,r.jsxs)("tr",{className:"hover:bg-zinc-800/30",children:[(0,r.jsx)("td",{className:"px-3 py-2 font-medium text-zinc-300 sticky left-0 bg-zinc-950/90 border-r border-white/5",children:e.roomType}),e.cells.map((e,t)=>{let s=e>0?Math.min(e/20,1):0,i=e>0?{backgroundColor:`rgba(6, 182, 212, ${.3*s})`}:{};return(0,r.jsx)("td",{className:"px-3 py-2 text-center text-zinc-400",style:i,children:e>0?e:"-"},t)}),(0,r.jsx)("td",{className:"px-3 py-2 text-center font-bold text-white border-l border-white/5 bg-zinc-900/50",children:e.rowTotal})]},t))}),(0,r.jsx)("tfoot",{className:"bg-zinc-900 font-bold border-t-2 border-zinc-700",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-3 py-2 sticky left-0 bg-zinc-900 border-r border-white/5 text-white",children:"總計"}),A.locations.map(e=>(0,r.jsx)("td",{className:"px-3 py-2 text-center text-white",children:A.locationTotals[e]},e)),(0,r.jsx)("td",{className:"px-3 py-2 text-center text-cyan-400 border-l border-white/5 bg-zinc-900",children:A.grandTotal})]})})]}):(0,r.jsx)("div",{className:"p-8 text-center text-zinc-500",children:"無區域分佈數據"})})}),(0,r.jsx)($,{title:"區域成交佔比圖表",children:A&&(0,r.jsx)(W,{roomTypes:i,locations:A.locations,crossTable:A.rows.reduce((e,t)=>{let r={};return A.locations.forEach((e,s)=>{r[e]=t.cells[s]}),e[t.roomType]=r,e},{}),dimension:a})})]}),(0,r.jsx)(H,{isOpen:o,onClose:()=>d(!1),title:x,projects:u})]})}function G({data:e,selectedRooms:t,metric:i}){let n=(0,s.useMemo)(()=>({count:{label:"交易筆數",unit:"筆",decimals:0},priceSum:{label:"產權總價",unit:"萬",decimals:0},areaSum:{label:"房屋坪數",unit:"坪",decimals:2}})[i],[i]),a=(0,s.useMemo)(()=>{if(!e||0===t.length)return[];let r=Object.keys(e).sort();return 0===r.length?[]:t.map(t=>({name:t,data:r.map(r=>e[r]?.[t]?.[i]||0)}))},[e,t,i]),l=(0,s.useMemo)(()=>({chart:{type:"line",height:350,background:"transparent",toolbar:{show:!0},zoom:{enabled:!1},foreColor:"#e5e7eb"},stroke:{curve:"smooth",width:2},dataLabels:{enabled:!1},xaxis:{categories:e?Object.keys(e).sort():[],labels:{style:{colors:"#9ca3af"}}},yaxis:{title:{text:n.label,style:{color:"#9ca3af"}},labels:{style:{colors:"#9ca3af"},formatter:e=>e.toLocaleString("zh-TW",{minimumFractionDigits:0,maximumFractionDigits:0})}},legend:{position:"top",horizontalAlign:"right"},tooltip:{theme:"dark",y:{formatter:e=>`${e.toLocaleString("zh-TW",{minimumFractionDigits:n.decimals,maximumFractionDigits:n.decimals})} ${n.unit}`}},grid:{borderColor:"#374151"}}),[e,n]);return e&&0!==Object.keys(e).length&&0!==t.length?(0,r.jsx)(T,{type:"line",series:a,options:l,height:350,className:"w-full"}):(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"請選擇房型以顯示銷售趨勢"})}function J({data:e,selectedRooms:t,minArea:i,maxArea:n,interval:a,onDataPointClick:l}){let o=(0,s.useMemo)(()=>[{from:0,to:0,color:"#27272a",name:"0 戶"},{from:1,to:5,color:"#facc15",name:"1-5 戶"},{from:6,to:20,color:"#fbbf24",name:"6-20 戶"},{from:21,to:50,color:"#f97316",name:"21-50 戶"},{from:51,to:1e4,color:"#dc2626",name:"> 50 戶"}],[]),{series:c,maxValue:d}=(0,s.useMemo)(()=>{if(!e||0===t.length)return{series:[],maxValue:0};let r=[];for(let e=i;e<n;e+=a)r.push(`${e.toFixed(1)}-${(e+a).toFixed(1)}`);let s=0;return{series:r.map(r=>{let[a,l]=r.split("-").map(parseFloat);return{name:r,data:t.map(t=>{let r=(e[t]||[]).filter(e=>e>=a&&e<l&&e>=i&&e<=n).length;return r>s&&(s=r),r})}}),maxValue:s}},[e,t,i,n,a]),x=(0,s.useMemo)(()=>({chart:{type:"heatmap",height:Math.max(400,22*c.length),background:"transparent",toolbar:{show:!0},foreColor:"#e5e7eb",events:{dataPointSelection:(e,r,s)=>{if(l){let{seriesIndex:e,dataPointIndex:r}=s,i=s.w.globals.seriesNames[e];l(t[r],i)}}}},plotOptions:{heatmap:{radius:0,useFillColorAsStroke:!0,enableShades:!1,colorScale:{ranges:o}}},dataLabels:{enabled:!0,style:{colors:[({value:e})=>0===e?"transparent":"#e5e7eb"]}},xaxis:{type:"category",categories:t},title:{text:"房型面積分佈熱力圖",align:"center",style:{color:"#e5e7eb",fontSize:"16px"}},grid:{borderColor:"#374151"},tooltip:{theme:"dark",y:{formatter:e=>0===e?"無成交紀錄":`${e} 戶`}}}),[c,t,o,l]);return e&&0!==c.length?(0,r.jsx)(T,{type:"heatmap",series:c,options:x,height:x.chart?.height||400,className:"w-full"}):(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無面積分佈資料"})}function Y({data:e,viewType:t,selectedRooms:i}){if(!e||0===Object.keys(e).length)return(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無銷售速度資料"});let n=Object.keys(e).sort().reverse();return(0,r.jsx)("div",{className:"overflow-x-auto max-h-[600px] border border-white/5 rounded-lg",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left border-collapse",children:[(0,r.jsxs)("thead",{className:"bg-zinc-900 sticky top-0 z-20 shadow-md",children:[(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{rowSpan:2,className:"px-4 py-3 sticky left-0 z-30 bg-zinc-900 border-r border-white/10 font-medium text-white min-w-[120px]",children:"時間"}),i.map(e=>(0,r.jsx)("th",{colSpan:3,className:"px-2 py-2 text-center border-l border-white/5 text-zinc-300 font-medium bg-zinc-900/90",children:e},e)),(0,r.jsx)("th",{colSpan:3,className:"px-2 py-2 text-center border-l-2 border-white/10 text-cyan-400 font-bold bg-zinc-900/90",children:"總計"})]}),(0,r.jsxs)("tr",{children:[i.map((e,t)=>(0,r.jsxs)(s.default.Fragment,{children:[(0,r.jsx)("th",{className:(0,c.cn)("px-2 py-2 text-center text-xs text-zinc-500 font-normal bg-zinc-900/90 border-b border-white/10",0===t&&"border-l border-white/5"),children:"筆數"}),(0,r.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-500 font-normal bg-zinc-900/90 border-b border-white/10",children:"總價(萬)"}),(0,r.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-500 font-normal bg-zinc-900/90 border-b border-white/10",children:"坪數"})]},e)),(0,r.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-400 font-medium bg-zinc-900/90 border-b border-white/10 border-l-2 border-white/10",children:"筆數"}),(0,r.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-400 font-medium bg-zinc-900/90 border-b border-white/10",children:"總價(萬)"}),(0,r.jsx)("th",{className:"px-2 py-2 text-center text-xs text-zinc-400 font-medium bg-zinc-900/90 border-b border-white/10",children:"坪數"})]})]}),(0,r.jsx)("tbody",{className:"divide-y divide-white/5",children:n.map(n=>{let a=e[n]||{},l={count:0,priceSum:0,areaSum:0};return(0,r.jsxs)("tr",{className:"hover:bg-zinc-800/30 transition-colors",children:[(0,r.jsx)("td",{className:"px-4 py-2 sticky left-0 z-10 bg-zinc-950/90 border-r border-white/10 font-mono text-zinc-400",children:("weekly"===t&&n.includes("-W"),n)}),i.map((e,t)=>{let i=a[e];return i?(l.count+=i.count,l.priceSum+=i.priceSum,l.areaSum+=i.areaSum,(0,r.jsxs)(s.default.Fragment,{children:[(0,r.jsx)("td",{className:(0,c.cn)("px-2 py-2 text-center text-zinc-300",0===t&&"border-l border-white/5"),children:i.count>0?i.count.toLocaleString():"-"}),(0,r.jsx)("td",{className:"px-2 py-2 text-center text-zinc-500 font-mono text-xs",children:i.count>0?(0,c.formatNumber)(i.priceSum,0):"-"}),(0,r.jsx)("td",{className:"px-2 py-2 text-center text-zinc-500 font-mono text-xs",children:i.count>0?(0,c.formatNumber)(i.areaSum,1):"-"})]},e)):(0,r.jsxs)(s.default.Fragment,{children:[(0,r.jsx)("td",{className:(0,c.cn)("px-2 py-2 text-center text-zinc-700",0===t&&"border-l border-white/5"),children:"-"}),(0,r.jsx)("td",{className:"px-2 py-2 text-center text-zinc-700",children:"-"}),(0,r.jsx)("td",{className:"px-2 py-2 text-center text-zinc-700",children:"-"})]},e)}),(0,r.jsx)("td",{className:"px-2 py-2 text-center font-bold text-cyan-400 border-l-2 border-white/10",children:l.count.toLocaleString()}),(0,r.jsx)("td",{className:"px-2 py-2 text-center font-bold text-zinc-300 font-mono text-xs",children:(0,c.formatNumber)(l.priceSum,0)}),(0,r.jsx)("td",{className:"px-2 py-2 text-center font-bold text-zinc-300 font-mono text-xs",children:(0,c.formatNumber)(l.areaSum,1)})]},n)})})]})})}function X({data:e}){let[t,i]=(0,s.useState)("monthly"),[n,a]=(0,s.useState)("count"),[l,o]=(0,s.useState)(15),[d,x]=(0,s.useState)(65),[m,u]=(0,s.useState)(5),[h,f]=(0,s.useState)([]),[b,j]=(0,s.useState)(null),[y,N]=(0,s.useState)(["2房","3房"]);if(!e)return null;let{salesVelocityAnalysis:v,areaDistributionAnalysis:w}=e,z=e=>Math.round(e)+"萬";return(0,r.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,r.jsxs)("div",{className:"p-4 bg-zinc-900/30 border border-white/5 rounded-lg flex flex-wrap gap-2 items-center sticky top-0 z-40 backdrop-blur-md",children:[(0,r.jsx)("span",{className:"text-zinc-400 text-sm mr-2",children:"分析房型:"}),["套房","1房","2房","3房","4房","毛胚","店舖","辦公/事務所"].map(e=>(0,r.jsx)("button",{onClick:()=>{N(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},className:(0,c.cn)("px-3 py-1 text-xs rounded-full border transition-colors",y.includes(e)?"bg-violet-500/20 border-violet-500 text-violet-200":"bg-zinc-800 border-zinc-700 text-zinc-500 hover:bg-zinc-700"),children:e},e))]}),(0,r.jsx)($,{title:"房型銷售速度與趨勢分析",action:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(p,{value:t,onChange:e=>i(e.target.value),className:"w-[100px] h-8 text-xs bg-zinc-950/50",children:[(0,r.jsx)("option",{value:"weekly",children:"每週"}),(0,r.jsx)("option",{value:"monthly",children:"每月"}),(0,r.jsx)("option",{value:"quarterly",children:"每季"}),(0,r.jsx)("option",{value:"yearly",children:"每年"})]}),(0,r.jsxs)(p,{value:n,onChange:e=>a(e.target.value),className:"w-[100px] h-8 text-xs bg-zinc-950/50",children:[(0,r.jsx)("option",{value:"count",children:"交易筆數"}),(0,r.jsx)("option",{value:"priceSum",children:"總銷金額"}),(0,r.jsx)("option",{value:"areaSum",children:"總銷坪數"})]})]}),children:(0,r.jsx)(G,{data:v?.[t],selectedRooms:y,metric:n})}),(0,r.jsx)($,{title:"銷售速度明細表",description:"各時間段詳細銷售數據統計",children:(0,r.jsx)(Y,{data:v?.[t],viewType:t,selectedRooms:y})}),(0,r.jsxs)($,{title:"房型面積分佈熱力圖",description:"分析不同坪數區間的產品供給與去化分佈",action:(0,r.jsxs)("div",{className:"flex gap-2 items-center text-zinc-400 text-xs",children:[(0,r.jsx)("span",{children:"範圍:"}),(0,r.jsx)(g.Input,{type:"number",value:l,onChange:e=>o(Number(e.target.value)),className:"w-16 h-8 text-xs bg-zinc-950/50"}),(0,r.jsx)("span",{children:"-"}),(0,r.jsx)(g.Input,{type:"number",value:d,onChange:e=>x(Number(e.target.value)),className:"w-16 h-8 text-xs bg-zinc-950/50"}),(0,r.jsx)("span",{className:"ml-2",children:"級距:"}),(0,r.jsx)(g.Input,{type:"number",value:m,onChange:e=>u(Number(e.target.value)),className:"w-16 h-8 text-xs bg-zinc-950/50"})]}),children:[(0,r.jsx)(J,{data:w,selectedRooms:y,minArea:l,maxArea:d,interval:m,onDataPointClick:(t,r)=>{let s=0,i=1/0;if(r.includes("<"))i=parseFloat(r.replace("<","").trim());else if(r.includes(">"))s=parseFloat(r.replace(">","").trim());else if(r.includes("-")){let e=r.split("-");s=parseFloat(e[0].trim()),i=parseFloat(e[1].trim())}let n=(e.transactionDetails||[]).filter(e=>{let r=function(e){let t=e=>e?String(e).normalize("NFKC").toUpperCase().replace(/\s+/g,""):"",r=t(e["建物型態"]||e.buildingType),s=t(e["主要用途"]||e.mainPurpose),i=t(e["戶別"]||e.unit),n=void 0!==e["房數"]?e["房數"]:e.rooms,a=void 0!==e["房屋面積(坪)"]?parseFloat(e["房屋面積(坪)"]):parseFloat(e.houseArea||0);if(r.includes("住宅大樓")&&i.includes("S")||i.includes("店舖")||i.includes("店面")||i.includes("店鋪"))return"店舖";if(i.includes("事務所")||i.includes("辦公"))return"辦公/事務所";if(r.includes("店舖")||r.includes("店面")||r.includes("店鋪"))return"店舖";if(r.includes("工廠")||r.includes("倉庫")||r.includes("廠辦"))return"廠辦/工廠";if(s.includes("商業")||r.includes("辦公")||r.includes("事務所"))return"辦公/事務所";if((r.includes("住宅大樓")||r.includes("華廈"))&&0===n){if(a>35)return"毛胚";if(a<=35)return"套房"}if("number"==typeof n&&!isNaN(n)){if(1===n)return"1房";if(2===n)return"2房";if(3===n)return"3房";if(4===n)return"4房";if(n>=5)return"5房以上"}return"其他"}(e),n=parseFloat(e["房屋面積(坪)"]||e.houseArea||(e["建物移轉平方公尺"]?.3025*e["建物移移轉平方公尺"]:0));if(!r)return!1;let a=n>=s&&n<i;return r===t&&a});console.log(`[Heatmap Click] Room: ${t}, Range: ${s}-${i}, Found: ${n.length}`);let a={};n.forEach(e=>{let t=e["建案名稱"]||e.projectName||"未知建案";a[t]||(a[t]=[]),a[t].push(e)});let l=Object.entries(a).map(([e,t])=>{let r=t.map(e=>e["產權總價"]||e["交易總價(萬)"]||e.totalPrice||0).filter(e=>e>0).sort((e,t)=>e-t),s=t.map(e=>e["房屋單價"]||e["房屋單價(萬)"]||e.unitPrice||0).filter(e=>e>0),i=0;if(r.length>0){let e=Math.floor(r.length/2);i=r.length%2!=0?r[e]:(r[e-1]+r[e])/2}return{projectName:e,count:t.length,priceRange:{min:r.length>0?r[0]:0,max:r.length>0?r[r.length-1]:0,median:i},unitPriceRange:{min:s.length>0?Math.min(...s):0,max:s.length>0?Math.max(...s):0},transactions:t.sort((e,t)=>{let r=e["房屋單價"]||e["房屋單價(萬)"]||e.unitPrice||0;return(t["房屋單價"]||t["房屋單價(萬)"]||t.unitPrice||0)-r}),isExpanded:!1}});l.sort((e,t)=>t.unitPriceRange.max-e.unitPriceRange.max),f(l),j({roomType:t,areaRange:r,totalCount:n.length})}}),b&&(0,r.jsxs)("div",{className:"mt-4 p-4 bg-zinc-900/50 border border-white/10 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"text-white font-medium flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-cyan-400",children:b.roomType}),(0,r.jsx)("span",{className:"text-zinc-500",children:"|"}),(0,r.jsxs)("span",{children:[b.areaRange," 坪"]})]}),(0,r.jsxs)("p",{className:"text-zinc-400 text-xs mt-1",children:["共找到 ",h.length," 個建案，合計 ",b.totalCount," 筆交易"]})]}),(0,r.jsx)("button",{onClick:()=>j(null),className:"text-zinc-400 hover:text-white text-sm bg-zinc-800/50 px-3 py-1 rounded-full hover:bg-zinc-700 transition-colors",children:"✕ 關閉"})]}),h.length>0?(0,r.jsx)("div",{className:"max-h-[500px] overflow-y-auto pr-1 custom-scrollbar",children:(0,r.jsxs)("table",{className:"w-full text-xs border-collapse",children:[(0,r.jsx)("thead",{className:"bg-zinc-800 text-zinc-300 sticky top-0 z-10 shadow-sm",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"p-3 text-left w-[25%]",children:"建案名稱 (戶數)"}),(0,r.jsx)("th",{className:"p-3 text-center w-[25%]",children:"成交單價範圍 (萬/坪)"}),(0,r.jsx)("th",{className:"p-3 text-center w-[15%]",children:"總價中位數"}),(0,r.jsx)("th",{className:"p-3 text-center w-[35%]",children:"成交總價範圍 (萬)"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-white/5",children:h.map((e,t)=>(0,r.jsxs)(s.default.Fragment,{children:[(0,r.jsxs)("tr",{className:(0,c.cn)("group transition-colors cursor-pointer select-none",e.isExpanded?"bg-zinc-800/60":"hover:bg-zinc-800/30"),onClick:()=>{f(e=>e.map((e,r)=>r===t?{...e,isExpanded:!e.isExpanded}:e))},children:[(0,r.jsxs)("td",{className:"p-3 font-medium text-white flex items-center gap-2",children:[(0,r.jsx)("span",{className:(0,c.cn)("text-zinc-500 transition-transform duration-200",e.isExpanded?"rotate-90":""),children:"▶"}),e.projectName,(0,r.jsx)("span",{className:"px-1.5 py-0.5 rounded-full bg-zinc-700 text-zinc-300 text-[10px] min-w-[24px] text-center",children:e.count})]}),(0,r.jsx)("td",{className:"p-3 text-center font-mono text-cyan-400",children:e.unitPriceRange.min===e.unitPriceRange.max?e.unitPriceRange.min.toFixed(1):`${e.unitPriceRange.min.toFixed(1)} ~ ${e.unitPriceRange.max.toFixed(1)}`}),(0,r.jsx)("td",{className:"p-3 text-center font-mono text-violet-400",children:z(e.priceRange.median||0)}),(0,r.jsx)("td",{className:"p-3 text-center font-mono text-zinc-300",children:e.priceRange.min===e.priceRange.max?z(e.priceRange.min):`${z(e.priceRange.min)} ~ ${z(e.priceRange.max)}`})]}),e.isExpanded&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:4,className:"p-0 bg-zinc-950/30 inset-shadow",children:(0,r.jsx)("div",{className:"p-2 pl-8 border-l-2 border-zinc-700/50 ml-4 my-1",children:(0,r.jsxs)("table",{className:"w-full text-xs bg-transparent opacity-80",children:[(0,r.jsx)("thead",{className:"text-zinc-500 border-b border-white/5",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"py-1 text-left font-normal pl-2",children:"樓層"}),(0,r.jsx)("th",{className:"py-1 text-left font-normal",children:"戶型"}),(0,r.jsx)("th",{className:"py-1 text-right font-normal",children:"坪數"}),(0,r.jsx)("th",{className:"py-1 text-right font-normal",children:"單價"}),(0,r.jsx)("th",{className:"py-1 text-right font-normal pr-2",children:"總價"})]})}),(0,r.jsxs)("tbody",{children:[e.transactions.slice(0,e.showAll?void 0:10).map((e,t)=>(0,r.jsxs)("tr",{className:"hover:text-white",children:[(0,r.jsx)("td",{className:"py-1 pl-2",children:e["樓層"]||e.floor||"-"}),(0,r.jsx)("td",{className:"py-1 text-left text-zinc-400",children:e["戶型"]||"-"}),(0,r.jsx)("td",{className:"py-1 text-right font-mono",children:(e["房屋面積(坪)"]||e.houseArea||0).toFixed(1)}),(0,r.jsx)("td",{className:"py-1 text-right font-mono text-cyan-500",children:(e["房屋單價(萬)"]||e.unitPrice||0).toFixed(1)}),(0,r.jsx)("td",{className:"py-1 text-right font-mono pr-2",children:z(e["交易總價(萬)"]||e.totalPrice||0)})]},t)),e.transactions.length>10&&!e.showAll&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:5,className:"py-2 text-center",children:(0,r.jsxs)("button",{onClick:e=>{e.stopPropagation(),f(e=>e.map((e,r)=>r===t?{...e,showAll:!0}:e))},className:"text-zinc-500 hover:text-zinc-300 italic text-xs hover:underline",children:["... 還有 ",e.transactions.length-10," 筆 (點擊展開) ..."]})})}),e.transactions.length>10&&e.showAll&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:5,className:"py-2 text-center",children:(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),f(e=>e.map((e,r)=>r===t?{...e,showAll:!1}:e))},className:"text-zinc-500 hover:text-zinc-300 italic text-xs hover:underline",children:"... 收合 ..."})})})]})]})})})})]},t))})]})}):(0,r.jsx)("p",{className:"text-zinc-500 text-center py-8 bg-zinc-900/30 rounded border border-dashed border-zinc-800",children:"無詳細資料"})]})]})]})}function Q({data:e}){let t=(0,s.useMemo)(()=>e?[e.withParking.count,e.withoutParking.count]:[],[e]),i=(0,s.useMemo)(()=>({chart:{type:"donut",background:"transparent",foreColor:"#e5e7eb"},labels:["含車位","無車位"],colors:["#a5b4fc","#4b5563"],plotOptions:{pie:{donut:{labels:{show:!0,total:{show:!0,label:"總交易",color:"#e5e7eb",formatter:e=>e.globals.seriesTotals.reduce((e,t)=>e+t,0).toLocaleString()+" 筆"}}}}},dataLabels:{enabled:!0,formatter:e=>`${e.toFixed(1)}%`},legend:{position:"bottom"},tooltip:{theme:"dark",y:{formatter:e=>`${e} 筆`}},stroke:{show:!1}}),[]);return e&&(0!==e.withParking.count||0!==e.withoutParking.count)?(0,r.jsx)(T,{type:"donut",series:t,options:i,height:350,className:"w-full"}):(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無車位配比資料"})}function ee({data:e}){let[t,i]=(0,s.useState)(["B1","B2","B3","B4"]),[n,a]=(0,s.useState)(null);if(!e?.parkingAnalysis)return null;let{parkingRatio:l,avgPriceByType:o,rampPlanePriceByFloor:d}=e.parkingAnalysis,x=["B1","B2","B3","B4","B5_below","Unknown"],u=d?.filter(e=>x.includes(e.floor)&&e.count>0)||[],h=(0,s.useMemo)(()=>(function(e,t){let r=[];if(e.forEach(e=>{t.includes(e.floor)&&e.rawRecords&&e.rawRecords.forEach(e=>{"number"!=typeof e.parkingPrice||isNaN(e.parkingPrice)||r.push(e.parkingPrice)})}),0===r.length)return{avgPrice:0,medianPrice:0,q3Price:0,count:0};r.sort((e,t)=>e-t);let s=r.reduce((e,t)=>e+t,0)/r.length,i=r[Math.floor(r.length/2)],n=Math.floor(.75*r.length),a=r[n]||i;return{avgPrice:s,medianPrice:i,q3Price:a,count:r.length}})(u,t),[u,t]),p=(0,s.useCallback)(e=>{i(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},[]),f=(0,s.useCallback)(()=>{t.length===x.length?i([]):i([...x])},[t.length]),g={B1:"#06b6d4",B2:"#3b82f6",B3:"#6366f1",B4:"#8b5cf6",B5_below:"#a855f7",Unknown:"#71717a"};return(0,r.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsx)($,{title:"房車配比分析",description:"建案有購置車位的比例",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[(0,r.jsx)("div",{className:"w-full md:w-1/2",children:(0,r.jsx)(Q,{data:l})}),(0,r.jsx)("div",{className:"w-full md:w-1/2 space-y-4",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"bg-zinc-900/50 text-zinc-500",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"p-2 text-left",children:"類型"}),(0,r.jsx)("th",{className:"p-2 text-right",children:"筆數"}),(0,r.jsx)("th",{className:"p-2 text-right",children:"佔比"})]})}),(0,r.jsxs)("tbody",{className:"divide-y divide-white/5",children:[(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"p-2",children:"有搭車位"}),(0,r.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:l?.withParking?.count.toLocaleString()}),(0,r.jsxs)("td",{className:"p-2 text-right font-mono text-cyan-400",children:[l?.withParking?.percentage.toFixed(2),"%"]})]}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"p-2",children:"無車位"}),(0,r.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:l?.withoutParking?.count.toLocaleString()}),(0,r.jsxs)("td",{className:"p-2 text-right font-mono text-zinc-500",children:[l?.withoutParking?.percentage.toFixed(2),"%"]})]})]})]})})]})}),(0,r.jsx)($,{title:"車位類型均價",description:"各類車位成交行情",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"bg-zinc-900/50 text-zinc-500",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"p-2 text-left",children:"類型"}),(0,r.jsx)("th",{className:"p-2 text-right",children:"均價(萬)"}),(0,r.jsx)("th",{className:"p-2 text-right",children:"中位數"}),(0,r.jsx)("th",{className:"p-2 text-right",children:"總數"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-white/5",children:o?.map(e=>(0,r.jsxs)("tr",{className:"hover:bg-zinc-800/50",children:[(0,r.jsx)("td",{className:"p-2 font-medium",children:e.type}),(0,r.jsx)("td",{className:"p-2 text-right font-mono text-cyan-400",children:Math.round(e.avgPrice).toLocaleString()}),(0,r.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:Math.round(e.medianPrice).toLocaleString()}),(0,r.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:e.count.toLocaleString()})]},e.type))})]})})]}),(0,r.jsx)($,{title:"坡道平面車位坪數統計",description:"坡道平面車位的面積分佈",children:(()=>{let e=[];if(u.forEach(t=>{t.rawRecords&&t.rawRecords.forEach(t=>{let r=t.parkingArea||t["車位面積(坪)"];"number"==typeof r&&r>0&&e.push(r)})}),!(e.length>0))return(0,r.jsx)("p",{className:"text-zinc-500 text-center py-4",children:"無坡道平面車位坪數資料"});{e.sort((e,t)=>e-t);let t=e.reduce((e,t)=>e+t,0)/e.length,s=e[Math.floor(e.length/2)];return(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"bg-zinc-900/50 text-zinc-500",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"p-2 text-left",children:"統計項目"}),(0,r.jsx)("th",{className:"p-2 text-right",children:"數值"})]})}),(0,r.jsxs)("tbody",{className:"divide-y divide-white/5",children:[(0,r.jsxs)("tr",{className:"hover:bg-zinc-800/50",children:[(0,r.jsx)("td",{className:"p-2",children:"統計車位數"}),(0,r.jsxs)("td",{className:"p-2 text-right font-mono text-zinc-300",children:[e.length.toLocaleString()," 位"]})]}),(0,r.jsxs)("tr",{className:"hover:bg-zinc-800/50",children:[(0,r.jsx)("td",{className:"p-2",children:"平均坪數"}),(0,r.jsxs)("td",{className:"p-2 text-right font-mono text-cyan-400",children:[t.toFixed(2)," 坪"]})]}),(0,r.jsxs)("tr",{className:"hover:bg-zinc-800/50",children:[(0,r.jsx)("td",{className:"p-2",children:"坪數中位數"}),(0,r.jsxs)("td",{className:"p-2 text-right font-mono text-zinc-300",children:[s.toFixed(2)," 坪"]})]})]})]})}})()}),(0,r.jsx)($,{title:"坡道平面車位 - 樓層價差分析",description:"勾選樓層以動態更新統計數據",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,r.jsx)("div",{className:"flex flex-col-reverse gap-2 items-center justify-center p-8 bg-zinc-900/30 rounded-xl relative",children:u.map((e,s)=>{let i=t.includes(e.floor),l=n===e.floor;return(0,r.jsxs)("div",{onMouseEnter:()=>a(e.floor),onMouseLeave:()=>a(null),className:(0,c.cn)("w-52 h-14 rounded-lg flex items-center justify-between px-4 shadow-lg transition-all duration-200 cursor-pointer",l&&"ring-2 ring-white scale-105",!i&&"opacity-30"),style:{backgroundColor:g[e.floor]||"#4b5563"},onClick:()=>p(e.floor),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:(0,c.cn)("w-5 h-5 rounded border-2 flex items-center justify-center",i?"bg-white border-white":"border-white/50"),children:i&&(0,r.jsx)(m.Check,{size:14,className:"text-zinc-900"})}),(0,r.jsx)("span",{className:"font-bold text-white",children:e.floor})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsxs)("div",{className:"font-mono text-white text-sm",children:[Math.round(e.avgPrice).toLocaleString()," 萬"]}),(0,r.jsxs)("div",{className:"text-white/70 text-xs",children:[e.count," 位"]})]})]},e.floor)})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"p-4 bg-gradient-to-r from-cyan-500/10 to-violet-500/10 border border-cyan-500/30 rounded-lg",children:[(0,r.jsx)("h4",{className:"text-sm font-medium text-cyan-400 mb-3",children:"已選樓層統計"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-zinc-500",children:"車位數"}),(0,r.jsx)("div",{className:"text-lg font-bold text-white",children:h.count.toLocaleString()})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-zinc-500",children:"平均單價"}),(0,r.jsxs)("div",{className:"text-lg font-bold text-cyan-400",children:[Math.round(h.avgPrice).toLocaleString()," 萬"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-zinc-500",children:"中位數"}),(0,r.jsxs)("div",{className:"text-lg font-bold text-zinc-300",children:[Math.round(h.medianPrice).toLocaleString()," 萬"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-zinc-500",children:"3/4位數"}),(0,r.jsxs)("div",{className:"text-lg font-bold text-zinc-300",children:[Math.round(h.q3Price).toLocaleString()," 萬"]})]})]})]}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"bg-zinc-900/50 text-zinc-500",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"p-2 text-left",children:(0,r.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:t.length===x.length,onChange:f,className:"form-checkbox rounded bg-zinc-800 border-zinc-600 text-cyan-500"}),(0,r.jsx)("span",{children:"全選"})]})}),(0,r.jsx)("th",{className:"p-2 text-left",children:"樓層"}),(0,r.jsx)("th",{className:"p-2 text-right",children:"均價(萬)"}),(0,r.jsx)("th",{className:"p-2 text-right",children:"中位數"}),(0,r.jsx)("th",{className:"p-2 text-right",children:"最高"}),(0,r.jsx)("th",{className:"p-2 text-right",children:"最低"}),(0,r.jsx)("th",{className:"p-2 text-right",children:"車位數"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-white/5",children:u.map(e=>{let s=t.includes(e.floor),i=n===e.floor;return(0,r.jsxs)("tr",{onMouseEnter:()=>a(e.floor),onMouseLeave:()=>a(null),className:(0,c.cn)("transition-colors cursor-pointer",i?"bg-zinc-800":"hover:bg-zinc-800/50",!s&&"opacity-50"),onClick:()=>p(e.floor),children:[(0,r.jsx)("td",{className:"p-2",children:(0,r.jsx)("input",{type:"checkbox",checked:s,onChange:()=>p(e.floor),className:"form-checkbox rounded bg-zinc-800 border-zinc-600 text-cyan-500",onClick:e=>e.stopPropagation()})}),(0,r.jsx)("td",{className:"p-2 font-medium",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:g[e.floor]}}),e.floor]})}),(0,r.jsx)("td",{className:"p-2 text-right font-mono text-cyan-400",children:Math.round(e.avgPrice).toLocaleString()}),(0,r.jsx)("td",{className:"p-2 text-right font-mono text-zinc-300",children:Math.round(e.medianPrice).toLocaleString()}),(0,r.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:Math.round(e.maxPrice).toLocaleString()}),(0,r.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:Math.round(e.minPrice).toLocaleString()}),(0,r.jsx)("td",{className:"p-2 text-right font-mono text-zinc-500",children:e.count.toLocaleString()})]},e.floor)})})]})})]})]})})]})}function et({data:e,minPrice:t,maxPrice:i,interval:n,sizeMetric:a}){let{series:l,chartData:o}=(0,s.useMemo)(()=>{if(!e||0===e.length)return{series:[],chartData:[]};let r=[];for(let e=t;e<i;e+=n)r.push({min:e,max:Math.min(e+n,i),label:`${e}-${Math.min(e+n,i)}`,count:0,totalArea:0,avgPrice:0,transactions:[]});e.forEach(e=>{let s=e["房屋單價(萬)"],a=e["房屋面積(坪)"]||0;if("number"!=typeof s||s<t||s>=i)return;let l=Math.floor((s-t)/n);l>=0&&l<r.length&&(r[l].count++,r[l].totalArea+=a,r[l].transactions.push(e))});let s=r.filter(e=>e.count>0),l=Math.max(...s.map(e=>e.count)),o=Math.max(...s.map(e=>e.totalArea));return{series:[{name:"單價分佈",data:s.map(e=>{let t=(e.min+e.max)/2,r="count"===a?e.count:e.totalArea,s="count"===a?l:o;return{x:e.label,y:t,z:s>0?5+r/s*45:5,count:e.count,totalArea:e.totalArea,rangeLabel:e.label}})}],chartData:s}},[e,t,i,n,a]),c=(0,s.useMemo)(()=>({chart:{type:"bubble",height:450,toolbar:{show:!0},zoom:{enabled:!1}},dataLabels:{enabled:!0,style:{colors:["#fff"],fontWeight:600},formatter:(e,{seriesIndex:t,dataPointIndex:r,w:s})=>{let i=s.config.series[t].data[r];return"count"===a?i.count:Math.round(i.totalArea)}},fill:{opacity:.7,type:"gradient",gradient:{shade:"dark",type:"diagonal1",gradientToColors:["#8b5cf6"],inverseColors:!1,opacityFrom:.85,opacityTo:.5}},xaxis:{type:"category",title:{text:"單價區間 (萬/坪)",style:{color:"#9ca3af"}},labels:{rotate:-45,style:{colors:"#9ca3af"}}},yaxis:{title:{text:"平均單價點 (萬/坪)",style:{color:"#9ca3af"}},labels:{style:{colors:"#9ca3af"},formatter:e=>e.toFixed(0)},min:t-n,max:i+n},tooltip:{theme:"dark",custom:function({seriesIndex:e,dataPointIndex:t,w:r}){let s=r.config.series[e].data[t],i="count"===a?"成交件數":"總坪數",n="count"===a?s.count.toLocaleString()+" 筆":s.totalArea.toFixed(2)+" 坪";return`
                        <div style="background: #1f2937; border: 1px solid #374151; padding: 10px; border-radius: 8px;">
                            <div style="font-weight: 600; color: #06b6d4; margin-bottom: 6px;">單價區間：${s.x} 萬/坪</div>
                            <div style="color: #e5e7eb;">成交件數：${s.count.toLocaleString()} 筆</div>
                            <div style="color: #e5e7eb;">總坪數：${s.totalArea.toFixed(2)} 坪</div>
                            <div style="color: #a855f7; margin-top: 4px; font-weight: 500;">${i}影響力：${n}</div>
                        </div>
                    `}},theme:{mode:"dark"},grid:{borderColor:"#374151"}}),[t,i,n,a]);return e&&0!==e.length?(0,r.jsx)(T,{type:"bubble",series:l,options:c,height:450,className:"w-full"}):(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無交易資料可顯示"})}function er({title:e,stats:t,noDataMessage:s="無資料",className:i,averageType:n="weighted"}){if(!t||0===t.count)return(0,r.jsxs)("div",{className:(0,c.cn)("p-6 border border-white/5 rounded-lg bg-zinc-900/30",i),children:[(0,r.jsx)("h3",{className:"text-zinc-400 font-medium mb-4",children:e}),(0,r.jsx)("p",{className:"text-zinc-500 text-center py-4",children:s})]});let a="weighted"===n&&t.weightedAvgPrice?t.weightedAvgPrice:t.avgPrice;return(0,r.jsxs)("div",{className:(0,c.cn)("p-6 border border-white/5 rounded-lg bg-zinc-900/30",i),children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-white",children:e}),(0,r.jsxs)("span",{className:"text-xs text-zinc-500 bg-zinc-800 px-2 py-1 rounded",children:["樣本數: ",t.count]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,r.jsx)("div",{className:"space-y-1",children:(0,r.jsx)("table",{className:"w-full text-sm",children:(0,r.jsxs)("tbody",{className:"divide-y divide-white/5",children:[(0,r.jsxs)("tr",{className:"group",children:[(0,r.jsx)("td",{className:"py-2 text-zinc-400",children:"weighted"===n?"加權平均單價":"算術平均單價"}),(0,r.jsxs)("td",{className:"py-2 text-right font-mono text-white group-hover:text-cyan-400 transition-colors",children:[(0,c.formatNumber)(a)," 萬/坪"]})]}),(0,r.jsxs)("tr",{className:"group",children:[(0,r.jsx)("td",{className:"py-2 text-zinc-400",children:"最低單價"}),(0,r.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors",children:(0,c.formatNumber)(t.minPrice)})]}),(0,r.jsxs)("tr",{className:"group",children:[(0,r.jsx)("td",{className:"py-2 text-zinc-400",children:"1/4分位數"}),(0,r.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors",children:(0,c.formatNumber)(t.q1Price)})]}),(0,r.jsxs)("tr",{className:"group",children:[(0,r.jsx)("td",{className:"py-2 text-violet-400 font-medium",children:"中位數單價"}),(0,r.jsx)("td",{className:"py-2 text-right font-mono text-violet-400 font-bold",children:(0,c.formatNumber)(t.medianPrice)})]}),(0,r.jsxs)("tr",{className:"group",children:[(0,r.jsx)("td",{className:"py-2 text-zinc-400",children:"3/4分位數"}),(0,r.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors",children:(0,c.formatNumber)(t.q3Price)})]}),(0,r.jsxs)("tr",{className:"group",children:[(0,r.jsx)("td",{className:"py-2 text-zinc-400",children:"最高單價"}),(0,r.jsx)("td",{className:"py-2 text-right font-mono text-zinc-300 group-hover:text-white transition-colors",children:(0,c.formatNumber)(t.maxPrice)})]})]})})}),(0,r.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,r.jsxs)("div",{className:"p-3 bg-zinc-950/50 rounded border border-white/5",children:[(0,r.jsx)("div",{className:"text-cyan-500 font-medium mb-1 text-xs uppercase tracking-wider",children:"最高價建案"}),(0,r.jsx)("div",{className:"text-white font-bold text-lg mb-1",children:t.maxPriceProject||"N/A"}),(0,r.jsxs)("div",{className:"flex gap-4 text-zinc-400 text-xs",children:[(0,r.jsxs)("span",{children:["戶型: ",t.maxPriceUnit||"-"]}),(0,r.jsxs)("span",{children:["樓層: ",t.maxPriceFloor||"-"]})]})]}),(0,r.jsxs)("div",{className:"p-3 bg-zinc-950/50 rounded border border-white/5",children:[(0,r.jsx)("div",{className:"text-green-500 font-medium mb-1 text-xs uppercase tracking-wider",children:"最低價建案"}),(0,r.jsx)("div",{className:"text-white font-bold text-lg mb-1",children:t.minPriceProject||"N/A"}),(0,r.jsxs)("div",{className:"flex gap-4 text-zinc-400 text-xs",children:[(0,r.jsxs)("span",{children:["戶型: ",t.minPriceUnit||"-"]}),(0,r.jsxs)("span",{children:["樓層: ",t.minPriceFloor||"-"]})]})]})]})]})]})}function es({data:e}){if(!e||0===e.length)return(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無符合條件的建案可進行類型比較"});let t=Math.max(...e.map(e=>e.shopMultiple),1),s=Math.max(...e.map(e=>e.officeMultiple),1);return(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,r.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 font-semibold uppercase text-xs",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3",children:"建案名稱"}),(0,r.jsx)("th",{className:"px-4 py-3 text-right",children:"住宅均價"}),(0,r.jsx)("th",{className:"px-4 py-3 text-right",children:"店舖均價"}),(0,r.jsx)("th",{className:"px-4 py-3 w-[200px]",children:"店舖倍數"}),(0,r.jsx)("th",{className:"px-4 py-3 text-right",children:"事務所均價"}),(0,r.jsx)("th",{className:"px-4 py-3 w-[200px]",children:"事務所倍數"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-white/5",children:e.map((e,i)=>(0,r.jsxs)("tr",{className:"hover:bg-zinc-800/30 transition-colors",children:[(0,r.jsxs)("td",{className:"px-4 py-3",children:[(0,r.jsx)("div",{className:"font-medium text-white",children:e.projectName}),(0,r.jsxs)("div",{className:"text-xs text-zinc-500 flex gap-1 mt-0.5",children:[e.county&&(0,r.jsx)("span",{className:"bg-zinc-800 px-1 rounded",children:e.county}),e.district&&(0,r.jsx)("span",{className:"bg-zinc-800 px-1 rounded",children:e.district})]})]}),(0,r.jsx)("td",{className:"px-4 py-3 text-right font-mono text-zinc-300",children:e.residentialAvg>0?(0,c.formatNumber)(e.residentialAvg):"-"}),(0,r.jsx)("td",{className:"px-4 py-3 text-right font-mono text-zinc-300",children:e.shopAvg>0?(0,c.formatNumber)(e.shopAvg):"-"}),(0,r.jsx)("td",{className:"px-4 py-3",children:e.shopMultiple>0?(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"flex justify-between text-xs mb-0.5",children:(0,r.jsxs)("span",{className:"font-bold text-violet-400",children:[e.shopMultiple.toFixed(2),"x"]})}),(0,r.jsx)("div",{className:"h-1.5 bg-zinc-800 rounded-full overflow-hidden w-full",children:(0,r.jsx)("div",{className:"h-full bg-violet-600 rounded-full",style:{width:`${Math.min(e.shopMultiple/t*100,100)}%`}})})]}):(0,r.jsx)("span",{className:"text-zinc-600",children:"-"})}),(0,r.jsx)("td",{className:"px-4 py-3 text-right font-mono text-zinc-300",children:e.officeAvg>0?(0,c.formatNumber)(e.officeAvg):"-"}),(0,r.jsx)("td",{className:"px-4 py-3",children:e.officeMultiple>0?(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("div",{className:"flex justify-between text-xs mb-0.5",children:(0,r.jsxs)("span",{className:"font-bold text-cyan-400",children:[e.officeMultiple.toFixed(2),"x"]})}),(0,r.jsx)("div",{className:"h-1.5 bg-zinc-800 rounded-full overflow-hidden w-full",children:(0,r.jsx)("div",{className:"h-full bg-cyan-600 rounded-full",style:{width:`${Math.min(e.officeMultiple/s*100,100)}%`}})})]}):(0,r.jsx)("span",{className:"text-zinc-600",children:"-"})})]},i))})]})})}function ei({data:e}){let[t,i]=(0,s.useState)("weighted"),[n,a]=(0,s.useState)(30),[l,o]=(0,s.useState)(150),[d,x]=(0,s.useState)(5),[m,u]=(0,s.useState)("count"),h=e?.transactionDetails||[],p=e?.unitPriceAnalysis,f=p?.residentialStats,b=p?.officeStats,j=p?.storeStats,y=p?.typeComparison;return e&&(h.length||p)?(0,r.jsxs)("div",{className:"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-white pl-2 border-l-4 border-violet-500",children:"各用途單價統計"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-zinc-400 text-sm",children:"平均類型:"}),(0,r.jsxs)("div",{className:"flex bg-zinc-950/50 rounded-md p-1 border border-white/5",children:[(0,r.jsx)("button",{onClick:()=>i("arithmetic"),className:(0,c.cn)("px-3 py-1 text-xs rounded transition-colors","arithmetic"===t?"bg-violet-500 text-white":"text-zinc-400 hover:text-white"),children:"算術平均"}),(0,r.jsx)("button",{onClick:()=>i("weighted"),className:(0,c.cn)("px-3 py-1 text-xs rounded transition-colors","weighted"===t?"bg-violet-500 text-white":"text-zinc-400 hover:text-white"),children:"加權平均"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6",children:[(0,r.jsx)(er,{title:"住宅建案統計",stats:f,noDataMessage:"無住宅交易數據",className:"border-violet-500/20",averageType:t}),(0,r.jsx)(er,{title:"一般事務所/辦公室統計",stats:b,noDataMessage:"無事務所/辦公室交易數據",className:"border-cyan-500/20",averageType:t}),(0,r.jsx)(er,{title:"店舖統計",stats:j,noDataMessage:"無店舖交易數據",className:"border-amber-500/20 xl:col-span-2",averageType:t})]})]}),y&&y.length>0&&(0,r.jsx)($,{title:"建案產品類型單價比較",description:"同一建案內不同用途（住宅/店面/事務所）的單價與倍數比較",children:(0,r.jsx)(es,{data:y})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-white pl-2 border-l-4 border-violet-500",children:"單價分佈分析"}),(0,r.jsxs)("div",{className:"p-4 bg-zinc-900/30 border border-white/5 rounded-lg flex flex-wrap gap-4 items-center",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-zinc-400 text-sm",children:"單價範圍:"}),(0,r.jsx)(g.Input,{type:"number",value:n,onChange:e=>a(Number(e.target.value)),className:"w-20 h-8 text-xs bg-zinc-950/50"}),(0,r.jsx)("span",{className:"text-zinc-500",children:"-"}),(0,r.jsx)(g.Input,{type:"number",value:l,onChange:e=>o(Number(e.target.value)),className:"w-20 h-8 text-xs bg-zinc-950/50"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-zinc-400 text-sm",children:"級距:"}),(0,r.jsx)(g.Input,{type:"number",value:d,onChange:e=>x(Number(e.target.value)),className:"w-16 h-8 text-xs bg-zinc-950/50"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-zinc-400 text-sm",children:"氣泡大小依據:"}),(0,r.jsxs)("div",{className:"flex bg-zinc-950/50 rounded-md p-1 border border-white/5",children:[(0,r.jsx)("button",{onClick:()=>u("count"),className:(0,c.cn)("px-3 py-1 text-xs rounded transition-colors","count"===m?"bg-violet-500 text-white":"text-zinc-400 hover:text-white"),children:"成交筆數"}),(0,r.jsx)("button",{onClick:()=>u("area"),className:(0,c.cn)("px-3 py-1 text-xs rounded transition-colors","area"===m?"bg-violet-500 text-white":"text-zinc-400 hover:text-white"),children:"總銷坪數"})]})]})]}),(0,r.jsx)($,{title:"單價分佈泡泡圖",description:"分析各單價區間的成交熱度與分佈密集區",children:(0,r.jsx)(et,{data:h,minPrice:n,maxPrice:l,interval:d,sizeMetric:m})})]})]}):null}var en=e.i(1801);let ea=(0,d.default)("store",[["path",{d:"M15 21v-5a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v5",key:"slp6dd"}],["path",{d:"M17.774 10.31a1.12 1.12 0 0 0-1.549 0 2.5 2.5 0 0 1-3.451 0 1.12 1.12 0 0 0-1.548 0 2.5 2.5 0 0 1-3.452 0 1.12 1.12 0 0 0-1.549 0 2.5 2.5 0 0 1-3.77-3.248l2.889-4.184A2 2 0 0 1 7 2h10a2 2 0 0 1 1.653.873l2.895 4.192a2.5 2.5 0 0 1-3.774 3.244",key:"o0xfot"}],["path",{d:"M4 10.95V19a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8.05",key:"wn3emo"}]]),el=(0,d.default)("briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]),eo=(0,d.default)("sprout",[["path",{d:"M14 9.536V7a4 4 0 0 1 4-4h1.5a.5.5 0 0 1 .5.5V5a4 4 0 0 1-4 4 4 4 0 0 0-4 4c0 2 1 3 1 5a5 5 0 0 1-1 3",key:"139s4v"}],["path",{d:"M4 9a5 5 0 0 1 8 4 5 5 0 0 1-8-4",key:"1dlkgp"}],["path",{d:"M5 21h14",key:"11awu3"}]]),ec=(0,d.default)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),ed=(e,t=0)=>e?.toLocaleString(void 0,{maximumFractionDigits:t}),ex=({children:e,triggerRect:t,isTopRow:s})=>{if(!t)return null;let i={position:"fixed",left:t.left+t.width/2,transform:"translateX(-50%)",zIndex:9999};return s?i.top=t.bottom+8:i.bottom=window.innerHeight-t.top+8,(0,en.createPortal)((0,r.jsx)("div",{style:i,className:"pointer-events-none",children:e}),document.body)};function em({data:e,floorPremium:t=.3}){let{horizontalGrid:i,sortedFloors:n,sortedUnits:a,unitColorMap:l,summary:o,horizontalComparison:d}=e,[x,m]=(0,s.useState)(null),u=()=>{m(null)};return i&&n&&a?(0,r.jsxs)("div",{className:"space-y-8 overflow-x-auto relative",children:[x&&(0,r.jsx)(ex,{triggerRect:x.rect,isTopRow:x.isTopRow,children:(0,r.jsx)("div",{className:"w-48 bg-zinc-900 border border-zinc-700 rounded-lg p-3 shadow-xl animate-in fade-in zoom-in-95 duration-200",children:(0,r.jsxs)("div",{className:"space-y-1",children:[0===x.data.premium&&(0,r.jsx)("div",{className:"text-cyan-400 font-bold mb-1",children:"★ 基準戶"}),null!==x.data.premium&&(0,r.jsxs)("div",{className:"text-zinc-300",children:["調價: ",(0,r.jsxs)("span",{className:(0,c.cn)(x.data.premium>0?"text-red-400":x.data.premium<0?"text-violet-400":"text-zinc-400"),children:[x.data.premium>0?"+":"",x.data.premium.toFixed(2),"%"]})]}),(0,r.jsx)("div",{className:"h-px bg-zinc-700 my-2"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-x-2 gap-y-1 text-xs text-zinc-400",children:[(0,r.jsx)("span",{children:"成交總價:"})," ",(0,r.jsxs)("span",{className:"text-white text-right",children:[ed(x.data.tooltipInfo.totalPrice),"萬"]}),(0,r.jsx)("span",{children:"房屋總價:"})," ",(0,r.jsxs)("span",{className:"text-white text-right",children:[ed(x.data.tooltipInfo.housePrice),"萬"]}),(0,r.jsx)("span",{children:"車位總價:"})," ",(0,r.jsxs)("span",{className:"text-white text-right",children:[ed(x.data.tooltipInfo.parkingPrice),"萬"]}),(0,r.jsx)("span",{children:"房屋面積:"})," ",(0,r.jsxs)("span",{className:"text-white text-right",children:[ed(x.data.tooltipInfo.houseArea,2),"坪"]})]})]})})}),(0,r.jsx)("div",{className:"min-w-max pb-32",children:(0,r.jsxs)("table",{className:"divide-y divide-zinc-800 border-collapse w-full text-sm",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"sticky left-0 bg-dark-card z-20 p-2 text-zinc-400 border-r border-zinc-800",children:"樓層 \\ 戶別"}),a.map(e=>(0,r.jsx)("th",{className:"p-2 text-white font-medium border-l border-zinc-800/50",style:{backgroundColor:`${l[e]||"#4b5563"}80`},children:e},e))]})}),(0,r.jsx)("tbody",{className:"divide-y divide-zinc-800/50",children:n.map((e,t)=>(0,r.jsxs)("tr",{className:"hover:bg-zinc-800/30 transition-colors",children:[(0,r.jsx)("td",{className:"sticky left-0 bg-dark-card z-10 p-2 font-bold text-zinc-300 border-r border-zinc-800 text-center",children:e}),a.map(s=>{let n=i[e]?.[s];return n&&0!==n.length?(0,r.jsx)("td",{className:"p-1 border-l border-zinc-800/50 align-top",children:(0,r.jsx)("div",{className:"flex flex-col gap-1",children:n.map((e,s)=>{var i;let n=(i=e.premium,e.isStorefront?"rgba(217, 119, 6, 0.4)":e.isOffice?"rgba(37, 99, 235, 0.4)":null===i?"#1f2937":i<0?"rgba(139, 92, 246, 0.4)":0===i?"#06b6d4":i>5?"rgba(244, 63, 94, 0.5)":i>2?"rgba(234, 179, 8, 0.4)":"rgba(34, 197, 94, 0.3)"),a=e.isStorefront?{icon:(0,r.jsx)(ea,{className:"w-3 h-3"}),label:"店舖"}:e.isOffice?{icon:(0,r.jsx)(el,{className:"w-3 h-3"}),label:"辦公"}:e.remark?.includes("露台")?{icon:(0,r.jsx)(eo,{className:"w-3 h-3"}),label:"露台"}:e.remark?.includes("親友")||e.remark?.includes("員工")?{icon:(0,r.jsx)(ec,{className:"w-3 h-3"}),label:"親友"}:null,l=0===e.premium,o=t<3;return(0,r.jsxs)("div",{className:(0,c.cn)("p-1.5 rounded text-xs transition-transform hover:scale-105 cursor-default relative group",l&&"ring-1 ring-cyan-500"),style:{backgroundColor:n},onMouseEnter:t=>{m({rect:t.currentTarget.getBoundingClientRect(),data:e,isTopRow:o})},onMouseLeave:u,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-1",children:[(0,r.jsxs)("span",{className:"font-semibold text-white flex items-center gap-1",children:[a&&(0,r.jsx)("span",{className:"text-zinc-200",title:a.label,children:a.icon}),e.unitPrice.toFixed(1),"萬"]}),e.hasParking&&(0,r.jsx)("span",{className:"flex items-center justify-center w-3.5 h-3.5 bg-blue-500 text-white text-[9px] font-bold rounded-sm ml-0.5",title:"含車位",children:"P"})]}),(0,r.jsx)("div",{className:"text-[10px] text-zinc-300/80 mt-0.5",children:e.transactionDate})]},s)})})},`${e}-${s}`):(0,r.jsx)("td",{className:"p-2 border-l border-zinc-800/50 bg-zinc-900/20 text-center text-zinc-600",children:"-"},`${e}-${s}`)})]},e))})]})}),o&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-zinc-200",children:"調價幅度統計摘要 (排除店舖/辦公室)"}),(0,r.jsx)("div",{className:"overflow-x-auto rounded-lg border border-zinc-800",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left text-zinc-300",children:[(0,r.jsx)("thead",{className:"text-xs text-zinc-400 uppercase bg-zinc-900/50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3",children:"基準房屋總價"}),(0,r.jsx)("th",{className:"px-6 py-3",children:"調價幅度總額"}),(0,r.jsx)("th",{className:"px-6 py-3",children:"總溢價率"}),(0,r.jsx)("th",{className:"px-6 py-3",children:"已售房屋坪數"}),(0,r.jsx)("th",{className:"px-6 py-3",children:"平均單價調價"})]})}),(0,r.jsx)("tbody",{children:(0,r.jsxs)("tr",{className:"bg-zinc-900/20 border-b border-zinc-800",children:[(0,r.jsxs)("td",{className:"px-6 py-4",children:[ed(o.totalBaselineHousePrice)," 萬"]}),(0,r.jsxs)("td",{className:(0,c.cn)("px-6 py-4 font-bold",o.totalPricePremiumValue>0?"text-red-400":"text-violet-400"),children:[o.totalPricePremiumValue>0?"+":"",ed(o.totalPricePremiumValue)," 萬"]}),(0,r.jsxs)("td",{className:"px-6 py-4",children:[(o.totalPricePremiumValue/o.totalBaselineHousePrice*100).toFixed(2)," %"]}),(0,r.jsxs)("td",{className:"px-6 py-4",children:[ed(o.totalSoldArea)," 坪"]}),(0,r.jsxs)("td",{className:(0,c.cn)("px-6 py-4",o.totalPricePremiumValue>0?"text-red-400":"text-violet-400"),children:[(o.totalPricePremiumValue/o.totalSoldArea).toFixed(2)," 萬/坪"]})]})})]})})]}),d&&d.length>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-zinc-200",children:["戶型水平價差與溢價貢獻 (基準樓層: F",e.refFloorForComparison||"N/A",")"]}),(0,r.jsx)("div",{className:"overflow-x-auto rounded-lg border border-zinc-800",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left text-zinc-300",children:[(0,r.jsx)("thead",{className:"text-xs text-zinc-400 uppercase bg-zinc-900/50",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3",children:"戶型"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"基準戶 (樓/價)"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"水平價差(萬/坪)"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"去化戶數"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"溢價貢獻"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"貢獻佔比"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"基準房屋總價"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"平均單價調價"})]})}),(0,r.jsx)("tbody",{children:d.map((e,t)=>(0,r.jsxs)("tr",{className:"bg-zinc-900/20 border-b border-zinc-800 hover:bg-zinc-800/20",children:[(0,r.jsx)("td",{className:"px-4 py-3 font-medium text-white",children:e.unitType}),(0,r.jsx)("td",{className:"px-4 py-3",children:e.anchorInfo}),(0,r.jsx)("td",{className:(0,c.cn)("px-4 py-3",(e.horizontalPriceDiff||0)>0?"text-red-400":"text-zinc-400"),children:"number"==typeof e.horizontalPriceDiff?`${e.horizontalPriceDiff>0?"+":""}${e.horizontalPriceDiff.toFixed(2)} 萬/坪`:"-"}),(0,r.jsxs)("td",{className:"px-4 py-3",children:[e.unitsSold," 戶"]}),(0,r.jsxs)("td",{className:(0,c.cn)("px-4 py-3 font-bold",e.timePremiumContribution>0?"text-red-400":"text-violet-400"),children:[e.timePremiumContribution>0?"+":"",ed(e.timePremiumContribution)," 萬"]}),(0,r.jsxs)("td",{className:"px-4 py-3",children:["number"==typeof e.contributionPercentage?e.contributionPercentage.toFixed(2):"0.00","%"]}),(0,r.jsxs)("td",{className:"px-4 py-3",children:[ed(e.baselineHousePrice)," 萬"]}),(0,r.jsxs)("td",{className:"px-4 py-3",children:["number"==typeof e.avgPriceAdjustment?e.avgPriceAdjustment.toFixed(2):"-"," 萬/坪"]})]},t))})]})})]})]}):(0,r.jsx)("div",{className:"text-zinc-500 text-center p-8",children:"無有效熱力圖資料"})}let eu=(0,d.default)("refresh-ccw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),eh=(0,d.default)("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);class ep{knownPatterns=new Map;patternFrequency=new Map;constructor(){this.initializeBasePatterns()}initializeBasePatterns(){[{id:"unit_slash_floorF_format",name:"戶號斜線樓層F格式",regex:/^([A-Z]\d+)\/(\d+)F[號号]?$/i,extract:(e,t)=>{let r=e[1],s=e[2];return t?.floor&&parseInt(s,10)===parseInt(t.floor,10)?r:r+s},confidence:100,priority:.01},{id:"building_unit_floor_combined",name:"棟別戶號樓層合併格式",regex:/^([A-Z])棟(\d+)-(\d+)[號号]?$/i,extract:(e,t)=>{let r=e[1],s=e[2],i=e[3];return t?.floor&&parseInt(i,10)===parseInt(t.floor,10)?r+s:r+s+i},confidence:100,priority:.02},{id:"building_unit_floorF_format_v2",name:"棟別戶號樓層F格式v2",regex:/^([A-Z])棟(\d+)-(\d+)F[號号]?$/i,extract:(e,t)=>{let r=e[1],s=e[2],i=e[3];return t?.floor&&parseInt(i,10)===parseInt(t.floor,10)?r+s:r+s+i},confidence:100,priority:.03},{id:"unit_building_zero_format",name:"戶號棟別0號格式",regex:/^([A-Z]\d+)棟0[號号]?$/i,extract:e=>e[1],confidence:100,priority:.04},{id:"single_letter_unit",name:"單字母戶號格式",regex:/^([A-Z])[號号]$/i,extract:e=>e[1],confidence:95,priority:.045},{id:"building_floor_unit_letter_format",name:"棟別樓層數字戶型字母格式",regex:/^([A-Z])棟(\d+)([A-Z])[號号]?$/i,extract:(e,t)=>{let r=e[1],s=parseInt(e[2],10),i=e[3];return t?.floor&&s===parseInt(t.floor,10)?i:`${r}${s}${i}`},confidence:99,priority:.05},{id:"building_floor_unit_format",name:"棟別樓層戶號格式",regex:/^([A-Z])棟(\d{1,2})F-(\d+)[號号]?$/,extract:(e,t)=>{let r=e[1],s=e[2],i=e[3];return t?.floor&&parseInt(s,10)===parseInt(t.floor,10)?r+i:r+s+i},confidence:99,priority:.1},{id:"letter_number_floor_format",name:"字母數字-樓層F格式",regex:/^([A-Z])0*(\d+)-(\d{1,2})F[號号]?$/,extract:(e,t)=>{let r=e[1],s=e[2],i=e[3];return t?.floor&&parseInt(i,10)===parseInt(t.floor,10)?r+s:r+s+i},confidence:99,priority:.15},{id:"identifier_building_floor_redundant",name:"識別碼棟與F樓層格式(贅余樓層)",regex:/^([A-Z]\d+)棟F(\d+)[號号]?$/i,extract:(e,t)=>{let r=e[1],s=e[2],i=r.match(/^[A-Z]+/)?.[0]||"",n=parseInt(r.match(/\d+/)?.[0]||"0",10),a=`${i}${n}`;return t?.floor&&parseInt(s,10)===parseInt(t.floor,10)?a:a+"F"+s},confidence:98,priority:.18},{id:"identifier_building_floorF_format",name:"識別碼棟與樓層F格式(贅余樓層)",regex:/^([A-Z]\d+)棟(\d{1,2})F[號号]?$/i,extract:(e,t)=>{let r=e[1],s=e[2];return t?.floor&&parseInt(s,10)===parseInt(t.floor,10)?r:r+s},confidence:98,priority:.19},{id:"unit_building_floor_format",name:"戶棟樓層格式",regex:/^([A-Z]\d+)戶棟(\d+)F[號号]?$/,extract:(e,t)=>{let r=e[1],s=e[2];return t?.floor&&parseInt(s,10)===parseInt(t.floor,10)?r:r+s},confidence:99,priority:.2},{id:"building_sub_unit_floor_format",name:"棟別子戶號樓層格式",regex:/^([A-Z])棟(\d+)-(\d+)F[號号]?$/,extract:(e,t)=>{let r=e[1],s=e[2],i=e[3];return t?.floor&&parseInt(i,10)===parseInt(t.floor,10)?r+s:r+s+i},confidence:99,priority:.3},{id:"building_unit_floor_format",name:"棟別戶別樓層格式",regex:/^([A-Z])棟([A-Z])-(\d{1,2})F[號号]?$/,extract:(e,t)=>{let r=e[2],s=e[3];return t?.floor&&parseInt(s,10)===parseInt(t.floor,10)?r:r+s},confidence:99,priority:.4},{id:"building_self_unit_floor_format",name:"棟別自身戶號樓層格式",regex:/^([A-Z])棟\1-(\d+)[號号]?$/,extract:(e,t)=>{let r=e[1],s=e[2];return t?.floor&&parseInt(s,10)===parseInt(t.floor,10)?r:r+s},confidence:98,priority:.45},{id:"building_unit_letter_floor_number",name:"棟別戶號字母樓層數字格式",regex:/^([A-Z])棟([A-Z])(\d{1,2})[號号]?$/,extract:(e,t)=>{let r=e[2],s=e[3];return t?.floor&&parseInt(s,10)===parseInt(t.floor,10)?r:r+s},confidence:98,priority:.46},{id:"redundant_building_format",name:"重複棟別格式",regex:/^([A-Z])棟\1-(\d{1,2})F[號号]?$/,extract:(e,t)=>{let r=e[1],s=e[2];return t?.floor&&parseInt(s,10)===parseInt(t.floor,10)?r:r+s},confidence:98,priority:.5},{id:"building_floor_letter_unit",name:"棟別樓層字母戶號格式",regex:/^[A-Z]棟(\d{1,2})F-([A-Z])[號号]?$/,extract:(e,t)=>{let r=e[1],s=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?s:s+r},confidence:98,priority:.6},{id:"letter_leading_zero_unit",name:"字母與0開頭數字戶號",regex:/^([A-Z])0+(\d+)[號号]?$/,extract:e=>e[1]+e[2],confidence:97,priority:.7},{id:"floor_prefix_format",name:"樓層前綴格式",regex:/^(\d{1,2})([A-Z])[號号]?$/,extract:(e,t)=>{let r=e[1],s=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?s:r+s},confidence:96,priority:.8},{id:"floorF_building_unit_format",name:"樓層F棟戶號格式",regex:/^(\d{1,2})F棟([A-Z])[號号]?$/,extract:(e,t)=>{let r=e[1],s=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?s:r+s},confidence:98,priority:.85},{id:"numericBuilding_floor_unit_format",name:"數字棟別樓層戶號格式",regex:/^(\d+)棟(\d{1,2})([A-Z])[號号]?$/,extract:(e,t)=>{let r=e[2],s=e[3];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?s:r+s},confidence:98,priority:.86},{id:"floor_first_detailed",name:"樓層優先詳細格式",regex:/(\d{1,2})F-([A-Z])(\d{2})/,extract:e=>e[2]+e[3],confidence:95,priority:1},{id:"floor_prefix_complex_unit",name:"樓層前綴複合戶號",regex:/^(\d{1,2})F-([A-Z]\d+)[號号]?$/,extract:(e,t)=>{let r=e[1],s=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?s:r+s},confidence:94,priority:1.2},{id:"floor_first_simple_letter",name:"樓層優先簡單字母格式",regex:/^(\d{1,2})F-([A-Z])[號号]?$/,extract:(e,t)=>{let r=e[1],s=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?s:r+s},confidence:90,priority:1.5},{id:"building_with_unit",name:"棟別完整戶號",regex:/([A-Z])棟([A-Z])(\d{1,2})(?:-(\d{1,2})F?[號号])?/,extract:e=>e[2]+e[3],confidence:90,priority:2,conditions:[{type:"building_match",validator:e=>{let t=e.rawUnit.match(/([A-Z])棟([A-Z])/);return!!t&&t[1]===t[2]}}]},{id:"building_simple_letter_unit",name:"棟別字母戶號格式",regex:/^[A-Z]棟([A-Z])[號号]?$/,extract:e=>e[1],confidence:92,priority:2.5},{id:"unit_floor_suffix",name:"戶號樓層後綴",regex:/([A-Z]\d{1,2})-(\d{1,2})F?[號号]?/,extract:e=>e[1],confidence:85,priority:3},{id:"building_floor_format",name:"棟別樓層格式",regex:/^([A-Z]\d{1,2})棟(\d{1,2})(?:F|樓)[號号]?$/,extract:(e,t)=>{let r=e[1],s=e[2];return t?.floor&&parseInt(s,10)===parseInt(t.floor,10)?r:r+s},confidence:88,priority:3.5},{id:"building_complex_number",name:"複合棟別編號",regex:/^([A-Z]\d+)棟(\d+)[號号]$/,extract:(e,t)=>{let r=e[1],s=e[2];return t?.floor&&parseInt(s,10)===parseInt(t.floor,10)?r:r+s},confidence:86,priority:3.8},{id:"building_floor_F_format",name:"棟別樓層F格式",regex:/^([A-Z])棟(\d{1,2})F[號号]?$/,extract:(e,t)=>{let r=e[1],s=e[2];return t?.floor&&parseInt(s,10)===parseInt(t.floor,10)?r:r+s},confidence:87,priority:3.9},{id:"building_zero_placeholder_unit",name:"棟別0號佔位符格式",regex:/^([A-Z])棟0[號号]?$/,extract:e=>e[1],confidence:95,priority:3.95},{id:"building_simple_number",name:"棟別簡單編號",regex:/([A-Z])棟(\d{1,2})[號号]/,extract:(e,t)=>{let r=e[1],s=e[2];return t?.floor&&parseInt(s,10)===parseInt(t.floor,10)?r:r+s},confidence:85,priority:4},{id:"unit_floor_concatenated",name:"複合戶號樓層格式",regex:/^([A-Z])(\d+)F[號号]?$/,extract:(e,t)=>{let r=e[1],s=e[2],i=t?.floor;if(i){let e=parseInt(i,10);if(!isNaN(e)){if(e<10){let e="0"+i;if(s.endsWith(e))return r+s.substring(0,s.length-2)}if(s.endsWith(i))return r+s.substring(0,s.length-i.length)}}return r+s},confidence:80,priority:4.5},{id:"letter_floor",name:"字母樓層格式",regex:/^([A-Z])-(\d{1,2})F?[號号]?$/,extract:(e,t)=>{let r=e[2];return t?.floor&&parseInt(r,10)===parseInt(t.floor,10)?e[1]:e[1]+r},confidence:70,priority:5}].forEach(e=>{this.knownPatterns.set(e.id,e)})}detectPattern(e,t){let r=this.normalizeText(e),s=null;for(let e of Array.from(this.knownPatterns.values()).sort((e,t)=>e.priority-t.priority)){let i=r.match(e.regex);if(i){if(e.conditions&&t&&!e.conditions.every(e=>e.validator(t)))continue;s={rule:e,match:i};break}}return s&&this.patternFrequency.set(s.rule.id,(this.patternFrequency.get(s.rule.id)||0)+1),s}normalizeText(e){return e?e.toUpperCase().replace(/[\uff01-\uff5e]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248)).replace(/\s+/g,""):""}}class ef{projectProfiles=new Map;analyzeProject(e,t){let r={projectName:e,patterns:new Map,unitMappings:new Map,namingStyle:"unknown"},s=new ep;for(let i of t){let t=i["戶別"],n=i["樓層"];if(!t)continue;let a={rawUnit:t,floor:n?String(n):void 0,projectName:e},l=s.detectPattern(t,a);if(l){let e=l.rule;r.patterns.has(e.id)||r.patterns.set(e.id,{patternId:e.id,count:0,examples:[],confidence:e.confidence});let s=r.patterns.get(e.id);s.count++,s.examples.length<10&&s.examples.push(t)}r.unitMappings.has(t)||r.unitMappings.set(t,{floors:new Set,rawVariations:new Set([t])});let o=r.unitMappings.get(t);n&&o.floors.add(String(n))}return this.determineNamingStyle(r),this.projectProfiles.set(e,r),r}determineNamingStyle(e){let t=e.patterns.size,r=Array.from(e.patterns.values()).reduce((e,t)=>e+t.count,0);if(0===t){e.namingStyle="unknown";return}let s=null,i=0;for(let t of e.patterns.values())t.count>i&&(i=t.count,s=t);s&&(e.dominantPattern=s.patternId,s.count/r>.8?e.namingStyle="consistent":e.namingStyle="mixed")}getProjectProfile(e){return this.projectProfiles.get(e)}isAmbiguousUnit(e,t){let r=this.projectProfiles.get(e);if(!r)return!1;let s=r.unitMappings.get(t);return!!s&&s.floors.size>1}}class eg{detector;customRules=new Map;constructor(e){this.detector=e,this.initializeCustomRules()}initializeCustomRules(){}applyRules(e){for(let[t,r]of this.customRules){let t=r(e);if(t)return t}let t=this.detector.detectPattern(e.rawUnit,e);if(t){let{rule:r,match:s}=t;return{identifier:r.extract(s,e),confidence:r.confidence,method:`pattern:${r.id}`}}return{identifier:this.simpleFallback(e.rawUnit),confidence:50,method:"fallback"}}simpleFallback(e){return e?e.toUpperCase().replace(/[\uff01-\uff5e]/g,e=>String.fromCharCode(e.charCodeAt(0)-65248)).replace(/\s+/g,"").replace(/[棟樓F室號\-]/g,""):""}}class eb{detector;analyzer;ruleEngine;resolveCache=new Map;constructor(e){console.log("[AdaptiveUnitResolver] 初始化，處理",e.length,"筆資料"),this.detector=new ep,this.analyzer=new ef,this.ruleEngine=new eg(this.detector),this.buildKnowledgeBase(e)}buildKnowledgeBase(e){let t=new Map;for(let r of e){let e=r["建案名稱"];e&&(t.has(e)||t.set(e,[]),t.get(e).push(r))}for(let[e,r]of(console.log("[AdaptiveUnitResolver] 分析",t.size,"個建案"),t))this.analyzer.analyzeProject(e,r)}resolve(e){return this.resolveWithContext(e).identifier}resolveWithContext(e){let t=e["戶別"];t&&"string"==typeof t&&(t=t.trim());let r=e["樓層"],s=e["建案名稱"];if(!t)return{identifier:"",confidence:0,method:"no_input"};let i=`${s}|${t}|${r||""}`;if(this.resolveCache.has(i))return this.resolveCache.get(i);let n={rawUnit:t,floor:r?String(r):void 0,projectName:s},a=this.ruleEngine.applyRules(n);if(a)return this.resolveCache.set(i,a),a;let l={identifier:t,confidence:0,method:"fallback_null"};return this.resolveCache.set(i,l),l}}function ej({transactions:e,project:t}){let[i,n]=(0,s.useState)(""),[a,l]=(0,s.useState)(""),[o,c]=(0,s.useState)(null);return(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-4 bg-zinc-900/30 p-4 rounded-lg border border-white/5",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-sm text-zinc-400 font-semibold",children:"區間均價試算:"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(g.Input,{type:"number",placeholder:"起樓",className:"w-20 h-8 bg-zinc-950/50",value:i,onChange:e=>n(e.target.value)}),(0,r.jsx)("span",{className:"text-zinc-500",children:"~"}),(0,r.jsx)(g.Input,{type:"number",placeholder:"迄樓",className:"w-20 h-8 bg-zinc-950/50",value:a,onChange:e=>l(e.target.value)})]}),(0,r.jsx)(f.Button,{size:"sm",variant:"secondary",onClick:()=>{if(!t||!e)return;let r=parseInt(i),s=parseInt(a);if(isNaN(r)||isNaN(s)||r>s)return void c(null);let n=e.filter(e=>{if(e["建案名稱"]!==t)return!1;let i=parseInt(String(e["樓層"]));return!isNaN(i)&&i>=r&&i<=s});if(0===n.length)return void c({avg:0,count:0});let l=n.reduce((e,t)=>e+(t["房屋總價(萬)"]||0),0),o=n.reduce((e,t)=>e+(t["房屋面積(坪)"]||0),0);c({avg:o>0?l/o:0,count:n.length})},className:"h-8 ml-2",children:"計算"})]}),o&&(0,r.jsxs)("div",{className:"flex items-center gap-4 ml-4 animate-in fade-in",children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{className:"text-xs text-zinc-500",children:"平均單價 (加權)"}),(0,r.jsxs)("span",{className:"text-lg font-bold text-violet-400",children:[o.avg.toFixed(2)," 萬/坪"]})]}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{className:"text-xs text-zinc-500",children:"參考筆數"}),(0,r.jsxs)("span",{className:"text-sm text-zinc-300",children:[o.count," 筆"]})]})]})]})}function ey({data:e}){let[t,i]=(0,s.useState)(""),[n,a]=(0,s.useState)(.3),[l,c]=(0,s.useState)(!1);if((0,s.useEffect)(()=>{e?.priceGridAnalysis?.projectNames?.length&&!t&&i(e.priceGridAnalysis.projectNames[0])},[e,t]),!e?.priceGridAnalysis)return null;let{projectNames:d,byProject:x}=e.priceGridAnalysis,m=s.default.useMemo(()=>{if(!t)return null;if(e.transactionDetails){let{excludeCommercial:r}=o.getState(),s=e.transactionDetails.filter(e=>e["建案名稱"]===t);if(r&&(s=s.filter(e=>{let t=e["主要用途"]||"",r=e["建物型態"]||"",s=e["備註"]||"";return!(t.includes("商業")||r.includes("店")||s.includes("店")||t.includes("辦公")||r.includes("辦公")||r.includes("事務所"))})),s.length>0)try{return function(e,t=.3){let r={},s=new Set,i=new Set,n=new eb(e);if(e.forEach(e=>{let t=e["樓層"]||e.floor||e.layer;if(null==t)return;"number"==typeof t&&(t=String(t)),"number"==typeof t&&(t=String(t));let a=n.resolve(e);s.add(t),i.add(a),r[t]||(r[t]={}),r[t][a]||(r[t][a]=[]);let l=parseFloat(e["房屋單價(萬)"]||e.unitPrice||0),o=parseFloat(e["交易總價(萬)"]||e.totalPrice||0),c=parseFloat(e["房屋總價(萬)"]||e.housePrice||0),d=parseFloat(e["車位總價(萬)"]||e.parkingPrice||0),x=parseFloat(e["房屋面積(坪)"]||e.houseArea||0),m=e["房數"]||e.rooms,u=e["車位類別"]||e.parkingType||"";"string"==typeof u&&u.includes("車位");let h=e["主要用途"]||e.mainPurpose||"",p=e["建物型態"]||e.buildingType||"",f=h.includes("商業")||p.includes("店")||h.includes("店"),g=h.includes("辦公")||p.includes("辦公")||p.includes("事務所");r[t][a].push({...e,unitPrice:l,floor:t,unit:a,isStorefront:f,isOffice:g,hasParking:d>0,tooltipInfo:{totalPrice:o,housePrice:c,parkingPrice:d,houseArea:x,rooms:m}})}),0===s.size)return{horizontalGrid:{},sortedFloors:[],sortedUnits:[],unitColorMap:{},summary:{totalBaselineHousePrice:0,totalPricePremiumValue:0,totalSoldArea:0,transactionCount:0},horizontalComparison:[]};let a=Array.from(s).sort((e,t)=>{let r=e=>e?e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e)||0:0;return r(t)-r(e)}),l=Array.from(i).sort(),o=1/0,c=null;e.forEach(e=>{let t=e["主要用途"]||e.mainPurpose||"",r=e["建物型態"]||e.buildingType||"",s=e["備註"]||e.note||"",i=parseFloat(e["房屋單價(萬)"]||e.unitPrice||0);!(t.includes("商業")||r.includes("店")||s.includes("特殊")||s.includes("親友"))&&i<o&&i>0&&(o=i,c=e)});let d=0,x=0,m=0,u=0;Object.keys(r).forEach(e=>{Object.keys(r[e]).forEach(s=>{r[e][s].forEach((i,n)=>{let a=null;if(c){let e=e=>e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e),r=e(c["樓層"].toString()),s=e(i.floor),n=c["房屋單價(萬)"]*(1+(s-r)*t/100);if(n>0&&(a=(i["房屋單價(萬)"]-n)/n*100,(i===c||.1>Math.abs(i["房屋單價(萬)"]-n))&&(a=0)),i.tooltipInfo.housePrice&&i.tooltipInfo.houseArea){let e=n*i.tooltipInfo.houseArea;d+=e,x+=i.tooltipInfo.housePrice-e,m+=i.tooltipInfo.houseArea,u++}}r[e][s][n].premium=a})})});let h={},p=["#f87171","#fb923c","#fbbf24","#a3e635","#34d399","#22d3ee","#818cf8","#c084fc","#f472b6"];l.forEach((e,t)=>{h[e]=p[t%p.length]});let f={};if(l.forEach(e=>{f[e]={totalPremium:0,totalSoldArea:0,count:0,anchorPrice:null}}),c){let t=e=>e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e),r=t(c["樓層"].toString());e.forEach(e=>{let s=n.resolve(e);t(e["樓層"]?.toString())===r&&(f[s].anchorPrice=parseFloat(e["房屋單價(萬)"]||0))})}Object.keys(r).forEach(e=>{Object.keys(r[e]).forEach(s=>{r[e][s].forEach(e=>{if(null!==e.premium&&e.tooltipInfo.housePrice&&e.tooltipInfo.houseArea){let r=e=>e.startsWith("B")?-parseInt(e.substring(1)):parseInt(e),i=c?r(c["樓層"].toString()):0,n=r(e.floor),a=c?c["房屋單價(萬)"]*(1+(n-i)*t/100):0;if(a>0){let t=a*e.tooltipInfo.houseArea,r=e.tooltipInfo.housePrice-t;f[s]&&(f[s].totalPremium+=r,f[s].totalSoldArea+=e.tooltipInfo.houseArea,f[s].count++)}}})})});let g=Object.keys(f).map(e=>{let t=f[e];return 0===t.count?null:{unitType:e,anchorInfo:t.anchorPrice?`${c["樓層"]}F / ${t.anchorPrice}萬`:"N/A",horizontalPriceDiff:t.totalSoldArea>0?t.totalPremium/t.totalSoldArea:0,unitsSold:t.count,timePremiumContribution:t.totalPremium,contributionPercentage:x>0?t.totalPremium/x*100:0,baselineHousePrice:d,avgPriceAdjustment:t.totalSoldArea>0?t.totalPremium/t.totalSoldArea:0}}).filter(Boolean);return{horizontalGrid:r,sortedFloors:a,sortedUnits:l,unitColorMap:h,summary:{totalBaselineHousePrice:d,totalPricePremiumValue:x,totalSoldArea:m,transactionCount:u},horizontalComparison:g,refFloorForComparison:c?c["樓層"]:"-"}}(s,n)}catch(e){console.error("Heatmap generation error:",e)}}return x[t]&&x[t].horizontalGrid?x[t]:null},[t,x,e.transactionDetails,n]);return(0,r.jsxs)("div",{className:"space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-4 bg-zinc-900/30 p-4 rounded-lg border border-white/5",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-sm text-zinc-400",children:"選擇建案:"}),(0,r.jsx)(p,{value:t,onChange:e=>i(e.target.value),className:"w-[280px] bg-zinc-950/50",children:d.map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("span",{className:"text-sm text-zinc-400",children:"樓層價差:"}),(0,r.jsx)("input",{type:"range",min:0,max:10,step:.05,value:n,onChange:e=>a(Number(e.target.value)),className:"w-28 accent-violet-500"}),(0,r.jsx)(g.Input,{type:"number",min:0,max:10,step:.01,value:n,onChange:e=>a(Math.max(0,Number(e.target.value))),className:"w-20 h-8 bg-zinc-950/50 text-right pr-2"}),(0,r.jsx)("span",{className:"text-sm font-mono text-violet-400 w-12",children:"萬/坪"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 ml-auto",children:[(0,r.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>{console.log(`Re-analyzing ${t} with floor premium: ${n}%`)},className:"border-violet-500/30 text-violet-400 hover:bg-violet-500/10",children:[(0,r.jsx)(eu,{className:"mr-2 h-4 w-4"}),"重新分析"]}),(0,r.jsxs)(f.Button,{variant:"outline",size:"sm",onClick:()=>{c(!0);let e=`${window.location.origin}?project=${encodeURIComponent(t)}&floorPremium=${n}`;navigator.clipboard.writeText(e).then(()=>{setTimeout(()=>c(!1),2e3)})},className:"border-cyan-500/30 text-cyan-400 hover:bg-cyan-500/10",children:[(0,r.jsx)(eh,{className:"mr-2 h-4 w-4"}),l?"已複製!":"分享連結"]})]})]}),t&&e.transactionDetails&&(0,r.jsx)(ej,{transactions:e.transactionDetails,project:t}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-4 p-4 bg-zinc-900/20 rounded-lg border border-white/5",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-xs text-zinc-500",children:"溢價圖例:"}),(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"w-4 h-4 rounded bg-red-500/80"}),(0,r.jsx)("span",{className:"text-xs text-zinc-400",children:"> 5%"})]}),(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"w-4 h-4 rounded bg-orange-500/80"}),(0,r.jsx)("span",{className:"text-xs text-zinc-400",children:"2-5%"})]}),(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"w-4 h-4 rounded bg-yellow-500/80"}),(0,r.jsx)("span",{className:"text-xs text-zinc-400",children:"0-2%"})]}),(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"w-4 h-4 rounded bg-green-500/80"}),(0,r.jsx)("span",{className:"text-xs text-zinc-400",children:"< 0%"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 ml-auto",children:[(0,r.jsx)("span",{className:"text-xs text-zinc-500",children:"特殊交易:"}),(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"w-4 h-4 rounded bg-amber-600"}),(0,r.jsx)("span",{className:"text-xs text-zinc-400",children:"店舖"})]}),(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"w-4 h-4 rounded bg-blue-600"}),(0,r.jsx)("span",{className:"text-xs text-zinc-400",children:"辦公室"})]}),(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{className:"w-4 h-4 rounded bg-purple-600"}),(0,r.jsx)("span",{className:"text-xs text-zinc-400",children:"廠辦"})]})]})]}),(0,r.jsx)($,{title:"建案銷控表與調價熱力圖",description:"可視化建案各戶別的銷售狀況與價格調整幅度",children:m?(0,r.jsx)(em,{data:m,floorPremium:n}):(0,r.jsx)("div",{className:"text-zinc-500 text-center p-12",children:"請選擇建案以查看銷控表"})})]})}let eN=(0,d.default)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);var ev=e.i(89950),ew=e.i(60459);let ez=(0,d.default)("table-2",[["path",{d:"M9 3H5a2 2 0 0 0-2 2v4m6-6h10a2 2 0 0 1 2 2v4M9 3v18m0 0h10a2 2 0 0 0 2-2V9M9 21H5a2 2 0 0 1-2-2V9m0 0h18",key:"gugj83"}]]);function eP({isOpen:e,onClose:t,title:s,children:i,className:n,maxWidth:a="max-w-4xl"}){return e?(0,r.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70 backdrop-blur-sm animate-in fade-in duration-200",children:[(0,r.jsx)("div",{className:"absolute inset-0",onClick:t}),(0,r.jsxs)(_,{className:(0,c.cn)("relative w-full max-h-[90vh] flex flex-col overflow-hidden animate-in zoom-in-95 duration-200",a,n),onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-border-default",children:[s&&(0,r.jsx)("h2",{className:"text-2xl font-bold text-white",children:s}),(0,r.jsx)("button",{onClick:t,className:"p-1 rounded-full hover:bg-white/10 transition-colors text-gray-400 hover:text-white",children:(0,r.jsx)(x,{size:24})})]}),(0,r.jsx)("div",{className:"p-6 overflow-y-auto custom-scrollbar",children:i})]})]}):null}function ek({data:e,trigger:t}){let i=o(),[n,a]=(0,s.useState)([]),[l,d]=(0,s.useState)(!1),[m,u]=(0,s.useState)(null),[p,f]=(0,s.useState)(1),[g,b]=(0,s.useState)(new Set),[j,y]=(0,s.useState)({key:"",direction:null}),[N,v]=(0,s.useState)(""),[w,k]=(0,s.useState)("建案名稱"),[S,A]=(0,s.useState)(!1),[F,I]=(0,s.useState)([]),[_,E]=(0,s.useState)(!1),[T,D]=(0,s.useState)(""),q=(0,s.useCallback)(async()=>{d(!0),u(null),a([]);try{let{counties:e,districts:t,transactionType:r,dateRange:s,startDate:n,endDate:l,projectNames:o,buildingType:c}=i;if(0===e.length)return void d(!1);let x=n,m=l;if("custom"!==s){let e=R(s);e.startDate&&(x=e.startDate),e.endDate&&(m=e.endDate)}let u=e.map(async e=>{let s=P[e],i=z[e]||[],n=t.filter(e=>i.includes(e)),a={countyCode:s,districts:n.length>0?n:void 0,type:r,dateStart:x,dateEnd:m,projectNames:o,buildingType:c};try{return await C(a,{page:1,limit:1e3})}catch(t){return console.warn(`Fetch failed for ${e}`,t),{data:[],count:0}}}),h=await Promise.all(u),p=[];h.forEach(e=>{e&&Array.isArray(e.data)&&(p=[...p,...e.data])}),p.sort((e,t)=>{let r=e["交易日"]||"";return(t["交易日"]||"").localeCompare(r)}),a(p)}catch(e){console.error("Data List fetch failed:",e),u(e.message||"讀取交易資料失敗")}finally{d(!1)}},[i]);(0,s.useEffect)(()=>{t&&q()},[q,t]);let Z=async e=>{if(!e.編號||!e.縣市代碼)return;let t=e["交易類型"]||i.transactionType;D(`車位/附表明細 - ${e["建案名稱"]||e["編號"]}`),E(!0),A(!0),I([]);try{let r=await M(e.編號,t,e.縣市代碼),s=[];if(r.park&&Array.isArray(r.park)&&r.park.length>0&&(s=[...s,...r.park.map(e=>({...e,_category:"車位資料"}))]),r.build&&Array.isArray(r.build)&&r.build.length>0&&(s=[...s,...r.build.map(e=>({...e,_category:"建物明細"}))]),Array.isArray(r)&&0===s.length?s=[...s,...r]:r.data&&Array.isArray(r.data)&&0===s.length&&(s=[...s,...r.data]),0===s.length){let t=e["車位數"]&&Number(e["車位數"])>0,r=e["車位總價"]||e["車位總價(萬)"];if(t||r){let t=e["車位總價"]?Number(e["車位總價"]):e["車位總價(萬)"]?1e4*Number(e["車位總價(萬)"]):0,r=e["車位總面積"]?Number(e["車位總面積"]):e["車位面積"]?Number(e["車位面積"]):0;s.push({車位類別:e["車位類別"]||"無資料",車位價格:t,車位面積:r,車位樓層:"-","車位價格(萬)":e["車位總價(萬)"]||t/1e4,"車位面積(坪)":e["車位面積(坪)"]||(r/3.30579).toFixed(2),編號:e["編號"],_category:"車位資料(來自交易明細)"})}}I(s)}catch(t){if(console.error(t),e["車位數"]&&Number(e["車位數"])>0){let t=e["車位總價"]?Number(e["車位總價"]):e["車位總價(萬)"]?1e4*Number(e["車位總價(萬)"]):0;I([{車位類別:e["車位類別"]||"無資料",車位價格:t,車位面積:e["車位總面積"]||0,編號:e["編號"],_category:"車位資料(來自交易明細)"}])}else I([])}finally{E(!1)}},V=[{key:"行政區",label:"行政區",sortable:!0},{key:"建案名稱",label:"建案名稱",sortable:!0},{key:"交易日",label:"交易日",sortable:!0},{key:"交易筆棟數",label:"交易筆棟數",sortable:!1},{key:"主要用途",label:"主要用途",sortable:!1},{key:"建物型態",label:"建物型態",sortable:!1},{key:"戶型",label:"戶型",sortable:!0},{key:"樓層",label:"樓層",sortable:!0},{key:"房屋面積(坪)",label:"坪數",sortable:!0},{key:"房屋單價(萬)",label:"單價",sortable:!0}],U=["編號","地址","總樓層","交易總價(萬)","房屋總價(萬)","車位總價(萬)","房數","廳數","衛浴數","備註","解約情形","戶別","主要用途","建物型態","車位類別","車位價格","車位面積","主建物面積","附屬建物面積","陽台面積"],W=e=>null==e||""===e?"-":"number"==typeof e?Number.isInteger(e)?e.toLocaleString():e.toFixed(2):String(e),H=(0,s.useMemo)(()=>{let e=[...n];if(N.trim()){let t=N.toLowerCase();e=e.filter(e=>{let r=e[w];return null!=r&&String(r).toLowerCase().includes(t)})}return j.key&&j.direction&&e.sort((e,t)=>{let r=e[j.key],s=t[j.key];if(null==r&&null==s)return 0;if(null==r)return 1;if(null==s)return -1;if("number"==typeof r&&"number"==typeof s)return"asc"===j.direction?r-s:s-r;let i=String(r),n=String(s);return"asc"===j.direction?i.localeCompare(n,"zh-TW"):n.localeCompare(i,"zh-TW")}),e},[n,N,w,j]),K=Math.ceil(H.length/20),G=(p-1)*20,J=G+20,Y=H.slice(G,J);return l?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-20",children:[(0,r.jsx)(ew.Loader2,{className:"h-8 w-8 animate-spin text-violet-500 mb-2"}),(0,r.jsx)("p",{className:"text-zinc-500 text-sm",children:"正在載入交易資料相關明細..."})]}):m?(0,r.jsxs)("div",{className:"text-center p-12 text-red-400",children:[(0,r.jsxs)("p",{children:["載入失敗: ",m]}),(0,r.jsx)("button",{onClick:()=>q(),className:"mt-4 px-4 py-2 bg-zinc-800 rounded hover:bg-zinc-700",children:"重試"})]}):n&&0!==n.length?(0,r.jsxs)("div",{className:"space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[(0,r.jsxs)("div",{className:"flex flex-wrap gap-3 items-center p-3 bg-zinc-900/50 rounded-lg border border-white/5",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-1 min-w-[200px]",children:[(0,r.jsx)(ev.Search,{size:16,className:"text-zinc-500"}),(0,r.jsx)("input",{type:"text",value:N,onChange:e=>{v(e.target.value),f(1)},placeholder:`搜尋 ${w}...`,className:"flex-1 bg-transparent border-none outline-none text-white placeholder-zinc-500 text-sm"}),N&&(0,r.jsx)("button",{onClick:()=>v(""),className:"text-zinc-500 hover:text-white",children:(0,r.jsx)(x,{size:14})})]}),(0,r.jsxs)("select",{value:w,onChange:e=>k(e.target.value),className:"bg-zinc-800 border border-zinc-700 rounded px-2 py-1 text-sm text-zinc-300",children:[(0,r.jsx)("option",{value:"建案名稱",children:"建案名稱"}),(0,r.jsx)("option",{value:"行政區",children:"行政區"}),(0,r.jsx)("option",{value:"戶型",children:"戶型"}),(0,r.jsx)("option",{value:"主要用途",children:"主要用途"})]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center text-sm text-zinc-400",children:[(0,r.jsxs)("span",{children:["共 ",(0,r.jsx)("span",{className:"text-white font-semibold",children:H.length.toLocaleString()})," 筆資料 ",N&&(0,r.jsx)("span",{className:"text-zinc-500",children:"(已篩選)"})]}),(0,r.jsxs)("span",{children:["第 ",p," / ",K||1," 頁"]})]}),(0,r.jsx)($,{title:"交易資料明細",description:"點擊表頭可排序，點擊「明細」可展開詳細資訊",children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,r.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold sticky top-0",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-3 py-3 w-28 text-center",children:"操作"}),V.map(e=>{var t;return(0,r.jsx)("th",{className:(0,c.cn)("px-3 py-3 whitespace-nowrap",e.sortable&&"cursor-pointer select-none group hover:text-white transition-colors"),onClick:()=>{var t;return e.sortable&&(t=e.key,void(y(e=>{if(e.key===t){if("asc"===e.direction)return{key:t,direction:"desc"};if("desc"===e.direction)return{key:"",direction:null}}return{key:t,direction:"asc"}}),f(1)))},children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[e.label,e.sortable&&(t=e.key,j.key!==t?(0,r.jsx)(B,{size:12,className:"opacity-30 group-hover:opacity-70"}):"asc"===j.direction?(0,r.jsx)(eN,{size:12,className:"text-violet-400"}):(0,r.jsx)(h.ChevronDown,{size:12,className:"text-violet-400"}))]})},e.key)})]})}),(0,r.jsxs)("tbody",{className:"divide-y divide-white/5",children:[Y.map((e,t)=>{let i=G+t,n=g.has(i);return(0,r.jsxs)(s.default.Fragment,{children:[(0,r.jsxs)("tr",{className:(0,c.cn)("hover:bg-zinc-800/50 transition-colors",n&&"bg-zinc-800/30"),children:[(0,r.jsx)("td",{className:"px-3 py-2",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 justify-center",children:[(0,r.jsxs)("button",{onClick:()=>Z(e),className:"px-2 py-1 rounded text-xs font-medium bg-cyan-900/30 text-cyan-400 hover:bg-cyan-900/50 hover:text-cyan-300 transition-colors flex items-center gap-1 border border-cyan-800/50",title:"查看車位或其他附表資料",children:[(0,r.jsx)(ez,{size:12}),"附表"]}),(0,r.jsxs)("button",{onClick:()=>{b(e=>{let t=new Set(e);return t.has(i)?t.delete(i):t.add(i),t})},className:(0,c.cn)("flex items-center gap-1 px-2 py-1 rounded text-xs font-medium transition-colors border",n?"bg-violet-500/20 text-violet-300 border-violet-500/30":"bg-zinc-800 text-zinc-400 border-zinc-700 hover:bg-zinc-700 hover:text-zinc-200"),children:[n?(0,r.jsx)(eN,{size:12}):(0,r.jsx)(h.ChevronDown,{size:12}),"明細"]})]})}),V.map(t=>(0,r.jsx)("td",{className:"px-3 py-2 whitespace-nowrap",children:"戶型"===t.key?(0,r.jsx)("span",{className:"cursor-help border-b border-dotted border-zinc-600",title:`原始戶別: ${e["戶別"]||"無資料"}`,children:W(e[t.key])}):(0,r.jsx)("span",{className:(0,c.cn)("房屋單價(萬)"===t.key&&"font-mono text-violet-400","建案名稱"===t.key&&"font-medium text-white"),children:W(e[t.key])})},t.key))]}),n&&(0,r.jsx)("tr",{className:"bg-zinc-900/50",children:(0,r.jsx)("td",{colSpan:V.length+1,className:"px-4 py-4",children:(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3",children:U.map(t=>t in e?(0,r.jsxs)("div",{className:"bg-zinc-800/50 rounded p-2",children:[(0,r.jsx)("div",{className:"text-xs text-zinc-500 mb-1",children:t}),(0,r.jsx)("div",{className:"text-sm text-zinc-200 font-mono",children:W(e[t])})]},t):null)})})})]},i)}),0===Y.length&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:V.length+1,className:"text-center py-8 text-zinc-500",children:"無符合條件的資料"})})]})]})})}),(0,r.jsxs)("div",{className:"flex justify-between items-center pt-4 border-t border-white/5",children:[(0,r.jsxs)("div",{className:"text-sm text-zinc-500",children:["顯示第 ",H.length>0?G+1:0," - ",Math.min(J,H.length)," 筆"]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{onClick:()=>f(e=>Math.max(1,e-1)),disabled:1===p,className:"p-2 rounded bg-zinc-800 text-zinc-300 hover:bg-zinc-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,r.jsx)(L.ChevronLeft,{size:16})}),(0,r.jsx)("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,K||1)},(e,t)=>{let s,i=K||1;return(s=i<=5||p<=3?t+1:p>=i-2?i-4+t:p-2+t)<1||s>i?null:(0,r.jsx)("button",{onClick:()=>f(s),className:(0,c.cn)("w-8 h-8 rounded text-sm font-medium transition-colors",p===s?"bg-violet-500 text-white":"bg-zinc-800 text-zinc-400 hover:bg-zinc-700"),children:s},s)})}),(0,r.jsx)("button",{onClick:()=>f(e=>Math.min(K||1,e+1)),disabled:p===K||0===K,className:"p-2 rounded bg-zinc-800 text-zinc-300 hover:bg-zinc-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:(0,r.jsx)(O,{size:16})})]})]}),(0,r.jsx)(eP,{isOpen:S,onClose:()=>A(!1),className:"max-w-5xl",title:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(ez,{className:"text-cyan-400"}),(0,r.jsx)("span",{children:T})]}),children:_?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,r.jsx)(ew.Loader2,{className:"h-8 w-8 animate-spin text-cyan-400 mb-3"}),(0,r.jsx)("p",{className:"text-zinc-500 text-sm animate-pulse",children:"正在讀取附表資料..."})]}):F.length>0?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"bg-zinc-800/30 rounded-lg overflow-hidden border border-white/5",children:(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm text-left",children:[(0,r.jsx)("thead",{className:"bg-zinc-900/80 text-zinc-400 uppercase text-xs font-semibold",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-3 whitespace-nowrap bg-zinc-900 text-cyan-400",children:"類別"}),Object.keys(F[0]).filter(e=>"id"!==e&&"編號"!==e&&"created_at"!==e&&"_category"!==e&&"車位價格"!==e&&"車位面積"!==e).map(e=>(0,r.jsx)("th",{className:"px-4 py-3 whitespace-nowrap bg-zinc-900",children:e},e))]})}),(0,r.jsx)("tbody",{className:"divide-y divide-white/5",children:F.map((e,t)=>(0,r.jsxs)("tr",{className:"hover:bg-zinc-800/50 transition-colors",children:[(0,r.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-cyan-400 font-medium",children:e._category||"附表"}),Object.keys(e).filter(e=>"id"!==e&&"編號"!==e&&"created_at"!==e&&"_category"!==e&&"車位價格"!==e&&"車位面積"!==e).map(t=>(0,r.jsx)("td",{className:"px-4 py-3 whitespace-nowrap text-zinc-300",children:W(e[t])},t))]},t))})]})})}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)("button",{onClick:()=>A(!1),className:"px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-sm text-white rounded transition-colors",children:"關閉"})})]}):(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-zinc-500",children:[(0,r.jsx)("div",{className:"bg-zinc-800/50 p-4 rounded-full mb-3",children:(0,r.jsx)(ez,{size:24,className:"opacity-20"})}),(0,r.jsx)("p",{children:"此筆交易沒有相關附表資料"})]})})]}):(0,r.jsx)("div",{className:"text-center p-12 text-zinc-500",children:"無交易資料可顯示"})}let eS=(0,d.default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);function eA(e,t,{checkForDefaultPrevented:r=!0}={}){return function(s){if(e?.(s),!1===r||!s.defaultPrevented)return t?.(s)}}function eC(e,t=[]){let i=[],n=()=>{let t=i.map(e=>s.createContext(e));return function(r){let i=r?.[e]||t;return s.useMemo(()=>({[`__scope${e}`]:{...r,[e]:i}}),[r,i])}};return n.scopeName=e,[function(t,n){let a=s.createContext(n),l=i.length;i=[...i,n];let o=t=>{let{scope:i,children:n,...o}=t,c=i?.[e]?.[l]||a,d=s.useMemo(()=>o,Object.values(o));return(0,r.jsx)(c.Provider,{value:d,children:n})};return o.displayName=t+"Provider",[o,function(r,i){let o=i?.[e]?.[l]||a,c=s.useContext(o);if(c)return c;if(void 0!==n)return n;throw Error(`\`${r}\` must be used within \`${t}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let r=()=>{let r=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let i=r.reduce((t,{useScope:r,scopeName:s})=>{let i=r(e)[`__scope${s}`];return{...t,...i}},{});return s.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return r.scopeName=t.scopeName,r}(n,...t)]}"u">typeof window&&window.document&&window.document.createElement;var eM=e.i(33142);function eF(e){var t;let i,n=(t=e,(i=s.forwardRef((e,t)=>{let{children:r,...i}=e;if(s.isValidElement(r)){var n;let e,a,l=(n=r,(a=(e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?n.ref:(a=(e=Object.getOwnPropertyDescriptor(n,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?n.props.ref:n.props.ref||n.ref),o=function(e,t){let r={...t};for(let s in t){let i=e[s],n=t[s];/^on[A-Z]/.test(s)?i&&n?r[s]=(...e)=>{let t=n(...e);return i(...e),t}:i&&(r[s]=i):"style"===s?r[s]={...i,...n}:"className"===s&&(r[s]=[i,n].filter(Boolean).join(" "))}return{...e,...r}}(i,r.props);return r.type!==s.Fragment&&(o.ref=t?(0,eM.composeRefs)(t,l):l),s.cloneElement(r,o)}return s.Children.count(r)>1?s.Children.only(null):null})).displayName=`${t}.SlotClone`,i),a=s.forwardRef((e,t)=>{let{children:i,...a}=e,l=s.Children.toArray(i),o=l.find(eI);if(o){let e=o.props.children,i=l.map(t=>t!==o?t:s.Children.count(e)>1?s.Children.only(null):s.isValidElement(e)?e.props.children:null);return(0,r.jsx)(n,{...a,ref:t,children:s.isValidElement(e)?s.cloneElement(e,void 0,i):null})}return(0,r.jsx)(n,{...a,ref:t,children:i})});return a.displayName=`${e}.Slot`,a}var eR=Symbol("radix.slottable");function eI(e){return s.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===eR}var e_=new WeakMap;function e$(e,t){var r,s;let i,n,a;if("at"in Array.prototype)return Array.prototype.at.call(e,t);let l=(r=e,s=t,i=r.length,(a=(n=eE(s))>=0?n:i+n)<0||a>=i?-1:a);return -1===l?void 0:e[l]}function eE(e){return e!=e||0===e?0:Math.trunc(e)}(class e extends Map{#e;constructor(e){super(e),this.#e=[...super.keys()],e_.set(this,!0)}set(e,t){return e_.get(this)&&(this.has(e)?this.#e[this.#e.indexOf(e)]=e:this.#e.push(e)),super.set(e,t),this}insert(e,t,r){let s,i=this.has(t),n=this.#e.length,a=eE(e),l=a>=0?a:n+a,o=l<0||l>=n?-1:l;if(o===this.size||i&&o===this.size-1||-1===o)return this.set(t,r),this;let c=this.size+ +!i;a<0&&l++;let d=[...this.#e],x=!1;for(let e=l;e<c;e++)if(l===e){let n=d[e];d[e]===t&&(n=d[e+1]),i&&this.delete(t),s=this.get(n),this.set(t,r)}else{x||d[e-1]!==t||(x=!0);let r=d[x?e:e-1],i=s;s=this.get(r),this.delete(r),this.set(r,i)}return this}with(t,r,s){let i=new e(this);return i.insert(t,r,s),i}before(e){let t=this.#e.indexOf(e)-1;if(!(t<0))return this.entryAt(t)}setBefore(e,t,r){let s=this.#e.indexOf(e);return -1===s?this:this.insert(s,t,r)}after(e){let t=this.#e.indexOf(e);if(-1!==(t=-1===t||t===this.size-1?-1:t+1))return this.entryAt(t)}setAfter(e,t,r){let s=this.#e.indexOf(e);return -1===s?this:this.insert(s+1,t,r)}first(){return this.entryAt(0)}last(){return this.entryAt(-1)}clear(){return this.#e=[],super.clear()}delete(e){let t=super.delete(e);return t&&this.#e.splice(this.#e.indexOf(e),1),t}deleteAt(e){let t=this.keyAt(e);return void 0!==t&&this.delete(t)}at(e){let t=e$(this.#e,e);if(void 0!==t)return this.get(t)}entryAt(e){let t=e$(this.#e,e);if(void 0!==t)return[t,this.get(t)]}indexOf(e){return this.#e.indexOf(e)}keyAt(e){return e$(this.#e,e)}from(e,t){let r=this.indexOf(e);if(-1===r)return;let s=r+t;return s<0&&(s=0),s>=this.size&&(s=this.size-1),this.at(s)}keyFrom(e,t){let r=this.indexOf(e);if(-1===r)return;let s=r+t;return s<0&&(s=0),s>=this.size&&(s=this.size-1),this.keyAt(s)}find(e,t){let r=0;for(let s of this){if(Reflect.apply(e,t,[s,r,this]))return s;r++}}findIndex(e,t){let r=0;for(let s of this){if(Reflect.apply(e,t,[s,r,this]))return r;r++}return -1}filter(t,r){let s=[],i=0;for(let e of this)Reflect.apply(t,r,[e,i,this])&&s.push(e),i++;return new e(s)}map(t,r){let s=[],i=0;for(let e of this)s.push([e[0],Reflect.apply(t,r,[e,i,this])]),i++;return new e(s)}reduce(...e){let[t,r]=e,s=0,i=r??this.at(0);for(let r of this)i=0===s&&1===e.length?r:Reflect.apply(t,this,[i,r,s,this]),s++;return i}reduceRight(...e){let[t,r]=e,s=r??this.at(-1);for(let r=this.size-1;r>=0;r--){let i=this.at(r);s=r===this.size-1&&1===e.length?i:Reflect.apply(t,this,[s,i,r,this])}return s}toSorted(t){return new e([...this.entries()].sort(t))}toReversed(){let t=new e;for(let e=this.size-1;e>=0;e--){let r=this.keyAt(e),s=this.get(r);t.set(r,s)}return t}toSpliced(...t){let r=[...this.entries()];return r.splice(...t),new e(r)}slice(t,r){let s=new e,i=this.size-1;if(void 0===t)return s;t<0&&(t+=this.size),void 0!==r&&r>0&&(i=r-1);for(let e=t;e<=i;e++){let t=this.keyAt(e),r=this.get(t);s.set(t,r)}return s}every(e,t){let r=0;for(let s of this){if(!Reflect.apply(e,t,[s,r,this]))return!1;r++}return!0}some(e,t){let r=0;for(let s of this){if(Reflect.apply(e,t,[s,r,this]))return!0;r++}return!1}});var eT=globalThis?.document?s.useLayoutEffect:()=>{},eD=s[" useId ".trim().toString()]||(()=>void 0),eL=0;function eO(e){let[t,r]=s.useState(eD());return eT(()=>{e||r(e=>e??String(eL++))},[e]),e||(t?`radix-${t}`:"")}var eB=Symbol("radix.slottable");function eq(e){return s.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===eB}var eZ=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{var i,n;let a,l,o,c=(n=i=`Primitive.${t}`,(a=s.forwardRef((e,t)=>{let{children:r,...i}=e;if(s.isValidElement(r)){var n;let e,a,l=(n=r,(a=(e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?n.ref:(a=(e=Object.getOwnPropertyDescriptor(n,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?n.props.ref:n.props.ref||n.ref),o=function(e,t){let r={...t};for(let s in t){let i=e[s],n=t[s];/^on[A-Z]/.test(s)?i&&n?r[s]=(...e)=>{let t=n(...e);return i(...e),t}:i&&(r[s]=i):"style"===s?r[s]={...i,...n}:"className"===s&&(r[s]=[i,n].filter(Boolean).join(" "))}return{...e,...r}}(i,r.props);return r.type!==s.Fragment&&(o.ref=t?(0,eM.composeRefs)(t,l):l),s.cloneElement(r,o)}return s.Children.count(r)>1?s.Children.only(null):null})).displayName=`${n}.SlotClone`,l=a,(o=s.forwardRef((e,t)=>{let{children:i,...n}=e,a=s.Children.toArray(i),o=a.find(eq);if(o){let e=o.props.children,i=a.map(t=>t!==o?t:s.Children.count(e)>1?s.Children.only(null):s.isValidElement(e)?e.props.children:null);return(0,r.jsx)(l,{...n,ref:t,children:s.isValidElement(e)?s.cloneElement(e,void 0,i):null})}return(0,r.jsx)(l,{...n,ref:t,children:i})})).displayName=`${i}.Slot`,o),d=s.forwardRef((e,s)=>{let{asChild:i,...n}=e;return"u">typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,r.jsx)(i?c:t,{...n,ref:s})});return d.displayName=`Primitive.${t}`,{...e,[t]:d}},{});s[" useEffectEvent ".trim().toString()],s[" useInsertionEffect ".trim().toString()];var eV=s[" useInsertionEffect ".trim().toString()]||eT;function eU({prop:e,defaultProp:t,onChange:r=()=>{},caller:i}){let[n,a,l]=function({defaultProp:e,onChange:t}){let[r,i]=s.useState(e),n=s.useRef(r),a=s.useRef(t);return eV(()=>{a.current=t},[t]),s.useEffect(()=>{n.current!==r&&(a.current?.(r),n.current=r)},[r,n]),[r,i,a]}({defaultProp:t,onChange:r}),o=void 0!==e,c=o?e:n;{let t=s.useRef(void 0!==e);s.useEffect(()=>{let e=t.current;if(e!==o){let t=o?"controlled":"uncontrolled";console.warn(`${i} is changing from ${e?"controlled":"uncontrolled"} to ${t}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`)}t.current=o},[o,i])}return[c,s.useCallback(t=>{if(o){let r="function"==typeof t?t(e):t;r!==e&&l.current?.(r)}else a(t)},[o,e,a,l])]}Symbol("RADIX:SYNC_STATE");var eW=s.createContext(void 0);function eH(e){let t=s.useContext(eW);return e||t||"ltr"}var eK="rovingFocusGroup.onEntryFocus",eG={bubbles:!1,cancelable:!0},eJ="RovingFocusGroup",[eY,eX,eQ]=function(e){let t=e+"CollectionProvider",[i,n]=eC(t),[a,l]=i(t,{collectionRef:{current:null},itemMap:new Map}),o=e=>{let{scope:t,children:i}=e,n=s.default.useRef(null),l=s.default.useRef(new Map).current;return(0,r.jsx)(a,{scope:t,itemMap:l,collectionRef:n,children:i})};o.displayName=t;let c=e+"CollectionSlot",d=eF(c),x=s.default.forwardRef((e,t)=>{let{scope:s,children:i}=e,n=l(c,s),a=(0,eM.useComposedRefs)(t,n.collectionRef);return(0,r.jsx)(d,{ref:a,children:i})});x.displayName=c;let m=e+"CollectionItemSlot",u="data-radix-collection-item",h=eF(m),p=s.default.forwardRef((e,t)=>{let{scope:i,children:n,...a}=e,o=s.default.useRef(null),c=(0,eM.useComposedRefs)(t,o),d=l(m,i);return s.default.useEffect(()=>(d.itemMap.set(o,{ref:o,...a}),()=>void d.itemMap.delete(o))),(0,r.jsx)(h,{...{[u]:""},ref:c,children:n})});return p.displayName=m,[{Provider:o,Slot:x,ItemSlot:p},function(t){let r=l(e+"CollectionConsumer",t);return s.default.useCallback(()=>{let e=r.collectionRef.current;if(!e)return[];let t=Array.from(e.querySelectorAll(`[${u}]`));return Array.from(r.itemMap.values()).sort((e,r)=>t.indexOf(e.ref.current)-t.indexOf(r.ref.current))},[r.collectionRef,r.itemMap])},n]}(eJ),[e0,e1]=eC(eJ,[eQ]),[e2,e5]=e0(eJ),e4=s.forwardRef((e,t)=>(0,r.jsx)(eY.Provider,{scope:e.__scopeRovingFocusGroup,children:(0,r.jsx)(eY.Slot,{scope:e.__scopeRovingFocusGroup,children:(0,r.jsx)(e3,{...e,ref:t})})}));e4.displayName=eJ;var e3=s.forwardRef((e,t)=>{let i,{__scopeRovingFocusGroup:n,orientation:a,loop:l=!1,dir:o,currentTabStopId:c,defaultCurrentTabStopId:d,onCurrentTabStopIdChange:x,onEntryFocus:m,preventScrollOnEntryFocus:u=!1,...h}=e,p=s.useRef(null),f=(0,eM.useComposedRefs)(t,p),g=eH(o),[b,j]=eU({prop:c,defaultProp:d??null,onChange:x,caller:eJ}),[y,N]=s.useState(!1),v=(i=s.useRef(m),s.useEffect(()=>{i.current=m}),s.useMemo(()=>(...e)=>i.current?.(...e),[])),w=eX(n),z=s.useRef(!1),[P,k]=s.useState(0);return s.useEffect(()=>{let e=p.current;if(e)return e.addEventListener(eK,v),()=>e.removeEventListener(eK,v)},[v]),(0,r.jsx)(e2,{scope:n,orientation:a,dir:g,loop:l,currentTabStopId:b,onItemFocus:s.useCallback(e=>j(e),[j]),onItemShiftTab:s.useCallback(()=>N(!0),[]),onFocusableItemAdd:s.useCallback(()=>k(e=>e+1),[]),onFocusableItemRemove:s.useCallback(()=>k(e=>e-1),[]),children:(0,r.jsx)(eZ.div,{tabIndex:y||0===P?-1:0,"data-orientation":a,...h,ref:f,style:{outline:"none",...e.style},onMouseDown:eA(e.onMouseDown,()=>{z.current=!0}),onFocus:eA(e.onFocus,e=>{let t=!z.current;if(e.target===e.currentTarget&&t&&!y){let t=new CustomEvent(eK,eG);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){let e=w().filter(e=>e.focusable);e7([e.find(e=>e.active),e.find(e=>e.id===b),...e].filter(Boolean).map(e=>e.ref.current),u)}}z.current=!1}),onBlur:eA(e.onBlur,()=>N(!1))})})}),e9="RovingFocusGroupItem",e8=s.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:i,focusable:n=!0,active:a=!1,tabStopId:l,children:o,...c}=e,d=eO(),x=l||d,m=e5(e9,i),u=m.currentTabStopId===x,h=eX(i),{onFocusableItemAdd:p,onFocusableItemRemove:f,currentTabStopId:g}=m;return s.useEffect(()=>{if(n)return p(),()=>f()},[n,p,f]),(0,r.jsx)(eY.ItemSlot,{scope:i,id:x,focusable:n,active:a,children:(0,r.jsx)(eZ.span,{tabIndex:u?0:-1,"data-orientation":m.orientation,...c,ref:t,onMouseDown:eA(e.onMouseDown,e=>{n?m.onItemFocus(x):e.preventDefault()}),onFocus:eA(e.onFocus,()=>m.onItemFocus(x)),onKeyDown:eA(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey)return void m.onItemShiftTab();if(e.target!==e.currentTarget)return;let t=function(e,t,r){var s;let i=(s=e.key,"rtl"!==r?s:"ArrowLeft"===s?"ArrowRight":"ArrowRight"===s?"ArrowLeft":s);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(i))&&!("horizontal"===t&&["ArrowUp","ArrowDown"].includes(i)))return e6[i]}(e,m.orientation,m.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let i=h().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)i.reverse();else if("prev"===t||"next"===t){var r,s;"prev"===t&&i.reverse();let n=i.indexOf(e.currentTarget);i=m.loop?(r=i,s=n+1,r.map((e,t)=>r[(s+t)%r.length])):i.slice(n+1)}setTimeout(()=>e7(i))}}),children:"function"==typeof o?o({isCurrentTabStop:u,hasTabStop:null!=g}):o})})});e8.displayName=e9;var e6={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function e7(e,t=!1){let r=document.activeElement;for(let s of e)if(s===r||(s.focus({preventScroll:t}),document.activeElement!==r))return}var te=e=>{var t;let r,i,{present:n,children:a}=e,l=function(e){var t,r;let[i,n]=s.useState(),a=s.useRef(null),l=s.useRef(e),o=s.useRef("none"),[c,d]=(t=e?"mounted":"unmounted",r={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},s.useReducer((e,t)=>r[e][t]??e,t));return s.useEffect(()=>{let e=tt(a.current);o.current="mounted"===c?e:"none"},[c]),eT(()=>{let t=a.current,r=l.current;if(r!==e){let s=o.current,i=tt(t);e?d("MOUNT"):"none"===i||t?.display==="none"?d("UNMOUNT"):r&&s!==i?d("ANIMATION_OUT"):d("UNMOUNT"),l.current=e}},[e,d]),eT(()=>{if(i){let e,t=i.ownerDocument.defaultView??window,r=r=>{let s=tt(a.current).includes(CSS.escape(r.animationName));if(r.target===i&&s&&(d("ANIMATION_END"),!l.current)){let r=i.style.animationFillMode;i.style.animationFillMode="forwards",e=t.setTimeout(()=>{"forwards"===i.style.animationFillMode&&(i.style.animationFillMode=r)})}},s=e=>{e.target===i&&(o.current=tt(a.current))};return i.addEventListener("animationstart",s),i.addEventListener("animationcancel",r),i.addEventListener("animationend",r),()=>{t.clearTimeout(e),i.removeEventListener("animationstart",s),i.removeEventListener("animationcancel",r),i.removeEventListener("animationend",r)}}d("ANIMATION_END")},[i,d]),{isPresent:["mounted","unmountSuspended"].includes(c),ref:s.useCallback(e=>{a.current=e?getComputedStyle(e):null,n(e)},[])}}(n),o="function"==typeof a?a({present:l.isPresent}):s.Children.only(a),c=(0,eM.useComposedRefs)(l.ref,(t=o,(i=(r=Object.getOwnPropertyDescriptor(t.props,"ref")?.get)&&"isReactWarning"in r&&r.isReactWarning)?t.ref:(i=(r=Object.getOwnPropertyDescriptor(t,"ref")?.get)&&"isReactWarning"in r&&r.isReactWarning)?t.props.ref:t.props.ref||t.ref));return"function"==typeof a||l.isPresent?s.cloneElement(o,{ref:c}):null};function tt(e){return e?.animationName||"none"}te.displayName="Presence";var tr="Tabs",[ts,ti]=eC(tr,[e1]),tn=e1(),[ta,tl]=ts(tr),to=s.forwardRef((e,t)=>{let{__scopeTabs:s,value:i,onValueChange:n,defaultValue:a,orientation:l="horizontal",dir:o,activationMode:c="automatic",...d}=e,x=eH(o),[m,u]=eU({prop:i,onChange:n,defaultProp:a??"",caller:tr});return(0,r.jsx)(ta,{scope:s,baseId:eO(),value:m,onValueChange:u,orientation:l,dir:x,activationMode:c,children:(0,r.jsx)(eZ.div,{dir:x,"data-orientation":l,...d,ref:t})})});to.displayName=tr;var tc="TabsList",td=s.forwardRef((e,t)=>{let{__scopeTabs:s,loop:i=!0,...n}=e,a=tl(tc,s),l=tn(s);return(0,r.jsx)(e4,{asChild:!0,...l,orientation:a.orientation,dir:a.dir,loop:i,children:(0,r.jsx)(eZ.div,{role:"tablist","aria-orientation":a.orientation,...n,ref:t})})});td.displayName=tc;var tx="TabsTrigger",tm=s.forwardRef((e,t)=>{let{__scopeTabs:s,value:i,disabled:n=!1,...a}=e,l=tl(tx,s),o=tn(s),c=tp(l.baseId,i),d=tf(l.baseId,i),x=i===l.value;return(0,r.jsx)(e8,{asChild:!0,...o,focusable:!n,active:x,children:(0,r.jsx)(eZ.button,{type:"button",role:"tab","aria-selected":x,"aria-controls":d,"data-state":x?"active":"inactive","data-disabled":n?"":void 0,disabled:n,id:c,...a,ref:t,onMouseDown:eA(e.onMouseDown,e=>{n||0!==e.button||!1!==e.ctrlKey?e.preventDefault():l.onValueChange(i)}),onKeyDown:eA(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&l.onValueChange(i)}),onFocus:eA(e.onFocus,()=>{let e="manual"!==l.activationMode;x||n||!e||l.onValueChange(i)})})})});tm.displayName=tx;var tu="TabsContent",th=s.forwardRef((e,t)=>{let{__scopeTabs:i,value:n,forceMount:a,children:l,...o}=e,c=tl(tu,i),d=tp(c.baseId,n),x=tf(c.baseId,n),m=n===c.value,u=s.useRef(m);return s.useEffect(()=>{let e=requestAnimationFrame(()=>u.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,r.jsx)(te,{present:a||m,children:({present:s})=>(0,r.jsx)(eZ.div,{"data-state":m?"active":"inactive","data-orientation":c.orientation,role:"tabpanel","aria-labelledby":d,hidden:!s,id:x,tabIndex:0,...o,ref:t,style:{...e.style,animationDuration:u.current?"0s":void 0},children:s&&l})})});function tp(e,t){return`${e}-trigger-${t}`}function tf(e,t){return`${e}-content-${t}`}th.displayName=tu;let tg=s.forwardRef(({className:e,...t},s)=>(0,r.jsx)(td,{ref:s,className:(0,c.cn)("inline-flex h-10 items-center justify-center rounded-md bg-zinc-800 p-1 text-zinc-400",e),...t}));tg.displayName=td.displayName;let tb=s.forwardRef(({className:e,...t},s)=>(0,r.jsx)(tm,{ref:s,className:(0,c.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-zinc-950 data-[state=active]:text-white data-[state=active]:shadow-sm",e),...t}));tb.displayName=tm.displayName;let tj=s.forwardRef(({className:e,...t},s)=>(0,r.jsx)(th,{ref:s,className:(0,c.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));function ty(e,t){let r=(e.length-1)*t,s=Math.floor(r);return void 0!==e[s+1]?parseFloat((e[s]+(r-s)*(e[s+1]-e[s])).toFixed(2)):parseFloat(e[s].toFixed(2))}function tN(){let e=o(),[t,n]=(0,s.useState)(!1),[a,l]=(0,s.useState)(null),[c,d]=(0,s.useState)(null),x=(0,s.useCallback)(async()=>{n(!0),l(null),d(null);try{let i=e.counties.map(e=>P[e]||e);if(0===i.length){l("請至少選擇一個縣市"),n(!1);return}let{dateRange:a,startDate:o,endDate:c}=e;if("custom"!==a&&(!o||!c)){let e=R(a);e.startDate&&e.endDate&&(o=e.startDate,c=e.endDate)}let x={districts:e.districts,transactionType:e.transactionType,type:e.transactionType,projectNames:e.projectNames,buildingType:e.buildingType,excludeCommercial:e.excludeCommercial,floorPremium:e.floorPremium,dateRange:a,dateStart:o,dateEnd:c};console.log("Analyzing with counties:",i);let m=i.map(e=>{let t={...x,countyCode:e,counties:[e]};return A(t).catch(t=>(console.error(`Failed to fetch data for ${e}:`,t),null))}),u=await Promise.all(m),h=null,p=0;for(let e of u)if(e&&e.projectRanking&&e.coreMetrics){var t,r,s;console.log("Merging result for county:",e.projectRanking?.[0]?.county),t=h,h=e?t?(e.transactionDetails&&Array.isArray(e.transactionDetails)&&(t.transactionDetails||(t.transactionDetails=[]),t.transactionDetails=[...t.transactionDetails,...e.transactionDetails]),t.coreMetrics=function(e,t){if(!t)return e;if(!e)return t;let r=(e.totalSaleAmount||0)+(t.totalSaleAmount||0),s=(e.totalHouseArea||0)+(t.totalHouseArea||0),i=(e.transactionCount||0)+(t.transactionCount||0);return{totalSaleAmount:r,totalHouseArea:s,overallAveragePrice:s>0?r/s:0,transactionCount:i,medianPrice:0,q1Price:0,q3Price:0,minPrice:Math.min(e.minPrice||1/0,t.minPrice||1/0),maxPrice:Math.max(e.maxPrice||0,t.maxPrice||0)}}(t.coreMetrics,e.coreMetrics),e.projectRanking&&Array.isArray(e.projectRanking)&&(t.projectRanking=[...t.projectRanking,...e.projectRanking]),t.priceBandAnalysis=function(e,t){if(!t)return e;let r=Array.isArray(e)?e:e?.details||[],s=Array.isArray(t)?t:t?.details||[],i=e?.locationCrossTable||{},n=t?.locationCrossTable||{},a=e?.allDistricts||[],l=t?.allDistricts||[],o=e?.allRoomTypes||[],c=t?.allRoomTypes||[],d=new Map,x=e=>{let t=null!==e.bathrooms&&void 0!==e.bathrooms?String(e.bathrooms):"null",r=(e.roomType||"").replace(/\s+/g,""),s=`${r}-${t}`,i=Number(e.count)||0,n=Number(e.avgPrice)||0,a=Number(e.minPrice)||0,l=Number(e.maxPrice)||0;if(d.has(s)){let t=d.get(s),r=Number(t.count)||0,o=Number(t.avgPrice)||0,c=n*i,x=r+i,m=x>0?(o*r+c)/x:0;if(t.count=x,t.avgPrice=parseFloat(m.toFixed(2)),t.minPrice=Math.min(t.minPrice,a),t.maxPrice=Math.max(t.maxPrice,l),e.projectNames){let r=new Set([...t.projectNames,...e.projectNames]);t.projectNames=Array.from(r)}e.byDistrict&&Object.entries(e.byDistrict).forEach(([e,r])=>{t.byDistrict[e]=(t.byDistrict[e]||0)+r})}else d.set(s,{...e,roomType:r,count:i,avgPrice:n,minPrice:a,maxPrice:l,projectNames:e.projectNames?[...e.projectNames]:[],byDistrict:e.byDistrict?{...e.byDistrict}:{}})};r.forEach(x),s.forEach(x);let m={...i};Object.entries(n).forEach(([e,t])=>{m[e]?Object.entries(t).forEach(([t,r])=>{m[e][t]=(m[e][t]||0)+r}):m[e]={...t}});let u=Array.from(new Set([...a,...l])).sort(),h=Array.from(new Set([...o,...c])).sort();return{details:Array.from(d.values()),locationCrossTable:m,allDistricts:u,allRoomTypes:h}}(t.priceBandAnalysis,e.priceBandAnalysis),t.unitPriceAnalysis=function(e,t){if(!t)return e;let r=(e,t)=>{if(!t)return e;if(!e)return t;let r=(e.count||0)+(t.count||0);if(0===r)return e;let s={arithmetic:0,weighted:0},i=(e,t)=>"number"==typeof e.avgPrice?e.weightedAvgPrice||e.avgPrice:e.avgPrice?.[t]||0;["arithmetic","weighted"].forEach(n=>{let a=i(e,n),l=i(t,n);s[n]=(a*(e.count||0)+l*(t.count||0))/r});let n=Math.min(e.minPrice,t.minPrice),a=Math.max(e.maxPrice,t.maxPrice),l=e.minPrice<t.minPrice?e.minPriceProject:t.minPriceProject;return{count:r,avgPrice:s,minPrice:n,maxPrice:a,minPriceProject:l,maxPriceProject:e.maxPrice>t.maxPrice?e.maxPriceProject:t.maxPriceProject,medianPrice:0,q1Price:0,q3Price:0}},s=r(e.residentialStats,t.residentialStats),i=r(e.officeStats,t.officeStats),n=r(e.storeStats,t.storeStats),a=[...e.typeComparison||[]];return t.typeComparison&&(a=[...a,...t.typeComparison]),{residentialStats:s,officeStats:i,storeStats:n,typeComparison:a}}(t.unitPriceAnalysis,e.unitPriceAnalysis),t.transactionDetails&&t.transactionDetails.length>0&&function(e,t){if(!e||!t||0===t.length)return;let r=[],s={price:0,area:0,count:0},i=[],n={price:0,area:0,count:0},a=[],l={price:0,area:0,count:0},o=()=>({minPrice:1/0,maxPrice:-1/0,minRecord:null,maxRecord:null}),c=o(),d=o(),x=o();t.forEach(e=>{let t=e["建物型態"],o=e["主要用途"],m=e["房屋單價(萬)"],u=e["房屋總價(萬)"]||0,h=e["建物移轉總面積"]||0;if("number"!=typeof m||m<=0)return;let p=r,f=s,g=c;t?.includes("店")||"商業用"===o||e["備註"]?.includes("店")?(p=a,f=l,g=x):(t?.includes("辦公")||t?.includes("廠辦")||t?.includes("事務所")||o?.includes("辦公"))&&(p=i,f=n,g=d),p.push(m),f.price+=u,f.area+=h,f.count+=1,m>g.maxPrice&&(g.maxPrice=m,g.maxRecord=e),m<g.minPrice&&(g.minPrice=m,g.minRecord=e)});let m=(e,t,r,s)=>{e&&(function(e,t){if(!t||0===t.length){e.medianPrice=0,e.q1Price=0,e.q3Price=0;return}t.sort((e,t)=>e-t),e.medianPrice=ty(t,.5),e.q1Price=ty(t,.25),e.q3Price=ty(t,.75)}(e,t),e.count=r.count,e.avgPrice=r.count>0?t.reduce((e,t)=>e+t,0)/r.count:0,e.weightedAvgPrice=r.area>0?r.price/r.area:0,s.maxRecord&&(e.maxPrice=s.maxPrice,e.maxPriceProject=s.maxRecord["建案名稱"],e.maxPriceUnit=s.maxRecord["戶型"]||s.maxRecord["戶別"],e.maxPriceFloor=s.maxRecord["樓層"]),s.minRecord&&(e.minPrice=s.minPrice,e.minPriceProject=s.minRecord["建案名稱"],e.minPriceUnit=s.minRecord["戶型"]||s.minRecord["戶別"],e.minPriceFloor=s.minRecord["樓層"]))};e.residentialStats&&m(e.residentialStats,r,s,c),e.officeStats&&m(e.officeStats,i,n,d),e.storeStats&&m(e.storeStats,a,l,x);let u=new Map;t.forEach(e=>{let t=e["建案名稱"];if(!t)return;u.has(t)||u.set(t,{resSum:{price:0,area:0,count:0},shopSum:{price:0,area:0,count:0},officeSum:{price:0,area:0,count:0},county:e["縣市"],district:e["行政區"]});let r=u.get(t),s=e["建物型態"],i=e["主要用途"],n=e["房屋單價(萬)"],a=e["房屋總價(萬)"]||0,l=e["建物移轉總面積"]||0;"number"!=typeof n||n<=0||(s?.includes("店")||"商業用"===i||e["備註"]?.includes("店")?(r.shopSum.price+=a,r.shopSum.area+=l,r.shopSum.count+=1):s?.includes("辦公")||s?.includes("廠辦")||s?.includes("事務所")||i?.includes("辦公")?(r.officeSum.price+=a,r.officeSum.area+=l,r.officeSum.count+=1):(r.resSum.price+=a,r.resSum.area+=l,r.resSum.count+=1))});let h=[];u.forEach((e,t)=>{let r=e.resSum.area>0?e.resSum.price/e.resSum.area:0,s=e.shopSum.area>0?e.shopSum.price/e.shopSum.area:0,i=e.officeSum.area>0?e.officeSum.price/e.officeSum.area:0;r>0&&(s>0||i>0)&&h.push({projectName:t,county:e.county,district:e.district,residentialAvg:r,shopAvg:s,officeAvg:i,shopMultiple:r>0?s/r:0,officeMultiple:r>0?i/r:0})}),h.sort((e,t)=>e.projectName.localeCompare(t.projectName)),e.typeComparison=h}(t.unitPriceAnalysis,t.transactionDetails),t.parkingAnalysis=function(e,t){if(!t)return e;let r=e.parkingRatio,s=t.parkingRatio,i=null;if(r&&s){let e=r.withParking.count,t=r.withoutParking.count,n=s.withParking.count,a=s.withoutParking.count,l=e+n,o=t+a,c=l+o;i={withParking:{count:l,percentage:c>0?l/c*100:0},withoutParking:{count:o,percentage:c>0?o/c*100:0}}}else i=r||s;let n=new Map,a=e=>{if(n.has(e.type)){let t=n.get(e.type),r=t.count+e.count,s=t.transactionCount+e.transactionCount,i=t.avgPrice,a=e.avgPrice,l=s>0?(i*t.transactionCount+a*e.transactionCount)/s:0;t.count=r,t.transactionCount=s,t.avgPrice=l}else n.set(e.type,{...e})};(e.avgPriceByType||[]).forEach(a),(t.avgPriceByType||[]).forEach(a);let l=Array.from(n.values()),o=new Map,c=e=>{if(o.has(e.floor)){let t=o.get(e.floor),r=t.count+e.count;e.rawRecords&&(t.rawRecords=[...t.rawRecords||[],...e.rawRecords]);let s=r>0?(t.avgPrice*t.count+e.avgPrice*e.count)/r:0;t.count=r,t.avgPrice=s,t.minPrice=Math.min(t.minPrice,e.minPrice),t.maxPrice=Math.max(t.maxPrice,e.maxPrice),e.maxPrice>t.maxPrice&&(t.maxPriceProject=e.maxPriceProject,t.maxPriceUnit=e.maxPriceUnit,t.maxPriceFloor=e.maxPriceFloor),e.minPrice<t.minPrice&&(t.minPriceProject=e.minPriceProject,t.minPriceUnit=e.minPriceUnit,t.minPriceFloor=e.minPriceFloor)}else o.set(e.floor,{...e,rawRecords:e.rawRecords?[...e.rawRecords]:[]})};return(e.rampPlanePriceByFloor||[]).forEach(c),(t.rampPlanePriceByFloor||[]).forEach(c),{parkingRatio:i,avgPriceByType:l,rampPlanePriceByFloor:Array.from(o.values())}}(t.parkingAnalysis,e.parkingAnalysis),t.salesVelocityAnalysis=function(e,t){if(!t)return e;let r=Array.from(new Set([...e.allRoomTypes||[],...t.allRoomTypes||[]])),s={};return["monthly","quarterly","yearly","weekly"].forEach(r=>{let i=e[r]||{},n=t[r]||{},a={};new Set([...Object.keys(i),...Object.keys(n)]).forEach(e=>{let t=i[e]||{},r=n[e]||{},s=new Set([...Object.keys(t),...Object.keys(r)]),l={};s.forEach(e=>{let s=t[e],i=r[e];if(s&&i){let t=s.count+i.count,r=s.priceSum+i.priceSum,n=s.areaSum+i.areaSum;l[e]={count:t,priceSum:r,areaSum:n,avgPrice:n>0?r/n:0}}else s?l[e]={...s}:i&&(l[e]={...i})}),a[e]=l}),s[r]=a}),{allRoomTypes:r,...s}}(t.salesVelocityAnalysis,e.salesVelocityAnalysis),r=t.priceGridAnalysis,t.priceGridAnalysis=(s=e.priceGridAnalysis)?{projectNames:[...r.projectNames||[],...s.projectNames||[]],byProject:{...r.byProject||{},...s.byProject||{}}}:r,t.areaDistributionAnalysis=function(e,t){if(!t)return e;if(!e)return t;let r={...e};return Object.keys(t).forEach(e=>{r[e]?r[e]=[...r[e],...t[e]]:r[e]=[...t[e]]}),r}(t.areaDistributionAnalysis,e.areaDistributionAnalysis),t):JSON.parse(JSON.stringify(e)):t,p++}if(console.log("Aggregation complete. Total Transaction Details:",h?.transactionDetails?.length),0===p){if(e.projectNames.length>0)throw Error("這段時間 這個建案查詢不到資料");throw Error("無法取得任何縣市的分析數據")}if(p<i.length){let e=i.length-p;l(`注意：有 ${e} 個縣市的資料載入失敗，分析結果可能不完整。`)}d(h)}catch(e){console.error("Analysis failed:",e),l(e.message||"無法取得分析數據，請稍後再試。")}finally{n(!1)}},[e]);return(0,s.useEffect)(()=>{},[]),(0,r.jsxs)(i.AppLayout,{children:[(0,r.jsx)("section",{className:"mb-6 sticky top-4 z-30",children:(0,r.jsx)(I,{onAnalyze:x,isLoading:t})}),a&&(0,r.jsxs)("div",{className:"bg-red-500/10 border border-red-500/50 text-red-500 p-4 rounded-lg mb-6 flex items-center gap-2",children:[(0,r.jsx)(eS,{size:20}),a]}),t&&(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-20",children:[(0,r.jsx)(ew.Loader2,{className:"h-10 w-10 animate-spin text-violet-500 mb-4"}),(0,r.jsx)("p",{className:"text-zinc-400",children:"正在分析數據，請稍候..."})]}),!t&&!c&&!a&&(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 glass-panel border-dashed border-2 border-zinc-800 rounded-xl",children:[(0,r.jsx)("div",{className:"text-zinc-500 mb-2",children:"尚未進行分析"}),(0,r.jsx)("p",{className:"text-zinc-600 text-sm",children:"請選擇篩選條件並點擊「開始分析」"})]}),!t&&c&&(0,r.jsx)("div",{className:"space-y-8 pb-20",children:(0,r.jsxs)(to,{defaultValue:"ranking",className:"w-full",children:[(0,r.jsx)("div",{className:"overflow-x-auto pb-2 scrollbar-hide",children:(0,r.jsxs)(tg,{className:"bg-zinc-900/50 border border-white/5 p-1 mb-6 inline-flex min-w-max",children:[(0,r.jsx)(tb,{value:"ranking",children:"核心指標與排名"}),(0,r.jsx)(tb,{value:"price-band",children:"總價帶分析"}),(0,r.jsx)(tb,{value:"unit-price",children:"單價分析"}),(0,r.jsx)(tb,{value:"heatmap",children:"調價熱力圖"}),(0,r.jsx)(tb,{value:"velocity",children:"銷售速度與房型"}),(0,r.jsx)(tb,{value:"parking",children:"車位分析"}),(0,r.jsx)(tb,{value:"data-list",children:"交易明細列表"})]})}),(0,r.jsx)(tj,{value:"ranking",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,r.jsx)(V,{data:c})}),(0,r.jsx)(tj,{value:"price-band",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,r.jsx)(K,{data:{...c.priceBandAnalysis,transactionDetails:c.transactionDetails}})}),(0,r.jsx)(tj,{value:"unit-price",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,r.jsx)(ei,{data:c})}),(0,r.jsx)(tj,{value:"heatmap",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,r.jsx)(ey,{data:c})}),(0,r.jsx)(tj,{value:"velocity",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,r.jsx)(X,{data:c})}),(0,r.jsx)(tj,{value:"parking",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,r.jsx)(ee,{data:c})}),(0,r.jsx)(tj,{value:"data-list",className:"focus-visible:outline-none focus-visible:ring-0",children:(0,r.jsx)(ek,{trigger:c})})]})})]})}tj.displayName=th.displayName,e.s(["default",()=>tN],6698)}]);