<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>平米內參 預售屋數據儀表板 - 登入 / 註冊</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-bg': '#1a1d29',
                        'dark-card': '#252836',
                        'cyan-accent': '#06b6d4',
                    }
                }
            }
        }
    </script>
    <style>
        body { 
            font-family: 'Inter', 'Noto Sans TC', sans-serif; 
            background-color: #1a1d29; /* Fallback color */
        }

        #background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background-image: url('css/images/loginbackground.jpg');
            background-size: cover;
            background-position: center;
        }

        #background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-color: rgba(26, 29, 41, 0.85); /* Slightly darker overlay */
        }

        .form-input { background-color: #1f2937; border: 1px solid #4b5563; color: #d1d5db; }
        .form-input:focus { border-color: #06b6d4; box-shadow: 0 0 0 2px rgba(6, 182, 212, 0.5); outline: none; }
        .loader-sm { border: 2px solid #374151; border-top: 2px solid #06b6d4; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .tab-button {
            padding: 0.75rem 1rem;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            color: #9ca3af;
            width: 50%;
        }
        .tab-button.active { color: #06b6d4; border-bottom-color: #06b6d4; }
        #form-container { min-height: 500px; }
        
        /* ▼▼▼ 【新增】圖片輪播區塊樣式 ▼▼▼ */
        .feature-carousel {
            position: relative;
            width: 100%;
            max-width: 500px; /* 控制最大寬度 */
            aspect-ratio: 16 / 10; /* 控制圖片比例 */
            margin-top: 1.5rem;
            border-radius: 0.75rem;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        .carousel-slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            background-size: cover;
            background-position: center;
        }
        .carousel-slide.active {
            opacity: 1;
        }
        .carousel-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1rem 1.5rem;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.85), transparent);
        }
        .carousel-caption h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #fff;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        .carousel-caption p {
            font-size: 0.875rem;
            color: #e5e7eb;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        .carousel-dots {
            position: absolute;
            bottom: 0.5rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 0.5rem;
        }
        .carousel-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.4);
            transition: background-color 0.3s ease;
            cursor: pointer;
        }
        .carousel-dot.active {
            background-color: #fff;
        }
        /* ▲▲▲ 【新增結束】 ▲▲▲ */
    </style>
</head>
<body class="text-gray-200 min-h-screen flex flex-col p-6">
    
    <div id="background-container"></div>
    <div id="background-overlay"></div>

    <div class="flex-grow flex items-center justify-center">
        <div class="w-full max-w-7xl mx-auto flex flex-col lg:flex-row items-center justify-center gap-16 lg:gap-24">
        
            <div class="flex-1 text-center lg:text-left">
                <header class="mb-6">
                    <h1 class="text-4xl lg:text-5xl font-extrabold text-white tracking-tight leading-tight">平米內參<br><span class="text-3xl lg:text-4xl font-bold">預售屋數據儀表板</span></h1>
                </header>
                <div class="text-gray-300 max-w-lg mx-auto lg:mx-0">
                    <p class="text-lg">
                        解鎖專業級的預售屋市場洞察力。我們整合了最新的實價登錄數據，提供即時、深入的分析報告，幫助您做出更精準的投資決策。
                    </p>
                    
                    <div class="feature-carousel" id="feature-carousel">
                        </div>
                    </div>
            </div>

            <main id="form-container" class="bg-dark-card p-6 rounded-xl shadow-lg w-full max-w-sm flex-shrink-0">
                
                <div class="flex border-b border-gray-700 mb-6">
                    <button id="login-tab" class="tab-button active">登入</button>
                    <button id="register-tab" class="tab-button">註冊</button>
                </div>

                <form id="login-form">
                    <div class="space-y-6">
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-300 mb-2">電子郵件</label>
                            <input type="email" id="email" name="email" class="form-input block w-full pl-3 pr-10 py-3 text-base rounded-md" required autocomplete="email">
                        </div>
                        <div>
                            <label for="password" class="block text-sm font-medium text-gray-300 mb-2">密碼</label>
                            <input type="password" id="password" name="password" class="form-input block w-full pl-3 pr-10 py-3 text-base rounded-md" required autocomplete="current-password">
                        </div>
                        <div>
                            <button type="submit" id="login-submit-button" class="w-full flex justify-center items-center bg-cyan-accent hover:bg-opacity-90 text-white font-bold py-3 px-4 rounded-lg shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                                <div class="loader-sm hidden"></div>
                                <span>登入</span>
                            </button>
                        </div>
                    </div>
                </form>

                <form id="register-form" class="hidden">
                    <div class="space-y-6">
                        <div>
                            <label for="register-email" class="block text-sm font-medium text-gray-300 mb-2">電子郵件</label>
                            <input type="email" id="register-email" name="register-email" class="form-input block w-full pl-3 pr-10 py-3 text-base rounded-md" required autocomplete="email">
                        </div>
                        <div>
                            <label for="register-password" class="block text-sm font-medium text-gray-300 mb-2">密碼 (至少6位數)</label>
                            <input type="password" id="register-password" name="register-password" class="form-input block w-full pl-3 pr-10 py-3 text-base rounded-md" required minlength="6">
                        </div>
                        <div>
                            <label for="confirm-password" class="block text-sm font-medium text-gray-300 mb-2">確認密碼</label>
                            <input type="password" id="confirm-password" name="confirm-password" class="form-input block w-full pl-3 pr-10 py-3 text-base rounded-md" required minlength="6">
                        </div>
                        <div>
                            <button type="submit" id="register-submit-button" class="w-full flex justify-center items-center bg-cyan-accent hover:bg-opacity-90 text-white font-bold py-3 px-4 rounded-lg shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                                <div class="loader-sm hidden"></div>
                                <span>註冊</span>
                            </button>
                        </div>
                    </div>
                </form>

                <div id="message" class="text-red-400 text-center min-h-[2.5rem] mt-4"></div>

            </main>

        </div>
    </div>

    <footer class="text-center py-8 text-gray-500 text-sm">
        <p>資料來源：內政部實價登錄 | 版權所有 © 2025 平米內參. 保留一切權利.</p>
    </footer>

    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

        const SUPABASE_URL = 'https://zxbmbbfrzbtuueysicoc.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp4Ym1iYmZyemJ0dXVleXNpY29jIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA2ODg5ODksImV4cCI6MjA2NjI2NDk4OX0.1IUynv5eK1xF_3pb-oasqaTrPvbeAOC4Sc1oykPBy4M';
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        document.addEventListener('DOMContentLoaded', () => {
            // ... (原有的表單處理邏輯保持不變)
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const loginTab = document.getElementById('login-tab');
            const registerTab = document.getElementById('register-tab');
            const messageDiv = document.getElementById('message');
            const loginSubmitBtn = document.getElementById('login-submit-button');
            const registerSubmitBtn = document.getElementById('register-submit-button');

            loginTab.addEventListener('click', () => {
                loginTab.classList.add('active');
                registerTab.classList.remove('active');
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
                messageDiv.textContent = '';
                if (window.registerCountdownInterval) clearInterval(window.registerCountdownInterval);
            });
            registerTab.addEventListener('click', () => {
                registerTab.classList.add('active');
                loginTab.classList.remove('active');
                registerForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
                messageDiv.textContent = '';
            });
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const btn = loginSubmitBtn, loader = btn.querySelector('.loader-sm'), text = btn.querySelector('span');
                btn.disabled = true; loader.classList.remove('hidden'); text.classList.add('hidden'); messageDiv.textContent = '';
                try {
                    const { error } = await supabase.auth.signInWithPassword({ email: e.target.email.value, password: e.target.password.value });
                    if (error) throw error;
                    window.location.href = 'index.html';
                } catch (error) {
                    messageDiv.textContent = `登入失敗: ${error.message}`;
                    btn.disabled = false; loader.classList.add('hidden'); text.classList.remove('hidden');
                }
            });
            registerForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const btn = registerSubmitBtn, loader = btn.querySelector('.loader-sm'), text = btn.querySelector('span');
                if (e.target['register-password'].value !== e.target['confirm-password'].value) {
                    messageDiv.textContent = '兩次輸入的密碼不相符。'; return;
                }
                btn.disabled = true; loader.classList.remove('hidden'); text.classList.add('hidden'); messageDiv.textContent = '';
                try {
                    const { error } = await supabase.auth.signUp({ email: e.target['register-email'].value, password: e.target['register-password'].value, options: { emailRedirectTo: 'https://sqm7.github.io/kthd/' } });
                    if (error) throw error;
                    let countdown = 10;
                    const successMessage = '註冊成功！請至您的電子信箱收取驗證信。';
                    messageDiv.innerHTML = `<span class="text-green-400">${successMessage}<br>${countdown} 秒後將返回登入頁面...</span>`;
                    window.registerCountdownInterval = setInterval(() => {
                        countdown--;
                        if (countdown > 0) messageDiv.innerHTML = `<span class="text-green-400">${successMessage}<br>${countdown} 秒後將返回登入頁面...</span>`;
                        else { clearInterval(window.registerCountdownInterval); loginTab.click(); }
                    }, 1000);
                } catch (error) {
                    messageDiv.textContent = `註冊失敗: ${error.message}`;
                    btn.disabled = false; loader.classList.add('hidden'); text.classList.remove('hidden');
                }
            });

            // ▼▼▼ 【新增】圖片輪播功能 JavaScript ▼▼▼
            const carouselContainer = document.getElementById('feature-carousel');
            const features = [
                { img: 'css/images/preview-1.png', title: '核心指標與排名', desc: '全面掌握市場銷售總額、坪數、均價與建案市佔率。' },
                { img: 'css/images/preview-2.png', title: '總價帶分析', desc: '透過箱型圖與數據表，洞悉各房型的總價分佈區間。' },
                { img: 'css/images/preview-3.png', title: '房屋單價分析', desc: '深入比較住宅、辦公室與店舖的單價，發掘價差倍數。' },
                { img: 'css/images/preview-4.png', title: '車位分析', desc: '從房車配比到各類型、各樓層車位均價，提供完整車位洞察。' },
                { img: 'css/images/preview-5.png', title: '房型去化分析', desc: '以熱力圖與趨勢線圖，視覺化呈現各房型的銷售速度與面積分佈。' },
                { img: 'css/images/preview-6.png', title: '垂直水平價盤', desc: '獨家銷控表與熱力圖，一眼看穿建案的定價策略與調價軌跡。' }
            ];

            let slidesHTML = '';
            features.forEach((feature, index) => {
                slidesHTML += `
                    <div class="carousel-slide ${index === 0 ? 'active' : ''}" style="background-image: url('${feature.img}');">
                        <div class="carousel-caption">
                            <h3>${feature.title}</h3>
                            <p>${feature.desc}</p>
                        </div>
                    </div>
                `;
            });
            carouselContainer.innerHTML = slidesHTML;

            let currentSlide = 0;
            const slides = carouselContainer.querySelectorAll('.carousel-slide');
            
            function showSlide(index) {
                slides.forEach((slide, i) => {
                    slide.classList.toggle('active', i === index);
                });
                currentSlide = index;
            }

            setInterval(() => {
                let nextSlide = (currentSlide + 1) % slides.length;
                showSlide(nextSlide);
            }, 5000); // 每 5 秒切換一次
            // ▲▲▲ 【新增結束】 ▲▲▲
        });
    </script>
</body>
</html>
